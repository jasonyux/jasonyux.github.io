<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/learning/images/logo-180x180.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="/learning/images/logo-32x32.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/learning/images/logo-16x16.jpg">

<link rel="stylesheet" href="/learning/css/main.css">


<link rel="stylesheet" href="/learning/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"jasonyux.github.io","root":"/learning/","scheme":"Pisces","version":"8.0.0-rc.3","exturl":false,"sidebar":{"position":"left","width":350,"display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="IMPORTANT:Some of the content here is a personal summary&#x2F;abbreviation of contents on the Offical Spring Boot Documentation. Feel free to refer to the official site if you think some of the sections w">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring Boot Manual">
<meta property="og:url" content="https://jasonyux.github.io/2020/06/29/SpringBoot-Manual/index.html">
<meta property="og:site_name" content="From a Beginner to a Disaster">
<meta property="og:description" content="IMPORTANT:Some of the content here is a personal summary&#x2F;abbreviation of contents on the Offical Spring Boot Documentation. Feel free to refer to the official site if you think some of the sections w">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://jasonyux.github.io/2020/06/29/SpringBoot-Manual/concrete-bindings.png">
<meta property="og:image" content="https://jasonyux.github.io/2020/06/29/SpringBoot-Manual/legacy.png">
<meta property="og:image" content="https://jasonyux.github.io/2020/06/29/SpringBoot-Manual/springboot-logging.png">
<meta property="og:image" content="https://jasonyux.github.io/2020/06/29/SpringBoot-Manual/staticdirectory.png">
<meta property="og:image" content="https://jasonyux.github.io/2020/06/29/SpringBoot-Manual/homepagedirectory.png">
<meta property="og:image" content="https://jasonyux.github.io/2020/06/29/SpringBoot-Manual/web-template-engine.png">
<meta property="og:image" content="https://jasonyux.github.io/2020/06/29/SpringBoot-Manual/thymeleaf-html.png">
<meta property="og:image" content="https://jasonyux.github.io/2020/06/29/SpringBoot-Manual/thymeleaf-precedence.png">
<meta property="og:image" content="https://jasonyux.github.io/2020/06/29/SpringBoot-Manual/interationalization-example.png">
<meta property="og:image" content="https://jasonyux.github.io/2020/06/29/SpringBoot-Manual/change_encoding.png">
<meta property="og:image" content="https://jasonyux.github.io/2020/06/29/SpringBoot-Manual/Inkedspring-data-flow.jpg">
<meta property="og:image" content="https://jasonyux.github.io/2020/06/29/SpringBoot-Manual/default-error.png">
<meta property="og:image" content="https://jasonyux.github.io/2020/06/29/SpringBoot-Manual/jsr107-graph.png">
<meta property="og:image" content="https://jasonyux.github.io/2020/06/29/SpringBoot-Manual/jsr107-jar.png">
<meta property="og:image" content="https://jasonyux.github.io/2020/06/29/SpringBoot-Manual/caching-example.png">
<meta property="og:image" content="https://imgs.developpaper.com/imgs/2266318593-22ea4454ae5d1cfc_articlex.png">
<meta property="og:image" content="https://www.baeldung.com/wp-content/uploads/2017/12/dubbo-architecture-1024x639.png">
<meta property="article:published_time" content="2020-06-29T03:35:00.000Z">
<meta property="article:modified_time" content="2020-07-29T07:29:46.294Z">
<meta property="article:author" content="Xiao Yu">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://jasonyux.github.io/2020/06/29/SpringBoot-Manual/concrete-bindings.png">

<link rel="canonical" href="https://jasonyux.github.io/2020/06/29/SpringBoot-Manual/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Spring Boot Manual | From a Beginner to a Disaster</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before, .use-motion .logo-line-after {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
  <div id="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <main class="main">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader">
        <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
        <span class="toggle-line toggle-line-first"></span>
        <span class="toggle-line toggle-line-middle"></span>
        <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/learning/" class="brand" rel="start">
      <i class="logo-line-before"></i>
      <h1 class="site-title">From a Beginner to a Disaster</h1>
      <i class="logo-line-after"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Xiao.Y</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/learning/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/learning/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Spring-Boot-Installation"><span class="nav-number">1.</span> <span class="nav-text">Spring Boot Installation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Structuring-Your-Code"><span class="nav-number">2.</span> <span class="nav-text">Structuring Your Code</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Auto-Configuration"><span class="nav-number">2.1.</span> <span class="nav-text">Auto-Configuration</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#EnableAutoConfiguration-under-the-hood"><span class="nav-number">2.1.1.</span> <span class="nav-text">EnableAutoConfiguration under the hood</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Viewing-Loaded-AutoConfiguration-Classes"><span class="nav-number">2.1.2.</span> <span class="nav-text">Viewing Loaded AutoConfiguration Classes</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Disabling-an-AutoConfiguration-Class"><span class="nav-number">2.1.3.</span> <span class="nav-text">Disabling an AutoConfiguration Class</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-Beans-and-Dependency-Injection-in-Spring-Boot"><span class="nav-number">2.2.</span> <span class="nav-text">Spring Beans and Dependency Injection in Spring Boot</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Running-Your-Application"><span class="nav-number">3.</span> <span class="nav-text">Running Your Application</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Compiling-and-Running-using-Maven-Plugin"><span class="nav-number">3.1.</span> <span class="nav-text">Compiling and Running using Maven Plugin</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Packaging-Your-Spring-Boot-Project"><span class="nav-number">3.2.</span> <span class="nav-text">Packaging Your Spring Boot Project</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Developer-Tools"><span class="nav-number">4.</span> <span class="nav-text">Developer Tools</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Enabling-spring-boot-devtools"><span class="nav-number">4.1.</span> <span class="nav-text">Enabling spring-boot-devtools</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Configuring-your-spring-boot-devtools"><span class="nav-number">4.2.</span> <span class="nav-text">Configuring your spring-boot-devtools</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Automatic-Reload"><span class="nav-number">4.3.</span> <span class="nav-text">Automatic Reload</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Automatic-Restart"><span class="nav-number">4.4.</span> <span class="nav-text">Automatic Restart</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Auto-Reload-vs-Auto-Restart"><span class="nav-number">4.5.</span> <span class="nav-text">Auto-Reload vs Auto-Restart</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Customizing-the-Restart-Classloader"><span class="nav-number">4.6.</span> <span class="nav-text">Customizing the Restart Classloader</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LiveReload"><span class="nav-number">4.7.</span> <span class="nav-text">LiveReload</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Configure-your-File-System-Watcher"><span class="nav-number">4.8.</span> <span class="nav-text">Configure your File System Watcher</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Global-Settings-File"><span class="nav-number">4.9.</span> <span class="nav-text">Global Settings File</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Remote-Applications"><span class="nav-number">4.10.</span> <span class="nav-text">Remote Applications</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Updates-in-your-Remote-Application"><span class="nav-number">4.11.</span> <span class="nav-text">Updates in your Remote Application</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Spring-Boot-Features"><span class="nav-number">5.</span> <span class="nav-text">Spring Boot Features</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Startup-Failures"><span class="nav-number">5.1.</span> <span class="nav-text">Startup Failures</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Lazy-Initialization"><span class="nav-number">5.2.</span> <span class="nav-text">Lazy Initialization</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Customzing-your-SpringApplication"><span class="nav-number">5.3.</span> <span class="nav-text">Customzing your SpringApplication</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Application-Liveness"><span class="nav-number">5.4.</span> <span class="nav-text">Application Liveness</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Application-Readiness"><span class="nav-number">5.5.</span> <span class="nav-text">Application Readiness</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Application-Event-and-Listeners"><span class="nav-number">5.6.</span> <span class="nav-text">Application Event and Listeners</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Web-Applications"><span class="nav-number">5.7.</span> <span class="nav-text">Web Applications</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Accessing-Application-Arguements"><span class="nav-number">5.8.</span> <span class="nav-text">Accessing Application Arguements</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Running-Specific-Code-for-SpringApplication"><span class="nav-number">5.9.</span> <span class="nav-text">Running Specific Code for SpringApplication</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Applicaiton-Exit"><span class="nav-number">5.10.</span> <span class="nav-text">Applicaiton Exit</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Externalized-Configuration"><span class="nav-number">6.</span> <span class="nav-text">Externalized Configuration</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-a-Wildcard-for-Loading-Configuration-Files"><span class="nav-number">6.1.</span> <span class="nav-text">Using a Wildcard for Loading Configuration Files</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Generating-and-Using-Random-Values"><span class="nav-number">6.2.</span> <span class="nav-text">Generating and Using Random Values</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Command-Line-Properties"><span class="nav-number">6.3.</span> <span class="nav-text">Command Line Properties</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Application-Properties-File"><span class="nav-number">6.4.</span> <span class="nav-text">Application Properties File</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Profile-Specific-Properties"><span class="nav-number">6.5.</span> <span class="nav-text">Profile Specific Properties</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Using-properties-file"><span class="nav-number">6.5.1.</span> <span class="nav-text">Using .properties file</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Using-yml-file"><span class="nav-number">6.5.2.</span> <span class="nav-text">Using .yml file</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Injecting-Property-Values"><span class="nav-number">6.6.</span> <span class="nav-text">Injecting Property Values</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Type-safe-Configuration-Properties"><span class="nav-number">6.7.</span> <span class="nav-text">Type-safe Configuration Properties</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#JavaBean-properties-binding-with-application-properties"><span class="nav-number">6.7.1.</span> <span class="nav-text">JavaBean properties binding with application.properties</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Constructor-Binding"><span class="nav-number">6.7.1.1.</span> <span class="nav-text">Constructor Binding</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Enabling-ConfigurationProperties"><span class="nav-number">6.7.1.2.</span> <span class="nav-text">Enabling @ConfigurationProperties</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Properties-Binding-to-a-Bean"><span class="nav-number">6.7.1.3.</span> <span class="nav-text">Properties Binding to a Bean</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Binding-With-application-yml"><span class="nav-number">6.7.2.</span> <span class="nav-text">Binding With application.yml</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Binding-Objects-Maps-Lists"><span class="nav-number">6.7.2.1.</span> <span class="nav-text">Binding Objects&#x2F;Maps&#x2F;Lists</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Binding-with-a-Customized-yml-or-properties-file"><span class="nav-number">6.8.</span> <span class="nav-text">Binding with a Customized yml or properties file</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Relaxed-Name-Matching-and-Binding-for-Environmental-Variables"><span class="nav-number">6.9.</span> <span class="nav-text">Relaxed Name Matching and Binding for Environmental Variables</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Properties-Type-Conversion"><span class="nav-number">6.10.</span> <span class="nav-text">Properties Type Conversion</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Converting-time-durations"><span class="nav-number">6.10.1.</span> <span class="nav-text">Converting time durations</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Converting-Periods"><span class="nav-number">6.10.2.</span> <span class="nav-text">Converting Periods</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Converting-Data-Size"><span class="nav-number">6.10.3.</span> <span class="nav-text">Converting Data Size</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Validating-ConfigurationProperties"><span class="nav-number">6.11.</span> <span class="nav-text">Validating @ConfigurationProperties</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Logging"><span class="nav-number">7.</span> <span class="nav-text">Logging</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-SLF4J-API"><span class="nav-number">7.1.</span> <span class="nav-text">Using SLF4J API</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Legacy-Bridging"><span class="nav-number">7.1.1.</span> <span class="nav-text">Legacy&#x2F;Bridging</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Spring-Boot-Logging"><span class="nav-number">7.1.2.</span> <span class="nav-text">Spring Boot Logging</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Using-SLF4J-Logging"><span class="nav-number">7.1.3.</span> <span class="nav-text">Using SLF4J Logging</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Log-Format"><span class="nav-number">7.1.4.</span> <span class="nav-text">Log Format</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#debug-log"><span class="nav-number">7.1.4.1.</span> <span class="nav-text">debug log</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#trace-log"><span class="nav-number">7.1.4.2.</span> <span class="nav-text">trace log</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Specify-Your-Own-Logging-Pattern"><span class="nav-number">7.1.4.3.</span> <span class="nav-text">Specify Your Own Logging Pattern</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Configuring-Your-Log-Levels"><span class="nav-number">7.1.5.</span> <span class="nav-text">Configuring Your Log Levels</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Configuring-Log-Levels-for-a-class-specific-logger"><span class="nav-number">7.1.5.1.</span> <span class="nav-text">Configuring Log Levels for a class&#x2F;specific logger</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Configuring-Log-Levels-using-Log-Groups"><span class="nav-number">7.1.5.2.</span> <span class="nav-text">Configuring Log Levels using Log Groups</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#File-Output"><span class="nav-number">7.2.</span> <span class="nav-text">File Output</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Logback-Extensions"><span class="nav-number">7.3.</span> <span class="nav-text">Logback Extensions</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Profile-Specific-Configuration"><span class="nav-number">7.3.0.1.</span> <span class="nav-text">Profile Specific Configuration</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Environment-Properties"><span class="nav-number">7.3.0.2.</span> <span class="nav-text">Environment Properties</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Developing-Web-Applications"><span class="nav-number">8.</span> <span class="nav-text">Developing Web Applications</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-Web-MVC-Framework"><span class="nav-number">8.1.</span> <span class="nav-text">Spring Web MVC Framework</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-Boot-Framework"><span class="nav-number">8.2.</span> <span class="nav-text">Spring Boot Framework</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Spring-Boot-Web-Application-Project-Structure"><span class="nav-number">8.2.1.</span> <span class="nav-text">Spring Boot Web Application Project Structure</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#WebJars"><span class="nav-number">8.2.1.1.</span> <span class="nav-text">WebJars</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Static-contents"><span class="nav-number">8.2.1.2.</span> <span class="nav-text">Static contents</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Welcome-Page"><span class="nav-number">8.2.1.3.</span> <span class="nav-text">Welcome Page</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Configure-Your-Web-Properties"><span class="nav-number">8.2.1.4.</span> <span class="nav-text">Configure Your Web Properties</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Using-Web-Templates"><span class="nav-number">8.2.2.</span> <span class="nav-text">Using Web Templates</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Importing-Thymeleaf"><span class="nav-number">8.2.2.1.</span> <span class="nav-text">Importing Thymeleaf</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Using-Thymeleaf"><span class="nav-number">8.2.2.2.</span> <span class="nav-text">Using Thymeleaf</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Thymeleaf-Syntax"><span class="nav-number">8.2.2.3.</span> <span class="nav-text">Thymeleaf Syntax</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Internationalization-Example"><span class="nav-number">8.2.2.4.</span> <span class="nav-text">Internationalization Example</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Sending-and-Handling-Post-Request"><span class="nav-number">8.2.3.</span> <span class="nav-text">Sending and Handling Post Request</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RequestParam-PathParam-Param"><span class="nav-number">8.2.4.</span> <span class="nav-text">@RequestParam&#x2F;@PathParam&#x2F;@Param</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-Boot-MVC-Extensions"><span class="nav-number">8.3.</span> <span class="nav-text">Spring Boot MVC Extensions</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Example-Adding-a-ViewController"><span class="nav-number">8.3.1.</span> <span class="nav-text">Example: Adding a ViewController</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Mechanism"><span class="nav-number">8.3.2.</span> <span class="nav-text">Mechanism</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Graceful-shutdown"><span class="nav-number">9.</span> <span class="nav-text">Graceful shutdown</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Working-With-Databases"><span class="nav-number">10.</span> <span class="nav-text">Working With Databases</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Introduction"><span class="nav-number">10.1.</span> <span class="nav-text">Introduction</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-JDBC"><span class="nav-number">10.2.</span> <span class="nav-text">Using JDBC</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Adding-JDBC-in-Maven-Dependency"><span class="nav-number">10.2.1.</span> <span class="nav-text">Adding JDBC in Maven Dependency</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Configuring-Your-Login-Credentials"><span class="nav-number">10.2.2.</span> <span class="nav-text">Configuring Your Login Credentials</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Creating-a-Connection"><span class="nav-number">10.2.3.</span> <span class="nav-text">Creating a Connection</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Spring-Boot-JDBC-DataSource-Mechanism"><span class="nav-number">10.2.4.</span> <span class="nav-text">Spring Boot JDBC DataSource Mechanism</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Example-Running-a-Schema-Script"><span class="nav-number">10.2.5.</span> <span class="nav-text">Example: Running a Schema Script</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Using-JDBC-for-SQL-Query"><span class="nav-number">10.2.6.</span> <span class="nav-text">Using JDBC for SQL Query</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-Druid-DataSource"><span class="nav-number">10.3.</span> <span class="nav-text">Using Druid DataSource</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Adding-Druid-to-your-Maven-Dependency"><span class="nav-number">10.3.1.</span> <span class="nav-text">Adding Druid to your Maven Dependency</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Configuring-Your-Druid-DataSource"><span class="nav-number">10.3.2.</span> <span class="nav-text">Configuring Your Druid DataSource</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Configuring-Druid-Monitor"><span class="nav-number">10.3.3.</span> <span class="nav-text">Configuring Druid Monitor</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-Mybatis"><span class="nav-number">10.4.</span> <span class="nav-text">Using Mybatis</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Adding-Mybatis-in-Maven-Dependency"><span class="nav-number">10.4.1.</span> <span class="nav-text">Adding Mybatis in Maven Dependency</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Configuring-your-DataSource-Connection"><span class="nav-number">10.4.2.</span> <span class="nav-text">Configuring your DataSource Connection</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Creating-Components-Beans-corresponding-to-your-Table"><span class="nav-number">10.4.3.</span> <span class="nav-text">Creating Components&#x2F;Beans corresponding to your Table</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Creating-Mapper-Annotations-to-Enable-MyBatis-Queries"><span class="nav-number">10.4.4.</span> <span class="nav-text">Creating Mapper Annotations to Enable MyBatis Queries</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Creating-Mapper-XML-to-Enable-MyBatis-Queries"><span class="nav-number">10.4.5.</span> <span class="nav-text">Creating Mapper XML to Enable MyBatis Queries</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Building-SqlSessionFactory-from-XML"><span class="nav-number">10.5.</span> <span class="nav-text">Building SqlSessionFactory from XML</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Working-With-JPA"><span class="nav-number">11.</span> <span class="nav-text">Working With JPA</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Importing-JPA"><span class="nav-number">11.1.</span> <span class="nav-text">Importing JPA</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-JPA"><span class="nav-number">11.2.</span> <span class="nav-text">Using JPA</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Handling-Exceptions-in-Spring-Boot"><span class="nav-number">12.</span> <span class="nav-text">Handling Exceptions in Spring Boot</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Mechanism-1"><span class="nav-number">12.1.</span> <span class="nav-text">Mechanism</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Detailed-Steps"><span class="nav-number">12.1.1.</span> <span class="nav-text">Detailed Steps</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Customizing-your-Error-Pages-with-HTML"><span class="nav-number">12.2.</span> <span class="nav-text">Customizing your Error Pages with HTML</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Customizing-your-Error-Pages-with-JSON"><span class="nav-number">12.3.</span> <span class="nav-text">Customizing your Error Pages with JSON</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Example-ALWAYS-Returning-Customized-JSON"><span class="nav-number">12.3.1.</span> <span class="nav-text">Example: ALWAYS Returning Customized JSON</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Example-Reproducing-HTML-for-Browser"><span class="nav-number">12.3.2.</span> <span class="nav-text">Example: Reproducing HTML for Browser</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Example-Reproducing-HTML-for-Browser-while-Keeping-all-Customized-Data"><span class="nav-number">12.3.3.</span> <span class="nav-text">Example: Reproducing HTML for Browser while Keeping all Customized Data</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Caching-in-Spring-Boot"><span class="nav-number">13.</span> <span class="nav-text">Caching in Spring Boot</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#JSR107-JCache"><span class="nav-number">13.1.</span> <span class="nav-text">JSR107&#x2F;JCache</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Importing-JSR107-API"><span class="nav-number">13.1.1.</span> <span class="nav-text">Importing JSR107 API</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-Cache-Abstraction"><span class="nav-number">13.2.</span> <span class="nav-text">Spring Cache Abstraction</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Importing-Spring-Cache"><span class="nav-number">13.2.1.</span> <span class="nav-text">Importing Spring Cache</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Using-Spring-Cache"><span class="nav-number">13.2.2.</span> <span class="nav-text">Using Spring Cache</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Spring-Implementation"><span class="nav-number">13.2.3.</span> <span class="nav-text">Spring Implementation</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Mechanism-2"><span class="nav-number">13.2.4.</span> <span class="nav-text">Mechanism</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Example-Using-a-Customized-KeyGenerator"><span class="nav-number">13.2.5.</span> <span class="nav-text">Example: Using a Customized KeyGenerator</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Example-Using-Caching"><span class="nav-number">13.2.6.</span> <span class="nav-text">Example: Using @Caching</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Using-CacheConfig"><span class="nav-number">13.2.7.</span> <span class="nav-text">Using @CacheConfig</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-Redis-in-Spring-Cache"><span class="nav-number">13.3.</span> <span class="nav-text">Using Redis in Spring Cache</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Importing-Redis"><span class="nav-number">13.3.1.</span> <span class="nav-text">Importing Redis</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Configuring-your-Redis-Connection"><span class="nav-number">13.3.2.</span> <span class="nav-text">Configuring your Redis Connection</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Using-your-Redis-Templates"><span class="nav-number">13.3.3.</span> <span class="nav-text">Using your Redis Templates</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Introduction-to-Distributed-Computing"><span class="nav-number">14.</span> <span class="nav-text">Introduction to Distributed Computing</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Basic-Mechanism"><span class="nav-number">14.1.</span> <span class="nav-text">Basic Mechanism</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-Spring-Cloud-for-Distributed-Computing"><span class="nav-number">14.2.</span> <span class="nav-text">Using Spring Cloud for Distributed Computing</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Example-Starting-a-Eureka-Server-Registry"><span class="nav-number">14.2.1.</span> <span class="nav-text">Example: Starting a Eureka Server&#x2F;Registry</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Example-Registering-Services-to-Eureka-Server"><span class="nav-number">14.2.2.</span> <span class="nav-text">Example: Registering Services to Eureka Server</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Example-Creating-a-Consumer-User-for-Using-Registered-Services"><span class="nav-number">14.2.3.</span> <span class="nav-text">Example: Creating a Consumer&#x2F;User for Using Registered Services</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Xiao Yu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/learning/archives/">
        
          <span class="site-state-item-count">13</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>
  <div class="sidebar-button motion-element"><i class="fa fa-comment"></i>
    Chat
  </a>
  </div>



      </div>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </header>

      
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


      <div class="main-inner">
        

        <div class="content post posts-expand">
          

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonyux.github.io/2020/06/29/SpringBoot-Manual/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/learning/images/avatar.gif">
      <meta itemprop="name" content="Xiao Yu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="From a Beginner to a Disaster">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Spring Boot Manual
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-06-29 11:35:00" itemprop="dateCreated datePublished" datetime="2020-06-29T11:35:00+08:00">2020-06-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-07-29 15:29:46" itemprop="dateModified" datetime="2020-07-29T15:29:46+08:00">2020-07-29</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <hr>
<p><strong>IMPORTANT</strong>:<br>Some of the content here is a personal summary/abbreviation of contents on the <a href="https://docs.spring.io/spring-boot/docs/2.3.0.RELEASE/reference/html/" target="_blank" rel="noopener">Offical Spring Boot Documentation</a>. Feel free to refer to the official site if you think some of the sections written here are not clear.</p>
<hr>
<h2 id="Spring-Boot-Installation"><a href="#Spring-Boot-Installation" class="headerlink" title="Spring Boot Installation"></a>Spring Boot Installation</h2><p>For instructions on installing and a quick overview of using Spring Boot, please refer to this <a href="https://docs.spring.io/spring-boot/docs/2.3.0.RELEASE/reference/html/getting-started.html#getting-started-installing-spring-boot" target="_blank" rel="noopener">page</a></p>
<h2 id="Structuring-Your-Code"><a href="#Structuring-Your-Code" class="headerlink" title="Structuring Your Code"></a>Structuring Your Code</h2><p>Technically, Spring Boot does not require any specific code layout to work. However, there are <strong>some best practices that help:</strong></p>
<ul>
<li><p>Your <code>main application</code> class:</p>
<ul>
<li><p>It is generally recommend that you locate <strong>your <code>main application</code> class in a root package above other<br>classes.</strong> The <code>@SpringBootApplication</code> annotation is often placed on your main class, and it implicitly<br>defines a base “search package” for certain items</p>
</li>
<li><p>For example, the follwoing structure:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">com</span><br><span class="line">+- example</span><br><span class="line">	+- myapplication</span><br><span class="line">		+- Application.java</span><br><span class="line">		|</span><br><span class="line">		+- customer</span><br><span class="line">		|   +- Customer.java</span><br><span class="line">		|   +- CustomerController.java</span><br><span class="line">		|   +- CustomerService.java</span><br><span class="line">		|   +- CustomerRepository.java</span><br><span class="line">		|</span><br><span class="line">		+- order</span><br><span class="line">			+- Order.java</span><br><span class="line">			+- OrderController.java</span><br><span class="line">			+- OrderService.java</span><br><span class="line">			+- OrderRepository.java</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>Your primary <code>configuration</code> class</p>
<ul>
<li>Although it is possible to use <code>SpringApplication</code> with <code>XML</code> sources, we generally recommend that <strong>your primary source be a single <code>@Configuration</code> class</strong>. Usually the <strong>class that defines the main method is a good candidate as the primary <code>@Configuration</code></strong>.</li>
<li>You can also <strong>import configuration classes</strong>:<ul>
<li>The <strong><code>@Import</code> annotation can be used to import additional configuration classes</strong>. Alternatively, you can <strong>use <code>@ComponentScan</code> to automatically pick up all Spring components</strong>, including <code>@Configuration</code> classes.</li>
</ul>
</li>
<li><strong>Import XML Configuration</strong><ul>
<li>If you need to use an XML based configuration, we recommend that you <strong>still start with a <code>@Configuration</code> class</strong>. You can <strong>then use an <code>@ImportResource</code> annotation</strong> to load XML configuration files.<a id="more"></a>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled="" type="checkbox"> A single <code>@SpringBootApplication</code> annotation can be <strong>used to enable three features</strong>, that is:<ul>
<li><code>@EnableAutoConfiguration</code>: enable Spring Boot’s auto-configuration mechanism, which *<em>imports many <code>xxxAutoConfiguration</code> classes defined by <code>@Import(AutoConfigurationImportSelector.class)</code> *</em>(you will see this when you look at the <code>@EnableAutoConfigurations</code> class). More details see the section below.</li>
<li><code>@ComponentScan</code>: enable <code>@Component</code> scan on the package where the application is located (see the best practices)</li>
<li><code>@Configuration</code>: allow to register extra beans in the context or import additional configuration classes<br>SO, the <code>@SpringBootApplication</code> annotation is <strong>equivalent to using <code>@Configuration</code>, <code>@EnableAutoConfiguration</code>, and <code>@ComponentScan</code> with their default attributes</strong>, as shown in the following example:</li>
</ul>
</li>
</ul>
</blockquote>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.myapplication;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span> <span class="comment">// same as @Configuration @EnableAutoConfiguration @ComponentScan</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(Application<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Auto-Configuration"><a href="#Auto-Configuration" class="headerlink" title="Auto-Configuration"></a>Auto-Configuration</h3><p>(additional reference: <a href="https://www.javatpoint.com/spring-boot-auto-configuration" target="_blank" rel="noopener">https://www.javatpoint.com/spring-boot-auto-configuration</a>)</p>
<p>You can also choose to use the Spring Boot <code>auto-configuration</code>, which attempts to automatically configure your Spring application based on the jar dependencies that you have added.</p>
<p>For example, if the H2 database Jar is <strong>present in the classpath and we have not configured any beans</strong> related to the database manually, the Spring Boot’s auto-configuration feature automatically configures it in the project.</p>
<p>To enable <code>auto-configuration</code>, you need to <strong>add either <code>@EnableAutoConfiguration</code> or <code>@SpringBootApplication</code> annotations to one of your <code>@Configuration</code> classes</strong>.</p>
<h4 id="EnableAutoConfiguration-under-the-hood"><a href="#EnableAutoConfiguration-under-the-hood" class="headerlink" title="EnableAutoConfiguration under the hood"></a><code>EnableAutoConfiguration</code> under the hood</h4><ol>
<li><p>When you click into the <code>@EnableAutoConfiguration</code> annotation, you will see that it imports the <code>AutoConfigurationImportSelector.class</code>. </p>
</li>
<li><p>Within that class, it uses the method <code>List&lt;String&gt; configurations = SpringFactoriesLoader.loadFactoryNames(..)</code> to return to your configurations that will be imported into your application.</p>
</li>
<li><p>When you click into that method <code>loadFactoryNames()</code>, you will see the line: <strong><code>classLoader.getResources(FACTORIES_RESOURCE_LOCATION)</code>, where that <code>Factories_RESOURCE_LOCATION</code></strong> points to: <code>\.m2\repository\org\springframework\boot\spring-boot-autoconfigure\2.3.0.RELEASE\spring-boot-autoconfigure-2.3.0.RELEASE.jar!\META-INF\spring.factories</code></p>
</li>
<li><p>The <strong><code>xxxAutoConfiguration</code> classes specified in that <code>spring.factories</code></strong> file will be loaded into your application, if <strong>conditions</strong> specified in those classes are fulfilled (e.g. <code>@ConditionalOnMissingProperties(..)</code>)</p>
</li>
<li><p>And it is <strong>those  <code>xxxAutoConfiguration</code> classes</strong> that configures your Spring Boot Application by reading/injecting values from their respective <code>.properties</code> file.  This means that you can <strong>configure those settings in your own <code>application.properties</code> file with the correct prefix</strong></p>
</li>
</ol>
<h4 id="Viewing-Loaded-AutoConfiguration-Classes"><a href="#Viewing-Loaded-AutoConfiguration-Classes" class="headerlink" title="Viewing Loaded AutoConfiguration Classes"></a>Viewing Loaded AutoConfiguration Classes</h4><p>Though you could manually look into each AutoConfiguration class to know whether if it will be loaded, there is an easier way to do so. </p>
<ol>
<li>You need to enable the <code>debug</code> mode for your application. This can be done by specifying: <code>debug=true</code> in your <code>application.properties</code> or <code>application.yml</code></li>
<li>Then, if you run your application, you will see, inside the console, the section <code>Auto-Configuration Report</code>, which will tell you all the AutoConfiguration classes that are loaded or not loaded</li>
</ol>
<h4 id="Disabling-an-AutoConfiguration-Class"><a href="#Disabling-an-AutoConfiguration-Class" class="headerlink" title="Disabling an AutoConfiguration Class"></a>Disabling an AutoConfiguration Class</h4><p>However, if you find that specific auto-configuration classes that you do not want are being applied, you can also specify to disable <strong>disable the specific auto-configuration classes</strong>. We <strong>use the <code>exclude</code> attribute of the annotation <code>@EnableAutoConfiguration</code></strong> to disable the auto-configuration classes. For example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.*;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.jdbc.*;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span>(proxyBeanMethods = <span class="keyword">false</span>)  </span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span>(exclude=&#123;DataSourceAutoConfiguration<span class="class">.<span class="keyword">class</span>&#125;)  </span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">MyConfiguration</span></span>&#123;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We can <strong>use the attribute <code>excludeName</code></strong> of the annotation <code>@EnableAutoConfiguration</code> and specify the qualified name of the class, <strong>if the class is not on the class path</strong>. We can exclude any number of auto-configuration classes by using the property <code>spring.autoconfigure.exclude</code>.</p>
<p>This is also supported if you use the <code>@SpringBootApplication</code> annotation:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.jdbc.*;</span><br><span class="line"><span class="meta">@SpringBootApplication</span>(exclude=&#123;DataSourceAutoConfiguration<span class="class">.<span class="keyword">class</span>&#125;)  // <span class="title">also</span> <span class="title">supported</span></span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">MyApplication</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Spring-Beans-and-Dependency-Injection-in-Spring-Boot"><a href="#Spring-Beans-and-Dependency-Injection-in-Spring-Boot" class="headerlink" title="Spring Beans and Dependency Injection in Spring Boot"></a>Spring Beans and Dependency Injection in Spring Boot</h3><p>You are free to use any of the standard <strong>Spring Framework techniques</strong> to define your beans and their injected dependencies. For simplicity, we often find that <strong>using <code>@ComponentScan</code> (to find your beans) and using <code>@Autowired</code> (to do constructor injection) works well</strong>. If you structure your code as suggested above <strong>(locating your application class in a root package), you can add <code>@ComponentScan</code> without any arguments, as it will automatically scan all component classes in current package and all its subpackages</strong>. All of your application components (<code>@Component</code>, <code>@Service</code>, <code>@Repository</code>, <code>@Controller</code> etc.) are automatically registered as Spring Beans.</p>
<p>For example, if you have in your sub-package a <code>@Service</code> as shown below, it will be automatically included in the configuration:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DatabaseAccountService</span> <span class="keyword">implements</span> <span class="title">AccountService</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> RiskAssessor riskAssessor;  <span class="comment">// Notice this will be final</span></span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">DatabaseAccountService</span><span class="params">(RiskAssessor riskAssessor)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.riskAssessor = riskAssessor;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Notice how <strong>using constructor injection lets the <code>riskAssessor</code> field be marked as <code>final</code></strong>, indicating that the reference to that <code>riskAssessor</code> object cannot be subsequently changed (mutator methods of that object can still be used, of course).</p>
<h2 id="Running-Your-Application"><a href="#Running-Your-Application" class="headerlink" title="Running Your Application"></a>Running Your Application</h2><p>One of the biggest advantages of <strong>packaging your application as a jar</strong> and using an embedded HTTP server is that you can run your application as you would any other. Debugging Spring Boot applications is also easy. You do not need any special IDE plugins or extensions.</p>
<p>If you use the Spring Boot Maven or Gradle plugins to create an executable <code>jar</code>, you can <strong>run your application using <code>java -jar</code></strong>, as shown in the following example: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar target&#x2F;myapplication-0.0.1-SNAPSHOT.jar</span><br></pre></td></tr></table></figure>

<p>It is also possible to run a packaged application with remote debugging support enabled. Doing so lets you attach a debugger to your packaged application, as shown in the following example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ java -Xdebug -Xrunjdwp:server&#x3D;y,transport&#x3D;dt_socket,address&#x3D;8000,suspend&#x3D;n \</span><br><span class="line">-jar target&#x2F;myapplication-0.0.1-SNAPSHOT.jar</span><br></pre></td></tr></table></figure>

<h3 id="Compiling-and-Running-using-Maven-Plugin"><a href="#Compiling-and-Running-using-Maven-Plugin" class="headerlink" title="Compiling and Running using Maven Plugin"></a>Compiling and Running using Maven Plugin</h3><p>The Spring Boot Maven plugin includes a <code>run</code> goal that can be used to quickly compile and run your application. Applications run in an exploded form, as they do in your IDE. The following example shows a typical Maven command to run a Spring Boot application:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mvn spring-boot:run</span><br></pre></td></tr></table></figure>

<p>You might also want to use the <code>MAVEN_OPTS</code> operating system environment variable, as shown in the following example:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">export</span> MAVEN_OPTS=-Xmx1024m</span><br></pre></td></tr></table></figure>

<p>where:</p>
<ul>
<li><code>-Xmx1024m</code> specifies the maximum size, in bytes, of the memory allocation pool. This value must <strong>a multiple of 1024 greater than 2 MB</strong>. Append the letter <code>k</code> or <code>K</code> to indicate kilobytes, or <code>m</code> or <code>M</code> to indicate megabytes. The default value is chosen at runtime based on system configuration.</li>
</ul>
<h3 id="Packaging-Your-Spring-Boot-Project"><a href="#Packaging-Your-Spring-Boot-Project" class="headerlink" title="Packaging Your Spring Boot Project"></a>Packaging Your Spring Boot Project</h3><p>You can use the plugin <code>spring-boot-maven-plugin</code> within the <code>build</code> section of your <code>POM</code> file to enable proper packaging for your Spring Boot project. This will package the project into a <code>jar</code> file, which can later be deployed easily on a server.</p>
<p>To do this, you need to include the section:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Assuming that you have already included the parent pom setting, which specifies the default plugin versions for you --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Now, you can just run the command <code>mvn package</code> (or the equivalent in IntelliJ or Eclipse) to package your Spring Boot project.</p>
<p>Finally, to run your package<code>jar</code> file, you can use <code>java -jar &lt;your-packaged-jar-file&gt;</code>.</p>
<blockquote>
<p> Note:</p>
<ul>
<li><input disabled="" type="checkbox"> When running your Spring Boot application, notice that it used <code>TomCat</code> for configuring your server. This is done by Spring Boot even if we did not specify it to do so. Therefore, by packaging via the steps mentioned above, <strong>those <code>TomCat</code> and other necessary dependencies will be automatically packaged in your <code>META_INF/lib</code> folder within your <code>jar</code> file</strong>.</li>
</ul>
</blockquote>
<h2 id="Developer-Tools"><a href="#Developer-Tools" class="headerlink" title="Developer Tools"></a>Developer Tools</h2><p>Spring Boot includes an additional set of tools that can make the application development experience a little more pleasant. The <code>spring-boot-devtools module</code> can be included in any project to <strong>provide additional development-time features</strong>.</p>
<p>For example, if you have worked on latest UI development frameworks e.g. <code>Node</code>, <code>angular</code>, <code>gulp</code> etc. then you must have appreciated the <strong>auto-reload of UI in browser</strong> whenever there is <strong>change in some code</strong>. Its pretty useful and saves a lot of time.</p>
<p>Well, <strong>same feature can be utilized in spring boot applications using <code>spring-boot-devtools</code> dependency provided features</strong>.</p>
<h3 id="Enabling-spring-boot-devtools"><a href="#Enabling-spring-boot-devtools" class="headerlink" title="Enabling spring-boot-devtools"></a>Enabling <code>spring-boot-devtools</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">	&lt;dependency&gt;</span><br><span class="line">		&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">		&lt;artifactId&gt;spring-boot-devtools&lt;&#x2F;artifactId&gt;</span><br><span class="line">		&lt;optional&gt;true&lt;&#x2F;optional&gt;</span><br><span class="line">	&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;&#x2F;dependencies&gt;</span><br></pre></td></tr></table></figure>

<p>where we flagged the dependency as <code>optional</code> because:</p>
<ul>
<li>Flagging the <strong>dependency as <code>optional</code> in maven</strong> (as shown above) <strong>prevents devtools from being transitively applied to other modules</strong> that use your project.</li>
</ul>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled="" type="checkbox"> <strong>Developer tools are automatically disabled when running a fully packaged application</strong>. If your application is launched from <code>java -jar</code> or if it is started from a special classloader, then it is considered a “production application”. If that does not apply to you (i.e. if you run your application from a container), consider excluding devtools or set the <code>-Dspring.devtools.restart.enabled=false</code> system property.</li>
</ul>
</blockquote>
<h3 id="Configuring-your-spring-boot-devtools"><a href="#Configuring-your-spring-boot-devtools" class="headerlink" title="Configuring your spring-boot-devtools"></a>Configuring your <code>spring-boot-devtools</code></h3><p>(additional reference: <a href="https://howtodoinjava.com/spring-boot2/developer-tools-module-tutorial/#:~:text=The%20spring%2Dboot%2Ddevtools%20module,default%2C%20live%20reload%20is%20enabled" target="_blank" rel="noopener">https://howtodoinjava.com/spring-boot2/developer-tools-module-tutorial/#:~:text=The%20spring%2Dboot%2Ddevtools%20module,default%2C%20live%20reload%20is%20enabled</a>)</p>
<p>To improve the performance, <strong>dev tools cache the static content/template files to serve them faster to browser/client</strong>. This is <strong>very good feature in production</strong> where every milli-second performance improvement matters. But <strong>in development environment, it can be a problem and cause stale cache problem</strong> and you may not see your changes immediatly in browser. For this reason, <code>springboot-devtools</code> <strong>disables the caching options by default</strong>.</p>
<p>Also, because you need more information about web requests while developing Spring MVC and Spring WebFlux applications, <strong>developer tools will enable <code>DEBUG</code> logging for the web logging group</strong>. This will give you <strong>information about the incoming request, which handler is processing it, the response outcome, etc</strong>.</p>
<p>More importantly, you can also <strong>configure the <code>springboot-devtools</code> to meet your own needs</strong>:</p>
<ol>
<li><p>You can enable the static caching to use in production environment by setting a property:</p>
 <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># inside application.properties</span></span><br><span class="line"><span class="meta">spring.freemarker.cache</span> = <span class="string">true 	# false by default in production environment</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Other such properties</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># spring.thymeleaf.cache = false</span></span><br><span class="line"><span class="comment"># spring.mustache.cache = false</span></span><br><span class="line"><span class="comment"># spring.groovy.template.cache = false</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>If you wish to log all request details (including potentially sensitive information), you can turn on the <code>spring.mvc.log-request-details</code> or <code>spring.codec.log-request-details</code> configuration properties.</p>
 <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># inside application.properties</span></span><br><span class="line"><span class="meta">spring.mvn.log-request-details</span> = <span class="string">true 	# or spring.codec.log-request-details = true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>The <code>spring-boot-devtools</code> module <strong>includes an embedded LiveReload server that can be used to trigger a browser refresh when a resource is changed</strong>. Precondition is that your browser should have supported extention for it. You can find such browser extentions in this <a href="https://livereload.com/extensions/" target="_blank" rel="noopener">link</a>.</p>
<p> <strong>By default, live reload is enabled</strong>. If you wish to disable this feature for some reason, then set <code>sping.devtools.livereload.enabled</code> property to <code>false</code>.</p>
 <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#inside application.properties</span></span><br><span class="line"><span class="meta">spring.devtools.livereload.enabled</span>  = <span class="string">false 	# Set false to disable live reload</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>For a complete list of the properties that are applied by the devtools, see <a href="https://github.com/spring-projects/spring-boot/tree/v2.3.0.RELEASE/spring-boot-project/spring-boot-devtools/src/main/java/org/springframework/boot/devtools/env/DevToolsPropertyDefaultsPostProcessor.java" target="_blank" rel="noopener">DevToolsPropertyDefaultsPostProcessor</a>.</p>
</li>
</ol>
<h3 id="Automatic-Reload"><a href="#Automatic-Reload" class="headerlink" title="Automatic Reload"></a>Automatic Reload</h3><p>The automatic reload has been introduced in the section above, which triggers a browser refresh when a resource is changed. By default, it is triggered on these paths:</p>
<ul>
<li><code>/META-INF/maven</code></li>
<li><code>/META-INF/resources</code></li>
<li><code>/resources</code></li>
<li><code>/static</code></li>
<li><code>/public</code></li>
<li><code>/templates</code></li>
</ul>
<p>If you want to <strong>disable auto-reload in browser for files in few of these paths</strong>, then use <code>spring.devtools.restart.exclude property</code>. For example:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.devtools.restart.exclude</span>=<span class="string">static/**,public/**</span></span><br></pre></td></tr></table></figure>

<p>If you want to <strong>watch those addtional files/paths not in the default list</strong> to reload the application, use the <code>spring.devtools.restart.additional-paths</code> property.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.devtools.restart.additional-paths&#x3D;script&#x2F;**</span><br></pre></td></tr></table></figure>

<p>Similarily, If you want to <strong>exclude those additional paths</strong>, use the <code>spring.devtools.restart.additional-exclude property</code>.</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.devtools.restart.additional-exclude</span>=<span class="string">styles/**</span></span><br></pre></td></tr></table></figure>

<h3 id="Automatic-Restart"><a href="#Automatic-Restart" class="headerlink" title="Automatic Restart"></a>Automatic Restart</h3><p>Auto-restart means <strong>reloading the java classes and consiguration at server side</strong>. After the server side changes are re-deployed dynamically, server restart happen and load the modified code and configutation.</p>
<p>This can be a useful feature when working in an IDE, as it gives a very fast feedback loop for code changes. By default, <strong>any entry on the classpath that points to a directory is monitored for changes</strong>. Note that certain resources, such as <strong>static assets and view templates, do not need to restart the application (these would be more appropriate for auto-reload)</strong>.</p>
<p>As DevTools monitors classpath resources, the <strong>only way to trigger a restart is to update the classpath</strong>. The way in which you cause the classpath to be updated depends on the IDE that you are using. In Eclipse, saving a modified file causes the classpath to be updated and triggers a restart. <strong>In IntelliJ IDEA, building the project (Build → Build Project) triggers the restart</strong>.</p>
<p>In general, <strong>automatic restart works very well when used with LiveReload</strong>. See the <a href="#LiveReload">LiveReload</a> section for details. If you use JRebel, automatic restarts are disabled in favor of dynamic class reloading. Other devtools features (such as LiveReload and property overrides) can still be used.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled="" type="checkbox"> DevTools relies on the application context’s shutdown hook to close it during a restart. It does not work correctly if you have disabled the shutdown hook (<code>SpringApplication.setRegisterShutdownHook(false)</code>).</li>
</ul>
</blockquote>
<p><strong>To enable/disable automatic restart</strong>, you could use the property <code>spring.devtools.restart.enabled</code>:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># inside application.properties</span><br><span class="line">spring.devtools.restart.enabled = false 	# disables restart. Set to true to enable it</span><br></pre></td></tr></table></figure>

<p><strong>To enable/disable logging of auto-configuration changes</strong>, you need to use <code>pring.devtools.restart.log-condition-evaluation-delta</code>. <strong>By default, each time your application restarts, a report showing the condition evaluation delta is logged</strong>. The report shows the changes to your application’s auto-configuration as you make changes such as adding or removing beans and setting configuration properties.</p>
<p>To disable the logging of the report, set the following property:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># inside application.properties</span><br><span class="line">spring.devtools.restart.log-condition-evaluation-delta = false 		# set to true to enable it</span><br></pre></td></tr></table></figure>

<p>Doing so still <strong>initializes the restart classloader</strong>, but it does not watch for file changes.</p>
<p>If you need to <strong>completely disable restart support</strong> (for example, because it does not work with a specific library), you need to set the <strong><code>spring.devtools.restart.enabled</code> System property to <code>false</code> before calling <code>SpringApplication.run(…)</code></strong>, as shown in the following example: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">	System.setProperty(<span class="string">"spring.devtools.restart.enabled"</span>, <span class="string">"false"</span>);</span><br><span class="line">	SpringApplication.run(MyApp<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>To trigger a restart with a Trigger File</strong>, you need to set the property <code>spring.devtools.restart.trigger-file</code>. This is useful if automatic restarts may not be desirable on every file change and sometimes can slower down development time due to frequent restarts. To solve this problem, you can use a trigger file. <strong>Spring boot will keep monitoring that file and once it will detect any modification in that file, it will restart the server and reload all your previous changes</strong>.</p>
<p>To use a trigger file, <strong>set the <code>spring.devtools.restart.trigger-file</code> property to the name (excluding<br>any path) of your trigger file</strong>. The trigger file <strong>must appear somewhere on your classpath</strong>.</p>
<p>For example, if you have a project with the following structure:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">src</span><br><span class="line">+- main</span><br><span class="line">	+- resources</span><br><span class="line">		+- .reloadtrigger</span><br></pre></td></tr></table></figure>

<p>Then your trigger-file property would be:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.devtools.restart.trigger-file=.reloadtrigger</span><br></pre></td></tr></table></figure>

<p>Restarts <strong>will now only happen when the <code>src/main/resources/.reloadtrigger</code> is updated</strong>.</p>
<p>Some IDEs have features that save you from needing to update your trigger file manually. For IntelliJ, you can follow the instructions in <a href="https://www.jetbrains.com/help/idea/spring-boot.html#configure-application-update-policies-with-devtools" target="_blank" rel="noopener">their documentation</a>.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled="" type="checkbox"> You might want to <strong>set <code>spring.devtools.restart.trigger-file</code> as a global setting (adding a <code>spring-boot-devtools.properties</code> file to <code>$HOME/.config/spring-boot</code> directory, for example)</strong>, so that all your projects behave in the same way.</li>
</ul>
</blockquote>
<h3 id="Auto-Reload-vs-Auto-Restart"><a href="#Auto-Reload-vs-Auto-Restart" class="headerlink" title="Auto-Reload vs Auto-Restart"></a>Auto-Reload vs Auto-Restart</h3><p><strong>Auto-reload</strong> (or auto-refresh) refer to <strong>UI reload at browser to see static content changes</strong>. <strong>Auto-restart</strong> is referred to <strong>reloading the server side code and configurations</strong> followed by server restart.</p>
<p>The <strong>restart technology provided by Spring Boot works by using two classloaders</strong>. Classes that do not change (for example, those from third-party jars) are loaded into a base classloader. Classes that you are actively developing are loaded into a restart classloader. When the application is restarted, <strong>the restart classloader is thrown away and a new one is created</strong>. This approach means that application <strong>restarts are typically much faster than “cold starts”</strong>, since the base classloader is already available and populated.</p>
<p>If you find that** restarts are not quick enough for your applications or you encounter classloading issues<strong>, you **could consider reloading</strong> technologies such as JRebel from ZeroTurnaround. These work by rewriting classes as they are loaded to make them more amenable to reloading.</p>
<h3 id="Customizing-the-Restart-Classloader"><a href="#Customizing-the-Restart-Classloader" class="headerlink" title="Customizing the Restart Classloader"></a>Customizing the Restart Classloader</h3><p><strong>By default</strong>, any <strong>open project in your IDE is loaded with the “restart” classloader</strong>, and <strong>any regular <code>.jar</code> file is loaded with the “base” classloader</strong>. If you work on a multi-module project, and not every module is imported into your IDE, you may need to customize things. To do so, you can create a <code>META-INF/spring-devtools.properties</code> file.</p>
<p>The <code>spring-devtools.properties</code> file can contain properties prefixed with <code>restart.exclude</code> and <code>restart.include</code>. <strong>The <code>include</code> elements</strong> are items that should be** pulled up into the “restart” classloader<strong>, and the **<code>exclude</code> elements</strong> are items that should be <strong>pushed down into the “base” classloader</strong>. The <strong>value of the property is a regex pattern that is applied to the classpath, as shown in the following example:</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">restart.exclude.companycommonlibs=/mycorp-common-[\\w\\d-\.]+\.jar</span><br><span class="line">restart.include.projectcommon=/mycorp-myproj-[\\w\\d-\.]+\.jar</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled="" type="checkbox"> Restart functionality <strong>does not work well with objects that are deserialized</strong> by using a standard <code>ObjectInputStream</code>. If you need to deserialize data, you may need to use Spring’s <code>ConfigurableObjectInputStream</code> in combination with <code>Thread.currentThread().getContextClassLoader()</code>.</li>
</ul>
</blockquote>
<p><a name="LiveReload"></a></p>
<h3 id="LiveReload"><a href="#LiveReload" class="headerlink" title="LiveReload"></a>LiveReload</h3><p>The <strong><code>spring-boot-devtools</code> module includes an embedded LiveReload server that can be used to trigger a browser refresh when a resource is changed</strong>. LiveReload browser extensions are freely available for Chrome, Firefox and Safari from livereload.com.</p>
<p>If you do not want to start the LiveReload server when your application runs, you can set the<br><code>spring.devtools.livereload.enabled</code> property to <code>false</code>.</p>
<p>However, note that <strong>you can only run one LiveReload server at a time</strong>. Before starting your application, ensure that no other LiveReload servers are running. If you start multiple applications from your IDE, only the first has LiveReload support.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled="" type="checkbox"> <strong>In Intellij</strong>, you might need to configure some settings to make this feature available. For more details, please follow the link: <a href="https://mkyong.com/spring-boot/intellij-idea-spring-boot-template-reload-is-not-working/" target="_blank" rel="noopener">https://mkyong.com/spring-boot/intellij-idea-spring-boot-template-reload-is-not-working/</a></li>
</ul>
</blockquote>
<h3 id="Configure-your-File-System-Watcher"><a href="#Configure-your-File-System-Watcher" class="headerlink" title="Configure your File System Watcher"></a>Configure your File System Watcher</h3><p>If you find that there are times when certain <strong>changes are not reflected</strong> when devtools restarts the application, you might need to configure your File System Watcher.</p>
<p>FileSystemWatcher works by polling the class changes with a certain time interval, and then waiting for a predefined quiet period to make sure there are no more changes. So if you find that certain changes are not     reflected, try increasing the <code>spring.devtools.restart.poll-interval</code> and <code>spring.devtools.restart.quiet-period</code> parameters to the values that fit your development environment:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.devtools.restart.poll-interval=2s</span><br><span class="line">spring.devtools.restart.quiet-period=1s</span><br></pre></td></tr></table></figure>

<p>The monitored classpath directories are now <strong>polled every 2 seconds for changes</strong>, and a <strong>1 second quiet period is maintained</strong> to make sure there are no additional class changes.</p>
<h3 id="Global-Settings-File"><a href="#Global-Settings-File" class="headerlink" title="Global Settings File"></a>Global Settings File</h3><p>You can configure <strong>global devtools settings</strong> by adding any of the following files to the <code>$HOME/.config/spring-boot directory</code>:</p>
<ol>
<li>spring-boot-devtools.properties</li>
<li>spring-boot-devtools.yaml</li>
<li>spring-boot-devtools.yml</li>
</ol>
<p>Any <strong>properties added to these file apply to all Spring Boot applications on your machine that use devtools.</strong> For example, to configure restart to always use a trigger file, you would add the following property:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># inside ~/.config/spring-boot/spring-boot-devtools.properties </span><br><span class="line">spring.devtools.restart.trigger-file=.reloadtrigger</span><br></pre></td></tr></table></figure>

<h3 id="Remote-Applications"><a href="#Remote-Applications" class="headerlink" title="Remote Applications"></a>Remote Applications</h3><p>The Spring Boot developer tools are not limited to local development. You can also use several features when running applications remotely. Remote support is opt-in as enabling it can be a security risk. It should only be enabled when running on a trusted network or when secured with SSL.</p>
<p>To enable it, you need to make sure that <code>devtools</code> is included in the repackaged archive, as shown in<br>the following listing:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">	&lt;plugins&gt;</span><br><span class="line">		&lt;plugin&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-maven-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">			&lt;configuration&gt;</span><br><span class="line">				&lt;excludeDevtools&gt;false&lt;&#x2F;excludeDevtools&gt;</span><br><span class="line">			&lt;&#x2F;configuration&gt;</span><br><span class="line">		&lt;&#x2F;plugin&gt;</span><br><span class="line">	&lt;&#x2F;plugins&gt;</span><br><span class="line">&lt;&#x2F;build&gt;</span><br></pre></td></tr></table></figure>
<p>Then you need to set the <code>spring.devtools.remote.secret</code> property. Like any important password or secret, the value <strong>should be unique and strong such that it cannot be guessed or brute-forced</strong>.</p>
<p>Then, to run the remote application within your IDE, you need to run <code>org.springframework.boot.devtools.RemoteSpringApplication</code> with the <strong>same classpath as the remote project that you connect to</strong>. The application’s single <strong>required argument is the remote URL</strong> to which it connects.</p>
<p>For example, if you are using Eclipse or STS and you have a project named <code>my-app</code> that you have deployed to Cloud Foundry, you would do the following:</p>
<ul>
<li>Select <code>Run Configurations…</code> from the Run menu.</li>
<li>Create a new <code>Java Application</code> “launch configuration”.</li>
<li>Browse for the <code>my-app</code> project.</li>
<li>Use <code>org.springframework.boot.devtools.RemoteSpringApplication</code> as the main class.</li>
<li>Add <code>https://myapp.cfapps.io</code> to the Program arguments (or whatever your remote URL is).</li>
</ul>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled="" type="checkbox"> Because the <strong>remote client is using the same classpath as the real application it can directly read application properties</strong>. This is how the** <code>spring.devtools.remote.secret</code> property is read and passed to the server for authentication**.</li>
<li><input disabled="" type="checkbox"> It is always advisable to use <code>https://</code> as the connection protocol, so that traffic is encrypted and passwords cannot be intercepted.</li>
</ul>
</blockquote>
<h3 id="Updates-in-your-Remote-Application"><a href="#Updates-in-your-Remote-Application" class="headerlink" title="Updates in your Remote Application"></a>Updates in your Remote Application</h3><p>The <strong>remote client monitors your application classpath for changes in the same way as the local restart</strong>. Any updated resource is pushed to the remote application and (if required) triggers a restart. This can be helpful if you iterate on a feature that uses a cloud service that you do not have locally. Generally, remote updates and restarts are much quicker than a full rebuild and deploy cycle.</p>
<p>On a slower development environment, it may happen that the <strong>quiet period is not enough</strong>, and the <strong>changes in the classes may be split into batches</strong>. The server is <strong>restarted after the first batch of class changes is uploaded</strong>. The next batch can’t be sent to the application, since the server is restarting. This is typically manifested by <strong>a warning in the <code>RemoteSpringApplication</code> logs about failing to upload some of the classes, and a consequent retry</strong>. But it may also lead to application code inconsistency and failure to restart after the first batch of changes is uploaded. If you observe such problems constantly, try increasing the <code>spring.devtools.restart.poll-interval</code> and <code>spring.devtools.restart.quiet-period</code> parameters to the values that fit your development environment.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled="" type="checkbox"> Files are <strong>only monitored when the remote client is running</strong>. If you change a file before starting the remote client, it is not pushed to the remote server.</li>
</ul>
</blockquote>
<h2 id="Spring-Boot-Features"><a href="#Spring-Boot-Features" class="headerlink" title="Spring Boot Features"></a>Spring Boot Features</h2><hr>
<p>The SpringApplication class provides a convenient way to bootstrap a Spring application that is started from a <code>main()</code> method. In many situations, you can <strong>delegate to the <code>static SpringApplication.run</code> method</strong>, as shown in the following example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">	SpringApplication.run(MySpringConfiguration<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>When your application starts, you should see something similar to the following output:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">  .   ____          _            __ _ _</span><br><span class="line"> &#x2F;\\ &#x2F; ___&#39;_ __ _ _(_)_ __  __ _ \ \ \ \</span><br><span class="line">( ( )\___ | &#39;_ | &#39;_| | &#39;_ \&#x2F; _&#96; | \ \ \ \</span><br><span class="line"> \\&#x2F;  ___)| |_)| | | | | || (_| |  ) ) ) )</span><br><span class="line">  &#39;  |____| .__|_| |_|_| |_\__, | &#x2F; &#x2F; &#x2F; &#x2F;</span><br><span class="line"> &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;|_|&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;|___&#x2F;&#x3D;&#x2F;_&#x2F;_&#x2F;_&#x2F;</span><br><span class="line"> :: Spring Boot ::        (v2.3.0.RELEASE)</span><br><span class="line"></span><br><span class="line">2020-06-16 15:35:35.216  INFO 47936 --- [  restartedMain] App                                      : Starting App on XY-Laptop with PID 47936 (E:\Maven Workspace\testSpringBoot\target\classes started by 26238 in E:\Maven Workspace\testSpringBoot)</span><br><span class="line">2020-06-16 15:35:35.218  INFO 47936 --- [  restartedMain] App                                      : No active profile set, falling back to default profiles: default</span><br><span class="line">2020-06-16 15:35:35.248  INFO 47936 --- [  restartedMain] .e.DevToolsPropertyDefaultsPostProcessor : Devtools property defaults active! Set &#39;spring.devtools.add-properties&#39; to &#39;false&#39; to disable</span><br><span class="line">2020-06-16 15:35:35.248  INFO 47936 --- [  restartedMain] .e.DevToolsPropertyDefaultsPostProcessor : For additional web related logging consider setting the &#39;logging.level.web&#39; property to &#39;DEBUG&#39;</span><br><span class="line">2020-06-16 15:35:36.345  INFO 47936 --- [  restartedMain] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8080 (http)</span><br><span class="line">2020-06-16 15:35:36.351  INFO 47936 --- [  restartedMain] o.apache.catalina.core.StandardService   : Starting service [Tomcat]</span><br><span class="line">2020-06-16 15:35:36.351  INFO 47936 --- [  restartedMain] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat&#x2F;9.0.35]</span><br><span class="line">2020-06-16 15:35:36.399  INFO 47936 --- [  restartedMain] o.a.c.c.C.[Tomcat].[localhost].[&#x2F;]       : Initializing Spring embedded WebApplicationContext</span><br><span class="line">2020-06-16 15:35:36.399  INFO 47936 --- [  restartedMain] o.s.web.context.ContextLoader            : Root WebApplicationContext: initialization completed in 1151 ms</span><br><span class="line">2020-06-16 15:35:36.504  INFO 47936 --- [  restartedMain] o.s.s.concurrent.ThreadPoolTaskExecutor  : Initializing ExecutorService &#39;applicationTaskExecutor&#39;</span><br><span class="line">2020-06-16 15:35:36.588  INFO 47936 --- [  restartedMain] o.s.b.d.a.OptionalLiveReloadServer       : LiveReload server is running on port 35729</span><br><span class="line">2020-06-16 15:35:36.623  INFO 47936 --- [  restartedMain] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path &#39;&#39;</span><br><span class="line">2020-06-16 15:35:36.630  INFO 47936 --- [  restartedMain] App                                      : Started App in 1.652 seconds (JVM running for 1.947)</span><br></pre></td></tr></table></figure>

<h3 id="Startup-Failures"><a href="#Startup-Failures" class="headerlink" title="Startup Failures"></a>Startup Failures</h3><p>If your application fails to start, registered <code>FailureAnalyzers</code> get a chance to <strong>provide a dedicated error message and a concrete action to fix the problem</strong>. For instance, if you start a web application on port 8080 and that port is already in use, you should see something similar to the following message:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">***************************</span><br><span class="line">APPLICATION FAILED TO START</span><br><span class="line">***************************</span><br><span class="line">Description:</span><br><span class="line">Embedded servlet container failed to start. Port 8080 was already in use.</span><br><span class="line">Action:</span><br><span class="line">Identify and stop the process that&#39;s listening on port 8080 or configure this</span><br><span class="line">application to listen on another port.</span><br></pre></td></tr></table></figure>

<p>If no failure analyzers are able to handle the exception, you can still display the full conditions report to better understand what went wrong. To do so, you need to enable the debug property or enable <code>DEBUG</code> logging for <code>org.springframework.boot.autoconfigure.logging.ConditionEvaluationReportLoggingListener</code>.</p>
<p>For instance, <strong>if you are running your application by using <code>java -jar</code></strong>, you can enable the debug<br>property as follows:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar myproject<span class="number">-0.0</span><span class="number">.1</span>-SNAPSHOT.jar --debug</span><br></pre></td></tr></table></figure>

<h3 id="Lazy-Initialization"><a href="#Lazy-Initialization" class="headerlink" title="Lazy Initialization"></a>Lazy Initialization</h3><p><code>SpringApplication</code> allows an application to be <strong>initialized lazily (similar to that of the Spring Framework)</strong>. When lazy initialization is enabled, <strong>beans are created as they are needed rather than during application startup</strong>. As a result, enabling <strong>lazy initialization can reduce the time that it takes your application to start</strong>. In a web application, enabling lazy initialization will result in many web-related beans not being initialized until an HTTP request is received.</p>
<p>A downside of lazy initialization is that <strong>it can delay the discovery of a problem with the application</strong>. If a misconfigured bean is initialized lazily, a failure will no longer occur during startup and the problem will only become apparent when the bean is initialized. Care must also be taken to ensure that the <strong>JVM has sufficient memory to accommodate all of the application’s beans and not just those that are initialized during startup</strong>.</p>
<p>To enable lazy initialization, you can use:</p>
<ul>
<li>the <code>lazyInitialization</code> method on <code>SpringApplicationBuilder</code></li>
<li>the <code>setLazyInitialization</code> method on <code>SpringApplication</code></li>
<li>it can be enabled using the <code>spring.main.lazy-initialization</code> property, for example: <code>spring.main.lazy-initialization=true</code></li>
<li>or you can set a specific bean to be lazy initialized with <code>@Lazy(true)</code>, or at a class level with <code>@Lazy</code> (making all beans of that class to be lazily initialized)</li>
</ul>
<h3 id="Customzing-your-SpringApplication"><a href="#Customzing-your-SpringApplication" class="headerlink" title="Customzing your SpringApplication"></a>Customzing your SpringApplication</h3><p>If the <code>SpringApplication</code> defaults are** not to your taste, you can instead create a local instance** and customize it. For example, to turn off the banner (more details on customzing your banner, please visit this <a href="https://docs.spring.io/spring-boot/docs/2.3.1.RELEASE/reference/html/spring-boot-features.html#boot-features-banner" target="_blank" rel="noopener">link</a>), you could write:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">	SpringApplication app = <span class="keyword">new</span> SpringApplication(MySpringConfiguration<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">	app.setBannerMode(Banner.Mode.OFF);</span><br><span class="line">	app.run(args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>It is also possible to configure the <code>SpringApplication</code> by using an <code>application.properties</code> file. See <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-external-config" target="_blank" rel="noopener">Externalized Configuration</a> for details.</p>
<p>When deployed on platforms, applications can provide information about their availability to the platform using infrastructure such as <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/" target="_blank" rel="noopener">Kubernetes Probes</a>. Spring Boot includes out-of-the box <strong>support for the commonly used “liveness” and “readiness” availability states</strong>. If you are using Spring Boot’s “actuator” support then these states are exposed as health endpoint groups.</p>
<p>In addition, you can also obtain availability states by injecting the <code>ApplicationAvailability</code> interface into your own beans.</p>
<h3 id="Application-Liveness"><a href="#Application-Liveness" class="headerlink" title="Application Liveness"></a>Application Liveness</h3><h3 id="Application-Readiness"><a href="#Application-Readiness" class="headerlink" title="Application Readiness"></a>Application Readiness</h3><h3 id="Application-Event-and-Listeners"><a href="#Application-Event-and-Listeners" class="headerlink" title="Application Event and Listeners"></a>Application Event and Listeners</h3><h3 id="Web-Applications"><a href="#Web-Applications" class="headerlink" title="Web Applications"></a>Web Applications</h3><h3 id="Accessing-Application-Arguements"><a href="#Accessing-Application-Arguements" class="headerlink" title="Accessing Application Arguements"></a>Accessing Application Arguements</h3><p>If you need to <strong>access the application arguments that were passed to <code>SpringApplication.run(…)</code></strong>, you can <strong>inject a <code>org.springframework.boot.ApplicationArguments</code> bean.</strong> The <code>ApplicationArguments</code> interface provides access to both the raw <code>String[]</code> arguments as well as parsed option and non-option arguments, as shown in the following example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span>	<span class="comment">// bean injected here</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MyBean</span><span class="params">(ApplicationArguments args)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">boolean</span> debug = args.containsOption(<span class="string">"debug"</span>);</span><br><span class="line">		List&lt;String&gt; files = args.getNonOptionArgs();</span><br><span class="line">		<span class="comment">// if run with "--debug logfile.txt" debug=true, files=["logfile.txt"]</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Running-Specific-Code-for-SpringApplication"><a href="#Running-Specific-Code-for-SpringApplication" class="headerlink" title="Running Specific Code for SpringApplication"></a>Running Specific Code for SpringApplication</h3><p>If you need to run some specific code once the SpringApplication has started, you can implement the <code>ApplicationRunner</code> or <code>CommandLineRunner</code> interfaces. <strong>Both interfaces work in the same way and offer a single run method, which is called just before <code>SpringApplication.run(…)</code> completes</strong>.</p>
<p>The <code>CommandLineRunner</code> interfaces provides <strong>access to application arguments as a simple string array</strong>, whereas the ApplicationRunner uses the ApplicationArguments interface discussed earlier. The following example shows a CommandLineRunner with a run method:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.*;</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> <span class="keyword">implements</span> <span class="title">CommandLineRunner</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String... args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// Do something...</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>If several <code>CommandLineRunner</code> or <code>ApplicationRunner</code> beans are defined that must be called in a specific order, you can additionally implement the <code>org.springframework.core.Ordered</code> interface or <strong>use the <code>org.springframework.core.annotation.Order</code> annotation (e.g. @Order(1), remember that the smaller the number, the higher the priority)</strong>.</p>
<h3 id="Applicaiton-Exit"><a href="#Applicaiton-Exit" class="headerlink" title="Applicaiton Exit"></a>Applicaiton Exit</h3><p>Each SpringApplication registers a shutdown hook with the JVM to ensure that the ApplicationContext closes gracefully on exit. All the standard Spring lifecycle callbacks (such as the DisposableBean interface or the @PreDestroy annotation) can be used. </p>
<p>In addition, beans may implement the org.springframework.boot.ExitCodeGenerator interface if they wish to return a specific exit code when SpringApplication.exit() is called. This exit code can then be passed to System.exit() to return it as a status code, as shown in the following example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExitCodeApplication</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ExitCodeGenerator <span class="title">exitCodeGenerator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> () -&gt; <span class="number">42</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		System.exit(SpringApplication.exit(SpringApplication.run(ExitCodeApplication<span class="class">.<span class="keyword">class</span>,<span class="title">args</span>)))</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Also, the <code>ExitCodeGenerator</code> interface may be implemented by exceptions. When such an exception is encountered, Spring Boot <strong>returns the exit code provided by the implemented <code>getExitCode()</code> method</strong>.</p>
<h2 id="Externalized-Configuration"><a href="#Externalized-Configuration" class="headerlink" title="Externalized Configuration"></a>Externalized Configuration</h2><p>Spring Boot lets you externalize your configuration so that you can work with the same application code in different environments. You can <strong>use properties files, YAML files, environment variables, and command-line arguments to externalize configuration</strong>. </p>
<p><strong>Property values can be injected</strong> directly into your beans by using the <code>@Value</code> annotation, accessed through Spring’s <code>Environment</code> abstraction, or be bound to structured objects through <code>@ConfigurationProperties</code>. Spring Boot uses a <strong>very particular PropertySource order that is designed to allow sensible overriding of values</strong>. Properties are considered in the following order:</p>
<ol>
<li>Devtools global settings properties in the <code>$HOME/.config/spring-boot</code> directory when devtools is active.</li>
<li><code>@TestPropertySource</code> annotations on your tests.</li>
<li>properties attribute on your tests. Available on <code>@SpringBootTest</code> and the test annotations for testing a particular slice of your application.</li>
<li>Command line arguments.</li>
<li>Properties from <code>SPRING_APPLICATION_JSON</code> (inline JSON embedded in an environment variable or system property).</li>
<li>ServletConfig init parameters.</li>
<li>ServletContext init parameters.</li>
<li>JNDI attributes from java:comp/env.</li>
<li>Java System properties (<code>System.getProperties()</code>).</li>
<li>OS environment variables.</li>
<li>A RandomValuePropertySource that has properties only in <code>random.*</code>.</li>
<li>Profile-specific application properties outside of your packaged jar (<code>application-{profile}.properties</code> and YAML variants).</li>
<li>Profile-specific application properties packaged inside your jar (<code>application-{profile}.properties</code> and YAML variants).</li>
<li>Application properties outside of your packaged jar (<code>application.properties</code> and <code>YAML</code> variants).</li>
<li>Application properties packaged inside your jar (<code>application.properties</code> and <code>YAML</code> variants).</li>
<li><code>@PropertySource</code> annotations on your <code>@Configuration</code> classes. Please note that such property sources are not added to the Environment until the application context is being refreshed. This is too late to configure certain properties such as <code>logging.*</code> and <code>spring.main.*</code> which are read before refresh begins.</li>
<li>Default properties (specified by setting <code>SpringApplication.setDefaultProperties</code>).</li>
</ol>
<p>To provide a concrete example, suppose you develop a @Component that uses a name property, as shown in the following example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.stereotype.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.*;</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Value</span>(<span class="string">"$&#123;name&#125;"</span>)</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>On your application classpath (for example, inside your jar) you can have an <code>application.properties</code> file that provides a sensible default property value for name. When running in a new environment, an <code>application.properties</code> file can be provided outside of your jar that overrides the name. For one-off testing, you can launch with a specific command line switch (for example,<code>java -jar app.jar --name=&quot;Spring&quot;</code>).</p>
<h3 id="Using-a-Wildcard-for-Loading-Configuration-Files"><a href="#Using-a-Wildcard-for-Loading-Configuration-Files" class="headerlink" title="Using a Wildcard for Loading Configuration Files"></a>Using a Wildcard for Loading Configuration Files</h3><p>Spring Boot also supports wildcard locations when loading configuration files. By default, a wildcard location of <code>config/*/</code> outside of your jar is supported. Wildcard locations are also supported when specifying <code>spring.config.additional-location</code> and <code>spring.config.location</code>. </p>
<p>Wildcard locations are particularly <strong>useful in an environment such as Kubernetes</strong> when there are multiple sources of config properties. For example, if you have some Redis configuration and some MySQL configuration, you might want to keep those two pieces of configuration separate, while <strong>requiring that both those are present in an <code>application.properties</code> that the <code>app</code> can bind to</strong>. This might result in <strong>two separate <code>application.properties</code> files mounted at different locations such as <code>/config/redis/application.properties</code> and <code>/config/mysql/application.properties</code></strong>. In such a case, <strong>having a wildcard location of <code>config/*/</code>, will result in both files being processed</strong>.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled="" type="checkbox"> A wildcard location <strong>must contain only one and end with <code>/</code> for search locations</strong> that are directories or <strong><code>*/&lt;filename&gt;</code> for search locations that are files</strong>. Locations with wildcards are sorted alphabetically based on the absolute path of the file names.</li>
</ul>
</blockquote>
<h3 id="Generating-and-Using-Random-Values"><a href="#Generating-and-Using-Random-Values" class="headerlink" title="Generating and Using Random Values"></a>Generating and Using Random Values</h3><p>The <code>RandomValuePropertySource</code> is useful for injecting random values <strong>(for example, into secrets or test cases</strong>). It can produce integers, longs, uuids, or strings, as shown in the following example</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">my.secret=$&#123;random.value&#125;</span><br><span class="line">my.number=$&#123;random.int&#125;</span><br><span class="line">my.bignumber=$&#123;random.long&#125;</span><br><span class="line">my.uuid=$&#123;random.uuid&#125;</span><br><span class="line">my.number.less.than.ten=$&#123;random.int(10)&#125;</span><br><span class="line">my.number.in.range=$&#123;random.int[1024,65536]&#125;</span><br></pre></td></tr></table></figure>

<p>The <code>random.int*</code> syntax is <code>OPEN value (,max) CLOSE</code> where the <code>OPEN</code>,<code>CLOSE</code> are any character and value,max are integers. If <code>max</code> is provided, then <code>value</code> is the minimum value and <code>max</code> is the maximum value <strong>(exclusive)</strong>.</p>
<h3 id="Command-Line-Properties"><a href="#Command-Line-Properties" class="headerlink" title="Command Line Properties"></a>Command Line Properties</h3><p>By default, <code>SpringApplication</code> <strong>converts any command line option arguments</strong> (that is, arguments starting with <code>--</code>, such as <code>--server.port=9000</code>) <strong>to a property and adds them to the Spring <code>Environment</code></strong>. As mentioned previously, <strong>command line properties always take precedence over other property sources</strong>.</p>
<p>If you do not want command line properties to be added to the <code>Environment</code>, you can <strong>disable them by using <code>SpringApplication.setAddCommandLineProperties(false)</code></strong>.</p>
<h3 id="Application-Properties-File"><a href="#Application-Properties-File" class="headerlink" title="Application Properties File"></a>Application Properties File</h3><p>SpringApplication loads properties from <code>application.properties</code> files in the following locations and adds them to the Spring Environment:</p>
<ol>
<li>A <code>/config</code> subdirectory of the current directory</li>
<li>The current directory</li>
<li>A classpath <code>/config</code> package</li>
<li>The classpath root</li>
</ol>
<p>The list is <strong>ordered by precedence (properties defined in locations higher in the list override those<br>defined in lower locations)</strong>.</p>
<p>If you do not like <code>application.properties</code> as the configuration file name, you can <strong>switch to another file name by specifying a <code>spring.config.name</code> environment property</strong>. You can also <strong>refer to an explicit location by using the <code>spring.config.location</code> environment property</strong> (which is a comma-separated list of directory locations or file paths). The following example shows how to specify a different file name:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar myproject.jar --spring.config.name=myproject</span><br></pre></td></tr></table></figure>

<p>The following example shows how to specify two locations:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar myproject.jar</span><br><span class="line">--spring.config.location=classpath:/default.properties,classpath:/override.properties</span><br></pre></td></tr></table></figure>

<p>However, if you <strong>used a directory for searching that <code>application.properties</code></strong>, so that you <strong>specify custom config locations by using <code>spring.config.location</code></strong>, they replace the default search locations. </p>
<p>For example, if <code>spring.config.location</code> is configured with the value <code>classpath:/custom-config/</code>,<code>file:./custom-config/</code>, the search order becomes the following:</p>
<ol>
<li><code>file:./custom-config/</code></li>
<li><code>classpath:custom-config/</code></li>
</ol>
<p><strong>Instead of/Overrriding the default locations</strong> (<code>file:./config/</code> is searched first):</p>
<ol>
<li><code>file:./config/</code></li>
<li><code>file:./config/*/</code></li>
<li><code>file:./</code></li>
<li><code>classpath:/config/</code></li>
<li><code>classpath:/</code></li>
</ol>
<p>To prevent the overriding behavior, use <code>spring.config.additionallocation</code>, so that they are <strong>used in addition to the default locations</strong>. Additional locations <strong>are searched before the default locations</strong>. For example, if additional locations of <code>classpath:/customconfig/</code>, <code>file:./custom-config/</code> are configured, the search order becomes the following:</p>
<ol>
<li><code>file:./custom-config/</code></li>
<li><code>classpath:custom-config/</code></li>
<li><code>file:./config/</code></li>
<li><code>file:./config/*/</code></li>
<li><code>file:./</code></li>
<li><code>classpath:/config/</code></li>
<li><code>classpath:/</code></li>
</ol>
<h3 id="Profile-Specific-Properties"><a href="#Profile-Specific-Properties" class="headerlink" title="Profile Specific Properties"></a>Profile Specific Properties</h3><h4 id="Using-properties-file"><a href="#Using-properties-file" class="headerlink" title="Using .properties file"></a>Using <code>.properties</code> file</h4><p>In addition to <code>application.properties</code> files, <strong>profile-specific properties</strong> can also be defined by using the following naming convention: <code>application-{profile}.properties</code></p>
<p><strong>Profile-specific properties are loaded from the same locations as standard <code>application.properties</code></strong>, with <strong>profile-specific files always overriding the non-specific ones</strong>, whether or not the profile specific files are inside or outside your packaged jar.</p>
<p>If several profiles are specified, <strong>a last-wins strategy applies</strong>. For example, profiles specified by the <code>spring.profiles.active</code> property are added after those configured through the SpringApplication API and therefore take precedence.</p>
<p>If that didn’t work, you can use either command line options or the <code>SpringApplication.setAdditionalProfiles()</code> option (if both are specified, the command line option takes precedence):</p>
<ul>
<li><p>Command line option:</p>
</li>
<li><p>add the option: <code>-Dspring.profiles.active=dev</code> or <code>-Dspring.profiles.active=prod</code> to enable the usage of the <code>application-dev.properties</code> profile or the <code>application-prod.properties</code> profile, respectively</p>
</li>
<li><p>SpringApplication</p>
<ul>
<li><p>before calling <code>SpringApplication.run()</code> function, do:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    SpringApplication app = <span class="keyword">new</span> SpringApplication(App<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    app.setAdditionalProfiles(<span class="string">"dev"</span>);</span><br><span class="line">    app.run(args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>to turn on the <code>application-dev.properties</code>. Switch to <code>(&quot;prod&quot;)</code> to enable the <code>application-prod.properties</code>.</p>
</li>
</ul>
</li>
</ul>
<h4 id="Using-yml-file"><a href="#Using-yml-file" class="headerlink" title="Using .yml file"></a>Using <code>.yml</code> file</h4><p>If you use <code>.yml</code> file, you can <strong>define different application profile setting within the same file</strong>, separated with <code>---</code>. For example:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># inside application.yml</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">root:</span> <span class="string">off</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">dev</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8888</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">prod</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>

<p>An additional benefit of this is that you can <strong>use any name you want for specifying the <code>profile</code></strong>, since they are in the same file. Therefore, you can do something like:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># inside application.yml</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">cust</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">root:</span> <span class="string">off</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">cust</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8888</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Notice:</p>
<ul>
<li><input disabled="" type="checkbox"> You now need to specify which profile each segment refers to. For example, <code>dev</code> profile <strong>needs to be specified with <code>spring: profiles: dev</code></strong>. The segment <strong>not specifying any <code>spring: profiles</code> argument is seen as the default <code>application</code> profile</strong>.</li>
<li><input disabled="" type="checkbox"> Also, to enable a profile, you need to <strong>specify <code>spring: profiles: active: &lt;profile-name&gt;</code></strong> within the default application profile. This is the <strong>same as the process in <code>application.properties</code></strong>.</li>
</ul>
</blockquote>
<h3 id="Injecting-Property-Values"><a href="#Injecting-Property-Values" class="headerlink" title="Injecting Property Values"></a>Injecting Property Values</h3><p>Basically, once the <code>application.properties</code> or other customized <code>application.properties</code> has been loaded, you can <strong>inject values with the placeholder <code>${}</code></strong>.</p>
<p>In the main application where you run your SpringApplication, you can inject them easily with <code>@Value(&quot;${&lt;some-expression&gt;}&quot;)</code>. For example:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># inside application.properties</span><br><span class="line">app.my.name=jason</span><br></pre></td></tr></table></figure>

<p>then in your main application:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;app.my.name&#125;"</span>)</span><br><span class="line"><span class="keyword">private</span> String appName;</span><br></pre></td></tr></table></figure>

<p>However, in some other places, besides the main application, you might need to specify your <code>application.properties</code> file again before injecting the <code>@Value</code>. For example, in a <code>@Configuration</code> file at some other place in your project hierarchy:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@PropertySource</span>(<span class="string">"classpath:application.properties"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ProfileManager <span class="title">profileManager</span><span class="params">(@Autowired Environment env, @Value(<span class="string">"$&#123;app.testname&#125;"</span>)</span> String s) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ProfileManager(env,s);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled="" type="checkbox"> Here constructor injection is used. For reason why constructor injection is preferred over field injection, please visit the Spring Framework Guide.</li>
</ul>
</blockquote>
<p>You can also use this to <strong>calculate expressions, which will require <code>#{}</code> instead of <code>${}</code></strong> for <code>@Value()</code>. For example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@Value(#&#123;app.my.age*2&#125;)</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> age;</span><br></pre></td></tr></table></figure>



<h3 id="Type-safe-Configuration-Properties"><a href="#Type-safe-Configuration-Properties" class="headerlink" title="Type-safe Configuration Properties"></a>Type-safe Configuration Properties</h3><h4 id="JavaBean-properties-binding-with-application-properties"><a href="#JavaBean-properties-binding-with-application-properties" class="headerlink" title="JavaBean properties binding with application.properties"></a>JavaBean properties binding with <code>application.properties</code></h4><p>It is possible to bind a bean declaring standard JavaBean properties as shown in the following example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(<span class="string">"acme"</span>)	<span class="comment">// matches the all the properties starting with `acme`</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AcmeProperties</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> enabled;	<span class="comment">// matches acme.enabled</span></span><br><span class="line">    <span class="keyword">private</span> InetAddress remoteAddress;  <span class="comment">// matches acme.remote-address</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Security security = <span class="keyword">new</span> Security();	<span class="comment">// matches acme.security.*</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEnabled</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEnabled</span><span class="params">(<span class="keyword">boolean</span> enabled)</span> </span>&#123; ... &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> InetAddress <span class="title">getRemoteAddress</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRemoteAddress</span><span class="params">(InetAddress remoteAddress)</span> </span>&#123; ... &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Security <span class="title">getSecurity</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Security</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String username;	<span class="comment">// matches acme.security.username</span></span><br><span class="line">        <span class="keyword">private</span> String password;	<span class="comment">// matches acme.security.password</span></span><br><span class="line">        <span class="keyword">private</span> List&lt;String&gt; roles = <span class="keyword">new</span> ArrayList&lt;&gt;(Collections.singleton(<span class="string">"USER"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123; ... &#125;	<span class="comment">// notice the setters here</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123; ... &#125;	<span class="comment">// notice the setters here</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">getRoles</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRoles</span><span class="params">(List&lt;String&gt; roles)</span> </span>&#123; ... &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Constructor-Binding"><a href="#Constructor-Binding" class="headerlink" title="Constructor Binding"></a>Constructor Binding</h5><p>The previous example could be made immutable with constructor binding and making them <code>final</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConstructorBinding;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.bind.DefaultValue;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ConstructorBinding</span>		<span class="comment">// enables constructor binding, so it looks for constructors for parameters to be injected</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(<span class="string">"acme"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AcmeProperties</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> enabled;	<span class="comment">// notice the final keyword</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> InetAddress remoteAddress;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Security security;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AcmeProperties</span><span class="params">(<span class="keyword">boolean</span> enabled, InetAddress remoteAddress, Security</span></span></span><br><span class="line"><span class="function"><span class="params">            security)</span> </span>&#123;		<span class="comment">// this woud be required for constructor binding</span></span><br><span class="line">        <span class="keyword">this</span>.enabled = enabled;</span><br><span class="line">        <span class="keyword">this</span>.remoteAddress = remoteAddress;</span><br><span class="line">        <span class="keyword">this</span>.security = security;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEnabled</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> InetAddress <span class="title">getRemoteAddress</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Security <span class="title">getSecurity</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Security</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String username;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String password;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> List&lt;String&gt; roles;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Security</span><span class="params">(String username, String password,</span></span></span><br><span class="line"><span class="function"><span class="params">                        @DefaultValue(<span class="string">"USER"</span>)</span> List&lt;String&gt; roles) </span>&#123;		<span class="comment">// notice the constructor here as well</span></span><br><span class="line">            <span class="keyword">this</span>.username = username;</span><br><span class="line">            <span class="keyword">this</span>.password = password;</span><br><span class="line">            <span class="keyword">this</span>.roles = roles;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">getRoles</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In this setup, the <strong><code>@ConstructorBinding</code> annotation</strong> is used to indicate that constructor binding should be used. This means that the <strong>binder will expect to find a constructor</strong> with the parameters that you wish to have bound (Nested members of a <code>@ConstructorBinding</code> class (such as Security in the example above) will also be bound via their constructor).</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled="" type="checkbox"> To use <strong>constructor binding the class must be enabled using <code>@EnableConfigurationProperties</code> or configuration property scanning</strong>. You <strong>cannot use constructor binding with beans that are created by the regular Spring mechanisms</strong> (e.g. <code>@Component</code> beans, beans created via @Bean methods or beans loaded using <code>@Import</code>).</li>
</ul>
</blockquote>
<h5 id="Enabling-ConfigurationProperties"><a href="#Enabling-ConfigurationProperties" class="headerlink" title="Enabling @ConfigurationProperties"></a>Enabling <code>@ConfigurationProperties</code></h5><p>Spring Boot provides <strong>infrastructure to bind <code>@ConfigurationProperties</code> types and register them as beans</strong>. You can either enable configuration properties on a class-by-class basis or** enable configuration property scanning** that works in a similar manner to component scanning. </p>
<p>Sometimes, classes annotated with <code>@ConfigurationProperties</code> might not be suitable for scanning, for example, if you’re developing your own auto-configuration or you want to enable them conditionally. In these cases, specify the list of types to process using the <code>@EnableConfigurationProperties</code> annotation. This can be done on any <code>@Configuration</code> class, as shown in the following example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>(proxyBeanMethods = <span class="keyword">false</span>)</span><br><span class="line"><span class="meta">@EnableConfigurationProperties</span>(AcmeProperties<span class="class">.<span class="keyword">class</span>)	// <span class="title">this</span> <span class="title">will</span> <span class="title">be</span> <span class="title">not</span> <span class="title">necessary</span> <span class="title">if</span> </span></span><br><span class="line"><span class="class">														// <span class="title">you</span> <span class="title">use</span> @<span class="title">ConfigurationPropertiesScane</span> <span class="title">below</span></span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">MyConfiguration</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To use configuration property scanning, add the <code>@ConfigurationPropertiesScan</code> annotation to your application. Typically, it is added to the main application class that is annotated with <code>@SpringBootApplication</code> but it can be added to any <code>@Configuration</code> class.</p>
<p>By default, scanning will occur from the package of the class that declares the annotation. If you want to define specific packages to scan, you can do so as shown in the following example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@ConfigurationPropertiesScan</span>(&#123; <span class="string">"com.example.app"</span>, <span class="string">"org.acme.another"</span> &#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>One important thing to note is that:</p>
<ul>
<li><p>When <strong>the <code>@ConfigurationProperties</code> bean is registered using configuration property scanning or via <code>@EnableConfigurationProperties</code></strong>, the <strong>bean has a conventional name: <code>&lt;prefix&gt;-&lt;fqn&gt;</code></strong>, where <code>&lt;prefix&gt;</code> is the environment key prefix specified in the <code>@ConfigurationProperties</code> annotation and <code>&lt;fqn&gt;</code> is the fully qualified name of the bean. If the annotation does not provide any prefix, only the fully qualified name of the bean is used. </p>
<p>  The bean name in the example above is <code>acme-com.example.AcmeProperties</code>. This means you can do </p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span>(name = <span class="string">"acme-com.example.AcmeProperties"</span>)		<span class="comment">// instead of @Autowire, if you prefer</span></span><br><span class="line"><span class="keyword">private</span> AcmeProperties acmeProperties;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>In general, it is not recommended to inject other beans while using property binding. However, if you still want to <strong>inject other beans using the constructor</strong>, the <strong>configuration properties bean must be annotated with <code>@Component</code></strong> and use JavaBean-based property binding.</p>
<h5 id="Properties-Binding-to-a-Bean"><a href="#Properties-Binding-to-a-Bean" class="headerlink" title="Properties Binding to a Bean"></a>Properties Binding to a Bean</h5><p>To configure a bean from the Environment properties, add <code>@ConfigurationProperties</code> to its bean registration, as shown in the following example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"another"</span>)</span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> AnotherComponent <span class="title">anotherComponent</span><span class="params">(...)</span> </span>&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Any JavaBean property defined with the <code>another</code> prefix is mapped onto that <code>AnotherComponent</code> bean in manner similar to the preceding <code>AcmeProperties</code> example.</p>
<h4 id="Binding-With-application-yml"><a href="#Binding-With-application-yml" class="headerlink" title="Binding With application.yml"></a>Binding With <code>application.yml</code></h4><h5 id="Binding-Objects-Maps-Lists"><a href="#Binding-Objects-Maps-Lists" class="headerlink" title="Binding Objects/Maps/Lists"></a>Binding Objects/Maps/Lists</h5><p>When binding to Map properties, if the key contains <strong>anything other than lowercase alpha-numeric characters or <code>-</code>, you need to use the bracket notation so that the original value is preserved</strong>. If the key is <strong>not surrounded by <code>[]</code></strong>, any characters that are <strong>not alpha-numeric or <code>-</code> are removed.</strong> For example, consider binding the following properties to a Map:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">acme:</span></span><br><span class="line">	<span class="attr">map:</span></span><br><span class="line">		<span class="string">"[/key1]"</span><span class="string">:</span> <span class="string">value1</span></span><br><span class="line">		<span class="string">"[/key2]"</span><span class="string">:</span> <span class="string">value2</span></span><br><span class="line">		<span class="string">/key3:</span> <span class="string">value3</span></span><br></pre></td></tr></table></figure>

<p>The properties above will bind to a Map with <code>/key1</code>, <code>/key2</code> and <code>key3</code> as the keys in the map. (For YAML files, the brackets need to be surrounded by quotes for the keys to be parsed properly.)</p>
<p>The above can be mapped to <code>acme.map./key1</code> , but can also be used to represent fields in an Object:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">person1:</span></span><br><span class="line">	<span class="attr">lastName:</span> <span class="string">john</span></span><br><span class="line">	<span class="attr">firstName:</span> <span class="string">cole</span></span><br><span class="line">	<span class="attr">age:</span> <span class="number">10</span></span><br><span class="line">	<span class="attr">pets:</span> <span class="string">[pp,</span> <span class="string">cc]</span></span><br><span class="line">	<span class="attr">father:</span> <span class="string">&#123;lastName:</span> <span class="string">john,</span> <span class="attr">firstName:</span> <span class="string">ccole,</span> <span class="attr">age:</span> <span class="number">33</span><span class="string">,</span> <span class="attr">pets:</span> <span class="string">[]&#125;</span></span><br></pre></td></tr></table></figure>

<p>This could then be mapped to:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(<span class="string">"person1"</span>)	<span class="comment">// this is needed so that the correct data is mapped</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="keyword">private</span> String firstName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; pets;</span><br><span class="line">    <span class="keyword">private</span> Person father;</span><br><span class="line">    </span><br><span class="line">    ... <span class="comment">// if have a constructor here, you can also use constructor injection</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled="" type="checkbox"> There are two ways to specify a map/object with<code>key:value</code> pairs.  You can either specify them with a new line and some spacing, or you can <strong>specify them in one line with the <code>{}</code> bracket, separated with <code>,</code> comma</strong>. </li>
<li><input disabled="" type="checkbox"> There are also two ways to specify a list object. You can either specify them with a new line and a <code>-</code> for each new object, or, <strong>in one line, with <code>[]</code> bracket, each separated with a <code>,</code>  comma.</strong></li>
</ul>
</blockquote>
<h3 id="Binding-with-a-Customized-yml-or-properties-file"><a href="#Binding-with-a-Customized-yml-or-properties-file" class="headerlink" title="Binding with a Customized yml or properties file"></a>Binding with a Customized <code>yml</code> or <code>properties</code> file</h3><p>You can also also specify a customized properties file for constructor injection or property bindings. The basic annotations and syntax are the same as above, except that you need to <strong>specify that customized <code>yml</code> or <code>properties</code> file with <code>@PropertySource()</code></strong>. For example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PropertySource</span>(value=<span class="string">"classpath: customizedPropertyFile"</span>)</span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix=<span class="string">"person1"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></span><br><span class="line"><span class="class">    ...</span></span><br></pre></td></tr></table></figure>

<h3 id="Relaxed-Name-Matching-and-Binding-for-Environmental-Variables"><a href="#Relaxed-Name-Matching-and-Binding-for-Environmental-Variables" class="headerlink" title="Relaxed Name Matching and Binding for Environmental Variables"></a>Relaxed Name Matching and Binding for Environmental Variables</h3><p>Spring Boot uses some relaxed rules for binding <code>Environment</code> properties to <code>@ConfigurationProperties</code> beans, so there <strong>does not need to be an exact match between the Environment property name and the bean property name</strong>. Common examples where this is useful include dash-separated environment properties (for example, <code>context-path</code> binds to <code>contextPath</code>), and capitalized environment properties (for example, <code>PORT</code> binds to <code>port</code>).</p>
<p>Spring Boot’s relaxed binding rules are, as much as possible, designed to be compatible with naming  estrictions in different operating systems, such as Unix and Linux.</p>
<p>To convert a property name in the canonical-form to an environment variable name you can follow<br>these rules:</p>
<ul>
<li>Replace dots (<code>.</code>) with underscores (<code>_</code>).</li>
<li><strong>Remove any dashes</strong> (<code>-</code>).</li>
<li>Convert to uppercase.</li>
</ul>
<p>For example, the configuration property <code>spring.main.log-startup-info</code> would be an environment variable named <code>SPRING_MAIN_LOGSTARTUPINFO</code>.</p>
<h3 id="Properties-Type-Conversion"><a href="#Properties-Type-Conversion" class="headerlink" title="Properties Type Conversion"></a>Properties Type Conversion</h3><p>Spring Boot attempts to <strong>coerce the external application properties to the right type</strong> when it binds to the <code>@ConfigurationProperties</code> beans. </p>
<p>If you need <strong>custom type conversion</strong>, you can provide a <code>ConversionService</code> bean (with a bean named <code>conversionService</code>) or custom property editors (through a <code>CustomEditorConfigurer</code> bean) or custom Converters (with bean definitions annotated as <code>@ConfigurationPropertiesBinding</code>).</p>
<h4 id="Converting-time-durations"><a href="#Converting-time-durations" class="headerlink" title="Converting time durations"></a>Converting time durations</h4><p>Spring Boot has dedicated support for expressing durations. If you expose a <code>java.time.Duration</code> property, the following formats in application properties are available: </p>
<ul>
<li>A regular <code>long</code> representation (using milliseconds as the default unit unless a <code>@DurationUnit</code> has been specified)</li>
<li>The standard ISO-8601 format used by <code>java.time.Duration</code></li>
<li>A more readable format where the value and the unit are coupled (e.g. <code>10s</code> means 10 seconds)</li>
</ul>
<p>Consider the following example:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># inside your application,properties, suppose those units are in seconds</span><br><span class="line">app.time.sessionTimeout=240</span><br><span class="line">app.time.readTimeout=120</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(<span class="string">"app.system"</span>)</span><br><span class="line"><span class="meta">@PropertySource</span>(<span class="string">"classpath:application.properties"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppSystemProperties</span> </span>&#123;</span><br><span class="line">	<span class="meta">@DurationUnit</span>(ChronoUnit.SECONDS)</span><br><span class="line">	<span class="keyword">private</span> Duration sessionTimeout;</span><br><span class="line">	<span class="meta">@DurationUnit</span>(ChronoUnit.SECONDS)</span><br><span class="line">	<span class="keyword">private</span> Duration readTimeout;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Duration <span class="title">getSessionTimeout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.sessionTimeout;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSessionTimeout</span><span class="params">(Duration sessionTimeout)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.sessionTimeout = sessionTimeout;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Duration <span class="title">getReadTimeout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.readTimeout;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setReadTimeout</span><span class="params">(Duration readTimeout)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.readTimeout = readTimeout;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>If you specified a session timeout of <code>30</code> seconds in <code>application.properties</code>, getting <code>30</code>, <code>PT30S</code> and <code>30s</code> are all equivalent, if you specified <code>@DurationUnit(ChronoUnit.SECONDS)</code>. A read timeout of <code>500ms</code> can be specified in any of the following form: <code>500</code>, <code>PT0.5S</code> and <code>500ms</code>, without specifying the <code>@DurationUnit</code>.</p>
<p>Alternatively, you can use <strong>constructor binding</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConstructorBinding</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(<span class="string">"app.time"</span>)</span><br><span class="line"><span class="meta">@PropertySource</span>(<span class="string">"classpath:application.properties"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TimeProperties</span> </span>&#123;</span><br><span class="line">    <span class="meta">@DurationUnit</span>(ChronoUnit.SECONDS)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> sessionTimeout;</span><br><span class="line">    <span class="meta">@DurationUnit</span>(ChronoUnit.SECONDS)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Duration readTimeout;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TimeProperties</span><span class="params">(<span class="keyword">long</span> sessionTimeout, Duration readTimeout)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sessionTimeout = sessionTimeout;</span><br><span class="line">        <span class="keyword">this</span>.readTimeout = readTimeout;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getSessionTimeout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.sessionTimeout;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Duration <span class="title">getReadTimeout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.readTimeout;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Converting-Periods"><a href="#Converting-Periods" class="headerlink" title="Converting Periods"></a>Converting Periods</h4><p>In addition to durations, Spring Boot can also work with <code>java.time.Period type</code>. This is essentially the same as <code>Duration</code> shown above.</p>
<p>The following formats can be used in application properties:</p>
<ul>
<li>An regular <code>int</code> representation (using days as the default unit unless a <code>@PeriodUnit</code> has been specified)</li>
<li>The standard <code>ISO-8601</code> format used by <code>java.time.Period</code></li>
<li>A simpler format where the value and the unit pairs are coupled (e.g. <code>1y3d</code> means 1 year and 3 days)</li>
</ul>
<h4 id="Converting-Data-Size"><a href="#Converting-Data-Size" class="headerlink" title="Converting Data Size"></a>Converting Data Size</h4><p>Spring Framework has a DataSize value type that expresses a size in bytes. If you expose a DataSize<br>property, the following formats in application properties are available:</p>
<ul>
<li>A regular long representation (using bytes as the default unit unless a <code>@DataSizeUnit</code> has been specified)</li>
<li>A more readable format where the value and the unit are coupled (e.g. <code>10MB</code> means 10 megabytes)</li>
</ul>
<p>Consider the following example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(<span class="string">"app.io"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppIoProperties</span> </span>&#123;</span><br><span class="line">	<span class="meta">@DataSizeUnit</span>(DataUnit.MEGABYTES)</span><br><span class="line">	<span class="keyword">private</span> DataSize bufferSize = DataSize.ofMegabytes(<span class="number">2</span>);</span><br><span class="line">	<span class="keyword">private</span> DataSize sizeThreshold = DataSize.ofBytes(<span class="number">512</span>);</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> DataSize <span class="title">getBufferSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.bufferSize;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBufferSize</span><span class="params">(DataSize bufferSize)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.bufferSize = bufferSize;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> DataSize <span class="title">getSizeThreshold</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.sizeThreshold;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSizeThreshold</span><span class="params">(DataSize sizeThreshold)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.sizeThreshold = sizeThreshold;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>To specify a buffer size of 10 megabytes, <code>10</code> and <code>10MB</code> are equivalent. A size threshold of 256 bytes can be specified as <code>256</code> or <code>256B</code>.</p>
<p>You can also use any of the supported units. These are:</p>
<ul>
<li><code>B</code> for bytes</li>
<li><code>KB</code> for kilobytes</li>
<li><code>MB</code> for megabytes</li>
<li><code>GB</code> for gigabytes</li>
<li><code>TB</code> for terabytes</li>
</ul>
<p>The default unit is bytes and can be overridden using <code>@DataSizeUnit</code> as illustrated in the sample above.</p>
<h3 id="Validating-ConfigurationProperties"><a href="#Validating-ConfigurationProperties" class="headerlink" title="Validating @ConfigurationProperties"></a>Validating <code>@ConfigurationProperties</code></h3><p>Spring Boot attempts to <strong>validate<code>@ConfigurationProperties</code> classes whenever they are annotated with Spring’s <code>@Validated</code> annotation</strong>. You can use JSR-303 <code>javax.validation</code> constraint annotations directly on your configuration class. To do so, ensure that a compliant JSR-303 implementation is on your classpath and then add constraint annotations to your fields, as shown in the following example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix=<span class="string">"acme"</span>)</span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AcmeProperties</span> </span>&#123;</span><br><span class="line">	<span class="meta">@NotNull</span></span><br><span class="line">	<span class="keyword">private</span> InetAddress remoteAddress;</span><br><span class="line">	<span class="comment">// ... getters and setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This will prevent the application from running if that field annotated with <code>@NotNull</code> is actually <code>null</code>. Then, if that is the case, you will see the error in console:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Property: app.time.writeTimeout</span><br><span class="line">Value: null</span><br><span class="line">Reason: cannot be null</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled="" type="checkbox"> To use this feature, you need to add the dependency<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-validation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><input disabled="" type="checkbox"> You can also trigger validation by annotating the <code>@Bean</code> method that creates the configuration properties with <code>@Validated</code></li>
</ul>
</blockquote>
<p>To ensure that validation is always <strong>triggered for nested properties</strong>, the <strong>associated field must be annotated with <code>@Valid</code></strong>, even when no properties are found. The following example builds on the preceding <code>AcmeProperties</code> example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix=<span class="string">"acme"</span>)</span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AcmeProperties</span> </span>&#123;</span><br><span class="line">	<span class="meta">@NotNull</span></span><br><span class="line">	<span class="keyword">private</span> InetAddress remoteAddress;</span><br><span class="line">	<span class="meta">@Valid</span>	<span class="comment">// notice the @Valid here</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> Security security = <span class="keyword">new</span> Security();</span><br><span class="line">	<span class="comment">// ... getters and setters</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Security</span> </span>&#123;</span><br><span class="line">		<span class="meta">@NotEmpty</span></span><br><span class="line">		<span class="keyword">public</span> String username;</span><br><span class="line">		<span class="comment">// ... getters and setters</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Logging"><a href="#Logging" class="headerlink" title="Logging"></a>Logging</h2><p>Spring Boot <strong>uses logging frameworks</strong> to produce logs, whether in the console or output to a file. Logging frameworks are commonly used as they can be decoupled from your code (to some extent), and would be easier to maintain and manipulate.</p>
<p>There are also quite some options that you can specify with logging in Spring Boot, which <strong>uses <code>LogBack</code> as the default logging framework implementation for <code>SLF4J</code> abstraction</strong>. You can change the default logging level to options such as <code>debug</code> or <code>trace</code> to see more information about how Spring Boot configured your application, <code>logging-file-name</code> to produce logs to a local file.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled="" type="checkbox"> Since we used the <code>LogBack</code> implementation of the <code>SLF4J</code> abstraction framework for logging, we should <strong>use logging API from the <code>SLF4J</code> abstraction</strong>, instead of the <code>LogBack</code> implementation.</li>
</ul>
</blockquote>
<h3 id="Using-SLF4J-API"><a href="#Using-SLF4J-API" class="headerlink" title="Using SLF4J API"></a>Using <code>SLF4J</code> API</h3><p>You can follow the official manual on their <a href="http://www.slf4j.org/manual.html" target="_blank" rel="noopener">official site</a>. A simple example of using it would be:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Logger logger = LoggerFactory.getLogger(HelloWorld<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    logger.info(<span class="string">"Hello World"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>However, this would not be useful as we are using an abstraction level framework:</p>
<p><img src="concrete-bindings.png" alt="image from http://www.slf4j.org/images/concrete-bindings.png&quot;" title="image from http://www.slf4j.org/images/concrete-bindings.png"></p>
<p>However, since the actual implementation is not controlled by the abstraction level, if you want to <strong>configure your logger, you need to configure based on the implementation (e.g. <code>LogBack</code>), not on the abstraction</strong>.</p>
<h4 id="Legacy-Bridging"><a href="#Legacy-Bridging" class="headerlink" title="Legacy/Bridging"></a>Legacy/Bridging</h4><p><strong><em>Q: What if I am using other products in my Spring Boot project, but those products use frameworks other than SLF4J?</em></strong></p>
<p>For example, Spring Framework actually uses <code>JavaCommonsLogging</code> framework.</p>
<p><img src="legacy.png" alt="image from http://www.slf4j.org/images/legacy.png" title="image from http://www.slf4j.org/images/legacy.png"></p>
<p>Then you need to use those “Adaptation” jar packages to replace the original jar packages, which contains the same classes as in their original jar packages, but <strong>will redirect output to your <code>SLF4J</code> framework</strong>.</p>
<p>To achieve this, you need to do:</p>
<ol>
<li><strong>Exclude (but not delete)</strong> those original jar packages from the other products you are using</li>
<li><strong>Include</strong> the “Adaptation” jar packages shown in the image above in those products</li>
<li><strong>Use the <code>SLF4J</code> API</strong> as usual</li>
</ol>
<p>For instance, to <strong>exclude the <code>commons-logging</code> package in your Spring Framework</strong>, you need to add in your <code>pom.xml</code> file:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span>          </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="Spring-Boot-Logging"><a href="#Spring-Boot-Logging" class="headerlink" title="Spring Boot Logging"></a>Spring Boot Logging</h4><p>As said before, Spring Boot uses the <code>SLF4J</code> abstraction framework for logging. Therefore, it needs to use adaptation jar files to bridge legacy/other logger frameworks included in your projects.</p>
<p>If you look at the dependency diagram of your project, you can see a similar diagram as shown below:</p>
<p><img src="springboot-logging.png" alt="springboot-logging.png" title="springboot-logging.png"></p>
<p>This means that <strong>Spring Boot has done the first two steps mentioned above for you</strong>.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled="" type="checkbox"> If you are <strong>using external dependencies</strong> not directly maintained by Spring Boot, you need to <strong>manually add the section <code>&lt;exclusions&gt;&lt;exclusions&gt;</code>in your <code>pom.xml</code></strong> to exclude that logging package.</li>
</ul>
</blockquote>
<h4 id="Using-SLF4J-Logging"><a href="#Using-SLF4J-Logging" class="headerlink" title="Using SLF4J Logging"></a>Using <code>SLF4J</code> Logging</h4><p>In your test class, you can use the <code>LoggerFactory</code> to obtain your logger, then output different logging levels as shown below:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Testsb2ApplicationTests</span> </span>&#123;</span><br><span class="line">    Logger logger = LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// the followings are logger levels, in ascending order</span></span><br><span class="line">        <span class="comment">// you can use this to decide which logging should be filtered</span></span><br><span class="line">        <span class="comment">// e.g. If you specified "info" level (the default), then info, warn, error logging will shouw</span></span><br><span class="line">        logger.trace(<span class="string">"This is my trace log"</span>);</span><br><span class="line">        logger.debug(<span class="string">"This is my debug log"</span>);</span><br><span class="line">        logger.info(<span class="string">"This is my info log"</span>);</span><br><span class="line">        logger.warn(<span class="string">"This is my warn log"</span>);</span><br><span class="line">        logger.error(<span class="string">"This is my error log"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>If you now run your application, you will see logs with <code>info</code>, <code>warn</code> and <code>error</code> only. This is because that <strong>Spring Boot uses the default logging level of <code>info</code></strong>, meaning that only logger levels <strong>equal to and higher than <code>info</code> will be shown</strong>. </p>
<h4 id="Log-Format"><a href="#Log-Format" class="headerlink" title="Log Format"></a>Log Format</h4><p>The <strong>default log output</strong> from Spring Boot resembles the following example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">2020-06-19 18:33:04.627  INFO 25956 --- [  restartedMain] .e.DevToolsPropertyDefaultsPostProcessor : Devtools property defaults active! Set &#39;spring.devtools.add-properties&#39; to &#39;false&#39; to disable</span><br><span class="line">2020-06-19 18:33:04.628  INFO 25956 --- [  restartedMain] .e.DevToolsPropertyDefaultsPostProcessor : For additional web related logging consider setting the &#39;logging.level.web&#39; property to &#39;DEBUG&#39;</span><br><span class="line">2020-06-19 18:33:05.317  INFO 25956 --- [  restartedMain] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8080 (http)</span><br><span class="line">2020-06-19 18:33:05.322  INFO 25956 --- [  restartedMain] o.apache.catalina.core.StandardService   : Starting service [Tomcat]</span><br><span class="line">2020-06-19 18:33:05.322  INFO 25956 --- [  restartedMain] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat&#x2F;9.0.35]</span><br><span class="line">2020-06-19 18:33:05.408  INFO 25956 --- [  restartedMain] o.a.c.c.C.[Tomcat].[localhost].[&#x2F;]       : Initializing Spring embedded WebApplicationContext</span><br><span class="line">2020-06-19 18:33:05.409  INFO 25956 --- [  restartedMain] o.s.web.context.ContextLoader            : Root WebApplicationContext: initialization completed in 781 ms</span><br><span class="line">2020-06-19 18:33:05.645  INFO 25956 --- [  restartedMain] o.s.s.concurrent.ThreadPoolTaskExecutor  : Initializing ExecutorService &#39;applicationTaskExecutor&#39;</span><br><span class="line">2020-06-19 18:33:05.758  INFO 25956 --- [  restartedMain] o.s.b.d.a.OptionalLiveReloadServer       : LiveReload server is running on port 35729</span><br><span class="line">2020-06-19 18:33:05.791  INFO 25956 --- [  restartedMain] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path &#39;&#39;</span><br></pre></td></tr></table></figure>

<p>The following items are output:</p>
<ul>
<li>Date and Time: Millisecond precision and easily sortable.</li>
<li>Log Level: <code>ERROR</code>, <code>WARN</code>, <code>INFO</code>, <code>DEBUG</code>, or <code>TRACE</code>.</li>
<li>Process ID.</li>
<li>A <code>---</code> separator to distinguish the start of actual log messages.</li>
<li>Thread name: Enclosed in square brackets (may be truncated for console output).</li>
<li>Logger name: This is usually the source class name (often abbreviated).</li>
<li>The log message.</li>
</ul>
<h5 id="debug-log"><a href="#debug-log" class="headerlink" title="debug log"></a><code>debug</code> log</h5><p>By default, <code>ERROR-level</code>, <code>WARN-level</code>, and <code>INFO-level</code> messages are logged. You can also enable a “debug” mode by starting your application with a <code>--debug</code> flag, or by specifying <code>debug=true</code> in your <code>application.properties</code>.</p>
<p>When the debug mode is enabled, <strong>a selection of core loggers</strong> (embedded container, Hibernate, and Spring Boot)** are configured to output more information<strong>. Enabling the debug mode does **not</strong> configure your application to <strong>log all messages with <code>DEBUG</code> level</strong>.</p>
<h5 id="trace-log"><a href="#trace-log" class="headerlink" title="trace log"></a><code>trace</code> log</h5><p>Alternatively, you can enable a “trace” mode by starting your application with a <code>--trace</code> flag (or <code>trace=true</code> in your <code>application.properties</code>). Doing so enables <strong>trace logging for a selection of core loggers</strong> (embedded container, Hibernate schema generation, and the whole Spring portfolio).</p>
<h5 id="Specify-Your-Own-Logging-Pattern"><a href="#Specify-Your-Own-Logging-Pattern" class="headerlink" title="Specify Your Own Logging Pattern"></a>Specify Your Own Logging Pattern</h5><p>You can specify the output pattern of your loggers with the <code>logging.pattern.console</code> or <code>logging.pattern.file</code> in your <code>application.properties</code> or <code>application.yml</code> file. For example:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">logging.pattern.file</span>=<span class="string">%d&#123;yyyy-MM-dd&#125;[%thread] %-5level %msg%n</span></span><br></pre></td></tr></table></figure>



<h4 id="Configuring-Your-Log-Levels"><a href="#Configuring-Your-Log-Levels" class="headerlink" title="Configuring Your Log Levels"></a>Configuring Your Log Levels</h4><h5 id="Configuring-Log-Levels-for-a-class-specific-logger"><a href="#Configuring-Log-Levels-for-a-class-specific-logger" class="headerlink" title="Configuring Log Levels for a class/specific logger"></a>Configuring Log Levels for a class/specific logger</h5><p>All the supported logging systems can have the logger levels set in the Spring Environment (for example, in <code>application.properties</code>) by <strong>using <code>logging.level.&lt;logger-name&gt;=&lt;level&gt;</code></strong> where level is one of <code>TRACE</code>, <code>DEBUG</code>, <code>INFO</code>, <code>WARN</code>, <code>ERROR</code>, <code>FATAL</code>, or <code>OFF</code>. The root logger can be configured by using <code>logging.level.root</code>.</p>
<p>The following example shows potential logging settings in <code>application.properties</code>:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">logging.level.root</span>=<span class="string">debug</span></span><br><span class="line"><span class="meta">logging.level.org.springframework.web</span>=<span class="string">info</span></span><br><span class="line"><span class="meta">logging.level.org.hibernate</span>=<span class="string">error</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled="" type="checkbox"> In the previous section, it is seen that <strong>some of the loggers have the name <code>o.s.boot</code> or <code>o.s.b</code></strong>. They <strong>actually stand for <code>org.springframework.boot</code></strong>. So you can configure them by specifying the logger level of <code>org.springframework.boot</code>.</li>
</ul>
</blockquote>
<p>You can also specify logger levels for your own package (e.g. <code>com.example</code>):</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">logging.level.com.example</span>=<span class="string">debug</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled="" type="checkbox"> All the other loggers that you <strong>did not specify</strong> will <strong>use the default level (root level) of <code>info</code></strong></li>
</ul>
</blockquote>
<h5 id="Configuring-Log-Levels-using-Log-Groups"><a href="#Configuring-Log-Levels-using-Log-Groups" class="headerlink" title="Configuring Log Levels using Log Groups"></a>Configuring Log Levels using Log Groups</h5><p>It’s often useful to be able to <strong>group related loggers together so that they can all be configured at the same time</strong>. For example, you might commonly change the logging levels for all Tomcat related loggers, but you can’t easily remember top level packages.</p>
<p>To help with this, Spring Boot allows you to <strong>define logging groups in your Spring Environment</strong>. For example, here’s how you could define a “tomcat” group by adding it to your <code>application.properties</code>:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logging.group.tomcat=org.apache.catalina, org.apache.coyote, org.apache.tomcat</span><br></pre></td></tr></table></figure>

<p>Once defined, you can change the level for all the loggers in the group with a single line:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logging.level.tomcat=TRACE</span><br></pre></td></tr></table></figure>
<p>Spring Boot includes the following <strong>pre-defined logging groups</strong> that can be used out-of-the-box:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Loggers</th>
</tr>
</thead>
<tbody><tr>
<td>web</td>
<td><code>org.springframework.core.codec</code>, <code>org.springframework.http</code>, <code>org.springframework.web</code>, <code>org.springframework.boot.actuate.endpoint.web</code>, <code>org.springframework.boot.web.servlet.ServletContextInitializerBeans</code></td>
</tr>
<tr>
<td>sql</td>
<td><code>org.springframework.jdbc.core</code>, <code>org.hibernate.SQL</code>, <code>org.jooq.tools.LoggerListener</code></td>
</tr>
</tbody></table>
<h3 id="File-Output"><a href="#File-Output" class="headerlink" title="File Output"></a>File Output</h3><p><strong>By default</strong>, Spring Boot <strong>logs only to the console</strong> and does not write log files. If you want to write log files in addition to the console output, you need to set a <code>logging.file.name</code> or <code>logging.file.path property</code>.</p>
<p>For example, to specify your output logging file to <code>./myLog.log</code>, where the current directory would be your project directory (where your <code>POM</code> file resides), you could write:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># inside application.properties</span><br><span class="line">logging.file.name&#x3D;.&#x2F;myLog.log</span><br></pre></td></tr></table></figure>

<p>The following table shows how the <code>logging.*</code> properties can be used together:</p>
<table>
<thead>
<tr>
<th><code>logging.file.name</code></th>
<th><code>logging.file.path</code></th>
<th>Example</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>(none)</td>
<td>(none)</td>
<td><code>logging.file.name=</code></td>
<td>Console only logging.</td>
</tr>
<tr>
<td>Specific file</td>
<td>(none)</td>
<td><code>logging.file.name=my.log</code></td>
<td>Writes to the specified log file. Names can be an exact location or relative to the current directory.</td>
</tr>
<tr>
<td>(none)</td>
<td>Specific directory</td>
<td><code>logging.file.path=/var/log</code></td>
<td>Writes <code>spring.log</code> to the specified directory.  Names can be an exact location or relative to the current directory.</td>
</tr>
</tbody></table>
<p>Log files rotate when they reach 10 MB and, as with console output, ERROR-level, WARN-level, and INFO<br>-level messages are logged by default. However, if you have specified <code>debug</code> or <code>trace</code> that modifies the console log output, the log written to file will also include those <code>debug</code> or <code>trace</code> information.</p>
<p>Besides that, there are <strong>several other defaults that Spring Boot uses but can be configured</strong>:</p>
<ul>
<li>Size limits can be changed using the <code>logging.file.max-size</code> property (by default it is 10MB). </li>
<li>Rotated log files of the last 7 days are kept by default unless the <code>logging.file.max-history</code> property has been set. </li>
<li>The total size of log archives can be capped using <code>logging.file.total-sizecap</code>. When the total size of log archives exceeds that threshold, backups will be deleted. </li>
<li>To force log archive cleanup on application startup, use the <code>logging.file.clean-history-on-start</code> property.</li>
</ul>
<h3 id="Logback-Extensions"><a href="#Logback-Extensions" class="headerlink" title="Logback Extensions"></a>Logback Extensions</h3><p>By default, the logging system you use is <code>Logback</code>. You can use and configure other logging systems as well (for more details, please visit <a href="https://docs.spring.io/spring-boot/docs/2.3.1.RELEASE/reference/html/spring-boot-features.html#boot-features-custom-log-configuration" target="_blank" rel="noopener">this link</a>). But <strong>if you use Logback</strong>, Spring Boot  includes <strong>a number of extensions to Logback that can help with advanced configuration</strong>.</p>
<p>You can use these extensions <strong>in your <code>logback-spring.xml</code>(recommended) /or <code>logback.xml</code> configuration file, which you can add under the same directory as your <code>application.properties</code> file</strong></p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled="" type="checkbox"> Because the <strong>standard <code>logback.xml</code> configuration file is loaded too early (directly by the logger)</strong>, you <strong>cannot use extensions in it</strong>. You need to either <strong>use <code>logback-spring.xml</code> or define a <code>logging.config</code> property which would be loaded by Spring Boot</strong>.</li>
<li><input disabled="" type="checkbox"> The extensions <strong>cannot be used with Logback’s configuration scanning</strong>. If you attempt to do so, making changes to the configuration file results in an error.</li>
</ul>
</blockquote>
<h5 id="Profile-Specific-Configuration"><a href="#Profile-Specific-Configuration" class="headerlink" title="Profile Specific Configuration"></a>Profile Specific Configuration</h5><p>If you <strong>use <code>logback-spring.xml</code></strong> instead of <code>logback.xml</code>, you will be able to use this additional functionality <strong>provided by Spring Boot</strong>.</p>
<p>The <code>&lt;springProfile&gt;</code> tag lets you optionally <strong>include or exclude sections of configuration based on the active Spring profiles</strong>. Profile sections are supported anywhere within the <code>&lt;configuration&gt;</code> element. </p>
<p>Use the <code>name</code> attribute to specify which profile accepts the configuration. The <code>&lt;springProfile&gt;</code> tag can contain a simple profile name (for example <code>staging</code>) or a profile expression. </p>
<ul>
<li>A profile expression allows for more complicated profile logic to be expressed, for example <code>production &amp; (eu-central | eu-west)</code>. Check the <a href="https://docs.spring.io/spring/docs/5.2.6.RELEASE/spring-framework-reference/core.html#beans-definition-profiles-java" target="_blank" rel="noopener">reference guide</a> for more details.</li>
</ul>
<p>The following listing shows three sample profiles:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">"staging"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- configuration to be enabled when the "staging" profile is active --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">"dev | staging"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- configuration to be enabled when the "dev" or "staging" profiles are active --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">"!production"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- configuration to be enabled when the "production" profile is not active --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="Environment-Properties"><a href="#Environment-Properties" class="headerlink" title="Environment Properties"></a>Environment Properties</h5><p>The <code>&lt;springProperty&gt;</code> tag lets you expose properties from the Spring Environment for use within Logback. Doing so can be useful <strong>if you want to access values from your <code>application.properties</code> file</strong> in your Logback configuration. </p>
<p>The tag works in a similar way to Logback’s standard <code>&lt;property&gt;</code> tag. However, rather than specifying a direct value, you <strong>specify the source of the property</strong> (from the Environment). If you need to store the property somewhere other than in <code>local</code> scope, you can use the <code>scope</code> attribute. If you need a <code>fallback</code> value (in case the property is not set in the Environment), you can use the <code>defaultValue</code> attribute. The following example shows how to expose properties for use within Logback:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">springProperty</span> <span class="attr">scope</span>=<span class="string">"context"</span> <span class="attr">name</span>=<span class="string">"fluentHost"</span> <span class="attr">source</span>=<span class="string">"myapp.fluentd.host"</span> <span class="attr">defaultValue</span>=<span class="string">"localhost"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"FLUENT"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.more.appenders.DataFluentAppender"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">remoteHost</span>&gt;</span>$&#123;fluentHost&#125;<span class="tag">&lt;/<span class="name">remoteHost</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line"><span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Developing-Web-Applications"><a href="#Developing-Web-Applications" class="headerlink" title="Developing Web Applications"></a>Developing Web Applications</h2><p>Spring Boot is well suited for web application development. You can create a self-contained HTTP server by using embedded Tomcat, Jetty, Undertow, or Netty. <strong>Most web applications use the <code>springboot-starter-web</code> module to get up and running quickly</strong>. You can also choose to build <strong>reactive web applications by using the <code>spring-boot-starter-webflux</code> module</strong>.</p>
<h3 id="Spring-Web-MVC-Framework"><a href="#Spring-Web-MVC-Framework" class="headerlink" title="Spring Web MVC Framework"></a>Spring Web MVC Framework</h3><p>The Spring Web MVC framework (often referred to as simply “Spring MVC”) is a rich “model view controller” web framework. Spring MVC lets you <strong>create special <code>@Controller</code> or <code>@RestController</code> beans to handle incoming HTTP requests</strong> (<code>@Controller</code> would be returning data that is being rendered by <code>view</code>, and <code>@RestController</code> would be returning raw data). <strong>Methods in your controller are mapped to HTTP by using <code>@RequestMapping</code> annotations</strong>.</p>
<p>The following code shows a typical <code>@RestController</code> that serves JSON data (by default):</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value=<span class="string">"/users"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRestController</span> </span>&#123;</span><br><span class="line">	<span class="meta">@RequestMapping</span>(value=<span class="string">"/&#123;user&#125;"</span>, method=RequestMethod.GET)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">(@PathVariable Long user)</span> </span>&#123;	<span class="comment">// objects returned are turned into JSON format</span></span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@RequestMapping</span>(value=<span class="string">"/&#123;user&#125;/customers"</span>, method=RequestMethod.GET)</span><br><span class="line">	<span class="function">List&lt;Customer&gt; <span class="title">getUserCustomers</span><span class="params">(@PathVariable Long user)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@RequestMapping</span>(value=<span class="string">"/&#123;user&#125;"</span>, method=RequestMethod.DELETE)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">deleteUser</span><span class="params">(@PathVariable Long user)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Spring MVC is part of the core Spring Framework, and detailed information is available in the <a href="https://docs.spring.io/spring/docs/5.2.6.RELEASE/spring-framework-reference/web.html#mvc" target="_blank" rel="noopener">reference documentation</a>. There are also several guides that cover Spring MVC available at <a href="https://spring.io/guides" target="_blank" rel="noopener">spring.io/guides</a>.</p>
<h3 id="Spring-Boot-Framework"><a href="#Spring-Boot-Framework" class="headerlink" title="Spring Boot Framework"></a>Spring Boot Framework</h3><p>Since Spring Boot has all those AutoConfiguration classes doing the configuration work for us, it is much simpler and faster for us to develop a web application using Spring Boot. In summary, all we need to do is:</p>
<ol>
<li><strong>Create a Spring Boot project</strong> (if you use Spring Initialzr, you will see that it is based on Spring Boot) with your <strong>desired dependencies</strong></li>
<li>Spring Boot will load all those <strong>AutoConfiguration</strong> files, which you can further <strong>customize using <code>application.properties</code> or <code>application.yml</code></strong></li>
<li>Write your own program</li>
</ol>
<p>The most important step is to understand the mechanism behind AutoConfiguration, which <strong>uses the <code>xxxAutoConfiguration</code> classes that has properties injected (identified with a certain prefix)</strong>.</p>
<h4 id="Spring-Boot-Web-Application-Project-Structure"><a href="#Spring-Boot-Web-Application-Project-Structure" class="headerlink" title="Spring Boot Web Application Project Structure"></a>Spring Boot Web Application Project Structure</h4><h5 id="WebJars"><a href="#WebJars" class="headerlink" title="WebJars"></a>WebJars</h5><p><code>WebJars</code> is simply taking the concept of a JAR and applying it to client-side libraries or resources. For example, the <strong>jQuery library may be packaged as a JAR and made available to your Spring MVC application</strong>. There are several benefits to using <code>WebJars</code>, including support for Java build tools such as Gradle and Maven.</p>
<p>For Spring Boot to load and later package your web contents correctly, you need to add your contents at a correct place. If you look into your <code>WebMVCAutoConfiguration</code> class, you will see the following method:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.resourceProperties.isAddMappings()) &#123;</span><br><span class="line">        logger.debug(<span class="string">"Default resource handling disabled"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        Duration cachePeriod = <span class="keyword">this</span>.resourceProperties.getCache().getPeriod();</span><br><span class="line">        CacheControl cacheControl = <span class="keyword">this</span>.resourceProperties.getCache().getCachecontrol().toHttpCacheControl();</span><br><span class="line">        <span class="keyword">if</span> (!registry.hasMappingForPattern(<span class="string">"/webjars/**"</span>)) &#123;</span><br><span class="line">            <span class="keyword">this</span>.customizeResourceHandlerRegistration(registry.addResourceHandler(<span class="keyword">new</span> String[] <span class="string">"/webjars/**"</span>&#125;).addResourceLocations(<span class="keyword">new</span> String[]&#123;<span class="string">"classpath:/META-INF/resources/webjars/"</span>&#125;).setCachePeriod(<span class="keyword">this</span>.getSeconds(cachePeriod)).setCacheControl(cacheControl));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String staticPathPattern = <span class="keyword">this</span>.mvcProperties.getStaticPathPattern();</span><br><span class="line">        <span class="keyword">if</span> (!registry.hasMappingForPattern(staticPathPattern)) &#123;</span><br><span class="line">            <span class="keyword">this</span>.customizeResourceHandlerRegistration(registry.addResourceHandler(<span class="keyword">new</span> String[]&#123;staticPathPattern&#125;).addResourceLocations(WebMvcAutoConfiguration.getResourceLocations(<span class="keyword">this</span>.resourceProperties.getStaticLocations())).setCachePeriod(<span class="keyword">this</span>.getSeconds(cachePeriod)).setCacheControl(cacheControl));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>So you see that all your web contents need to be placed in <code>classpath:/META-INF/resources/webjars/</code> directory. This means that <strong>within your project, any file stored under <code>/META-INF/resources/webjars/</code> can be visited by <code>localhost:&lt;yourPort&gt;/webjars/&lt;filePath&gt;</code></strong></p>
<p>For example, on the <a href="https://www.webjars.org/" target="_blank" rel="noopener">https://www.webjars.org/</a> you can choose which <code>webjar</code>s to import into your project by copying the following to your <code>pom</code> file. </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.webjars<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>bootstrap<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Then in your external dependency, you can see that it also has the structure mentioned above, and you can <strong>visit its resources with <code>localhost:8080/webjars/bootstrap/4.0.0/webjars-requirejs.js</code></strong>, for example. Then you will see that <code>js</code> file displayed:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*global requirejs */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Ensure any request for this webjar brings in jQuery.</span></span><br><span class="line">requirejs.config(&#123;</span><br><span class="line">  paths: &#123; </span><br><span class="line">    <span class="string">"bootstrap"</span>: webjars.path(<span class="string">"bootstrap"</span>, <span class="string">"js/bootstrap"</span>),</span><br><span class="line">    <span class="string">"bootstrap-css"</span>: webjars.path(<span class="string">"bootstrap"</span>, <span class="string">"css/bootstrap"</span>)  </span><br><span class="line">  &#125;,</span><br><span class="line">  shim: &#123; <span class="string">"bootstrap"</span>: [ <span class="string">"jquery"</span> ] &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="Static-contents"><a href="#Static-contents" class="headerlink" title="Static contents"></a>Static contents</h5><p>In the same method where you find those <code>webjar</code> structure, you can also find where you should store your static contents:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String staticPathPattern = <span class="keyword">this</span>.mvcProperties.getStaticPathPattern();</span><br><span class="line">                <span class="keyword">if</span> (!registry.hasMappingForPattern(staticPathPattern)) &#123;</span><br><span class="line">                    <span class="keyword">this</span>.customizeResourceHandlerRegistration(registry.addResourceHandler(<span class="keyword">new</span> String[]&#123;staticPathPattern&#125;).addResourceLocations(WebMvcAutoConfiguration.getResourceLocations(<span class="keyword">this</span>.resourceProperties.getStaticLocations())).setCachePeriod(<span class="keyword">this</span>.getSeconds(cachePeriod)).setCacheControl(cacheControl));</span><br><span class="line">                &#125;</span><br></pre></td></tr></table></figure>

<p>which finds your resource under the following directories:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"classpath:/META-INF/resources/"</span>, </span><br><span class="line"><span class="string">"classpath:/resources/"</span>, </span><br><span class="line"><span class="string">"classpath:/static/"</span>, </span><br><span class="line"><span class="string">"classpath:/public/"</span></span><br><span class="line"><span class="string">"/"</span> (project root path)</span><br></pre></td></tr></table></figure>

<p>This means that if a <strong>request is not handled</strong>, you will be <strong>redirected to the static files under those locations</strong>. </p>
<p>For example, if you have an html page under the following directory:</p>
<p><img src="staticdirectory.png" alt="staticdirectory.png" title="staticdirectory.png"></p>
<p>Then you can visit the html by `localhost:8080/signin/index.html    </p>
<h5 id="Welcome-Page"><a href="#Welcome-Page" class="headerlink" title="Welcome Page"></a>Welcome Page</h5><p>Welcome page is basically the home page of your application. Spring Boot also has a default mapping defined in the <code>WebMvcAutoConfiguration</code> class:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> WelcomePageHandlerMapping <span class="title">welcomePageHandlerMapping</span><span class="params">(ApplicationContext applicationContext, FormattingConversionService mvcConversionService, ResourceUrlProvider mvcResourceUrlProvider)</span> </span>&#123;</span><br><span class="line">    WelcomePageHandlerMapping welcomePageHandlerMapping = <span class="keyword">new</span> WelcomePageHandlerMapping(<span class="keyword">new</span> TemplateAvailabilityProviders(applicationContext), applicationContext, <span class="keyword">this</span>.getWelcomePage(), <span class="keyword">this</span>.mvcProperties.getStaticPathPattern());</span><br><span class="line">    welcomePageHandlerMapping.setInterceptors(<span class="keyword">this</span>.getInterceptors(mvcConversionService, mvcResourceUrlProvider));</span><br><span class="line">    welcomePageHandlerMapping.setCorsConfigurations(<span class="keyword">this</span>.getCorsConfigurations());</span><br><span class="line">    <span class="keyword">return</span> welcomePageHandlerMapping;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This in the end will <strong>look for <code>index.html</code> below all static content directories mentioned above, and maps to `/</strong>`.**</p>
<p>For example, if you have the following structure:</p>
<p><img src="homepagedirectory.png" alt="homepagedirectory.png" title="homepagedirectory.png"></p>
<p>Then you can <strong>visit this <code>index.html</code> by <code>localhost:8080/</code></strong></p>
<h5 id="Configure-Your-Web-Properties"><a href="#Configure-Your-Web-Properties" class="headerlink" title="Configure Your Web Properties"></a>Configure Your Web Properties</h5><p>If you want to <strong>customize those locations, you can also use the <code>spring.resources.xxx</code></strong> to modify the default paths scanned.</p>
<p>This works because in the <code>ResoucrProperties</code> class, Spring Boot defines locations for scanning static resources as shown below:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(</span><br><span class="line">    prefix = <span class="string">"spring.resources"</span>,</span><br><span class="line">    ignoreUnknownFields = <span class="keyword">false</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResourceProperties</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] CLASSPATH_RESOURCE_LOCATIONS = <span class="keyword">new</span> String[]&#123;<span class="string">"classpath:/META-INF/resources/"</span>, <span class="string">"classpath:/resources/"</span>, <span class="string">"classpath:/static/"</span>, <span class="string">"classpath:/public/"</span>&#125;;</span><br></pre></td></tr></table></figure>

<p>This means you can change those locations by specifying in your <code>application.properties</code> or <code>applications.yml</code>:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.resources.static-locations</span>=<span class="string">classpath:/hello/, classpath:/example</span></span><br></pre></td></tr></table></figure>

<h4 id="Using-Web-Templates"><a href="#Using-Web-Templates" class="headerlink" title="Using Web Templates"></a>Using Web Templates</h4><p>Web templates can be used to generate dynamic contents based on static templates. The basic mechanism is shown below:</p>
<p><img src="web-template-engine.png" alt="web-template-engine.png" title="web-template-engine.png"></p>
<p>Common template engines include <code>JSP</code>, <code>Velocity</code>, <code>Freemarker</code>,<code>Thymeleaf</code>, among which <strong><code>Thymeleaf</code> is the default template engine used by Spring Boot.</strong></p>
<h5 id="Importing-Thymeleaf"><a href="#Importing-Thymeleaf" class="headerlink" title="Importing Thymeleaf"></a>Importing Thymeleaf</h5><p>Since we are using Spring Boot with Maven, it is easy to include <code>thymeleaf</code> into your project. If you have already inherited the parent <code>spring-boot-starter</code> , then you just need to <strong>include the following dependency</strong> in your <code>pom</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>However, this uses the version <code>2.3.1</code> (specified in the parent <code>pom</code>). It is recommended to use <code>thymeleaf 3</code> or above for more functionalities. To do this, you need to configure the <code>properties</code> in your <code>pom</code>.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- This is how you change your Thymeleaf version --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">thymeleaf.version</span>&gt;</span>3.0.11.RELEASE<span class="tag">&lt;/<span class="name">thymeleaf.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">thymeleaf-layout-dialect.version</span>&gt;</span>2.1.1<span class="tag">&lt;/<span class="name">thymeleaf-layout-dialect.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="Using-Thymeleaf"><a href="#Using-Thymeleaf" class="headerlink" title="Using Thymeleaf"></a>Using Thymeleaf</h5><p>The simplest example of using <code>Thymeleaf</code> would be to return an html page upon a request.</p>
<p>If we look into the <code>ThymeleafProperties</code> class (located in <code>SpringBootAutoConfigure</code> jar, under the folder <code>thymeleaf</code>), you will see:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(</span><br><span class="line">    prefix = <span class="string">"spring.thymeleaf"</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThymeleafProperties</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Charset DEFAULT_ENCODING;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_PREFIX = <span class="string">"classpath:/templates/"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_SUFFIX = <span class="string">".html"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> checkTemplate = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> checkTemplateLocation = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">private</span> String prefix = <span class="string">"classpath:/templates/"</span>;</span><br><span class="line">    <span class="keyword">private</span> String suffix = <span class="string">".html"</span>;</span><br><span class="line">    <span class="keyword">private</span> String mode = <span class="string">"HTML"</span>;</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<p>where</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_PREFIX = <span class="string">"classpath:/templates/"</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_SUFFIX = <span class="string">".html"</span>;</span><br></pre></td></tr></table></figure>

<p>means that <code>Thymeleaf</code> <strong>scans through <code>classpath:/templates/</code> for files ending with <code>.html</code> to be rendered</strong>.</p>
<p>Now, to hand you back a html page based on request using <code>Thymeleaf</code>, all you need to do is add a <code>html</code> page with the same return result as your <code>html</code> in your <code>templates</code> folder:</p>
<p>For example, if you have</p>
<p><img src="thymeleaf-html.png" alt="thymeleaf-html.png" title="thymeleaf-html.png"></p>
<p>Then your handler could look like:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HTMLRequests</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/getHtmlPage"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">testHTMLRequest</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"request1"</span>;  <span class="comment">// this has to be the same as the html file name</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled="" type="checkbox"> Now you <strong>should not use a <code>@RestController</code></strong>, since it will automatically use the <code>@ResponceBody</code> which will render the page by Spring Boot itself instead of by <code>Thymeleaf</code></li>
</ul>
</blockquote>
<h5 id="Thymeleaf-Syntax"><a href="#Thymeleaf-Syntax" class="headerlink" title="Thymeleaf Syntax"></a>Thymeleaf Syntax</h5><p>For more information, you can follow the <a href="https://www.thymeleaf.org/" target="_blank" rel="noopener">official thymeleaf guide</a>.</p>
<ol>
<li><p><code>th:xxx</code></p>
<ul>
<li><p>If you <strong>place <code>th:&lt;xxx&gt;</code> inside any html tag</strong>, where <code>&lt;xxx&gt;</code> could be any HTML property (including <code>text</code>, <code>class</code>, <code>id</code>, etc.), then <code>Thymeleaf</code> will <strong>replace the original value with the value you specified</strong>. For example, you can replace the text appearing in a <code>div</code> with:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Value placed would be parsed as a key, whose value you need to specifiy in your Handler method --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:text</span>=<span class="string">"$&#123;Hello&#125;"</span>&gt;</span></span><br><span class="line">    Original Text</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>and the corresponding Java class could look like:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HTMLRequests</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/getHtmlPage"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">testHTMLRequest</span><span class="params">(Map&lt;String, String&gt; map1)</span></span>&#123;</span><br><span class="line">        map1.put(<span class="string">"Hello"</span>,<span class="string">"Value Retrieved from key Hello"</span>);	<span class="comment">// the value will be retrieved</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"request1"</span>;  <span class="comment">// this tells you which html file to return</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Precendence</p>
<ul>
<li><p>Since there is no notion of code precedence in html, if we specified multiple <code>th:xxx</code> within the same tag, collision will happen. To solve this, <code>Thymeleaf</code> <strong>defines its own precedence rule</strong>:</p>
<p><img src="thymeleaf-precedence.png" alt="thymeleaf-precedence.png" title="thymeleaf-precedence.png"></p>
</li>
</ul>
</li>
<li><p>Thymeleaf Expressions</p>
<ul>
<li><pre><code class="yml"><span class="attr">Simple expressions:</span>
    <span class="attr">Variable Expressions:</span> <span class="string">${...}</span>
        <span class="comment"># can be used to read/store objects, and invoking certain methods on them</span>
    <span class="attr">Selection Variable Expressions:</span> <span class="string">*{...}</span>
        <span class="comment"># mainly used in combination with th:object, which stores an object in the current scope</span>
        <span class="comment"># then using *{...} will select/read a certain attribute of that stored object</span>
    <span class="attr">Message Expressions:</span> <span class="comment">#{...}</span>
        <span class="comment"># used for internationalization</span>
    <span class="attr">Link URL Expressions:</span> <span class="string">@{...}</span>
        <span class="comment"># used for generating dynamic URL addresses</span>
        <span class="comment"># for example:</span>
        <span class="string">&lt;!--</span> <span class="string">Will</span> <span class="string">produce</span> <span class="string">'http://localhost:8080/gtvg/order/details?orderId=3'</span> <span class="string">(plus</span> <span class="string">rewriting)</span> <span class="string">--&gt;</span>
        <span class="string">&lt;a</span> <span class="string">href="details.html"</span> <span class="string">th:href="@{http://localhost:8080/gtvg/order/details(orderId=${o.id})}"&gt;view&lt;/a&gt;</span>

        <span class="string">&lt;!--</span> <span class="string">Will</span> <span class="string">produce</span> <span class="string">'/gtvg/order/details?orderId=3'</span> <span class="string">(plus</span> <span class="string">rewriting)</span> <span class="string">--&gt;</span>
        <span class="string">&lt;a</span> <span class="string">href="details.html"</span> <span class="string">th:href="@{/order/details(orderId=${o.id})}"&gt;view&lt;/a&gt;</span>
    <span class="attr">Fragment Expressions:</span> <span class="string">~{...}</span>
        <span class="comment"># this will be talked about later </span>
<span class="attr">Literals:</span>
    <span class="attr">Text literals:</span> <span class="string">'one text'</span> <span class="string">,</span> <span class="string">'Another one!'</span> <span class="string">,…</span>
    <span class="attr">Number literals:</span> <span class="number">0</span> <span class="string">,</span> <span class="number">34</span> <span class="string">,</span> <span class="number">3.0</span> <span class="string">,</span> <span class="number">12.3</span> <span class="string">,…</span>
    <span class="attr">Boolean literals:</span> <span class="literal">true</span> <span class="string">,</span> <span class="literal">false</span>
    <span class="attr">Null literal:</span> <span class="literal">null</span>
    <span class="attr">Literal tokens:</span> <span class="string">one</span> <span class="string">,</span> <span class="string">sometext</span> <span class="string">,</span> <span class="string">main</span> <span class="string">,…</span>
<span class="attr">Text operations:</span>
    <span class="attr">String concatenation:</span> <span class="string">+</span>
    <span class="attr">Literal substitutions:</span> <span class="string">|The</span> <span class="string">name</span> <span class="string">is</span> <span class="string">${name}|</span>
<span class="attr">Arithmetic operations:</span>
    <span class="attr">Binary operators:</span> <span class="string">+</span> <span class="string">,</span> <span class="bullet">-</span> <span class="string">,</span> <span class="string">*</span> <span class="string">,</span> <span class="string">/</span> <span class="string">,</span> <span class="string">%</span>
    <span class="string">Minus</span> <span class="string">sign</span> <span class="string">(unary</span> <span class="string">operator):</span> <span class="bullet">-</span>
<span class="attr">Boolean operations:</span>
    <span class="attr">Binary operators:</span> <span class="string">and</span> <span class="string">,</span> <span class="string">or</span>
    <span class="string">Boolean</span> <span class="string">negation</span> <span class="string">(unary</span> <span class="string">operator):</span> <span class="string">!</span> <span class="string">,</span> <span class="string">not</span>
<span class="attr">Comparisons and equality:</span>
    <span class="attr">Comparators:</span> <span class="string">&gt;</span> <span class="string">,</span> <span class="string">&lt;</span> <span class="string">,</span> <span class="string">&gt;=</span> <span class="string">,</span> <span class="string">&lt;=</span> <span class="string">(</span> <span class="string">gt</span> <span class="string">,</span> <span class="string">lt</span> <span class="string">,</span> <span class="string">ge</span> <span class="string">,</span> <span class="string">le</span> <span class="string">)</span>
    <span class="attr">Equality operators:</span> <span class="string">==</span> <span class="string">,</span> <span class="string">!=</span> <span class="string">(</span> <span class="string">eq</span> <span class="string">,</span> <span class="string">ne</span> <span class="string">)</span>
<span class="attr">Conditional operators:</span>
    <span class="attr">If-then:</span> <span class="string">(if)</span> <span class="string">?</span> <span class="string">(then)</span>
    <span class="attr">If-then-else:</span> <span class="string">(if)</span> <span class="string">?</span> <span class="string">(then)</span> <span class="string">:</span> <span class="string">(else)</span>
        <span class="comment"># same as Java tertiary operation</span>
    <span class="attr">Default:</span> <span class="string">(value)</span> <span class="string">?:</span> <span class="string">(defaultvalue)</span>
<span class="attr">Special tokens:</span>
    <span class="attr">No-Operation:</span> <span class="string">_</span>
<span class="string"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">     (For more information, please visit Chapter 4 of the [Thymeleaf Documentation](https:&#x2F;&#x2F;www.thymeleaf.org&#x2F;doc&#x2F;tutorials&#x2F;3.0&#x2F;usingthymeleaf.html))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Example:</span><br><span class="line"></span><br><span class="line">In your Java program, you can have:</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;java</span><br><span class="line">@Controller</span><br><span class="line">public class HTMLRequests &#123;</span><br><span class="line">    @RequestMapping(&quot;&#x2F;getHtmlPage&quot;)</span><br><span class="line">    public String testHTMLRequest(Map&lt;String, String&gt; map1, Map&lt;String, Object&gt; map2)&#123;</span><br><span class="line">        map1.put(&quot;Hello&quot;,&quot;&lt;h3&gt;Value Retrieved from key Hello with h3 heading&lt;h3&gt;&quot;);</span><br><span class="line"></span><br><span class="line">        String[] names &#x3D; &#123;&quot;jason&quot;,&quot;michael&quot;,&quot;bowen&quot;&#125;;</span><br><span class="line">        List users &#x3D; Arrays.asList(names);</span><br><span class="line">        map2.put(&quot;Users&quot;,users);</span><br><span class="line">        return &quot;request1&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></span>
</code></pre>
</li>
</ul>
</li>
</ol>
<p>In your html code, you can have:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span>    <span class="comment">&lt;!-- Adding this line enables syntax correction/suggestion --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Test Request<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span> A paragraph here <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- th:text configures/replaces the text appearing in the div to display value that maps to key=hello --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- th:utext does not translate html element tags, which means if you had h1 tag in your value, it will be displayed as h1 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:utext</span>=<span class="string">"$&#123;Hello&#125;"</span>&gt;</span>Original text<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- This for each will generate multiple h5 tags --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h5</span> <span class="attr">th:text</span>=<span class="string">"$&#123;user&#125;"</span> <span class="attr">th:each</span>=<span class="string">"user:$&#123;Users&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">h5</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:each</span>=<span class="string">"user:$&#123;Users&#125;"</span>&gt;</span>[[$&#123;user&#125;]] <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>where</p>
<ul>
<li><code>th:each</code> can be seen as a <strong>for loop iteration</strong>, that does the work of <code>for element: iterable</code>.</li>
<li><code>[[${}]]</code> is the <strong>inline version of <code>th:text=${}</code></strong>. <code>[(${})]</code> is the <strong>inline version of <code>th:utext=&quot;${}&quot;</code></strong></li>
</ul>
<h5 id="Internationalization-Example"><a href="#Internationalization-Example" class="headerlink" title="Internationalization Example"></a>Internationalization Example</h5><p>To enable your website to show contents in different languages based on users’ preferences (e.g. browser language used), you need to use internationalization, which is supported by Spring Boot. (In Spring MVC, this is configured by <code>MessageResouce</code> class. However, in Spring Boot, it is configured automatically with <code>MessageSourceAutoConfiguration</code>.)</p>
<p>In summary, you need to do the following steps:</p>
<ul>
<li>Create a new folder under your <code>resource</code> folder, in which you will store all your internationalization properties file.</li>
<li><strong>Create</strong> properties file in the format of <strong><code>&lt;xxx&gt;.properties</code></strong>, which will be used as the <strong>default properties</strong> file for that specific page <code>xxx</code> (for example).</li>
<li><strong>Create</strong> other properties file in the format of <strong><code>&lt;xxx&gt;_&lt;language&gt;_&lt;CountryCode&gt;.properties</code></strong>. In this way, IntelliJ will recognize them, knowing that you are doing internationalization.</li>
<li>Now, since IntelliJ recognized them as internationalization files, you can <strong>use the <code>Resource Bundle</code> option</strong> when editing your properties file.</li>
<li>After configuring your <code>properties</code> file, you need to <strong>specify  the base path (e.g. a property under the location <code>resources/i18n/login_en_US.properties</code> have the base path of <code>i18n.login</code> ) of your <code>properties</code> file with <code>spring.messages.basename=&lt;yourBasePath&gt;</code></strong> in your <code>application.properties</code>.</li>
<li>Finally, you just need to go to your html page and <strong>use the <code>thmeleaf</code> messages expression <code>#{...}</code></strong> (for example, if you had a property named <code>login.title=...</code> in your <code>login_en_US.properties</code> file, you should use <code>#{login.title}</code>) to <strong>render your message expression text automatically based on your browser language</strong>.</li>
</ul>
<p>For example:</p>
<ul>
<li>if you have done step 1-4 correctly, you should be working like this:</li>
</ul>
<p><img src="interationalization-example.png" alt="interationalization-example.png" title="interationalization-example.png"></p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled="" type="checkbox"> <p>If you used Chinese in your properties files, and you <strong>get unreadable codes</strong>, you might need to <strong>change your decoding to enable ASCII conversion</strong>. For example, you can try the following:</p>
<p><img src="change_encoding.png" alt="change_encoding.png" title="change_encoding.png"></p>
</li>
</ul>
</blockquote>
<p><strong>If you want to achieve the language swapping by a button on your page, you need to use the <code>LocaleResolver</code> class</strong> (also inside the <code>MessageResouceAutoConfiguration</code> class).</p>
<p>By default, this works by getting the section <code>Accept-Language</code> in the <strong>request header</strong> when you send your html request. To override this behavior, you need to write your own <code>LocaleResolver</code> class.</p>
<p>For example, </p>
<ol>
<li>first <strong>in your html page</strong>, you would have a button that creates those <strong>request</strong> with language:</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- this will be parsed as index.html?l=zh_CN, where index.html would be this same page --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">...</span> <span class="attr">th:href</span>=<span class="string">"@&#123;/index.html(l="</span><span class="attr">zh_CN</span>")&#125;"&gt;</span>中文<span class="tag">&lt;/<span class="name">...</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">...</span> <span class="attr">th:href</span>=<span class="string">"@&#123;/index.html(l="</span><span class="attr">en_US</span>")&#125;"&gt;</span>English<span class="tag">&lt;/<span class="name">...</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>In your <code>MyLocaleResolver</code></strong> class, you can write:</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyLocaleResolver</span> <span class="keyword">implements</span> <span class="title">LocaleResolver</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Locale <span class="title">resolveLocale</span><span class="params">(HttpServletRequest request)</span></span>&#123;</span><br><span class="line">        String lang = request.getParameter(<span class="string">"l"</span>); <span class="comment">// getting the information l=zh_Ch from the request, for example</span></span><br><span class="line">        Locale locale = Locale.getDefault(); <span class="comment">// if there is none, then gets the default Locale information</span></span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.isEmpty(l))&#123;</span><br><span class="line">            String[] split = l.split(<span class="string">"_"</span>); <span class="comment">// gets the language and country code</span></span><br><span class="line">            locale = <span class="keyword">new</span> Locale(split[<span class="number">0</span>]. split[<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> locale;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLocale</span><span class="params">(...)</span></span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>Add this component to your application as a bean</strong>. This is because the Spring Boot <code>LocaleResolver</code> is injected with the condition: <code>@ConditionalOnMissingBean</code>, meaning that if we injected this bean, then Spring Boot’s default resolver will not be activated:</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// in one of your @Configuration class, for example</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> LocaleResolver <span class="title">localeResolver</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> MyLocaleResolver();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Sending-and-Handling-Post-Request"><a href="#Sending-and-Handling-Post-Request" class="headerlink" title="Sending and Handling Post Request"></a>Sending and Handling Post Request</h4><p>To handle a user login, for example, you need to do two parts (in abstract). </p>
<ol>
<li>First, in your HTML page, you need to <strong>send a request</strong> (<code>th:action=&quot;@{&lt;xxx&gt;}&quot;</code>) with your form, in which you have each field that you need to be set with a specific <strong><code>name=xxx</code> attribute</strong>.</li>
<li>Then, you add a handler to with <code>PostController()</code> to map to that request, and gets the value in those fields with <code>@RequestParam(&quot;&lt;xxx&gt;&quot;) String xxx</code>.</li>
</ol>
<p>For example:</p>
<p>In your html page, you can have:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"..."</span> <span class="attr">action</span>=<span class="string">"..."</span> <span class="attr">th:action</span>=<span class="string">"@&#123;/user-login&#125;"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"..."</span> <span class="attr">class</span>=<span class="string">"..."</span> <span class="attr">placeholder</span>=<span class="string">"..."</span> <span class="attr">name</span>=<span class="string">"username"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"..."</span> <span class="attr">class</span>=<span class="string">"..."</span> <span class="attr">placeholder</span>=<span class="string">"..."</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>In your Java class, you can have:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginController</span></span>&#123;</span><br><span class="line">    <span class="comment">// same as @RequestMapping(method=RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@PostMapping</span>(value=<span class="string">"/user-login"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">(@RequestParam(<span class="string">"username"</span>)</span> String username,</span></span><br><span class="line"><span class="function">                       @<span class="title">RequestParam</span><span class="params">(<span class="string">"password"</span>)</span> String password)</span>&#123;</span><br><span class="line">        ... <span class="comment">// your logic to check those username and passwords</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"dashboard"</span>	<span class="comment">// the page in templates folder that you want to show to logged in users</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled="" type="checkbox"> If <strong>hot swapping is not working</strong> (assuming you have enabled it) when you <strong>changed those static/templates html code</strong>, you should try:<ul>
<li><input disabled="" type="checkbox"> <ol>
<li>add the line <code>spring.thymeleaf.cache=false</code> in your <code>application.properties</code> file</li>
<li>use <code>Ctrl+F9</code> or manually click the build button to <strong>rebuild your project</strong></li>
</ol>
</li>
</ul>
</li>
</ul>
</blockquote>
<p>If you want to <strong>add the functionality of popping up red text in your html page with <code>Login Failed</code></strong> when your user failed the authentication, you can use the <code>th:if</code> functionality with some small changes to your controller code:</p>
<p>In your controller:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginController</span></span>&#123;</span><br><span class="line">    <span class="comment">// same as @RequestMapping(method=RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@PostMapping</span>(value=<span class="string">"/user-login"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">(@RequestParam(<span class="string">"username"</span>)</span> String username,</span></span><br><span class="line"><span class="function">                       @<span class="title">RequestParam</span><span class="params">(<span class="string">"password"</span>)</span> String password</span></span><br><span class="line"><span class="function">                       Map&lt;String, String&gt; errmsg)</span>&#123;</span><br><span class="line">        ... <span class="comment">// your logic to check those username and passwords</span></span><br><span class="line">        <span class="keyword">if</span>(failed to authenticate)&#123;</span><br><span class="line">            errmsg.put(<span class="string">"msg"</span>,<span class="string">"Login Failed"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"login"</span> <span class="comment">// your original page</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"dashboard"</span>	<span class="comment">// the page in templates folder that you want to show to logged in users</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then in your html code, you can have:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- For example, you can place in inside the form you use to submit login information --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">"color: red"</span> <span class="attr">th:text</span>=<span class="string">"$&#123;msg&#125;"</span> <span class="attr">th:if</span>=<span class="string">"not #strings.isEmpty(msg)"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="RequestParam-PathParam-Param"><a href="#RequestParam-PathParam-Param" class="headerlink" title="@RequestParam/@PathParam/@Param"></a><code>@RequestParam</code>/<code>@PathParam</code>/<code>@Param</code></h4><p>The difference between <code>@RequestParam</code> and <code>@PathParam</code> is best illustrated from using an example. </p>
<p>The general difference between the two can be seen from the following html request:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">localhost:8080/home/<span class="tag">&lt;<span class="name">PathParam</span>&gt;</span>/somethingelse?<span class="tag">&lt;<span class="name">RequestParam</span>&gt;</span>=something</span><br></pre></td></tr></table></figure>

<p>Therefore, suppose you made a html request:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">localhost:8080/home/jason/somethingelse?order=something</span><br></pre></td></tr></table></figure>

<p>Then you can get the parameter <code>jason</code> and <code>order=something</code> with:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/home/&#123;user&#125;/somethingelse"</span>, method = RequestMethod.GET)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getOrder</span><span class="params">(@PathVariable <span class="keyword">final</span> String user, </span></span></span><br><span class="line"><span class="function"><span class="params">                       @RequestParam String order)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> ...;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This makes it clear, so that :</p>
<ul>
<li><code>@PathVariable</code> gets the variable in the path with the format <code>{&lt;VariableName&gt;}</code></li>
<li><code>@RequestParam</code> gets the variable in the request parameter (the key-value pair after the query <code>?</code> punctuation)</li>
</ul>
<p>On the other hand, <code>@Param</code> does the reverse job of making a specific variable in the method available for outer access.</p>
<p>For example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">listUser</span><span class="params">(@Param(value = <span class="string">"userName"</span>)</span> String userName)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then when <strong>this method is called</strong> with an input argument, you can get it in a <code>xml</code> mapper, for example:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Other section of this xml ignored for simplicity --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"listUser"</span> <span class="attr">parameterType</span>=<span class="string">"java.lang.String"</span> <span class="attr">resultMap</span>=<span class="string">"userResultMap"</span>&gt;</span></span><br><span class="line">    select * from User</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- This is where userName variable is used --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userName != '' and userName != null"</span>&gt;</span></span><br><span class="line">            name like CONCAT(#&#123;userName&#125;,'%')</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Spring-Boot-MVC-Extensions"><a href="#Spring-Boot-MVC-Extensions" class="headerlink" title="Spring Boot MVC Extensions"></a>Spring Boot MVC Extensions</h3><p>Spring Boot provides auto-configuration for Spring MVC that works well with most applications. The auto-configuration adds the following features on top of Spring’s defaults:</p>
<ul>
<li>Inclusion of <code>ContentNegotiatingViewResolver</code> and <code>BeanNameViewResolver</code> beans.</li>
<li>Support for serving static resources, including support for <code>WebJar</code>s (covered before)).</li>
<li>Automatic registration of <code>Converter</code>, <code>GenericConverter</code>, and <code>Formatter</code> beans.<ul>
<li>For example, converting an object to <code>json</code> format</li>
</ul>
</li>
<li>Support for <code>HttpMessageConverters</code>.<ul>
<li>For example, converts and handles http request</li>
</ul>
</li>
<li>Automatic regis tration of <code>MessageCodesResolver</code> (covered later in this document).</li>
<li>Static <code>index.html</code> support (covered before)</li>
<li>Custom Favicon support </li>
<li>Automatic use of a <code>ConfigurableWebBindingInitializer</code> bean.</li>
</ul>
<p>If you want to <strong>keep those Spring Boot MVC customizations and make more MVC customizations</strong> (<code>interceptors</code>, <code>formatters</code>, <code>view</code> controllers, and other features), you can add your own <code>@Configuration</code> class of type <code>WebMvcConfigurer</code> but <strong>without <code>@EnableWebMvc</code></strong>. </p>
<p>If you want to provide custom instances of <code>RequestMappingHandlerMapping</code>, <code>RequestMappingHandlerAdapter</code>, or <code>ExceptionHandlerExceptionResolver</code>, and <strong>still keep the Spring Boot MVC customizations</strong>, you can <strong>declare a bean of type <code>WebMvcRegistrations</code> and use it to provide custom instances of those components</strong>. </p>
<p>If you want to take <strong>complete control of Spring MVC, you can add your own <code>@Configuration</code> annotated with <code>@EnableWebMvc</code></strong>, or alternatively add your own <code>@Configuration</code>-annotated <code>DelegatingWebMvcConfiguration</code> as described in the Javadoc of <code>@EnableWebMvc</code>.</p>
<h4 id="Example-Adding-a-ViewController"><a href="#Example-Adding-a-ViewController" class="headerlink" title="Example: Adding a ViewController"></a>Example: Adding a ViewController</h4><p>If you want to control a certain request to show the output of another request, you can use a ViewController to control the view of a page. However, by default Spring Boot <strong>does not have AutoConfiguration classes for that</strong>. Therefore, you would need to add your own ViewController by “adding your own <code>@Configuration</code> class of type <code>WebMvcConfigurer</code> but <strong>without <code>@EnableWebMvc</code></strong>“ (mentioned above).</p>
<p>For instance, to map the request <code>/request</code> to <code>request1</code> (which you specified as a html page configured by <code>Thymeleaf</code>), you need to write the configuration class:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">myMVCExtensionConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addViewController(<span class="string">"/request"</span>).setViewName(<span class="string">"request1"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Mechanism"><a href="#Mechanism" class="headerlink" title="Mechanism"></a>Mechanism</h4><p>Since <code>WebMvcAutoConfiguration</code> is the AutoConfiguration class for Spring MVC, we can look into that class to understand those extension mechanisms. Within that class, you will see:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import</span>(&#123;WebMvcAutoConfiguration.EnableWebMvcConfiguration<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class">@<span class="title">EnableConfigurationProperties</span>(</span>&#123;WebMvcProperties<span class="class">.<span class="keyword">class</span>, <span class="title">ResourceProperties</span>.<span class="title">class</span>&#125;)</span></span><br><span class="line"><span class="class">@<span class="title">Order</span>(0)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">static</span> <span class="title">class</span> <span class="title">WebMvcAutoConfigurationAdapter</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Which imports <code>WebMvcAutoConfiguration.EnableWebMvcConfiguration.class</code>, and that class extends <code>DelegatingWebMvcConfiguration</code> by having the following signature:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">EnableWebMvcConfiguration</span> <span class="keyword">extends</span> <span class="title">DelegatingWebMvcConfiguration</span> <span class="keyword">implements</span> <span class="title">ResourceLoaderAware</span> </span>&#123;</span><br></pre></td></tr></table></figure>

<p>Finally, in the parent class, you will see:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span>(</span><br><span class="line">    required = <span class="keyword">false</span></span><br><span class="line">)	<span class="comment">// since it is AutoWired, those configures are obtained from the IoC container</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setConfigurers</span><span class="params">(List&lt;WebMvcConfigurer&gt; configurers)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!CollectionUtils.isEmpty(configurers)) &#123;</span><br><span class="line">        <span class="keyword">this</span>.configurers.addWebMvcConfigurers(configurers);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.configurers.addViewControllers(registry);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>And finally if we trace the <code>configureViewResolvers</code> method, we will see:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">    Iterator var2 = <span class="keyword">this</span>.delegates.iterator();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(var2.hasNext()) &#123;</span><br><span class="line">        WebMvcConfigurer delegate = (WebMvcConfigurer)var2.next();</span><br><span class="line">        delegate.addViewControllers(registry);	<span class="comment">// calls the method addViewControllers on each WebMvcConfigurer class</span></span><br><span class="line">        										<span class="comment">// and add them to the registry object</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This is why we needed to extend <code>WebMvcConfigurer</code> class for extending its functionality, add calling the method <code>addViewControllers()</code> in the above example to add our <code>ViewController</code>.</p>
<h2 id="Graceful-shutdown"><a href="#Graceful-shutdown" class="headerlink" title="Graceful shutdown"></a>Graceful shutdown</h2><p>Graceful shutdown is supported with all four embedded web servers (Jetty, Reactor Netty, Tomcat, and Undertow) and with both reactive and Servlet-based web applications. It occurs as part of closing the application context and is performed in the earliest phase of stopping SmartLifecycle beans. </p>
<p>This stop processing uses a timeout which provides a grace period during <strong>which existing requests will be allowed to complete but no new requests will be permitted</strong>. The exact way in which new requests are not permitted varies depending on the web server that is being used. Jetty, Reactor Netty, and Tomcat will stop accepting requests at the network layer. Undertow will accept requests but respond immediately with a service unavailable (503) response.</p>
<p>To enable graceful shutdown, configure the server.shutdown property, as shown in the following example:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server.shutdown=graceful</span><br></pre></td></tr></table></figure>

<h2 id="Working-With-Databases"><a href="#Working-With-Databases" class="headerlink" title="Working With Databases"></a>Working With Databases</h2><h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>Spring Boot allows for both the use of relational databases and non-relational databases. This is achieved by <strong>using the Spring Data project,</strong> which handles all those requests for us by enabling a number of auto configurations, including some database settings. For more information, you can look at <a href="https://spring.io/projects/spring-data" target="_blank" rel="noopener">the official documentation</a>. </p>
<h3 id="Using-JDBC"><a href="#Using-JDBC" class="headerlink" title="Using JDBC"></a>Using JDBC</h3><p>Connecting to databases in Spring Boot is generally easy to do. All you need to make sure is that:</p>
<ol>
<li>Your IP address is valid for connection to your remote database (applies only if you are using a remote database)</li>
<li>You configured your login credentials properly in <code>application.yml</code> or <code>application.properties</code></li>
<li>Finally you can just use a<code>autowired</code> <code>DataSource</code> object in Spring Boot to establish a connection.</li>
</ol>
<h4 id="Adding-JDBC-in-Maven-Dependency"><a href="#Adding-JDBC-in-Maven-Dependency" class="headerlink" title="Adding JDBC in Maven Dependency"></a>Adding JDBC in Maven Dependency</h4><p>To use JDBC, you need to add the following dependencies:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="Configuring-Your-Login-Credentials"><a href="#Configuring-Your-Login-Credentials" class="headerlink" title="Configuring Your Login Credentials"></a>Configuring Your Login Credentials</h4><p>You can configure your login credentials either in <code>application.yml</code> or in <code>application.properties</code> </p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring</span>:<span class="string"></span></span><br><span class="line">  <span class="attr">datasource</span>:<span class="string"></span></span><br><span class="line">    <span class="attr">username</span>: <span class="string">&lt;login-username&gt;</span></span><br><span class="line">    <span class="attr">password</span>: <span class="string">&lt;login-password&gt;</span></span><br><span class="line">    <span class="attr">url</span>: <span class="string">jdbc:mysql://&lt;your-database-ip&gt;:&lt;your-database-port&gt;/&lt;database-name&gt;</span></span><br><span class="line">    <span class="meta">driver-class-name</span>: <span class="string">com.mysql.cj.jdbc.Driver</span></span><br></pre></td></tr></table></figure>

<h4 id="Creating-a-Connection"><a href="#Creating-a-Connection" class="headerlink" title="Creating a Connection"></a>Creating a Connection</h4><p>Since we are testing the connection for now (not using it yet), we can do this in our test class:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Testsb2ApplicationTests</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    DataSource dataSource;	<span class="comment">// the database connection object</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(dataSource.getClass());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Connection connection = dataSource.getConnection();</span><br><span class="line">            System.out.println(connection);</span><br><span class="line">            connection.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">            throwables.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>And if things are running smoothly, you should get something like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2020-07-06 14:09:36.306  INFO 24324 --- [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...</span><br><span class="line">2020-07-06 14:09:37.972  INFO 24324 --- [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.</span><br><span class="line">HikariProxyConnection@26391950 wrapping com.mysql.cj.jdbc.ConnectionImpl@18d86e4</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled="" type="checkbox"> <p>If you get connection errors, but you are certain that your login username/password are correct, then it could be that your machine’s IP address has not been approved in the SQL server (again, this should happen only if you are connecting to a remote database). To approve connections from your machine, you need to run the following commands in your SQL:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">'&lt;your-username&gt;'</span>@<span class="string">'&lt;your-machines-IP-address&gt;'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'&lt;your-password&gt;'</span>;</span><br></pre></td></tr></table></figure>

<p>then:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> *.* <span class="keyword">TO</span> <span class="string">'&lt;your-username&gt;'</span>@<span class="string">'&lt;your-machines-IP-address&gt;'</span> <span class="keyword">WITH</span> <span class="keyword">GRANT</span> <span class="keyword">OPTION</span>;</span><br></pre></td></tr></table></figure>

<p>finally, to make sure those changes are updated:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<h4 id="Spring-Boot-JDBC-DataSource-Mechanism"><a href="#Spring-Boot-JDBC-DataSource-Mechanism" class="headerlink" title="Spring Boot JDBC DataSource Mechanism"></a>Spring Boot JDBC <code>DataSource</code> Mechanism</h4><p>How does all the above work? How to I now use that connection to run SQL queries and scripts?</p>
<p>If you go to the <code>org.springframework.boot.autoconfigure.jdbc</code> package, you will see the <strong>class <code>DataSourceConfiguration</code></strong>. Parts of that class is shown below:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>(</span><br><span class="line">    proxyBeanMethods = <span class="keyword">false</span></span><br><span class="line">)</span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span>(&#123;DataSource<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class">@<span class="title">ConditionalOnProperty</span>(</span></span><br><span class="line"><span class="class">    <span class="title">name</span> </span>= &#123;<span class="string">"spring.datasource.type"</span>&#125;</span><br><span class="line">)</span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Generic</span> </span>&#123;</span><br><span class="line">    Generic() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">DataSource <span class="title">dataSource</span><span class="params">(DataSourceProperties properties)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> properties.initializeDataSourceBuilder().build();	<span class="comment">// notice the initializeDataSourceBuilder() method</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now, if we trace that <code>initializeDataSourceBuilder()</code>, you will see:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A DataSourceBuilder object is returned, which contains all those login information</span></span><br><span class="line"><span class="comment">// notice the create() method that is called</span></span><br><span class="line"><span class="keyword">public</span> DataSourceBuilder&lt;?&gt; initializeDataSourceBuilder() &#123;</span><br><span class="line">    <span class="keyword">return</span> DataSourceBuilder.create(<span class="keyword">this</span>.getClassLoader()).type(<span class="keyword">this</span>.getType()).driverClassName(<span class="keyword">this</span>.determineDriverClassName()).url(<span class="keyword">this</span>.determineUrl()).username(<span class="keyword">this</span>.determineUsername()).password(<span class="keyword">this</span>.determinePassword());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Another <strong>important class is <code>DataSourceAutoConfiguration</code></strong>, which (as the name suggests) contains default configurations that Spring Boot uses, as well as telling your which <strong>configurations can be overridden in your <code>application.properties</code> or <code>application.yml</code> file.</strong> Part of the class is shown below:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSourceAutoConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DataSourceAutoConfiguration</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">EmbeddedDatabaseCondition</span> <span class="keyword">extends</span> <span class="title">SpringBootCondition</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DATASOURCE_URL_PROPERTY = <span class="string">"spring.datasource.url"</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> SpringBootCondition pooledCondition = <span class="keyword">new</span> DataSourceAutoConfiguration.PooledDataSourceCondition();</span><br></pre></td></tr></table></figure>

<p>Lastly, for running scripts, if you go to <code>DataSourceInitialzer</code> class, you will see:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DataSourceInitializer</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">createSchema</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;Resource&gt; scripts = <span class="keyword">this</span>.getScripts(<span class="string">"spring.datasource.schema"</span>, <span class="keyword">this</span>.properties.getSchema(), <span class="string">"schema"</span>);</span><br><span class="line">        <span class="keyword">if</span> (!scripts.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="keyword">this</span>.isEnabled()) &#123;</span><br><span class="line">                logger.debug(<span class="string">"Initialization disabled (not running DDL scripts)"</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            String username = <span class="keyword">this</span>.properties.getSchemaUsername();</span><br><span class="line">            String password = <span class="keyword">this</span>.properties.getSchemaPassword();</span><br><span class="line">            <span class="keyword">this</span>.runScripts(scripts, username, password);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> !scripts.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">initSchema</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;Resource&gt; scripts = <span class="keyword">this</span>.getScripts(<span class="string">"spring.datasource.data"</span>, <span class="keyword">this</span>.properties.getData(), <span class="string">"data"</span>);</span><br><span class="line">        <span class="keyword">if</span> (!scripts.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="keyword">this</span>.isEnabled()) &#123;</span><br><span class="line">                logger.debug(<span class="string">"Initialization disabled (not running data scripts)"</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            String username = <span class="keyword">this</span>.properties.getDataUsername();</span><br><span class="line">            String password = <span class="keyword">this</span>.properties.getDataPassword();</span><br><span class="line">            <span class="keyword">this</span>.runScripts(scripts, username, password);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>This means that you can run scripts or data by <strong>specifying the property <code>spring.datasource.schema</code> or <code>spring.datasource.data</code>,</strong> or, if you names your scripts with <code>schema-&lt;xxx&gt;.sql</code> and <code>data-xxx.sql</code>, Spring Boot will <strong>automatically run those</strong> for you.</p>
<h4 id="Example-Running-a-Schema-Script"><a href="#Example-Running-a-Schema-Script" class="headerlink" title="Example: Running a Schema Script"></a>Example: Running a Schema Script</h4><p>Now, suppose if you have a SQL script called <code>users.sql</code>, which creates a table called <code>users</code>, you can run it by:</p>
<ol>
<li>Placing that file under your <code>resource</code> folder in your project. In this example, it is placed under <code>resources/sql/users.sql</code></li>
<li>Add the line <code>spring.datasource.schema</code> in your <code>properties</code> or <code>yml</code> file:</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">testuser</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">12345</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.217.100:3306/testjdbc</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">schema:</span></span><br><span class="line">    	<span class="bullet">-</span> <span class="string">classpath:sql/users.sql</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled="" type="checkbox"> Since <strong><code>spring.datasource.schema</code> takes in arguments as a list</strong>, you need to input your files with <code>- &lt;your-script-path&gt;</code> format, as shown above. This also means that you can run multiple scripts easily.</li>
</ul>
</blockquote>
<h4 id="Using-JDBC-for-SQL-Query"><a href="#Using-JDBC-for-SQL-Query" class="headerlink" title="Using JDBC for SQL Query"></a>Using JDBC for SQL Query</h4><p>First, before jumping right into using it, we should look at some source code in <code>JdbcTemplateAutoConfiguration</code>. </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConditionalOnClass</span>(&#123;DataSource<span class="class">.<span class="keyword">class</span>, <span class="title">JdbcTemplate</span>.<span class="title">class</span>&#125;)	// <span class="title">notice</span> <span class="title">here</span></span></span><br><span class="line"><span class="class">@<span class="title">ConditionalOnSingleCandidate</span>(<span class="title">DataSource</span>.<span class="title">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">AutoConfigureAfter</span>(</span>&#123;DataSourceAutoConfiguration<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class">@<span class="title">EnableConfigurationProperties</span>(</span>&#123;JdbcProperties<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class">@<span class="title">Import</span>(</span>&#123;JdbcTemplateConfiguration<span class="class">.<span class="keyword">class</span>, <span class="title">NamedParameterJdbcTemplateConfiguration</span>.<span class="title">class</span>&#125;)	// <span class="title">and</span> <span class="title">here</span></span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">JdbcTemplateAutoConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">JdbcTemplateAutoConfiguration</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>At this point, we certainly have and are using a <code>DataSource</code> class. This means that Spring Boot will <strong>automatically import the class <code>JdbcTemplateConfiguration</code></strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JdbcTemplateConfiguration</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="function">JdbcTemplate <span class="title">jdbcTemplate</span><span class="params">(DataSource dataSource, JdbcProperties properties)</span> </span>&#123;</span><br><span class="line">        JdbcTemplate jdbcTemplate = <span class="keyword">new</span> JdbcTemplate(dataSource);</span><br><span class="line">        Template template = properties.getTemplate();</span><br><span class="line">        jdbcTemplate.setFetchSize(template.getFetchSize());</span><br><span class="line">        jdbcTemplate.setMaxRows(template.getMaxRows());</span><br><span class="line">        <span class="keyword">if</span> (template.getQueryTimeout() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            jdbcTemplate.setQueryTimeout((<span class="keyword">int</span>)template.getQueryTimeout().getSeconds());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>And finally, we see that we get a <strong>bean <code>JdbcTemplate</code></strong>, which will be the main tool that we will use for <strong>querying a database</strong>.</p>
<p>Now, to use that <code>JdbcTemplate</code> to query for something, we can create a controller:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span></span>&#123;</span><br><span class="line">    <span class="meta">@AutoWired</span> </span><br><span class="line">    JdbcTemplate jdbcTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ResponceBody</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/testQuery"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">getFirstMap</span><span class="params">()</span></span>&#123;</span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; data = jdbcTemplate.queryForList(<span class="string">"select * from users"</span>);</span><br><span class="line">        <span class="keyword">return</span> data.get(<span class="number">0</span>); <span class="comment">// returns the first instance</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then if you go your browser and try it, you will get your data (assuming if you have any) <strong>packaged into a <code>map</code> format returned to you as a <code>json</code></strong>. For example, if you have:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+<span class="comment">------+-------+------+</span></span><br><span class="line">| id   | name  | sex  |</span><br><span class="line">+<span class="comment">------+-------+------+</span></span><br><span class="line">|    1 | jason | m    |</span><br><span class="line">+<span class="comment">------+-------+------+</span></span><br></pre></td></tr></table></figure>

<p>Then <strong>this entry</strong> will be returned as a <code>map</code>, in which the <strong>column name are the keys</strong>, and the <strong>values are the values in the <code>map</code></strong>.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"id"</span>:<span class="number">1</span>,<span class="attr">"name"</span>:<span class="string">"jason"</span>,<span class="attr">"sex"</span>:<span class="string">"m"</span>&#125;</span><br></pre></td></tr></table></figure>

<p>This also explains why you had the line <code>List&lt;Map&lt;String, Object&gt;&gt; data</code>, since each entry row will be retrieved as a map object, and a collection of those map objects is then stored into a <code>List</code>.</p>
<h3 id="Using-Druid-DataSource"><a href="#Using-Druid-DataSource" class="headerlink" title="Using Druid DataSource"></a>Using <code>Druid DataSource</code></h3><p><em>DataSource</em> is a name given to the <strong>connection set up to a database from a server</strong>. The name is commonly used when creating a query to the database. </p>
<p>There are potentially many <code>DataSources</code> available, for example <code>Hikari</code>, which has a very good performance. However, this guide will focus on <code>Druid</code>, which is a <code>DataSource</code> made by Alibaba, known for its <strong>security and monitoring features</strong> (in the expense of some performance).</p>
<h4 id="Adding-Druid-to-your-Maven-Dependency"><a href="#Adding-Druid-to-your-Maven-Dependency" class="headerlink" title="Adding Druid to your Maven Dependency"></a>Adding <code>Druid</code> to your Maven Dependency</h4><p>Include the following in your <code>pom.xml</code>.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/druid-spring-boot-starter --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.23<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The latest version can be found at <a href="https://mvnrepository.com/artifact/com.alibaba/druid-spring-boot-starter/1.1.23" target="_blank" rel="noopener">https://mvnrepository.com/artifact/com.alibaba/druid-spring-boot-starter/1.1.23</a></p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled="" type="checkbox"> Since you are using Spring Boot, you should use the <code>Druid</code> package above which has been configured with Spring Boot support.  If you used this <a href="https://mvnrepository.com/artifact/com.alibaba/druid" target="_blank" rel="noopener">https://mvnrepository.com/artifact/com.alibaba/druid</a> then you need to do much more work to make everything working.</li>
</ul>
</blockquote>
<p>And then <strong>add</strong> the property <strong><code>spring.datasource.type=com.alibaba.druid.pool.DruidDataSource</code></strong>. For example, in the <code>application.yml</code>, it could look like:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">testuser</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">12345</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.217.100:3306/testjdbc</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br></pre></td></tr></table></figure>

<h4 id="Configuring-Your-Druid-DataSource"><a href="#Configuring-Your-Druid-DataSource" class="headerlink" title="Configuring Your Druid DataSource"></a>Configuring Your <code>Druid DataSource</code></h4><p>At this point, if you run your test class that you wrote before:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Testsb2ApplicationTests</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    DataSource dataSource;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(dataSource.getClass());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Connection connection = dataSource.getConnection();</span><br><span class="line">            System.out.println(connection);</span><br><span class="line">            connection.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">            throwables.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You will see the line:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2020-07-06 16:11:07.865  INFO 3200 --- [           main] com.alibaba.druid.pool.DruidDataSource   : &#123;dataSource-1&#125; inited</span><br></pre></td></tr></table></figure>

<p>which means that now the <code>DataSource</code> has been switched to <code>Druid</code>. However, if you remember the <code>DataSourceProperties</code> class, which binds all the properties from your <code>properties</code> or <code>yml</code> file, you will see:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(</span><br><span class="line">    prefix = <span class="string">"spring.datasource"</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSourceProperties</span> <span class="keyword">implements</span> <span class="title">BeanClassLoaderAware</span>, <span class="title">InitializingBean</span> </span>&#123;</span><br><span class="line">    <span class="comment">// this means that only those will be binded</span></span><br><span class="line">    <span class="keyword">private</span> ClassLoader classLoader;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> generateUniqueName = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">private</span> Class&lt;? extends DataSource&gt; type;</span><br><span class="line">    <span class="keyword">private</span> String driverClassName;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String jndiName;</span><br><span class="line">    <span class="keyword">private</span> DataSourceInitializationMode initializationMode;</span><br><span class="line">    <span class="keyword">private</span> String platform;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; schema;</span><br><span class="line">    <span class="keyword">private</span> String schemaUsername;</span><br><span class="line">    <span class="keyword">private</span> String schemaPassword;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; data;</span><br><span class="line">    <span class="keyword">private</span> String dataUsername;</span><br><span class="line">    <span class="keyword">private</span> String dataPassword;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> continueOnError;</span><br><span class="line">    <span class="keyword">private</span> String separator;</span><br><span class="line">    <span class="keyword">private</span> Charset sqlScriptEncoding;</span><br><span class="line">    <span class="keyword">private</span> EmbeddedDatabaseConnection embeddedDatabaseConnection;</span><br><span class="line">    <span class="keyword">private</span> DataSourceProperties.Xa xa;</span><br><span class="line">    <span class="keyword">private</span> String uniqueName;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DataSourceProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.initializationMode = DataSourceInitializationMode.EMBEDDED;</span><br><span class="line">        <span class="keyword">this</span>.platform = <span class="string">"all"</span>;</span><br><span class="line">        <span class="keyword">this</span>.continueOnError = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">this</span>.separator = <span class="string">";"</span>;</span><br><span class="line">        <span class="keyword">this</span>.embeddedDatabaseConnection = EmbeddedDatabaseConnection.NONE;</span><br><span class="line">        <span class="keyword">this</span>.xa = <span class="keyword">new</span> DataSourceProperties.Xa();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>Now, we see the problem that some properties of the <code>Druid</code> package is not specified in the class above. This means that those values will not be injected/bound to the <code>DataSource</code> object created. For example, if you have specified:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">testuser</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">12345</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.217.100:3306/testjdbc</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="attr">initial-size:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">min-idle:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">max-active:</span> <span class="number">20</span></span><br><span class="line">      <span class="attr">max-wait:</span> <span class="number">60000</span></span><br></pre></td></tr></table></figure>

<p>Then if you run the <code>debug</code> mode of your test class and look at that <code>DataSource</code> file created, you will see:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">initialSize &#x3D; 0</span><br><span class="line">maxActive &#x3D; 8</span><br><span class="line">minIdle &#x3D; 0</span><br><span class="line">maxIdle &#x3D; 8</span><br></pre></td></tr></table></figure>

<p>which is obviously not what you wanted.</p>
<p>Therefore, this means that we need to <strong>write our own <code>DataSource</code> bean to inject into the container</strong>, replacing the default <code>DataSource</code> class above, and binding all those additional properties:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDruidConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ConfigurationProperties</span>(prefix=<span class="string">"spring.datasource.druid"</span>)	<span class="comment">// binding those druid additional properties</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">druid</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>But you <strong>also need to change other fields such as <code>username</code> and <code>password</code> (and all those connection parameters) to</strong>:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">testuser</span></span><br><span class="line">      <span class="attr">password:</span> <span class="number">12345</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.217.100:3306/testjdbc</span></span><br><span class="line">      <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">      <span class="attr">initial-size:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">min-idle:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">max-active:</span> <span class="number">20</span></span><br><span class="line">      <span class="attr">max-wait:</span> <span class="number">60000</span></span><br></pre></td></tr></table></figure>

<p>As otherwise those cannot be bounded correctly since you specified <code>@ConfigurationProperties(prefix=&quot;spring.datasource.druid&quot;)</code>.</p>
<p>Now, if you re-run the test class, you will see the <code>DataSource</code> object to have:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">maxActive &#x3D; 0</span><br><span class="line">minIdle &#x3D; 5</span><br><span class="line">maxIdle &#x3D; 8</span><br><span class="line">maxWait &#x3D; 60000</span><br></pre></td></tr></table></figure>

<p>And everything else would work just fine.</p>
<h4 id="Configuring-Druid-Monitor"><a href="#Configuring-Druid-Monitor" class="headerlink" title="Configuring Druid Monitor"></a>Configuring Druid Monitor</h4><p>To enable and use the monitor in <code>druid</code>, you need to:</p>
<ol>
<li>Create a <code>Servlet</code> that manages the requests to the backend</li>
<li>Create a <code>Filter</code> that filters those requests</li>
</ol>
<p>First, to create a <code>StatViewServlet</code> to monitor your requests, you need to register it as a <code>Servlet</code> and inject it into your application. But what can be configured from that <code>StatViewServlet</code>? We can go to the <code>StatViewServlet</code> class:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StatViewServlet</span> <span class="keyword">extends</span> <span class="title">ResourceServlet</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Log LOG = LogFactory.getLog(StatViewServlet<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String PARAM_NAME_RESET_ENABLE = <span class="string">"resetEnable"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String PARAM_NAME_JMX_URL = <span class="string">"jmxUrl"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String PARAM_NAME_JMX_USERNAME = <span class="string">"jmxUsername"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String PARAM_NAME_JMX_PASSWORD = <span class="string">"jmxPassword"</span>;</span><br><span class="line">    <span class="keyword">private</span> DruidStatService statService = DruidStatService.getInstance();</span><br><span class="line">    <span class="keyword">private</span> String jmxUrl = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> String jmxUsername = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> String jmxPassword = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> MBeanServerConnection conn = <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure>

<p> More can be seen in that <code>ResoucrServlet</code> class as well:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ResourceServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Log LOG = LogFactory.getLog(ResourceServlet<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String SESSION_USER_KEY = <span class="string">"druid-user"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String PARAM_NAME_USERNAME = <span class="string">"loginUsername"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String PARAM_NAME_PASSWORD = <span class="string">"loginPassword"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String PARAM_NAME_ALLOW = <span class="string">"allow"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String PARAM_NAME_DENY = <span class="string">"deny"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String PARAM_REMOTE_ADDR = <span class="string">"remoteAddress"</span>;</span><br></pre></td></tr></table></figure>

<p>Therefore, some of your configuration can be:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// in a @Configuration class</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ServletRegistrationBean <span class="title">servletRegistrationBean</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// register it as a servlet</span></span><br><span class="line">    ServletRegistrationBean bean = <span class="keyword">new</span> ServletRegistrationBean(<span class="keyword">new</span> StatViewServlet(), <span class="string">"/test-druid/"</span>);	</span><br><span class="line">    </span><br><span class="line">    Map&lt;String, String&gt; initParam = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    initParam.put(<span class="string">"loginUsername"</span>,<span class="string">"testServletUser"</span>);	<span class="comment">// notice the key has to match the parameters</span></span><br><span class="line">    initParam.put(<span class="string">"loginPassword"</span>,<span class="string">"2133"</span>);</span><br><span class="line">    initParam.put(<span class="string">"allow"</span>,<span class="string">"192.168.217.1"</span>);</span><br><span class="line"></span><br><span class="line">    bean.setInitParameters(initParam);</span><br><span class="line">    <span class="keyword">return</span> bean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Second, to create a filter for filtering which requests to be intercepted, you can use the <code>WebStatFilter</code>.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Preferably the same configuration class as above</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> FilterRegistrationBean <span class="title">webStatFilter</span><span class="params">()</span></span>&#123;</span><br><span class="line">    FilterRegistrationBean bean = <span class="keyword">new</span> FilterRegistrationBean();</span><br><span class="line">    bean.setFilter(<span class="keyword">new</span> WebStatFilter());</span><br><span class="line"></span><br><span class="line">    Map&lt;String, String&gt; initParams = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    initParams.put(<span class="string">"exclusions"</span>,<span class="string">"/test-druid/*"</span>);   <span class="comment">// all those requests are excluded for interception</span></span><br><span class="line"></span><br><span class="line">    bean.setInitParameters(initParams);</span><br><span class="line">    bean.setUrlPatterns(Arrays.asList(<span class="string">"/*"</span>));</span><br><span class="line">    <span class="keyword">return</span> bean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Some of the parameters used above can be found in the <code>WebStatFilter</code> class:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebStatFilter</span> <span class="keyword">extends</span> <span class="title">AbstractWebStatImpl</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Log LOG = LogFactory.getLog(WebStatFilter<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String PARAM_NAME_PROFILE_ENABLE = <span class="string">"profileEnable"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String PARAM_NAME_SESSION_STAT_ENABLE = <span class="string">"sessionStatEnable"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String PARAM_NAME_SESSION_STAT_MAX_COUNT = <span class="string">"sessionStatMaxCount"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String PARAM_NAME_EXCLUSIONS = <span class="string">"exclusions"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String PARAM_NAME_PRINCIPAL_SESSION_NAME = <span class="string">"principalSessionName"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String PARAM_NAME_PRINCIPAL_COOKIE_NAME = <span class="string">"principalCookieName"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String PARAM_NAME_REAL_IP_HEADER = <span class="string">"realIpHeader"</span>;</span><br><span class="line">    <span class="keyword">protected</span> PatternMatcher pathMatcher = <span class="keyword">new</span> ServletPathMatcher();</span><br></pre></td></tr></table></figure>

<p>Now, if you visit <code>localhost:8080/test-druid/</code>, you will be redirected to <code>localhost:8080/test-druid/login.html</code>, and you can enter your login credentials there. If you enter the login credentials specified in the <code>StatViewServlet</code> class, you should be redirected to the monitor page.</p>
<h3 id="Using-Mybatis"><a href="#Using-Mybatis" class="headerlink" title="Using Mybatis"></a>Using Mybatis</h3><p>(additional reference: <a href="https://www.baeldung.com/mybatis" target="_blank" rel="noopener">https://www.baeldung.com/mybatis</a>; <a href="https://mybatis.org/mybatis-3/getting-started.html" target="_blank" rel="noopener">https://mybatis.org/mybatis-3/getting-started.html</a>)</p>
<h4 id="Adding-Mybatis-in-Maven-Dependency"><a href="#Adding-Mybatis-in-Maven-Dependency" class="headerlink" title="Adding Mybatis in Maven Dependency"></a>Adding Mybatis in Maven Dependency</h4><p>To make use of MyBatis we need to add the dependency to our <code>pom.xml</code>:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- The driver to connect to databases --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The latest version of the <code>mybatis-spring</code> dependency can be found <a href="https://mvnrepository.com/artifact/org.mybatis.spring.boot/mybatis-spring-boot-starter" target="_blank" rel="noopener">here</a>.</p>
<h4 id="Configuring-your-DataSource-Connection"><a href="#Configuring-your-DataSource-Connection" class="headerlink" title="Configuring your DataSource Connection"></a>Configuring your DataSource Connection</h4><p>This is essentially the same as the previous section. If you use the default <code>DataSource</code>, you only need to specify a few parameters in your <code>application.yml</code>. However, if you want to use the <code>Druid</code> <code>DataSource</code>, you need to also include a <code>@Configuration</code> class to configure that <code>Druid</code> <code>DataSource</code> properly as shown above.</p>
<h4 id="Creating-Components-Beans-corresponding-to-your-Table"><a href="#Creating-Components-Beans-corresponding-to-your-Table" class="headerlink" title="Creating Components/Beans corresponding to your Table"></a>Creating Components/Beans corresponding to your Table</h4><p>Now, you need to create Beans/Objects that correspond to your table. </p>
<p>Suppose you have a table in one of your databases looking like this:</p>
<table>
<thead>
<tr>
<th>id</th>
<th>departmentName</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Science</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
</tr>
</tbody></table>
<p>Then, your corresponding Java class should look like:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.testmybatis.components;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Department</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;	<span class="comment">// this must be the same as the column name</span></span><br><span class="line">    <span class="keyword">private</span> String departmentName; <span class="comment">// this must be the same as the column name</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDepartmentName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> departmentName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDepartmentName</span><span class="params">(String departmentName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.departmentName = departmentName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Creating-Mapper-Annotations-to-Enable-MyBatis-Queries"><a href="#Creating-Mapper-Annotations-to-Enable-MyBatis-Queries" class="headerlink" title="Creating Mapper Annotations to Enable MyBatis Queries"></a>Creating Mapper Annotations to Enable MyBatis Queries</h4><p>Now, to make use of that <code>Department</code> object and query for data, we need to create a <code>@Mapper</code> class that tells Spring Boot MyBatis that this will be mapping/making queries/query data.</p>
<p>For example, some common operations would look like:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.testmybatis.mappers;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.testmybatis.components.Department;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Delete;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Insert;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span> <span class="comment">// tells Spring Boot that this is a MyBatis Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DepartmentMapper</span> </span>&#123;	<span class="comment">// notice that this is an Interface</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"select * from Department where id=#&#123;inputId&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Department <span class="title">getDeparmentById</span><span class="params">(Integer inputId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Delete</span>(<span class="string">"delete from Department where id=#&#123;inputId&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">deleteDepartmentById</span><span class="params">(Integer inputId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Insert</span>(<span class="string">"insert into Department values (#&#123;id&#125;,#&#123;departmentName&#125;)"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">insertDeparment</span><span class="params">(Department department)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>And then you just need to have a controller that first has an <code>autowired</code> <code>DepartmentMapper</code>, and then uses that to create queries:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.testmybatis.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.testmybatis.components.Department;</span><br><span class="line"><span class="keyword">import</span> com.example.testmybatis.mappers.DepartmentMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DepartmentController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    DepartmentMapper departmentMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/dept/&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Department <span class="title">getDepartment</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Integer id)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> departmentMapper.getDeparmentById(id);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/dept"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Department <span class="title">insertDepartment</span><span class="params">(Department department)</span></span>&#123;  <span class="comment">// this argument will be provided as part of the request</span></span><br><span class="line">        departmentMapper.insertDeparment(department);</span><br><span class="line">        <span class="keyword">return</span> department;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled="" type="checkbox"> At this point, you should see that IntelliJ tells you that there exists an error that <code>DepartmentMapper departmentMapper</code> cannot be auto-wired. This is because we created the mapper interface instead of a class. However, this is exactly how MyBatis works, so even if IntelliJ shows you this potential error, you should <strong>still be able to build this and get this to work</strong>. </li>
</ul>
</blockquote>
<p>To <strong>get the first entry</strong>, you can use <code>http://localhost:8080/dept/1</code></p>
<p>To <strong>insert a second entry</strong>, you can use <code>http://localhost:8080/dept?id=2&amp;&amp;departmentName=Math</code></p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled="" type="checkbox"> <p>If you have used an <code>id</code> field in your database that is increment automatically, and in your <code>mapper</code> class you only specified the need to insert a <code>departmentName</code>, then by default that <code>Department</code> object <strong>will not know about the auto-incremented <code>id</code></strong>. Therefore, to display correct result, you need to add the annotation <code>@Options(useGeneratedKeys = true, ketProperty = &lt;thatField&gt;)</code> above that <code>@Insert</code> query. For example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Options</span>(useGeneratedKeys = <span class="keyword">true</span>, keyProperty = <span class="string">"id"</span>)</span><br><span class="line"><span class="meta">@Insert</span>(<span class="string">"insert into Department values (#&#123;departmentName&#125;)"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">insertDeparment</span><span class="params">(Department department)</span></span>;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<h4 id="Creating-Mapper-XML-to-Enable-MyBatis-Queries"><a href="#Creating-Mapper-XML-to-Enable-MyBatis-Queries" class="headerlink" title="Creating Mapper XML to Enable MyBatis Queries"></a>Creating Mapper XML to Enable MyBatis Queries</h4><p>If you use <code>xml</code> to create mappers, it allows for more functionalities including Dynamic SQL. However, it does require you to create an additional <code>xml</code> file.</p>
<p>If you use <code>xml</code> to create mappers, your <code>mapper</code> java class will be changed to:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.testmybatis.mappers;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.testmybatis.components.Department;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span> <span class="comment">// tells Spring Boot that this is a MyBatis Mapper so that it will be scanned in automatically</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DepartmentMapper</span> </span>&#123;	<span class="comment">// notice now that you don't use those @Select annotations</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Department <span class="title">getDepartmentById</span><span class="params">(String inputId)</span></span>;	<span class="comment">// If you use Integer here, you will get errors</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">deleteDepartmentById</span><span class="params">(String inputId)</span></span>;	<span class="comment">// same here</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">insertDepartment</span><span class="params">(Department department)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then, the details of those queries would be in an <code>xml</code> file. In general, you will create your <code>xml</code> file in the following steps:</p>
<ol>
<li>Include the proper headings</li>
<li>Specify your mapper <code>namespace</code> (which <code>@Mapper</code> to bind to)</li>
<li>Specify the mappings of your return result</li>
<li>Write queries with <code>id</code> bound to that method call in your <code>@Mapper</code> class<ol>
<li>If it has a return result, each entry you got will be a <code>Map</code>, which can be further mapped to the mapping you created in Step 3</li>
</ol>
</li>
</ol>
<p>For example, to get the equivalent query for <code>@Select(&quot;select * from Department where id=#{inputId}&quot;)</code>, you would have:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span> &gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"departmentResultMap"</span> <span class="attr">type</span>=<span class="string">" com.example.testmybatis.components.Department"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">jdbcType</span>=<span class="string">"INT"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"department"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> <span class="attr">property</span>=<span class="string">"department"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- If you used parameterType="java.lang.Integer", you will get errors --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getDepartmentById"</span> <span class="attr">parameterType</span>=<span class="string">"java.lang.String"</span> <span class="attr">resultMap</span>=<span class="string">"departmentResultMap"</span>&gt;</span></span><br><span class="line">        select * from Department where id=#&#123;inputId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>A few things to observe here are:</p>
<ul>
<li>Namespace in Mapper XML should be same as Fully Qualified Name (FQN) for <strong>Mapper Interface</strong></li>
<li>Statement id values should be same as Mapper Interface <strong>method names</strong>.</li>
<li>If the query result column names are different from bean property names we can use <code>&lt;resultMap&gt;</code> configuration to provide mapping between column names and their corresponding bean property names. </li>
</ul>
<p>Last but not least, if you try to build and run this, you will notice that <code>xml</code> files tend to be not included in the Spring Boot projects. This means that you need to use plugins in <code>pom.xml</code> to modify this behavior:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- This plugin should be added --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-resources-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>copy-xmls<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">phase</span>&gt;</span>process-sources<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>copy-resources<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>$&#123;basedir&#125;/target/classes<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>$&#123;basedir&#125;/src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Now, if you run <code>mvn package</code>, and you look into your <code>target</code> folder, you will find that <code>xml</code> file, and everything would work fine if you run the application.</p>
<h3 id="Building-SqlSessionFactory-from-XML"><a href="#Building-SqlSessionFactory-from-XML" class="headerlink" title="Building SqlSessionFactory from XML"></a>Building SqlSessionFactory from XML</h3><p>Every <strong>MyBatis application centers around an instance of <code>SqlSessionFactory</code></strong>. A <code>SqlSessionFactory</code> instance can be <strong>acquired by using the <code>SqlSessionFactoryBuilder</code></strong>. <code>SqlSessionFactoryBuilder</code> can build a <code>SqlSessionFactory</code> instance <strong>from an XML configuration file</strong>, or from a custom prepared instance of the Configuration class.</p>
<p>Building a <code>SqlSessionFactory</code> instance from an XML file is very simple. It is recommended that you use a classpath resource for this configuration, but you could use any <code>InputStream</code> instance, including one created from a literal file path or a <code>file:// URL</code>. MyBatis includes a <strong>utility class, called <code>Resources</code>, that contains a number of methods that make it simpler to load resources from the classpath and other locations</strong>.</p>
<p>For example, this would be how you create a <code>SqlSessionFactory</code> instance:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String resource = <span class="string">"org/mybatis/example/mybatis-config.xml"</span>;</span><br><span class="line">InputStream inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">SqlSessionFactory sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);</span><br></pre></td></tr></table></figure>

<p>The configuration XML file contains settings for the core of the MyBatis system, including a <code>DataSource</code> for acquiring database <code>Connection</code> instances, as well as a <code>TransactionManager</code> for determining how transactions should be scoped and controlled. The full details of the XML configuration file can be found in later sections, but here is a simple example:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">  <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Config 3.0//EN"</span></span></span><br><span class="line"><span class="meta">  <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;driver&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;url&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;username&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;password&#125;"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"org/mybatis/example/BlogMapper.xml"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>While there is a lot more to the XML configuration file, the above example points out the most critical parts. Notice the <strong>XML header, required to validate the XML document</strong>. The body of the environment element contains the <strong>environment configuration for transaction management and connection pooling</strong>. The mappers element contains a <strong>list of mappers – the XML files and/or annotated Java interface classes that contain the SQL code and mapping definitions</strong>.</p>
<h2 id="Working-With-JPA"><a href="#Working-With-JPA" class="headerlink" title="Working With JPA"></a>Working With JPA</h2><p>Spring has support for using JPA (Java Persistence API) as well as other data access technology via its Spring Data project, which aims to simplify data access operations by providing us with easy to use APIs/Templates (for example, <code>JDBCTemplate</code>, <code>RedisTemplate</code>).</p>
<p><img src="Inkedspring-data-flow.jpg" alt="Inkedspring-data-flow.jpg" title="Inkedspring-data-flow.jpg"></p>
<p>This means that all we need to do is to program towards APIs provided by Spring Data!</p>
<h3 id="Importing-JPA"><a href="#Importing-JPA" class="headerlink" title="Importing JPA"></a>Importing JPA</h3><p>To use JPA with Spring Boot, you need to include the following dependency in your <code>pom,xml</code>:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Under the hood, Spring Boot uses <code>Hibernate</code> for JPA implementation.</p>
<h3 id="Using-JPA"><a href="#Using-JPA" class="headerlink" title="Using JPA"></a>Using JPA</h3><p>Since JPA is based on the idea of ORM (Object Relational Mapping), the first thing you need to do is to <strong>create a class that maps to your data table</strong>. Then, once you have setup everything, all you need to do is to <strong>call methods from a <code>Repository</code></strong> which <strong>has implemented many query implementations for you.</strong></p>
<p>In summary, you need to do the following steps:</p>
<ol>
<li><p><strong>Create a class</strong> that will map to the entries in your table, <strong>annotate it with <code>@Entity</code></strong>, which tells JPA that it is an object that it can map to</p>
</li>
<li><p><strong>Create a interface</strong> that <strong>extends <code>JpaRepository&lt;T, ID&gt;</code> or its parent classes</strong> (e.g. <code>CrudRepository&lt;T, ID&gt;</code>, but of course the lower in hierarchy the more functionalities), annotate it with <code>@Repository</code> so that Spring Boot will take it in</p>
</li>
<li><p>(<strong>Optional</strong>) By default, JPA has the naming strategy of converting to snake case. If you want to <strong>keep the case as it is in your Java class</strong>, you need to use:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">jpa.hibernate.naming.physical-strategy</span>=<span class="string">org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Use that interface created above</strong> with <code>@Autowire</code>, and <strong>call existing methods from it for querying</strong> (e.g. <code>findAllById()</code>)</p>
</li>
</ol>
<p>For example, suppose you have a table in your database with name <code>Product</code>, and the following fields/columns:</p>
<table>
<thead>
<tr>
<th>id</th>
<th>productName</th>
<th>productPrice</th>
<th>status</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>AA</td>
<td>100.00</td>
<td>sold</td>
</tr>
</tbody></table>
<p>Then, your <code>@Entity</code> class would look like:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.testmybatis.components;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span> <span class="comment">// tells JPA that this is a class that maps to your database table</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span> <span class="comment">// Specifies the primary key (necessary)</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.AUTO)	<span class="comment">// because we set id to auto-increment</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String productName;	<span class="comment">// notice the field names here</span></span><br><span class="line">    <span class="keyword">private</span> Double productPrice;</span><br><span class="line">    <span class="keyword">private</span> String status;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getProductName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> productName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProductName</span><span class="params">(String productName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.productName = productName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Double <span class="title">getProductPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> productPrice;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProductPrice</span><span class="params">(Double productPrice)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.productPrice = productPrice;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getStatus</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStatus</span><span class="params">(String status)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.status = status;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Your <code>@Repository</code> would look like:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.testmybatis.repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.testmybatis.components.Product;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">// JpaRepository is an interface that we can use to manipulate, which extends useful classes such as CRUDRepository</span></span><br><span class="line"><span class="comment">// JpaRepository takes two types: the ORM class type (Product), and the Primary Key type (Integer)</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ProductRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Product</span>, <span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Your <code>application.yml</code> for configuring your JPA looks like:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">testuser</span></span><br><span class="line">      <span class="attr">password:</span> <span class="number">12345</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.217.100:3306/testMybatis</span></span><br><span class="line">      <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">      <span class="attr">initial-size:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">min-idle:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">max-active:</span> <span class="number">20</span></span><br><span class="line">      <span class="attr">max-wait:</span> <span class="number">60000</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line">  <span class="comment"># starting from here</span></span><br><span class="line">  <span class="attr">jpa:</span></span><br><span class="line">    <span class="attr">hibernate:</span></span><br><span class="line">      <span class="comment"># this means create/update, so that if a DB table specified by JPA upon start up does not exist, it creates; otherwise, it updates the table</span></span><br><span class="line">      <span class="attr">ddl-auto:</span> <span class="string">update</span></span><br><span class="line">      <span class="comment"># this keeps the name in the query the same as name in your entity class</span></span><br><span class="line">      <span class="attr">naming:</span></span><br><span class="line">        <span class="attr">physical-strategy:</span> <span class="string">org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl</span></span><br><span class="line">    <span class="comment"># this means that it will show the SQL commands in console whenever it does something (mainly used for debugging)</span></span><br><span class="line">    <span class="attr">show-sql:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">database:</span> <span class="string">mysql</span></span><br></pre></td></tr></table></figure>

<p>Now, everything has been setup correctly and you can use this by calling methods from your <code>ProductRepository</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.testmybatis.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.testmybatis.components.Product;</span><br><span class="line"><span class="keyword">import</span> com.example.testmybatis.repository.ProductRepository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ProductRepository productRepository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/product/&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Product&gt; <span class="title">getProduct</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Integer id)</span>&#123;</span><br><span class="line">        List&lt;Product&gt; product = productRepository.findAllById(id);</span><br><span class="line">        <span class="keyword">return</span> product;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/product"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Product <span class="title">insertProduct</span><span class="params">(Product product)</span></span>&#123;</span><br><span class="line">        Product save = productRepository.save(product); <span class="comment">// adds a new product</span></span><br><span class="line">        <span class="keyword">return</span> save;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Handling-Exceptions-in-Spring-Boot"><a href="#Handling-Exceptions-in-Spring-Boot" class="headerlink" title="Handling Exceptions in Spring Boot"></a>Handling Exceptions in Spring Boot</h2><p>By default, if you made a request that is not handled at all by your Spring Boot Application, a <strong>default error page</strong> will show:</p>
<p><img src="default-error.png" alt="default-error.png" title="default-error.png"></p>
<p>(If you have visited this from applications other than a browser, e.g. if you have visited  then the above will be shown as a <code>json</code> format)</p>
<h3 id="Mechanism-1"><a href="#Mechanism-1" class="headerlink" title="Mechanism"></a>Mechanism</h3><p>Alike other features, this is also configured by an <code>AutoConfiguration</code> class, located at <code>org.springframework.boot.autoconfigure.web.servlet.error</code>, <strong>called <code>ErrorMvcAutoConfiguration</code></strong>.</p>
<p>There, some important methods include:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ErrorMvcAutoConfiguration</span> </span>&#123;	</span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span>(value = ErrorAttributes<span class="class">.<span class="keyword">class</span>, <span class="title">search</span> </span>= SearchStrategy.CURRENT)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> DefaultErrorAttributes <span class="title">errorAttributes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> DefaultErrorAttributes();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="meta">@ConditionalOnMissingBean</span>(value = ErrorController<span class="class">.<span class="keyword">class</span>, <span class="title">search</span> </span>= SearchStrategy.CURRENT)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> BasicErrorController <span class="title">basicErrorController</span><span class="params">(ErrorAttributes errorAttributes,</span></span></span><br><span class="line"><span class="function"><span class="params">			ObjectProvider&lt;ErrorViewResolver&gt; errorViewResolvers)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> BasicErrorController(errorAttributes, <span class="keyword">this</span>.serverProperties.getError(),</span><br><span class="line">				errorViewResolvers.orderedStream().collect(Collectors.toList()));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ErrorPageCustomizer <span class="title">errorPageCustomizer</span><span class="params">(DispatcherServletPath dispatcherServletPath)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ErrorPageCustomizer(<span class="keyword">this</span>.serverProperties, dispatcherServletPath);</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Configuration</span>(proxyBeanMethods = <span class="keyword">false</span>)</span><br><span class="line">	<span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultErrorViewResolverConfiguration</span> </span>&#123;</span><br><span class="line">		...</span><br><span class="line">            </span><br><span class="line">		<span class="meta">@Bean</span></span><br><span class="line">		<span class="meta">@ConditionalOnBean</span>(DispatcherServlet<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">		@<span class="title">ConditionalOnMissingBean</span>(<span class="title">ErrorViewResolver</span>.<span class="title">class</span>)</span></span><br><span class="line"><span class="class">		<span class="title">DefaultErrorViewResolver</span> <span class="title">conventionErrorViewResolver</span>() </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> DefaultErrorViewResolver(<span class="keyword">this</span>.applicationContext, <span class="keyword">this</span>.resourceProperties);</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Detailed-Steps"><a href="#Detailed-Steps" class="headerlink" title="Detailed Steps"></a>Detailed Steps</h4><ol>
<li>Whenever errors with code <code>4xx</code>, <code>5xx</code> take place, this error will be registered as an error page through </li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* &#123;<span class="doctag">@link</span> WebServerFactoryCustomizer&#125; that configures the server's error pages.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ErrorPageCustomizer</span> <span class="keyword">implements</span> <span class="title">ErrorPageRegistrar</span>, <span class="title">Ordered</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerErrorPages</span><span class="params">(ErrorPageRegistry errorPageRegistry)</span> </span>&#123;</span><br><span class="line">        ErrorPage errorPage = <span class="keyword">new</span> ErrorPage(</span><br><span class="line">            <span class="keyword">this</span>.dispatcherServletPath.getRelativePath(<span class="keyword">this</span>.properties.getError().getPath())); <span class="comment">// notice the line</span></span><br><span class="line">        errorPageRegistry.addErrorPages(errorPage);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>which comes from:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ErrorPageCustomizer <span class="title">errorPageCustomizer</span><span class="params">(DispatcherServletPath dispatcherServletPath)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ErrorPageCustomizer(<span class="keyword">this</span>.serverProperties, dispatcherServletPath);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>Notice the line:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ErrorPage errorPage = <span class="keyword">new</span> ErrorPage(</span><br><span class="line">            <span class="keyword">this</span>.dispatcherServletPath.getRelativePath(<span class="keyword">this</span>.properties.getError().getPath()));</span><br></pre></td></tr></table></figure>

<p>Now, if you look at the method <code>getPath()</code>, you will be navigated to the method:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getPath</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.path;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>which comes from:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ErrorProperties</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Path of the error controller.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Value</span>(<span class="string">"$&#123;error.path:/error&#125;"</span>)</span><br><span class="line">	<span class="keyword">private</span> String path = <span class="string">"/error"</span>;</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<p><strong>This means that by default, when an error happens, Spring Boot will come to <code>/error</code> request.</strong> Now, what happens if we did not specify a handler to handler that <code>/error</code> request?</p>
<ol start="2">
<li>At this point, Spring Boot will come to use the bean <code>BasicErrorController</code>, which is shown above in the Mechanism section as well:</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span>(value = ErrorController<span class="class">.<span class="keyword">class</span>, <span class="title">search</span> </span>= SearchStrategy.CURRENT)</span><br><span class="line"><span class="function"><span class="keyword">public</span> BasicErrorController <span class="title">basicErrorController</span><span class="params">(ErrorAttributes errorAttributes,</span></span></span><br><span class="line"><span class="function"><span class="params">                                                 ObjectProvider&lt;ErrorViewResolver&gt; errorViewResolvers)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> BasicErrorController(errorAttributes, <span class="keyword">this</span>.serverProperties.getError(),</span><br><span class="line">                                    errorViewResolvers.orderedStream().collect(Collectors.toList()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The class <code>BasicErrorController</code> by its name suggests that it <strong>handles all those <code>/error</code> request</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"$&#123;server.error.path:$&#123;error.path:/error&#125;&#125;"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BasicErrorController</span> <span class="keyword">extends</span> <span class="title">AbstractErrorController</span> </span>&#123;</span><br></pre></td></tr></table></figure>

<p>within this class, you will also find:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(produces = MediaType.TEXT_HTML_VALUE)	<span class="comment">// notice this line</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">errorHtml</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">    HttpStatus status = getStatus(request);</span><br><span class="line">    Map&lt;String, Object&gt; model = Collections</span><br><span class="line">        .unmodifiableMap(getErrorAttributes(request, getErrorAttributeOptions(request, MediaType.TEXT_HTML)));</span><br><span class="line">    response.setStatus(status.value());</span><br><span class="line">    <span class="comment">// This renders the error html page</span></span><br><span class="line">    ModelAndView modelAndView = resolveErrorView(request, response, status, model);</span><br><span class="line">    <span class="keyword">return</span> (modelAndView != <span class="keyword">null</span>) ? modelAndView : <span class="keyword">new</span> ModelAndView(<span class="string">"error"</span>, model);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>		<span class="comment">// and this</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; error(HttpServletRequest request) &#123;</span><br><span class="line">    HttpStatus status = getStatus(request);</span><br><span class="line">    <span class="keyword">if</span> (status == HttpStatus.NO_CONTENT) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(status);</span><br><span class="line">    &#125;</span><br><span class="line">    Map&lt;String, Object&gt; body = getErrorAttributes(request, getErrorAttributeOptions(request, MediaType.ALL));</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(body, status);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In the first case, an error page produces a <code>html</code> page, with <code>produces = MediaType.TEXT_HTML_VALUE</code>. In the second case, it is not specified to produce a <code>html</code> page. But how does a Spring Boot know whether a request comes from a browser or other client applications?</p>
<ul>
<li><p><strong>This information is actually hidden in the <code>Request Header</code></strong> whenever you send any requests.</p>
<ul>
<li><p>If you send a request from a browser, you will see:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Request Headers:</span></span><br><span class="line">	<span class="string">...</span></span><br><span class="line">	<span class="attr">Accept:</span> <span class="string">text/html...</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>If you send a request from other client applications, it will look like:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Request Headers:</span></span><br><span class="line">	<span class="string">...</span></span><br><span class="line">	<span class="attr">Accept:</span> <span class="string">"*/*"</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<p>Lastly, the <code>ModelAndView</code> object is created by this method:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> ModelAndView <span class="title">resolveErrorView</span><span class="params">(HttpServletRequest request, HttpServletResponse response, HttpStatus status,</span></span></span><br><span class="line"><span class="function"><span class="params">                                        Map&lt;String, Object&gt; model)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// iterates over all errorViewResolvers. If found one that maps to that error request, returns</span></span><br><span class="line">    <span class="keyword">for</span> (ErrorViewResolver resolver : <span class="keyword">this</span>.errorViewResolvers) &#123;</span><br><span class="line">        ModelAndView modelAndView = resolver.resolveErrorView(request, status, model);</span><br><span class="line">        <span class="keyword">if</span> (modelAndView != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> modelAndView;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// if not found, return null</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>But what is that <code>ErrorViewResolver</code> object?</p>
<ol start="3">
<li><p>Remember the <code>DefaultErrorViewResolver</code> object that we have seen in the Mechanism section:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>(proxyBeanMethods = <span class="keyword">false</span>)</span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultErrorViewResolverConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnBean</span>(DispatcherServlet<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    @<span class="title">ConditionalOnMissingBean</span>(<span class="title">ErrorViewResolver</span>.<span class="title">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">DefaultErrorViewResolver</span> <span class="title">conventionErrorViewResolver</span>() </span>&#123;	<span class="comment">// notice here</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DefaultErrorViewResolver(<span class="keyword">this</span>.applicationContext, <span class="keyword">this</span>.resourceProperties);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>And the <code>DefaultErrorViewResolver</code> class looks like:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultErrorViewResolver</span> <span class="keyword">implements</span> <span class="title">ErrorViewResolver</span>, <span class="title">Ordered</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;Series, String&gt; SERIES_VIEWS;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">static</span> &#123;</span><br><span class="line">		Map&lt;Series, String&gt; views = <span class="keyword">new</span> EnumMap&lt;&gt;(Series<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">		views.put(Series.CLIENT_ERROR, <span class="string">"4xx"</span>);	<span class="comment">// This will be mentioned in the next section</span></span><br><span class="line">		views.put(Series.SERVER_ERROR, <span class="string">"5xx"</span>);	</span><br><span class="line">		SERIES_VIEWS = Collections.unmodifiableMap(views);</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">private</span> ModelAndView <span class="title">resolve</span><span class="params">(String viewName, Map&lt;String, Object&gt; model)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// e.g. error/404</span></span><br><span class="line">		String errorViewName = <span class="string">"error/"</span> + viewName;</span><br><span class="line">        <span class="comment">// first try to find if such a page exists in your template/or if you have a template engine</span></span><br><span class="line">		TemplateAvailabilityProvider provider = <span class="keyword">this</span>.templateAvailabilityProviders.getProvider(errorViewName,</span><br><span class="line">				<span class="keyword">this</span>.applicationContext);</span><br><span class="line">		<span class="keyword">if</span> (provider != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// if it exists, return a ModelAndView object</span></span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(errorViewName, model);</span><br><span class="line">		&#125;</span><br><span class="line">        <span class="comment">// if not, go to the method below</span></span><br><span class="line">		<span class="keyword">return</span> resolveResource(errorViewName, model);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> ModelAndView <span class="title">resolveResource</span><span class="params">(String viewName, Map&lt;String, Object&gt; model)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// looks for static locations (your static folders)</span></span><br><span class="line">		<span class="keyword">for</span> (String location : <span class="keyword">this</span>.resourceProperties.getStaticLocations()) &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				Resource resource = <span class="keyword">this</span>.applicationContext.getResource(location);</span><br><span class="line">				resource = resource.createRelative(viewName + <span class="string">".html"</span>);</span><br><span class="line">				<span class="keyword">if</span> (resource.exists()) &#123;</span><br><span class="line">					<span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="keyword">new</span> HtmlResourceView(resource), model);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>This means that we can customize those error pages by placing the <code>html</code> file with that specified <code>error code</code> under the correct directory.</p>
<ul>
<li>However, this could be troublesome if we need to create a new html for every <code>error code</code>. This is where the <code>4xx</code> and <code>5xx</code> comes in handy:<ul>
<li>If you names a <code>html</code> page with <code>4xx.html</code>, then <strong>all error codes beginning with a <code>4</code> and does not match any other <code>&lt;error-code&gt;.html</code> page you placed in that directory</strong>, then the <strong><code>4xx.html</code> will be used</strong>.</li>
<li>If you names a <code>html</code> page with <code>5xx.html</code>, then <strong>all error codes beginning with a <code>5</code> and does not match any other <code>&lt;error-code&gt;.html</code> page you placed in that directory</strong>, then the <strong><code>5xx.html</code> will be used</strong>.</li>
</ul>
</li>
</ul>
</li>
<li><p>Lastly, if you are using those <code>4xx.html</code> or <code>5xx.html</code>, how do you correctly <strong>find out the actual error code to display</strong> on your page? In other words, where are those attributes stored?</p>
<p>This is explained by the class we mentioned above in the section Mechanism, called <code>DefaultErrorAttributes</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span>(value = ErrorAttributes<span class="class">.<span class="keyword">class</span>, <span class="title">search</span> </span>= SearchStrategy.CURRENT)</span><br><span class="line"><span class="function"><span class="keyword">public</span> DefaultErrorAttributes <span class="title">errorAttributes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> DefaultErrorAttributes();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The class <code>DefaultErrorAttributes</code> contains the methods:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">getErrorAttributes</span><span class="params">(WebRequest webRequest, ErrorAttributeOptions options)</span> </span>&#123;</span><br><span class="line">    Map&lt;String, Object&gt; errorAttributes = <span class="keyword">this</span>.getErrorAttributes(webRequest, options.isIncluded(Include.STACK_TRACE));</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.includeException != <span class="keyword">null</span>) &#123;</span><br><span class="line">        options = options.including(<span class="keyword">new</span> Include[]&#123;Include.EXCEPTION&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!options.isIncluded(Include.EXCEPTION)) &#123;</span><br><span class="line">        errorAttributes.remove(<span class="string">"exception"</span>);	<span class="comment">// information 1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!options.isIncluded(Include.STACK_TRACE)) &#123;</span><br><span class="line">        errorAttributes.remove(<span class="string">"trace"</span>);	<span class="comment">// information 2</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!options.isIncluded(Include.MESSAGE) &amp;&amp; errorAttributes.get(<span class="string">"message"</span>) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        errorAttributes.put(<span class="string">"message"</span>, <span class="string">""</span>);	<span class="comment">// information 3</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!options.isIncluded(Include.BINDING_ERRORS)) &#123;</span><br><span class="line">        errorAttributes.remove(<span class="string">"errors"</span>);	<span class="comment">// information 4</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> errorAttributes;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addStatus</span><span class="params">(Map&lt;String, Object&gt; errorAttributes, RequestAttributes requestAttributes)</span> </span>&#123;</span><br><span class="line">    Integer status = (Integer)<span class="keyword">this</span>.getAttribute(requestAttributes, <span class="string">"javax.servlet.error.status_code"</span>);</span><br><span class="line">    <span class="keyword">if</span> (status == <span class="keyword">null</span>) &#123;</span><br><span class="line">        errorAttributes.put(<span class="string">"status"</span>, <span class="number">999</span>);</span><br><span class="line">        errorAttributes.put(<span class="string">"error"</span>, <span class="string">"None"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        errorAttributes.put(<span class="string">"status"</span>, status);	<span class="comment">// information 5</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            errorAttributes.put(<span class="string">"error"</span>, HttpStatus.valueOf(status).getReasonPhrase());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception var5) &#123;</span><br><span class="line">            errorAttributes.put(<span class="string">"error"</span>, <span class="string">"Http Status "</span> + status);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>where those lines commented with <code>information</code> are shared, meaning that you can get those information as a variable in your template engine. For example, to get the error code inline, you could do:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">    status:[[$&#123;status&#125;]]</span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="Customizing-your-Error-Pages-with-HTML"><a href="#Customizing-your-Error-Pages-with-HTML" class="headerlink" title="Customizing your Error Pages with HTML"></a>Customizing your Error Pages with HTML</h3><ul>
<li><p><strong>If you are using a template engine</strong>, then your error pages should go into the directory <code>templates/error/&lt;error-code&gt;.html</code>. (Or the <code>4xx.html</code> or <code>5xx.html</code> file)</p>
<p>For example, if you want to have a customized response to <code>404</code> error, you should place your <code>404.html</code> to <code>templates/error/404.html</code>.</p>
</li>
<li><p><strong>If you are not using a template engine, or that your template engine cannot find that specific error page</strong>, then the error request will map to pages stored under your <code>static</code> folder. </p>
<p>For example,  if you want to have a customized response to <code>404</code> error, you should place your <code>404.html</code> to <code>static/error/404.html</code>.</p>
</li>
<li><p><strong>If both the above cannot be satisfied</strong>, Spring Boot will start its default mechanism of resolving and constructing a White Labeled Page.</p>
</li>
</ul>
<h3 id="Customizing-your-Error-Pages-with-JSON"><a href="#Customizing-your-Error-Pages-with-JSON" class="headerlink" title="Customizing your Error Pages with JSON"></a>Customizing your Error Pages with JSON</h3><p>In summary, you need to do:</p>
<ol>
<li>Create your own <code>Exception</code> class, which can contain information such as error message.</li>
<li>Create a <code>@ControllerAdvice</code> class, which is a central place for <strong>handling/customizing your <code>@ExceptionHandler(&lt;YourException&gt;.class)</code></strong></li>
<li>Throw that <code>Exception</code> class in your controller when needed. That <code>xxxException</code> will <strong>first go to that <code>@ExceptionHandler(xxxException.class)</code> you created in the step above</strong>, and if not found, it will take its default JSON format output.</li>
</ol>
<h4 id="Example-ALWAYS-Returning-Customized-JSON"><a href="#Example-ALWAYS-Returning-Customized-JSON" class="headerlink" title="Example: ALWAYS Returning Customized JSON"></a>Example: ALWAYS Returning Customized JSON</h4><p>The basic step follows the summary above, but when you specified <code>@ExceptionHandler</code>, you also specify <code>@ResponceBody</code>.</p>
<p>For example, first you can create an <code>Exception</code> class called <code>RequestNotFoundException</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// located in your project, not in those static folders of course</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RequestNotFoundException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RequestNotFoundException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="string">"Request Not Found"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then, this could be your <code>@ControllerAdvice</code> for handling the exceptions you throw:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyExceptionHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span> <span class="comment">// return as a JSON in html. However, this has a side-effect, which will be addressed later</span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(RequestNotFoundException<span class="class">.<span class="keyword">class</span>)   // <span class="title">if</span> <span class="title">this</span> <span class="title">Error</span> <span class="title">happens</span>, <span class="title">then</span> <span class="title">this</span> <span class="title">will</span> <span class="title">be</span> <span class="title">called</span></span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">Map</span>&lt;<span class="title">String</span>, <span class="title">Object</span>&gt; <span class="title">handleException</span>(<span class="title">RequestNotFoundException</span> <span class="title">e</span>)</span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; error = <span class="keyword">new</span> HashMap&lt;&gt;();    <span class="comment">// can be an object as well</span></span><br><span class="line">        error.put(<span class="string">"errorCode"</span>, <span class="string">"599"</span>);</span><br><span class="line">        error.put(<span class="string">"message"</span>,<span class="string">"Request Not Found Error"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> error;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span> <span class="comment">// return as a JSON in html</span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(Exception<span class="class">.<span class="keyword">class</span>)  // <span class="title">if</span> <span class="title">other</span> <span class="title">error</span> <span class="title">happens</span>, <span class="title">this</span> <span class="title">will</span> <span class="title">be</span> <span class="title">called</span></span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">Map</span>&lt;<span class="title">String</span>, <span class="title">Object</span>&gt; <span class="title">handleGenericException</span>()</span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; error = <span class="keyword">new</span> HashMap&lt;&gt;();    <span class="comment">// can be an object as well</span></span><br><span class="line">        error.put(<span class="string">"errorCode"</span>, <span class="string">"569"</span>);</span><br><span class="line">        error.put(<span class="string">"message"</span>,<span class="string">"Generic Error"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> error;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Lastly, if you throw this <code>RequestNotFoundException</code> in your program, for example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/hello-response"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">helloResponce</span><span class="params">(@RequestParam(<span class="string">"req"</span>)</span> String request)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(request.equals(<span class="string">"HAHA"</span>))&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RequestNotFoundException();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Halo"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now, if you try: <code>localhost:8080/hello-response?req=HAHA</code>, you will go to a page with the <code>json</code> data you specified in your <code>@ExceptionHandler()</code> method:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">errorCode: "599"</span><br><span class="line">message: "Request Not Found Error"</span><br></pre></td></tr></table></figure>

<p>However, this has a side-effect:</p>
<ul>
<li>Since you have specified <code>@ResponceBody</code>, <strong>no matter what you use (browser or other client applications) you will get a <code>json</code> formatted output</strong>, instead of the automatic resolution to <code>html</code> page when handled to a browser.</li>
</ul>
<h4 id="Example-Reproducing-HTML-for-Browser"><a href="#Example-Reproducing-HTML-for-Browser" class="headerlink" title="Example: Reproducing HTML for Browser"></a>Example: Reproducing HTML for Browser</h4><p>If you want the behavior that Spring Boot had. namely: provides a <code>html</code> page when requested by a browser, but a <code>json</code> page when requested by other client side applications, you need to tweak your <code>@ExceptionHandler</code> a bit.</p>
<p>For example, if you had the same <code>RequestNotFoundException</code> class, your <code>@ExceptionHandler</code> would look like:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyExceptionHandler</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">	<span class="meta">@ExceptionHandler</span>(RequestNotFoundException<span class="class">.<span class="keyword">class</span>)   // <span class="title">notice</span> <span class="title">that</span> @<span class="title">ResponceBody</span> <span class="title">is</span> <span class="title">removed</span></span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">String</span> <span class="title">handleException</span>(<span class="title">RequestNotFoundException</span> <span class="title">e</span>)</span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; error = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        error.put(<span class="string">"errorCode"</span>, <span class="string">"599"</span>);</span><br><span class="line">        error.put(<span class="string">"message"</span>,<span class="string">"Request Not Found Error"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"forward:/error"</span>;   <span class="comment">// notice the foward here</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now, when the exception <code>RequestNotFound</code> occurs, it will be <strong>forwards to the <code>/error</code> request</strong>. Remember, the <code>/error</code> request is handled well by Spring Boot.</p>
<p>However, if you run your program at this point, you will encounter a problem: although the behavior of receiving an <code>html</code> page has been reproduced, you received a White Labeled Page with an error code of <code>200</code>. This is caused by the fact that your exception <strong>cannot be resolved successfully by your <code>ExceptionResolver</code></strong>.</p>
<p>To fix this issue, we need to pass in the error code in the Spring Boot way. If we look at the class <code>AbstractErrorController</code> which is used by <code>BasicErrorController</code>, we see the method:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> HttpStatus <span class="title">getStatus</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">   Integer statusCode = (Integer) request.getAttribute(RequestDispatcher.ERROR_STATUS_CODE);	<span class="comment">// notice this line</span></span><br><span class="line">   <span class="keyword">if</span> (statusCode == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> HttpStatus.INTERNAL_SERVER_ERROR;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> HttpStatus.valueOf(statusCode);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">      <span class="keyword">return</span> HttpStatus.INTERNAL_SERVER_ERROR;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> That <code>ERROR_STATUS_CODE</code> comes from<code>String ERROR_STATUS_CODE = &quot;javax.servlet.error.status_code&quot;</code>. Therefore, to pass in the error code in the Spring Boot way, you need to:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyExceptionHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(RequestNotFoundException<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">String</span> <span class="title">handleException</span>(<span class="title">RequestNotFoundException</span> <span class="title">e</span>, <span class="title">HttpServletRequest</span> <span class="title">request</span>)</span>&#123;	<span class="comment">// changed here</span></span><br><span class="line">        request.setAttribute(<span class="string">"javax.servlet.error.status_code"</span>,<span class="number">599</span>);	<span class="comment">// changed here</span></span><br><span class="line">        request.setAttribute(<span class="string">"javax.servlet.error.message"</span>,<span class="string">"Request Not Found"</span>);	<span class="comment">// changed here</span></span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; error = <span class="keyword">new</span> HashMap&lt;&gt;();	<span class="comment">// side-effect here</span></span><br><span class="line">        error.put(<span class="string">"errorCode"</span>, <span class="string">"599"</span>);</span><br><span class="line">        error.put(<span class="string">"message"</span>,<span class="string">"Request Not Found Error"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"forward:/error"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now, the Spring Boot default resolver will be able to resolve this exception correctly, so that if the exception is raised in a browser, a html page will be shown; in other client applications, data in <code>json</code> format will be shown. </p>
<p>Yet there is still a side-effect, namely <strong>your customized information in <code>error</code> object will not be shown, since it is not used at all!</strong></p>
<h4 id="Example-Reproducing-HTML-for-Browser-while-Keeping-all-Customized-Data"><a href="#Example-Reproducing-HTML-for-Browser-while-Keeping-all-Customized-Data" class="headerlink" title="Example: Reproducing HTML for Browser while Keeping all Customized Data"></a>Example: Reproducing HTML for Browser while Keeping all Customized Data</h4><p>If you want to have the behavior of keeping your customized data (the ones stored in the <code>error</code> object above), and have the behavior of returning a <code>html</code>/<code>json</code> page based on whether a browser/other client applications are used, you have two choice:</p>
<ol>
<li><p>You can implement your own <code>ErrorController</code> class, extending from the <code>AbstractErrorController</code> (the easier way) or implementing the <code>ErrorController</code> interface (the harder way).</p>
<p>This works because they key is to change the <strong>two methods noted below (which determines the returned result)</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BasicErrorController</span> <span class="keyword">extends</span> <span class="title">AbstractErrorController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> ErrorProperties errorProperties;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Create a new &#123;<span class="doctag">@link</span> BasicErrorController&#125; instance.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> errorAttributes the error attributes</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> errorProperties configuration properties</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">BasicErrorController</span><span class="params">(ErrorAttributes errorAttributes, ErrorProperties errorProperties)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>(errorAttributes, errorProperties, Collections.emptyList());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@RequestMapping</span>(produces = MediaType.TEXT_HTML_VALUE)	<span class="comment">// this method</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">errorHtml</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">		HttpStatus status = getStatus(request);</span><br><span class="line">		Map&lt;String, Object&gt; model = Collections</span><br><span class="line">				.unmodifiableMap(getErrorAttributes(request, getErrorAttributeOptions(request, MediaType.TEXT_HTML)));</span><br><span class="line">		response.setStatus(status.value());</span><br><span class="line">		ModelAndView modelAndView = resolveErrorView(request, response, status, model);</span><br><span class="line">		<span class="keyword">return</span> (modelAndView != <span class="keyword">null</span>) ? modelAndView : <span class="keyword">new</span> ModelAndView(<span class="string">"error"</span>, model);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@RequestMapping</span>	<span class="comment">// and this method</span></span><br><span class="line">	<span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; error(HttpServletRequest request) &#123;</span><br><span class="line">		HttpStatus status = getStatus(request);</span><br><span class="line">		<span class="keyword">if</span> (status == HttpStatus.NO_CONTENT) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(status);</span><br><span class="line">		&#125;</span><br><span class="line">		Map&lt;String, Object&gt; body = getErrorAttributes(request, getErrorAttributeOptions(request, MediaType.ALL));</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(body, status);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>and this <code>BasicErrorController</code> is only injected in the container if (inside the <code>ErrorMvcAutoConfiguration</code> class):</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span>(value = ErrorController<span class="class">.<span class="keyword">class</span>, <span class="title">search</span> </span>= SearchStrategy.CURRENT)	<span class="comment">// notice here</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> BasicErrorController <span class="title">basicErrorController</span><span class="params">(ErrorAttributes errorAttributes,</span></span></span><br><span class="line"><span class="function"><span class="params">                                                 ObjectProvider&lt;ErrorViewResolver&gt; errorViewResolvers)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> BasicErrorController(errorAttributes, <span class="keyword">this</span>.serverProperties.getError(),</span><br><span class="line">                                    errorViewResolvers.orderedStream().collect(Collectors.toList()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Therefore, if you <strong>implemented your own <code>AbstractErrorController</code> abstract class or the <code>ErrorController</code> interface</strong> and <strong>overrides the two methods noted above</strong>, your should get your desired behavior.</p>
</li>
<li><p>However, if we look closer at the two methods we need to change, we can find an easier way to achieve the same goal.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(produces = MediaType.TEXT_HTML_VALUE)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">errorHtml</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">	HttpStatus status = getStatus(request);</span><br><span class="line">    <span class="comment">// both methods uses the getErrorAttributes() method to contruct the final return result</span></span><br><span class="line">	Map&lt;String, Object&gt; model = Collections</span><br><span class="line">			.unmodifiableMap(getErrorAttributes(request, getErrorAttributeOptions(request, MediaType.TEXT_HTML)));</span><br><span class="line">	response.setStatus(status.value());</span><br><span class="line">	ModelAndView modelAndView = resolveErrorView(request, response, status, model);</span><br><span class="line">	<span class="keyword">return</span> (modelAndView != <span class="keyword">null</span>) ? modelAndView : <span class="keyword">new</span> ModelAndView(<span class="string">"error"</span>, model);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; error(HttpServletRequest request) &#123;</span><br><span class="line">	HttpStatus status = getStatus(request);</span><br><span class="line">	<span class="keyword">if</span> (status == HttpStatus.NO_CONTENT) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(status);</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">// both methods uses the getErrorAttributes() method to contruct the final return result</span></span><br><span class="line">	Map&lt;String, Object&gt; body = getErrorAttributes(request, getErrorAttributeOptions(request, MediaType.ALL));</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(body, status);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Now, if we look at that <code>getErrorAttributes</code> method, we see:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> Map&lt;String, Object&gt; <span class="title">getErrorAttributes</span><span class="params">(HttpServletRequest request, ErrorAttributeOptions options)</span> </span>&#123;</span><br><span class="line">	WebRequest webRequest = <span class="keyword">new</span> ServletWebRequest(request);</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">this</span>.errorAttributes.getErrorAttributes(webRequest, options);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>and that <code>ErrorAttribute</code> also has a default implementation injected, namely:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span>(value = ErrorAttributes<span class="class">.<span class="keyword">class</span>, <span class="title">search</span> </span>= SearchStrategy.CURRENT)</span><br><span class="line"><span class="function"><span class="keyword">public</span> DefaultErrorAttributes <span class="title">errorAttributes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> DefaultErrorAttributes();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Therefore, we could just <strong>implement our own <code>ErrorAttributes</code> class</strong>, which has to satisfy the following, or <strong>extending that <code>DefaultErrorAttribute</code> class while overriding its <code>getErrorAttributes()</code> method</strong> (which is easier):</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ErrorAttributes</span> </span>&#123;</span><br><span class="line">    <span class="comment">/** <span class="doctag">@deprecated</span> */</span></span><br><span class="line">    <span class="meta">@Deprecated</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> Map&lt;String, Object&gt; <span class="title">getErrorAttributes</span><span class="params">(WebRequest webRequest, <span class="keyword">boolean</span> includeStackTrace)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Collections.emptyMap();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">default</span> Map&lt;String, Object&gt; <span class="title">getErrorAttributes</span><span class="params">(WebRequest webRequest, ErrorAttributeOptions options)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.getErrorAttributes(webRequest, options.isIncluded(Include.STACK_TRACE));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">Throwable <span class="title">getError</span><span class="params">(WebRequest webRequest)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Here, we will simply extend that <code>DefaultErrorAttribute</code> class:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyErrorAttributes</span> <span class="keyword">extends</span> <span class="title">DefaultErrorAttributes</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">getErrorAttributes</span><span class="params">(WebRequest webRequest, ErrorAttributeOptions options)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; errorAttributes = <span class="keyword">super</span>.getErrorAttributes(webRequest, options);</span><br><span class="line">        errorAttributes.put(<span class="string">"new_thing"</span>,<span class="string">"default_value_here"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// this receives the error object</span></span><br><span class="line">        Map&lt;String, Object&gt; extension = (Map&lt;String, Object&gt;) webRequest.getAttribute(<span class="string">"extension"</span>, <span class="number">0</span>);	<span class="comment">// see later</span></span><br><span class="line">        errorAttributes.put(<span class="string">"extension"</span>, extension);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// you can also do this, if you are sure that there is no name collision</span></span><br><span class="line">        <span class="comment">/*errorAttributes.putAll(extension);*/</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> errorAttributes;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>And your <code>@ExceptionHandler</code> looks like:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyExceptionHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(RequestNotFoundException<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">String</span> <span class="title">handleException</span>(<span class="title">RequestNotFoundException</span> <span class="title">e</span>, <span class="title">HttpServletRequest</span> <span class="title">request</span>)</span>&#123;</span><br><span class="line">        request.setAttribute(<span class="string">"javax.servlet.error.status_code"</span>,<span class="number">509</span>);</span><br><span class="line">        request.setAttribute(<span class="string">"javax.servlet.error.message"</span>,<span class="string">"Request Not Found"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; error = <span class="keyword">new</span> HashMap&lt;&gt;();  </span><br><span class="line">        error.put(<span class="string">"errorCode"</span>, <span class="string">"599"</span>);</span><br><span class="line">        error.put(<span class="string">"message"</span>,<span class="string">"Request Not Found Error"</span>);</span><br><span class="line"></span><br><span class="line">        request.setAttribute(<span class="string">"extension"</span>,error);    <span class="comment">// so that our ErrorAttribute class above can access it</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"forward:/error"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now, if you revisit your site, everything would work correctly. This would be the <strong>ultimate solution</strong>.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled="" type="checkbox"> <p>We see that <code>webRequest.getAttribute(&quot;extension&quot;, 0)</code> needs two parameters. The second parameter actually specifies which scope to get that attribute object. For more details, look that that <code>getAttribute()</code> method:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">RequestAttributes</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> SCOPE_REQUEST = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> SCOPE_SESSION = <span class="number">1</span>;</span><br><span class="line">    String REFERENCE_REQUEST = <span class="string">"request"</span>;</span><br><span class="line">    String REFERENCE_SESSION = <span class="string">"session"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="function">Object <span class="title">getAttribute</span><span class="params">(String var1, <span class="keyword">int</span> var2)</span></span>;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
</li>
</ol>
<h2 id="Caching-in-Spring-Boot"><a href="#Caching-in-Spring-Boot" class="headerlink" title="Caching in Spring Boot"></a>Caching in Spring Boot</h2><p>Topics addressed here includes the <code>JSR-107</code> standard, Spring Cache Abstraction, and <code>redis</code> inclusion in Spring Boot.</p>
<p>Caching is used widely for web applications, as it can <strong>reduce the number of round-trips</strong> when a query has been made. This is achieved by storing data temporarily in cache, which then can be retrieved by clients immediately (before expiration) since it is now stored locally. This also has the further advantage of enjoying the hardware spec of the client instead of letting the server/database do all those work <code>:)</code>. As a result, this can <strong>speed up your application and its performance</strong>. </p>
<h3 id="JSR107-JCache"><a href="#JSR107-JCache" class="headerlink" title="JSR107/JCache"></a><code>JSR107</code>/<code>JCache</code></h3><p><code>JCache</code> (aka <strong>JSR-107</strong>) specification defines the <strong>standard caching API for Java</strong>. These include:</p>
<ul>
<li><code>CachingProvider</code><ul>
<li>This API is used to <strong>create/configure/manage multiple <code>CacheManager</code></strong>. There can be multiple instance of this in an application.</li>
</ul>
</li>
<li><code>CacheManager</code><ul>
<li>This API is used to <strong>create/configure/manage multiple  (unique) <code>Cache</code> instances</strong>. There can be multiple <code>CacheManager</code> controller by a <code>CachingProvider</code>, but <strong>a <code>CacheManager</code> can only be controlled by one <code>CachingProvider</code></strong>.</li>
</ul>
</li>
<li><code>Cache</code><ul>
<li>This API is used to store <code>Entries</code>.  It can be thought as <strong>a <code>HashMap</code> data structure, which stores <code>Entry</code></strong> that is basically a key-value pair.</li>
</ul>
</li>
<li><code>Entry</code><ul>
<li>This API is basically <strong>a key-value pair of data being stored in the <code>Cache</code></strong>. The <strong>same <code>Entry</code> can be stored in multiple different <code>Cache</code></strong> as well.</li>
</ul>
</li>
<li><code>Expiry</code><ul>
<li>This API controls the <strong>expiration time of a cache <code>Entry</code></strong>. This is also stored in a <code>Cache</code>. Once the expiration time passed, that <code>Entry</code> can no longer be accessed, updated or deleted. </li>
</ul>
</li>
</ul>
<p>A graphical representation of the above would be:</p>
<p><img src="jsr107-graph.png" alt="jsr107-graph.png" title="jsr107-graph.png"></p>
<h4 id="Importing-JSR107-API"><a href="#Importing-JSR107-API" class="headerlink" title="Importing JSR107 API"></a>Importing <code>JSR107</code> API</h4><p>First, you will need to import the dependency:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.cache<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cache-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Now, if you look at the <code>jar</code> package imported, you will find the five API mentioned above:</p>
<p><img src="jsr107-jar.png" alt="jsr107-jar.png" title="jsr107-jar.png"></p>
<p>For example, in that <code>CacheProvider</code> class, you will see <strong>methods such as</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CachingProvider</span> <span class="keyword">extends</span> <span class="title">Closeable</span> </span>&#123;</span><br><span class="line">    <span class="function">CacheManager <span class="title">getCacheManager</span><span class="params">(URI var1, ClassLoader var2, Properties var3)</span></span>;	<span class="comment">// notice here</span></span><br><span class="line"></span><br><span class="line">    <span class="function">ClassLoader <span class="title">getDefaultClassLoader</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">URI <span class="title">getDefaultURI</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Properties <span class="title">getDefaultProperties</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">CacheManager <span class="title">getCacheManager</span><span class="params">(URI var1, ClassLoader var2)</span></span>; <span class="comment">// here</span></span><br><span class="line"></span><br><span class="line">    <span class="function">CacheManager <span class="title">getCacheManager</span><span class="params">()</span></span>; <span class="comment">// and here</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">close</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">close</span><span class="params">(ClassLoader var1)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">close</span><span class="params">(URI var1, ClassLoader var2)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isSupported</span><span class="params">(OptionalFeature var1)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>and in <code>CacheManager</code> interface, you will find:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CacheManager</span> <span class="keyword">extends</span> <span class="title">Closeable</span> </span>&#123;</span><br><span class="line">    <span class="function">CachingProvider <span class="title">getCachingProvider</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    &lt;K, V&gt; <span class="function">Cache&lt;K, V&gt; <span class="title">getCache</span><span class="params">(String var1, Class&lt;K&gt; var2, Class&lt;V&gt; var3)</span></span>;	<span class="comment">// notice here</span></span><br><span class="line"></span><br><span class="line">    &lt;K, V&gt; <span class="function">Cache&lt;K, V&gt; <span class="title">getCache</span><span class="params">(String var1)</span></span>;	<span class="comment">// and here</span></span><br><span class="line"></span><br><span class="line">    <span class="function">Iterable&lt;String&gt; <span class="title">getCacheNames</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">destroyCache</span><span class="params">(String var1)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">enableManagement</span><span class="params">(String var1, <span class="keyword">boolean</span> var2)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">enableStatistics</span><span class="params">(String var1, <span class="keyword">boolean</span> var2)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">close</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isClosed</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    &lt;T&gt; <span class="function">T <span class="title">unwrap</span><span class="params">(Class&lt;T&gt; var1)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then the other three classes are also straight forward enough so that they are not shown here.</p>
<p>However, a problem with using <code>JSR107</code> is that not all implementations we use later implements <code>JSR107</code>. This means that if we use <code>JSR107</code> APIs, we might need to implement some of the methods by ourselves for things to work correctly.</p>
<p>Luckily, Spring also has a solution to this by providing its own APIs, <strong>the Spring Cache Abstraction</strong>, which also allows us to use annotations (also available in <code>JSR107</code>).</p>
<h3 id="Spring-Cache-Abstraction"><a href="#Spring-Cache-Abstraction" class="headerlink" title="Spring Cache Abstraction"></a>Spring Cache Abstraction</h3><p>Spring simplifies the <code>JSR107</code> APIs by <strong>using only <code>CacheManager</code> and <code>Cache</code> as the central APIs (other three APIs are also implemented, but not meant for us to use directly)</strong>, as well as some annotations (some from <code>JSR-107</code>, some made by Spring).</p>
<table>
<thead>
<tr>
<th>API/Annotation</th>
<th>Usage</th>
</tr>
</thead>
<tbody><tr>
<td><code>Cache</code></td>
<td>API that <strong>defines all the caching operation</strong> (e.g. CRUD). Spring has some default implementations including <code>RedisCache</code>, <code>EhCacheCache</code>, <code>ConcurrentMapCache</code>, etc.</td>
</tr>
<tr>
<td><code>CacheManager</code></td>
<td>API that <strong>creates and manages <code>Cache</code></strong>.</td>
</tr>
<tr>
<td><code>@Cacheable</code></td>
<td>Mainly used on reading methods. This will cache the argument and result pair of a method call. After being cached, this <strong>method with the same argument called will not be executed anymore.</strong></td>
</tr>
<tr>
<td><code>@CacheEvict</code></td>
<td>Mainly used on deleting methods. This will <strong>delete a specific result from the cache</strong>.</td>
</tr>
<tr>
<td><code>@CachePut</code></td>
<td>Mainly used on updating methods. This will cache/update the argument and result pair in the <code>Cache</code>. The method will <strong>always execute even it has been cached</strong>.</td>
</tr>
<tr>
<td><code>@EnableCaching</code></td>
<td>Enables the caching behavior <strong>with annotation</strong> described above.</td>
</tr>
<tr>
<td><code>KeyGenerator</code></td>
<td>Defines how the <code>key</code> data is stored in a <code>Cache</code> for later look ups.</td>
</tr>
<tr>
<td><code>serialize</code></td>
<td>Defines how the <code>value</code> data is stored in a <code>Cache</code> (e.g. when you are storing an object).</td>
</tr>
</tbody></table>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled="" type="checkbox"> Whenever you use <code>@Cacheable</code>, <code>@CachePut</code>, and <code>@CacheEvict</code> together, you need to <strong>make sure that they are manipulating</strong> entry with the <strong>same key</strong>!</li>
</ul>
</blockquote>
<h4 id="Importing-Spring-Cache"><a href="#Importing-Spring-Cache" class="headerlink" title="Importing Spring Cache"></a>Importing Spring Cache</h4><p>To import Spring Cache Abstraction, add the following dependency to your <code>pom.xml</code>:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="Using-Spring-Cache"><a href="#Using-Spring-Cache" class="headerlink" title="Using Spring Cache"></a>Using Spring Cache</h4><p>First, you need to have some sort of database access setup, and some query operations implemented (assuming you want to cache those).</p>
<p>Now, to enable caching and start using caching operations, you need to do the following steps:</p>
<ol>
<li>To use annotation based caching operations, add <code>@EnableCaching</code> to your application.</li>
<li>Use annotation <code>@Cacheable</code>, <code>@CacheEvict</code>, etc. mentioned in the table above.<ol>
<li>When you specify <code>@Cacheable</code> (for example), you can/should also specify some of the options, including <code>cacheName</code>, <code>key</code>/<code>keyGenerator</code>, <code>cacheManager</code>, and etc.</li>
</ol>
</li>
</ol>
<p><strong>A simple example</strong> would be:</p>
<p>Your main application class:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.testmybatis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.EnableCaching;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan</span>(<span class="string">"com.example.testmybatis.mappers"</span>)</span><br><span class="line"><span class="meta">@EnableCaching</span>	<span class="comment">// notice here</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestMybatisApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(TestMybatisApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>One of your controller class:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.testmybatis.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.Cacheable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">testCachingController</span> </span>&#123;</span><br><span class="line">    Logger logger = LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Cacheable</span>(cacheNames = <span class="string">"test"</span>)	<span class="comment">// notice here</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/cache/calc/&#123;num&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">multiplyByTwo</span><span class="params">(@PathVariable(name = <span class="string">"num"</span>)</span> Integer num)</span>&#123;</span><br><span class="line">        logger.info(<span class="string">"Entered Cacheable Method"</span>);</span><br><span class="line">        <span class="keyword">return</span> num*<span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now, the first time you go to <code>localhost:8080/cache/calc/2</code>, this method will be run and you will see the logger info <code>Entered Cacheable Method</code>. However, if you resend the same request by refreshing it, <strong>this method will no longer be entered</strong> yet the result will be returned (from cache).</p>
<p>Some of the options that you can specify with <code>@Cacheable</code> include:</p>
<ul>
<li><code>cacheName</code> or<code>value</code><ul>
<li>This sets the <strong>name of the cache</strong>(s) that this data/entry will go to (see picture below)</li>
</ul>
</li>
<li><code>key</code> or <code>keyGenerator</code><ul>
<li>This sets the <strong>key of the entry</strong> that will be stored in cache (<strong>by default it uses the method argument</strong>)</li>
<li>Some <code>SpEL</code> can be used<ul>
<li>e.g. <code>@Cacheable(key=&quot;#root.methodName + &#39;[&#39; + #a0 + &#39;]&#39;&quot;)</code></li>
</ul>
</li>
</ul>
</li>
<li><code>cacheManager</code> or <code>cacheResolver</code><ul>
<li>This sets the <code>cacheManager</code> that its corresponding cache should point to</li>
</ul>
</li>
<li><code>condition</code><ul>
<li>This sets the condition of when to cache the entry. Entry will <strong>be cached if this condition returns <code>true</code></strong> <ul>
<li>e.g. <code>@Cacheable(condition = &quot;#a0 eq &#39;aaaa&#39; and #a1 &gt; 0&quot;)</code></li>
</ul>
</li>
</ul>
</li>
<li><code>unless</code><ul>
<li>This sets the condition of when to cache the entry. Entry will <strong>not be cached if this condition returns <code>true</code></strong> </li>
</ul>
</li>
</ul>
<p><img src="caching-example.png" alt="Picture taken from www.atguigu.com" title="Picture taken from www.atguigu.com"></p>
<p>For more details on each of the options mentioned above, you can look into the class <code>@Cacheable</code>.</p>
<p><strong>Some of the <code>SpEL</code> you can use in those options</strong>:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Location</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody><tr>
<td><code>methodName</code></td>
<td>root object</td>
<td>The <strong>name of the method</strong> being invoked</td>
<td><code>#root.methodName</code></td>
</tr>
<tr>
<td><code>method</code></td>
<td>root object</td>
<td>The method being invoked</td>
<td><code>#root.method.name</code></td>
</tr>
<tr>
<td><code>target</code></td>
<td>root object</td>
<td>The <strong>target object</strong> being invoked</td>
<td><code>#root.target</code></td>
</tr>
<tr>
<td><code>targetClass</code></td>
<td>root object</td>
<td>The <strong>class of the target</strong> being invoked</td>
<td><code>#root.targetClass</code></td>
</tr>
<tr>
<td><code>args</code></td>
<td>root object</td>
<td>The <strong>arguments</strong> (as array) used for invoking the target</td>
<td><code>#root.args[0]</code></td>
</tr>
<tr>
<td><code>caches</code></td>
<td>root object</td>
<td>Collection of caches against which the current method is executed</td>
<td><code>#root.caches[0].name</code></td>
</tr>
<tr>
<td><em>argument name</em></td>
<td>evaluation context</td>
<td>Name of any of the method argument. If for some reason the names are not available (ex: no debug information), the argument names are also available under the <code>a&lt;#arg&gt;</code> where <em>#arg</em> stands for the argument index (starting from 0).</td>
<td><code>iban</code>or<code>a0</code>(one can also use<code>p0</code>or <code>p&lt;#arg&gt;</code> notation as an alias).</td>
</tr>
<tr>
<td><code>result</code></td>
<td>evaluation context</td>
<td>The <strong>result of the method call</strong> (the value to be cached). <strong>Only available in ‘<code>unless</code>‘ expressions and <code>cache evict</code> expression</strong> (when <code>beforeInvocation</code> is <code>false</code>).</td>
<td><code>#result</code></td>
</tr>
</tbody></table>
<p>(Table from <a href="https://docs.spring.io/spring/docs/3.2.x/spring-framework-reference/html/cache.html" target="_blank" rel="noopener">https://docs.spring.io/spring/docs/3.2.x/spring-framework-reference/html/cache.html</a>, for information on other <code>SpEL</code>, you should also visit that link)</p>
<h4 id="Spring-Implementation"><a href="#Spring-Implementation" class="headerlink" title="Spring Implementation"></a>Spring Implementation</h4><p>The first thing to do is to look at the <code>xxxAutoConfiguration</code> of course. If we look at the <code>CacheAutoConfiguration</code>class:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>(proxyBeanMethods = <span class="keyword">false</span>)</span><br><span class="line"><span class="meta">@ConditionalOnClass</span>(CacheManager<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">ConditionalOnBean</span>(<span class="title">CacheAspectSupport</span>.<span class="title">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">ConditionalOnMissingBean</span>(<span class="title">value</span> </span>= CacheManager<span class="class">.<span class="keyword">class</span>, <span class="title">name</span> </span>= <span class="string">"cacheResolver"</span>)</span><br><span class="line"><span class="meta">@EnableConfigurationProperties</span>(CacheProperties<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">AutoConfigureAfter</span>(</span>&#123; CouchbaseAutoConfiguration<span class="class">.<span class="keyword">class</span>, <span class="title">HazelcastAutoConfiguration</span>.<span class="title">class</span>,</span></span><br><span class="line"><span class="class">		<span class="title">HibernateJpaAutoConfiguration</span>.<span class="title">class</span>, <span class="title">RedisAutoConfiguration</span>.<span class="title">class</span> &#125;)</span></span><br><span class="line"><span class="class">@<span class="title">Import</span>(</span>&#123; CacheConfigurationImportSelector<span class="class">.<span class="keyword">class</span>, <span class="title">CacheManagerEntityManagerFactoryDependsOnPostProcessor</span>.<span class="title">class</span> &#125;)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">CacheAutoConfiguration</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * &#123;<span class="doctag">@link</span> ImportSelector&#125; to add &#123;<span class="doctag">@link</span> CacheType&#125; configuration classes.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CacheConfigurationImportSelector</span> <span class="keyword">implements</span> <span class="title">ImportSelector</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span>	<span class="comment">// this method imports all those CacheConfigurations</span></span><br><span class="line">		<span class="keyword">public</span> String[] selectImports(AnnotationMetadata importingClassMetadata) &#123;</span><br><span class="line">			CacheType[] types = CacheType.values();</span><br><span class="line">			String[] imports = <span class="keyword">new</span> String[types.length];</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; types.length; i++) &#123;</span><br><span class="line">				imports[i] = CacheConfigurations.getConfigurationClass(types[i]);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> imports;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>If you run this with the <code>debugger</code> of IntelliJ, you will see the following <code>Configurations</code> imported:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">0 &#x3D; &quot;org.springframework.boot.autoconfigure.cache.GenericCacheConfiguration&quot;</span><br><span class="line">1 &#x3D; &quot;org.springframework.boot.autoconfigure.cache.JCacheCacheConfiguration&quot;</span><br><span class="line">2 &#x3D; &quot;org.springframework.boot.autoconfigure.cache.EhCacheCacheConfiguration&quot;</span><br><span class="line">3 &#x3D; &quot;org.springframework.boot.autoconfigure.cache.HazelcastCacheConfiguration&quot;</span><br><span class="line">4 &#x3D; &quot;org.springframework.boot.autoconfigure.cache.InfinispanCacheConfiguration&quot;</span><br><span class="line">5 &#x3D; &quot;org.springframework.boot.autoconfigure.cache.CouchbaseCacheConfiguration&quot;</span><br><span class="line">6 &#x3D; &quot;org.springframework.boot.autoconfigure.cache.RedisCacheConfiguration&quot;</span><br><span class="line">7 &#x3D; &quot;org.springframework.boot.autoconfigure.cache.CaffeineCacheConfiguration&quot;</span><br><span class="line">8 &#x3D; &quot;org.springframework.boot.autoconfigure.cache.SimpleCacheConfiguration&quot;</span><br><span class="line">9 &#x3D; &quot;org.springframework.boot.autoconfigure.cache.NoOpCacheConfiguration&quot;</span><br></pre></td></tr></table></figure>

<p>To see which configurations will be used in the end, you can either look at the conditions on the class headers, or you can run your application with <code>debug=true</code>, from which you will see that only one <code>Configuration</code> is matched (assuming you were following the example made above):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SimpleCacheConfiguration matched:</span><br><span class="line">      - Cache org.springframework.boot.autoconfigure.cache.SimpleCacheConfiguration automatic cache <span class="built_in">type</span> (CacheCondition)</span><br><span class="line">      - @ConditionalOnMissingBean (types: org.springframework.cache.CacheManager; SearchStrategy: all) did not find any beans (OnBeanCondition)</span><br></pre></td></tr></table></figure>

<p>Now, if you look at the <code>SimpleCacheConfiguration</code> class, you will see that it uses a <code>ConcurrentMapCacheManager</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>(proxyBeanMethods = <span class="keyword">false</span>)</span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span>(CacheManager<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">Conditional</span>(<span class="title">CacheCondition</span>.<span class="title">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">SimpleCacheConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span>	<span class="comment">// notice here</span></span><br><span class="line">	<span class="function">ConcurrentMapCacheManager <span class="title">cacheManager</span><span class="params">(CacheProperties cacheProperties,</span></span></span><br><span class="line"><span class="function"><span class="params">			CacheManagerCustomizers cacheManagerCustomizers)</span> </span>&#123;</span><br><span class="line">		ConcurrentMapCacheManager cacheManager = <span class="keyword">new</span> ConcurrentMapCacheManager();</span><br><span class="line">		List&lt;String&gt; cacheNames = cacheProperties.getCacheNames();</span><br><span class="line">		<span class="keyword">if</span> (!cacheNames.isEmpty()) &#123;</span><br><span class="line">			cacheManager.setCacheNames(cacheNames);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> cacheManagerCustomizers.customize(cacheManager);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Further source codes will not be shown here, but in summary:</p>
<ul>
<li><p><code>ConcurrentMapCacheManager</code> stores its <code>Cache</code> objects in a <code>ConcurrentMap&lt;String, Cache&gt;</code> data structure, in which <code>String</code> will be cache name.</p>
</li>
<li><p><code>ConcurrentMapCacheManager</code> creates its <code>Cache</code> from the method:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> Cache <span class="title">createConcurrentMapCache</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">    SerializationDelegate actualSerialization = <span class="keyword">this</span>.isStoreByValue() ? <span class="keyword">this</span>.serialization : <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ConcurrentMapCache(name, <span class="keyword">new</span> ConcurrentHashMap(<span class="number">256</span>), <span class="keyword">this</span>.isAllowNullValues(), actualSerialization);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This returns a <code>ConcurrentMapCache</code>, which would be the <code>Cache</code> data structure to store the cache</p>
<ul>
<li>The <code>ConcurrentMapCache</code> stores its key-value pair entry with  <code>ConcurrentMap&lt;Object, Object&gt;</code>, which means both its key and its value will be objects:</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcurrentMapCache</span> <span class="keyword">extends</span> <span class="title">AbstractValueAdaptingCache</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ConcurrentMap&lt;Object, Object&gt; store;</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SerializationDelegate serialization;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="Mechanism-2"><a href="#Mechanism-2" class="headerlink" title="Mechanism"></a>Mechanism</h4><p>What happens under the hood when a <code>@Cacheable</code> is encountered? For example, when a request is sent to the following handler:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">testCachingController</span> </span>&#123;</span><br><span class="line">    Logger logger = LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// what happens when it reaches here?</span></span><br><span class="line">    <span class="meta">@Cacheable</span>(cacheNames = <span class="string">"test"</span>)</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/cache/calc/&#123;num&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">multiplyByTwo</span><span class="params">(@PathVariable(name = <span class="string">"num"</span>)</span> Integer num)</span>&#123;</span><br><span class="line">        logger.info(<span class="string">"Entered Cacheable Method"</span>);</span><br><span class="line">        <span class="keyword">return</span> num*<span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><p>First, before this method gets executed, it will first <strong>look for the cache name</strong> with <code>test</code> by using the method from <code>ConcurrentCacheManager</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Cache <span class="title">getCache</span><span class="params">(String name)</span> </span>&#123;	<span class="comment">// this method</span></span><br><span class="line">    Cache cache = (Cache)<span class="keyword">this</span>.cacheMap.get(name);</span><br><span class="line">    <span class="keyword">if</span> (cache == <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.dynamic) &#123;</span><br><span class="line">        <span class="keyword">synchronized</span>(<span class="keyword">this</span>.cacheMap) &#123;</span><br><span class="line">            cache = (Cache)<span class="keyword">this</span>.cacheMap.get(name);</span><br><span class="line">            <span class="keyword">if</span> (cache == <span class="keyword">null</span>) &#123;</span><br><span class="line">                cache = <span class="keyword">this</span>.createConcurrentMapCache(name);	<span class="comment">// creates if cache does not exist</span></span><br><span class="line">                <span class="keyword">this</span>.cacheMap.put(name, cache);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> cache;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Next, with this <code>Cache</code> created (<code>ConcurrentMapCache</code>), it will then <strong>first look into that cache to see if that key exists</strong> (even if the cache has just been created). This is executed inside the <code>ConcurrentMapCache</code> class:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> Object <span class="title">lookup</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.store.get(key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled="" type="checkbox"> <strong>Where does the key come from?</strong> After the method argument being passed in and before this step, there is a <code>generateKey()</code> method which generates the key based on a <code>KeyGenerator</code>. By default, it uses <code>SimpleKeyGenerator</code>. </li>
</ul>
</blockquote>
</li>
<li><p>If this <code>lookup()</code> <strong>did not find the key</strong>, then the <strong>method in the controller will be called</strong>. If <strong>found</strong>, <strong>returns the result</strong>.</p>
</li>
<li><p>If the <strong>controller continued its execution</strong>, then the returned result will not only be returned to the user, but also <strong>stored in the cache</strong> with the method in the <code>ConcurrentMapCache</code> class:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(Object key, @Nullable Object value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.store.put(key, <span class="keyword">this</span>.toStoreValue(value));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="Example-Using-a-Customized-KeyGenerator"><a href="#Example-Using-a-Customized-KeyGenerator" class="headerlink" title="Example: Using a Customized KeyGenerator"></a>Example: Using a Customized <code>KeyGenerator</code></h4><p>First you need to inject a bean of type <code>KeyGenerator</code> with a <strong>specific bean name</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.testmybatis.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.interceptor.KeyGenerator;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CacheConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(value = <span class="string">"myKeyGenerator"</span>) <span class="comment">// this will be used to identify which generator to use</span></span><br><span class="line"><span class="comment">//    @Qualifier(value = "myKeyGenerator") this is equivalent as above</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> KeyGenerator <span class="title">keyGenerator</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> KeyGenerator() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">generate</span><span class="params">(Object o, Method method, Object... objects)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> method.getName() + Arrays.asList(objects).toString();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now, to use this <code>KeyGenerator</code>, you just need to refer to this bean name:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.testmybatis.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.Cacheable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">testCachingController</span> </span>&#123;</span><br><span class="line">    Logger logger = LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Cacheable</span>(cacheNames = <span class="string">"test"</span>, keyGenerator = <span class="string">"myKeyGenerator"</span>)	<span class="comment">// referred here</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/cache/calc/&#123;num&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">multiplyByTwo</span><span class="params">(@PathVariable(name = <span class="string">"num"</span>)</span> Integer num)</span>&#123;</span><br><span class="line">        logger.info(<span class="string">"Entered Cacheable Method"</span>);</span><br><span class="line">        <span class="keyword">return</span> num*<span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Example-Using-Caching"><a href="#Example-Using-Caching" class="headerlink" title="Example: Using @Caching"></a>Example: Using <code>@Caching</code></h4><p><code>@Caching</code> has not been mentioned before, but this is simply a collection of <code>@Cacheable</code>, <code>@CachePut</code>, and <code>@CacheEvict</code> annotation. Using <code>@Caching</code> allows us to combine complicated behavior of manipulating entries in a cache.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.cache.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Documented;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Inherited;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Target</span>(&#123;ElementType.TYPE, ElementType.METHOD&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Caching &#123;</span><br><span class="line">    Cacheable[] cacheable() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    CachePut[] put() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    CacheEvict[] evict() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>An example usage would be:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.testmybatis.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.CacheEvict;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.CachePut;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.Cacheable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.Caching;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">testCachingController</span> </span>&#123;</span><br><span class="line">    Logger logger = LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Caching</span>(</span><br><span class="line">            cacheable = &#123;</span><br><span class="line">                    <span class="meta">@Cacheable</span>(cacheNames = <span class="string">"test"</span>, keyGenerator = <span class="string">"myKeyGenerator"</span>)</span><br><span class="line">            &#125;,</span><br><span class="line">            put = &#123;</span><br><span class="line">                    <span class="meta">@CachePut</span>(cacheNames = <span class="string">"test"</span>)  <span class="comment">// for the sake of an example</span></span><br><span class="line">            &#125;,</span><br><span class="line">            evict = &#123;</span><br><span class="line">                    <span class="meta">@CacheEvict</span>(cacheNames = <span class="string">"test"</span>)    <span class="comment">// for the sake of an example</span></span><br><span class="line">            &#125;</span><br><span class="line">    )</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/cache/calc/&#123;num&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">multiplyByTwo</span><span class="params">(@PathVariable(name = <span class="string">"num"</span>)</span> Integer num)</span>&#123;</span><br><span class="line">        logger.info(<span class="string">"Entered Cacheable Method"</span>);</span><br><span class="line">        <span class="keyword">return</span> num*<span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled="" type="checkbox"> Notice that there is a <strong>conflict between using <code>@Cacheable</code> and <code>@CachePut</code></strong>, namely that if <code>@Cacheable</code> does not always invoke the method yet <code>@CachePut</code> always needs the method to execute. The effect in the end would be <code>@CachePut</code> overriding <code>@Cacheable</code>, such that <strong>even if the <code>key</code> is found in the cache, the method will still execute</strong>.</li>
</ul>
</blockquote>
<h4 id="Using-CacheConfig"><a href="#Using-CacheConfig" class="headerlink" title="Using @CacheConfig"></a>Using <code>@CacheConfig</code></h4><p>Notice that all of the above annotations have to specify <code>cacheName= &quot;test&quot;</code>. Is there a way to centralize those common configurations altogether to save the typing? This can be <strong>achieved with <code>@CacheConfig</code> annotation with some specified properties at the class level</strong>.</p>
<p>The <code>@CacheConfig</code> class looks like:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.cache.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Documented;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Target</span>(&#123;ElementType.TYPE&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> CacheConfig &#123;</span><br><span class="line">    String[] cacheNames() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">keyGenerator</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">cacheManager</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">cacheResolver</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This means that you can specify four common properties for all the cache annotations in the same class. For example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.testmybatis.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@CacheConfig</span>(cacheNames = <span class="string">"test"</span>)	<span class="comment">// centralizing some cache properties</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">testCachingController</span> </span>&#123;</span><br><span class="line">    Logger logger = LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Cacheable</span>(keyGenerator = <span class="string">"myKeyGenerator"</span>) <span class="comment">// will be saved to cache with name "test"</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/cache/calc/&#123;num&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">multiplyByTwo</span><span class="params">(@PathVariable(name = <span class="string">"num"</span>)</span> Integer num)</span>&#123;</span><br><span class="line">        logger.info(<span class="string">"Entered Cacheable Method"</span>);</span><br><span class="line">        <span class="keyword">return</span> num*<span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Using-Redis-in-Spring-Cache"><a href="#Using-Redis-in-Spring-Cache" class="headerlink" title="Using Redis in Spring Cache"></a>Using Redis in Spring Cache</h3><p>By default, Spring uses <code>SimpleCacheConfiguration</code>, which stores cache data essentially in <code>ConcurrentMap&lt;Object, Object&gt;</code> data structure. However, what if we want to use <code>Redis</code> as our caching mechanism? To do this, we need to make sure that <strong><code>RedisCacheConfiguration</code> is imported and enabled in our project</strong>.</p>
<h4 id="Importing-Redis"><a href="#Importing-Redis" class="headerlink" title="Importing Redis"></a>Importing Redis</h4><p>If you look at <code>RedisCacheConfiguration</code> class, you will see the following class header:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>(proxyBeanMethods = <span class="keyword">false</span>)</span><br><span class="line"><span class="meta">@ConditionalOnClass</span>(RedisConnectionFactory<span class="class">.<span class="keyword">class</span>)	// <span class="title">this</span> <span class="title">means</span> <span class="title">we</span> <span class="title">absolutely</span> <span class="title">need</span> <span class="title">the</span> <span class="title">class</span> <span class="title">RedisConnectionFactory</span></span></span><br><span class="line"><span class="class">@<span class="title">AutoConfigureAfter</span>(<span class="title">RedisAutoConfiguration</span>.<span class="title">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">ConditionalOnBean</span>(<span class="title">RedisConnectionFactory</span>.<span class="title">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">ConditionalOnMissingBean</span>(<span class="title">CacheManager</span>.<span class="title">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">Conditional</span>(<span class="title">CacheCondition</span>.<span class="title">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">RedisCacheConfiguration</span> </span>&#123;</span><br></pre></td></tr></table></figure>

<p>Therefore, the logical step would be importing the <code>Redis</code> dependency related to Spring:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Since this is related to Spring Boot Starter, it will use the <code>RedisAutoConfiguration</code> class:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>(proxyBeanMethods = <span class="keyword">false</span>)</span><br><span class="line"><span class="meta">@ConditionalOnClass</span>(RedisOperations<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">EnableConfigurationProperties</span>(<span class="title">RedisProperties</span>.<span class="title">class</span>)</span></span><br><span class="line"><span class="class">// <span class="title">these</span> <span class="title">classes</span> <span class="keyword">implements</span> <span class="title">RedisConnectionFactory</span></span></span><br><span class="line"><span class="class">@<span class="title">Import</span>(</span>&#123; LettuceConnectionConfiguration<span class="class">.<span class="keyword">class</span>, <span class="title">JedisConnectionConfiguration</span>.<span class="title">class</span> &#125;)	</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">RedisAutoConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="meta">@ConditionalOnMissingBean</span>(name = <span class="string">"redisTemplate"</span>)</span><br><span class="line">    <span class="comment">// notice here</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> RedisTemplate&lt;Object, Object&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> UnknownHostException </span>&#123;</span><br><span class="line">		RedisTemplate&lt;Object, Object&gt; template = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line">		template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">		<span class="keyword">return</span> template;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="comment">// and this template</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> StringRedisTemplate <span class="title">stringRedisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> UnknownHostException </span>&#123;</span><br><span class="line">		StringRedisTemplate template = <span class="keyword">new</span> StringRedisTemplate();</span><br><span class="line">		template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">		<span class="keyword">return</span> template;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Notice that we will have <code>RedisTemplate&lt;Object, Object&gt;</code> injected as bean into our project (remember the <code>JDBCTemplate</code> that we used before), which we will touch on shortly.</p>
<h4 id="Configuring-your-Redis-Connection"><a href="#Configuring-your-Redis-Connection" class="headerlink" title="Configuring your Redis Connection"></a>Configuring your Redis Connection</h4><p>This is even simpler than configuring database connection: all you need to do is to specify your <code>Redis</code> host IP and port (by default <code>6379</code>):</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.217</span><span class="number">.100</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br></pre></td></tr></table></figure>

<p>Once the connection is established, all you need to do is to use either <code>RedisTemplate&lt;Object, Object&gt;</code>, or <code>StringRedisTemplate</code>.</p>
<h4 id="Using-your-Redis-Templates"><a href="#Using-your-Redis-Templates" class="headerlink" title="Using your Redis Templates"></a>Using your Redis Templates</h4><p>There are two templates injected into your container:</p>
<ul>
<li><code>RedisTemplate&lt;Object, Object&gt;</code><ul>
<li>This is used mainly when you need to write <strong>commands operating with Java objects</strong></li>
</ul>
</li>
<li><code>StringRedisTemplate</code><ul>
<li>This is used mainly when you just need to write <strong>simple string commands</strong></li>
</ul>
</li>
</ul>
<p>Similar to <code>JDBCTemplate</code>, you just need to <code>Autowire</code> either or both of the templates. For example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">RedisTemplate&lt;Object, Object&gt; redisTemplate;</span><br></pre></td></tr></table></figure>

<p>In general, <code>StringRedisTemplate</code> would be simpler to use. To operate with the data structures in Redis with <code>StringRedisTemplate</code>, all you need to do is to call the method <code>opsForXXX()</code>:</p>
<table>
<thead>
<tr>
<th>Method Name</th>
<th>Redis Operation</th>
</tr>
</thead>
<tbody><tr>
<td><code>opsForValue()</code></td>
<td>Operations with <code>String</code> in Redis</td>
</tr>
<tr>
<td><code>opsForSet()</code></td>
<td>Operations with <code>Set</code> in Redis</td>
</tr>
<tr>
<td><code>opsForList()</code></td>
<td>Operations with <code>List</code> in Redis</td>
</tr>
<tr>
<td><code>opsForHash()</code></td>
<td>Operations with <code>Hash</code> in Redis</td>
</tr>
<tr>
<td><code>opsForZSet()</code></td>
<td>Operations with <code>Zset</code> in Redis</td>
</tr>
</tbody></table>
<p>For example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">RedisTemplate&lt;Object, Object&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// gets the key-value pair where key="msg"</span></span><br><span class="line">    System.out.println(stringRedisTemplate.opsForValue().get(<span class="string">"msg"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Introduction-to-Distributed-Computing"><a href="#Introduction-to-Distributed-Computing" class="headerlink" title="Introduction to Distributed Computing"></a>Introduction to Distributed Computing</h2><p>In the manual above, we were using the MVC (Model-View-Controller) architecture. This works fine, but problem occurs when <strong>request to a certain service increases</strong>, which would cause heavy server load and hence performance issues. Therefore, distributed model has been promoted when needs for a service are high.</p>
<p><img src="https://imgs.developpaper.com/imgs/2266318593-22ea4454ae5d1cfc_articlex.png" alt="https://imgs.developpaper.com/imgs/2266318593-22ea4454ae5d1cfc_articlex.png" title="distributed computing model"></p>
<h3 id="Basic-Mechanism"><a href="#Basic-Mechanism" class="headerlink" title="Basic Mechanism"></a>Basic Mechanism</h3><p>The central question for distributed computing is: how can a client/remote server <strong>access services from other remote servers</strong>? The simplest model involves using a <strong>registry</strong> - a place where <strong>all the information of all the provided services is kept</strong>.</p>
<p>So in general, the mechanism is:</p>
<ol>
<li>A provider provides its services/implementations to a registry</li>
<li>A client subscribes and retrieves a list of available services</li>
<li>A client uses the service by telling registry to invoke/call methods from the provider</li>
</ol>
<p><img src="https://www.baeldung.com/wp-content/uploads/2017/12/dubbo-architecture-1024x639.png" alt="https://www.baeldung.com/wp-content/uploads/2017/12/dubbo-architecture-1024x639.png" title="Mechanism of Distributed Computing">“</p>
<p>(<em>Dubbo</em> is the tool for providing all those RPC - <strong>remote procedure call</strong> - mechanism, while <em>ZooKeeper</em> could be the registry)</p>
<h3 id="Using-Spring-Cloud-for-Distributed-Computing"><a href="#Using-Spring-Cloud-for-Distributed-Computing" class="headerlink" title="Using Spring Cloud for Distributed Computing"></a>Using Spring Cloud for Distributed Computing</h3><p>While you could use <code>Dubbo</code> and <code>ZooKeeper</code> to establish a distributed computing system for your application, <strong>Spring Cloud also provides a well-rounded solution for distributing services</strong>.</p>
<p>In summary, to setup the simple system mentioned above, you would need to:</p>
<ol>
<li>Create a <strong>Eureka Server/Registry</strong><ol>
<li>Include necessary dependencies (see below)</li>
<li>Configure <em>Eureka</em> server settings in <code>application.yml</code></li>
<li>Use <code>@EnableEurekaServer</code> and start the application to start the server/registry</li>
</ol>
</li>
<li>Create a <strong>Service Provider</strong><ol>
<li>Include necessary dependencies (see below)</li>
<li>Configure <em>Eureka</em> server settings in <code>application.yml</code> for connection</li>
<li>Create (a) <code>RestController(s)</code> to provide certain service(s)</li>
<li>This would look like a normal Spring Web application, except for the second step</li>
</ol>
</li>
<li>Create a <strong>Consumer/User</strong><ol>
<li>Also need to include Spring Cloud related dependencies (see below)</li>
<li>Configure <em>Eureka</em> server settings in <code>application.yml</code> for connection</li>
<li>Use <code>@EnableDiscoveryClient</code> annotation to make registered services available</li>
<li>Inject a bean <code>RestTemplate</code> which would be able to invoke service calls and pass its result to us</li>
<li>Create a controller (or anything) to use that <code>RestTemplate</code></li>
</ol>
</li>
</ol>
<h4 id="Example-Starting-a-Eureka-Server-Registry"><a href="#Example-Starting-a-Eureka-Server-Registry" class="headerlink" title="Example: Starting a Eureka Server/Registry"></a>Example: Starting a Eureka Server/Registry</h4><p>First, the necessary dependencies include:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-cloud.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Then, your configuration for your <em>Eureka</em> server could be:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8765</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">eureka-server</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span> <span class="comment"># does not register the server itself into the eureka registry</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span> <span class="comment"># does not fetch service registration from eureka registry</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:8765/eureka/</span>  <span class="comment"># address of eureka registry</span></span><br></pre></td></tr></table></figure>

<p>Finally, to start your <em>Eureka</em> server, you would use the annotation <code>@EnableEurekaServer</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.testeurekaserver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Registry</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@EnableEurekaServer</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestEurekaServerApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(TestEurekaServerApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now, if you visit <code>localhost:8765</code>, you will see the page for viewing current <em>Eureka</em> server’s status.</p>
<h4 id="Example-Registering-Services-to-Eureka-Server"><a href="#Example-Registering-Services-to-Eureka-Server" class="headerlink" title="Example: Registering Services to Eureka Server"></a>Example: Registering Services to Eureka Server</h4><p>First, you would need the following dependencies:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-cloud.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Then, your <code>application.yml</code> would look like this:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8001</span>  <span class="comment"># this now becomes useful with the below combination</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">provider-ticket</span>	<span class="comment"># this name will the the service name registered in Eureka Server</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span>  <span class="comment"># use service's IP to register as a service</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:8765/eureka/</span>  <span class="comment"># address of eureka registry</span></span><br></pre></td></tr></table></figure>

<p>By setting <code>eureka.instance.prefer-ip-address=true</code>, it enables us to easily register the same service over several machines. This will be shown slightly later.</p>
<p>Now, you can create some simple service. For example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.testproviderticket.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TicketServiceImpl</span> <span class="keyword">implements</span> <span class="title">TicketService</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTicket</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Ticket given"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>And a <strong>controller</strong> for that service (Eureka uses HTTP for data transport):</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.testproviderticket.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.testproviderticket.service.TicketService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TicketController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowire</span></span><br><span class="line">    TicketService ticketService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/ticket"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTicket</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ticketService.getTicket();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now, if you run <code>localhost:8001/ticket</code>, you will see the normal result as if it is a simple Spring Web Application. However, if you now look at <code>localhost:8765</code> (the address for <em>Eureka</em> registry), you will see the newly registered service.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled="" type="checkbox"> To register/use services in <em>Eureka</em> Server, you need to <strong>make sure that the server is running</strong>.</li>
</ul>
</blockquote>
<p>Lastly, if you want to <strong>register the same service for multiple times</strong>, you can simply change the <code>server.port</code> to a different number, package the service application you created in this example as a <code>jar</code>, and run it. Now, if you go to <em>Eureka</em> server, you will see that the same service will now be provided in multiple ports! (This means you could <strong>easily deploy and register a service on multiple remotes</strong>).</p>
<h4 id="Example-Creating-a-Consumer-User-for-Using-Registered-Services"><a href="#Example-Creating-a-Consumer-User-for-Using-Registered-Services" class="headerlink" title="Example: Creating a Consumer/User for Using Registered Services"></a>Example: Creating a Consumer/User for Using Registered Services</h4><p>First, you need to include dependencies such as:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-cloud.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Then, your <em>Eureka</em> server configuration would look like:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8010</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">consumer-user</span>  <span class="comment"># this name will also be displayed at the same place as registered services on Eureka registry</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span>  <span class="comment"># use service's IP to register as a service</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:8765/eureka/</span>  <span class="comment"># address of eureka registry</span></span><br></pre></td></tr></table></figure>

<p>Now, in order to discover and use services there, you need to have:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.testconsumeruser;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Consumer</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span> <span class="comment">// enable the functionality of discovering services in Eureka</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestConsumerUserApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(TestConsumerUserApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// This is used to get/use services from Eureka Server </span></span><br><span class="line">    <span class="meta">@LoadBalanced</span>   <span class="comment">// enable Load Balancing</span></span><br><span class="line">    <span class="meta">@Bean</span>   <span class="comment">// inject this into the application</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">restTemplate</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Lastly, to use registered services, you just need to have a controller (for example) using that <code>RestTemplate</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.testconsumeruser.controller;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowire</span></span><br><span class="line">    RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/buy"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buyTicket</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">        <span class="comment">// http:&lt;Provider-Application-Name&gt;/&lt;Specific-Service-Request&gt;</span></span><br><span class="line">        <span class="comment">// convert it to String.class</span></span><br><span class="line">        String serviceResult = restTemplate.getForObject(<span class="string">"http://PROVIDER_TICKET/ticket"</span>, String<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="keyword">return</span> name+serviceResult;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now, if you go to <code>localhost:8010/buy?name=test</code>, you will see that everything works that it invokes services/methods from other applications registered on <em>Eureka</em> server.</p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/learning/2020/06/15/Go-Manual/" rel="prev" title="Go Manual">
      <i class="fa fa-chevron-left"></i> Go Manual
    </a></div>
      <div class="post-nav-item">
    <a href="/learning/2020/07/13/Angular-Manual/" rel="next" title="Angular Manual">
      Angular Manual <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



        </div>
        

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Xiao Yu</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/learning/lib/anime.min.js"></script>
  <script src="/learning/lib/velocity/velocity.min.js"></script>
  <script src="/learning/lib/velocity/velocity.ui.min.js"></script>

<script src="/learning/js/utils.js"></script>

<script src="/learning/js/motion.js"></script>


<script src="/learning/js/next-boot.js"></script>


  















  

  

</body>
</html>
