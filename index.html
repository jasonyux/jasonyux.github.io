<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>From a Beginner to a Disaster</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="From a Beginner to a Disaster">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="From a Beginner to a Disaster">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Xiao Yu">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="From a Beginner to a Disaster" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">From a Beginner to a Disaster</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Xiao.Y</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Spring-Framework-Guide" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/06/09/Spring-Framework-Guide/" class="article-date">
  <time datetime="2020-06-09T07:25:30.000Z" itemprop="datePublished">2020-06-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/06/09/Spring-Framework-Guide/">Spring Framework Guide</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<p><strong>IMPORTANT</strong>:<br>Much of the content here is a personal summary/abbrieviation of contents on the <a href="https://docs.spring.io/spring/docs/5.3.0-SNAPSHOT/spring-framework-reference/index.html" target="_blank" rel="noopener">Offical Spring Framework Documentation</a>. For more complete information, please refer to the offical site.</p>
<hr>
<p>This is a <strong>Guide</strong>, since it is mostly <strong>conceptual</strong> and does not include much actual coding (except for examples illustrating those concepts). For more practical uses/examples, please refer to the <a href="https://jasonyux.github.io/2020/06/09/SpringBoot-Manual/" target="_blank" rel="noopener">Spring Boot Manual</a> or the <a href>Spring Cloud Manual</a>.</p>
<h2 id="Spring-Intro"><a href="#Spring-Intro" class="headerlink" title="Spring Intro"></a>Spring Intro</h2><p>The term “Spring” means different things in different contexts. It can be used to refer to the Spring Framework project itself, which is where it all started. Over time, other Spring projects have been built on top of the Spring Framework. Most often, when people say “Spring”, they mean the entire family of projects. This reference documentation focuses on the foundation: the Spring Framework itself.</p>
<p>When you learn about a framework, it’s important to know not only what it does but <strong>what principles it follows</strong>. Here are the guiding principles of the Spring Framework:</p>
<ul>
<li>Provide choice at every level. Spring lets you <strong>defer design decisions as late as possible</strong>. For example, you can switch persistence providers through configuration without changing your code. </li>
<li>Accommodate diverse perspectives. Spring embraces flexibility and is not opinionated about how things should be done. It <strong>supports a wide range of application needs with different perspectives</strong>.</li>
<li>Maintain strong backward compatibility. Spring’s evolution has been carefully managed to force <strong>few breaking changes between versions.</strong> Spring supports a carefully chosen range of JDK versions and third-party libraries to facilitate maintenance of applications and libraries that depend on Spring.</li>
<li>Care about API design. The Spring team puts a lot of thought and time into <strong>making APIs that are intuitive and that hold up across many versions and many years.</strong></li>
<li>Set high standards for code quality. The Spring Framework puts a strong emphasis on meaningful, current, and accurate javadoc. It is one of very few projects that can claim <strong>clean code structure with no circular dependencies between packages.</strong></li>
</ul>
<h2 id="IoC-Inversion-of-Control"><a href="#IoC-Inversion-of-Control" class="headerlink" title="IoC - Inversion of Control"></a>IoC - Inversion of Control</h2><p>IoC is also known as <strong>dependency injection (DI)</strong>. It is a process whereby <strong>objects define their dependencies</strong> (that is, the other objects they work with) <strong><em>only</em></strong> <strong>through constructor arguments</strong>, arguments to a factory method, or properties that are set on the object instance after it is constructed or returned from a factory method. The <strong>container then injects those dependencies when it creates the bean.</strong> This process is fundamentally the inverse (hence the name, Inversion of Control) of the bean itself controlling the instantiation or location of its dependencies by using direct construction of classes or a mechanism such as the Service Locator pattern.</p>
<p>In Spring, the <strong>objects that form the backbone of your application and that are managed by the Spring IoC container</strong> are called <strong>beans</strong>. A bean is an object that is instantiated, assembled, and otherwise managed by a Spring IoC container. Otherwise, a bean is simply one of many objects in your application. Beans, and the dependencies among them, are <strong>reflected in the configuration metadata used by a container.</strong></p>
<p>The <strong>main tasks performed by IoC container</strong> are:</p>
<ul>
<li>to instantiate the application class</li>
<li>to configure the object</li>
<li>to assemble the dependencies between the objects</li>
</ul>
<p>And there are <strong>two types of IoC containers</strong>. They are:</p>
<ul>
<li>BeanFactory (<code>org.springframework.beans</code>)</li>
<li>ApplicationContext (<code>org.springframework.context</code>)</li>
</ul>
<p>In short, the <code>BeanFactory</code> provides the <strong>configuration framework and basic functionality</strong>, and the <code>ApplicationContext</code> <strong>adds more enterprise-specific functionality</strong>. The <code>ApplicationContext</code> is a complete superset of the <code>BeanFactory</code> and is used exclusively in this chapter in descriptions of Spring’s IoC container. For more information on using the <code>BeanFactory</code> instead of the <code>ApplicationContext</code>, see <a href="https://docs.spring.io/spring/docs/5.3.0-SNAPSHOT/spring-framework-reference/core.html#beans-beanfactory" target="_blank" rel="noopener">The BeanFactory</a>.</p>
<h3 id="Java-Beans-vs-Spring-Beans-vs-POJOs"><a href="#Java-Beans-vs-Spring-Beans-vs-POJOs" class="headerlink" title="Java Beans vs Spring Beans vs POJOs"></a>Java Beans vs Spring Beans vs POJOs</h3><p>(additional reference: <a href="http://www.shaunabram.com/beans-vs-pojos/" target="_blank" rel="noopener">http://www.shaunabram.com/beans-vs-pojos/</a>)</p>
<ul>
<li><p>JavaBeans are classes that <strong>encapsulate many objects into a single object (the bean)</strong>. It is a java class that should <strong>follow following conventions</strong>:</p>
<ul>
<li><p>Must implement <code>Serializable.</code></p>
</li>
<li><p>It should have a public <code>no-arg</code> constructor.</p>
</li>
<li><p>All properties in java bean must be <code>private</code> with <code>public getters()</code> and <code>public setter()</code> methods.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestBean</span> </span>&#123; </span><br><span class="line">	<span class="keyword">private</span> String name; </span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span></span>&#123; </span><br><span class="line">	        <span class="keyword">this</span>.name = name; </span><br><span class="line">    &#125; </span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span>&#123; </span><br><span class="line">	        <span class="keyword">return</span> name; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>  <strong>setter methods</strong>:</p>
<ul>
<li>It should be <code>public</code> in nature.</li>
<li>The return-type should be <code>void</code>.</li>
<li>The setter method should be prefixed with <code>set</code>.</li>
<li>It should take some argument i.e. it should not be no-arg method.</li>
</ul>
<p>  <strong>getter methods</strong></p>
<ul>
<li>It should be <code>public</code> in nature.</li>
<li>The return-type should <strong>not be <code>void</code></strong> i.e. according to our requirement we have to give return-type.</li>
<li>The getter method should be prefixed with <code>get</code>.</li>
<li>It should not take any argument.</li>
</ul>
<p>  <strong>Boolean properties getter method</strong></p>
<ul>
<li>name can be prefixed with either “<code>get</code>” or “<code>is</code>”. But recommended to use “<code>is</code>”.</li>
<li>returns a <code>boolean</code></li>
</ul>
</li>
<li><p><strong>POJO is an acronym for Plain Old Java Object</strong>. The term was coined by <a href="http://www.martinfowler.com/bliki/POJO.html" target="_blank" rel="noopener">Martin Fowler et. al.</a>, as a ‘fancy’ way to describe ordinary Java Objects that do not require a framework to use, nor need to be run in a application server environment.</p>
</li>
<li><p><strong>A Spring bean is basically an object managed by Spring</strong>. More specifically, it is an object that is instantiated, configured and otherwise managed by a Spring Framework container. Spring beans are defined in a Spring configuration file (or, more recently, by using annotations), instantiated by the Spring container, and then injected into your application.</p>
<p>  Spring can manage just about any object, even if it doesn’t have JavaBean type characteristics such as default constructors or mutator methods (getters and setters).</p>
</li>
</ul>
<h3 id="IoC-Container-Overview"><a href="#IoC-Container-Overview" class="headerlink" title="IoC Container Overview"></a>IoC Container Overview</h3><p>The <code>org.springframework.context.ApplicationContext</code> interface represents the Spring IoC container and is responsible for <strong>instantiating, configuring, and assembling the beans</strong>. The container gets its instructions on <strong>what objects to instantiate, configure, and assemble by reading configuration metadata.</strong> </p>
<p>The <strong>configuration metadata</strong> is represented in XML, <strong>Java annotations</strong>, or Java code.</p>
<p>The following diagram shows a high-level view of how Spring works. Your application classes are combined with configuration metadata so that, after the ApplicationContext is created and initialized, you have a fully configured and executable system or application.</p>
<p><img src="/.com//06/09/Spring-Framework-Guide/SpringIoC.png" alt="Picture from https://docs.spring.io/spring/docs/5.3.0-SNAPSHOT/spring-framework-reference/core.html#beans" title="Picture from https://docs.spring.io/spring/docs/5.3.0-SNAPSHOT/spring-framework-reference/core.html#beans"></p>
<p>A Spring IoC container manages one or more beans. These beans are created with the configuration metadata that you supply to the container (e.g. via an XML file).</p>
<p>Within the container itself, <strong>these bean definitions are represented as <code>BeanDefinition</code> objects, which contain (among other information) the following metadata:</strong></p>
<ul>
<li>A package-qualified class name: typically, the <strong>actual implementation class of the bean</strong> being defined.</li>
<li>Bean behavioral configuration elements, which state how the bean should behave in the container (<code>scope</code>, <code>lifecycle callbacks</code>, and so forth).</li>
<li>References to other beans that are needed for the bean to do its work. These references are also called collaborators or <strong>dependencies</strong>.</li>
<li>Other configuration settings to set in the newly created object — for example, the size limit of the pool or the number of connections to use in a bean that manages a connection pool.</li>
</ul>
<p>This metadata <strong>translates to a set of properties that make up each bean definition</strong>. The following table describes these properties:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Explained in</th>
</tr>
</thead>
<tbody><tr>
<td>Class</td>
<td><a href="#Instantiating-Beans">Instantiating Beans</a></td>
</tr>
<tr>
<td>Name</td>
<td><a href="#Naming-Beans">Naming Beans</a></td>
</tr>
<tr>
<td>Scope</td>
<td><a href="#Bean-Scopes">Bean Scopes</a></td>
</tr>
<tr>
<td>Constructor arguments</td>
<td><a href="#Dependency-Injection">Dependency Injection</a></td>
</tr>
<tr>
<td>Properties</td>
<td><a href="#Dependency-Injection">Dependency Injection</a></td>
</tr>
<tr>
<td>Autowiring mode</td>
<td><a href="#Autowiring-Collaborators">Autowiring Collaborators</a></td>
</tr>
<tr>
<td>Lazy initialization mode</td>
<td><a href="#Lazy-initialized-Beans">Lazy-initialized Beans</a></td>
</tr>
<tr>
<td>Initialization method</td>
<td><a href="#Initialization-Callbacks">Initialization Callbacks</a></td>
</tr>
<tr>
<td>Destruction method</td>
<td><a href="#Destruction-Callbacks">Destruction Callbacks</a></td>
</tr>
</tbody></table>
<h3 id="Configuration-Metadata"><a href="#Configuration-Metadata" class="headerlink" title="Configuration Metadata"></a>Configuration Metadata</h3><p>As the preceding diagram shows, the <strong>Spring IoC container consumes a form of configuration metadata</strong>. This configuration metadata represents how you, as an application developer, <strong>tell the Spring container to instantiate, configure, and assemble the objects in your application</strong>.</p>
<p>Configuration metadata is can be supplied using one of the three forms:</p>
<ul>
<li>XML file</li>
<li>Java-based configuration</li>
<li>Annotation-based configuration</li>
</ul>
<p>(the following chapters only cover <strong>Java-based Configuration</strong>. If you prefer other means of configuration, please refer to the <a href="https://docs.spring.io/spring/docs/5.3.0-SNAPSHOT/spring-framework-reference/core.html#beans" target="_blank" rel="noopener">Offical Documentation</a> for more information.)</p>
<h3 id="Java-Based-Configuration"><a href="#Java-Based-Configuration" class="headerlink" title="Java Based Configuration"></a>Java Based Configuration</h3><p>The central artifacts in Spring’s new Java-configuration support are <strong><code>@Configuration</code>-annotated classes</strong> and <strong><code>@Bean</code>-annotated methods</strong>.</p>
<p>The <code>@Bean</code> annotation is used to indicate that <strong>a method instantiates, configures, and initializes a new object (type signature of the method) to be managed by the Spring IoC container</strong>. For those familiar with Spring’s <code>&lt;beans/&gt;</code> XML configuration, the <code>@Bean</code> annotation plays the same role as the <code>&lt;bean/&gt;</code> element. You can use <code>@Bean</code>-annotated methods with any Spring <code>@Component</code>. However, they are most often used with <code>@Configuration</code> beans.</p>
<p>Annotating a class with <code>@Configuration</code> indicates that <strong>its primary purpose is as a source of bean definitions</strong>. Furthermore, <code>@Configuration</code> classes let <strong>inter-bean dependencies be defined by calling other <code>@Bean</code> methods in the same class</strong>. The simplest possible <code>@Configuration</code> class reads as follows:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MyService <span class="title">myService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyServiceImpl();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Unlike full <code>@Configuration</code>, lite <code>@Bean</code> methods (declared within classes that are not annotated with @Configuration) <strong>cannot declare inter-bean dependencies</strong>. Instead, they operate on their containing component’s internal state and, optionally, on arguments that they may declare. Such a <code>@Bean</code> method should therefore not invoke other <code>@Bean</code> methods. <strong>Each such method is literally only a factory method for a particular bean reference, without any special runtime semantics</strong>.</li>
</ul>
</blockquote>
<p>The <code>@Bean</code> and <code>@Configuration</code> annotations are discussed in depth in the following sections. <strong>First, however, we need to cover the various ways of creating a spring container</strong> using by Java-based configuration.</p>
<h3 id="Instantiating-the-Spring-Container-Using-AnnotationConfigApplicationContext"><a href="#Instantiating-the-Spring-Container-Using-AnnotationConfigApplicationContext" class="headerlink" title="Instantiating the Spring Container Using AnnotationConfigApplicationContext"></a>Instantiating the Spring Container Using <code>AnnotationConfigApplicationContext</code></h3><p>When <code>@Configuration</code> classes are provided as input, <strong>the <code>@Configuration</code> class itself is registered as a bean definition and all declared <code>@Bean</code> methods within the class are also registered as bean definitions</strong>.</p>
<p>This means that instead of using XML files, you can use <code>@Configuration</code> classes as input when instantiating an <code>AnnotationConfigApplicationContext</code>. This allows for completely XML-free usage of the Spring container, as the following example shows:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    ApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext(AppConfig<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    MyService myService = ctx.getBean(MyService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    myService.doStuff();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>AnnotationConfigApplicationContext</code> is not limited to working only with <code>@Configuration</code> classes. <strong>Any <code>@Component</code> or JSR-330 annotated class may be supplied as input to the constructor</strong>, as the following example shows:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">    ApplicationContext ctx &#x3D; new AnnotationConfigApplicationContext(MyServiceImpl.class, Dependency1.class, Dependency2.class);</span><br><span class="line">    MyService myService &#x3D; ctx.getBean(MyService.class);</span><br><span class="line">    myService.doStuff();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The preceding example assumes that <code>MyServiceImpl</code>, <code>Dependency1</code>, and <code>Dependency2</code> <strong>use Spring dependency injection annotations such as <code>@Autowired</code></strong>.</p>
<h3 id="Building-the-Container-Programmatically-by-Using-register-Class-lt-gt-…​"><a href="#Building-the-Container-Programmatically-by-Using-register-Class-lt-gt-…​" class="headerlink" title="Building the Container Programmatically by Using register(Class&lt;?&gt;…​)"></a>Building the Container Programmatically by Using <code>register(Class&lt;?&gt;…​)</code></h3><p>One thing we see before for using <code>AnnotationConfigApplicationContext</code> is that the configurations need to be specified when you instantiate the <code>ApplicationContext</code>. However, sometimes you might need to programmatically add configurations later. This can be done by <strong>instantiate an <code>AnnotationConfigApplicationContext</code> by using a no-arg constructor and then configure it by using the <code>register()</code> method</strong>. This approach is particularly useful when programmatically building an <code>AnnotationConfigApplicationContext</code>. The following example shows how to do so:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    AnnotationConfigApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext();</span><br><span class="line">    ctx.register(AppConfig<span class="class">.<span class="keyword">class</span>, <span class="title">OtherConfig</span>.<span class="title">class</span>)</span>;</span><br><span class="line">    ctx.register(AdditionalConfig<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    ctx.refresh();</span><br><span class="line">    MyService myService = ctx.getBean(MyService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    myService.doStuff();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Enabling-Component-Scanning-with-scan-String…​"><a href="#Enabling-Component-Scanning-with-scan-String…​" class="headerlink" title="Enabling Component Scanning with scan(String…​)"></a>Enabling Component Scanning with <code>scan(String…​)</code></h3><p>To enable component scanning, you can <strong>annotate your <code>@Configuration</code> class</strong> as follows:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages = <span class="string">"com.acme"</span>)  <span class="comment">// this enables component scanning</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span>  </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In the preceding example, the <strong><code>com.acme</code> package is scanned to look for any <code>@Component</code>-annotated classes</strong>, and those classes are registered as Spring bean definitions within the container. </p>
<p>Additionally, <strong>you can use the <code>AnnotationConfigApplicationContext</code> object with the <code>scan(String…​)</code> method</strong> to allow for the same component-scanning functionality, as the following example shows:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    AnnotationConfigApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext();</span><br><span class="line">    ctx.scan(<span class="string">"com.acme"</span>);</span><br><span class="line">    ctx.refresh();</span><br><span class="line">    MyService myService = ctx.getBean(MyService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>In the preceding example, <strong>assuming that <code>AppConfig</code> is declared within the <code>com.acme</code> package (or any package underneath)</strong>. The above works <strong>since <code>@Configuration</code> classes are meta-annotated</strong> with <code>@Component</code>, so they are <strong>candidates for component-scanning as well</strong>. Then the <strong><code>AppConfig</code> along with its components is picked up during the call to <code>scan()</code></strong>. Upon <code>refresh()</code>, all its <code>@Bean</code> methods are processed and registered as bean definitions within the container.</p>
<h3 id="Using-the-Bean-Annotation"><a href="#Using-the-Bean-Annotation" class="headerlink" title="Using the @Bean Annotation"></a>Using the <code>@Bean</code> Annotation</h3><p>You can use the <code>@Bean</code> annotation in a <code>@Configuration</code>-annotated or in a <code>@Component</code>-annotated class.</p>
<p>To declare a bean, you can annotate <strong>a method with the <code>@Bean</code> annotation</strong>. You use this method to register a bean definition within an <code>ApplicationContext</code> of the type specified as the method’s return value. <strong>By default, the bean name is the same as the method name.</strong> The following example shows a <code>@Bean</code> method declaration:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TransferServiceImpl <span class="title">transferService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> TransferServiceImpl();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The preceding configuration is exactly equivalent to the following Spring XML:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;beans&gt;</span><br><span class="line">    &lt;bean id&#x3D;&quot;transferService&quot; class&#x3D;&quot;com.acme.TransferServiceImpl&quot;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;beans&gt;</span><br></pre></td></tr></table></figure>

<p>Both would make a <strong>bean (method for getting an Object) named <code>transferService</code> available in the <code>ApplicationContext</code></strong>, bound to an <strong>object instance of type <code>TransferServiceImpl</code></strong>, as the following text image shows:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transferService -&gt; com.acme.TransferServiceImpl</span><br></pre></td></tr></table></figure>

<p>You can also <strong>declare your <code>@Bean</code> method with an interface</strong> (or base class) return type, as the following example shows:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TransferService <span class="title">transferService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> TransferServiceImpl();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>However, this <strong>limits the visibility for advance type prediction</strong> to the specified interface type (<code>TransferService</code>), such that the full type (<code>TransferServiceImpl</code>) is known to the container only once.</p>
<h3 id="Determining-a-Bean’s-Runtime-Type"><a href="#Determining-a-Bean’s-Runtime-Type" class="headerlink" title="Determining a Bean’s Runtime Type"></a>Determining a Bean’s Runtime Type</h3><p>The runtime type of a specific bean is non-trivial to determine. A specified class in the bean metadata definition is just an initial class reference, potentially combined with a declared factory method or being a FactoryBean class which <strong>may lead to a different runtime type of the bean</strong>, or not being set at all in case of an instance-level factory method (which is resolved via the specified factory-bean name instead).</p>
<p>The recommended way to find out about the actual runtime type of a particular bean is <strong>a <code>BeanFactory.getType</code> call for the specified bean name</strong>. This takes all of the above cases into account and returns the type of object that a BeanFactory.getBean call is going to return for the same bean name.</p>
<h3 id="Bean-Dependencies"><a href="#Bean-Dependencies" class="headerlink" title="Bean Dependencies"></a>Bean Dependencies</h3><p><strong>A <code>@Bean</code>-annotated method can have an arbitrary number of parameters that describe the dependencies</strong> required to build that bean. For instance, if our <code>TransferService</code> requires an <code>AccountRepository</code>, we can <strong>materialize that dependency with a method parameter</strong>, as the following example shows:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TransferService <span class="title">transferService</span><span class="params">(AccountRepository accountRepository)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> TransferServiceImpl(accountRepository);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The resolution mechanism is pretty much identical to <code>constructor-based dependency injection</code>. See below sections for more details.</p>
<h3 id="Dependency-Injection"><a href="#Dependency-Injection" class="headerlink" title="Dependency Injection"></a>Dependency Injection</h3><p><strong>Dependency injection (DI) is a process whereby objects define their dependencies</strong> (that is, the other objects with which they work) <strong><em>only</em> through</strong> constructor arguments, arguments to a factory method, or properties that are set on the object instance after it is constructed or returned from a factory method.</p>
<p>The <strong>container then injects those dependencies when it creates the bean</strong>.</p>
<p>Code is cleaner with the DI principle, and decoupling is more effective when objects are provided with their dependencies. The object does not look up its dependencies and does not know the location or class of the dependencies. As a result, your classes become easier to test, particularly when the dependencies are on interfaces or abstract base classes, which allow for stub or mock implementations to be used in unit tests.</p>
<p>DI exists in two major variants: </p>
<ul>
<li><strong>Constructor-based dependency injection</strong></li>
<li><strong>Setter-based dependency injection</strong></li>
</ul>
<h3 id="Constructor-based-dependency-injection"><a href="#Constructor-based-dependency-injection" class="headerlink" title="Constructor-based dependency injection"></a>Constructor-based dependency injection</h3><p>(additional reference: <a href="https://www.tutorialspoint.com/spring/constructor_based_dependency_injection.htm" target="_blank" rel="noopener">https://www.tutorialspoint.com/spring/constructor_based_dependency_injection.htm</a>)</p>
<p>Constructor-based DI is accomplished when the container invokes a <strong>class constructor with a number of arguments, each representing a dependency on the other class</strong>.</p>
<p>Consider you have an application which has a text editor component and you want to provide a spell check. Your standard code would look something like this:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TextEditor</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> SpellChecker spellChecker;</span><br><span class="line">   </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">TextEditor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      spellChecker = <span class="keyword">new</span> SpellChecker();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>What we’ve done here is, create a dependency between the TextEditor and the SpellChecker.** In an inversion of control scenario, we would instead do something like this:**</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TextEditor</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> SpellChecker spellChecker;</span><br><span class="line">   </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">TextEditor</span><span class="params">(SpellChecker spellChecker)</span> </span>&#123;  <span class="comment">// Constructor based DI</span></span><br><span class="line">      <span class="keyword">this</span>.spellChecker = spellChecker;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Here, the <code>TextEditor</code> should not worry about <code>SpellChecker</code> implementation. <strong>The <code>SpellChecker</code> will be implemented independently and will be provided to the <code>TextEditor</code> at the time of <code>TextEditor</code> instantiation</strong>. This entire procedure is controlled by the Spring Framework.</p>
<h3 id="Constructor-Arguments-Resolution"><a href="#Constructor-Arguments-Resolution" class="headerlink" title="Constructor Arguments Resolution"></a>Constructor Arguments Resolution</h3><p>There may be an ambiguity while passing arguments to the constructor,** in case there are more than one parameters**. To resolve this ambiguity, the order in which the constructor arguments are defined in a bean definition is the order in which those arguments are supplied to the appropriate constructor. Consider the following class:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> x.y;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Foo</span><span class="params">(Bar bar, Baz baz)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The following configuration works fine:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Foo <span class="title">foo</span><span class="params">(Bar bar, Baz baz)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Foo(bar, baz)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Let us check one more case where we pass different types to the constructor, and we want to specify a specific value for them. Consider the following class:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> x.y;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Foo</span><span class="params">(<span class="keyword">int</span> year, String name)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The container can also use type matching with simple types, if you explicitly specify the type of the constructor argument using the type attribute. For example −</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Foo <span class="title">foo</span><span class="params">(<span class="keyword">int</span> year, String name)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Foo(<span class="number">2001</span>,<span class="string">"Zara"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>If you are using XML</strong>, then the best way to pass constructor arguments is to <strong>use the index attribute to specify explicitly the index of constructor arguments. Here, the index is 0 based.</strong> For example:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span> = <span class="string">"foo"</span> <span class="attr">class</span> = <span class="string">"x.y.Foo"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span> = <span class="string">"0"</span> <span class="attr">value</span> = <span class="string">"2001"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span> = <span class="string">"1"</span> <span class="attr">value</span> = <span class="string">"Zara"</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>A final note, in case you are passing a reference to an object as an argument, you need to use ref attribute of <code>&lt;constructor-arg&gt;</code> tag in the XML, and if you are passing a <code>value</code> directly then you should use value attribute as shown above.</p>
<h3 id="Setter-based-Dependency-Injection"><a href="#Setter-based-Dependency-Injection" class="headerlink" title="Setter-based Dependency Injection"></a>Setter-based Dependency Injection</h3><p>Setter-based DI is accomplished by the <strong>container calling <code>setter</code> methods on your beans after invoking a no-argument constructor or a no-argument static factory method</strong> to instantiate your bean.</p>
<p>For example:</p>
<p>(referece: <a href="https://www.tutorialspoint.com/spring/setter_based_dependency_injection.htm" target="_blank" rel="noopener">https://www.tutorialspoint.com/spring/setter_based_dependency_injection.htm</a>)</p>
<p>the content of <code>TextEditor.java</code> file:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TextEditor</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> SpellChecker spellChecker;</span><br><span class="line">   </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">TextEditor</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// a setter method to inject the dependency.</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSpellChecker</span><span class="params">(SpellChecker spellChecker)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.spellChecker = spellChecker;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// a getter method to return spellChecker</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> SpellChecker <span class="title">getSpellChecker</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> spellChecker;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">spellCheck</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      spellChecker.checkSpelling();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Here you need to check the <strong>naming convention of the setter methods</strong>. To set an object <code>SpellChecker</code> we are using <code>setSpellChecker()</code> method which is very similar to Java POJO classes. Then the content of another dependent class file <code>SpellChecker.java</code> could be:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpellChecker</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">SpellChecker</span><span class="params">()</span></span>&#123;</span><br><span class="line">      System.out.println(<span class="string">"Inside SpellChecker constructor."</span> );</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkSpelling</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">"Inside checkSpelling."</span> );</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Finally, the configuration would look like:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> TextEditor <span class="title">textEditor</span><span class="params">(SpellChecker spellChecker)</span></span>&#123;</span><br><span class="line">		TextEditor textEditor = <span class="keyword">new</span> TextEditor();</span><br><span class="line">		textEditor.setSpellChecker(spellChecker);</span><br><span class="line">		<span class="keyword">return</span> textEditor;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> SpellChecker <span class="title">spellChecker</span><span class="params">()</span></span>&#123;  <span class="comment">// this is necessary as the above Bean uses the Bean SpellChecker</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SpellChecker();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Finally, just to finish the example, you would have your main class (called <code>Example</code> here):</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.mySpringProject.app.testIoC.AppConfig;</span><br><span class="line"><span class="keyword">import</span> com.mySpringProject.app.testIoC.TextEditor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.AnnotationConfigApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Example</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext(AppConfig<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        TextEditor txtedr = ctx.getBean(TextEditor<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        txtedr.spellCheck();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>You will see that the container <strong>managed the construction of objects/dependencies for us</strong>, so that <code>SpellChecker</code> is first created, and then passed into the <code>TextEditor</code> object. Lastly, you would be able to call the method <code>spellCheck()</code>.</p>
<h3 id="Constructor-based-or-Setter-based-DI"><a href="#Constructor-based-or-Setter-based-DI" class="headerlink" title="Constructor-based or Setter-based DI"></a>Constructor-based or Setter-based DI</h3><p>Since <strong>you can mix constructor-based and setter-based DI</strong>, it is a good rule of thumb to use <strong>constructors for mandatory dependencies and setter methods or configuration methods for optional dependencies</strong>. Note that use of the <code>@Required</code> annotation on a setter method can be used to make the property be a required dependency; however, constructor injection with programmatic validation of arguments is preferable.</p>
<p>Using only constructor injection, lets you implement application components as <strong>immutable objects and ensures that required dependencies are not null</strong>. Furthermore, constructor-injected components are always returned to the client (calling) code in a fully initialized state.</p>
<p><strong>Setter injection should primarily only be used for optional dependencies</strong> that can be assigned reasonable default values within the class. Otherwise, not-null checks must be performed everywhere the code uses the dependency.</p>
<h3 id="Lazy-initialized-Beans"><a href="#Lazy-initialized-Beans" class="headerlink" title="Lazy-initialized Beans"></a>Lazy-initialized Beans</h3><p>By default, <strong><code>ApplicationContext</code> implementations eagerly create and configure all singleton beans as part of the initialization process.</strong> Generally, this pre-instantiation is desirable, because errors in the configuration or surrounding environment are discovered immediately, as opposed to hours or even days later. When this behavior is not desirable, you can <strong>prevent pre-instantiation of a singleton bean by marking the bean definition as being lazy-initialized</strong>.** A lazy-initialized bean tells the IoC container to create a bean instance when it is first requested, rather than at startup**.</p>
<p>To achieve this in a Java-annotation based configuration, you add the <code>@Lazy</code> to the configuration class. This will make all <code>@Bean</code> bean methods to become lazily initialized:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Lazy;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Lazy</span>  <span class="comment">// all beans inside this class will be lazily initialized</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TextEditor <span class="title">textEditor</span><span class="params">(SpellChecker spellChecker)</span></span>&#123;</span><br><span class="line">        TextEditor textEditor = <span class="keyword">new</span> TextEditor();</span><br><span class="line">        textEditor.setSpellChecker(spellChecker);</span><br><span class="line">        <span class="keyword">return</span> textEditor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SpellChecker <span class="title">spellChecker</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SpellChecker();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>If you only want to lazily initialize a speicific bean, then add <code>@Lazy(true)</code> or <code>@Lazy()</code> above that bean:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Lazy;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Lazy</span>()  <span class="comment">// this will be lazily initialized</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TextEditor <span class="title">textEditor</span><span class="params">(SpellChecker spellChecker)</span></span>&#123;</span><br><span class="line">        TextEditor textEditor = <span class="keyword">new</span> TextEditor();</span><br><span class="line">        textEditor.setSpellChecker(spellChecker);</span><br><span class="line">        <span class="keyword">return</span> textEditor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SpellChecker <span class="title">spellChecker</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SpellChecker();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Component-Scanning"><a href="#Component-Scanning" class="headerlink" title="Component Scanning"></a>Component Scanning</h3><p>(additional reference: <a href="https://www.baeldung.com/spring-bean-annotations" target="_blank" rel="noopener">https://www.baeldung.com/spring-bean-annotations</a>)</p>
<p>Spring can automatically <strong>scan a package for beans if component scanning is enabled.</strong></p>
<p><code>@ComponentScan</code> <strong>configures which packages to scan for classes with annotation configuration</strong>. We can specify the base package names directly with one of the <code>basePackages</code> or <code>value</code> arguments (<code>value</code> is an alias for <code>basePackages</code>):</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages = <span class="string">"com.baeldung.annotations"</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VehicleFactoryConfig</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>Also, we can <strong>point to classes directly</strong> in the base packages with the <code>basePackageClasses</code> argument:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackageClasses = VehicleFactoryConfig<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">VehicleFactoryConfig</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>Alternatively, we can use** <code>@ComponentScans</code> to specify multiple <code>@ComponentScan</code> configurations**:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScans</span>(&#123;  <span class="comment">// notice this is ComponentScans, not ComponentScan</span></span><br><span class="line">  <span class="meta">@ComponentScan</span>(basePackages = <span class="string">"com.baeldung.annotations"</span>), </span><br><span class="line">  <span class="meta">@ComponentScan</span>(basePackageClasses = VehicleFactoryConfig<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">&#125;)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">VehicleFactoryConfig</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Using-Component-Annotation"><a href="#Using-Component-Annotation" class="headerlink" title="Using @Component Annotation"></a>Using <code>@Component</code> Annotation</h3><p><code>@Component</code> is a class level annotation. <strong>During the component scan, Spring Framework automatically detects classes annotated with <code>@Component</code></strong>.</p>
<p>For example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CarUtility</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>By default, the bean instances of this class have the same name as the class name with a lowercase initial. On top of that, we can specify a different name using the optional value argument of this annotation.</p>
<p>Since <code>@Repository</code>,<code>@Service</code>, <code>@Configuration</code>, and <code>@Controller</code> are all meta-annotations of <code>@Component</code>, they share the same bean naming behavior. Also, <strong>Spring automatically picks them up during the component scanning process</strong>.</p>
<p>For example, you can have an <code>@Component</code> with:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span> <span class="comment">// or @Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Config2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> WordDictionary <span class="title">wordDictionary</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> WordDictionary();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then in your main <code>@Configuration</code>, you have:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.context.annotation.*;</span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">@ComponentScans(</span><br><span class="line">        &#123;@ComponentScan(basePackageClasses&#x3D;Config2.class)&#125;  &#x2F;&#x2F; Scans that class for beans</span><br><span class="line">)</span><br><span class="line">public class AppConfig &#123;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public TextEditor textEditor(SpellChecker spellChecker)&#123;</span><br><span class="line">        TextEditor textEditor &#x3D; new TextEditor();</span><br><span class="line">        textEditor.setSpellChecker(spellChecker);</span><br><span class="line">        return textEditor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public SpellChecker spellChecker()&#123;</span><br><span class="line">        return new SpellChecker();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Finally, in your main class, you would be able to use <code>WordDictionary</code> class even if it was not specified in the <code>ApplicationContext</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.mySpringProject.app.testIoC.AppConfig;</span><br><span class="line"><span class="keyword">import</span> com.mySpringProject.app.testIoC.TextEditor;</span><br><span class="line"><span class="keyword">import</span> com.mySpringProject.app.testIoC.WordDictionary;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.AnnotationConfigApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Example</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext(AppConfig<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        TextEditor txtedr = ctx.getBean(TextEditor<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        WordDictionary dict = ctx.getBean(WordDictionary<span class="class">.<span class="keyword">class</span>)</span>;  <span class="comment">// not directly in AppConfig, but scanned</span></span><br><span class="line">        txtedr.spellCheck();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Using-Autowired-to-configure-your-beans-and-dependencies"><a href="#Using-Autowired-to-configure-your-beans-and-dependencies" class="headerlink" title="Using @Autowired to configure your beans and dependencies"></a>Using @Autowired to configure your beans and dependencies</h3><p>(additional reference: <a href="https://www.baeldung.com/spring-autowire" target="_blank" rel="noopener">https://www.baeldung.com/spring-autowire</a>)</p>
<p>Starting with Spring 2.5, the framework introduced a new style of Dependency Injection driven by <code>@Autowired</code> Annotations. This annotation allows Spring to <strong>automatically resolve and inject collaborating beans into your bean</strong>. It has the following adavantages:</p>
<ul>
<li><p>Autowiring can significantly <strong>reduce the need to specify properties or constructor arguments</strong>. (Other mechanisms such as a bean template discussed elsewhere in this chapter are also valuable in this regard.)</p>
</li>
<li><p>Autowiring can <strong>update a configuration as your objects evolve</strong>. For example, if you need to add a dependency to a class, that dependency can be satisfied automatically without you needing to modify the configuration. Thus autowiring can be especially useful during development, without negating the option of switching to explicit wiring when the code base becomes more stable.</p>
</li>
</ul>
<p>Once annotation injection is enabled, autowiring can be used on properties, setters, and constructors.</p>
<h3 id="Autowired-on-properties"><a href="#Autowired-on-properties" class="headerlink" title="@Autowired on properties"></a><code>@Autowired</code> on properties</h3><p>First, to enable annotation-driven injection, you need to be using <code>AnnotationConfigApplicationContext</code> to load your spring configuration as below:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Example</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext();  <span class="comment">// actually what we've been doing so far</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then, you can have the following <code>Component</code>s/classes:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mySpringProject.app.testIoC.AutowiredSamples;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FooforMatter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">message</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"foo"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>And importantly, this class:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mySpringProject.app.testIoC.AutowiredSamples;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FooService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> FooforMatter fooforMatter;  <span class="comment">// notice that this field is Autowired. </span></span><br><span class="line">									    <span class="comment">// It means that it will be automatically created and attached</span></span><br><span class="line">										<span class="comment">// to the FooService object</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FooforMatter <span class="title">getFooforMatter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fooforMatter;  <span class="comment">// so that we can use the message() method</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now, all you need to do in your <code>@Configuration</code> clas is to <strong>point it to the correctly component using the component scan</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(<span class="string">"com.mySpringProject.app.testIoC.AutowiredSamples"</span>)  <span class="comment">// the package where we had the @Components</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AutowiredConfig</span> </span>&#123;	<span class="comment">// no bean needs to be declared inside this configuration</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then, in the main application class, we can see the message by:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.mySpringProject.app.testIoC.AutowiredConfig;</span><br><span class="line"><span class="keyword">import</span> com.mySpringProject.app.testIoC.AutowiredSamples.FooService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.AnnotationConfigApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Example</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext(AutowiredConfig<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">        FooService fsrv = ctx.getBean(FooService<span class="class">.<span class="keyword">class</span>)</span>;  <span class="comment">// Autowired figured this out for us</span></span><br><span class="line">        System.out.println(fsrv.getFooforMatter().message());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Autowired-on-constructors"><a href="#Autowired-on-constructors" class="headerlink" title="@Autowired on constructors"></a><code>@Autowired</code> on constructors</h3><p>The @Autowired annotation can also be used on constructors. In the below example, when the annotation is used on a constructor, an instance of FooFormatter is injected as an argument to the constructor when FooService is created:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FooService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> FooFormatter fooFormatter;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FooService</span><span class="params">(FooFormatter fooFormatter)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fooFormatter = fooFormatter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now, an instance of <code>FooFormatter</code> is injected as an argument to the constructor when <code>FooService</code> is created.</p>
<p>This technically has the same effect as using <code>@Autowired</code> on a specific field, but it turns out that** using <code>@Autowired</code> on a constructor is always the better approach**. This is because:</p>
<ul>
<li>you can only <strong><code>@Autowired</code> one field at a time</strong>, but above <strong>a constructor, all arguments will be instantiated/autowired</strong>.</li>
<li>using <code>@Autowired</code> on a field is <strong>vulnerable for the problem of having a <code>NullPointerException</code></strong>. This is because if the autowired field is not correctly instantiated, the** main object that depends on it might still be created, but invoking methods of that private field will cause <code>NullPointerException</code><strong>. However, by **having the <code>@Autowired</code> for a constructor, it forces the main object to be created WITH an instantiation of that dependent object</strong>.</li>
</ul>
<h3 id="Optional-Dependencies-for-Autowired"><a href="#Optional-Dependencies-for-Autowired" class="headerlink" title="Optional Dependencies for @Autowired"></a>Optional Dependencies for <code>@Autowired</code></h3><p>(additional reference: <a href="https://www.baeldung.com/spring-autowire" target="_blank" rel="noopener">https://www.baeldung.com/spring-autowire</a>)</p>
<p>Spring expects <code>@Autowired</code> dependencies to be available when the dependent bean is being constructed. <strong>If the framework cannot resolve a bean for wiring</strong>, it will throw the below-quoted exception and prevent the Spring container from launching successfully:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Caused by: org.springframework.beans.factory.NoSuchBeanDefinitionException: </span><br><span class="line">No qualifying bean of type [com.autowire.sample.FooDAO] found for dependency: </span><br><span class="line">expected at least 1 bean which qualifies as autowire candidate for this dependency. </span><br><span class="line">Dependency annotations: </span><br><span class="line">&#123;@org.springframework.beans.factory.annotation.Autowired(required&#x3D;true)&#125;</span><br></pre></td></tr></table></figure>

<p>To avoid this from happening, <strong>a bean can optional be specified as below</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class FooService &#123;</span><br><span class="line"> </span><br><span class="line">    @Autowired(required &#x3D; false)</span><br><span class="line">    private FooDAO dataAccessor; </span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a name="Bean-Scopes"></a></p>
<h3 id="Bean-Scopes"><a href="#Bean-Scopes" class="headerlink" title="Bean Scopes"></a>Bean Scopes</h3><p>(additional reference: <a href="https://www.baeldung.com/spring-bean-scopes" target="_blank" rel="noopener">https://www.baeldung.com/spring-bean-scopes</a>)</p>
<p>When you create a bean definition, you create a recipe for creating actual instances of the class defined by that bean definition. The idea that a bean definition is a recipe is important, because it means that, as with a class, you can create many object instances from a single recipe.</p>
<p>In addition to all those configurations that you can specify to a bean, you can also specify its scope:** the scope of a bean defines the life cycle and visibility of that bean in the contexts in which it is used**.</p>
<p>The latest version of Spring framework defines 6 types of scopes:</p>
<ul>
<li><a href="#Singleton-Scope">singleton</a></li>
<li><a href="#Prototype-Scope">prototype</a></li>
<li><a href="#Request-Scope">request</a></li>
<li><a href="#Session-Scope">session</a></li>
<li><a href="#Application-Scope">application</a></li>
<li><a href="#Websocket-Scope">websocket</a></li>
</ul>
<p>The <strong>last four scopes listed above</strong> - <code>request</code>, <code>session</code>, <code>application</code> and <code>websocket</code> - are <strong>only available in a web-aware application</strong>.</p>
<p><a name="Singleton-Scope"></a></p>
<h4 id="Singleton-Scope"><a href="#Singleton-Scope" class="headerlink" title="Singleton Scope"></a>Singleton Scope</h4><p>Defining a bean with singleton scope <strong>means the container creates a single instance of that bean, and all requests for that bean name will return the same object, which is cached</strong>. Any modifications to the object will be reflected in all references to the bean. This scope is the default value if no other scope is specified.</p>
<p>For example, if you have a Person object that stores a name:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// standard constructor, getters and setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Afterwards, we define the bean with singleton scope by using the <code>@Scope</code> annotation:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Scope</span>(<span class="string">"singleton"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Person <span class="title">personSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Person();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now, if you use the <code>getBean(Person.class)</code> to create that object, you will <strong>only get one and the same instance of it no matter how many times you this method call</strong>. This also means that if you change the <code>name</code> field of one of the <code>Person</code> object you get, it will be changed for all <code>Person</code> objects that you got.</p>
<p><a name="Prototype-Scope"></a></p>
<h4 id="Prototype-Scope"><a href="#Prototype-Scope" class="headerlink" title="Prototype Scope"></a>Prototype Scope</h4><p>A bean with <code>prototype</code> scope will <strong>return a different instance every time it is requested from the container</strong>. It is defined by setting the value <code>prototype</code> to the <code>@Scope</code> annotation in the bean definition:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Scope</span>(<span class="string">"prototype"</span>)  <span class="comment">// everytime this bean is used, a new Person object will be created</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Person <span class="title">personPrototype</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Person();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now, if you make multiple calls of <code>getBean(Person.class)</code>, you will get multiple <code>Person</code> objects instantiated (as many as the number of times you called the method). This will not cause the problem that, if you change the name of one <code>Person</code> object, all <code>name</code>s of other <code>Person</code> objects will be changed.</p>
<p>As mentioned, there are four additional scopes that are only available in a web-aware application context. These are less often used in practice:</p>
<p><a name="Request-Scope"></a></p>
<h4 id="Request-Scope"><a href="#Request-Scope" class="headerlink" title="Request Scope"></a>Request Scope</h4><p>The request scope creates a bean instance for a <strong>single HTTP request</strong>.</p>
<p>We can define the bean with request scope using the <code>@Scope</code> annotation:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Scope</span>(value = WebApplicationContext.SCOPE_REQUEST, proxyMode = ScopedProxyMode.TARGET_CLASS)</span><br><span class="line"><span class="function"><span class="keyword">public</span> HelloMessageGenerator <span class="title">requestScopedBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> HelloMessageGenerator();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The <code>proxyMode</code> attribute is <strong>necessary here because</strong>, at the moment of the instantiation of the web application context, <strong>there is no active request</strong>. Spring will create a proxy to be injected as a dependency, and instantiate the target bean when it is needed in a request.</p>
<p>We can also use a <strong><code>@RequestScope</code> composed annotation that acts as a shortcut for the above definition</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@RequestScope</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> HelloMessageGenerator <span class="title">requestScopedBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> HelloMessageGenerator();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Next, we can define <strong>a <code>controller</code> that has an injected reference to the <code>requestScopedBean</code></strong>. We need to access the same request twice in order to test the web specific scopes.</p>
<p>If we display the message each time the request is run, we can see that the value is reset to null, even though it is later changed in the method. This is because of <strong>a different bean instance being returned for each request</strong>.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScopesController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span>(name = <span class="string">"requestScopedBean"</span>)</span><br><span class="line">    HelloMessageGenerator requestScopedBean;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/scopes/request"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getRequestScopeMessage</span><span class="params">(<span class="keyword">final</span> Model model)</span> </span>&#123;</span><br><span class="line">        model.addAttribute(<span class="string">"previousMessage"</span>, requestScopedBean.getMessage());</span><br><span class="line">        requestScopedBean.setMessage(<span class="string">"Good morning!"</span>);</span><br><span class="line">        model.addAttribute(<span class="string">"currentMessage"</span>, requestScopedBean.getMessage());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"scopesExample"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="Session-Scope"></a></p>
<h4 id="Session-Scope"><a href="#Session-Scope" class="headerlink" title="Session Scope"></a>Session Scope</h4><p>The session scope creates for <strong>an HTTP Session</strong>.</p>
<p>We can define the bean with session scope in a similar manner:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Scope</span>(value = WebApplicationContext.SCOPE_SESSION, proxyMode = ScopedProxyMode.TARGET_CLASS)</span><br><span class="line"><span class="function"><span class="keyword">public</span> HelloMessageGenerator <span class="title">sessionScopedBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> HelloMessageGenerator();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>There’s also a dedicated composed annotation we can use to simplify the bean definition:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@SessionScope</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> HelloMessageGenerator <span class="title">sessionScopedBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> HelloMessageGenerator();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Next, we define a controller with a reference to the <code>sessionScopedBean</code>. Again, we need to run two requests in order to show that the value of the message field is the same for the session.</p>
<p>In this case, when the request is made for the first time, the value message is null. But once, it is changed, then that value is retained for subsequent requests as the same instance of the bean is returned for the entire session.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScopesController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span>(name = <span class="string">"sessionScopedBean"</span>)</span><br><span class="line">    HelloMessageGenerator sessionScopedBean;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/scopes/session"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSessionScopeMessage</span><span class="params">(<span class="keyword">final</span> Model model)</span> </span>&#123;</span><br><span class="line">        model.addAttribute(<span class="string">"previousMessage"</span>, sessionScopedBean.getMessage());</span><br><span class="line">        sessionScopedBean.setMessage(<span class="string">"Good afternoon!"</span>);</span><br><span class="line">        model.addAttribute(<span class="string">"currentMessage"</span>, sessionScopedBean.getMessage());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"scopesExample"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="Application-Scope"></a></p>
<h4 id="Application-Scope"><a href="#Application-Scope" class="headerlink" title="Application Scope"></a>Application Scope</h4><p>The application scope creates the bean instance for the <strong>lifecycle of a ServletContext</strong>.</p>
<p>This is similar to the singleton scope but there is a very important difference with regards to the scope of the bean.</p>
<p>When beans are application scoped the same instance of the bean is shared across multiple servlet-based applications running in the same ServletContext, while singleton-scoped beans are scoped to a single application context only.</p>
<p>Let’s create the bean with application scope:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Scope</span>(</span><br><span class="line">  value = WebApplicationContext.SCOPE_APPLICATION, proxyMode = ScopedProxyMode.TARGET_CLASS)</span><br><span class="line"><span class="function"><span class="keyword">public</span> HelloMessageGenerator <span class="title">applicationScopedBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> HelloMessageGenerator();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Analogously as for the request and session scopes, we can use a shorter version:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ApplicationScope</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> HelloMessageGenerator <span class="title">applicationScopedBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> HelloMessageGenerator();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now, let’s create a controller that references this bean:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScopesController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span>(name = <span class="string">"applicationScopedBean"</span>)</span><br><span class="line">    HelloMessageGenerator applicationScopedBean;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/scopes/application"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getApplicationScopeMessage</span><span class="params">(<span class="keyword">final</span> Model model)</span> </span>&#123;</span><br><span class="line">        model.addAttribute(<span class="string">"previousMessage"</span>, applicationScopedBean.getMessage());</span><br><span class="line">        applicationScopedBean.setMessage(<span class="string">"Good afternoon!"</span>);</span><br><span class="line">        model.addAttribute(<span class="string">"currentMessage"</span>, applicationScopedBean.getMessage());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"scopesExample"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In this case, value message once set in the applicationScopedBean will be retained for all subsequent requests, sessions and even for a different servlet application that will access this bean, provided it is running in the same ServletContext.</p>
<p><a name="Websocket-Scope"></a></p>
<h4 id="Websocket-Scope"><a href="#Websocket-Scope" class="headerlink" title="Websocket Scope"></a>Websocket Scope</h4><p>The websocket scope creates it for a particular <strong>WebSocket session</strong>.</p>
<p>Finally, let’s create the bean with websocket scope:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">@Scope(scopeName &#x3D; &quot;websocket&quot;, proxyMode &#x3D; ScopedProxyMode.TARGET_CLASS)</span><br><span class="line">public HelloMessageGenerator websocketScopedBean() &#123;</span><br><span class="line">    return new HelloMessageGenerator();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>WebSocket-scoped beans when first accessed are stored in the WebSocket session attributes. The same instance of the bean is then returned whenever that bean is accessed during the entire WebSocket session.</p>
<p>We can also say that it exhibits singleton behavior but limited to a WebSocket session only.</p>
<h3 id="Specifying-Bean-Scope"><a href="#Specifying-Bean-Scope" class="headerlink" title="Specifying Bean Scope"></a>Specifying Bean Scope</h3><p>Spring includes the <code>@Scope</code> annotation so that you can specify the scope of a bean.</p>
<p>You can specify that your <strong>beans defined with the <code>@Bean</code> annotation should have a specific scope</strong>. You can use any of the standard scopes specified in the <a href="#Bean-Scopes">Bean Scopes</a> section above.</p>
<p>The default scope is singleton, but you can override this with the @Scope annotation, as the following example shows:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Scope</span>(<span class="string">"prototype"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Encryptor <span class="title">encryptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Method-Injection"><a href="#Method-Injection" class="headerlink" title="Method Injection"></a>Method Injection</h3><p>In most application scenarios, most beans in the container are singletons. When a singleton bean needs to collaborate with another singleton bean or a non-singleton bean needs to collaborate with another non-singleton bean, you typically handle the dependency by defining one bean as a property of the other. <strong>A problem arises when the bean lifecycles are different</strong>. Suppose <strong>singleton bean A needs to use non-singleton (prototype) bean B, perhaps on each method invocation on A</strong>. The container <strong>creates the singleton bean A only once, and thus only gets one opportunity to set the properties</strong>. The container cannot provide bean A with a new instance of bean B every time one is needed.</p>
<p>The solution is to use the <code>@Lookup</code>, namely, Method Injection.</p>
<h3 id="Using-Lookup-for-Method-Injection"><a href="#Using-Lookup-for-Method-Injection" class="headerlink" title="Using @Lookup for Method Injection"></a>Using @Lookup for Method Injection</h3><p><code>@Lookup</code> is a method annotated that tells <strong>Spring to return an instance of the method’s return type every time when we invoke it.</strong></p>
<p>First, let’s create a prototype bean that we will later inject into a singleton bean:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">package com.mySpringProject.app.testIoC.MethodInjectionSamples;</span><br><span class="line"></span><br><span class="line">import org.springframework.context.annotation.Scope;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">@Scope(&quot;prototype&quot;)  &#x2F;&#x2F; so that everytime a bean of this is created, you get a new SchoolNotification</span><br><span class="line">public class SchoolNotification &#123;</span><br><span class="line">    static int count &#x3D; 0;</span><br><span class="line"></span><br><span class="line">    public SchoolNotification()&#123;</span><br><span class="line">        System.out.println(&quot;Notification &quot;+(++count) +&quot; created&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>And if we create a singleton bean that uses <code>@Lookup</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">package com.mySpringProject.app.testIoC.MethodInjectionSamples;</span><br><span class="line"></span><br><span class="line">import org.springframework.beans.factory.annotation.Lookup;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">@Component	&#x2F;&#x2F; no @Scope specifed defaults it to a singleton</span><br><span class="line">public class StudentService &#123;</span><br><span class="line"></span><br><span class="line">    @Lookup  &#x2F;&#x2F; this will be overridden by the container, calling: beanFactory.getBean()(StudentNotification.class)</span><br><span class="line">    public SchoolNotification getSchoolNotification()&#123;  </span><br><span class="line">        return null;  &#x2F;&#x2F; therefore, whatever you have here doesn&#39;t really matter</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Using <code>@Lookup</code>, we can get an new instance of SchoolNotification through our singleton bean** everytime when the method <code>getSchoolNotification</code> is called** (assuming you have a <code>ScopeConfig</code> class with <code>@Configuration</code> and <code>ComponentScan</code> setup correctly):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">package com.mySpringProject.app;</span><br><span class="line"></span><br><span class="line">import com.mySpringProject.app.testIoC.*;</span><br><span class="line">import com.mySpringProject.app.testIoC.AutowiredSamples.FooService;</span><br><span class="line">import com.mySpringProject.app.testIoC.MethodInjectionSamples.StudentService;</span><br><span class="line">import org.springframework.context.ApplicationContext;</span><br><span class="line">import org.springframework.context.annotation.AnnotationConfigApplicationContext;</span><br><span class="line"></span><br><span class="line">public class Example &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        ApplicationContext ctx &#x3D; new AnnotationConfigApplicationContext(ScopeConfig.class);</span><br><span class="line">        </span><br><span class="line">        StudentService stdsrv1 &#x3D; ctx.getBean(StudentService.class);</span><br><span class="line">        StudentService stdsrv2 &#x3D; ctx.getBean(StudentService.class);</span><br><span class="line">        StudentService stdsrv3 &#x3D; ctx.getBean(StudentService.class);</span><br><span class="line">        StudentService stdsrv4 &#x3D; ctx.getBean(StudentService.class);</span><br><span class="line"></span><br><span class="line">        stdsrv1.getSchoolNotification();</span><br><span class="line">        stdsrv2.getSchoolNotification();</span><br><span class="line">        stdsrv3.getSchoolNotification();</span><br><span class="line">        stdsrv4.getSchoolNotification();</span><br><span class="line">        stdsrv1.getSchoolNotification();	&#x2F;&#x2F; you will see that the count monotonously increases</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Customizing-the-Nature-of-Bean"><a href="#Customizing-the-Nature-of-Bean" class="headerlink" title="Customizing the Nature of Bean"></a>Customizing the Nature of Bean</h3><p>The Spring Framework provides a number of interfaces you can use to customize the nature of a bean. This section groups them as follows:</p>
<ul>
<li>Lifecycle Callbacks</li>
<li><code>ApplicationContextAware</code> and <code>BeanNameAware</code></li>
<li>Other <code>Aware</code> Interfaces</li>
</ul>
<h4 id="Lifecycle-Callbacks"><a href="#Lifecycle-Callbacks" class="headerlink" title="Lifecycle Callbacks"></a>Lifecycle Callbacks</h4><p>(additional reference: <a href="https://www.tutorialspoint.com/spring/spring_bean_life_cycle.htm" target="_blank" rel="noopener">https://www.tutorialspoint.com/spring/spring_bean_life_cycle.htm</a>; <a href="https://www.baeldung.com/running-setup-logic-on-startup-in-spring" target="_blank" rel="noopener">https://www.baeldung.com/running-setup-logic-on-startup-in-spring</a>)</p>
<p>The life cycle of a Spring bean is easy to understand. When a bean is instantiated, it may be required to perform some initialization to get it into a usable state. Similarly, when the bean is no longer required and is removed from the container, some cleanup may be required.</p>
<p>The whole concept of lifecycle callbacks is to solve the problem of handling too much control to the container. For example, We can’t simply include our logic in the beans’ constructors or call methods after instantiation of any object; we are simply not in control during those processes:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InvalidInitExampleBean</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Environment env;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">InvalidInitExampleBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        env.getActiveProfiles();  <span class="comment">// this could get called before Spring bean is fully initialized</span></span><br><span class="line">			                      <span class="comment">// namely, before env gets initialized and attached</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Therefore, this is problematic because calling not yet initialized fields will of course <strong>result in <code>NullPointerExceptions</code></strong>.</p>
<h5 id="Initialization-Callbacks"><a href="#Initialization-Callbacks" class="headerlink" title="Initialization Callbacks"></a>Initialization Callbacks</h5><p>The <code>org.springframework.beans.factory.InitializingBean</code> interface lets a bean perform initialization work after the container has set all necessary properties on the bean. The <strong><code>InitializingBean</code> interface specifies a single method</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br></pre></td></tr></table></figure>

<p>However, it is <strong>not recommend that you use the <code>InitializingBean</code> interface, because it unnecessarily couples the code to Spring</strong>. Alternatively, we suggest using the <code>@PostConstruct</code> annotation or specifying a POJO initialization method.</p>
<p>The <code>@PostConstruct</code> annotation can be used for annotating** a method that should be run once immediately after the bean’s initialization**. Keep in mind that the annotated method will be executed by Spring even if there is nothing to inject.</p>
<p>Here’s <code>@PostConstruct</code> in action:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PostConstructExampleBean</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Environment environment;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@PostConstruct</span>  <span class="comment">// called immediately after successful initialization</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">betterApproach</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        env.getActiveProfiles();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>In the example above you can see that the Environment instance was <strong>safely injected and then called in the <code>@PostConstruct</code> annotated method without throwing a <code>NullPointerException</code></strong>.</p>
<h5 id="Destruction-Callbacks"><a href="#Destruction-Callbacks" class="headerlink" title="Destruction Callbacks"></a>Destruction Callbacks</h5><p>Implementing the <code>org.springframework.beans.factory.DisposableBean</code> interface lets a bean get a callback when the container that contains it is destroyed. The <strong><code>DisposableBean</code> interface specifies a single method</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br></pre></td></tr></table></figure>

<p>It is recommended that you <strong>do not use the <code>DisposableBean</code> callback interface</strong>, because it unnecessarily couples the code to Spring. Alternatively, we <strong>suggest using the <code>@PreDestroy</code> annotation</strong> or specifying a generic method that is supported by bean definitions.</p>
<p><strong>A method annotated with <code>@PreDestroy</code> runs only once, just before Spring removes our bean from the application context</strong>.</p>
<p>Same as with <code>@PostConstruct</code>, the methods annotated with <code>@PreDestroy</code> can have any access level but can’t be static.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserRepository</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> DbConnection dbConnection;</span><br><span class="line">    <span class="meta">@PreDestroy</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        dbConnection.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The <strong>purpose of this method should be to release resources or perform any other cleanup tasks before the bean gets destroyed</strong>, for example closing a database connection.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Note that both <code>@PostConstruct</code> and <code>@PreDestroy</code> annotations are part of Java EE. And since Java EE <strong>has been deprecated in Java 9 and removed in Java 11</strong> we have to add an additional dependency to use these annotations if you are using versions of Java beyond 11.</li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;javax.annotation&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;javax.annotation-api&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.3.2&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<h5 id="Default-initMethod-and-destroyMethod"><a href="#Default-initMethod-and-destroyMethod" class="headerlink" title="Default initMethod and destroyMethod"></a>Default <code>initMethod</code> and <code>destroyMethod</code></h5><p>When you write initialization and destroy method callbacks that do not use the Spring-specific <code>InitializingBean</code> and <code>DisposableBean</code> callback interfaces, you <strong>should</strong> typically write methods with names such as <code>init()</code>, <code>initialize()</code>, <code>dispose()</code>, and so on. Ideally, the names of such lifecycle callback methods are <strong>standardized across a project so that all developers use the same method names and ensure consistency</strong>.</p>
<p>More importantly, you can <strong>specify a default <code>initMethod</code> property or a <code>destroyMethod</code></strong> that can be used to always execute a method <strong>after a bean’s initialization/before destruction</strong>.</p>
<p>Here’s what a bean looks like:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InitMethodExampleBean</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Environment environment;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// do some initialization work;</span></span><br><span class="line">		<span class="comment">// notice no interface nor annotation is used here</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You can notice that there are <strong>no special interfaces implemented nor any special annotations used</strong>.</p>
<p>Then, we can <strong>define the bean using the <code>@Bean(intiMethod=&quot;&lt;initMethodName&gt;&quot;)</code> annotation</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span>(initMethod=<span class="string">"init"</span>)  <span class="comment">// the key step</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> InitMethodExampleBean <span class="title">exBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> InitMethodExampleBean();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>And this is will be equivalent to the XML config:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">default-init-method</span>=<span class="string">"init"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"initMethodExampleBean"</span> <span class="attr">class</span>=<span class="string">"com.something.InitMethodExampleBean"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The presence of the <code>initMethod=&quot;init&quot;</code> attribute on the top-level causes the <strong>Spring IoC container to recognize a method called <code>init</code> on the bean class as the initialization method callback</strong>. When a bean is created and assembled, if the bean class has such a method, it is invoked at the appropriate time.</p>
<p>You can configure destroy method callbacks similarly by using the <code>@Bean(destroyMethod=&quot;&lt;destroyMethoName&gt;&quot;)</code> attribute on the top-level.</p>
<h5 id="Combining-Lifecycle-Mechanisms"><a href="#Combining-Lifecycle-Mechanisms" class="headerlink" title="Combining Lifecycle Mechanisms"></a>Combining Lifecycle Mechanisms</h5><p>Multiple lifecycle mechanisms configured for the same bean, with different initialization methods, are called as follows <strong>in order</strong>:</p>
<ul>
<li>Methods annotated with <code>@PostConstruct</code></li>
<li><code>afterPropertiesSet()</code> as defined by the <code>InitializingBean</code> callback interface</li>
<li>A custom configured <code>init()</code> method</li>
</ul>
<p>Destroy methods are called in the same order:</p>
<ul>
<li>Methods annotated with <code>@PreDestroy</code></li>
<li><code>destroy()</code> as defined by the <code>DisposableBean</code> callback interface</li>
<li>A custom configured <code>destroy()</code> method</li>
</ul>
<h5 id="Startup-and-Shutdown-Callbacks"><a href="#Startup-and-Shutdown-Callbacks" class="headerlink" title="Startup and Shutdown Callbacks"></a>Startup and Shutdown Callbacks</h5><p>The <code>Lifecycle</code> interface defines the <strong>essential methods for any object that has its own lifecycle requirements</strong> (such as starting and stopping some background process):</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Lifecycle</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">start</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isRunning</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Any Spring-managed object may implement the <code>Lifecycle</code> interface. Then, when the <code>ApplicationContext</code> itself receives start and stop signals (for example, <strong>for a stop/restart scenario at runtime</strong>), it <strong>cascades those calls to all <code>Lifecycle</code> implementations defined within that context</strong>. It does this by delegating to a <code>LifecycleProcessor</code>, shown in the following listing:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">LifecycleProcessor</span> <span class="keyword">extends</span> <span class="title">Lifecycle</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onRefresh</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onClose</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Notice that the <code>LifecycleProcessor</code> is itself an extension of the <code>Lifecycle</code> interface. It also <strong>adds two other methods for reacting to the context being refreshed and closed</strong>.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Note that the regular <code>org.springframework.context.Lifecycle</code> interface is a plain contract for explicit start and stop notifications and <strong>does not imply auto-startup at context refresh time</strong>. For fine-grained control over auto-startup of a specific bean (including startup phases), consider implementing <code>org.springframework.context.SmartLifecycle</code> instead.</li>
</ul>
</blockquote>
<h5 id="Order-of-Startup-and-Shutdown-with-Dependencies"><a href="#Order-of-Startup-and-Shutdown-with-Dependencies" class="headerlink" title="Order of Startup and Shutdown with Dependencies"></a>Order of Startup and Shutdown with Dependencies</h5><p>The order of startup and shutdown invocations can be important. If a “depends-on” relationship exists between any two objects, the dependent side starts after its dependency, and it stops before its dependency. However, sometimes you might not want this order of execution. In this case, you would need to use the <code>SmartLifeCycle</code> Interface:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SmartLifecycle</span> <span class="keyword">extends</span> <span class="title">Lifecycle</span>, <span class="title">Phased</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isAutoStartup</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">stop</span><span class="params">(Runnable callback)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>and the <code>Phased</code> interface looks like:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Phased</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getPhase</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>When starting, the <strong>objects with the lowest phase start first</strong>. When <strong>stopping, the reverse order is followed</strong>. Therefore, an object that implements <code>SmartLifecycle</code> and whose <code>getPhase()</code> method returns <code>Integer.MIN_VALUE</code> would be among the first to start and the last to stop. At the other end of the spectrum, a phase value of <code>Integer.MAX_VALUE</code> would indicate that the object should be started last and stopped first (likely because it depends on other processes to be running). When considering the phase value, it is also important to know that the <strong>default phase for any “normal” Lifecycle object that does not implement <code>SmartLifecycle</code> is <code>0</code></strong>.</p>
<h5 id="Shuttingdown-a-Non-Web-application"><a href="#Shuttingdown-a-Non-Web-application" class="headerlink" title="Shuttingdown a Non-Web application"></a>Shuttingdown a Non-Web application</h5><p>If you use Spring’s IoC container in a non-web application environment (for example, in a rich client desktop environment), you should <strong>register a shutdown hook</strong> with the JVM. Doing so ensures a <strong>graceful shutdown and calls the relevant destroy methods on your singleton beans so that all resources are released</strong>. You must <strong>still configure and implement these destroy callbacks correctly</strong> (e.g. with <code>@Bean(destoryMethod=&quot;dispose&quot;)</code>, and implement the <code>dispose()</code> methods).</p>
<p>To register a shutdown hook, call the <code>registerShutdownHook()</code> method that is declared on the <code>ConfigurableApplicationContext</code> interface, as the following example shows:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.ConfigurableApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Boot</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">final</span> String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ConfigurableApplicationContext ctx = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"beans.xml"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// add a shutdown hook for the above context...</span></span><br><span class="line">        ctx.registerShutdownHook();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// app runs here...</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// main method exits, hook is called prior to the app shutting down...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="ApplicationContextAware-and-BeanNameAware"><a href="#ApplicationContextAware-and-BeanNameAware" class="headerlink" title="ApplicationContextAware and BeanNameAware"></a><code>ApplicationContextAware</code> and <code>BeanNameAware</code></h5><p>When an <strong><code>ApplicationContext</code> creates an object instance that implements the <code>org.springframework.context.ApplicationContextAware</code> interface</strong>, the <strong>instance is provided with a reference to that <code>ApplicationContext</code></strong>. This means that object could manipulate the container. The following listing shows the definition of the ApplicationContextAware interface:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ApplicationContextAware</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Thus, beans can programmatically manipulate the <code>ApplicationContext</code> that created them, through the <code>ApplicationContext</code> interface or by casting the reference to a known subclass of this interface (such as <code>ConfigurableApplicationContext</code>, which exposes additional functionality). One use would be the programmatic retrieval of other beans. Sometimes this capability is useful. <strong>However, in general, you should avoid it, because it couples the code to Spring and does not follow the Inversion of Control style</strong>, where collaborators are provided to beans as properties.</p>
<p>When an <code>ApplicationContext</code> creates a class that implements the <code>org.springframework.beans.factory.BeanNameAware</code> interface, <strong>the class is provided with a reference to the bean</strong> with name defined in its associated object definition. The following listing shows the definition of the BeanNameAware interface:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BeanNameAware</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setBeanName</span><span class="params">(String name)</span> <span class="keyword">throws</span> BeansException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The callback is <strong>invoked after population of normal bean properties but before an initialization callback such as <code>InitializingBean</code>, <code>afterPropertiesSet</code>, or a custom <code>init-method</code></strong>.</p>
<h4 id="Bean-Definition-Inheritance"><a href="#Bean-Definition-Inheritance" class="headerlink" title="Bean Definition Inheritance"></a>Bean Definition Inheritance</h4><p>(additional reference: <a href="https://www.tutorialspoint.com/spring/spring_bean_definition_inheritance.htm" target="_blank" rel="noopener">https://www.tutorialspoint.com/spring/spring_bean_definition_inheritance.htm</a>)</p>
<p>A bean definition can contain a lot of configuration information, including constructor arguments, property values, and container-specific information, such as the initialization method, a static factory method name, and so on. <strong>A child bean definition inherits configuration data from a parent definition</strong>. The child definition can override some values or add others as needed. Using parent and child bean definitions can save a lot of typing. Effectively, this is a form of templating.</p>
<p>In Java, this should be simple enough to have the <code>extends</code> keyword for that specific class, and then use <code>@Bean</code> at the correct place. You could also inherit an <code>@Configuration</code> class, which will also inherit all the <code>@Bean</code> configurations with it.</p>
<p>Without using the XML file, it should be similar to the normal Java inheritance.</p>
<h4 id="Customizing-your-Container"><a href="#Customizing-your-Container" class="headerlink" title="Customizing your Container"></a>Customizing your Container</h4><p>Typically, an application developer does not need to subclass ApplicationContext implementation classes. Instead, the Spring IoC container can be extended by plugging in implementations of special integration interfaces, or simply by using some anotations, in order to <strong>add some customized functionalities for the container (e.g. <code>@Autowired</code> is one example)</strong></p>
<h5 id="Using-Primary"><a href="#Using-Primary" class="headerlink" title="Using @Primary"></a>Using @Primary</h5><p>Because autowiring by type <strong>may lead to multiple candidates</strong>, it is often necessary to have more control over the selection process. One way to accomplish this is with Spring’s <code>@Primary</code> annotation. <code>@Primary</code> indicates that <strong>a particular bean should be given preference when multiple beans are candidates to be autowired to a single-valued dependency</strong>. If exactly one primary bean exists among the candidates, it becomes the autowired value.</p>
<p>Consider the following configuration that defines <strong><code>firstMovieCatalog</code> as the primary <code>MovieCatalog</code></strong> if an <code>MovieCatalog</code> is to be autowired:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MovieConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MovieCatalog <span class="title">firstMovieCatalog</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MovieCatalog <span class="title">secondMovieCatalog</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>With the preceding configuration, the following <code>MovieRecommender</code> is autowired with the <code>firstMovieCatalog</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MovieRecommender</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MovieCatalog movieCatalog;  <span class="comment">// so that the firstMovieCatalog would be created</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Using-Qualifier"><a href="#Using-Qualifier" class="headerlink" title="Using @Qualifier"></a>Using @Qualifier</h5><p><code>@Primary</code> is an effective way to use autowiring by type with several instances when one primary candidate can be determined. When you need even more control over the selection process, for example <strong>letting each bean to be autowired in a different setting</strong>, you can use Spring’s <code>@Qualifier</code> annotation. <strong>You can associate qualifier values with specific arguments, narrowing the set of type matches so that a specific bean is chosen for each argument</strong>. In the simplest case, this can be a plain descriptive value, as shown in the following example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MovieRecommender</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier</span>(<span class="string">"main"</span>)</span><br><span class="line">    <span class="keyword">private</span> MovieCatalog movieCatalog;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You can also specify the <code>@Qualifier</code> annotation on individual constructor arguments or method parameters, as shown in the following example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MovieRecommender</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MovieCatalog movieCatalog;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">(@Qualifier(<span class="string">"main"</span>)</span> MovieCatalog movieCatalog) </span>&#123;  <span class="comment">// specifies which MovieCatalog gets used</span></span><br><span class="line">        <span class="keyword">this</span>.movieCatalog = movieCatalog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Type-Matching-for-Generics"><a href="#Type-Matching-for-Generics" class="headerlink" title="Type Matching for Generics"></a>Type Matching for Generics</h5><p>In addition to the <code>@Qualifier</code> annotation, you can use <strong>Java generic types as an implicit form of qualification</strong>. For example, suppose you have the following configuration:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> StringStore <span class="title">stringStore</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> StringStore();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IntegerStore <span class="title">integerStore</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> IntegerStore();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Assuming that the preceding beans <strong>implement a generic interface, (that is, <code>Store&lt;String&gt;</code> and <code>Store&lt;Integer&gt;</code>)</strong>, you can <code>@Autowire</code> the <code>Store</code> interface and the generic is used as a qualifier, as the following example shows:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> Store&lt;String&gt; s1; <span class="comment">// equivalent as having a &lt;String&gt; qualifier, injects the stringStore bean</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> Store&lt;Integer&gt; s2; <span class="comment">// equivalent as having a &lt;Integer&gt; qualifier, injects the integerStore bean</span></span><br></pre></td></tr></table></figure>

<p>Generic qualifiers also apply when autowiring <code>List</code>s, <code>Map</code> instances and <code>Array</code>s. The following example autowires a generic List:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Inject all Store beans as long as they have an &lt;Integer&gt; generic</span></span><br><span class="line"><span class="comment">// Store&lt;String&gt; beans will not appear in this list</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> List&lt;Store&lt;Integer&gt;&gt; s;</span><br></pre></td></tr></table></figure>

<h5 id="Using-Resource"><a href="#Using-Resource" class="headerlink" title="Using @Resource"></a>Using @Resource</h5><p>(additional reference: <a href="https://www.baeldung.com/spring-annotations-resource-inject-autowire" target="_blank" rel="noopener">https://www.baeldung.com/spring-annotations-resource-inject-autowire</a>)</p>
<p>The <code>@Resource</code> annotation is part of the JSR-250 annotation collection and is packaged with Jakarta EE. This is used for <strong>field or setter dependency injection</strong>. This annotation has the following execution order:</p>
<ul>
<li>Match by Name (if a name is specified as an argument to <code>@Resource</code>, so it resolves the bean with the name specified)</li>
<li>Match by Type (if a name is not specified as an argument to <code>@Resource</code>, so it resolves the name by type )</li>
<li>Match by Qualifier (if a name is specified as an argument to <code>@Resource</code>, but there is no bean with that name nor resolvable by type, then need to be resolved by <code>@Qualifier</code>)</li>
</ul>
<p>These execution paths are applicable to both setter and field injection.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/06/09/Spring-Framework-Guide/" data-id="ckb7qqory0001xworgz0y9qwv" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-SpringBoot-Manual" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/06/09/SpringBoot-Manual/" class="article-date">
  <time datetime="2020-06-09T03:35:00.000Z" itemprop="datePublished">2020-06-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/06/09/SpringBoot-Manual/">Spring Boot Manual</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<p><strong>IMPORTANT</strong>:<br>Much of the content here is a personal summary/abbrieviation of contents on the <a href="https://docs.spring.io/spring-boot/docs/2.3.0.RELEASE/reference/html/" target="_blank" rel="noopener">Offical Spring Boot Documentation</a>. For more complete information, please refer to the offical site.</p>
<hr>
<h2 id="Spring-Boot-Installation"><a href="#Spring-Boot-Installation" class="headerlink" title="Spring Boot Installation"></a>Spring Boot Installation</h2><p>For instructions on installing and a quick overview of using Spring Boot, please refer to this <a href="https://docs.spring.io/spring-boot/docs/2.3.0.RELEASE/reference/html/getting-started.html#getting-started-installing-spring-boot" target="_blank" rel="noopener">page</a></p>
<h2 id="Structuring-Your-Code"><a href="#Structuring-Your-Code" class="headerlink" title="Structuring Your Code"></a>Structuring Your Code</h2><p>Technically, Spring Boot does not require any specific code layout to work. However, there are <strong>some best practices that help:</strong></p>
<ul>
<li><p>Your <code>main application</code> class:</p>
<ul>
<li><p>It is generally recommend that you locate <strong>your <code>main applicatio</code>n class in a root package above other<br>classes.</strong> The <code>@SpringBootApplication</code> annotation is often placed on your main class, and it implicitly<br>defines a base “search package” for certain items</p>
</li>
<li><p>For example, the follwoing structure:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">com</span><br><span class="line">+- example</span><br><span class="line">	+- myapplication</span><br><span class="line">		+- Application.java</span><br><span class="line">		|</span><br><span class="line">		+- customer</span><br><span class="line">		|   +- Customer.java</span><br><span class="line">		|   +- CustomerController.java</span><br><span class="line">		|   +- CustomerService.java</span><br><span class="line">		|   +- CustomerRepository.java</span><br><span class="line">		|</span><br><span class="line">		+- order</span><br><span class="line">			+- Order.java</span><br><span class="line">			+- OrderController.java</span><br><span class="line">			+- OrderService.java</span><br><span class="line">			+- OrderRepository.java</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>Your primary <code>configuration</code> class</p>
<ul>
<li>Although it is possible to use <code>SpringApplication</code> with <code>XML</code> sources, we generally recommend that <strong>your primary source be a single <code>@Configuration</code> class</strong>. Usually the <strong>class that defines the main method is a good candidate as the primary <code>@Configuration</code></strong>.</li>
<li>You can also <strong>import configuration classes</strong>:<ul>
<li>The <strong><code>@Import</code> annotation can be used to import additional configuration classes</strong>. Alternatively, you can <strong>use <code>@ComponentScan</code> to automatically pick up all Spring components</strong>, including <code>@Configuration</code> classes.</li>
</ul>
</li>
<li><strong>Import XML Configuration</strong><ul>
<li>If you need to use an XML based configuration, we recommend that you <strong>still start with a <code>@Configuration</code> class</strong>. You can <strong>then use an <code>@ImportResource</code> annotation</strong> to load XML configuration files.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Auto-Configuration"><a href="#Auto-Configuration" class="headerlink" title="Auto-Configuration"></a>Auto-Configuration</h3><p>You can also choose to use the Spring Boot <code>auto-configuration</code>, which attempts to automatically configure your Spring application based on the jar dependencies that you have added.</p>
<p>To enable <code>auto-configuration</code>, you need to <strong>add either <code>@EnableAutoConfiguration</code> or <code>@SpringBootApplication</code> annotations to one of your <code>@Configuration</code> classes</strong>.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/06/09/SpringBoot-Manual/" data-id="ckb7qqorv0000xworfjw0fm12" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Redis-Manual" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/06/02/Redis-Manual/" class="article-date">
  <time datetime="2020-06-02T01:10:15.000Z" itemprop="datePublished">2020-06-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/06/02/Redis-Manual/">Redis Manual</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<p><strong>IMPORTANT</strong>:<br>Much of the content here is a personal summary/abbrieviation of contents on the <a href="https://redislabs.com/ebook/part-1-getting-started/chapter-1-getting-to-know-redis/" target="_blank" rel="noopener">Offical Redis Guide</a>. For more complete information, please refer to the offical site.</p>
<hr>
<h2 id="Redis-Intro"><a href="#Redis-Intro" class="headerlink" title="Redis Intro"></a>Redis Intro</h2><p>Redis is an <strong>in-memory remote database</strong> that offers high performance, replication, and a unique data model to produce a platform for solving problems. By supporting <strong>five different types of data structures</strong> (<code>Strings</code>, <code>Lists</code>, <code>Sets</code>, <code>Hashes</code>, and <code>Sorted sets</code>), Redis accommodates a wide variety of problems that can be naturally mapped into what Redis offers.</p>
<p>To be specific, Redis is a very fast <strong>non-relational database</strong> that stores a <strong>mapping of keys to five different types of values</strong>. Redis supports <strong>in-memory persistent storage on disk</strong>, replication to scale read performance, and client-side sharding1 to scale write performance.</p>
<ul>
<li><strong>non-relational</strong><ul>
<li>In Redis, there are no tables, and there’s no database-defined or -enforced way of relating data in Redis with other data in Redis. Generally speaking, many Redis users will choose to <strong>store data in Redis</strong> only when the performance or functionality of Redis is necessary, using other relational or non-relational data storage for data where slower performance is acceptable, or where data is too large to fit in memory economically.</li>
</ul>
</li>
</ul>
<h2 id="Data-Structures-in-Redis"><a href="#Data-Structures-in-Redis" class="headerlink" title="Data Structures in Redis"></a>Data Structures in Redis</h2><table>
<thead>
<tr>
<th>Structure type</th>
<th>What it contains</th>
<th>Structure read/write ability</th>
</tr>
</thead>
<tbody><tr>
<td><code>STRING</code></td>
<td>Strings, integers, or floating-point values</td>
<td>Operate on the whole string, parts, increment/ decrement the integers and floats</td>
</tr>
<tr>
<td><code>LIST</code></td>
<td>Linked list of strings</td>
<td>Push or pop items from both ends, trim based on offsets, read individual or multiple items, find or remove items by value</td>
</tr>
<tr>
<td><code>SET</code></td>
<td>Unordered collection of unique strings</td>
<td>Add, fetch, or remove individual items, check membership, intersect, union, difference, fetch random items</td>
</tr>
<tr>
<td><code>HASH</code></td>
<td>Unordered hash table of keys to values</td>
<td>Add, fetch, or remove individual items, fetch the whole hash</td>
</tr>
<tr>
<td><code>ZSET</code> (sorted set)</td>
<td>Ordered mapping of string members to floating-point scores, ordered by score</td>
<td>Add, fetch, or remove individual values, fetch items based on score ranges or member value</td>
</tr>
</tbody></table>
<p>In the following sections, we will use the <code>redis cli</code> to pratice using redis commands and data structures.</p>
<p><a name="String-Basics"></a></p>
<h2 id="Strings-in-Redis-Basics"><a href="#Strings-in-Redis-Basics" class="headerlink" title="Strings in Redis - Basics"></a><code>String</code>s in Redis - Basics</h2><p>The operations available to <code>STRING</code>s start with what’s available in other <code>key-value</code> stores. We can <code>GET</code>values, <code>SET</code> values, and <code>DEL</code> values. After you have installed and tested Redis, within <code>redis-cli</code> you can try to <code>SET</code>, <code>GET</code>, and <code>DEL</code> values in Redis. The basic meanings are shown below in the table:</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>What it does</th>
</tr>
</thead>
<tbody><tr>
<td><code>GET</code></td>
<td><strong>Fetches the value</strong> stored at the <strong>given key</strong></td>
</tr>
<tr>
<td><code>SET</code></td>
<td><strong>Sets the value</strong> stored at the <strong>given key</strong></td>
</tr>
<tr>
<td><code>DEL</code></td>
<td><strong>Deletes the key-value pair</strong> stored at the <strong>given key</strong> (works for all types)</td>
</tr>
</tbody></table>
<p>Example demonstrating each of the commands:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; set hello value</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get hello</span><br><span class="line">&quot;value&quot;</span><br><span class="line">127.0.0.1:6379&gt; del hello</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; get hello</span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> You see outputs such as <code>(integer) 1</code>, which usually represents execution success/true. <code>(nil)</code> represents execution failure, and <code>(integer) 0</code> also means failure but to the extent where the output means <code>false</code>, for example when a value (rather than the key) DNE.</li>
</ul>
</blockquote>
<p><a name="List-Basics"></a></p>
<h2 id="Lists-in-Redis-Basics"><a href="#Lists-in-Redis-Basics" class="headerlink" title="Lists in Redis - Basics"></a><code>List</code>s in Redis - Basics</h2><p>The operations that can be performed on <code>LIST</code>s are typical of what we find in <code>LinkedList</code> data structures in almost any programming language. We can <code>push</code> items to the front and the back of the <code>LIST</code> with <code>LPUSH</code>/<code>RPUSH</code>; we can <code>pop</code> items from the front and back of the list with <code>LPOP</code>/<code>RPOP</code>; we can <code>fetch</code> an item at a given position with <code>LINDEX</code>; and we can <code>fetch</code> a range of items with <code>LRANGE</code>. </p>
<table>
<thead>
<tr>
<th>Command</th>
<th>What it does</th>
</tr>
</thead>
<tbody><tr>
<td><code>RPUSH</code></td>
<td>Pushes the value onto the <strong>right end</strong> of the list. If list DNE, creates a new list</td>
</tr>
<tr>
<td><code>LRANGE</code></td>
<td>Fetches a <strong>range of values</strong> from the list</td>
</tr>
<tr>
<td><code>LINDEX</code></td>
<td>Fetches <strong>an item at a given position</strong> in the list (begins at index <code>0</code>)</td>
</tr>
<tr>
<td><code>LPOP</code></td>
<td>Pops the value from the <strong>left end</strong> of the list and returns it</td>
</tr>
</tbody></table>
<p>For example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; rpush test-list item1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; rpush test-list item2</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; rpush test-list item1</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; lrange test-list 0 -1</span><br><span class="line">1) &quot;item1&quot;</span><br><span class="line">2) &quot;item2&quot;</span><br><span class="line">3) &quot;item1&quot;</span><br><span class="line">127.0.0.1:6379&gt; lindex test-list 1</span><br><span class="line">&quot;item2&quot;</span><br><span class="line">127.0.0.1:6379&gt; lpop test-list</span><br><span class="line">&quot;item1&quot;</span><br><span class="line">127.0.0.1:6379&gt; lrange test-list 0 -1</span><br><span class="line">1) &quot;item2&quot;</span><br><span class="line">2) &quot;item1&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> See that <strong>duplicates in values</strong> are allowed. </li>
</ul>
</blockquote>
<p><a name="Set-Basics"></a></p>
<h2 id="Sets-in-Redis-Basics"><a href="#Sets-in-Redis-Basics" class="headerlink" title="Sets in Redis - Basics"></a><code>Set</code>s in Redis - Basics</h2><p>In Redis, <code>SET</code>s are similar to <code>LIST</code>s in that they’re a sequence of strings, but unlike <code>LIST</code>s, Redis <code>SET</code>s use a <strong>hash table</strong> to keep <strong>all values/strings unique</strong>. </p>
<p>Because Redis <code>SET</code>s are <strong>unordered</strong>, we <strong>can’t <code>push</code> and <code>pop</code> items</strong> from the ends like we did with <code>LIST</code>s. Instead, we <strong><code>add</code> and <code>remove</code> items by value</strong> with the <code>SADD</code> and <code>SREM</code> commands. We can also find out whether an item is in the <code>SET</code> quickly with <code>SISMEMBER</code>, or <code>fetch</code> the entire set with <code>SMEMBERS</code> (this can be slow for large SETs, so be careful)</p>
<table>
<thead>
<tr>
<th>Comamnd</th>
<th>What it does</th>
</tr>
</thead>
<tbody><tr>
<td><code>SADD</code></td>
<td><strong>Adds the item</strong> to the set</td>
</tr>
<tr>
<td><code>SMEMBERS</code></td>
<td>Returns the <strong>entire set of items</strong></td>
</tr>
<tr>
<td><code>SISMEMBER</code></td>
<td><strong>Checks if an item</strong> is in the set</td>
</tr>
<tr>
<td><code>SREM</code></td>
<td><strong>Removes the item</strong> from the set, <strong>if it exists</strong></td>
</tr>
</tbody></table>
<p>For example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; sadd test-set item1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; sadd test-set item2</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; sadd test-set item1</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; smembers test-set</span><br><span class="line">1) &quot;item2&quot;</span><br><span class="line">2) &quot;item1&quot;</span><br><span class="line">127.0.0.1:6379&gt; sismember test-set item1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; sismember test-set item3</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; srem test-set item1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; srem test-set item1</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; smembers test-set</span><br><span class="line">1) &quot;item2&quot;</span><br></pre></td></tr></table></figure>

<p><a name="Hash-Basics"></a></p>
<h2 id="Hashes-in-Redis-Basics"><a href="#Hashes-in-Redis-Basics" class="headerlink" title="Hashes in Redis - Basics"></a><code>Hash</code>es in Redis - Basics</h2><p>Whereas <code>LIST</code>s and <code>SET</code>s in Redis hold sequences of items, Redis <code>HASH</code>es store a <strong>mapping of (distinct) keys to values</strong>. The values that can be stored in <code>HASH</code>es are the same as what can be stored as normal <code>STRING</code>s: strings themselves, or if a value can be interpreted as a number, that value can be incremented or decremented.</p>
<p>In a lot of ways, we can think of <strong><code>HASH</code>es in Redis as miniature versions of Redis itself</strong>. </p>
<table>
<thead>
<tr>
<th>Command</th>
<th>What it does</th>
</tr>
</thead>
<tbody><tr>
<td><code>HSET</code></td>
<td>Creats a hashtable, and <strong>stores the key-value pair</strong> in tha hashtable</td>
</tr>
<tr>
<td><code>HGET</code></td>
<td>Fetches the <strong>value at the given hash key</strong></td>
</tr>
<tr>
<td><code>HGETALL</code></td>
<td>Fetches the <strong>entire hashtable</strong></td>
</tr>
<tr>
<td><code>HDEL</code></td>
<td><strong>Removes a key-value pair</strong> from the hash, if it exists</td>
</tr>
</tbody></table>
<p>For example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hset test-hasht key1 value1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; hset test-hasht key2 value2</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; hset test-hasht key1 value2</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; hgetall test-hasht</span><br><span class="line">1) &quot;key1&quot;</span><br><span class="line">2) &quot;value2&quot;</span><br><span class="line">3) &quot;key2&quot;</span><br><span class="line">4) &quot;value2&quot;</span><br><span class="line">127.0.0.1:6379&gt; hget test-hasht key1</span><br><span class="line">&quot;value2&quot;</span><br><span class="line">127.0.0.1:6379&gt; hdel test-hasht key2</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; hgetall test-hasht</span><br><span class="line">1) &quot;key1&quot;</span><br><span class="line">2) &quot;value2&quot;</span><br></pre></td></tr></table></figure>

<p><a name="ZSet-Basics"></a></p>
<h2 id="Sorted-sets-Zsets-in-Redis-Basics"><a href="#Sorted-sets-Zsets-in-Redis-Basics" class="headerlink" title="Sorted sets/Zsets in Redis - Basics"></a><code>Sorted set</code>s/<code>Zset</code>s in Redis - Basics</h2><p>Like Redis <code>HASH</code>es, <code>ZSET</code>s also hold <strong>pairs of key and value</strong>. The <strong>keys (called <code>member</code>s) are unique</strong>, and the <strong>values (called <code>score</code>s) are limited to floating-point numbers</strong>. <code>ZSET</code>s have the unique property in Redis of being able to be accessed by member (like a HASH), but <strong>items can also be accessed by the sorted order and values of the <code>score</code>s</strong>. </p>
<table>
<thead>
<tr>
<th>Command</th>
<th>What it does</th>
</tr>
</thead>
<tbody><tr>
<td><code>ZADD</code></td>
<td><strong>Adds member/key with the given score</strong> to the ZSET. The order of input is <code>score</code> and then <code>member</code>.</td>
</tr>
<tr>
<td><code>ZRANGE</code></td>
<td>Fetches the items in the ZSET <strong>from their positions in sorted order</strong></td>
</tr>
<tr>
<td><code>ZRANGEBYSCORE</code></td>
<td>Fetches items in the ZSET <strong>based on a range of scores</strong></td>
</tr>
<tr>
<td><code>ZREM</code></td>
<td>Removes the <strong>item</strong> from the ZSET, if it exists</td>
</tr>
</tbody></table>
<p>For example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zadd test-zset 100 member1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; zadd test-zset 200 member2</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; zadd test-zset 200 member3</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; zrange test-zset 0 -1 withscores</span><br><span class="line">1) &quot;member1&quot;</span><br><span class="line">2) &quot;100&quot;</span><br><span class="line">3) &quot;member2&quot;</span><br><span class="line">4) &quot;200&quot;</span><br><span class="line">5) &quot;member3&quot;</span><br><span class="line">6) &quot;200&quot;</span><br><span class="line">127.0.0.1:6379&gt; zrange test-zset 0 -1</span><br><span class="line">1) &quot;member1&quot;</span><br><span class="line">2) &quot;member2&quot;</span><br><span class="line">3) &quot;member3&quot;</span><br><span class="line">127.0.0.1:6379&gt; zrangebyscore test-zset 0 150 withscores</span><br><span class="line">1) &quot;member1&quot;</span><br><span class="line">2) &quot;100&quot;</span><br><span class="line">127.0.0.1:6379&gt; zrem test-zset member1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; zrange test-zset 0 -1 withscores</span><br><span class="line">1) &quot;member2&quot;</span><br><span class="line">2) &quot;200&quot;</span><br><span class="line">3) &quot;member3&quot;</span><br><span class="line">4) &quot;200&quot;</span><br></pre></td></tr></table></figure>

<h2 id="Connecting-a-Python-Standalone-Container-to-Redis"><a href="#Connecting-a-Python-Standalone-Container-to-Redis" class="headerlink" title="Connecting a Python Standalone Container to Redis"></a>Connecting a Python Standalone Container to Redis</h2><p>The basic idea is as follows (assuming you already have a <code>redis</code> container):</p>
<ul>
<li>create a <code>bridge</code> that allows the two containers to automatically resolve each other’s IP by container name</li>
<li>connect your <code>redis</code> container to that <code>bridge</code></li>
<li>create a <code>python</code> container, connecting it to the same <code>bridge</code> you just created, and configuring your mount volume(s)</li>
<li>install Redis libraries in the <code>python</code> container</li>
<li>connect your to the <code>redis</code> container by <code>connected = redis.Redis(host=&#39;&lt;your-redis-container-name&gt;&#39;, port=6379)</code>.<br>(alternatively, you could use <code>docker-compose</code> to achieve the same thing.)</li>
</ul>
<ol>
<li><p>Create a <code>user-defined bridge</code> with the name <code>redis-py</code> in Docker with the following command:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create -d bridge redis-py</span><br></pre></td></tr></table></figure></li>
<li><p>Connect your already exitsed <code>redis</code> container to that bridge. If you do not have a <code>redis</code> container yet, you need to set one up first. You connect the <code>redis</code> container (called <code>test-redis</code> in this example) to that bridge <code>redis-py</code> by running:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network connect redis-py test-redis</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Here you would also need to remember the port name your <code>redis</code> container uses. By default, it should be <code>6379</code>. You can see the port once you run your <code>redis</code> container with <code>docker exec -it test-redis redis-cli</code>, and it will show, for example: <code>127.0.0.1:6379&gt;</code>.</li>
</ul>
</blockquote>
</li>
<li><p>Now you need to build another <code>python</code> container. You can first pull the image with <code>docker pull python</code>, and then start a container with:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --name&#x3D;test-py-red \</span><br><span class="line">	--network redis-py \</span><br><span class="line">	-e REDIS_HOST&#x3D;test-redis \</span><br><span class="line">	-e REDIS_PORT&#x3D;6379 \</span><br><span class="line">	-p 8080:80 \</span><br><span class="line">	-v python-vol:&#x2F;data \</span><br><span class="line">	python bash</span><br></pre></td></tr></table></figure>
<p> Note that some of the commands above are <strong>optional</strong>:</p>
<ul>
<li><code>-e REDIS_HOST=test-redis</code><ul>
<li>this will configure your enviromental variable <code>REDIS_HOST</code> to be set to <code>test-redis</code> (your <code>redis</code> container name). However, this is not necessary.</li>
</ul>
</li>
<li><code>e REDIS_PORT=6379</code><ul>
<li>this will configure your enviromental variable <code>REDIS_PORT</code> to be set to <code>6379</code> (your <code>redis</code> port). However, this is not necessary.</li>
</ul>
</li>
<li><code>v python-vol:/data</code> (recommended to have a mount)<ul>
<li>this will mount the directory <code>/data</code> in your <code>python</code> container to the external local volume <code>python-vol</code></li>
</ul>
</li>
</ul>
</li>
<li><p>Now, since we specified <code>python bash</code> in the last line, it will start in bash inside the container. This allows you to install the <code>redis</code> library for python:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip install --trusted-host pypi.python.org Flask Redis</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> A problem with this is that if you remove the container, you will need to execute to re-install this library again. A solution could be to build your own Dockerfile and create your own image with:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FROM python:latest</span><br><span class="line">WORKDIR &#x2F;app</span><br><span class="line">ADD . &#x2F;app</span><br><span class="line">RUN pip install --trusted-host pypi.python.org Flask Redis</span><br><span class="line">EXPOSE 80 </span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
</li>
<li><p>Finally, you can connect to your <code>redis</code> container names <code>test-redis</code> with:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python</span><br></pre></td></tr></table></figure>
<p> which enters the <code>python</code> command line.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import redis</span><br></pre></td></tr></table></figure>
<p> which imports the <code>redis</code> library you just installed</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; connected &#x3D; redis.Redis(host&#x3D;&#39;test-redis&#39;,port&#x3D;6379)</span><br></pre></td></tr></table></figure>
<p> which connects to the <code>test-redis</code> container at port <code>6379</code>, so that now you can access <code>redis</code> contents and comamnds such as:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; connected.set(&#39;hello&#39;,&#39;world&#39;)</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="Antonomy-of-a-Redis-Web-Application"><a href="#Antonomy-of-a-Redis-Web-Application" class="headerlink" title="Antonomy of a Redis Web Application"></a>Antonomy of a Redis Web Application</h2><p>Consider the case that you are managing a large online retail store, and you have millions of customers using it. Now, besides managing your website’s functionality, you would need several things to consider related to user-generated information:</p>
<ul>
<li>login management</li>
<li>user browsing data</li>
<li>…<br>You may thing that you could simply use a database like SQL. However, the problem is that most relational databases are limited to inserting, updating, or deleting <strong>roughly 200–2,000 individual rows every second per database server</strong>. Though bulk inserts/updates/deletes can be performed faster, a customer will only be updating a small handful of rows for each web page view, so higher-speed bulk insertion doesn’t help here.</li>
</ul>
<p>At present, due to the relatively large load through the day (assume averaging roughly 1,200 writes per second, close to 6,000 writes per second at peak), you needed to <strong>set up 10 relational database servers to deal with the load during peak hours</strong>. But now, you would like to try the new <code>redis</code> tool and see if all those data could be managed more easily.</p>
<h2 id="Login-and-Cookie-Caching"><a href="#Login-and-Cookie-Caching" class="headerlink" title="Login and Cookie Caching"></a>Login and Cookie Caching</h2><p>Whenever we sign in to services on the internet, such as bank accounts or web mail, these services <strong>remember who we are using cookies</strong>. <strong>Cookies are small pieces of data</strong> that websites ask our <strong>web browsers to store and resend</strong> on every request to that service. </p>
<p>For <strong>login cookies</strong>, there are two common methods of storing login information in cookies: <strong>a signed cookie</strong> or <strong>a token cookie</strong>.</p>
<p>In general, cookies <strong>do not store passwords</strong>.</p>
<ul>
<li><p><strong>Signed cookies</strong> typically store the <code>username</code> when they last logged in, or maybe their user ID, and whatever else the service may find useful. Along with this user-specific information, the <strong>cookie also includes a signature that allows the server to verify that the information that the browser sent hasn’t been altered</strong> (like replacing the login name of one user with another).</p>
</li>
<li><p><strong>Token cookies</strong> use a series of <strong>random bytes as the data</strong> in the cookie. The series of random bytes is generated when you logged in successfully, and then <strong>the server issues you that long random number token as a secret identifier</strong>. Then, on the server, <strong>the token is used as a key to look up the user who owns that token by querying a database of some kind</strong>. Over time, old tokens can be deleted to make room for new tokens (so that your loggin session expires).</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>Cookie type</th>
<th>Pros</th>
<th>Cons</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Signed cookie</strong></td>
<td>Everything needed to verify the cookie is in the cookie. Additional information can be included and signed easily</td>
<td>Correctly handling signatures is hard. It’s easy to forget to sign and/or verify data, allowing security vulnerabilities</td>
</tr>
<tr>
<td><strong>Token cookie</strong></td>
<td>Adding information is easy. Very small cookie, so mobile and slow clients can send requests faster</td>
<td>More information to store on the server. If using a relational database, cookie loading / storing can be expensive</td>
</tr>
</tbody></table>
<p>To get started, we’ll use a <code>HASH</code> to store our <strong>mapping from login cookie tokens</strong> to the <strong>user that’s logged in</strong>. </p>
<ul>
<li><p>To <strong>check the login</strong>, we need to fetch the user based on the token and return it, if it’s available. The following listing shows how we check login cookies.</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># conn=redis.Redis(host='&lt;yourhost&gt;', port='&lt;yourPort&gt;')</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_token</span><span class="params">(conn, token)</span>:</span></span><br><span class="line">	<span class="keyword">return</span> conn.hget(<span class="string">'login:'</span>, token)  <span class="comment"># Fetch and return the given user, if available.</span></span><br></pre></td></tr></table></figure>


</li>
</ul>
<ul>
<li><p>Then, for a visit, we’ll <strong>update the login <code>HASH</code> for the user and record the current timestamp for the token</strong> in the <code>ZSET</code> of recent users. If the user was viewing an item, we also add the item to the user’s recently viewed <code>ZSET</code> and trim that <code>ZSET</code> <strong>if it grows past 25 items</strong>. The function that does all of this can be seen next.</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update_token</span><span class="params">(conn, token, user, item=None)</span>:</span></span><br><span class="line">	timestamp = time.time()  <span class="comment">#Get the timestamp.</span></span><br><span class="line"></span><br><span class="line">	conn.hset(<span class="string">'login:'</span>, token, user)  <span class="comment">#Keep a mapping from the token to the logged-in user.</span></span><br><span class="line">	conn.zadd(<span class="string">'recent:'</span>, token, timestamp)  <span class="comment">#Record when the token was last seen.</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> item:</span><br><span class="line">		conn.zadd(<span class="string">'viewed:'</span> + token, item, timestamp)  <span class="comment">#Record that the user viewed the item.</span></span><br><span class="line">		conn.zremrangebyrank(<span class="string">'viewed:'</span> + token, <span class="number">0</span>, <span class="number">-26</span>)  <span class="comment">#Remove old items, keeping the most recent 25.</span></span><br></pre></td></tr></table></figure>

<p>  And you know what? That’s it. We’ve now <strong>recorded when a user with the given session last viewed an item and what item that user most recently looked at</strong>. On a server made in the last few years, you can record this information <strong>for at least 20,000 item views every second</strong>, which is more than three times what we needed to perform against the database. This can be made even faster, which we’ll talk about later. But even for this version, we’ve improved performance by 10–100 times over a typical relational database in this context.</p>
</li>
<li><p>Over time, memory use will grow, and we’ll want to <strong>clean out old data</strong>. As a way of limiting our data, we’ll only <strong>keep the most recent 10 million sessions</strong>.</p>
<p>  For our cleanup, we’ll <code>fetch</code> the size of the <code>ZSET</code> in a loop. If the <code>ZSET</code> is too large, we’ll fetch the oldest items up to 100 at a time (because we’re using timestamps, this is just the first 100 items in the ZSET), <strong>remove them from the <code>recent ZSET</code></strong>, <strong>delete the login tokens from the <code>login HASH</code></strong>, and <strong>delete the relevant <code>viewed ZSET</code>s</strong>. If the ZSET isn’t too large, we’ll <strong>sleep for one second and try again later</strong>. The code for cleaning out old sessions is shown next.</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">QUIT = <span class="literal">False</span></span><br><span class="line">LIMIT = <span class="number">10000000</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clean_sessions</span><span class="params">(conn)</span>:</span></span><br><span class="line">	<span class="keyword">while</span> <span class="keyword">not</span> QUIT:</span><br><span class="line">		size = conn.zcard(<span class="string">'recent:'</span>)  <span class="comment"># Find out how many tokens are known.</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> size &lt;= LIMIT:</span><br><span class="line">			time.sleep(<span class="number">1</span>)  <span class="comment"># We’re still under our limit; sleep and try again.</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			end_index = min(size - LIMIT, <span class="number">100</span>)</span><br><span class="line">			tokens = conn.zrange(<span class="string">'recent:'</span>, <span class="number">0</span>, end_index<span class="number">-1</span>)  <span class="comment"># Fetch the token IDs that should be removed.</span></span><br><span class="line">		</span><br><span class="line">			session_keys = []</span><br><span class="line">			<span class="keyword">for</span> token <span class="keyword">in</span> tokens:</span><br><span class="line">				session_keys.append(<span class="string">'viewed:'</span> + token)  <span class="comment"># Prepare the key names for the tokens to delete.</span></span><br><span class="line">		</span><br><span class="line">			conn.delete(*session_keys)</span><br><span class="line">			conn.hdel(<span class="string">'login:'</span>, *tokens)</span><br><span class="line">			conn.zrem(<span class="string">'recent:'</span>, *tokens)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> The <code>cleanup</code> function written above may be run as a <strong>daemon process</strong>, to be run periodically via a cron job, or even to be run during every execution. As a general rule, if the function includes a <code>while not QUIT</code>: line, it’s <strong>supposed to be run as a daemon</strong>, though it could probably be modified to be run periodically, depending on its purpose.</li>
<li><input disabled type="checkbox"> You also notice that we called three functions with a syntax similar to <code>conn.delete(*vtokens)</code>. Basically, we’re <strong>passing a sequence of arguments to the underlying function without previously unpacking</strong> the arguments. For further details on the semantics of how this works, you can visit the Python language tutorial website by visiting this short url: <a href="https://mng.bz/8I7W" target="_blank" rel="noopener">https://mng.bz/8I7W</a>.</li>
</ul>
</blockquote>
<h2 id="Storing-Shopping-Carts-Info"><a href="#Storing-Shopping-Carts-Info" class="headerlink" title="Storing Shopping Carts Info"></a>Storing Shopping Carts Info</h2><p>Because we’ve had such good luck with session cookies and recently viewed items, we’ll push our <strong>shopping cart information</strong> into Redis. Since we’re already keeping user session cookies in Redis (along with recently viewed items), we can use the <strong>same cookie ID for referencing the shopping cart</strong>.</p>
<p>The shopping cart that we’ll use is simple: it’s a <code>HASH</code> that <strong>maps an item ID to the quantity of that item that the customer would like to purchase</strong>. We’ll have the web application handle validation for item count, so we only need to update counts in the cart as they change. If the user wants more than 0 items, we add the item(s) to the <code>HASH</code> (replacing an earlier count if it existed). If not, we remove the entry from the hash. Our <code>add_to_cart()</code> function can be seen in this listing.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_to_cart</span><span class="params">(conn, session, item, count)</span>:</span></span><br><span class="line">	<span class="keyword">if</span> count &lt;= <span class="number">0</span>:</span><br><span class="line">		conn.hrem(<span class="string">'cart:'</span> + session, item)  <span class="comment"># Remove the item from the cart.</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		conn.hset(<span class="string">'cart:'</span> + session, item, count)  <span class="comment"># Add the item to the cart.</span></span><br></pre></td></tr></table></figure>

<p>Now, we’ll update our <code>session cleanup</code> function to include <strong>deleting old shopping carts</strong> as   <code>clean_full_sessions()</code> in the next listing.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clean_full_sessions</span><span class="params">(conn)</span>:</span></span><br><span class="line">	<span class="keyword">while</span> <span class="keyword">not</span> QUIT:</span><br><span class="line">		size = conn.zcard(<span class="string">'recent:'</span>)</span><br><span class="line">		<span class="keyword">if</span> size &lt;= LIMIT:</span><br><span class="line">			time.sleep(<span class="number">1</span>)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			end_index = min(size - LIMIT, <span class="number">100</span>)</span><br><span class="line">			sessions = conn.zrange(<span class="string">'recent:'</span>, <span class="number">0</span>, end_index<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">			session_keys = []</span><br><span class="line">			<span class="keyword">for</span> sess <span class="keyword">in</span> sessions:</span><br><span class="line">				session_keys.append(<span class="string">'viewed:'</span> + sess)</span><br><span class="line">				session_keys.append(<span class="string">'cart:'</span> + sess)  <span class="comment"># The required added line to delete the shopping cart for old sessions.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			conn.delete(*session_keys)</span><br><span class="line">			conn.hdel(<span class="string">'login:'</span>, *sessions)</span><br><span class="line">			conn.zrem(<span class="string">'recent:'</span>, *sessions)</span><br></pre></td></tr></table></figure>

<p>We now have <strong>both sessions and the shopping cart stored in Redis</strong>, which helps to reduce request size, as well as allows the performing of statistical calculations on visitors to our site based on what items they looked at, what items ended up in their shopping carts, and what items they finally purchased.</p>
<h2 id="Webpage-Caching"><a href="#Webpage-Caching" class="headerlink" title="Webpage Caching"></a>Webpage Caching</h2><p>Caching is different from a cookie. While they both act as some kind of storage, <strong>cache is actually a part of computer memory</strong>, whereas <strong>cookie is just stored and used by web browsers</strong>. </p>
<p>In genearl, when a processor wants something (e.g. values(a,b) for doing an operation (a+b)), it <strong>first search in cache if cache have these values</strong> then processor will fetch values form cache (fetching values from cache is really fast), but if cache don’t have these values <strong>then it will search in RAM</strong> (fetching values from ram is faster than hdd,ssd but slower than cache) if ram don’t have <strong>then it will search in hhd or ssd</strong>.</p>
<p><strong>In the context of web services</strong>, this means that cache in general can deal with larger data pieces than cookies, so one common way of using it in web services is for <strong>storing static website contents</strong>. Since those static contenst don’t need to be dynamically generated upon every request, we can store most of the information in cache for <strong>faster browsing experience</strong>. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cache_request</span><span class="params">(conn, request)</span>:</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">not</span> can_cache(request):</span><br><span class="line">		<span class="keyword">return</span> callback(request)  <span class="comment"># calls the request back to generate the content</span></span><br><span class="line"></span><br><span class="line">	page_key = <span class="string">"cache:"</span> + hash_request(request)  <span class="comment"># hash the request for lookup and storing</span></span><br><span class="line">	</span><br><span class="line">	content = conn.get(pagekey)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> content <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># reached here means content is cachable but not stored in cache</span></span><br><span class="line"></span><br><span class="line">		content = callback(request) <span class="comment"># content not cached. calls the request back to generate the content</span></span><br><span class="line">		conn.setex(page_key, <span class="number">300</span>, content)  <span class="comment"># cache the content and set expire in 300 seconds</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> content</span><br></pre></td></tr></table></figure>

<h2 id="Database-row-caching"><a href="#Database-row-caching" class="headerlink" title="Database row caching"></a>Database row caching</h2><p>For a daily deal with inventory counts being reduced and affecting whether someone can buy the item, the site cannot be entirely cached. However, an easy solution would be caching <strong>but also remmeber updating that specific database row</strong>. This means that you can choose to update the <strong>cached row for that specific item every few seconds</strong>, if there are <strong>many buyers</strong>. But if the data doesn’t change often, or when back-ordered items are acceptable, it may make sense to only update the cache every minute.</p>
<p>This can be done via using two <code>ZSET</code>s, one called <code>delay:</code> that tells you how often you should update your database row, and another called <code>schedule:</code> which tells you when the database row has been last updated in your cache.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cache_rows</span><span class="params">(conn)</span>:</span>  <span class="comment"># this will be a daemon process</span></span><br><span class="line">	<span class="keyword">while</span> <span class="keyword">not</span> QUIT:</span><br><span class="line">		next = conn.zrange(<span class="string">'schedule:'</span>,<span class="number">0</span>,<span class="number">0</span>, withscores=TRUE)  <span class="comment"># this fetches the first/earliest item that we have updated, if there is</span></span><br><span class="line"></span><br><span class="line">		now = time.time()</span><br><span class="line">		<span class="keyword">if</span> next <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> next[<span class="number">0</span>][<span class="number">1</span>] &gt; now:  <span class="comment"># if there are no items in schedule: </span></span><br><span class="line">											  <span class="comment"># or time hasn't come yet for updating</span></span><br><span class="line">			time.sleep(<span class="number">0.05</span>)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			row_id = next[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">			delay = conn.zscore(<span class="string">'delay:'</span>, row_id)  <span class="comment"># delay also stores information on whether</span></span><br><span class="line">												   <span class="comment"># we should remove the item in the scheduling</span></span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span> delay &lt;= <span class="number">0</span>:</span><br><span class="line">				conn.zrem(<span class="string">'delay:'</span>, row_id)</span><br><span class="line">				conn.zrem(<span class="string">'schedule:'</span>, row_id)</span><br><span class="line">				conn.delete(<span class="string">'inv:'</span> + row_id)  </span><br><span class="line">			<span class="keyword">else</span>:  <span class="comment"># now we need to handle the cache updating</span></span><br><span class="line"></span><br><span class="line">				d_row = Inventory.get(row_id)  <span class="comment"># gets the database row</span></span><br><span class="line"></span><br><span class="line">				conn.zadd(<span class="string">'schedule:'</span>, row_id, now+delay)  <span class="comment"># re-schedule the item for update</span></span><br><span class="line">				</span><br><span class="line">				conn.set(<span class="string">'inv:`+row_id, json.dumps(row.to_dict()))  # updates the cache with the latest database row</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">def add_schedule_row_cache(conn, row_id, delay):</span></span><br><span class="line"><span class="string">	conn.zadd('</span>delay:<span class="string">', row_id, delay)  # adds the item and tells how often it should be updated</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	conn.zadd('</span>schedule:<span class="string">', row_id, time.time())  # adds the item with the time it was placed in cache</span></span><br></pre></td></tr></table></figure>

<h2 id="Simple-Webpage-Analytics"><a href="#Simple-Webpage-Analytics" class="headerlink" title="Simple Webpage Analytics"></a>Simple Webpage Analytics</h2><p>In the previous examples, we were able to cache webpage contents. However, we did not limit how much pages should be cached, as we did not specify the <code>can_cache()</code> function yet. But what would be a sensible way to <strong>decide which webpage should be cached and which one shouldn’t</strong>? </p>
<p>A simple idea is to only include (for example) 10,000 webpages that has items you are browing the most often. For the other webpages with items that you browse only occaasionally, you do not store them in cache. However, you also need to be able to include possible new trending items, so you cannot just simply discard all items below the 10,000 limit. One solution you could use is to <strong>rescale the view counts of the top 10,000 items you viewed to be half</strong> has much as they were before.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rescale_viewed</span><span class="params">(conn)</span>:</span></span><br><span class="line">	<span class="keyword">while</span> <span class="keyword">not</span> QUIT:</span><br><span class="line">		conn.zremrangebyrank(<span class="string">'viewed:'</span>, <span class="number">20000</span>, <span class="number">-1</span>)  <span class="comment"># Remove any item not in the top 20,000 viewed items.</span></span><br><span class="line"></span><br><span class="line">		conn.zinterstore(<span class="string">'viewed:'</span>, &#123;<span class="string">'viewed:'</span>: <span class="number">.5</span>&#125;)  <span class="comment"># Rescale all counts to be 1/2 of what they were before.</span></span><br><span class="line"></span><br><span class="line">		time.sleep(<span class="number">300</span>)  <span class="comment"># Do it again in 5 minutes.</span></span><br></pre></td></tr></table></figure>
<p>where the line:</p>
<ul>
<li><code>conn.zinterstore(&#39;viewed:&#39;, {&#39;viewed:&#39;: .5})</code>, the function <code>ZINTERSTORE</code> lets us combine one or more <code>ZSET</code>s and <strong>multiply every score in the input <code>ZSET</code>s by a given number</strong>. (Each input <code>ZSET</code> can be multiplied by a different number.)</li>
</ul>
<p>Now, one sensible way to call this function is to place it in the place where you kept a reference to every item visited when you do login and shopping cart info storing. So you can place it in here:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update_token</span><span class="params">(conn, token, user, item=None)</span>:</span></span><br><span class="line">	timestamp = time.time()</span><br><span class="line">	conn.hset(<span class="string">'login:'</span>, token, user)</span><br><span class="line">	conn.zadd(<span class="string">'recent:'</span>, token, timestamp)</span><br><span class="line">	<span class="keyword">if</span> item <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">		conn.zadd(<span class="string">'viewed:'</span> + token, item, timestamp)</span><br><span class="line">		conn.zremrangebyrank(<span class="string">'viewed:'</span> + token, <span class="number">0</span>, <span class="number">-26</span>)</span><br><span class="line"></span><br><span class="line">		conn.zincrby(<span class="string">'viewed:'</span>, item, <span class="number">-1</span>)  <span class="comment"># the added line, move the item forward if viewed again</span></span><br></pre></td></tr></table></figure>

<p>With the <code>rescaling</code> and the <code>counting</code>, we now have a <strong>constantly updated list of the most-frequently viewed items</strong>. Now all we need to do is to specify our <code>can_cache()</code> function to take into consideration our new method of deciding whether a page can be cached, and we’re done:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">can_cache</span><span class="params">(conn, request)</span>:</span></span><br><span class="line">	item_id = extract_item_id(request)  <span class="comment"># Get the item ID for the page, if any.</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> item_id <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">or</span> is_dynamic(request):  <span class="comment"># Check whether the page can be statically cached and whether this is an item page.</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">	rank = conn.zrank(<span class="string">'viewed:'</span>, item_id)  <span class="comment"># Get the rank of the item.</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> rank <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> rank &lt; <span class="number">10000</span>  <span class="comment"># Return whether the item has a high enough view count to be cached.</span></span><br></pre></td></tr></table></figure>

<h2 id="Strings-in-Redis"><a href="#Strings-in-Redis" class="headerlink" title="Strings in Redis"></a><code>String</code>s in Redis</h2><p>In this section, we’ll talk about the simplest structure available to Redis, the STRING. This builds on the section <a href="#String-Basics"><code>String</code>s in Redis - Basics</a>, and here it covers the basic <strong>numeric increment and decrement operations</strong>, followed later by the <strong>bit and substring manipulation</strong> calls, and you’ll come to understand that even the simplest of structures has a few surprises that can make it useful in a variety of powerful ways.</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Example use and description</th>
</tr>
</thead>
<tbody><tr>
<td><code>INCR</code></td>
<td><code>INCR key-name</code> — Increments the value stored at the key <strong>by 1</strong></td>
</tr>
<tr>
<td><code>DECR</code></td>
<td><code>DECR key-name</code> — Decrements the value stored at the key <strong>by 1</strong></td>
</tr>
<tr>
<td><code>INCRBY</code></td>
<td><code>INCRBY key-name amount</code> — Increments the value stored at the key <strong>by the provided integer value</strong></td>
</tr>
<tr>
<td><code>DECRBY</code></td>
<td><code>DECRBY key-name amount</code> — Decrements the value stored at the key <strong>by the provided integer value</strong></td>
</tr>
<tr>
<td><code>INCRBYFLOAT</code></td>
<td><code>INCRBYFLOAT key-name amount</code> — Increments the value stored at the key <strong>by the provided float value</strong> (available in Redis 2.6 and later)</td>
</tr>
</tbody></table>
<p>This means that, when setting a <code>STRING</code> value in Redis, if that <strong>value could be interpreted as a base-10 integer or a floating-point value</strong>, Redis will detect this and <strong>allow you to manipulate the value using the various <code>INCR*</code> and <code>DECR*</code> operations</strong>. So, if you try to <strong>increment or decrement</strong> a key that has a value that <strong>can’t be interpreted as an integer or float</strong>, you’ll receive <strong>an error</strong>.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> If you try to <strong>increment or decrement a key that doesn’t exist or is an empty string</strong>, Redis will operate as though that <strong>key’s value were zero</strong>. </li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> redis; conn=redis.Redis(host=<span class="string">'cust-redis'</span>,port=<span class="number">6379</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.get(<span class="string">'new-key'</span>)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.incr(<span class="string">'new-key'</span>)  <span class="comment"># incrementing a non-existant key by 1</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.incr(<span class="string">'new-key-2'</span>)  <span class="comment"># incrementing a non-existant key by </span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.get(<span class="string">'new-key-2'</span>)</span><br><span class="line"><span class="string">b'1'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.incr(<span class="string">'new-key'</span>,<span class="number">10</span>)  <span class="comment"># python implemented to have the option of passing in a value</span></span><br><span class="line"><span class="number">11</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.incrby(<span class="string">'new-key'</span>,<span class="number">10</span>)</span><br><span class="line"><span class="number">21</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.decr(<span class="string">'new-key'</span>,<span class="number">10</span>)</span><br><span class="line"><span class="number">11</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.decrby(<span class="string">'new-key'</span>,<span class="number">10</span>)</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.set(<span class="string">'new-key'</span>,<span class="number">10</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.get(<span class="string">'new-key'</span>)</span><br><span class="line"><span class="string">b'10'</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> You see those <code>b</code> in front of the result string because these data are <strong>byte literal</strong>s instead of <strong>String</strong> objects. Therefore, to <strong>get rid of the <code>b</code></strong>, you can <strong>add the method <code>decode(&#39;utf8&#39;)</code> to the end</strong>.</li>
</ul>
</blockquote>
<p>Redis additionally offers methods for <strong>reading and writing parts of byte string values</strong> (integer and float values can also be accessed as though they’re byte strings, though that use is somewhat uncommon).</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Example use and description</th>
</tr>
</thead>
<tbody><tr>
<td><code>APPEND</code></td>
<td><code>APPEND key-name value</code> — Concatenates the provided value to the string already stored at the given key</td>
</tr>
<tr>
<td><code>GETRANGE</code></td>
<td><code>GETRANGE key-name start end</code> — Fetches the substring, including all characters from the start offset to the end offset, inclusive</td>
</tr>
<tr>
<td><code>SETRANGE</code></td>
<td><code>SETRANGE key-name offset value</code> — Sets the substring starting at the provided offset to the given value</td>
</tr>
<tr>
<td><code>GETBIT</code></td>
<td><code>GETBIT key-name offset</code> — Treats the byte string as a bit string, and returns the value of the bit in the string at the provided bit offset</td>
</tr>
<tr>
<td><code>SETBIT</code></td>
<td><code>SETBIT key-name offset value</code> — Treats the byte string as a bit string, and sets the value of the bit in the string at the provided bit offset</td>
</tr>
<tr>
<td><code>BITCOUNT</code></td>
<td><code>BITCOUNT key-name [start end]</code> — Counts the number of 1 bits in the string, optionally starting and finishing at the provided byte offsets</td>
</tr>
<tr>
<td><code>BITOP</code></td>
<td><code>BITOP operation dest-key key-name [key-name …]</code> — Performs one of the bitwise operations, AND, OR, XOR, or NOT, on the strings provided, storing the result in the destination key</td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.append(<span class="string">'new-string-key'</span>, <span class="string">'hello '</span>)  <span class="comment"># append the string ‘hello ’ to the previously nonexistent key </span></span><br><span class="line"><span class="number">6L</span>  <span class="comment"># When appending a value, Redis returns the length of the string so far.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.append(<span class="string">'new-string-key'</span>, <span class="string">'world!'</span>)</span><br><span class="line"><span class="number">12L</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.substr(<span class="string">'new-string-key'</span>, <span class="number">3</span>, <span class="number">7</span>)  <span class="comment"># Redis uses 0-indexing. It is inclusive of the endpoints by default.</span></span><br><span class="line"><span class="string">'lo wo'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.setrange(<span class="string">'new-string-key'</span>, <span class="number">0</span>, <span class="string">'H'</span>)  <span class="comment"># Sets the 0th char to 'H'</span></span><br><span class="line"><span class="number">12</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.setrange(<span class="string">'new-string-key'</span>, <span class="number">6</span>, <span class="string">'W'</span>)</span><br><span class="line"><span class="number">12</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.get(<span class="string">'new-string-key'</span>)</span><br><span class="line"><span class="string">'Hello World!'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.setrange(<span class="string">'new-string-key'</span>, <span class="number">11</span>, <span class="string">', how are you?'</span>)  <span class="comment"># With setrange, we can replace anywhere inside the string</span></span><br><span class="line">                                                           <span class="comment"># and we can make the string longer as a result</span></span><br><span class="line"><span class="number">25</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.get(<span class="string">'new-string-key'</span>)</span><br><span class="line"><span class="string">'Hello World, how are you?'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.setbit(<span class="string">'another-key'</span>, <span class="number">2</span>, <span class="number">1</span>)  <span class="comment"># If we write to a bit beyond the size of the string, it’s filled with 0s.</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.setbit(<span class="string">'another-key'</span>, <span class="number">7</span>, <span class="number">1</span>)</span><br><span class="line"><span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.get(<span class="string">'another-key'</span>)  <span class="comment"># If you want to interpret the bits stored in Redis</span></span><br><span class="line">                             <span class="comment"># you have 0010 0001, which is '!' in ASCII</span></span><br><span class="line"><span class="string">'!'</span></span><br></pre></td></tr></table></figure>

<h2 id="Lists-in-Redis"><a href="#Lists-in-Redis" class="headerlink" title="Lists in Redis"></a><code>List</code>s in Redis</h2><p>In this section, we’ll talk about <code>LIST</code>s, which store an ordered sequence of <code>STRING</code> values. This builds on from the section <a href="#List-Basics"><code>List</code>s in Redis - Basics</a>. We’ll cover some of the most commonly used <code>LIST</code> manipulation commands for pushing and popping items from <code>LIST</code>s. </p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Example use and description</th>
</tr>
</thead>
<tbody><tr>
<td><code>RPUSH</code></td>
<td><code>RPUSH key-name value [value …]</code> — Pushes the value(s) onto the <strong>right end</strong> of the list</td>
</tr>
<tr>
<td><code>LPUSH</code></td>
<td><code>LPUSH key-name value [value …]</code> — Pushes the value(s) onto the <strong>left end</strong> of the list</td>
</tr>
<tr>
<td><code>RPOP</code></td>
<td><code>RPOP key-name</code> — Removes and returns the <strong>rightmost</strong> item from the list</td>
</tr>
<tr>
<td><code>LPOP</code></td>
<td><code>LPOP key-name</code> — Removes and returns the <strong>leftmost</strong> item from the list</td>
</tr>
<tr>
<td><code>LINDEX</code></td>
<td><code>LINDEX key-name offset</code> — Returns the item at the given offset/index</td>
</tr>
<tr>
<td><code>LRANGE</code></td>
<td><code>LRANGE key-name start end</code> — Returns the items in the list at the offsets from start to end, <strong>inclusive</strong></td>
</tr>
<tr>
<td><code>LTRIM</code></td>
<td><code>LTRIM key-name start end</code> — Trims the list to <strong>only include items at indices between start and end</strong>, <strong>inclusive</strong></td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.rpush(<span class="string">'list-key'</span>, <span class="string">'last'</span>)</span><br><span class="line"><span class="number">1L</span>  <span class="comment"># When we push items onto the list, it returns the length of the list after the push has completed.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.lpush(<span class="string">'list-key'</span>, <span class="string">'first'</span>)</span><br><span class="line"><span class="number">2L</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.rpush(<span class="string">'list-key'</span>, <span class="string">'new last'</span>)</span><br><span class="line"><span class="number">3L</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.lrange(<span class="string">'list-key'</span>, <span class="number">0</span>, <span class="number">-1</span>)</span><br><span class="line">[<span class="string">'first'</span>, <span class="string">'last'</span>, <span class="string">'new last'</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.lpop(<span class="string">'list-key'</span>)</span><br><span class="line"><span class="string">'first'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.lpop(<span class="string">'list-key'</span>)</span><br><span class="line"><span class="string">'last'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.lrange(<span class="string">'list-key'</span>, <span class="number">0</span>, <span class="number">-1</span>)</span><br><span class="line">[<span class="string">'new last'</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.rpush(<span class="string">'list-key'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>)  <span class="comment"># We can push multiple items at the same time.</span></span><br><span class="line"><span class="number">4L</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.lrange(<span class="string">'list-key'</span>, <span class="number">0</span>, <span class="number">-1</span>)</span><br><span class="line">[<span class="string">'new last'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.ltrim(<span class="string">'list-key'</span>, <span class="number">2</span>, <span class="number">-1</span>)  <span class="comment"># Only keep elements from the 2nd position to the last</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.lrange(<span class="string">'list-key'</span>, <span class="number">0</span>, <span class="number">-1</span>)</span><br><span class="line">[<span class="string">'b'</span>, <span class="string">'c'</span>]</span><br></pre></td></tr></table></figure>

<p>Among the <code>LIST</code> commands we didn’t introduce before are a few commands that allow you to <strong>move items from one list to another</strong>, and even <strong>block while waiting for other clients to add items</strong> to <code>LIST</code>s. </p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Example use and description</th>
</tr>
</thead>
<tbody><tr>
<td><code>BLPOP</code></td>
<td><code>BLPOP key-name [key-name …] timeout</code> — Pops the leftmost item from the first non-empty LIST, or waits the timeout in seconds for an item</td>
</tr>
<tr>
<td><code>BRPOP</code></td>
<td><code>BRPOP key-name [key-name …] timeout</code> — Pops the rightmost item from the first non-empty LIST, or waits the timeout in seconds for an item</td>
</tr>
<tr>
<td><code>RPOPLPUSH</code></td>
<td><code>RPOPLPUSH source-key dest-key</code> — Pops the rightmost item from the source and LPUSHes the item to the destination, also returning the item to the user</td>
</tr>
<tr>
<td><code>BRPOPLPUSH</code></td>
<td><code>BRPOPLPUSH source-key dest-key timeout</code> — Pops the rightmost item from the source and LPUSHes the item to the destination, also returning the item to the user, and waiting up to the timeout if the source is empty</td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Let’s add some items to a couple of lists to start.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.rpush(<span class="string">'list'</span>, <span class="string">'item1'</span>)</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.rpush(<span class="string">'list'</span>, <span class="string">'item2'</span>)</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.rpush(<span class="string">'list2'</span>, <span class="string">'item3'</span>)</span><br><span class="line"><span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.brpoplpush(<span class="string">'list2'</span>, <span class="string">'list'</span>, <span class="number">1</span>)  <span class="comment"># move an item from one list to the other, also returning the item.</span></span><br><span class="line"><span class="string">'item3'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.brpoplpush(<span class="string">'list2'</span>, <span class="string">'list'</span>, <span class="number">1</span>)  <span class="comment"># When a list is empty, the blocking pop will stall for the timeout, </span></span><br><span class="line">                                         <span class="comment"># and return None (which isn’t displayed in the interactive console).</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.lrange(<span class="string">'list'</span>, <span class="number">0</span>, <span class="number">-1</span>)</span><br><span class="line">[<span class="string">'item3'</span>, <span class="string">'item1'</span>, <span class="string">'item2'</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.brpoplpush(<span class="string">'list'</span>, <span class="string">'list2'</span>, <span class="number">1</span>)</span><br><span class="line"><span class="string">'item2'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.blpop([<span class="string">'list'</span>, <span class="string">'list2'</span>], <span class="number">1</span>)</span><br><span class="line">(<span class="string">'list'</span>, <span class="string">'item3'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.blpop([<span class="string">'list'</span>, <span class="string">'list2'</span>], <span class="number">1</span>)</span><br><span class="line">(<span class="string">'list'</span>, <span class="string">'item1'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.blpop([<span class="string">'list'</span>, <span class="string">'list2'</span>], <span class="number">1</span>)</span><br><span class="line">(<span class="string">'list2'</span>, <span class="string">'item2'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.blpop([<span class="string">'list'</span>, <span class="string">'list2'</span>], <span class="number">1</span>) <span class="comment"># block for 1 second until this operation is completed</span></span><br><span class="line">(<span class="number">1.02</span>s)  </span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Sets-in-Redis"><a href="#Sets-in-Redis" class="headerlink" title="Sets in Redis"></a><code>Set</code>s in Redis</h2><p>In this section, we’ll discuss some of the most frequently used commands that operate on <code>SET</code>s. This builds on from the section <a href="#Set-Basics"><code>Set</code>s in Redis - Basics</a>. You’ll learn about the standard operations for inserting, removing, and moving members between <code>SET</code>s, as well as commands to perform intersection, union, and differences on <code>SET</code>s. </p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Example use and description</th>
</tr>
</thead>
<tbody><tr>
<td><code>SADD</code></td>
<td><code>SADD key-name item [item …]</code> — Adds the items to the set and returns the number of items added that weren’t already present</td>
</tr>
<tr>
<td><code>SREM</code></td>
<td><code>SREM key-name item [item …]</code> — Removes the items and returns the number of items that were removed</td>
</tr>
<tr>
<td><code>SISMEMBER</code></td>
<td><code>SISMEMBER key-name item</code> — Returns whether the item is in the SET</td>
</tr>
<tr>
<td><code>SCARD</code></td>
<td><code>SCARD key-name</code> — Returns the number of items in the SET</td>
</tr>
<tr>
<td><code>SMEMBERS</code></td>
<td><code>SMEMBERS key-name</code> — Returns all of the items in the SET as a Python set</td>
</tr>
<tr>
<td><code>SRANDMEMBER</code></td>
<td><code>SRANDMEMBER key-name [count]</code> — Returns one or more random items from the SET. When count is positive, Redis will return count distinct randomly chosen items, and when count is negative, Redis will return count randomly chosen items that may not be distinct.</td>
</tr>
<tr>
<td><code>SPOP</code></td>
<td><code>SPOP key-name</code> — Removes and returns a random item from the SET</td>
</tr>
<tr>
<td><code>SMOVE</code></td>
<td><code>SMOVE source-key dest-key item</code> — If the item is in the source, removes the item from the source and adds it to the destination, returning if the item was moved</td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.sadd(<span class="string">'set-key'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>)</span><br><span class="line"><span class="number">3</span>  <span class="comment"># Adding items to the SET returns the number of items that weren’t already in the SET.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.srem(<span class="string">'set-key'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.srem(<span class="string">'set-key'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>)</span><br><span class="line"><span class="literal">False</span>  <span class="comment"># Removing items from the SET returns whether an item was removed; </span></span><br><span class="line">       <span class="comment"># note that the client is buggy in that respect — Redis itself returns the total number of items removed.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.scard(<span class="string">'set-key'</span>)  <span class="comment"># We can get the number of items in the SET.</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.smembers(<span class="string">'set-key'</span>)</span><br><span class="line">set([<span class="string">'a'</span>, <span class="string">'b'</span>])</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.smove(<span class="string">'set-key'</span>, <span class="string">'set-key2'</span>, <span class="string">'a'</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.smove(<span class="string">'set-key'</span>, <span class="string">'set-key2'</span>, <span class="string">'c'</span>)</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.smembers(<span class="string">'set-key2'</span>)</span><br><span class="line">set([<span class="string">'a'</span>])</span><br></pre></td></tr></table></figure>

<h2 id="Hashes-in-Redis"><a href="#Hashes-in-Redis" class="headerlink" title="Hashes in Redis"></a><code>Hash</code>es in Redis</h2><p>In this section, we’ll talk about the most commonly used commands that manipulate <code>HASH</code>es. This builds on fro the section <a href="#Hash-Basics"><code>Hash</code>es in Redis - Basics</a>. You’ll learn more about the operations for adding and removing key-value pairs to <code>HASH</code>es, as well as commands to fetch all of the <code>HASH</code> contents along with the ability to increment or decrement values.</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Example use and description</th>
</tr>
</thead>
<tbody><tr>
<td><code>HMGET</code></td>
<td><code>HMGET key-name key [key …]</code> — Fetches the values at the fields/keys in the HASH</td>
</tr>
<tr>
<td><code>HMSET</code></td>
<td><code>HMSET key-name key value [key value …]</code> — Sets the values of the fields in the HASH</td>
</tr>
<tr>
<td><code>HDEL</code></td>
<td><code>HDEL key-name key [key …]</code> — Deletes the key-value pairs in the HASH, returning the number of pairs that were found and deleted</td>
</tr>
<tr>
<td><code>HLEN</code></td>
<td><code>HLEN key-name</code> — Returns the number of key-value pairs in the HASH</td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.hmset(<span class="string">'hash-key'</span>, &#123;<span class="string">'k1'</span>:<span class="string">'v1'</span>, <span class="string">'k2'</span>:<span class="string">'v2'</span>, <span class="string">'k3'</span>:<span class="string">'v3'</span>&#125;)</span><br><span class="line"><span class="literal">True</span>  <span class="comment"># We can add multiple items to the hash in one call.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.hmget(<span class="string">'hash-key'</span>, [<span class="string">'k2'</span>, <span class="string">'k3'</span>])</span><br><span class="line">[<span class="string">'v2'</span>, <span class="string">'v3'</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.hlen(<span class="string">'hash-key'</span>)</span><br><span class="line"><span class="number">3</span>  <span class="comment"># The HLEN command is typically used for debugging very large HASHes.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.hdel(<span class="string">'hash-key'</span>, <span class="string">'k1'</span>, <span class="string">'k3'</span>)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> The <code>HMGET</code>/<code>HMSET</code> commands are similar to their single-argument versions (<code>HSET</code>/<code>HGET</code>), only differing in that they <strong>take a list or dictionary for arguments</strong> instead of the single entries.</li>
</ul>
</blockquote>
<p>With the availability of <code>HGETALL</code>, it may not seem as though <code>HKEYS</code> and <code>HVALUES</code> would be that useful, but when you expect your values to be large, you can fetch the keys, and then get the values one by one to keep from blocking other requests.</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Example use and description</th>
</tr>
</thead>
<tbody><tr>
<td><code>HEXISTS</code></td>
<td><code>HEXISTS key-name key</code> — Returns whether the given key exists in the HASH</td>
</tr>
<tr>
<td><code>HKEYS</code></td>
<td><code>HKEYS key-name</code> — Fetches the keys in the HASH</td>
</tr>
<tr>
<td><code>HVALS</code></td>
<td><code>HVALS key-name</code> — Fetches the values in the HASH</td>
</tr>
<tr>
<td><code>HGETALL</code></td>
<td><code>HGETALL key-name</code> — Fetches all key-value pairs from the HASH</td>
</tr>
<tr>
<td><code>HINCRBY</code></td>
<td><code>HINCRBY key-name key increment</code> — Increments the value stored at the given key by the integer increment</td>
</tr>
<tr>
<td><code>HINCRBYFLOAT</code></td>
<td><code>HINCRBYFLOAT key-name key increment</code> — Increments the value stored at the given key by the float increment</td>
</tr>
</tbody></table>
<p><code>HINCRBY</code> and <code>HINCRBYFLOAT</code> should remind you of the <code>INCRBY</code> and <code>INCRBYFLOAT</code> operations available on <code>STRING</code> keys, and they have the same semantics, applied to <code>HASH</code> values.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.hmset(<span class="string">'hash-key2'</span>, &#123;<span class="string">'short'</span>:<span class="string">'hello'</span>, <span class="string">'long'</span>:<span class="number">1000</span>*<span class="string">'1'</span>&#125;)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.hkeys(<span class="string">'hash-key2'</span>)</span><br><span class="line">[<span class="string">'long'</span>, <span class="string">'short'</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.hexists(<span class="string">'hash-key2'</span>, <span class="string">'num'</span>)</span><br><span class="line"><span class="literal">False</span>  <span class="comment"># We can also check the existence of specific keys.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.hincrby(<span class="string">'hash-key2'</span>, <span class="string">'num'</span>)  <span class="comment"># Incrementing a previously nonexistent key in a hash behaves just like on strings; </span></span><br><span class="line">                                      <span class="comment"># Redis operates as though the value had been 0.</span></span><br><span class="line"><span class="number">1L</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.hexists(<span class="string">'hash-key2'</span>, <span class="string">'num'</span>)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>

<h2 id="ZSets-in-Redis"><a href="#ZSets-in-Redis" class="headerlink" title="ZSets in Redis"></a><code>ZSet</code>s in Redis</h2><p>In this section, we’ll talk about commands that operate on <code>ZSET</code>s. This builds on from the section <a href="#ZSet-Basics"><code>ZSet</code>s in Redis - Basics</a>. You’ll learn how to add and update items in <code>ZSET</code>s, as well as how to use the <code>ZSET</code> intersection and union commands.</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Example use and description</th>
</tr>
</thead>
<tbody><tr>
<td><code>ZADD</code></td>
<td><code>ZADD key-name score member [score member …]</code> — Adds members with the given scores to the ZSET</td>
</tr>
<tr>
<td><code>ZREM</code></td>
<td><code>ZREM key-name member [member …]</code> — Removes the members from the ZSET, returning the number of members that were removed</td>
</tr>
<tr>
<td><code>ZCARD</code></td>
<td><code>ZCARD key-name</code> — Returns the number of members in the ZSET</td>
</tr>
<tr>
<td><code>ZINCRBY</code></td>
<td><code>ZINCRBY key-name increment member</code> — Increments the member in the ZSET</td>
</tr>
<tr>
<td><code>ZCOUNT</code></td>
<td><code>ZCOUNT key-name min max</code> — Returns the <strong>number of members</strong> with <strong>scores between the provided minimum and maximum</strong></td>
</tr>
<tr>
<td><code>ZRANK</code></td>
<td><code>ZRANK key-name member</code> — Returns the <strong>position of the given member</strong> in the ZSET</td>
</tr>
<tr>
<td><code>ZSCORE</code></td>
<td><code>ZSCORE key-name member</code> — Returns the score of the member in the ZSET</td>
</tr>
<tr>
<td><code>ZRANGE</code></td>
<td><code>ZRANGE key-name start stop [WITHSCORES]</code> — Returns the members and optionally the scores for the <strong>members with ranks between start and stop</strong></td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.zadd(<span class="string">'zset-key'</span>, <span class="string">'a'</span>, <span class="number">3</span>, <span class="string">'b'</span>, <span class="number">2</span>, <span class="string">'c'</span>, <span class="number">1</span>)  <span class="comment"># Adding members to ZSETs in Python has the arguments </span></span><br><span class="line">                                                   <span class="comment"># reversed compared to standard Redis, which makes the order the same as HASHes.</span></span><br><span class="line"><span class="number">3</span>  </span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.zcard(<span class="string">'zset-key'</span>)</span><br><span class="line"><span class="number">3</span>  <span class="comment"># Knowing how large a ZSET is can tell us in some cases if it’s necessary to trim our ZSET.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.zincrby(<span class="string">'zset-key'</span>, <span class="string">'c'</span>, <span class="number">3</span>)</span><br><span class="line"><span class="number">4.0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.zscore(<span class="string">'zset-key'</span>, <span class="string">'b'</span>)</span><br><span class="line"><span class="number">2.0</span>  <span class="comment"># Fetching scores of individual members can be useful if we’ve been keeping counters or toplists.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.zrank(<span class="string">'zset-key'</span>, <span class="string">'c'</span>)</span><br><span class="line"><span class="number">2</span>  <span class="comment"># By fetching the 0-indexed position of a member, we can then later use ZRANGE to fetch a range of the values easily.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.zcount(<span class="string">'zset-key'</span>, <span class="number">0</span>, <span class="number">3</span>)</span><br><span class="line"><span class="number">2L</span>  <span class="comment"># Counting the number of items with a given range of scores can be quite useful for some tasks.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.zrem(<span class="string">'zset-key'</span>, <span class="string">'b'</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.zrange(<span class="string">'zset-key'</span>, <span class="number">0</span>, <span class="number">-1</span>, withscores=<span class="literal">True</span>)</span><br><span class="line">[(<span class="string">'a'</span>, <span class="number">3.0</span>), (<span class="string">'c'</span>, <span class="number">4.0</span>)]</span><br></pre></td></tr></table></figure>

<p>For <strong>debugging</strong>, we usually fetch the entire <code>ZSET</code> with this <code>ZRANGE</code> call, but real use cases will usually fetch items a relatively small group at a time.</p>
<p>Below shows several more <code>ZSET</code> commands in Redis that you’ll find useful.</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Example use and description</th>
</tr>
</thead>
<tbody><tr>
<td><code>ZREVRANK</code></td>
<td><code>ZREVRANK key-name member</code> — Returns the position of the member in the ZSET, with members ordered in reverse</td>
</tr>
<tr>
<td><code>ZREVRANGE</code></td>
<td><code>ZREVRANGE key-name start stop [WITHSCORES]</code> — Fetches the given members from the ZSET by rank, with members in reverse order</td>
</tr>
<tr>
<td><code>ZRANGEBYSCORE</code></td>
<td><code>ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT offset count]</code> — Fetches the <strong>members between min and max</strong></td>
</tr>
<tr>
<td><code>ZREVRANGEBYSCORE</code></td>
<td><code>ZREVRANGEBYSCORE key max min [WITHSCORES] [LIMIT offset count]</code> — Fetches the members in reverse order between min and max</td>
</tr>
<tr>
<td><code>ZREMRANGEBYRANK</code></td>
<td><code>ZREMRANGEBYRANK key-name start stop</code> — Removes the items from the ZSET with ranks between start and stop</td>
</tr>
<tr>
<td><code>ZREMRANGEBYSCORE</code></td>
<td><code>ZREMRANGEBYSCORE key-name min max</code> — Removes the items from the ZSET with scores between min and max</td>
</tr>
<tr>
<td><code>ZINTERSTORE</code></td>
<td><code>ZINTERSTORE dest-key key-count key [key …] [WEIGHTS weight [weight …]]</code> — Performs a SET-like intersection of the provided ZSETs</td>
</tr>
<tr>
<td><code>ZUNIONSTORE</code></td>
<td><code>ZUNIONSTORE dest-key key-count key [key …] [WEIGHTS weight [weight …]]</code> — Performs a SET-like union of the provided ZSETs</td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># We’ll start out by creating a couple of ZSETs.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.zadd(<span class="string">'zset-1'</span>, <span class="string">'a'</span>, <span class="number">1</span>, <span class="string">'b'</span>, <span class="number">2</span>, <span class="string">'c'</span>, <span class="number">3</span>)</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.zadd(<span class="string">'zset-2'</span>, <span class="string">'b'</span>, <span class="number">4</span>, <span class="string">'c'</span>, <span class="number">1</span>, <span class="string">'d'</span>, <span class="number">0</span>)</span><br><span class="line"><span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.zinterstore(<span class="string">'zset-i'</span>, [<span class="string">'zset-1'</span>, <span class="string">'zset-2'</span>])  <span class="comment"># When performing ZINTERSTORE or ZUNIONSTORE, our default aggregate is sum (which adds the value of the shared members)</span></span><br><span class="line"><span class="number">2L</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.zrange(<span class="string">'zset-i'</span>, <span class="number">0</span>, <span class="number">-1</span>, withscores=<span class="literal">True</span>)</span><br><span class="line">[(<span class="string">'c'</span>, <span class="number">4.0</span>), (<span class="string">'b'</span>, <span class="number">6.0</span>)]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.zunionstore(<span class="string">'zset-u'</span>, [<span class="string">'zset-1'</span>, <span class="string">'zset-2'</span>], aggregate=<span class="string">'min'</span>)  <span class="comment"># here we are using min, which selects the minimum of the shared members</span></span><br><span class="line"><span class="number">4L</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.zrange(<span class="string">'zset-u'</span>, <span class="number">0</span>, <span class="number">-1</span>, withscores=<span class="literal">True</span>)</span><br><span class="line">[(<span class="string">'d'</span>, <span class="number">0.0</span>), (<span class="string">'a'</span>, <span class="number">1.0</span>), (<span class="string">'c'</span>, <span class="number">1.0</span>), (<span class="string">'b'</span>, <span class="number">2.0</span>)]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.sadd(<span class="string">'set-1'</span>, <span class="string">'a'</span>, <span class="string">'d'</span>) </span><br><span class="line"><span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.zunionstore(<span class="string">'zset-u2'</span>, [<span class="string">'zset-1'</span>, <span class="string">'zset-2'</span>, <span class="string">'set-1'</span>]) </span><br><span class="line"><span class="number">4L</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.zrange(<span class="string">'zset-u2'</span>, <span class="number">0</span>, <span class="number">-1</span>, withscores=<span class="literal">True</span>)</span><br><span class="line">[(<span class="string">'d'</span>, <span class="number">1.0</span>), (<span class="string">'a'</span>, <span class="number">2.0</span>), (<span class="string">'c'</span>, <span class="number">4.0</span>), (<span class="string">'b'</span>, <span class="number">6.0</span>)]</span><br></pre></td></tr></table></figure>

<h2 id="Publish-Subscribe-in-Redis"><a href="#Publish-Subscribe-in-Redis" class="headerlink" title="Publish/Subscribe in Redis"></a><code>Publish</code>/<code>Subscribe</code> in Redis</h2><p> Generally, the concept of <code>publish</code>/<code>subscribe</code>, also known as <code>pub/sub</code>, is characterized by listeners subscribing to <code>channels</code>, with publishers sending binary string messages to <code>channels</code>. </p>
<ul>
<li>Anyone <strong>listening to a given channel will receive all messages sent to that channel</strong> while they’re connected and listening. You can think of it like a radio station, where subscribers can listen to multiple radio stations at the same time</li>
<li>Any publishers can <strong>send messages to a given channel</strong>, like being a radio station.</li>
</ul>
<table>
<thead>
<tr>
<th>Command</th>
<th>Example use and description</th>
</tr>
</thead>
<tbody><tr>
<td><code>SUBSCRIBE</code></td>
<td><code>SUBSCRIBE channel [channel …]</code> — Subscribes to the given channels</td>
</tr>
<tr>
<td><code>UNSUBSCRIBE</code></td>
<td><code>UNSUBSCRIBE [channel [channel …]]</code> — Unsubscribes from the provided channels, or unsubscribes all channels if no channel is given</td>
</tr>
<tr>
<td><code>PUBLISH</code></td>
<td><code>PUBLISH channel message</code> — Publishes a message to the given channel</td>
</tr>
<tr>
<td><code>PSUBSCRIBE</code></td>
<td><code>PSUBSCRIBE pattern [pattern …]</code> — Subscribes to messages broadcast to channels that match the given pattern</td>
</tr>
<tr>
<td><code>PUNSUBSCRIBE</code></td>
<td><code>PUNSUBSCRIBE [pattern [pattern …]]</code> — Unsubscribes from the provided patterns, or unsubscribes from all subscribed patterns if none are given</td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">publisher</span><span class="params">(n)</span>:</span></span><br><span class="line">	time.sleep(<span class="number">1</span>)  <span class="comment"># We sleep initially in the function to let the SUBSCRIBEr connect and start listening for messages.</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> xrange(n):</span><br><span class="line">				conn.publish(<span class="string">'channel'</span>, i)</span><br><span class="line">				time.sleep(<span class="number">1</span>)  <span class="comment"># After publishing, we’ll pause for a moment so that we can see this happen over time.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">run_pubsub</span><span class="params">()</span>:</span></span><br><span class="line">	threading.Thread(target=publisher, args=(<span class="number">3</span>,)).start()  <span class="comment"># start the publisher thread to send three messages.</span></span><br><span class="line"></span><br><span class="line">	pubsub = conn.pubsub()</span><br><span class="line">	pubsub.subscribe([<span class="string">'channel'</span>])  <span class="comment"># We’ll set up the pubsub object and subscribe to a channel.</span></span><br><span class="line"></span><br><span class="line">	count = <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> item <span class="keyword">in</span> pubsub.listen():  <span class="comment"># listen to subscription messages by iterating over the result of pubsub.listen().</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">print</span> item  <span class="comment"># print every message that we receive.</span></span><br><span class="line"></span><br><span class="line">		count += <span class="number">1</span></span><br><span class="line">		<span class="keyword">if</span> count == <span class="number">4</span>:  <span class="comment"># We’ll stop listening for new messages after the subscribe message and three real messages by unsubscribing.</span></span><br><span class="line">			pubsub.unsubscribe()</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>run_pubsub()  <span class="comment"># Actually run the functions to see them work.</span></span><br><span class="line"></span><br><span class="line">&#123;<span class="string">'pattern'</span>: <span class="literal">None</span>, <span class="string">'type'</span>: <span class="string">'subscribe'</span>, <span class="string">'channel'</span>: <span class="string">'channel'</span>, <span class="string">'data'</span>: <span class="number">1L</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># When subscribing, we receive a message on the channel.</span></span><br><span class="line"><span class="comment"># These are the structures that are produced as items when we iterate over pubsub.listen().</span></span><br><span class="line">&#123;<span class="string">'pattern'</span>: <span class="literal">None</span>, <span class="string">'type'</span>: <span class="string">'message'</span>, <span class="string">'channel'</span>: <span class="string">'channel'</span>, <span class="string">'data'</span>: <span class="string">'0'</span>&#125;</span><br><span class="line">&#123;<span class="string">'pattern'</span>: <span class="literal">None</span>, <span class="string">'type'</span>: <span class="string">'message'</span>, <span class="string">'channel'</span>: <span class="string">'channel'</span>, <span class="string">'data'</span>: <span class="string">'1'</span>&#125;</span><br><span class="line">&#123;<span class="string">'pattern'</span>: <span class="literal">None</span>, <span class="string">'type'</span>: <span class="string">'message'</span>, <span class="string">'channel'</span>: <span class="string">'channel'</span>, <span class="string">'data'</span>: <span class="string">'2'</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># When we unsubscribe, we receive a message telling us which channels we have unsubscribed from </span></span><br><span class="line"><span class="comment"># and also the number of channels we are still subscribed to.</span></span><br><span class="line">&#123;<span class="string">'pattern'</span>: <span class="literal">None</span>, <span class="string">'type'</span>: <span class="string">'unsubscribe'</span>, <span class="string">'channel'</span>: <span class="string">'channel'</span>, <span class="string">'data'</span>: <span class="number">0L</span>&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> But in the case of clients that have subscribed, <strong>if the client is disconnected and a message is sent before it can reconnect</strong>, the client will never see the message. When you’re relying on receiving messages over a channel, the semantics of <code>PUBLISH</code>/<code>SUBSCRIBE</code>in Redis may let you down.</li>
<li><input disabled type="checkbox"> However, there are different methods to handle reliable message delivery (you will see in a later section), which <strong>works in the face of network disconnections</strong>, and which won’t cause Redis memory to grow (even in older versions of Redis) unless you want it to.</li>
</ul>
</blockquote>
<h2 id="Operations-in-Redis-Sorting"><a href="#Operations-in-Redis-Sorting" class="headerlink" title="Operations in Redis - Sorting"></a>Operations in Redis - Sorting</h2><p>Sorting in Redis is similar to sorting in other languages: we want to <strong>take a sequence of items and order them according to some comparison between elements</strong>. <code>SORT</code> allows us to sort <code>LIST</code>s, <code>SET</code>s, and <code>ZSET</code>s according to data in the <code>LIST</code>/<code>SET</code>/<code>ZSET</code> data stored in <code>STRING</code> keys, or even data stored in <code>HASH</code>es. If you’re coming from a relational database background, <strong>you can think of <code>SORT</code> as like the <code>order by</code> clause in a SQL statement that can reference other rows and tables</strong>.</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Example use and description</th>
</tr>
</thead>
<tbody><tr>
<td><code>SORT</code></td>
<td><code>SORT source-key [BY pattern] [LIMIT offset count] [GET pattern [GET pattern …]] ...</code> — Sorts the input <code>LIST</code>, <code>SET</code>, or <code>ZSET</code> according to the options provided, and returns or stores the result</td>
</tr>
</tbody></table>
<p>Some of the more basic options with <code>SORT</code> include the ability to <strong>order the results in descending order rather than the default ascending order</strong>, consider <strong>items as though they were numbers</strong>, compare as though items were <strong>binary strings</strong>, and etc.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># Start by adding some items to a LIST.</span><br><span class="line">&gt;&gt;&gt; conn.rpush(&#39;sort-input&#39;, 23, 15, 110, 7)</span><br><span class="line">4</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; conn.sort(&#39;sort-input&#39;)  # We can sort the items numerically.</span><br><span class="line">[&#39;7&#39;, &#39;15&#39;, &#39;23&#39;, &#39;110&#39;]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; conn.sort(&#39;sort-input&#39;, alpha&#x3D;True)  # And we can sort the items alphabetically. In this case, sort each number character by character</span><br><span class="line">[&#39;110&#39;, &#39;15&#39;, &#39;23&#39;, &#39;7&#39;]  </span><br><span class="line"></span><br><span class="line"># Adding some additional data for SORTing and fetching.</span><br><span class="line">&gt;&gt;&gt; conn.hset(&#39;d-7&#39;, &#39;field&#39;, 5)</span><br><span class="line">1L</span><br><span class="line">&gt;&gt;&gt; conn.hset(&#39;d-15&#39;, &#39;field&#39;, 1)</span><br><span class="line">1L</span><br><span class="line">&gt;&gt;&gt; conn.hset(&#39;d-23&#39;, &#39;field&#39;, 9)</span><br><span class="line">1L</span><br><span class="line">&gt;&gt;&gt; conn.hset(&#39;d-110&#39;, &#39;field&#39;, 3)</span><br><span class="line">1L</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; conn.sort(&#39;sort-input&#39;, by&#x3D;&#39;d-*-&gt;field&#39;)  # We can sort our data by fields of HASHes.</span><br><span class="line">[&#39;15&#39;, &#39;110&#39;, &#39;7&#39;, &#39;23&#39;]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; conn.sort(&#39;sort-input&#39;, by&#x3D;&#39;d-*-&gt;field&#39;, get&#x3D;&#39;d-*-&gt;field&#39;)</span><br><span class="line">[&#39;1&#39;, &#39;3&#39;, &#39;5&#39;, &#39;9&#39;]</span><br></pre></td></tr></table></figure>

<p>Sorting can be used to sort <code>LIST</code>s, but it can also sort <code>SET</code>s, turning the result into a <code>LIST</code>.</p>
<p>Though <code>SORT</code> is the only command that can <strong>manipulate three types of data at the same time</strong>, <strong><a href="#Basic-Redis-Transactions">basic Redis transactions</a> can let you manipulate multiple data types with a series of commands without interruption</strong>.</p>
<p><a name="Basic-Redis-Transactions"></a></p>
<h2 id="Basic-Redis-Transactions"><a href="#Basic-Redis-Transactions" class="headerlink" title="Basic Redis Transactions"></a>Basic Redis Transactions</h2><p>Though there are a few commands to copy or move items between keys, there <strong>isn’t a single command to move items between types (though you can copy from a <code>SET</code> to a <code>ZSET</code> with <code>ZUNIONSTORE</code>)</strong>. For operations involving multiple keys (of the same or different types), Redis has five commands that help us operate on multiple keys without interruption: <code>WATCH</code>, <code>MULTI</code>, <code>EXEC</code>, <code>UNWATCH</code>, and <code>DISCARD</code>.</p>
<p>In Redis, a basic transaction involving MULTI and EXEC is meant to provide the opportunity for one client to execute multiple commands A, B, C, … without other clients being able to interrupt them. This isn’t the same as a relational database transaction, which can be executed partially, and then rolled back or committed. In Redis, every command passed as part of a basic MULTI/EXEC transaction is executed one after another until they’ve completed. After they’ve completed, other clients may execute their commands.</p>
<p><strong>To perform a transaction in Redis</strong>, we first call <code>MULTI</code>, followed by any sequence of commands we intend to execute, <strong>followed by <code>EXEC</code></strong>. When seeing <code>MULTI</code>, Redis will queue up commands from that same connection until it sees an <code>EXEC</code>, at which point Redis will execute the queued commands sequentially without interruption.</p>
<p>For example, in a <code>redis-cli</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get hello</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; set hello no</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; exec</span><br><span class="line">1) &quot;worldanother-world&quot;</span><br><span class="line">2) OK</span><br><span class="line">127.0.0.1:6379&gt; get hello</span><br><span class="line">&quot;no&quot;</span><br></pre></td></tr></table></figure>

<p>Semantically, <strong><code>Python library</code> handles this by the use of what’s called a <code>pipeline</code></strong>. Calling the <code>pipeline()</code> method on a connection object will create a transaction, which <strong>when used correctly will automatically wrap a sequence of commands with <code>MULTI</code> and <code>EXEC</code></strong>. Incidentally, the Python Redis client will also <strong>store the commands to send until we actually want to send them</strong>. This reduces the number of round trips between Redis and the client, which can improve the performance of a sequence of commands.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">trans</span><span class="params">()</span>:</span></span><br><span class="line">        pipeline = conn.pipeline()</span><br><span class="line">        pipeline.incr(<span class="string">"trans"</span>)</span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line">        pipeline.incr(<span class="string">"trans"</span>,<span class="number">-1</span>)</span><br><span class="line">        print(pipeline.execute())</span><br><span class="line">		<span class="comment"># this in the end has the same effect of MULTI ... and then EXEC</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">        conn = redis.Redis(host=<span class="string">'cust-redis'</span>,port=<span class="number">6379</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">                threading.Thread(target=trans).start()</span><br></pre></td></tr></table></figure>
<p>Now, notice that by using a <strong>transaction</strong>, <strong>each thread is able to execute its entire sequence of commands without other threads interrupting it</strong> (as otherwise one of them might print <code>1</code> instead of <code>0</code>), despite the delay between the two calls.</p>
<p>Basically, you can think of this as having the <strong>same effect as <code>synchrnoized</code> keyword in Java</strong>, so that this <strong>transaction is locked once one thread enters</strong>.</p>
<h2 id="Key-Expiration"><a href="#Key-Expiration" class="headerlink" title="Key Expiration"></a>Key Expiration</h2><p>When we say that a key has a time to live, or that it’ll expire at a given time, we mean that <strong>Redis will automatically delete the key when its expiration time has arrived</strong>.</p>
<p>Having keys that will expire after a certain amount of time can be useful to handle the <strong>cleanup of cached data</strong>. If you look through other chapters, you won’t see the use of key expiration in Redis often. This is mostly due to the types of structures that are used; <strong>few of the commands we use offer the ability to set the expiration time of a key automatically</strong>. And <strong>with containers</strong> (<code>LIST</code>s, <code>SET</code>s, <code>HASH</code>es, and <code>ZSET</code>s), we can <strong>only expire entire keys</strong>, <strong>not individual items</strong> (this is also why we use <code>ZSET</code>s with timestamps in a few places).</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Example use and description</th>
</tr>
</thead>
<tbody><tr>
<td><code>PERSIST</code></td>
<td><code>PERSIST key-name</code> — <strong>Removes the expiration</strong> from a key</td>
</tr>
<tr>
<td><code>TTL</code></td>
<td><code>TTL key-name</code> — Returns the <strong>amount of time remaining</strong> before a key will expire</td>
</tr>
<tr>
<td><code>EXPIRE</code></td>
<td><code>EXPIRE key-name seconds</code> — Sets the key to <strong>expire in the given number of seconds</strong></td>
</tr>
<tr>
<td><code>EXPIREAT</code></td>
<td><code>EXPIREAT key-name timestamp</code> — Sets the <strong>expiration time as the given Unix timestamp</strong></td>
</tr>
<tr>
<td><code>PTTL</code></td>
<td><code>PTTL key-name</code> — Returns the <strong>number of milliseconds before the key will expire</strong> (available in Redis 2.6 and later)</td>
</tr>
<tr>
<td><code>PEXPIRE</code></td>
<td><code>PEXPIRE key-name milliseconds</code> — Sets the key to <strong>expire in the given number of milliseconds</strong> (available in Redis 2.6 and later)</td>
</tr>
<tr>
<td><code>PEXPIREAT</code></td>
<td><code>PEXPIREAT key-name timestamp-milliseconds</code> — Sets the <strong>expiration time to be the given Unix timestamp specified in milliseconds</strong> (available in Redis 2.6 and later)</td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># We’re starting with a very simple STRING value.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.set(<span class="string">'key'</span>, <span class="string">'value'</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.get(<span class="string">'key'</span>)</span><br><span class="line"><span class="string">'value'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.expire(<span class="string">'key'</span>, <span class="number">2</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>time.sleep(<span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.get(<span class="string">'key'</span>)  <span class="comment"># it’s already been deleted.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.set(<span class="string">'key'</span>, <span class="string">'value2'</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.expire(<span class="string">'key'</span>, <span class="number">100</span>); conn.ttl(<span class="string">'key'</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="number">100</span></span><br></pre></td></tr></table></figure>

<h2 id="Persistence-in-Redis-Snapshot"><a href="#Persistence-in-Redis-Snapshot" class="headerlink" title="Persistence in Redis - Snapshot"></a>Persistence in Redis - Snapshot</h2><p>In Redis, we can create a <strong>point-in-time copy of in-memory data by creating a snapshot</strong>. After creation, these snapshots can be backed up, copied to other servers to create a clone of the server, or left for a future restart.</p>
<p>On the configuration side of things, <strong>snapshots are written to the file referenced as <code>dbfilename</code></strong> in the configuration, and <strong>stored in the path referenced as <code>dir</code></strong>. Until the next snapshot is performed, data written to Redis since the last snapshot started (and completed) would be lost if there were a crash caused by Redis, the system, or the hardware.</p>
<p>As an example, say that we have Redis running with 10 gigabytes of data currently in memory. <strong>A previous snapshot</strong> had been started at <strong>2:35 p.m. and had finished</strong>. Now <strong>a snapshot is started at 3:06 p.m.</strong>, and <strong>35 keys are updated before</strong> the snapshot completes at 3:08 p.m. If some part of the system were to <strong>crash and prevent Redis</strong> from completing its snapshot operation <strong>between 3:06 p.m. and 3:08 p.m.</strong>, <strong>any data written between 2:35 p.m. and now would be lost</strong>. But if the system were to <strong>crash just after</strong> the snapshot had completed, then only the updates to those <strong>35 keys would be lost</strong> (so that the snapshot only includes data at the point of initiation, at 3:06 p.m.).</p>
<p>There are <strong>five methods to initiate a snapshot</strong>, which are listed as follows:</p>
<ul>
<li>Any Redis client can <strong>initiate a snapshot by calling the <code>BGSAVE</code> command</strong>. On platforms that support <code>BGSAVE</code> (basically all platforms except for Windows), Redis will fork, 1 and the <strong>child process will write the snapshot to disk while the parent process continues to respond to commands</strong>.<ul>
<li><strong>When a process forks</strong>, the underlying operating system makes a copy of the process. On Unix and Unix-like systems, the copying process is optimized such that, initially, all memory is shared between the child and parent processes. When either the parent or child process writes to memory, that memory will stop being shared.</li>
</ul>
</li>
<li>A Redis client can also <strong>initiate a snapshot by calling the <code>SAVE</code> command</strong>, which causes Redis to <strong>stop responding to any/all commands until the snapshot completes</strong>. This command isn’t commonly used, except in situations where we need our data on disk, and either we’re okay waiting for it to complete, or we don’t have enough memory for a BGSAVE.</li>
<li>If Redis is configured with <strong><code>save</code> lines, such as <code>save 60 10000</code></strong>, Redis will automatically trigger a <strong><code>BGSAVE</code> operation if 10,000 writes have occurred after 60 seconds since the last successful save has started</strong> (using the configuration option described). When <strong>multiple <code>save</code></strong> lines are present, any time <strong>one of the rules match, a <code>BGSAVE</code> is triggered</strong>.</li>
<li>When Redis receives a request to <strong>shut down by the <code>SHUTDOWN</code> command</strong>, or it receives a <strong>standard <code>TERM</code> signal</strong>, Redis will perform a <strong><code>SAVE</code>, blocking clients from performing any further commands</strong>, and then shut down.</li>
<li>If a Redis server <strong>connects to another Redis server and issues the <code>SYNC</code> command to begin replication</strong>, the <strong>master Redis server will start a <code>BGSAVE</code> operation</strong> if one isn’t already executing or recently completed.</li>
</ul>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> There are two ways to do the above configuration for <code>redis</code>. One is to use the <code>config set &lt;value&gt;</code> command. The other is to change the <code>redis.conf</code> file, which should be under <code>/usr/local/etc/redis/redis.conf</code>.</li>
<li><input disabled type="checkbox"> For <code>docker</code> users, if that file does not exist, you might need to manually create one and mount that directory.</li>
</ul>
</blockquote>
<p>However, as mentioned before, if a system crashes while you are doing a <code>snapshot</code>, data will be lost. Then the question becomes how to <strong>recover it</strong>. Suppose you are processing log files, and the system crashes before you are diong a dump. Then, in order to recover from it, you need to find a way to first know what has been lost, in other words, you need to somehow <strong>track your progress:</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process_logs</span><span class="params">(conn, path, callback)</span>:</span>  <span class="comment"># the callback function will be used to process the log line</span></span><br><span class="line"></span><br><span class="line">   current_file, offset = conn.mget(  <span class="comment"># mget is multiple get</span></span><br><span class="line">      <span class="string">'progress:file'</span>, <span class="string">'progress:position'</span>)  <span class="comment"># Get the current progress.</span></span><br><span class="line"></span><br><span class="line">   pipe = conn.pipeline()</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">update_progress</span><span class="params">()</span>:</span>  <span class="comment"># this is used later to update the line number</span></span><br><span class="line"></span><br><span class="line">      pipe.mset(&#123;</span><br><span class="line">         <span class="string">'progress:file'</span>: fname,</span><br><span class="line">         <span class="string">'progress:position'</span>: offset</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      pipe.execute()</span><br><span class="line"></span><br><span class="line">   <span class="keyword">for</span> fname <span class="keyword">in</span> sorted(os.listdir(path)):  <span class="comment"># Iterate over the log files in sorted order.</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> fname &lt; current_file:  <span class="comment"># Skip over files that are before the current file.</span></span><br><span class="line">         <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">      inp = open(os.path.join(path, fname), <span class="string">'rb'</span>)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> fname == current_file:</span><br><span class="line">         inp.seek(int(offset, <span class="number">10</span>))  <span class="comment"># If we’re continuing a file, skip over the parts that we’ve</span></span><br><span class="line">								    <span class="comment"># already processed.</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">else</span>:</span><br><span class="line">         offset = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">      current_file = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> lno, line <span class="keyword">in</span> enumerate(inp):</span><br><span class="line"></span><br><span class="line">         callback(pipe, line)  <span class="comment"># Process/handle the log line.</span></span><br><span class="line"></span><br><span class="line">         offset = int(offset) + len(line)  <span class="comment"># Update our information about the offset into the file.</span></span><br><span class="line"></span><br><span class="line">         <span class="keyword">if</span> <span class="keyword">not</span> (lno+<span class="number">1</span>) % <span class="number">1000</span>:</span><br><span class="line">            update_progress()  <span class="comment"># updates the progress information for every 1000 actual updates</span></span><br><span class="line">      </span><br><span class="line">	  update_progress()  <span class="comment">#update again when we are done with the file</span></span><br><span class="line"></span><br><span class="line">      inp.close()</span><br></pre></td></tr></table></figure>

<p><strong>Deciding whether to use <code>BGSAVE</code> or <code>SAVE</code></strong></p>
<p>When the amount of data that we store in Redis tends to be under a few gigabytes, snapshotting with <code>BGSAVE</code> can be the right answer. <strong>Redis will fork, save to disk, and finish the snapshot faster than you can read this sentence</strong>. But as our Redis memory use grows over time, <strong>so does the time to perform a fork operation for the <code>BGSAVE</code></strong>. In situations where Redis is using tens of gigabytes of memory, there isn’t a lot of free memory, or if we’re running on a virtual machine, letting a BGSAVE occur may cause the system to pause for extended periods of time.</p>
<p>To <strong>prevent forking from causing such issues</strong>, we may want to disable automatic saving entirely. When automatic saving is disabled, we then need to <strong>manually call <code>BGSAVE</code></strong> (which has all of the same potential issues as  before, only now we know when they will happen), <strong>or we can call <code>SAVE</code></strong>. <strong>With <code>SAVE</code>, Redis does block until the save is completed,</strong> but because there’s <strong>no fork</strong>, there’s <strong>no fork delay</strong>. And because Redis doesn’t have to fight with itself for resources, the <strong>snapshot will finish faster</strong>.</p>
<p>For example, when trying to <strong>use <code>BGSAVE</code></strong> with clients writing to Redis with data of about <strong>50 gigabytes</strong>, <strong>forking would take 15 seconds or more</strong>, followed by <strong>15–20 minutes for the snapshot to complete</strong>. But <strong>with <code>SAVE</code>, the snapshot would finish in 3–5 minutes</strong>.</p>
<h2 id="Persistence-in-Redis-Append-only-file"><a href="#Persistence-in-Redis-Append-only-file" class="headerlink" title="Persistence in Redis - Append-only file"></a>Persistence in Redis - Append-only file</h2><p>In basic terms, <strong>append-only log files keep a record of data changes</strong> that occur by <strong>writing each change to the end of the file</strong>. In doing this, anyone could recover the entire dataset by replaying the append-only log from the beginning to the end. Redis has functionality that does this as well, and it’s enabled by setting the configuration option <code>appendonly yes</code>.</p>
<p>You also have several options to configuring syncing and writing the append-only file to disk. <strong>When that sync is completed</strong>, we can be fairly certain that <strong>our data is on disk and we can read it later if the system  otherwise fails</strong>.</p>
<table>
<thead>
<tr>
<th><code>appendfsync</code> Option</th>
<th>How often syncing will occur</th>
</tr>
</thead>
<tbody><tr>
<td><code>always</code></td>
<td><strong>Every write command to Redis results in a write to disk</strong>. This slows Redis down substantially if used.</td>
</tr>
<tr>
<td><code>everysec</code></td>
<td><strong>Once per second</strong>, explicitly syncs write commands to disk.</td>
</tr>
<tr>
<td><code>no</code></td>
<td>Lets the operating system control syncing to disk.</td>
</tr>
</tbody></table>
<hr>
<p><strong>Warning:</strong></p>
<p>You’ll want to be careful if you’re using SSDs with <code>appendfsync always</code>. Writing every change to disk as they happen, instead of letting the operating system group writes together as is the case with the other  <code>appendfsync</code> options, has the <strong>potential to cause an extreme form of what is known as write amplification</strong>. By writing small amounts of data to the end of a file, you can <strong>reduce the lifetime of SSDs from years to just a few months in some cases</strong>.</p>
<hr>
<p>As a reasonable compromise between keeping data safe and keeping our write performance high, we can also set <code>appendfsync everysec</code>. This configuration will <strong>sync the append-only log once every second</strong>. For most common uses, we’ll likely not find significant performance penalties for syncing to disk every second compared to not using any sort of persistence. By syncing to disk every second, if the system were to crash, we could lose at most one second of data that had been written or updated in Redis. Also, in the case where the disk is unable to keep up with the write volume that’s happening, Redis would gracefully slow down to accommodate the maximum write rate of the drive.</p>
<p>Append-only files are flexible, offering a variety of options to ensure that almost every level of paranoia can be addressed. <strong>But there’s a dark side to AOF persistence, and that is file size.</strong></p>
<h3 id="Configuring-Compacting-your-Append-only-Files"><a href="#Configuring-Compacting-your-Append-only-Files" class="headerlink" title="Configuring/Compacting your Append-only Files"></a>Configuring/Compacting your Append-only Files</h3><p>If using <code>AOF</code> would make data loss to one second of work (for example, <code>appendfsync everysecond</code>), then why do we want to use <code>Snapshots</code> in general? Isn’t the choice clear that we would want to use <code>AOF</code> almost always? In reality, <strong>the choice is actually not so simple</strong>: because <strong>every write to Redis causes a log of the command to be written to disk, the append-only log file will continuously grow</strong>. Over time, a growing AOF could cause your disk to run out of space, <strong>but more commonly, upon restart, Redis will be executing every command in the AOF in order. When handling large AOFs, Redis can take a very long time to start up.</strong></p>
<p>One solution is to use <code>BGREWRITEAOF</code>, which will <strong>rewrite the AOF to be as short as possible by removing redundant commands</strong>. <code>BGREWRITEAOF</code> works <strong>similarly to the snapshotting <code>BGSAVE</code></strong>: performing a fork and subsequently rewriting the append-only log in the child. As such, <strong>all of the same limitations with snapshotting performance regarding fork time, memory use, and so on still stand when using append-only files</strong>. But even worse, because <code>AOF</code>s can grow to be many times the size of a dump (if left uncontrolled), when the <code>AOF</code> is rewritten, the OS needs to delete the <code>AOF</code>, which can cause the system to hang for multiple seconds while it’s deleting an <code>AOF</code> of tens of gigabytes.</p>
<p>There are also <strong>two configuration options that enable and customize the automatic <code>BGREWRITEAOF</code> execution</strong>: </p>
<ul>
<li><code>auto-aof-rewrite-percentage</code> </li>
<li><code>auto-aof-rewrite-min-size</code></li>
</ul>
<p>For example, if we use <code>auto-aof-rewritepercentage 100</code> and <code>auto-aof-rewrite-min-size 64mb</code>, when <code>AOF</code> is enabled, Redis will <strong>initiate a BGREWRITEAOF when the <code>AOF</code> is at least 100% larger than it was when Redis last finished rewriting the AOF</strong>, <strong><em>and</em></strong> <strong>when the <code>AOF</code> is at least 64 megabytes in size</strong>. As a point of configuration, if our <code>AOF</code> is rewriting too often, we can increase the <code>100</code> that represents <code>100%</code> to something larger, though it will cause Redis to take longer to start up if it has been a while since a rewrite happened.</p>
<h2 id="Replication"><a href="#Replication" class="headerlink" title="Replication"></a>Replication</h2><p>Replication is a method by which other <strong>servers receive a continuously updated copy of the data as the main server is being written</strong>, so that the replicas can service read queries. In the relational database world, it’s not uncommon for <strong>a single <code>master</code> database to send writes out to multiple <code>slave</code>s, with the <code>slave</code>s performing all of the read queries</strong>. Redis has adopted this method of replication as a way of helping to scale, and this section will discuss configuring replication in Redis, and how Redis operates during replication.</p>
<p>With a <code>master</code>/<code>slave</code> setup, instead of connecting to the <code>master</code> for reading data, <strong>clients will connect to one of the <code>slave</code>s to read their data</strong> (typically choosing them in a random fashion to try to balance the load).</p>
<h3 id="Configuring-Master-and-Slave-Server"><a href="#Configuring-Master-and-Slave-Server" class="headerlink" title="Configuring Master and Slave Server"></a>Configuring Master and Slave Server</h3><ul>
<li><p>To configure replication on the <code>master</code> side of things, we <strong>only need to ensure that the path and filename listed under the <code>dir</code> and <code>dbfilename</code> configuration options</strong> shown below are to a path and file that are <strong>writable by the Redis process</strong>.</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># inside the redis.conf file</span><br><span class="line"></span><br><span class="line">dbfilename dump.rdb  # also the default</span><br><span class="line">dir .&#x2F;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Though a variety of options control behavior of the <code>slave</code> itself, <strong>only one option is really necessary to enable slaving: <code>slaveof</code></strong>. If we were to <strong>set <code>slaveof host port</code> in our configuration file</strong>, the Redis that’s started with that configuration will use the provided host and port as the <code>master</code> Redis server it should connect to. If we have <strong>an already running system</strong>, we can tell a Redis server to stop slaving, or even to slave to a new or different master. <strong>To connect to a new <code>master</code>, we can use the <code>SLAVEOF host port</code> command</strong>, or if we want to <strong>stop updating data from the master, we can use <code>SLAVEOF no one</code>.</strong></p>
</li>
</ul>
<h3 id="Master-Slave-startup-process"><a href="#Master-Slave-startup-process" class="headerlink" title="Master/Slave startup process"></a><code>Master</code>/<code>Slave</code> startup process</h3><p>These are the operations that occur on both the <code>master</code> and <code>slave</code> when a <code>slave</code> connects to a <code>master</code>.</p>
<table>
<thead>
<tr>
<th>Step</th>
<th>Master operations</th>
<th>Slave operations</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>(waiting for a command)</td>
<td>(Re-)connects to the <code>master</code>; issues the <code>SYNC</code> command</td>
</tr>
<tr>
<td>2</td>
<td>Starts <code>BGSAVE</code> operation; <strong>keeps a backlog of all write commands sent after</strong> <code>BGSAVE</code></td>
<td>Serves old data (if any), or returns errors to commands (depending on configuration)</td>
</tr>
<tr>
<td>3</td>
<td>Finishes <code>BGSAVE</code>; starts sending the snapshot to the slave; continues holding a backlog of write commands</td>
<td><strong>Discards all old data</strong> (if any); starts loading the dump as it’s received</td>
</tr>
<tr>
<td>4</td>
<td>Finishes sending the snapshot to the slave; <strong>starts sending the write command backlog</strong> to the slave</td>
<td>Finishes parsing the dump; starts responding to commands normally again</td>
</tr>
<tr>
<td>5</td>
<td>Finishes sending the backlog; starts live streaming of write commands as they happen</td>
<td>Finishes executing backlog of write commands from the master; continues executing commands as they happen</td>
</tr>
</tbody></table>
<p>So, Redis manages to keep up with most loads during replication, <strong>except in cases where network bandwidth between the <code>master</code> and <code>slave</code> instances isn’t fast enough</strong>, or when the <strong><code>master</code> doesn’t have enough memory to fork and keep a backlog of write commands</strong>. Though it isn’t necessary, it’s generally considered to be a <strong>good practice to have Redis masters only use about 50–65% of the memory in our system</strong>, leaving approximately 30–45% for spare memory during <code>BGSAVE</code> and command backlogs.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Just to make sure that we’re all on the same page (some users forget this the first time they try  using <code>slave</code>s): <strong>when a <code>slave</code> initially connects to a <code>master</code>, any data that had been in memory will be lost, to be replaced by the data coming from the <code>master</code>.</strong></li>
</ul>
</blockquote>
<p>But what happens when you have more than one <code>slave</code>? When another <code>slave</code> connects to an existing master, sometimes it can reuse an existing dump file (if there is). In general, <strong>only one of the two scenario will happen</strong>:</p>
<table>
<thead>
<tr>
<th>When additional slaves connect</th>
<th>Master operation</th>
</tr>
</thead>
<tbody><tr>
<td>Before step 3 in table above</td>
<td>All slaves will receive the same dump and same backlogged write commands.</td>
</tr>
<tr>
<td>On or after step 3 in table above</td>
<td>While the master is finishing up the five steps for earlier slaves, a new sequence of steps 1-5 will start for the new slave(s).</td>
</tr>
</tbody></table>
<h3 id="Master-Slave-Chain"><a href="#Master-Slave-Chain" class="headerlink" title="Master/Slave Chain"></a><code>Master</code>/<code>Slave</code> Chain</h3><p>Some developers have found that when they need to <strong>replicate to more than a handful of <code>slave</code>s</strong>, some networks are unable to keep up — especially when replication is being performed over the internet or between data centers. Because there’s nothing particularly special about being a <code>master</code> or a <code>slave</code> in Redis, <strong><code>slave</code>s can have their own <code>slave</code>s, resulting in <code>master</code>/<code>slave</code> chaining</strong>.</p>
<p>In general, <strong>when read load significantly outweighs write load, and when the number of reads pushes well beyond what a single Redis server can handle</strong>, it’s common to keep <strong>adding <code>slave</code>s to help deal with the load</strong>. As load continues to increase, we can run into situations where the single <code>master</code> can’t write to all of its <code>slave</code>s fast enough, or is overloaded with <code>slave</code>s reconnecting and resyncing. To alleviate such issues, we may want to set up a layer of intermediate Redis <code>master</code>/<code>slave</code> nodes:</p>
<p><img src="/.com//06/02/Redis-Manual/master-slave-chain.png" alt="Picture from https://redislabs.com/ebook/part-2-core-concepts/chapter-4-keeping-data-safe-and-ensuring-performance/4-2-replication/4-2-3-masterslave-chains/" title="Picture from https://redislabs.com/ebook/part-2-core-concepts/chapter-4-keeping-data-safe-and-ensuring-performance/4-2-replication/4-2-3-masterslave-chains/"></p>
<h3 id="Verifying-Disk-Writes"><a href="#Verifying-Disk-Writes" class="headerlink" title="Verifying Disk Writes"></a>Verifying Disk Writes</h3><p>Verifying that the <strong>data we wrote to the <code>master</code> made it to the <code>slave</code> is easy</strong>: we merely need to write a unique dummy value after our important data, and then check for it on the slave. <strong>But verifying that the data made it to disk is more difficult</strong>. If we wait at least one second, we know that our data made it to disk. But if we’re careful, we may be able to <strong>wait less time by checking the output of <code>INFO</code> for the value of <code>aof_pending_bio_fsync</code></strong>, which will be <strong><code>0</code> if all data that the server knows about has been written to disk</strong>.</p>
<p>Now, if we know this, we could write a program to automate the check for us:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">def wait_for_sync(mconn, sconn):</span><br><span class="line">   identifier &#x3D; str(uuid.uuid4())</span><br><span class="line"></span><br><span class="line">   time &#x3D; time.time()</span><br><span class="line">   mconn.zadd(&#39;sync:wait&#39;, identifier, time)  # Add a token to the master to verify slave data later</span><br><span class="line"></span><br><span class="line">   while not sconn.INFO()[&#39;master_link_status&#39;] !&#x3D; &#39;up&#39;:  # Wait for the slave to sync (if necessary).</span><br><span class="line"></span><br><span class="line">      time.sleep(.001)</span><br><span class="line"></span><br><span class="line">   while sconn.zscore(&#39;sync:wait&#39;, identifier) !&#x3D; time:  # Wait for the slave to receive the data change.</span><br><span class="line"></span><br><span class="line">      time.sleep(.001)</span><br><span class="line"></span><br><span class="line">   deadline &#x3D; time.time() + 1.01</span><br><span class="line"></span><br><span class="line">   while time.time() &lt; deadline:  # Loops up to one second. </span><br><span class="line">			                      # After a second, the AOF will be completed anyway</span><br><span class="line"></span><br><span class="line">      if sconn.INFO()[&#39;aof_pending_bio_fsync&#39;] &#x3D;&#x3D; 0:  # Check to see if the data is known to be on disk.</span><br><span class="line">         break</span><br><span class="line"></span><br><span class="line">      time.sleep(.001)</span><br><span class="line"></span><br><span class="line">   mconn.zrem(&#39;sync:wait&#39;, identifier)</span><br><span class="line">   mconn.zremrangebyscore(&#39;sync:wait&#39;, 0, time.time()-900)  # Clean up our status by </span><br><span class="line">															# cleaning out older entries that may have been left there</span><br></pre></td></tr></table></figure>
<p>Here we see the use of the <code>INFO</code> command. In general, the <code>INFO</code> command can offer a wide range of information about the current status of a Redis server—memory used, the number of connected clients, the number of keys in each database, the number of commands executed since the last snapshot, and more. <strong>Generally speaking, <code>INFO</code>is a good source of information about the general state of our Redis servers, and many resources online can explain more.</strong></p>
<h2 id="Fixing-Snapshots-and-AOFs"><a href="#Fixing-Snapshots-and-AOFs" class="headerlink" title="Fixing Snapshots and AOFs"></a>Fixing <code>Snapshot</code>s and <code>AOF</code>s</h2><p>We have covered how to replicate to handle <code>redis</code> data storage. However, we have not yet covered how to <strong>fix the <code>Dump</code>s or the <code>AOF</code>s themselves if there is a system failure</strong>.</p>
<p>When confronted with system failures, we have tools to help us recover when either <code>snapshotting</code> or <code>append-only file</code> logging had been enabled. Redis includes <strong>two command-line applications for testing the status of a <code>snapshot</code> and an <code>append-only file</code>.</strong> These commands are <code>redis-check-aof</code> and <code>redis-check-dump</code>. If we run either command without arguments (<strong>not in the <code>redis-cli</code>, but in command-line</strong>), we’ll see the basic help that’s provided:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ redis-check-aof</span><br><span class="line">Usage: redis-check-aof [--fix] &lt;file.aof&gt;</span><br><span class="line">$ redis-check-dump</span><br><span class="line">Usage: redis-check-dump &lt;dump.rdb&gt;</span><br><span class="line">$</span><br></pre></td></tr></table></figure>

<ul>
<li><p>If we <strong>provide <code>–fix</code> as an argument to <code>redis-check-aof</code>, the command will fix the file</strong>. Its method to fix an <code>append-only file</code> is simple: <strong>it scans through the provided <code>AOF</code>, looking for an incomplete or incorrect command</strong>. Upon finding the <strong>first bad command, it trims the file to just before that command would’ve been executed</strong>. For most situations, this will discard the last partial write command. However, <strong>it is possible that all the correct commands after that first bad command will be lost due to this process.</strong></p>
</li>
<li><p>Unfortunately, there’s <strong>no currently supported method of repairing a corrupted <code>snapshot</code></strong>. Though there’s the potential to discover where the first error had occurred, <strong>because the snapshot itself is compressed, an error partway through the dump has the potential to make the remaining parts of the snapshot unreadable.</strong> It’s for these reasons that I’d generally recommend keeping <strong>multiple backups of important snapshots</strong>, and <strong>calculating the <code>SHA1</code> or <code>SHA256</code> hashes to verify content during restoration.</strong></p>
</li>
</ul>
<p>Now, after we’ve verified that our backups are what we had saved before, and we’ve corrected the last write to <code>AOF</code> as necessary, <strong>the last step is for us to replace a Redis server with that corrected file.</strong></p>
<h3 id="Replacing-a-Failed-Master"><a href="#Replacing-a-Failed-Master" class="headerlink" title="Replacing a Failed Master"></a>Replacing a Failed Master</h3><p>Suppose machine A is running a copy of Redis that’s acting as the <code>master</code>, and machine B is running a copy of Redis that’s acting as the <code>slave</code>. Unfortunately, machine A has just <strong>lost network connectivity</strong> for some reason that we haven’t yet been able to diagnose. But we have <strong>machine C with Redis installed that we’d like to use as the <code>new master</code>.</strong></p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> If we <strong>cannot access machine A, then usually we cannot access and correct the <code>AOF</code></strong>. However, if we could, then we could simply use the <strong>correct <code>AOF</code> file we just fixed</strong> in the last section to become the <code>AOF</code> file for Machine C. Then, we set machine B to be the slave of machine C, and we finish.</li>
</ul>
</blockquote>
<ol>
<li><p>In this case, we can also tell <strong>machine B to produce a fresh snapshot with <code>SAVE</code>.</strong> We’ll then <strong>copy that snapshot over to machine C.</strong> After the snapshot has been copied into the proper path, we’ll start Redis on machine C. Finally, we’ll tell machine B to become a <code>slave</code> of machine C.</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">user@vpn-master ~:$ ssh root@machine-b.vpn</span><br><span class="line">Last login: Wed Mar 28 15:21:06 2012 from ...</span><br><span class="line">Connect to machine B on our VPN network.</span><br><span class="line"></span><br><span class="line">root@machine-b ~:$ redis-cli  <span class="comment"># Start up the commandline redis client to do a few simple operations.</span></span><br><span class="line"></span><br><span class="line">redis 127.0.0.1:6379&gt; SAVE</span><br><span class="line">OK</span><br><span class="line">redis 127.0.0.1:6379&gt; QUIT  <span class="comment"># Start a SAVE, and when it’s done, QUIT so that we can continue.</span></span><br><span class="line"></span><br><span class="line">root@machine-b ~:$ scp +</span><br><span class="line">&gt; /var/<span class="built_in">local</span>/redis/dump.rdb machine-c.vpn:/var/<span class="built_in">local</span>/redis/  <span class="comment"># Copy the snapshot over to the new master, machine C.</span></span><br><span class="line">dump.rdb                  100%      525MB   8.1MB/s   01:05</span><br><span class="line"></span><br><span class="line">root@machine-b ~:$ ssh machine-c.vpn</span><br><span class="line">Last login: Tue Mar 27 12:42:31 2012 from ...</span><br><span class="line"></span><br><span class="line">root@machine-c ~:$ sudo /etc/init.d/redis-server start</span><br><span class="line">Starting Redis server...</span><br><span class="line">Connect to the new master and start Redis.</span><br><span class="line"></span><br><span class="line">root@machine-c ~:$ <span class="built_in">exit</span></span><br><span class="line">root@machine-b ~:$ redis-cli</span><br><span class="line">redis 127.0.0.1:6379&gt; SLAVEOF machine-c.vpn 6379</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">redis 127.0.0.1:6379&gt; QUIT</span><br><span class="line">root@machine-b ~:$ <span class="built_in">exit</span></span><br><span class="line">user@vpn-master ~:$</span><br></pre></td></tr></table></figure>
</li>
<li><p>As an alternative to creating a new <code>master</code>, we may want to <strong>turn the <code>slave</code> into a <code>master</code> and create a new <code>slave</code></strong>. Either way, Redis will be able to pick up where it left off, and our only job from then on is to <strong>update our client configuration to read and write to the proper servers</strong>, and optionally update the on-disk server configuration if we need to restart Redis.</p>
</li>
</ol>
<hr>
<p><strong>REDIS SENTINEL</strong></p>
<p>A relatively recent addition to the collection of tools available with Redis is <code>Redis Sentinel</code>. By the final publishing of this manuscript, Redis Sentinel should be complete. <strong>Generally, Redis Sentinel pays attention to Redis masters and the slaves of the masters and automatically handles failover if the master goes down.</strong> For more details, please visit <a href="https://redislabs.com/ebook/part-3-next-steps/chapter-10-scaling-redis/" target="_blank" rel="noopener">this link</a>.</p>
<hr>
<h2 id="Redis-Transactions"><a href="#Redis-Transactions" class="headerlink" title="Redis Transactions"></a>Redis Transactions</h2><p>(This section builds on from the section <a href="#Basic-Redis-Transactions">Basic Redis Transactions</a>)</p>
<p>Because of Redis’s delaying execution of commands until <code>EXEC</code> is called when using <code>MULTI</code>/<code>EXEC</code>, <strong>many clients (including the Python client that we’re using) will hold off on even sending commands until all of them are known.</strong> When all of the commands are known, the client will send <code>MULTI</code>, followed by the series of commands to be executed, and <code>EXEC</code>, all at the same time. The client will then wait until all of the replies from all of the commands are received. This method of sending multiple commands at once and waiting for all of the replies is generally referred to as pipelining, and <strong>has the ability to improve Redis’s performance when executing multiple commands by reducing the number of network round trips that a client needs to wait for.</strong></p>
<p>However, there could be a <strong>potential problem of error</strong>: since <code>MULTI</code> holds the command back before executing, <strong>if some data has been changed (e.g. deleted) in the redis server, then there could be an error or data corruption when you execute your <code>EXEC</code>.</strong></p>
<p>Consider the example of a Fake Game Company has seen major growth in their webbased RPG that’s played on YouTwitFace, a fictional social network. Because it pays attention to the needs and desires of its community, it has determined that the <strong>players need the ability to buy and sell items in a marketplace.</strong> It’s our job to design and <strong>build a marketplace</strong> that can scale to the needs of the community.</p>
<h3 id="Posting-Items-in-a-Marketplace"><a href="#Posting-Items-in-a-Marketplace" class="headerlink" title="Posting Items in a Marketplace"></a>Posting Items in a Marketplace</h3><p>Our requirements for the market are simple: <strong>a user can list an item for a given price</strong>, and when another user purchases the item, the seller receives the money. We’ll also say that the part of the market we’ll be worrying about only needs to be ordered by selling price. In a later chapter, we’ll cover some topics for handling other orders.</p>
<p>Our basic marketplace that includes an <strong>ItemA being sold by user 4 for 35 e-dollars</strong>. To include enough information to sell a given item in the market, we’ll <strong>concatenate the item ID for the item with the user ID of the seller and use that as a member of a market ZSET</strong>, with the <strong>score being the item’s selling price.</strong> By including all of this information together, we greatly simplify our data structures and what we need to look up, and get the benefit of being able to easily paginate through a presorted market.</p>
<p><img src="/.com//06/02/Redis-Manual/market-listing.png" alt="Picture from https://redislabs.com/ebook/part-2-core-concepts/chapter-4-keeping-data-safe-and-ensuring-performance/4-4-redis-transactions/4-4-1-defining-users-and-their-inventory/" title="Picture from https://redislabs.com/ebook/part-2-core-concepts/chapter-4-keeping-data-safe-and-ensuring-performance/4-4-redis-transactions/4-4-1-defining-users-and-their-inventory/"></p>
<p>Now, we need to deal with the code part.</p>
<p>In the process of listing, we’ll use a Redis operation called <code>WATCH</code>, which we combine with <code>MULTI</code> and <code>EXEC</code>, and sometimes <code>UNWATCH</code> or <code>DISCARD</code>. When <strong>we’ve watched keys with <code>WATCH</code>, if at any time some other client replaces, updates, or deletes any keys that we’ve <code>WATCH</code>ed before we have performed the <code>EXEC</code> operation, our operations against Redis will fail with an error message when we try to <code>EXEC</code> (at which point we can retry or abort the operation)</strong>. By using <code>WATCH</code>, <code>MULTI</code>/<code>EXEC</code>, and <code>UNWATCH</code>/<code>DISCARD</code>, we can <strong>ensure that the data that we’re working with doesn’t change while we’re doing something important, which protects us from data corruption.</strong></p>
<ul>
<li><p>Basically, <code>WATCH</code> works by making the <code>EXEC</code> command conditional; in other words, Redis will only perform a transaction if the <code>WATCH</code>ed keys were not modified (<strong>otherwise it returns <code>nil</code> no matter what commands you queued</strong>). If a <code>WATCH</code>ed key was indeed modified, the transaction won’t be entered at all.</p>
<p>  The <code>WATCH</code> command can be called numerous times (before the <code>MULTI</code> command), and one <code>WATCH</code> call can involve any number of keys. <code>Watch</code> calls simply monitor for changes starting from the point where <code>WATCH</code> was called until <code>EXEC</code> is called. <strong>Once <code>EXEC</code> is invoked, all the keys will be <code>UNWATCH</code>ed, whether or not the transaction in question was aborted.</strong> Closing a client connection also triggers all keys to be <code>UNWATCH</code>ed.</p>
</li>
</ul>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> While <code>UNWATCH</code> is obvious as it sounds, <strong><code>DISCARD</code> needs more explaination.</strong> In the same way that <code>UNWATCH</code> will let us reset our connection if sent after <code>WATCH</code> but <strong>before <code>MULTI</code></strong>, <strong><code>DISCARD</code> will also reset the connection if sent after <code>MULTI</code> but before <code>EXEC</code>.</strong> That is to say, if we’d <code>WATCH</code>ed a key or keys, fetched some data, and then started a transaction with <code>MULTI</code> followed by a group of commands, we could <strong>cancel the <code>WATCH</code> and clear out any queued commands with <code>DISCARD</code>.</strong> We don’t use <code>DISCARD</code> here, primarily because we know whether we want to perform a <code>MULTI</code>/<code>EXEC</code> or <code>UNWATCH</code>, so a <code>DISCARD</code> is unnecessary for our purposes.</li>
</ul>
</blockquote>
<p>Therefore, all we need to do for listing/posting those items would be to <strong>add the item to the market <code>ZSET</code>, while <code>WATCH</code>ing the seller’s inventory to make sure that the item is still available to be sold.</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">def list_item(conn, itemid, sellerid, price):</span><br><span class="line">   inventory &#x3D; &quot;inventory:%s&quot;%sellerid</span><br><span class="line">   item &#x3D; &quot;%s.%s&quot;%(itemid, sellerid)</span><br><span class="line">   end &#x3D; time.time() + 5</span><br><span class="line">   pipe &#x3D; conn.pipeline()</span><br><span class="line"></span><br><span class="line">   while time.time() &lt; end:</span><br><span class="line">      try:</span><br><span class="line">         conn.watch(inventory)  # Watch for changes to the user’s inventory.</span><br><span class="line"></span><br><span class="line">         if not conn.sismember(inventory, itemid):  # Verify that the user still has the item to be listed.</span><br><span class="line"></span><br><span class="line">            conn.unwatch()  # If the item isn’t in the user’s inventory, stop watching the inventory key and return.</span><br><span class="line"></span><br><span class="line">            return None</span><br><span class="line"></span><br><span class="line">         pipe.multi()</span><br><span class="line">         pipe.zadd(&quot;market:&quot;, item, price)</span><br><span class="line">         pipe.srem(inventory, itemid)  # Actually list the item.</span><br><span class="line"></span><br><span class="line">         pipe.execute()  # If execute returns without a WatchError being raised, </span><br><span class="line">						 # then the transaction is complete and the inventory key is no longer watched.</span><br><span class="line"></span><br><span class="line">         return True</span><br><span class="line">      except redis.exceptions.WatchError:</span><br><span class="line">         pass  # The user’s inventory was changed; retry the loop.</span><br><span class="line"></span><br><span class="line">   return False</span><br></pre></td></tr></table></figure>

<p>Generally, <strong>listing an item should occur without any significant issue, since only the user should be selling their own items</strong> (which is enforced farther up the application stack). But as mentioned before, if a user’s inventory were to change between the <code>WATCH</code> and <code>EXEC</code>, our attempt to list the item would fail, and we’d retry.</p>
<h3 id="Purchasing-an-Item"><a href="#Purchasing-an-Item" class="headerlink" title="Purchasing an Item"></a>Purchasing an Item</h3><p>To process the purchase of an item, we need to:</p>
<ol>
<li>first <code>WATCH</code> the market and the user who’s buying the item.</li>
<li>then fetch the buyer’s total funds and the price of the item </li>
<li>verify that the buyer has enough money. If they don’t have enough money, we cancel the transaction. </li>
<li>if they do have enough money, we perform the transfer of money between the accounts, move the item into the buyer’s inventory, and remove the item from the market. </li>
<li>on <code>WATCH</code> error, we retry for up to 10 seconds in total.</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">def purchase_item(conn, buyerid, itemid, sellerid, lprice):</span><br><span class="line">   buyer &#x3D; &quot;users:%s&quot;%buyerid</span><br><span class="line">   seller &#x3D; &quot;users:%s&quot;%sellerid</span><br><span class="line">   item &#x3D; &quot;%s.%s&quot;%(itemid, sellerid)</span><br><span class="line">   inventory &#x3D; &quot;inventory:%s&quot;%buyerid</span><br><span class="line">   end &#x3D; time.time() + 10</span><br><span class="line">   pipe &#x3D; conn.pipeline()</span><br><span class="line"></span><br><span class="line">   while time.time() &lt; end:</span><br><span class="line">      try:</span><br><span class="line">         conn.watch(&quot;market:&quot;, buyer)  # Watch for changes to the market and to the buyer’s account information.</span><br><span class="line"></span><br><span class="line">         price &#x3D; conn.zscore(&quot;market:&quot;, item)</span><br><span class="line">         funds &#x3D; int(conn.hget(buyer, &quot;funds&quot;))</span><br><span class="line">         if price !&#x3D; lprice or price &gt; funds:  # Check for a sold&#x2F;repriced item or insufficient funds.</span><br><span class="line">            conn.unwatch()  </span><br><span class="line"></span><br><span class="line">            return None</span><br><span class="line"></span><br><span class="line">		 # Transfer funds from the buyer to the seller, and transfer the item to the buyer.</span><br><span class="line">         pipe.multi()</span><br><span class="line">         pipe.hincrby(seller, &quot;funds&quot;, int(price))</span><br><span class="line">         pipe.hincrby(buyer, &quot;funds&quot;, int(-price))</span><br><span class="line">         pipe.sadd(inventory, itemid)</span><br><span class="line">         pipe.zrem(&quot;market:&quot;, item)</span><br><span class="line">         pipe.execute()  </span><br><span class="line"></span><br><span class="line">         return True</span><br><span class="line">      except redis.exceptions.WatchError:</span><br><span class="line">         pass  # Retry if the buyer’s account or the market changed.</span><br><span class="line"></span><br><span class="line">   return False</span><br></pre></td></tr></table></figure>

<p><strong><em>Q: Why can’t the data be simply locked in Redis?</em></strong></p>
<p>When accessing data for writing (<strong><code>SELECT FOR UPDATE</code> in SQL</strong>), relational databases will place a <strong>lock on rows that are accessed until a transaction is completed with <code>COMMIT</code> or <code>ROLLBACK</code>.</strong> If any other client attempts to access data for writing on any of the same rows, that client will be blocked until the first transaction is completed. This form of locking works well in practice (essentially all relational databases implement it), though it <strong>can result in long wait times for clients waiting to acquire locks on a number of rows if the lock holder is slow.</strong></p>
<p>Because there’s potential for long wait times, and <strong>because the design of Redis minimizes wait time for clients</strong> (except in the case of blocking <code>LIST</code> pops), Redis doesn’t lock data during <code>WATCH</code>. Instead, <strong>Redis will notify clients if someone else modified the data first, which is called optimistic locking</strong> (the actual locking that relational databases perform could be viewed as pessimistic). Optimistic locking also works well in practice because clients are never waiting on the first holder of the lock; instead they retry if some other client was faster.</p>
<h2 id="Non-transactional-Pipeline"><a href="#Non-transactional-Pipeline" class="headerlink" title="Non-transactional Pipeline"></a>Non-transactional Pipeline</h2><p>In the <strong>python redis libraray</strong>, you can actually put arguments in the <code>pipeline()</code> function:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pipe &#x3D; conn.pipeline(True)  # this is the same as conn.pipeline()</span><br></pre></td></tr></table></figure>

<p>And as we have seen before, this will wrap the commands with <code>MULTI</code>/<code>EXEC</code>, so that all commands will execute in order in a transactional way. However, we could also pass in the argument <code>False</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pipe &#x3D; conn.pipeline(False)</span><br></pre></td></tr></table></figure>

<p>This will <strong>not wrap the commands with <code>MULTI</code>/<code>EXEC</code>, but it will have an effect of executing multiple commands at once in the redis server</strong>, and thereby reduce the time taken for roundtrips. You can also think of these as comamnds with a multiple arguments, like <code>MGET</code>, <code>MSET</code>, <code>HMGET</code>, <code>HMSET</code>, <code>RPUSH/LPUSH</code>, <code>SADD</code>, <code>ZADD</code>, and others (but the performance improvement is perhaps not as drastic as these commands).</p>
<p>However, this does means that it is appropriate only when we are sure the <strong>result of one command doesn’t affect the input to another</strong>, <strong>and we don’t need them all to execute transactionally</strong>. However, we are sure that it will reduce the amount of round trips between the client and the server (to one in the example below), <strong>so <code>pipeline(False)</code> method can further improve overall Redis performance.</strong></p>
<p>For example:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update_token</span><span class="params">(conn, token, user, item=None)</span>:</span></span><br><span class="line">   timestamp = time.time()</span><br><span class="line"></span><br><span class="line">   conn.hset(<span class="string">'login:'</span>, token, user)</span><br><span class="line"></span><br><span class="line">   conn.zadd(<span class="string">'recent:'</span>, token, timestamp)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> item:</span><br><span class="line">      conn.zadd(<span class="string">'viewed:'</span> + token, item, timestamp)</span><br><span class="line"></span><br><span class="line">      conn.zremrangebyrank(<span class="string">'viewed:'</span> + token, <span class="number">0</span>, <span class="number">-26</span>)</span><br><span class="line"></span><br><span class="line">      conn.zincrby(<span class="string">'viewed:'</span>, item, <span class="number">-1</span>)</span><br></pre></td></tr></table></figure>

<p>could be replaced by:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update_token_pipeline</span><span class="params">(conn, token, user, item=None)</span>:</span></span><br><span class="line">   timestamp = time.time()</span><br><span class="line">   pipe = conn.pipeline(<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">   pipe.hset(<span class="string">'login:'</span>, token, user)  <span class="comment"># these two commands don't have to be executed in transaction</span></span><br><span class="line">   pipe.zadd(<span class="string">'recent:'</span>, token, timestamp)</span><br><span class="line">   <span class="keyword">if</span> item:</span><br><span class="line">      pipe.zadd(<span class="string">'viewed:'</span> + token, item, timestamp)</span><br><span class="line">      pipe.zremrangebyrank(<span class="string">'viewed:'</span> + token, <span class="number">0</span>, <span class="number">-26</span>)  <span class="comment"># those technically do</span></span><br><span class="line">      pipe.zincrby(<span class="string">'viewed:'</span>, item, <span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">   pipe.execute()  <span class="comment"># execute the above commands but there is no lock</span></span><br></pre></td></tr></table></figure>

<h2 id="Redis-Performance-and-Benchmarking"><a href="#Redis-Performance-and-Benchmarking" class="headerlink" title="Redis Performance and Benchmarking"></a>Redis Performance and Benchmarking</h2><p>Improving performance in Redis requires having an <strong>understanding of what to expect in terms of performance for the types of commands that we’re sending to Redis.</strong> To get a better idea of what to expect from Redis, we’ll quickly run a **benchmark that’s included within Redis: <code>redis-benchmark</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">root@a93d918c25f7:&#x2F;data# redis-benchmark -c 1 -q</span><br><span class="line"></span><br><span class="line">PING_INLINE: 21353.83 requests per second</span><br><span class="line">PING_BULK: 19845.21 requests per second</span><br><span class="line">SET: 16220.60 requests per second</span><br><span class="line">GET: 19334.88 requests per second</span><br><span class="line">INCR: 16592.00 requests per second</span><br><span class="line">LPUSH: 18621.97 requests per second</span><br><span class="line">RPUSH: 19033.12 requests per second</span><br><span class="line">LPOP: 18556.32 requests per second</span><br><span class="line">RPOP: 18231.54 requests per second</span><br><span class="line">SADD: 19264.11 requests per second</span><br><span class="line">HSET: 15893.20 requests per second</span><br><span class="line">SPOP: 17445.92 requests per second</span><br><span class="line">LPUSH (needed to benchmark LRANGE): 16342.54 requests per second</span><br><span class="line">LRANGE_100 (first 100 elements): 13616.56 requests per second</span><br><span class="line">LRANGE_300 (first 300 elements): 9668.37 requests per second</span><br><span class="line">LRANGE_500 (first 450 elements): 8774.24 requests per second</span><br><span class="line">LRANGE_600 (first 600 elements): 7390.44 requests per second</span><br><span class="line">MSET (10 keys): 15544.85 requests per second</span><br></pre></td></tr></table></figure>

<p>The output of <code>redis-benchmark</code> shows a <strong>group of commands that are typically used in Redis, as well as the number of commands of that type that can be run in a single second.</strong> A standard run of this benchmark <strong>without any options will try to push Redis to its limit using <code>50</code> clients</strong>, but it’s a lot easier to compare performance of <strong>a single benchmark client against one copy of our own client (by specifying the <code>1</code> option, as in the command show in the example above)</strong>, rather than many.</p>
<p>However, <strong>be careful if you are using the python redis library</strong>. When looking at the output of redis-benchmark, we must be careful not to try to directly compare its output with how quickly our application (e.g. python) performs. This is because <strong><code>redis-benchmark</code> doesn’t actually process the result of the commands that it performs</strong>, which means that the results of <strong>some responses that require substantial parsing overhead aren’t  taken into account. Generally, compared to redis-benchmark running with a single client, we can expect the Python Redis client to perform at roughly 50–60% of what redis-benchmark will tell us</strong> for a single client and for nonpipelined commands, depending on the complexity of the command to call.</p>
<h2 id="Logging-in-Redis"><a href="#Logging-in-Redis" class="headerlink" title="Logging in Redis"></a>Logging in Redis</h2><p>In the world of Linux and Unix, there are two common logging methods. The <strong>first is logging to a file</strong>, where over time we write individual log lines to a file, and every once in a while, we write to a new file. Many thousands of pieces of software have been written do this (including Redis itself). But this method can run into issues because we have <strong>many different services writing to a variety of log files</strong>, each with a different way of rolling them over, and no common way of easily taking all of the log files and doing<br>something useful with them.</p>
<p>Running on TCP and UDP <strong>port 514 of almost every Unix and Linux server</strong> available is a <strong>service called <code>syslog</code></strong>, the <strong>second common logging method</strong>. Syslog accepts log messages from any program that sends it a message and <strong>routes those messages to various on-disk log files</strong>, <strong>handling rotation and deletion of old logs</strong>. With configuration, it can even forward messages to other servers for further processing. As a service, it’s far more convenient than logging to files directly, because all of the special log file rotation and deletion  is already handled for us.</p>
<h3 id="Recent-Logs"><a href="#Recent-Logs" class="headerlink" title="Recent Logs"></a>Recent Logs</h3><p>To keep a recent list of logs, we’ll <strong><code>LPUSH</code> log messages to a <code>LIST</code> and then trim that <code>LIST</code> to a fixed size</strong>. Later, if we want to read the log messages, we can perform a simple <code>LRANGE</code> to fetch the messages. We’ll take a few extra steps to support different named log message queues and to support the typical log severity levels, but you can remove either of those in your own code if you need to. The code for writing recent logs to Redis is shown below:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">SEVERITY = &#123;</span><br><span class="line">   logging.DEBUG: <span class="string">'debug'</span>,</span><br><span class="line">   logging.INFO: <span class="string">'info'</span>,</span><br><span class="line">   logging.WARNING: <span class="string">'warning'</span>,</span><br><span class="line">   logging.ERROR: <span class="string">'error'</span>,</span><br><span class="line">   logging.CRITICAL: <span class="string">'critical'</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log_recent</span><span class="params">(conn, name, message, severity=logging.INFO, pipe=None)</span>:</span></span><br><span class="line">   severity = str(SEVERITY.get(severity)).lower()</span><br><span class="line"></span><br><span class="line">   destination = <span class="string">'recent:%s:%s'</span>%(name, severity)  <span class="comment"># Create the key that messages will be written to.</span></span><br><span class="line"></span><br><span class="line">   message = time.asctime() + <span class="string">' '</span> + message  <span class="comment"># Add the current time so that we know when the message was sent.</span></span><br><span class="line"></span><br><span class="line">   pipe = pipe <span class="keyword">or</span> conn.pipeline()</span><br><span class="line">   pipe.lpush(destination, message)  <span class="comment"># Add the latest message to the beginning of the log list.</span></span><br><span class="line"></span><br><span class="line">   pipe.ltrim(destination, <span class="number">0</span>, <span class="number">99</span>)  <span class="comment"># Trim the log list to only include the most recent 100 messages.</span></span><br><span class="line"></span><br><span class="line">   pipe.execute()</span><br></pre></td></tr></table></figure>

<h3 id="Logging-Common-operations"><a href="#Logging-Common-operations" class="headerlink" title="Logging Common operations"></a>Logging Common operations</h3><p>The problem with the above code snippet is that it’s <strong>not very good at telling you whether any important messages were lost in the noise</strong>. By recording information about how often a particular message appears, you could then look through the messages ordered by <strong>how often they happened to help you determine what’s important</strong>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log_common</span><span class="params">(conn, name, message, severity=logging.INFO, timeout=<span class="number">5</span>)</span>:</span></span><br><span class="line">   severity = str(SEVERITY.get(severity)).lower()  <span class="comment"># Handle the logging level.</span></span><br><span class="line"></span><br><span class="line">   destination = <span class="string">'common:%s:%s'</span>%(name, severity)  <span class="comment"># Set up the destination key for keeping recent logs.</span></span><br><span class="line"></span><br><span class="line">   start_key = destination + <span class="string">':start'</span>  <span class="comment"># Keep a record of the start of the hour for this set of messages.</span></span><br><span class="line"></span><br><span class="line">   pipe = conn.pipeline()</span><br><span class="line">   end = time.time() + timeout</span><br><span class="line">   <span class="keyword">while</span> time.time() &lt; end:</span><br><span class="line">      <span class="keyword">try</span>:</span><br><span class="line">         pipe.watch(start_key)  <span class="comment"># We’ll watch the start of the hour key for changes </span></span><br><span class="line">                                <span class="comment"># that only happen at the beginning of the hour.</span></span><br><span class="line"></span><br><span class="line">         now = datetime.utcnow().timetuple()</span><br><span class="line"></span><br><span class="line">         hour_start = datetime(*now[:<span class="number">4</span>]).isoformat()  <span class="comment"># Find the current start hour.</span></span><br><span class="line"></span><br><span class="line">         existing = pipe.get(start_key)</span><br><span class="line">         pipe.multi()  <span class="comment"># Set up the transaction.</span></span><br><span class="line"></span><br><span class="line">         <span class="keyword">if</span> existing <span class="keyword">and</span> existing &lt; hour_start:  <span class="comment"># If the current list of common logs is for a previous hour…</span></span><br><span class="line"></span><br><span class="line">            pipe.rename(destination, destination + <span class="string">':last'</span>)</span><br><span class="line">            pipe.rename(start_key, destination + <span class="string">':pstart'</span>)  <span class="comment"># …move the old common log information to the archive.</span></span><br><span class="line"></span><br><span class="line">            pipe.set(start_key, hour_start)  <span class="comment"># Update the start of the current hour for the common logs.</span></span><br><span class="line"></span><br><span class="line">         pipe.zincrby(destination, message)  <span class="comment"># Actually increment our common counter.</span></span><br><span class="line"></span><br><span class="line">         log_recent(pipe, name, message, severity, pipe)  <span class="comment"># Call the log_recent() function to record these, </span></span><br><span class="line">                                                          <span class="comment"># and rely on its call to execute().</span></span><br><span class="line"></span><br><span class="line">         <span class="keyword">return</span></span><br><span class="line">   <span class="keyword">except</span> redis.exceptions.WatchError:</span><br><span class="line">         <span class="keyword">continue</span></span><br></pre></td></tr></table></figure>

<h2 id="Locks-in-Redis"><a href="#Locks-in-Redis" class="headerlink" title="Locks in Redis"></a>Locks in Redis</h2><p>In the context of Redis, we’ve been using <code>WATCH</code> as a replacement for a lock, and we call it optimistic locking, because rather than actually preventing others from modifying the data, we’re notified if someone else changes the data before we do it ourselves. </p>
<p>With <strong>distributed locking, we have the same sort of acquire, operate, release operations</strong>, but instead of having a lock that’s only known by threads within the same process, or processes on the same machine, we <strong>use a lock that different Redis clients on different machines can acquire and release</strong>. When and whether to use locks or <code>WATCH</code> will depend on a given application; some applications don’t need locks to operate correctly, some only require locks for parts, and some require locks at every step.</p>
<h3 id="Problems-with-Watch"><a href="#Problems-with-Watch" class="headerlink" title="Problems with Watch"></a>Problems with Watch</h3><p>Consider the market example that we solved before with <code>WATCH</code> and <code>UNWATCH</code>: we <code>WATCH</code> the seller’s inventory to make sure the item is still available, add the item to the market <code>ZSET</code>, and remove it from the user’s inventory; to purchase of an item, we <code>WATCH</code> the market and the buyer’s <code>HASH</code>.</p>
<p>This would work correctly, however, <strong>when the scale of operation increases</strong>, the amount of retries that happen becomes huge, which could affect the latency:</p>
<table>
<thead>
<tr>
<th>-</th>
<th>Listed items</th>
<th>Bought items</th>
<th>Purchase retries</th>
<th>Average wait per purchase</th>
</tr>
</thead>
<tbody><tr>
<td>1 lister, 1 buyer</td>
<td>145,000</td>
<td>27,000</td>
<td>80,000</td>
<td>14ms</td>
</tr>
<tr>
<td>5 listers, 1 buyer</td>
<td>331,000</td>
<td>&lt;200</td>
<td>50,000</td>
<td>150ms</td>
</tr>
<tr>
<td>5 listers, 5 buyers</td>
<td>206,000</td>
<td>&lt;600</td>
<td>161,000</td>
<td>498ms</td>
</tr>
</tbody></table>
<p>To get past this limitation and actually start performing sales at scale, we must <strong>make sure that we only list or sell one item in the marketplace at any one time. We do this by using a lock.</strong></p>
<h3 id="Building-a-Simple-Lock"><a href="#Building-a-Simple-Lock" class="headerlink" title="Building a Simple Lock"></a>Building a Simple Lock</h3><p>The first part of <strong>making sure that no other code can run is to acquire the lock</strong>. The natural building block to use for acquiring a lock is the <code>SETNX</code> command, <strong>which will only set a value if the key doesn’t already exist.</strong> We’ll set the value to be a unique identifier to ensure that no other process can get the lock, and the unique identifier we’ll use is a 128-bit randomly generated UUID.</p>
<p>If we fail to acquire the lock initially, we’ll retry until we acquire the lock, or until a specified timeout has passed, whichever comes first, as shown here.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">def acquire_lock(conn, lockname, acquire_timeout&#x3D;10):</span><br><span class="line">   identifier &#x3D; str(uuid.uuid4())# A 128-bit random identifier.</span><br><span class="line"></span><br><span class="line">   end &#x3D; time.time() + acquire_timeout</span><br><span class="line">   while time.time() &lt; end:</span><br><span class="line">      if conn.setnx(&#39;lock:&#39; + lockname, identifier):  # Get the lock.</span><br><span class="line"></span><br><span class="line">         return identifier</span><br><span class="line"></span><br><span class="line">      time.sleep(.001)  # sleep and retries</span><br><span class="line"></span><br><span class="line">   return False  # failed to get the lock within the amount of time</span><br></pre></td></tr></table></figure>

<p>Now that we have the lock, we can perform our buying or selling without <code>WATCH</code> errors getting in our way. We’ll acquire the lock and, just like before, check the price of the item, make sure that the buyer has enough money, and if so, transfer the money and item. When completed, we release the lock.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">def purchase_item_with_lock(conn, buyerid, itemid, sellerid):</span><br><span class="line">   buyer &#x3D; &quot;users:%s&quot;%buyerid</span><br><span class="line">   seller &#x3D; &quot;users:%s&quot;%sellerid</span><br><span class="line">   item &#x3D; &quot;%s.%s&quot;%(itemid, sellerid)</span><br><span class="line">   inventory &#x3D; &quot;inventory:%s&quot;%buyerid</span><br><span class="line">   end &#x3D; time.time() + 30</span><br><span class="line"></span><br><span class="line">   lock_obtained &#x3D; acquire_lock(conn, market)  # Get the lock.</span><br><span class="line"></span><br><span class="line">   if !lock_obtained:</span><br><span class="line">       return False</span><br><span class="line">   else:</span><br><span class="line">	   pipe &#x3D; conn.pipeline(True)</span><br><span class="line">	   try:</span><br><span class="line">	      while time.time() &lt; end:</span><br><span class="line">	         try:</span><br><span class="line">	            pipe.watch(buyer)</span><br><span class="line">	</span><br><span class="line">	            pipe.zscore(&quot;market:&quot;, item)</span><br><span class="line">	            pipe.hget(buyer, &#39;funds&#39;)</span><br><span class="line">	            price, funds &#x3D; pipe.execute()</span><br><span class="line">	            if price is None or price &gt; funds:  # Check for a sold item or insufficient funds.</span><br><span class="line">	               pipe.unwatch()</span><br><span class="line">	               return None</span><br><span class="line">	</span><br><span class="line">	            pipe.hincrby(seller, int(price))</span><br><span class="line">	            pipe.hincrby(buyerid, int(-price))</span><br><span class="line">	            pipe.sadd(inventory, itemid)</span><br><span class="line">	            pipe.zrem(&quot;market:&quot;, item)</span><br><span class="line">	            pipe.execute()  # Transfer funds from the buyer to the seller, and transfer the item to the buyer.</span><br><span class="line">	</span><br><span class="line">	            return True</span><br><span class="line">	         except redis.exceptions.WatchError:</span><br><span class="line">	            pass</span><br><span class="line">		     finally:</span><br><span class="line">		        release_lock(conn, market, lock_obtained)</span><br></pre></td></tr></table></figure>

<p><strong>Between the time when we acquired the lock and when we’re trying to release it</strong>, someone may have done bad things to the lock. <strong>To release the lock, we need to <code>WATCH</code> the lock key,</strong> and then check to <strong>make sure that the value is still the same as what we set it to before we delete it.</strong> This also <strong>prevents us from releasing a lock multiple times.</strong> The <code>release_lock()</code> function is shown next.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">release_lock</span><span class="params">(conn, lockname, identifier)</span>:</span></span><br><span class="line">   pipe = conn.pipeline(<span class="literal">True</span>)</span><br><span class="line">   lockname = <span class="string">'lock:'</span> + lockname</span><br><span class="line"></span><br><span class="line">   <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">      <span class="keyword">try</span>:</span><br><span class="line">         pipe.watch(lockname)</span><br><span class="line">         <span class="keyword">if</span> pipe.get(lockname) == identifier:  <span class="comment"># Check and verify that we still have the lock.</span></span><br><span class="line"></span><br><span class="line">            pipe.multi()</span><br><span class="line">            pipe.delete(lockname)</span><br><span class="line">            pipe.execute()</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span>  <span class="comment"># Release the lock.</span></span><br><span class="line"></span><br><span class="line">         pipe.unwatch()</span><br><span class="line">         <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">except</span> redis.exceptions.WatchError:  <span class="comment"># Someone else did something with the lock; retry.</span></span><br><span class="line">										   <span class="comment"># this is actually kind of rare</span></span><br><span class="line">         <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> For simplicity, we performed lock on the entire <code>market</code> data, which also means that listing an item could be blocked. However, if we <strong>replace the market-level lock with one specific to the item to be bought or sold, we can reduce lock contention and increase performance.</strong></li>
</ul>
</blockquote>
<h3 id="Locks-with-timeouts"><a href="#Locks-with-timeouts" class="headerlink" title="Locks with timeouts"></a>Locks with timeouts</h3><p>The above locks still had one important problem: it doesn’t handle cases where a <strong>lock holder crashes without releasing the lock</strong>, or when a lock holder fails and holds the lock forever. To handle the crash/failure cases, we <strong>add a timeout to the lock.</strong></p>
<p>In order to give our lock a timeout, we’ll <strong>use <code>EXPIRE</code> to have Redis time it out automatically.</strong> </p>
<p>The <strong>natural place to put the <code>EXPIRE</code> is immediately after the lock is acquired,</strong> and we’ll do that. <strong>But if our client happens to crash (and the worst place for it to crash for us is between <code>SETNX</code> and <code>EXPIRE</code>), we still want the lock to eventually time out.</strong> To handle that situation, <strong>any time a client fails to get the lock, the client will check the expiration on the lock, and if it’s not set, set it.</strong>  This will make sure that the <strong>lock will always have a timeout</strong>, and will eventually expire, letting other clients get a timed-out lock.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">acquire_lock_with_timeout</span><span class="params">(conn, lockname, acquire_timeout=<span class="number">10</span>, lock_timeout=<span class="number">10</span>)</span>:</span></span><br><span class="line">   identifier = str(uuid.uuid4())</span><br><span class="line"></span><br><span class="line">   lock_timeout = int(math.ceil(lock_timeout))  <span class="comment"># Only pass integers to our EXPIRE calls.</span></span><br><span class="line"></span><br><span class="line">   end = time.time() + acquire_timeout</span><br><span class="line">   <span class="keyword">while</span> time.time() &lt; end:</span><br><span class="line">      <span class="keyword">if</span> conn.setnx(lockname, identifier):</span><br><span class="line">         conn.expire(lockname, lock_timeout)  <span class="comment"># Get the lock and set the expiration.</span></span><br><span class="line"></span><br><span class="line">         <span class="keyword">return</span> identifier</span><br><span class="line"></span><br><span class="line">      <span class="keyword">elif</span> <span class="keyword">not</span> conn.ttl(lockname):  <span class="comment"># Check and update the expiration time as necessary.</span></span><br><span class="line">         conn.expire(lockname, lock_timeout)</span><br><span class="line"></span><br><span class="line">      time.sleep(<span class="number">.001</span>)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p>This new <code>acquire_lock_with_timeout()</code> handles timeouts. It ensures that locks expire as necessary, and that they won’t be stolen from clients that rightfully have them. Even better, we were smart with our release lock function earlier, which still works.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> As of Redis 2.6.12, <strong>*the <code>SET</code> command added options to support a combination of <code>SETNX</code> and <code>SETEX</code> functionality</strong>, which makes our lock acquire function trivial. We still need the complicated release lock to be correct. In python, this looks like: <code>set(name, value, ex=None, px=None, nx=False, xx=False, keepttl=False)</code></li>
</ul>
</blockquote>
<h3 id="Building-a-Semaphore"><a href="#Building-a-Semaphore" class="headerlink" title="Building a Semaphore"></a>Building a Semaphore</h3><p>Sometimes, we need to use a semaphore to hold the ocks, instead of having a timeout lock shown above for a single use.</p>
<p>When building a counting semaphore, we run into many of the same concerns we had with other types of locking. We must decide who got the lock, how to handle processes that crashed with the lock, and how to handle <strong>timeouts</strong>. If we don’t care about timeouts, or handling the case where semaphore holders can crash without releasing semaphores.</p>
<p>In almost every case where we want to <strong>deal with timeouts in Redis</strong>, we’ll generally look to <strong>one of two different methods</strong>. <strong>Either we’ll use <code>EXPIRE</code> like we did with our standard locks, or we’ll use <code>ZSETs</code></strong>. In this case, we want to <strong>use <code>ZSET</code>s</strong>, because that allows us to keep information about multiple semaphore holders in a single structure.</p>
<p>Now, to build a semaphore, we will have: <strong>for each process that attempts to acquire the semaphore, we’ll generate a unique identifier.</strong> This identifier will be the member of a <code>ZSET</code>. For the <strong>score, we’ll use the timestamp</strong> for when the process attempted to acquire the semaphore. When a process wants to <strong>attempt to acquire a semaphore</strong>, it <strong>first generates an identifier, and then the process adds the identifier to the <code>ZSET</code> using the current timestamp as the score</strong>. After adding the identifier, the process then checks for its identifier’s rank. <strong>If the rank returned is lower than the total allowed count</strong> (Redis uses 0-indexing on rank), then the caller has <strong>acquired the semaphore</strong>. Otherwise, the caller doesn’t have the semaphore and must delete its identifier from the <code>ZSET</code>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">acquire_semaphore</span><span class="params">(conn, semname, limit, timeout=<span class="number">10</span>)</span>:</span></span><br><span class="line">   identifier = str(uuid.uuid4())  <span class="comment"># A 128-bit random identifier.</span></span><br><span class="line"></span><br><span class="line">   now = time.time()</span><br><span class="line"></span><br><span class="line">   pipeline = conn.pipeline(<span class="literal">True</span>)</span><br><span class="line">   pipeline.zremrangebyscore(semname, <span class="string">'-inf'</span>, now - timeout)  <span class="comment"># Time out old semaphore holders.</span></span><br><span class="line"></span><br><span class="line">   pipeline.zadd(semname, identifier, now)  <span class="comment"># Try to acquire the semaphore.</span></span><br><span class="line"></span><br><span class="line">   pipeline.zrank(semname, identifier)</span><br><span class="line">   <span class="keyword">if</span> pipeline.execute()[<span class="number">-1</span>] &lt; limit:  <span class="comment"># Check to see if we have it.</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> identifier  <span class="comment"># got the semaphore</span></span><br><span class="line"></span><br><span class="line">   conn.zrem(semname, identifier)  <span class="comment"># We failed to get the semaphore; discard our identifier.</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="literal">None</span></span><br></pre></td></tr></table></figure>

<p>Releasing the semaphore is easy: we remove the identifier from the ZSET, as can be<br>seen in the next listing.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">release_semaphore</span><span class="params">(conn, semname, identifier)</span>:</span></span><br><span class="line">   <span class="keyword">return</span> conn.zrem(semname, identifier)</span><br></pre></td></tr></table></figure>

<p>However, there is <strong>a problem in this design as well</strong>. Since it is <strong>relying on every process having access to the same system time</strong> in order to get the semaphore can cause problems if we have multiple hosts. This isn’t a huge problem for our specific use case, but if we had two systems A and B, <strong>where A ran even 10 milliseconds faster than B</strong>, then if A got the last semaphore, and B tried to get a semaphore within 10 milliseconds, B would actually “steal” A’s semaphore without A knowing it.</p>
<p>Any time we have a lock or a semaphore where <strong>such a slight difference in the system clock can drastically affect who can get the lock, the lock or semaphore is considered <code>unfair</code></strong>. Unfair locks and semaphores can cause clients that should’ve gotten the lock or semaphore to never get it, and this is something that we’ll fix in the next section.</p>
<h3 id="Fair-Semaphore"><a href="#Fair-Semaphore" class="headerlink" title="Fair Semaphore"></a>Fair Semaphore</h3><p>In order to minimize problems with inconsistent system times, <strong>we’ll add a <code>counter</code> (a <code>String</code>) and a second <code>ZSET</code>.</strong> The <strong><code>counter</code> creates a steadily increasing timer-like mechanism</strong> that ensures that whoever incremented the counter first should be the one to get the semaphore.</p>
<p>We then enforce our requirement that <strong>clients that want the semaphore who get the <code>counter</code> first</strong> also get the <strong>semaphore inside an “owner” <code>ZSET</code> with the counter-produced value as the score</strong>, checking our identifier’s rank in the new <code>ZSET</code> to determine which client got the semaphore.</p>
<p><img src="/.com//06/02/Redis-Manual/fair-semaphore.png" alt="Picture from https://redislabs.com/ebook/part-2-core-concepts/chapter-6-application-components-in-redis/6-3-counting-semaphores/6-3-2-fair-semaphores/" title="Picture from https://redislabs.com/ebook/part-2-core-concepts/chapter-6-application-components-in-redis/6-3-counting-semaphores/6-3-2-fair-semaphores/"></p>
<p>We continue to <strong>handle timeouts the same way as our basic semaphore</strong>, by <strong>removing entries from the system time <code>ZSET</code></strong>. We <strong>propagate those timeouts to the new owner <code>ZSET</code></strong> by the use of <code>ZINTERSTORE</code> and the <code>WEIGHTS</code>argument.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">acquire_fair_semaphore</span><span class="params">(conn, semname, limit, timeout=<span class="number">10</span>)</span>:</span></span><br><span class="line">   identifier = str(uuid.uuid4())  <span class="comment"># A 128-bit random identifier.</span></span><br><span class="line"></span><br><span class="line">   czset = semname + <span class="string">':owner'</span></span><br><span class="line">   ctr = semname + <span class="string">':counter'</span></span><br><span class="line"></span><br><span class="line">   now = time.time()</span><br><span class="line">   pipeline = conn.pipeline(<span class="literal">True</span>)</span><br><span class="line">   pipeline.zremrangebyscore(semname, <span class="string">'-inf'</span>, now - timeout)  <span class="comment"># Time out old entries.</span></span><br><span class="line">   pipeline.zinterstore(czset, &#123;czset: <span class="number">1</span>, semname: <span class="number">0</span>&#125;)  <span class="comment"># since they have the same UUID member name</span></span><br><span class="line">											  		    <span class="comment"># weights for czset is 1, semanme is 0</span></span><br><span class="line"></span><br><span class="line">   pipeline.incr(ctr)</span><br><span class="line">   counter = pipeline.execute()[<span class="number">-1</span>]  <span class="comment"># Get the counter.</span></span><br><span class="line"></span><br><span class="line">   pipeline.zadd(semname, identifier, now)</span><br><span class="line">   pipeline.zadd(czset, identifier, counter)</span><br><span class="line"></span><br><span class="line">   pipeline.zrank(czset, identifier)  <span class="comment"># Try to acquire the semaphore.</span></span><br><span class="line">   <span class="keyword">if</span> pipeline.execute()[<span class="number">-1</span>] &lt; limit:  <span class="comment"># Check the rank to determine if we got the semaphore.</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> identifier  <span class="comment"># We got the semaphore.</span></span><br><span class="line"></span><br><span class="line">   pipeline.zrem(semname, identifier)</span><br><span class="line">   pipeline.zrem(czset, identifier)  <span class="comment"># We didn’t get the semaphore; clean out the bad data.</span></span><br><span class="line"></span><br><span class="line">   pipeline.execute()</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">None</span></span><br></pre></td></tr></table></figure>

<p>Releasing the semaphore is almost as easy as before, only now we <strong>remove our identifier from both the owner and timeout <code>ZSET</code>s</strong>, as can be seen in this next listing.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">release_fair_semaphore</span><span class="params">(conn, semname, identifier)</span>:</span></span><br><span class="line">   pipeline = conn.pipeline(<span class="literal">True</span>)</span><br><span class="line">   pipeline.zrem(semname, identifier)</span><br><span class="line">   pipeline.zrem(semname + <span class="string">':owner'</span>, identifier)</span><br><span class="line">   <span class="keyword">return</span> pipeline.execute()[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/06/02/Redis-Manual/" data-id="ckaxrmfph00009cor310hfxk3" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-MySQL-Manual" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/05/26/MySQL-Manual/" class="article-date">
  <time datetime="2020-05-26T02:34:48.000Z" itemprop="datePublished">2020-05-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/05/26/MySQL-Manual/">MySQL Manual</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>IMPORTANT</strong>:<br>Much of the content here is a personal summary/abbrieviation of contents on the <a href="https://dev.mysql.com/doc/refman/8.0/en/tutorial.html" target="_blank" rel="noopener">Offical MySQL Guide</a>. For more complete information, please refer to the offical site.</p>
<hr>
<h2 id="MySQL-Intro"><a href="#MySQL-Intro" class="headerlink" title="MySQL Intro"></a>MySQL Intro</h2><p>The <strong>MySQL client program</strong> can be used to create and use a simple database. MySQL (sometimes referred to as the “terminal monitor” or just “monitor”) is an interactive program that enables you to <strong>connect to a MySQL server</strong>, run queries, and view the results.</p>
<p>The MySQL server package will install the <strong>MySQL database server</strong> which you can <strong>interact with using a MySQL client</strong>. You can use the MySQL client to send commands to any MySQL server; on a remote computer or your own.</p>
<p>The <strong>MySQL server is used to persist the data and provide a query interface for it (SQL)</strong>. The MySQL clients purpose is to allow you to use that query interface.</p>
<p>On how to setup your MySQL Server, please refer to <a href="https://jasonyux.github.io/2020/05/25/Docker-Manual/#MySQL-in-Docker" target="_blank" rel="noopener">here</a></p>
<h2 id="Connecting-to-a-MySQL-Server"><a href="#Connecting-to-a-MySQL-Server" class="headerlink" title="Connecting to a MySQL Server"></a>Connecting to a MySQL Server</h2><ul>
<li><p>If you have installed the MySQL server on Docker using the guide <a href="https://jasonyux.github.io/2020/05/25/Docker-Manual/#MySQL-in-Docker" target="_blank" rel="noopener">here</a>, then you should be already connected to your local SQL server. If not, try to run (assuming you have the container running):</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it &lt;yourSQLServerName&gt; mysql -u root -p</span><br></pre></td></tr></table></figure>
<p>  This will prompt to enter the password.</p>
<p>  If you entered successfully, you will see:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>If you want to connect to a remote SQL server, then you need to specify a <code>host</code> name. Contact your administrator to find out what connection parameters you should use to connect (that is, what <code>host</code>, <code>user</code> name, and <code>password</code> to use). Then, you would run:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mysql -h &lt;hostName&gt; -u &lt;userName&gt; -p</span><br><span class="line">Enter password: &lt;yourPasswordHere&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>To disconnect from that SQL server, simply run:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QUIT</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="Basic-Queries-in-MySQL-Client"><a href="#Basic-Queries-in-MySQL-Client" class="headerlink" title="Basic Queries in MySQL Client"></a>Basic Queries in MySQL Client</h2><p>Make sure that you are <strong>connected to the server</strong>, as discussed in the previous section. Doing so <strong>does not in itself select any database to work with</strong>, but that is okay. There are still several queries you can do to have a basic sense of how MySQL works:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT VERSION(), CURRENT_DATE;</span><br><span class="line">+-----------+--------------+</span><br><span class="line">| VERSION() | CURRENT_DATE |</span><br><span class="line">+-----------+--------------+</span><br><span class="line">| 8.0.20    | 2020-05-26   |</span><br><span class="line">+-----------+--------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> You <strong>need to have the semi-colon “<code>;</code>“ for ending your query</strong>, before pressing <code>enter</code>. If not, you will automatically goes to the next line to continue input. However, there are <strong>some exceptions where a semicolon may be omitted</strong>. <code>QUIT</code>, mentioned earlier, is one of them. We’ll get to others later.)</li>
<li><input disabled type="checkbox"> The query may be entered in any lettered case. The following queries are equivalent: <code>mysql&gt; SELECT VERSION(), CURRENT_DATE;</code> <code>mysql&gt; select version(), current_date;</code> <code>mysql&gt; SeLeCt vErSiOn(), current_DATE;</code> </li>
</ul>
</blockquote>
<p>From the simple command, you can see several things about a query:</p>
<ul>
<li><p>When you issue a query, MySQL <strong>sends it to the server</strong> for execution and displays the results, then prints another <code>mysql&gt;</code> prompt to indicate that it is ready for another query.</p>
</li>
<li><p>MySQL <strong>displays query output in tabular form (rows and columns)</strong>. The <strong>first row contains labels/titles</strong> for the columns. The <strong>rows following are the query results</strong>. Normally, column labels are the names of the columns you fetch from database tables. If you’re retrieving the value of <strong>an expression rather than an actual label/title</strong>, mysql labels the column <strong>using the expression itself</strong>.</p>
</li>
<li><p>MySQL shows, in the end, <strong>how many rows were returned and how long the query took to execute</strong>, which gives you a rough idea of <strong>server performance</strong>. These values are imprecise because they represent wall clock time (not CPU or machine time), and because they are affected by factors such as server load and network latency.</p>
</li>
</ul>
<p>Other examples of a query include:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select cos(pi()&#x2F;2), (4+1)*2;</span><br><span class="line">+-----------------------+---------+</span><br><span class="line">| cos(pi()&#x2F;2)           | (4+1)*2 |</span><br><span class="line">+-----------------------+---------+</span><br><span class="line">| 6.123233995736766e-17 |      10 |</span><br><span class="line">+-----------------------+---------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>and you can make <strong>two or more queries simultaneouly by using the delimiter “<code>;</code>“</strong>, for example to seperate the above query into two:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select cos(pi()&#x2F;2);select (4+1)*2;</span><br><span class="line">+-----------------------+</span><br><span class="line">| cos(pi()&#x2F;2)           |</span><br><span class="line">+-----------------------+</span><br><span class="line">| 6.123233995736766e-17 |</span><br><span class="line">+-----------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">+---------+</span><br><span class="line">| (4+1)*2 |</span><br><span class="line">+---------+</span><br><span class="line">|      10 |</span><br><span class="line">+---------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>finally, you can also use a multiline query as well, given that you had the correct punctuations in place :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select</span><br><span class="line">    -&gt; cos(pi()&#x2F;2)</span><br><span class="line">    -&gt; , (4+1)*2</span><br><span class="line">    -&gt; ;</span><br><span class="line">+-----------------------+---------+</span><br><span class="line">| cos(pi()&#x2F;2)           | (4+1)*2 |</span><br><span class="line">+-----------------------+---------+</span><br><span class="line">| 6.123233995736766e-17 |      10 |</span><br><span class="line">+-----------------------+---------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>
<p>or</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select cos(pi()&#x2F;2); select</span><br><span class="line">+-----------------------+</span><br><span class="line">| cos(pi()&#x2F;2)           |</span><br><span class="line">+-----------------------+</span><br><span class="line">| 6.123233995736766e-17 |</span><br><span class="line">+-----------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">    -&gt; (4+1)*2;</span><br><span class="line">+---------+</span><br><span class="line">| (4+1)*2 |</span><br><span class="line">+---------+</span><br><span class="line">|      10 |</span><br><span class="line">+---------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note </p>
<ul>
<li><input disabled type="checkbox"> <strong>If your line ended with a “<code>;</code>“</strong>, you cannot enter further input but to start another new command. In the above examples, notice how the prompt changes from <code>mysql&gt;</code> to <code>-&gt;</code>, which indicates you are at a line of a <strong>multiple-line query</strong>.</li>
</ul>
</blockquote>
<ul>
<li>To cancel the multiline query, you could use <code>\c</code>:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select user()</span><br><span class="line">    -&gt; \c</span><br><span class="line">\c</span><br><span class="line">^C</span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>

<p>Here is a table summarizing the prompts you will see in MySQL:</p>
<table>
<thead>
<tr>
<th>Prompt</th>
<th>Meaning</th>
</tr>
</thead>
<tbody><tr>
<td><code>mysql&gt;</code></td>
<td>Ready for new query</td>
</tr>
<tr>
<td><code>-&gt;</code></td>
<td>Waiting for next line of multiple-line query</td>
</tr>
<tr>
<td><code>&#39;&gt;</code></td>
<td>Waiting for next line, waiting for completion of a string that began with a single quote (<code>&#39;</code>)</td>
</tr>
<tr>
<td><code>&quot;&gt;</code></td>
<td>Waiting for next line, waiting for completion of a string that began with a double quote (<code>&quot;</code>)</td>
</tr>
<tr>
<td>``&gt;    `</td>
<td>Waiting for next line, waiting for completion of an identifier that began with a backtick (<code>`</code>)</td>
</tr>
<tr>
<td><code>/*&gt;</code></td>
<td>Waiting for next line, waiting for completion of a comment that began with <code>/*</code></td>
</tr>
</tbody></table>
<p>For example, if you have missed a <code>&#39;</code> at the end of the line:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM my_table WHERE name &#x3D; &#39;Smith AND age &lt; 30;</span><br><span class="line">    &#39;&gt;</span><br></pre></td></tr></table></figure>
<p>This means that <code>mysql</code> is <strong>expecting another <code>&#39;</code> at the end</strong>, which you have missed in this case.</p>
<p>The solution, sadly, is to <strong>cancel the input</strong> and do it corretcly the <strong>next time</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM my_table WHERE name &#x3D; &#39;Smith AND age &lt; 30;</span><br><span class="line">    &#39;&gt; \c</span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Viewing-and-Creating-a-Database"><a href="#Viewing-and-Creating-a-Database" class="headerlink" title="Viewing and Creating a Database"></a>Viewing and Creating a Database</h2><ul>
<li><p>To first <strong>see what databases you have access to</strong>, you can use the command:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">+--------------------+</span><br></pre></td></tr></table></figure>
<p>  These databases are the ones that <strong>you have access to</strong>. If you don’t have access to a database, you will not see it here.</p>
<p>  Then, to switch to use a database (for example, <code>sys</code>), you can run the command:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use sys</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> The <code>use</code> command is another command (exception) that does not require a semi-colon to end. However, it does no harm to put one in the end anyway.</li>
<li><input disabled type="checkbox"> Having access to a database means a lot. It means that you could insert or delete anything in that database. So usually to have an access to a database you would need to ask your administrator.</li>
</ul>
</blockquote>
</li>
<li><p>Now, to <strong>create a database</strong>, say you call it <code>test</code>, you could run:</p>
  <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create database test;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Under Unix, <strong>database names are case-sensitive</strong> (<strong>unlike SQL keywords</strong>), so you must always refer to your database as test, not as Test, TEST, or some other variant. </li>
</ul>
</blockquote>
<p>  However, at this point you have only created a database, and you are still in the database <code>sys</code> (follows from the previous example). To switch to the database <code>test</code> you created, you need to explicitly call again:</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use test;</span><br><span class="line">Database changed</span><br></pre></td></tr></table></figure>

<p>  Now, the next time you want to connect to the database <code>test</code>, you could directly run:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mysql -u root -p test</span><br><span class="line">Enter password: ********</span><br></pre></td></tr></table></figure>

<p>  and in general, to connect to a database <code>databaseName</code> from start up, you could do:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mysql -h &lt;hostName&gt; -u &lt;userName&gt; -p &lt;databaseName&gt;</span><br><span class="line">Enter password: ********</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> <code>&lt;databaseName&gt;</code> in the command just shown is <strong>not your password</strong>. If you want to supply your password on the <strong>command line after the <code>-p</code> option</strong>, you must <strong>do so with no intervening space (for example, as -p<password>, not as -p <password>)</password></password></strong>. However, putting your password on the command line is <strong>not recommended</strong>, because doing so exposes it to snooping by other users logged in on your machine.</li>
</ul>
</blockquote>
</li>
<li><p>To see <strong>which database you are currently in</strong>, you could use the query:</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select database();</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">| database() |</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">| test       |</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="Viewing-and-Creating-a-Table"><a href="#Viewing-and-Creating-a-Table" class="headerlink" title="Viewing and Creating a Table"></a>Viewing and Creating a Table</h2><ul>
<li><p>To see what tables you have in a database you are currently in, you can use:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show tables;</span><br><span class="line">Empty set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>  In this case, we are in the <code>test</code> database that we just created so there is nothing.</p>
</li>
<li><p>Now, consider the example on the <a href="#https://dev.mysql.com/doc/refman/8.0/en/creating-tables.html">MySQL site</a>, where you would like to record information for <strong>each of your pets</strong> (if you don’t have many, imagine you do). Then this can be called the <code>pet</code> <strong>table</strong>, and it should contain, as a bare minimum, <strong>each animal’s name</strong> (as an entry). Then, you could <strong>add other information</strong> about each of your pet in the table. For example, if more than one person in your family keeps pets, you might want to list each animal’s owner. You might also want to record some basic descriptive information such as species and sex.</p>
<p>  How about age? That might be of interest, but it is not a good thing to store in a database. <strong>Age changes as time passes</strong>, which means you’d have to update your records often. Instead, it is <strong>better</strong> to <strong>store a fixed value such as date of birth</strong>. Then, whenever you need age, you can calculate it as the difference between the current date and the birth date. MySQL provides functions for doing date arithmetic (as you saw before), so this is not difficult.</p>
<p>  You can probably think of other types of information that would be useful in the pet table, but the ones identified so far are sufficient and will be used in this example: <code>name</code>, <code>owner</code>, <code>species</code>, <code>sex</code>, <code>birth</code>, and <code>death</code>:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table pet (name varchar(20), owner varchar(20), species varchar(20), sex char(1), birth date, death date);</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br></pre></td></tr></table></figure>

<p>  Notice that we use <code>char()</code> and <code>varchar()</code>:</p>
<ul>
<li><p>The length of a <code>CHAR</code>/<code>char</code> column is <strong>fixed to the length that you declare when you create the table</strong>. For example, <strong><code>char(1)</code></strong> means it can <strong>hold up to 1 character</strong>. The length can be any value from 0 to 255. When <strong>CHAR values are stored</strong>, they are <strong>right-padded with spaces</strong> to the specified length. When CHAR values are <strong>retrieved</strong>, 8<em>trailing spaces are removed*</em> unless the <code>PAD_CHAR_TO_FULL_LENGTH</code> SQL mode is enabled.</p>
</li>
<li><p>Values in <code>VARCHAR</code> columns are <strong>variable-length strings</strong>.??? The length can be specified as a value from 0 to 65,535. The effective maximum length of a VARCHAR is subject to the maximum row size (65,535 bytes, which is shared among all columns) and the character set used. In contrast to <code>CHAR</code>, <code>VARCHAR</code> values are stored as a <strong>1-byte or 2-byte length prefix</strong> plus data. The <strong>length prefix indicates the number of bytes in the value</strong>. A column uses <strong>one length byte if values require no more than 255 bytes</strong>, <strong>two length bytes if values may require more than 255 bytes</strong>.</p>
<p>To make sure you have your table <code>pet</code> created as the way you wanted, you can run:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; describe pet;</span><br><span class="line">+---------+-------------+------+-----+---------+-------+</span><br><span class="line">| Field   | Type        | Null | Key | Default | Extra |</span><br><span class="line">+---------+-------------+------+-----+---------+-------+</span><br><span class="line">| name    | varchar(20) | YES  |     | NULL    |       |</span><br><span class="line">| owner   | varchar(20) | YES  |     | NULL    |       |</span><br><span class="line">| species | varchar(20) | YES  |     | NULL    |       |</span><br><span class="line">| sex     | char(1)     | YES  |     | NULL    |       |</span><br><span class="line">| birth   | date        | YES  |     | NULL    |       |</span><br><span class="line">| death   | date        | YES  |     | NULL    |       |</span><br><span class="line">+---------+-------------+------+-----+---------+-------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>If you have made a mistake somewhere, and you want to change the <code>type</code> or the <code>field</code> name, you could use:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; ALTER TABLE pet CHANGE &lt;fromFieldName&gt; &lt;toFieldName&gt; &lt;Type&gt;</span><br></pre></td></tr></table></figure>

<p>or if you only want to change the <code>type</code>, you can use:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; ALTER TABLE pet MODIFY &lt;fieldName&gt; &lt;newType&gt;</span><br></pre></td></tr></table></figure>
<p>(you <strong>cannot only modify the <code>field</code> name</strong>) More examples on modifying the table please refer to <a href="#https://dev.mysql.com/doc/refman/8.0/en/alter-table-examples.html">here</a>.</p>
</li>
</ul>
</li>
</ul>
<h2 id="Loading-and-Inserting-Data-into-a-Table"><a href="#Loading-and-Inserting-Data-into-a-Table" class="headerlink" title="Loading and Inserting Data into a Table"></a>Loading and Inserting Data into a Table</h2><p>After creating a table, you need to populate it. The <code>LOAD DATA</code> and <code>INSERT</code> statements are useful for this.</p>
<p>Suppose you have the following data as shown below (notice that MySQL expects <strong>dates in <code>YYYY-MM-DD</code> format</strong>):</p>
<p><img src="/.com//05/26/MySQL-Manual/pet-data.png" alt="https://dev.mysql.com/doc/refman/8.0/en/loading-tables.html" title="Table from https://dev.mysql.com/doc/refman/8.0/en/loading-tables.html"></p>
<p>Because you are beginning with an empty table, an easy way to populate it is to create a <strong>text file containing a row for each of your animals</strong>, then <code>load</code> the contents of the file into the table.</p>
<p>For exapmle, create a text file <code>pet.txt</code> containing <strong>one record per line</strong>, with values <strong>separated by tabs</strong>, (for <code>csv</code> files, refer to <a href="https://dev.mysql.com/doc/refman/8.0/en/load-data.html" target="_blank" rel="noopener">this</a>) and given <strong>in the order in which the columns were listed</strong> in the table. For <strong>missing values</strong> (such as unknown sexes or death dates for animals that are still living), you can <strong>use <code>\N</code></strong>, which represent null values:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Whistler        Gwen    bird    \N      1997-12-09      \N</span><br></pre></td></tr></table></figure>

<p>Then, you can import by:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; LOAD DATA LOCAL INFILE &#39;&#x2F;path&#x2F;pet.txt&#39; INTO TABLE pet;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> If you run into problems with importing a file, then probably you need to <strong>configure your SQL server</strong> for permission with file import. By default, this is <strong>disabled due to safety concerns</strong>. To configure this, please follow the guide <a href="#https://dev.mysql.com/doc/mysql-secure-deployment-guide/5.7/en/secure-deployment-post-install.html">here</a></li>
</ul>
</blockquote>
<p>When you want to <strong>add new records one at a time</strong>, the <code>INSERT</code> statement is useful. In its simplest form, you <strong>supply values for each column</strong>, <strong>in the order in which the columns were listed</strong> in the CREATE TABLE statement. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; INSERT INTO pet VALUES (&#39;Fluffy&#39;,&#39;Harold&#39;,&#39;cat&#39;,&#39;f&#39;,&#39;1993-02-04&#39;,NULL);</span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br></pre></td></tr></table></figure>
<p>Notice that <strong>String and date values are specified as quoted strings</strong> here. Also, with <code>INSERT</code>, you can <strong>insert <code>NULL</code> directly to represent a missing value</strong>. You <strong>do not use <code>\N</code></strong> like you do with <code>LOAD DATA</code>.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> The values in the table <strong>does not have to be distinct</strong>. This means that you can <code>INSERT</code> two same rows into the table without any trouble. However, to delete the non-distinct rows, you might need to do some <a href="https://www.sqlservertutorial.net/sql-server-basics/delete-duplicates-sql-server/" target="_blank" rel="noopener">work</a>.</li>
</ul>
</blockquote>
<h2 id="Retrieving-Selecting-All-Information-from-a-Table"><a href="#Retrieving-Selecting-All-Information-from-a-Table" class="headerlink" title="Retrieving/Selecting All Information from a Table"></a>Retrieving/Selecting All Information from a Table</h2><p>The <code>SELECT</code> statement is used to pull information from a table. The <strong>general form of the statement</strong> is:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT &lt;what_to_select&gt;</span><br><span class="line">FROM &lt;which_table&gt;</span><br><span class="line">WHERE &lt;conditions_to_satisfy&gt;;</span><br></pre></td></tr></table></figure>
<p>where</p>
<ul>
<li><code>&lt;what_to_select&gt;</code> indicates <strong>what you want to see</strong>. This can be a <strong>list of columns</strong>, or * to indicate “all columns.” </li>
<li><code>&lt;which_table&gt;</code> indicates the <strong>table from which you want to retrieve data</strong>. The WHERE clause is optional. </li>
<li><code>&lt;conditions_to_satisfy&gt;</code> specifies one or more <strong>conditions that rows must satisfy</strong> to qualify for retrieval, <strong>if it is present</strong>.</li>
</ul>
<p>This means you can select all data by simply running:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM pet;</span><br><span class="line">+----------+--------+---------+------+------------+------------+</span><br><span class="line">| name     | owner  | species | sex  | birth      | death      |</span><br><span class="line">+----------+--------+---------+------+------------+------------+</span><br><span class="line">| Fluffy   | Harold | cat     | f    | 1993-02-04 | NULL       |</span><br><span class="line">| Claws    | Gwen   | cat     | m    | 1994-03-17 | NULL       |</span><br><span class="line">| Buffy    | Harold | dog     | f    | 1989-05-13 | NULL       |</span><br><span class="line">| Fang     | Benny  | dog     | m    | 1990-08-27 | NULL       |</span><br><span class="line">| Bowser   | Diane  | dog     | m    | 1979-08-31 | 1995-07-29 |</span><br><span class="line">| Chirpy   | Gwen   | bird    | f    | 1998-09-11 | NULL       |</span><br><span class="line">| Whistler | Gwen   | bird    | NULL | 1997-12-09 | NULL       |</span><br><span class="line">| Slim     | Benny  | snake   | m    | 1996-04-29 | NULL       |</span><br><span class="line">| Puffball | Diane  | hamster | f    | 1999-03-30 | NULL       |</span><br><span class="line">+----------+--------+---------+------+------------+------------+</span><br></pre></td></tr></table></figure>
<p>However, if at this point, you have found that some values are wrong in a specific row, perhaps you miss-typed in your <code>txt</code> file, then you could either <strong>delete the entire table and re-insert the correct <code>txt</code></strong>, or <strong>updating that specific value</strong>:</p>
<ol>
<li><p>You can first fix your <code>txt</code> file and then run this:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; DELETE FROM pet;</span><br><span class="line">mysql&gt; LOAD DATA LOCAL INFILE &#39;pet.txt&#39; INTO TABLE pet;</span><br></pre></td></tr></table></figure></li>
<li><p>You could also only fix the wrong one (<code>Bowser</code>‘s <code>birth</code>, for example) by:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; UPDATE pet SET birth &#x3D; &#39;1989-08-31&#39; WHERE name &#x3D; &#39;Bowser&#39;;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="Selecting-a-Particular-Row"><a href="#Selecting-a-Particular-Row" class="headerlink" title="Selecting a Particular Row"></a>Selecting a Particular Row</h2><p>You can select only particular rows from your table, by <strong>specifying the <code>WHERE</code> option</strong>. For example, if you want to verify the change that you made to Bowser’s birth date, select Bowser’s record like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM pet WHERE name &#x3D; &#39;Bowser&#39;;</span><br><span class="line">+--------+-------+---------+------+------------+------------+</span><br><span class="line">| name   | owner | species | sex  | birth      | death      |</span><br><span class="line">+--------+-------+---------+------+------------+------------+</span><br><span class="line">| Bowser | Diane | dog     | m    | 1989-08-31 | 1995-07-29 |</span><br><span class="line">+--------+-------+---------+------+------------+------------+</span><br></pre></td></tr></table></figure>
<p>or </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT birth FROM pet WHERE name &#x3D; &#39;Bowser&#39;;</span><br><span class="line">+------------+</span><br><span class="line">| birth      |</span><br><span class="line">+------------+</span><br><span class="line">| 1989-08-31 |</span><br><span class="line">+------------+</span><br></pre></td></tr></table></figure>

<p>In general, you can specify <strong>any expression for the <code>WHERE</code> option as long as it can be evaluted to either <code>true</code> or <code>false</code></strong>. This means, for example, you can <strong>specify inequality</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM pet WHERE birth &gt;&#x3D; &#39;1998-1-1&#39;;</span><br><span class="line">+----------+-------+---------+------+------------+-------+</span><br><span class="line">| name     | owner | species | sex  | birth      | death |</span><br><span class="line">+----------+-------+---------+------+------------+-------+</span><br><span class="line">| Chirpy   | Gwen  | bird    | f    | 1998-09-11 | NULL  |</span><br><span class="line">| Puffball | Diane | hamster | f    | 1999-03-30 | NULL  |</span><br><span class="line">+----------+-------+---------+------+------------+-------+</span><br></pre></td></tr></table></figure>
<p>and you can use <strong>logical operators</strong> such as <strong>AND</strong> and <strong>OR</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM pet WHERE species &#x3D; &#39;dog&#39; AND sex &#x3D; &#39;f&#39;;</span><br><span class="line">+-------+--------+---------+------+------------+-------+</span><br><span class="line">| name  | owner  | species | sex  | birth      | death |</span><br><span class="line">+-------+--------+---------+------+------------+-------+</span><br><span class="line">| Buffy | Harold | dog     | f    | 1989-05-13 | NULL  |</span><br><span class="line">+-------+--------+---------+------+------------+-------+</span><br></pre></td></tr></table></figure>
<p>You can even combine the operators like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM pet WHERE (species &#x3D; &#39;cat&#39; AND sex &#x3D; &#39;m&#39;)</span><br><span class="line">       OR (species &#x3D; &#39;dog&#39; AND sex &#x3D; &#39;f&#39;);</span><br><span class="line">+-------+--------+---------+------+------------+-------+</span><br><span class="line">| name  | owner  | species | sex  | birth      | death |</span><br><span class="line">+-------+--------+---------+------+------------+-------+</span><br><span class="line">| Claws | Gwen   | cat     | m    | 1994-03-17 | NULL  |</span><br><span class="line">| Buffy | Harold | dog     | f    | 1989-05-13 | NULL  |</span><br><span class="line">+-------+--------+---------+------+------------+-------+</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> <code>AND</code> and <code>OR</code> may be intermixed, although <strong><code>AND</code> has higher precedence than <code>OR</code></strong>. If you use both operators, it is a good idea to <strong>use parentheses to indicate explicitly how conditions should be grouped.</strong></li>
<li><input disabled type="checkbox"> If you want querey for pets that are <code>not dead</code>, then you should use <code>death IS NOT NULL</code> rather than <code>death&lt;&gt;NULL</code> (yes, <code>&lt;&gt;</code> means not equal to) <strong>because NULL is a special value that cannot be compared</strong> using the usual comparison operators. This is discussed later. </li>
</ul>
</blockquote>
<h2 id="Selecting-Particular-Columns"><a href="#Selecting-Particular-Columns" class="headerlink" title="Selecting Particular Columns"></a>Selecting Particular Columns</h2><p>You can select a particular column by:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT owner FROM pet;</span><br><span class="line">+--------+</span><br><span class="line">| owner  |</span><br><span class="line">+--------+</span><br><span class="line">| Harold |</span><br><span class="line">| Gwen   |</span><br><span class="line">| Harold |</span><br><span class="line">| Benny  |</span><br><span class="line">| Diane  |</span><br><span class="line">| Gwen   |</span><br><span class="line">| Gwen   |</span><br><span class="line">| Benny  |</span><br><span class="line">| Diane  |</span><br><span class="line">+--------+</span><br></pre></td></tr></table></figure>
<p>If you want to see more than one column, use thet “<code>,</code>“ as the delimiter:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT name, birth FROM pet;</span><br><span class="line">+----------+------------+</span><br><span class="line">| name     | birth      |</span><br><span class="line">+----------+------------+</span><br><span class="line">| Fluffy   | 1993-02-04 |</span><br><span class="line">| Claws    | 1994-03-17 |</span><br><span class="line">| Buffy    | 1989-05-13 |</span><br><span class="line">| Fang     | 1990-08-27 |</span><br><span class="line">| Bowser   | 1989-08-31 |</span><br><span class="line">| Chirpy   | 1998-09-11 |</span><br><span class="line">| Whistler | 1997-12-09 |</span><br><span class="line">| Slim     | 1996-04-29 |</span><br><span class="line">| Puffball | 1999-03-30 |</span><br><span class="line">+----------+------------+</span><br></pre></td></tr></table></figure>
<p>You can combine <strong><code>WHERE</code> clause (row selection)</strong> with <strong>column selection</strong>. For example, to get <code>birth</code> dates for dogs and cats only, use this query:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT name, species, birth FROM pet</span><br><span class="line">       WHERE species &#x3D; &#39;dog&#39; OR species &#x3D; &#39;cat&#39;;</span><br><span class="line">+--------+---------+------------+</span><br><span class="line">| name   | species | birth      |</span><br><span class="line">+--------+---------+------------+</span><br><span class="line">| Fluffy | cat     | 1993-02-04 |</span><br><span class="line">| Claws  | cat     | 1994-03-17 |</span><br><span class="line">| Buffy  | dog     | 1989-05-13 |</span><br><span class="line">| Fang   | dog     | 1990-08-27 |</span><br><span class="line">| Bowser | dog     | 1989-08-31 |</span><br><span class="line">+--------+---------+------------+</span><br></pre></td></tr></table></figure>

<h2 id="Sorting-the-Table-by-Rows"><a href="#Sorting-the-Table-by-Rows" class="headerlink" title="Sorting the Table by Rows"></a>Sorting the Table by Rows</h2><ul>
<li><p>To sort a table (which is only <strong>meaningful w.r.t a particular row</strong>), use an <code>ORDER BY</code> clause, which by default sorts a <strong>comparable entry in a ascending order</strong>.</p>
<p>  For example, we could sort the animals by their <code>birth</code> date:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT name, birth FROM pet ORDER BY birth;</span><br><span class="line">+----------+------------+</span><br><span class="line">| name     | birth      |</span><br><span class="line">+----------+------------+</span><br><span class="line">| Buffy    | 1989-05-13 |</span><br><span class="line">| Bowser   | 1989-08-31 |</span><br><span class="line">| Fang     | 1990-08-27 |</span><br><span class="line">| Fluffy   | 1993-02-04 |</span><br><span class="line">| Claws    | 1994-03-17 |</span><br><span class="line">| Slim     | 1996-04-29 |</span><br><span class="line">| Whistler | 1997-12-09 |</span><br><span class="line">| Chirpy   | 1998-09-11 |</span><br><span class="line">| Puffball | 1999-03-30 |</span><br><span class="line">+----------+------------+</span><br></pre></td></tr></table></figure>

<p>  You can also sort by <code>name</code>, which would mean invoking <strong>comparison on character type</strong> entries. In this case, sorting — like all other comparison operations — <strong>is normally performed in a case-insensitive</strong> fashion. However, you can <strong>force a case-sensitive sort</strong> for a column by using <code>BINARY</code> like so: <code>ORDER BY BINARY &lt;col_name&gt;</code>.</p>
</li>
<li><p>To sort in a <strong>descending order</strong>, you need to add the option <strong><code>DESC</code> to the <code>&lt;col_name&gt;</code></strong> you are sorting:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT name, birth FROM pet ORDER BY birth DESC;</span><br><span class="line">+----------+------------+</span><br><span class="line">| name     | birth      |</span><br><span class="line">+----------+------------+</span><br><span class="line">| Puffball | 1999-03-30 |</span><br><span class="line">| Chirpy   | 1998-09-11 |</span><br><span class="line">| Whistler | 1997-12-09 |</span><br><span class="line">| Slim     | 1996-04-29 |</span><br><span class="line">| Claws    | 1994-03-17 |</span><br><span class="line">| Fluffy   | 1993-02-04 |</span><br><span class="line">| Fang     | 1990-08-27 |</span><br><span class="line">| Bowser   | 1989-08-31 |</span><br><span class="line">| Buffy    | 1989-05-13 |</span><br><span class="line">+----------+------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>You can also perform <strong>multiple sortings</strong>. This works by <strong>first sorting by the first criteria</strong> you specified. Then, <strong>within rows of the same first criteria, sort by the second criteria</strong>. This can propagate depending on your data.</p>
<p>  For example, to sort <strong>first by <code>type</code> of animal in ascending order</strong>, <strong>then by <code>birth</code> date within the same animal type in descending order</strong> (youngest animals first):</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT name, species, birth FROM pet</span><br><span class="line">       ORDER BY species, birth DESC;</span><br><span class="line">+----------+---------+------------+</span><br><span class="line">| name     | species | birth      |</span><br><span class="line">+----------+---------+------------+</span><br><span class="line">| Chirpy   | bird    | 1998-09-11 |</span><br><span class="line">| Whistler | bird    | 1997-12-09 |</span><br><span class="line">| Claws    | cat     | 1994-03-17 |</span><br><span class="line">| Fluffy   | cat     | 1993-02-04 |</span><br><span class="line">| Fang     | dog     | 1990-08-27 |</span><br><span class="line">| Bowser   | dog     | 1989-08-31 |</span><br><span class="line">| Buffy    | dog     | 1989-05-13 |</span><br><span class="line">| Puffball | hamster | 1999-03-30 |</span><br><span class="line">| Slim     | snake   | 1996-04-29 |</span><br><span class="line">+----------+---------+------------+</span><br></pre></td></tr></table></figure>

<p>  However, <strong>if all data are distinct</strong>, for example, then <strong>sorting by two criterias would be meaningless</strong>, as the result would be the <strong>same if you only sorted it by the first criteria</strong> you specified (you can try this yourself).</p>
</li>
<li><p>Lastly, you could combine <strong>row selections</strong> as well. However, here you need to specify <code>WHERE</code> before you specify <code>ORDER BY</code>, which makes sense because this can save computation time.</p>
<p>  For example, in the above sorting, I would only want to see <code>cat</code> and <code>dog</code>s, I could do:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT name, species, birth FROM pet</span><br><span class="line">       WHERE species&#x3D;&#39;cat&#39; OR species&#x3D;&#39;DOG&#39; ORDER BY species, birth DESC;</span><br><span class="line">+----------+---------+------------+</span><br><span class="line">| name     | species | birth      |</span><br><span class="line">+----------+---------+------------+</span><br><span class="line">| Claws    | cat     | 1994-03-17 |</span><br><span class="line">| Fluffy   | cat     | 1993-02-04 |</span><br><span class="line">| Fang     | dog     | 1990-08-27 |</span><br><span class="line">| Bowser   | dog     | 1989-08-31 |</span><br><span class="line">| Buffy    | dog     | 1989-05-13 |</span><br><span class="line">+----------+---------+------------+</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="Data-Calculations"><a href="#Data-Calculations" class="headerlink" title="Data Calculations"></a>Data Calculations</h2><p><strong>MySQL provides several functions</strong> that you can use to perform calculations. In this case, if we want to do calculations on dates, for example, to calculate ages or extract parts of dates, we could use <code>TIMESTAMPDIFF(unit,datetime_expr1,datetime_expr2)</code> function:</p>
<ul>
<li><code>Argument</code><ul>
<li><code>unit</code>, which will be the format of the result, has the following legal values: <code>MICROSECOND</code>(microseconds), <code>SECOND</code>, <code>MINUTE</code>, <code>HOUR</code>, <code>DAY</code>, <code>WEEK</code>, <code>MONTH</code>, <code>QUARTER</code>, or <code>YEAR</code>.</li>
<li><code>datetime_expr1</code> and <code>datetime_expr2</code> are date or datetime expressions.</li>
</ul>
</li>
<li><code>Returns</code><ul>
<li><code>datetime_expr2 − datetime_expr1</code> in the unit specified by <code>unit</code>. However, one expression may be a date and the other a datetime; in that case, a date value is treated as a datetime having the time part <code>&#39;00:00:00&#39;</code> where necessary. The unit for the result (an integer) is given by the unit argument. </li>
</ul>
</li>
</ul>
<p>Also, an alias (<code>AS age</code>) is used to make the final output column label more meaningful:</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT name, birth, CURDATE(),</span><br><span class="line">       TIMESTAMPDIFF(YEAR,birth,CURDATE()) AS age</span><br><span class="line">       FROM pet;</span><br><span class="line">+----------+------------+------------+------+</span><br><span class="line">| name     | birth      | CURDATE()  | age  |</span><br><span class="line">+----------+------------+------------+------+</span><br><span class="line">| Fluffy   | 1993-02-04 | 2003-08-19 |   10 |</span><br><span class="line">| Claws    | 1994-03-17 | 2003-08-19 |    9 |</span><br><span class="line">| Buffy    | 1989-05-13 | 2003-08-19 |   14 |</span><br><span class="line">| Fang     | 1990-08-27 | 2003-08-19 |   12 |</span><br><span class="line">| Bowser   | 1989-08-31 | 2003-08-19 |   13 |</span><br><span class="line">| Chirpy   | 1998-09-11 | 2003-08-19 |    4 |</span><br><span class="line">| Whistler | 1997-12-09 | 2003-08-19 |    5 |</span><br><span class="line">| Slim     | 1996-04-29 | 2003-08-19 |    7 |</span><br><span class="line">| Puffball | 1999-03-30 | 2003-08-19 |    4 |</span><br><span class="line">+----------+------------+------------+------+</span><br></pre></td></tr></table></figure></code></pre><p>You can then order it by <code>age</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT name, birth, CURDATE(),</span><br><span class="line">       TIMESTAMPDIFF(YEAR,birth,CURDATE()) AS age</span><br><span class="line">       FROM pet ORDER BY age;</span><br><span class="line">+----------+------------+------------+------+</span><br><span class="line">| name     | birth      | CURDATE()  | age  |</span><br><span class="line">+----------+------------+------------+------+</span><br><span class="line">| Chirpy   | 1998-09-11 | 2003-08-19 |    4 |</span><br><span class="line">| Puffball | 1999-03-30 | 2003-08-19 |    4 |</span><br><span class="line">| Whistler | 1997-12-09 | 2003-08-19 |    5 |</span><br><span class="line">| Slim     | 1996-04-29 | 2003-08-19 |    7 |</span><br><span class="line">| Claws    | 1994-03-17 | 2003-08-19 |    9 |</span><br><span class="line">| Fluffy   | 1993-02-04 | 2003-08-19 |   10 |</span><br><span class="line">| Fang     | 1990-08-27 | 2003-08-19 |   12 |</span><br><span class="line">| Bowser   | 1989-08-31 | 2003-08-19 |   13 |</span><br><span class="line">| Buffy    | 1989-05-13 | 2003-08-19 |   14 |</span><br><span class="line">+----------+------------+------------+------+</span><br></pre></td></tr></table></figure>

<p>But what if you want to know which animals have <strong>birthdays next mont</strong>h? For this type of calculation, year and day are irrelevant; you simply want to <strong>extract the month part of the <code>birth</code></strong> column. MySQL provides several functions for extracting parts of dates, such as <code>YEAR()</code>, <code>MONTH()</code>, and <code>DAYOFMONTH()</code>. <code>MONTH()</code> is the appropriate function here. To see how it works, run a simple query that displays the value of both birth and <code>MONTH(date)</code>:</p>
<ul>
<li><code>Argument</code><ul>
<li><code>date</code>, for example <code>&#39;2008-02-03&#39;</code></li>
</ul>
</li>
<li><code>Returns</code> <ul>
<li>the month for <code>date</code>, <strong>in the range 1 to 12 for January to December</strong>, or <strong>0 for dates such as ‘0000-00-00’ or ‘2008-00-00’ that have a zero month part</strong>.</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT name, birth, MONTH(birth) FROM pet;</span><br><span class="line">+----------+------------+--------------+</span><br><span class="line">| name     | birth      | MONTH(birth) |</span><br><span class="line">+----------+------------+--------------+</span><br><span class="line">| Fluffy   | 1993-02-04 |            2 |</span><br><span class="line">| Claws    | 1994-03-17 |            3 |</span><br><span class="line">| Buffy    | 1989-05-13 |            5 |</span><br><span class="line">| Fang     | 1990-08-27 |            8 |</span><br><span class="line">| Bowser   | 1989-08-31 |            8 |</span><br><span class="line">| Chirpy   | 1998-09-11 |            9 |</span><br><span class="line">| Whistler | 1997-12-09 |           12 |</span><br><span class="line">| Slim     | 1996-04-29 |            4 |</span><br><span class="line">| Puffball | 1999-03-30 |            3 |</span><br><span class="line">+----------+------------+--------------+</span><br></pre></td></tr></table></figure>

<p>and if you want to see pets that have birthday the <strong>current month</strong> (<strong>suppose it is May now</strong>), then you can do:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT name, birth FROM pet WHERE MONTH(birth) &#x3D; 5;</span><br><span class="line">+-------+------------+</span><br><span class="line">| name  | birth      |</span><br><span class="line">+-------+------------+</span><br><span class="line">| Buffy | 1989-05-13 |</span><br><span class="line">+-------+------------+</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> You might think that you could write <code>SELECT name, birth, MONTH(birth) as month FROM pet WHERE month= 5;</code> would be another option, as it works for sorting. Unfortunately, <strong>this would not work</strong> because standard SQL <strong>disallows references to column aliases</strong> in a <strong><code>WHERE</code> clause</strong>.</li>
</ul>
</blockquote>
<p>To see pets that have birthday the <strong>next month</strong>, you can use either the <code>DATE_ADD()</code> function or the <code>MOD()</code> function. For saving space, details for their arguments and return values are not explained here.</p>
<ol>
<li><p>To use the <code>DATE_ADD()</code> function to add a month to the current date:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT name, birth FROM pet</span><br><span class="line">       WHERE MONTH(birth) &#x3D; MONTH(DATE_ADD(CURDATE(),INTERVAL 1 MONTH));</span><br></pre></td></tr></table></figure>
</li>
<li><p>To use the <code>MOD()</code> function to calculate the value of the next month:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT name, birth FROM pet</span><br><span class="line">       WHERE MONTH(birth) &#x3D; MOD(MONTH(CURDATE())+1, 12);</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>If a calculation <strong>fails</strong>, it will produce <code>warning</code>s:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT &#39;2018-10-32&#39; + INTERVAL 1 DAY;</span><br><span class="line">+-------------------------------+</span><br><span class="line">| &#39;2018-10-32&#39; + INTERVAL 1 DAY |</span><br><span class="line">+-------------------------------+</span><br><span class="line">| NULL                          |</span><br><span class="line">+-------------------------------+</span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SHOW WARNINGS;</span><br><span class="line">+---------+------+----------------------------------------+</span><br><span class="line">| Level   | Code | Message                                |</span><br><span class="line">+---------+------+----------------------------------------+</span><br><span class="line">| Warning | 1292 | Incorrect datetime value: &#39;2018-10-32&#39; |</span><br><span class="line">+---------+------+----------------------------------------+</span><br></pre></td></tr></table></figure>

<h2 id="Working-with-NULL-Values"><a href="#Working-with-NULL-Values" class="headerlink" title="Working with NULL Values"></a>Working with <code>NULL</code> Values</h2><p>The NULL value can be surprising until you get used to it. Conceptually, NULL means “a missing unknown value” and it is treated somewhat differently from other values.</p>
<p>To test for NULL, use the <code>IS NULL</code> and <code>IS NOT NULL</code> operators, as shown here:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT 1 IS NULL, 1 IS NOT NULL;</span><br><span class="line">+-----------+---------------+</span><br><span class="line">| 1 IS NULL | 1 IS NOT NULL |</span><br><span class="line">+-----------+---------------+</span><br><span class="line">|         0 |             1 |</span><br><span class="line">+-----------+---------------+</span><br></pre></td></tr></table></figure>
<p>where you can think of <code>0</code> meaning <code>false</code> and <code>1</code> meaning <code>true</code>.</p>
<p>If you use arithmetic comparison operators such as <code>=</code>, <code>&lt;</code>, or <code>&lt;&gt;</code> to test for <code>NULL</code>, you will get the following result:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT 1 &#x3D; NULL, 1 &lt;&gt; NULL, 1 &lt; NULL, 1 &gt; NULL;</span><br><span class="line">+----------+-----------+----------+----------+</span><br><span class="line">| 1 &#x3D; NULL | 1 &lt;&gt; NULL | 1 &lt; NULL | 1 &gt; NULL |</span><br><span class="line">+----------+-----------+----------+----------+</span><br><span class="line">|     NULL |      NULL |     NULL |     NULL |</span><br><span class="line">+----------+-----------+----------+----------+</span><br></pre></td></tr></table></figure>
<p>This is because the result of <strong>any arithmetic comparison with <code>NULL</code> is also <code>NULL</code></strong>, so you cannot obtain any meaningful results from such comparisons.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> In <strong>MySQL</strong>, <code>0</code> or <code>NULL</code> means <code>false</code> and anything else means <code>true</code>. The <strong>default <code>true</code> value</strong> from a boolean operation is <code>1</code>.</li>
<li><input disabled type="checkbox"> Also, when doing an <code>ORDER BY</code>, <strong><code>NULL</code> values are presented first if you do <code>ORDER BY ... ASC</code></strong> and last if you do <code>ORDER BY ... DESC</code>.</li>
</ul>
</blockquote>
<h2 id="Pattern-Matching"><a href="#Pattern-Matching" class="headerlink" title="Pattern Matching"></a>Pattern Matching</h2><p>MySQL provides standard SQL pattern matching as well as a form of pattern matching based on <strong>extended regular expressions</strong> similar to those used by Unix utilities such as <strong>vi</strong>, <strong>grep</strong>, and <strong>sed</strong>.</p>
<ul>
<li><code>_</code> can be used to match/replace any single character </li>
<li><code>%</code> to match/replace an arbitrary number of characters (including zero characters). </li>
</ul>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> In MySQL, SQL patterns are <strong>case-insensitive by default</strong>. </li>
</ul>
</blockquote>
<p>Some examples are shown here. <strong>Do not use <code>=</code> or <code>&lt;&gt;</code> when you use SQL patterns</strong>. Use the <strong><code>LIKE</code> or <code>NOT LIKE</code> comparison operators</strong> instead.</p>
<ul>
<li><p>To find names beginning with <code>b</code> or <code>B</code> (because it is case-insensitive):</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM pet WHERE name LIKE &#39;b%&#39;;</span><br><span class="line">+--------+--------+---------+------+------------+------------+</span><br><span class="line">| name   | owner  | species | sex  | birth      | death      |</span><br><span class="line">+--------+--------+---------+------+------------+------------+</span><br><span class="line">| Buffy  | Harold | dog     | f    | 1989-05-13 | NULL       |</span><br><span class="line">| Bowser | Diane  | dog     | m    | 1989-08-31 | 1995-07-29 |</span><br><span class="line">+--------+--------+---------+------+------------+------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>To find names ending with <code>fy</code>:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM pet WHERE name LIKE &#39;%fy&#39;;</span><br><span class="line">+--------+--------+---------+------+------------+-------+</span><br><span class="line">| name   | owner  | species | sex  | birth      | death |</span><br><span class="line">+--------+--------+---------+------+------------+-------+</span><br><span class="line">| Fluffy | Harold | cat     | f    | 1993-02-04 | NULL  |</span><br><span class="line">| Buffy  | Harold | dog     | f    | 1989-05-13 | NULL  |</span><br><span class="line">+--------+--------+---------+------+------------+-------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>To find names containing a <code>w</code>:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM pet WHERE name LIKE &#39;%w%&#39;;</span><br><span class="line">+----------+-------+---------+------+------------+------------+</span><br><span class="line">| name     | owner | species | sex  | birth      | death      |</span><br><span class="line">+----------+-------+---------+------+------------+------------+</span><br><span class="line">| Claws    | Gwen  | cat     | m    | 1994-03-17 | NULL       |</span><br><span class="line">| Bowser   | Diane | dog     | m    | 1989-08-31 | 1995-07-29 |</span><br><span class="line">| Whistler | Gwen  | bird    | NULL | 1997-12-09 | NULL       |</span><br><span class="line">+----------+-------+---------+------+------------+------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>To find names containing exactly five characters, use five instances of the <code>_</code> pattern character:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM pet WHERE name LIKE &#39;_____&#39;;</span><br><span class="line">+-------+--------+---------+------+------------+-------+</span><br><span class="line">| name  | owner  | species | sex  | birth      | death |</span><br><span class="line">+-------+--------+---------+------+------------+-------+</span><br><span class="line">| Claws | Gwen   | cat     | m    | 1994-03-17 | NULL  |</span><br><span class="line">| Buffy | Harold | dog     | f    | 1989-05-13 | NULL  |</span><br><span class="line">+-------+--------+---------+------+------------+-------+</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>The other type of pattern matching provided by MySQL uses <strong>extended regular expressions</strong>. Those will be much more extensive and enables you to do much more. When you test for a match for this type of pattern, <strong>use the <code>REGEXP_LIKE(expr, pat[, match_type])</code></strong> function (or the <code>REGEXP</code> or <code>RLIKE</code> operators, which are synonyms for <code>REGEXP_LIKE()</code>).</p>
<ul>
<li><code>Arguement</code><ul>
<li><code>expr</code> a string of input</li>
<li><code>pat</code> a <strong>regular expression</strong> for matching the input. Examples of common <strong>regular expressions</strong> include:<ul>
<li><code>.</code> matches any single character.</li>
<li>A character class <code>[...]</code> matches <strong>any character for once within the brackets</strong>. For example, [abc] matches a, b, or c. To name a <strong>range of characters</strong>, use a dash. [a-z] matches any letter, whereas [0-9] matches any digit. Use <code>+</code> to match a character more than once. For example, <code>[a-z]+</code> would match any word.</li>
<li><code>*</code> matches <strong>zero or more instances of the thing preceding it</strong>. For example, <code>x*</code> matches any number of x characters, <strong>[0-9]* matches any number of digits</strong>, and <code>.*</code> matches <strong>any number of anything</strong>.</li>
<li>Use <code>^</code> at the beginning or <code>$</code> at the end of the pattern to <strong>anchor a pattern so that it must match the beginning or end of the value being tested, respectively.</strong></li>
<li>A regular expression pattern match succeeds <strong>if the pattern matches anywhere in the value being tested</strong>. (This differs from a <strong><code>LIKE</code> pattern match, which succeeds only if the pattern matches the entire value.</strong>)</li>
<li>for a complete reference, visit <a href="https://dev.mysql.com/doc/refman/8.0/en/regexp.html#regexp-syntax" target="_blank" rel="noopener">Regexp Syntax by MySQL</a></li>
</ul>
</li>
<li>optional <code>match_type</code> is a string that may contain any or all the following characters specifying how to perform matching:<ul>
<li><code>c</code>: <strong>Case sensitive matching</strong>.</li>
<li><code>i</code>: Case-insensitive matching.</li>
<li><code>m</code>: Multiple-line mode. Recognize line terminators within the string. The default behavior is to match line terminators only at the start and end of the string expression.</li>
<li><code>n</code>: The . character matches line terminators. The default is for . matching to stop at the end of a line.</li>
<li><code>u</code>: Unix-only line endings. Only the newline character is recognized as a line ending by the ., ^, and $ match operators.</li>
</ul>
</li>
</ul>
</li>
<li><code>Returns</code><ul>
<li>Returns <strong><code>1</code> if the string expr matches the regular expression</strong> specified by the pattern pat, <code>0</code> otherwise. If expr or pat is <code>NULL</code>, the return value is <code>NULL</code>.</li>
</ul>
</li>
</ul>
<p>For example, to find names beginning with b, use <code>^</code> to match the beginning of the name:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM pet WHERE REGEXP_LIKE(name, &#39;^b&#39;);</span><br><span class="line">+--------+--------+---------+------+------------+------------+</span><br><span class="line">| name   | owner  | species | sex  | birth      | death      |</span><br><span class="line">+--------+--------+---------+------+------------+------------+</span><br><span class="line">| Buffy  | Harold | dog     | f    | 1989-05-13 | NULL       |</span><br><span class="line">| Bowser | Diane  | dog     | m    | 1979-08-31 | 1995-07-29 |</span><br><span class="line">+--------+--------+---------+------+------------+------------+</span><br></pre></td></tr></table></figure>
<p>To find names ending with <code>fy</code>, use <code>$</code> to match the end of the name:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM pet WHERE REGEXP_LIKE(name, &#39;fy$&#39;);</span><br><span class="line">+--------+--------+---------+------+------------+-------+</span><br><span class="line">| name   | owner  | species | sex  | birth      | death |</span><br><span class="line">+--------+--------+---------+------+------------+-------+</span><br><span class="line">| Fluffy | Harold | cat     | f    | 1993-02-04 | NULL  |</span><br><span class="line">| Buffy  | Harold | dog     | f    | 1989-05-13 | NULL  |</span><br><span class="line">+--------+--------+---------+------+------------+-------+</span><br></pre></td></tr></table></figure>

<p>To force a regular expression comparison to be <strong>case sensitive</strong>, use a case-sensitive collation, or use the BINARY keyword to make one of the strings a binary string, or specify the <code>c</code> match-control character (as mentioend above). Each of these queries matches only lowercase b at the beginning of a name:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM pet WHERE REGEXP_LIKE(name, &#39;^b&#39; COLLATE utf8mb4_0900_as_cs);</span><br><span class="line">SELECT * FROM pet WHERE REGEXP_LIKE(name, BINARY &#39;^b&#39;);</span><br><span class="line">SELECT * FROM pet WHERE REGEXP_LIKE(name, &#39;^b&#39;, &#39;c&#39;);</span><br></pre></td></tr></table></figure>

<p>To find names containing a <code>w</code>, use this query:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM pet WHERE REGEXP_LIKE(name, &#39;w&#39;);</span><br><span class="line">+----------+-------+---------+------+------------+------------+</span><br><span class="line">| name     | owner | species | sex  | birth      | death      |</span><br><span class="line">+----------+-------+---------+------+------------+------------+</span><br><span class="line">| Claws    | Gwen  | cat     | m    | 1994-03-17 | NULL       |</span><br><span class="line">| Bowser   | Diane | dog     | m    | 1989-08-31 | 1995-07-29 |</span><br><span class="line">| Whistler | Gwen  | bird    | NULL | 1997-12-09 | NULL       |</span><br><span class="line">+----------+-------+---------+------+------------+------------+</span><br></pre></td></tr></table></figure>
<p>Because a regular expression pattern <strong>matches if it occurs anywhere in the value</strong>, it is <strong>not necessary in the previous query to put a wildcard on either side of the pattern</strong> to get it to match the entire value as would be true with an SQL pattern.</p>
<p>To find names containing <strong>exactly five characters</strong>, use <code>^</code> and <code>$</code> to match the beginning and end of the name, and five instances of <code>.</code> in between (simply <code>.....</code> would not work due to the fact that <strong>REGEXP() matches if it occurs anywhere in the value</strong>):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM pet WHERE REGEXP_LIKE(name, &#39;^.....$&#39;);</span><br><span class="line">+-------+--------+---------+------+------------+-------+</span><br><span class="line">| name  | owner  | species | sex  | birth      | death |</span><br><span class="line">+-------+--------+---------+------+------------+-------+</span><br><span class="line">| Claws | Gwen   | cat     | m    | 1994-03-17 | NULL  |</span><br><span class="line">| Buffy | Harold | dog     | f    | 1989-05-13 | NULL  |</span><br><span class="line">+-------+--------+---------+------+------------+-------+</span><br></pre></td></tr></table></figure>

<h2 id="Counting-Rows-and-Grouping-Frequencies"><a href="#Counting-Rows-and-Grouping-Frequencies" class="headerlink" title="Counting Rows and Grouping Frequencies"></a>Counting Rows and Grouping Frequencies</h2><p>Databases are often used to answer the question, “<strong>How often does a certain type of data occur</strong> in a table?” For example, you might want to know how many pets you have, or how many pets each owner has, or you might want to perform various kinds of census operations on your animals.</p>
<ul>
<li><p>Counting the <strong>total number of animals you have</strong> is the same question as “How many rows are in the pet table?” because there is one record per pet. <code>COUNT(*)</code> counts the number of rows, so the query to count your animals looks like this:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT COUNT(*) FROM pet;</span><br><span class="line">+----------+</span><br><span class="line">| COUNT(*) |</span><br><span class="line">+----------+</span><br><span class="line">|        9 |</span><br><span class="line">+----------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>The more useful case come when you use <code>COUNT()</code> in conjunction with <code>GROUP BY</code> for characterizing your data under various groupings. </p>
<ul>
<li><p>For example, if you want to find out how many pets each owner has:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT owner, COUNT(*) FROM pet GROUP BY owner;</span><br><span class="line">+--------+----------+</span><br><span class="line">| owner  | COUNT(*) |</span><br><span class="line">+--------+----------+</span><br><span class="line">| Benny  |        2 |</span><br><span class="line">| Diane  |        2 |</span><br><span class="line">| Gwen   |        3 |</span><br><span class="line">| Harold |        2 |</span><br><span class="line">+--------+----------+</span><br></pre></td></tr></table></figure>

<p>This works because <code>COUNT()</code> is a <strong>window function</strong>, whose result rows are determined from the <code>FROM</code> clause, <strong>after <code>WHERE</code>, <code>GROUP BY</code>, and <code>HAVING</code> processing</strong>, and windowing execution occurs before <code>ORDER BY</code>, <code>LIMIT</code>, and <code>SELECT DISTINCT</code>.</p>
<p>This means that it <strong>first <code>GROUP BY owner</code></strong>, and then shows <code>owner</code> and <code>COUNT(*)</code>. For a complete guide of how to use a <code>COUNT()</code>, please follow <a href="https://dev.mysql.com/doc/refman/8.0/en/group-by-functions.html#function_count" target="_blank" rel="noopener">this link</a>. For now, you just need to know that <code>COUNT()</code>:</p>
<ul>
<li><code>Return</code><ul>
<li>Returns a count of the number of non-NULL <strong>values of <code>expr</code> in the rows retrieved by a <code>SELECT</code></strong> statement</li>
</ul>
</li>
</ul>
</li>
<li><p>Similarly, you can also <code>GROUP BY species</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT species, COUNT(*) FROM pet GROUP BY species;</span><br><span class="line">+---------+----------+</span><br><span class="line">| species | COUNT(*) |</span><br><span class="line">+---------+----------+</span><br><span class="line">| bird    |        2 |</span><br><span class="line">| cat     |        2 |</span><br><span class="line">| dog     |        3 |</span><br><span class="line">| hamster |        1 |</span><br><span class="line">| snake   |        1 |</span><br><span class="line">+---------+----------+</span><br></pre></td></tr></table></figure></li>
<li><p>And number of animals per sex:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT sex, COUNT(*) FROM pet GROUP BY sex;</span><br><span class="line">+------+----------+</span><br><span class="line">| sex  | COUNT(*) |</span><br><span class="line">+------+----------+</span><br><span class="line">| NULL |        1 |</span><br><span class="line">| f    |        4 |</span><br><span class="line">| m    |        4 |</span><br><span class="line">+------+----------+</span><br></pre></td></tr></table></figure>
<p>where <code>NULL</code> means the sex is unknown.</p>
</li>
<li><p>You could also <strong>group by one than one categories</strong>. For example, you can group by <code>species</code> first and then <code>sex</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT species, sex, COUNT(*) FROM pet GROUP BY species, sex;</span><br><span class="line">+---------+------+----------+</span><br><span class="line">| species | sex  | COUNT(*) |</span><br><span class="line">+---------+------+----------+</span><br><span class="line">| bird    | NULL |        1 |</span><br><span class="line">| bird    | f    |        1 |</span><br><span class="line">| cat     | f    |        1 |</span><br><span class="line">| cat     | m    |        1 |</span><br><span class="line">| dog     | f    |        1 |</span><br><span class="line">| dog     | m    |        2 |</span><br><span class="line">| hamster | f    |        1 |</span><br><span class="line">| snake   | m    |        1 |</span><br><span class="line">+---------+------+----------+</span><br></pre></td></tr></table></figure></li>
<li><p>and finally, you can also use the <code>WHERE</code> clause to select only a proportion of data you want (<code>WHERE</code> executes before <code>GROUP BY</code>). For example, if you only want to see <code>cat</code> and <code>dog</code> data:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT species, sex, COUNT(*) FROM pet</span><br><span class="line">       WHERE species &#x3D; &#39;dog&#39; OR species &#x3D; &#39;cat&#39;</span><br><span class="line">       GROUP BY species, sex;</span><br><span class="line">+---------+------+----------+</span><br><span class="line">| species | sex  | COUNT(*) |</span><br><span class="line">+---------+------+----------+</span><br><span class="line">| cat     | f    |        1 |</span><br><span class="line">| cat     | m    |        1 |</span><br><span class="line">| dog     | f    |        1 |</span><br><span class="line">| dog     | m    |        2 |</span><br><span class="line">+---------+------+----------+</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h2 id="Using-Multiple-Tables"><a href="#Using-Multiple-Tables" class="headerlink" title="Using Multiple Tables"></a>Using Multiple Tables</h2><p>Suppose you have another table. Then a problem arise when you need to deal with data on both tables, namely, how do you <strong>combine and operate on data from multiple tables</strong>?</p>
<p>Now suppose you created another table to <strong>record other information about them</strong>, such as events in their lives like visits to the vet or when litters are born, and you put the following information in a <code>event</code> table:</p>
<p><img src="/.com//05/26/MySQL-Manual/pet-events.png" alt="Table from https://dev.mysql.com/doc/refman/8.0/en/multiple-tables.html" title="Table from https://dev.mysql.com/doc/refman/8.0/en/multiple-tables.html"></p>
<p>Suppose that you want to find out the <strong>ages at which each pet had its litters</strong>. We saw earlier how to calculate ages from two dates. The <code>litter</code> date of the mother is in the <code>event</code> table, but to calculate her age on that date you need her <code>birth</code> date, <strong>which is stored in the <code>pet</code> table</strong>. This means the query requires both tables:</p>
<ul>
<li><p>First, you need to know that <strong>tables are distinct in a database</strong>. This means that <strong>any column in a specific table in a database</strong> can be referred as: <code>&lt;tableName&gt;.&lt;colName&gt;</code>.</p>
</li>
<li><p>Now, to combine data from multiple tables, you can use <code>INNER JOIN</code> (for more details on <code>JOIN</code> clause, see <a href="https://dev.mysql.com/doc/refman/8.0/en/join.html" target="_blank" rel="noopener">here</a>), which can be used to <strong>combine the tables by permitsting rows from either table to appear</strong> in the result <strong>if and only if both tables meet the conditions specified in the <code>ON</code> clause</strong>. For example:</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT pet.name,</span><br><span class="line">       TIMESTAMPDIFF(YEAR,birth,date) AS age,</span><br><span class="line">       remark</span><br><span class="line">       FROM pet INNER JOIN event</span><br><span class="line">         ON pet.name &#x3D; event.name</span><br><span class="line">       WHERE event.type &#x3D; &#39;litter&#39;;</span><br><span class="line">+--------+------+-----------------------------+</span><br><span class="line">| name   | age  | remark                      |</span><br><span class="line">+--------+------+-----------------------------+</span><br><span class="line">| Fluffy |    2 | 4 kittens, 3 female, 1 male |</span><br><span class="line">| Buffy  |    4 | 5 puppies, 2 female, 3 male |</span><br><span class="line">| Buffy  |    5 | 3 puppies, 3 female         |</span><br><span class="line">+--------+------+-----------------------------+</span><br></pre></td></tr></table></figure>
<p>where you see in this example:</p>
<ul>
<li>When combining (joining) information from multiple tables, you need to specify how records in one table can be matched to records in the other (e.g. using the <code>ON</code> clause). This is easy because they both have a <code>name</code> column. The query uses an <code>ON pet.name=event.name</code> to match up records in the two tables <strong>if they have the same name value</strong>.</li>
</ul>
<p>However, you <strong>do not need to have two different tables</strong> to use the <code>INNER JOIN ... ON</code> functionality. You can <strong>use alias `AS</strong><code>. For example, to find possible **breeding pairs among your pets**, you can join the</code>pet` table with itself to produce candidate pairs of live <strong>males and females of like species</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT p1.name, p1.sex, p2.name, p2.sex, p1.species</span><br><span class="line">       FROM pet AS p1 INNER JOIN pet AS p2</span><br><span class="line">         ON p1.species &#x3D; p2.species</span><br><span class="line">         AND p1.sex &#x3D; &#39;f&#39; AND p1.death IS NULL</span><br><span class="line">         AND p2.sex &#x3D; &#39;m&#39; AND p2.death IS NULL;</span><br><span class="line">+--------+------+-------+------+---------+</span><br><span class="line">| name   | sex  | name  | sex  | species |</span><br><span class="line">+--------+------+-------+------+---------+</span><br><span class="line">| Fluffy | f    | Claws | m    | cat     |</span><br><span class="line">| Buffy  | f    | Fang  | m    | dog     |</span><br><span class="line">+--------+------+-------+------+---------+</span><br></pre></td></tr></table></figure>

<h2 id="Using-MySQL-in-Batch-Mode"><a href="#Using-MySQL-in-Batch-Mode" class="headerlink" title="Using MySQL in Batch Mode"></a>Using MySQL in Batch Mode</h2><p>Sometimes, if you have a <code>batch file</code> that you would like MySQL to execute, you can run <code>mysql</code> in <strong>batch mode</strong>. To do this, put the statements you want to run in a batch file (<strong>with <code>.sql</code> ending</strong>), then <strong>tell <code>mysql</code> to read its input from the file</strong>.</p>
<ul>
<li><p><strong>Outside of <code>mysql</code></strong>:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mysql &lt; &lt;your-batch-file&gt;</span><br></pre></td></tr></table></figure>

<p>  If you are running <code>mysql</code> under Windows and have some special characters in the file that cause problems, you can do this:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\&gt; mysql -e &quot;source &lt;your-batch-file&gt;&quot;</span><br></pre></td></tr></table></figure>

<p>  If you need to specify connection parameters on the command line, the command might look like this:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mysql -h host -u user -p &lt; &lt;your-batch-file&gt;</span><br><span class="line">Enter password: ********</span><br></pre></td></tr></table></figure>
</li>
<li><p>You can also use scripts from <strong>inside the <code>mysql</code> prompt</strong> by using the <code>source</code> command or <code>\.</code> command:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; source filename;</span><br><span class="line">mysql&gt; \. filename</span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> If you want the script to continue <strong>even if some of the statements in it produce errors</strong>, you should use the <code>--force</code> command-line option.  </li>
</ul>
</blockquote>
<p>In general, you would use scriptings in a batch mode if you need to:</p>
<ul>
<li>run a query <strong>repeatedly</strong> (say, every day or every week), making it a script enables you to avoid retyping it each time you execute it.</li>
<li>generate new queries from existing ones that are similar by copying and editing script files.</li>
<li><strong>distribute</strong> your script to other people so that they can also run the statements</li>
</ul>
<p>You have several <strong>options</strong> when using the batch mode as well. For example:</p>
<ul>
<li><p>if you have a query that <strong>produces a lot of output</strong>, you can run the output through a <strong>pager rather than watching it scroll off the top of your screen</strong>:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mysql &lt; batch-file | more</span><br></pre></td></tr></table></figure></li>
<li><p>You can catch the output in a file for further processing:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mysql &lt; batch-file &gt; mysql.out</span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> The output of <code>mysql</code> in batch mode is more concise than the output in a normal interative <code>mysql</code> prompt. For example, output of <code>SELECT DISTINCT species FROM pet</code> looks like this when <code>mysql</code> is run <code>interactively</code>:</li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------+</span><br><span class="line">| species |</span><br><span class="line">+---------+</span><br><span class="line">| bird    |</span><br><span class="line">| cat     |</span><br><span class="line">| dog     |</span><br><span class="line">| hamster |</span><br><span class="line">| snake   |</span><br><span class="line">+---------+</span><br></pre></td></tr></table></figure>
<p>In batch mode, the output looks like this instead:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">species</span><br><span class="line">bird</span><br><span class="line">cat</span><br><span class="line">dog</span><br><span class="line">hamster</span><br><span class="line">snake</span><br></pre></td></tr></table></figure>

<h2 id="Examples-of-Common-Query"><a href="#Examples-of-Common-Query" class="headerlink" title="Examples of Common Query"></a>Examples of Common Query</h2><p>Here, I only list some that I think are relatively less-straightforward than thought. For more examples, please refer to <a href="https://dev.mysql.com/doc/refman/8.0/en/examples.html" target="_blank" rel="noopener">the MySQL documentation</a>.</p>
<p>All examples are based on this table:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE TABLE shop (</span><br><span class="line">    article INT UNSIGNED  DEFAULT &#39;0000&#39; NOT NULL,</span><br><span class="line">    dealer  CHAR(20)      DEFAULT &#39;&#39;     NOT NULL,</span><br><span class="line">    price   DECIMAL(16,2) DEFAULT &#39;0.00&#39; NOT NULL,</span><br><span class="line">    PRIMARY KEY(article, dealer));</span><br><span class="line">mysql&gt; INSERT INTO shop VALUES</span><br><span class="line">    (1,&#39;A&#39;,3.45),(1,&#39;B&#39;,3.99),(2,&#39;A&#39;,10.99),(3,&#39;B&#39;,1.45),</span><br><span class="line">    (3,&#39;C&#39;,1.69),(3,&#39;D&#39;,1.25),(4,&#39;D&#39;,19.95);</span><br></pre></td></tr></table></figure>

<p>After issuing the statements, the table should have the following contents:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM shop ORDER BY article;</span><br><span class="line"></span><br><span class="line">+---------+--------+-------+</span><br><span class="line">| article | dealer | price |</span><br><span class="line">+---------+--------+-------+</span><br><span class="line">|       1 | A      |  3.45 |</span><br><span class="line">|       1 | B      |  3.99 |</span><br><span class="line">|       2 | A      | 10.99 |</span><br><span class="line">|       3 | B      |  1.45 |</span><br><span class="line">|       3 | C      |  1.69 |</span><br><span class="line">|       3 | D      |  1.25 |</span><br><span class="line">|       4 | D      | 19.95 |</span><br><span class="line">+---------+--------+-------+</span><br></pre></td></tr></table></figure>

<p>Notice: for each example, there are more than one solution. Here I only picked the ones that <strong>I think are easier to understand and remember</strong>:</p>
<ul>
<li><p>For each article, find the dealer or dealers with the most expensive price.</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SELECT s1.article, dealer, s1.price</span><br><span class="line">FROM shop s1</span><br><span class="line">JOIN (</span><br><span class="line">  SELECT article, MAX(price) AS price</span><br><span class="line">  FROM shop</span><br><span class="line">  GROUP BY article) AS s2</span><br><span class="line">  ON s1.article &#x3D; s2.article AND s1.price &#x3D; s2.price</span><br><span class="line">ORDER BY article;</span><br></pre></td></tr></table></figure>
<p>  This basically works by <strong>first finding the simple <code>MAX(price)</code></strong> for each article in one table, and then <code>JOIN</code> it with the <strong>other table</strong> (the same table but aliased differently) to display other data such as <code>dealer</code>.</p>
</li>
<li><p>Storing Data in a <strong>User-Defined Variable</strong></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT @min_price:&#x3D;MIN(price),@max_price:&#x3D;MAX(price) FROM shop;</span><br><span class="line">mysql&gt; SELECT * FROM shop WHERE price&#x3D;@min_price OR price&#x3D;@max_price;</span><br><span class="line">+---------+--------+-------+</span><br><span class="line">| article | dealer | price |</span><br><span class="line">+---------+--------+-------+</span><br><span class="line">|    0003 | D      |  1.25 |</span><br><span class="line">|    0004 | D      | 19.95 |</span><br><span class="line">+---------+--------+-------+</span><br></pre></td></tr></table></figure>

<p>  <strong>Properly</strong>, the variables would be written in the below format:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SET @&lt;var_name&gt; &#x3D; &lt;expr [, @var_name &#x3D; expr] ...&gt;</span><br></pre></td></tr></table></figure>

<p>  For example, you would properly write:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SET @min_price&#x3D;(SELECT MIN(price) FROM shop), @max_price&#x3D;(SELECT MAX(price) FROM shop);</span><br></pre></td></tr></table></figure>
<p>  But as seen in the above example, there is also a shortcut of writting it as:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT @min_price:&#x3D;MIN(price),@max_price:&#x3D;MAX(price) FROM shop;</span><br></pre></td></tr></table></figure>
<p>  (for more details on user-defined variables, refer to <a href="https://dev.mysql.com/doc/refman/8.0/en/user-variables.html" target="_blank" rel="noopener">here</a>.)</p>
</li>
<li><p>Searching Two Keys in a table</p>
<p>  This mostly happens when you use the keyword <code>OR</code>. And you might use the following to search for two keys:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT field1_index, field2_index FROM test_table</span><br><span class="line">WHERE field1_index &#x3D; &#39;1&#39; OR  field2_index &#x3D; &#39;1&#39;</span><br></pre></td></tr></table></figure>

<p>  However, it is clearer and efficient by using a <code>UNION</code> that <strong>combines the output of two separate <code>SELECT</code> statements</strong>. See Section <a href="https://dev.mysql.com/doc/refman/8.0/en/union.html" target="_blank" rel="noopener">MySQL <code>UNION</code> Clause</a> for more details.</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT field1_index, field2_index</span><br><span class="line">    FROM test_table WHERE field1_index &#x3D; &#39;1&#39;</span><br><span class="line">UNION</span><br><span class="line">SELECT field1_index, field2_index</span><br><span class="line">FROM test_table WHERE field2_index &#x3D; &#39;1&#39;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Counting Frequencies of a Distinct Number in a Table</p>
<p>  This can be done beautifully using the <code>BIT-WISE</code> operators (in this example, using the keyword <code>DISTINCT</code> would not work.)</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SELECT year,month,BIT_COUNT(BIT_OR(1&lt;&lt;day)) AS days FROM t1</span><br><span class="line">       GROUP BY year,month;</span><br><span class="line">+------+-------+------+</span><br><span class="line">| year | month | days |</span><br><span class="line">+------+-------+------+</span><br><span class="line">| 2000 |     1 |    3 |</span><br><span class="line">| 2000 |     2 |    2 |</span><br><span class="line">+------+-------+------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>  This would:</p>
<ul>
<li><p>First left shift the binary <code>1</code> for <code>number of day</code> times (<code>1&lt;&lt;day</code>). For example, <code>1&lt;&lt;3</code> means you get <code>1000</code>. This means that <strong>each day would have <code>1</code> at a distinct position</strong>. </p>
</li>
<li><p>Then, it does a <code>BIT_OR()</code>, which returns a binary number where each position would be <code>1</code> <strong>if one of the number had a <code>1</code> at that position</strong>,<code>0</code> otherwise. For instance, <code>1000</code> and <code>1</code> would give <code>1001</code>.</p>
</li>
<li><p>Lastly, it counts how many <code>1</code> there are in the number with the <code>BIT_COUNT()</code> function. At this point, this would only return the number of <strong>distinct days</strong>.</p>
<p>As a result, the query calculates how many different days appear in the table for each year/month combination, with automatic removal of duplicate entries.</p>
</li>
</ul>
</li>
<li><p>Auto-Increment</p>
<p>  The <code>AUTO_INCREMENT</code> attribute can be used to generate a unique identity for new rows:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE TABLE animals (</span><br><span class="line">     id MEDIUMINT NOT NULL AUTO_INCREMENT,</span><br><span class="line">     name CHAR(30) NOT NULL,</span><br><span class="line">     PRIMARY KEY (id));</span><br><span class="line"></span><br><span class="line">mysql&gt; INSERT INTO animals (name) VALUES</span><br><span class="line">    (&#39;dog&#39;),(&#39;cat&#39;),(&#39;penguin&#39;),</span><br><span class="line">    (&#39;lax&#39;),(&#39;whale&#39;),(&#39;ostrich&#39;);</span><br></pre></td></tr></table></figure>
<p>  Then if you run:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM animals;</span><br><span class="line">+----+---------+</span><br><span class="line">| id | name    |</span><br><span class="line">+----+---------+</span><br><span class="line">|  1 | dog     |</span><br><span class="line">|  2 | cat     |</span><br><span class="line">|  3 | penguin |</span><br><span class="line">|  4 | lax     |</span><br><span class="line">|  5 | whale   |</span><br><span class="line">|  6 | ostrich |</span><br><span class="line">+----+---------+</span><br></pre></td></tr></table></figure>
<p>where </p>
<ul>
<li><p>you see <strong>other ways of <code>INSERT INTO</code></strong>:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO table_name (column1, column2, column3, ...)</span><br><span class="line">VALUES (value1, value2, value3, ...);</span><br></pre></td></tr></table></figure>

<p>so that you speicify which columns to insert into with the <code>(column1, column2, column3, ...)</code>, meaning that you no longer have to insert into the table sequencially as the original label suggests.</p>
</li>
<li><p>a <code>PRIMARY KEY ()</code> is used. A primary key is used as a <strong>unique identifier to quickly parse data within the database</strong> and find the relation between different tables. A relational database cannot have more than one primary key, but it can be based on more than one field (for example, <code>PRIMARY KEY(id, name)</code>).</p>
<p>A <strong>primary key’s main features</strong> are:</p>
<ul>
<li>It must contain a <strong>unique value for each row of data</strong>.</li>
<li>It <strong>cannot contain null values</strong>.</li>
<li><strong>Every row must have a primary key value</strong>.</li>
</ul>
<p>A primary key is either an existing table column or a column that is specifically generated by the database according to a defined sequence</p>
</li>
<li><p>No value was specified for the <strong><code>AUTO_INCREMENT</code> column</strong></p>
<ul>
<li>so MySQL assigned sequence numbers automatically starting from <code>1</code>. You can only <strong>change it after creation</strong> with <code>ALTER TABLE animals AUTO_INCREMENT=10;</code>, for example.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>When you have <code>AUTO_INCREMENT</code> enabled, you still can <strong>explicitly assign other values to the column</strong> to generate sequence numbers. However, this will <strong>affect future data as well so they also start from that number</strong>. For example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO animals (id,name) VALUES(100,&#39;rabbit&#39;);</span><br><span class="line">INSERT INTO animals (id,name) VALUES(NULL,&#39;mouse&#39;);</span><br><span class="line">SELECT * FROM animals;</span><br><span class="line">+-----+-----------+</span><br><span class="line">| id  | name      |</span><br><span class="line">+-----+-----------+</span><br><span class="line">|   1 | dog       |</span><br><span class="line">|   2 | cat       |</span><br><span class="line">|   3 | penguin   |</span><br><span class="line">|   4 | lax       |</span><br><span class="line">|   5 | whale     |</span><br><span class="line">|   6 | ostrich   |</span><br><span class="line">| 100 | rabbit    |</span><br><span class="line">| 101 | mouse     |</span><br><span class="line">+-----+-----------+</span><br></pre></td></tr></table></figure>

<p>Also if you <strong>try to explicitly assign <code>0</code> or <code>NULL</code> to the column to generate sequence numbers</strong>, unless the <code>NO_AUTO_VALUE_ON_ZERO</code> SQL mode is enabled. For example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO animals (id,name) VALUES(0,&#39;groundhog&#39;);</span><br></pre></td></tr></table></figure>
<p>or </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO animals (id,name) VALUES(NULL,&#39;squirrel&#39;);</span><br></pre></td></tr></table></figure>

<p>You will obtain:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM animals;</span><br><span class="line">+-----+-----------+</span><br><span class="line">| id  | name      |</span><br><span class="line">+-----+-----------+</span><br><span class="line">|   1 | dog       |</span><br><span class="line">|   2 | cat       |</span><br><span class="line">|   3 | penguin   |</span><br><span class="line">|   4 | lax       |</span><br><span class="line">|   5 | whale     |</span><br><span class="line">|   6 | ostrich   |</span><br><span class="line">| 100 | rabbit    |</span><br><span class="line">| 101 | mouse     |</span><br><span class="line">| 102 | groundhog |</span><br><span class="line">| 103 | squirrel  |</span><br><span class="line">+-----+-----------+</span><br></pre></td></tr></table></figure>

<h2 id="Auto-Increment-in-MyISAM-Tables"><a href="#Auto-Increment-in-MyISAM-Tables" class="headerlink" title="Auto-Increment in MyISAM Tables"></a>Auto-Increment in MyISAM Tables</h2><p>For <code>MyISAM</code> tables, <strong>you can specify <code>AUTO_INCREMENT</code> on a secondary column</strong> in a <strong>multiple-column index</strong>. In this case, the generated value for the <code>AUTO_INCREMENT</code> column is calculated as <code>MAX(auto_increment_column) + 1</code> WHERE <code>prefix=given-prefix</code>. This is useful when you want to put data into ordered groups.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE TABLE animals (</span><br><span class="line">    grp ENUM(&#39;fish&#39;,&#39;mammal&#39;,&#39;bird&#39;) NOT NULL,</span><br><span class="line">    id MEDIUMINT NOT NULL AUTO_INCREMENT,</span><br><span class="line">    name CHAR(30) NOT NULL,</span><br><span class="line">    PRIMARY KEY (grp,id)</span><br><span class="line">) ENGINE&#x3D;MyISAM;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; INSERT INTO animals (grp,name) VALUES</span><br><span class="line">    (&#39;mammal&#39;,&#39;dog&#39;),(&#39;mammal&#39;,&#39;cat&#39;),</span><br><span class="line">    (&#39;bird&#39;,&#39;penguin&#39;),(&#39;fish&#39;,&#39;lax&#39;),(&#39;mammal&#39;,&#39;whale&#39;),</span><br><span class="line">    (&#39;bird&#39;,&#39;ostrich&#39;);</span><br></pre></td></tr></table></figure>

<p>Now, if you look at the table:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM animals ORDER BY grp,id;</span><br><span class="line"></span><br><span class="line">+--------+----+---------+</span><br><span class="line">| grp    | id | name    |</span><br><span class="line">+--------+----+---------+</span><br><span class="line">| fish   |  1 | lax     |</span><br><span class="line">| mammal |  1 | dog     |</span><br><span class="line">| mammal |  2 | cat     |</span><br><span class="line">| mammal |  3 | whale   |</span><br><span class="line">| bird   |  1 | penguin |</span><br><span class="line">| bird   |  2 | ostrich |</span><br><span class="line">+--------+----+---------+</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/05/26/MySQL-Manual/" data-id="ckanbfo2o0000bgor6z3p52d2" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Docker-Manual" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/05/25/Docker-Manual/" class="article-date">
  <time datetime="2020-05-25T07:18:39.000Z" itemprop="datePublished">2020-05-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/05/25/Docker-Manual/">Docker Manual</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<p><strong>IMPORTANT</strong>:<br>Much of the content here is a personal summary/abbrieviation of contents on the <a href="https://docs.docker.com/get-started/" target="_blank" rel="noopener">Offical Docker Guide</a>. For more complete information, please refer to the offical site.</p>
<hr>
<h2 id="Docker-Intro"><a href="#Docker-Intro" class="headerlink" title="Docker Intro"></a>Docker Intro</h2><p>Docker provides the ability to package and run an application in a loosely isolated environment called a <strong><code>container</code></strong>, which <strong>separate your applications from your infrastructure</strong>. The <strong>isolation and security</strong> allow you to run many containers simultaneously on a given host.</p>
<p>The use of <code>container</code>s to deploy applications is called containerization. Containers are not new, but their use for easily deploying applications is.</p>
<p>Docker provides tooling and a platform to manage the lifecycle of your <code>container</code>s:</p>
<ul>
<li>Develop your application and its supporting components using <code>container</code>s.</li>
<li>The <code>container</code> becomes the unit for distributing and testing your application.</li>
<li>When you’re ready, deploy your application into your production environment, as a <code>container</code> or an orchestrated service. This works the same whether your production environment is a local data center, a cloud provider, or a hybrid of the two.</li>
</ul>
<h2 id="Docker-Basics"><a href="#Docker-Basics" class="headerlink" title="Docker Basics"></a>Docker Basics</h2><p><strong>Docker is mainly composed of the following elements</strong> (the first three is referred as Docker Engine by the official site): </p>
<ul>
<li><strong>A server</strong> (<code>docker daemon</code>) which is a type of long-running program called a daemon process (the <code>dockerd</code>command).</li>
<li><strong>A command line interface (CLI)</strong> client that is used by most users (the <code>docker</code>command).</li>
<li><strong>A REST API</strong> which specifies interfaces that <strong>CLI</strong> programs can use to <strong>talk to the daemon</strong> and <strong>instruct it what to do</strong>.</li>
<li><strong>A Docker registry</strong>, which stores Docker images. Docker Hub is a public registry that anyone can use, and Docker is configured to look for images on Docker Hub by default.</li>
</ul>
<p>So we see that Docker uses a client-server architecture. The <strong><code>docker client</code> talks to the <code>docker daemon</code></strong>, which does the heavy lifting of building, running, and distributing your Docker containers. The Docker <code>client</code> and <code>daemon</code> can run on the same system, or you can connect a Docker client to a remote Docker daemon.</p>
<h2 id="Docker-Architecture"><a href="#Docker-Architecture" class="headerlink" title="Docker Architecture"></a>Docker Architecture</h2><ul>
<li><p>The <strong>Docker <code>daemon</code></strong></p>
<ul>
<li>The Docker <code>daemon</code> (<code>dockerd</code>) listens for Docker API requests and manages Docker objects such as <code>images</code>, <code>container</code>s, networks, and volumes. A daemon can also communicate with other daemons to manage Docker services.</li>
</ul>
</li>
<li><p><strong>The Docker <code>client</code></strong></p>
<ul>
<li>The Docker <code>client</code> (<code>docker</code>) is the primary way that many Docker users interact with Docker. When you use commands such as <code>docker run</code>, the client sends these commands to <code>dockerd</code>, which carries them out. The docker command uses the Docker API. The Docker client can communicate with more than one daemon.</li>
</ul>
</li>
<li><p><strong>Docker registries</strong></p>
<ul>
<li>A Docker registry stores Docker <code>image</code>s. Docker Hub is a public registry that anyone can use, and Docker is configured to look for images on Docker Hub by default. You can even run your own private registry. If you use Docker Datacenter (DDC), it includes Docker Trusted Registry (DTR).</li>
</ul>
</li>
<li><p><strong>Docker objects</strong></p>
<ul>
<li>When you use Docker, you are creating and using <code>images</code>, <code>container</code>s, networks, volumes, plugins, and other objects. The section below is a brief overview of some of those objects.</li>
</ul>
</li>
</ul>
<h2 id="Docker-Objects"><a href="#Docker-Objects" class="headerlink" title="Docker Objects"></a>Docker Objects</h2><ul>
<li><p><code>IMAGE</code></p>
<ul>
<li>An <code>image</code> is a <strong>read-only template</strong> with <strong>instructions for creating a Docker <code>container</code></strong>. Often, an <code>image</code> is based on another <code>image</code>, with some additional customization. For example, you may build an image which is based on the ubuntu image, but installs the Apache web server and your application, as well as the configuration details needed to make your application run.</li>
</ul>
</li>
<li><p><code>CONTAINER</code></p>
<ul>
<li><p>A container is a <strong>runnable instance of an <code>image</code></strong>. You can create, start, stop, move, or delete a <code>container</code> using the Docker API or CLI. You can connect a <code>container</code> to one or more networks, attach storage to it, or even create a new image based on its current state.</p>
<p>Fundementally, a <strong><code>container</code> is nothing but a running process, with some added encapsulation features applied to it in order to keep it isolated from the host and from other containers</strong>. One of the most important aspects of container isolation is that each container interacts with its <strong>own private filesystem</strong>.</p>
<p>By default, a container is relatively well isolated from other <code>container</code>s and its host machine. You can control how isolated a container’s network, storage, or other underlying subsystems are from other containers or from the host machine.</p>
<p>A <code>container</code> is <strong>defined by its image as well as any configuration options you provide to it when you create or start it</strong>. When a container is <strong>removed</strong>, any changes to its state that are <strong>not stored in persistent storage</strong> disappear.</p>
</li>
</ul>
</li>
<li><p><code>SERVICE</code></p>
<ul>
<li><p>Services allow you to <strong>scale <code>container</code>s across multiple Docker <code>daemons</code></strong>, which all work together as a swarm with multiple managers and workers. Each member of a swarm is a Docker <code>daemon</code>, and all the daemons communicate using the Docker API. A <code>service</code> allows you to <strong>define states</strong>, such as the <strong>number of replicas of the service</strong> that must be available at any given time. </p>
<p>By default, the service is <strong>load-balanced across all worker nodes</strong>. To the consumer, the Docker service appears to be a single application. Docker Engine supports swarm mode in Docker 1.12 and higher.</p>
</li>
</ul>
</li>
</ul>
<h2 id="Installing-Docker"><a href="#Installing-Docker" class="headerlink" title="Installing Docker"></a>Installing Docker</h2><p>Please follow the <a href="#https://docs.docker.com/get-started/">Official Guide</a>.</p>
<h2 id="Basic-Workflow"><a href="#Basic-Workflow" class="headerlink" title="Basic Workflow"></a>Basic Workflow</h2><p>In general, the development workflow for containerized applications looks like this:</p>
<ol>
<li><strong>Create</strong> a Docker <code>image</code> containing the components of your application</li>
<li><strong>Test</strong> those components</li>
<li><strong>Assemble</strong> your containers using the <code>image</code> file and supporting infrastructure into a complete application</li>
<li>Test, share, and deploy your complete containerized application.</li>
</ol>
<h2 id="Quickstart-for-Building-an-Image-and-a-Container"><a href="#Quickstart-for-Building-an-Image-and-a-Container" class="headerlink" title="Quickstart for Building an Image and a Container"></a>Quickstart for Building an Image and a Container</h2><p>First, we could use an existing project to demonstrate some concepts mentioned above.</p>
<ol>
<li><p>Run:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;dockersamples&#x2F;node-bulletin-board</span><br><span class="line">cd node-bulletin-board&#x2F;bulletin-board-app</span><br></pre></td></tr></table></figure>

<p> Then you will see that there is a file called <strong><code>Dockerfile</code></strong>. <strong><code>Dockerfile</code></strong>s describe <strong>how to build an <code>image</code> and assemble a <code>container</code></strong> with a private filesystem, and can also contain some metadata describing <strong>how to run a <code>container</code></strong> based on this image. </p>
<p> The bulletin board app <strong><code>Dockerfile</code></strong> looks like this:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># Use the official image as a parent image.</span><br><span class="line">FROM node:current-slim</span><br><span class="line"></span><br><span class="line"># Set the working directory.</span><br><span class="line">WORKDIR &#x2F;usr&#x2F;src&#x2F;app</span><br><span class="line"></span><br><span class="line"># Copy the file from your host to your current location.</span><br><span class="line">COPY package.json .</span><br><span class="line"></span><br><span class="line"># Run the command inside your image filesystem.</span><br><span class="line">RUN npm install</span><br><span class="line"></span><br><span class="line"># Inform Docker that the container is listening on the specified port at runtime.</span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line"># Run the specified command within the container.</span><br><span class="line">CMD [ &quot;npm&quot;, &quot;start&quot; ]</span><br><span class="line"></span><br><span class="line"># Copy the rest of your app&#39;s source code from your host to your image filesystem.</span><br><span class="line">COPY . .</span><br></pre></td></tr></table></figure>
<p> You can think of these <strong><code>Dockerfile</code></strong> commands as a step-by-step recipe on how to build up your <code>image</code>. </p>
</li>
<li><p>Make sure you’re in the directory <code>node-bulletin-board/bulletin-board-app</code> in a terminal or PowerShell using the cd command. Let’s build your bulletin board <code>image</code>:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build --tag bulletinboard:1.0 .</span><br></pre></td></tr></table></figure>

<p> You’ll see <strong>Docker step through each instruction in your <code>Dockerfile</code></strong>, building up your <code>image</code> as it goes: </p>
<ul>
<li><p>Start <strong>FROM</strong> the pre-existing <code>node:current-slim</code> image. This is an official image, built by the node.js vendors and validated by Docker to be a high-quality image containing the Node.js Long Term Support (LTS) interpreter and basic dependencies.</p>
</li>
<li><p>Use <strong>WORKDIR</strong> to specify that all subsequent actions should be taken from the directory /usr/src/app in your image filesystem (never the host’s filesystem).</p>
</li>
<li><p><strong>COPY</strong> the file <code>package.json</code> from your host to the present location (<code>.</code>) in your image (so in this case, to /usr/src/app/package.json)</p>
</li>
<li><p><strong>RUN</strong> the command <code>npm install</code> inside your image filesystem (which will read <code>package.json</code> to determine your app’s node dependencies, and install them)</p>
</li>
<li><p><strong>COPY</strong> in the rest of your app’s source code from your host to your image filesystem.</p>
<p>If successful, the build process should end with a message <code>Successfully tagged bulletinboard:1.0</code>.</p>
<p>The steps above built up the filesystem of our image, but there are other lines in your <code>Dockerfile</code>.</p>
</li>
<li><p>The <strong>CMD</strong> directive is the first example of specifying some metadata in your <code>image</code> that <strong>describes how to run a container based on this image</strong>. In this case, it’s saying that the containerized process that this <code>image</code> is meant to support is <code>npm start</code>.</p>
</li>
<li><p>The <strong>EXPOSE</strong> <code>8080</code> informs Docker that the container is listening on port <code>8080</code> at runtime.</p>
</li>
</ul>
</li>
<li><p>Now you have an <code>image</code> and you can start a <code>container</code> based on the <code>image</code>:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --publish 8000:8080 --detach --name  bb bulletinboard:1.0</span><br></pre></td></tr></table></figure>

<p> This has a couple of common flags:</p>
<ul>
<li><code>--publish</code> asks Docker to <strong>forward traffic incoming on the host’s port 8000</strong>, <strong>to the container’s port 8080</strong>. Containers have their own private set of ports, so if you want to reach one from the network, you have to forward traffic to it in this way. Otherwise, firewall rules will prevent all network traffic from reaching your container, as a default security posture.</li>
<li><code>--detach</code> asks Docker to <strong>run this container in the background</strong>.</li>
<li><code>--name</code> specifies a <strong>name with which you can refer to your container in subsequent commands</strong>, in this case <code>bb</code>.</li>
</ul>
</li>
<li><p>Now, you can visit the application in a browser at <code>localhost:8000</code>. <strong>At this step</strong>, it would be the time to <strong>run unit tests</strong>, for example. You would normally do everything you could to ensure your container works the way you expected.</p>
<p> Once you’re satisfied that your bulletin board container works correctly, you can delete it:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rm --force bb</span><br></pre></td></tr></table></figure>

<p> The <code>--force</code> option stops a running container, so it can be removed. If you stop the container running with <code>docker stop bb</code> first, then you do not need to use <code>--force</code> to remove it.</p>
</li>
</ol>
<p>At this point, you’ve successfully <strong>built an <code>image</code></strong>, <strong>performed a simple containerization of an application using that <code>image</code></strong>, and confirmed that your app runs successfully in its container.</p>
<h2 id="Quickstart-for-Sharing-Images-on-Docker-Hub"><a href="#Quickstart-for-Sharing-Images-on-Docker-Hub" class="headerlink" title="Quickstart for Sharing Images on Docker Hub"></a>Quickstart for Sharing Images on Docker Hub</h2><p>At this point, <strong>you’ve built a containerized application</strong>. The final step is to <strong>share your images on a <code>registry</code> like Docker Hub</strong>, so they can be easily downloaded and run on any destination machine. (first you need to have a Docker Hub account, if needed help, follow <a href="#https://docs.docker.com/get-started/part3/#set-up-your-docker-hub-account">this guide</a>)</p>
<ol>
<li><p>Once you have an account, you need to create a repository. At this point, you can only <strong>specify a repository name</strong>, for example, <code>bulletin</code>, and click create.</p>
</li>
<li><p>Now you are ready to share your <code>image</code> on Docker Hub, but there’s <strong>one thing you must do first</strong>: images must be <strong>namespaced correctly to share on Docker Hub</strong>. Specifically, you must name images like <code>&lt;Docker ID&gt;/&lt;Repository Name&gt;:&lt;tag&gt;</code>.</p>
<p> For example, if your username is <code>abc</code> and the name of your created repository is <code>bulletin</code>, then you <strong>need to tag your image to be: <code>abc/bulletin:&lt;whateverVersionHere&gt;</code></strong>. This is because, when you push in the next step, Docker will look up specifically at location <code>abc/bulletin</code> in Docker Hub. If you spelled something wrongly, it will not go to the correct location.</p>
</li>
<li><p>Finally, push your <code>image</code> to Docker Hub. For example, like this:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push abc&#x2F;bulletin:1.0</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>Now that your image is available on Docker Hub, you’ll be able to run it anywhere. By moving images around in this way, you <strong>no longer need to install any dependencies except Docker on the machines</strong> you want to run your software on. The dependencies of containerized applications are completely encapsulated and isolated within your images, which you can share using Docker Hub as described above.</p>
<p>However, there is one thing to keep in mind: at the moment, you’ve only <strong>pushed your <code>image</code></strong> to Docker Hub; <strong>what about your <code>Dockerfile</code></strong>? A crucial best practice is to <strong>keep these in version control (e.g.  using <code>git</code>), perhaps alongside your source code for your application</strong>. You can add a link or note in your Docker Hub repository description indicating where these files can be found, preserving the record not only of how your image was built, but how it’s meant to be run as a full application.</p>
<h2 id="Starting-and-Stopping-Containers"><a href="#Starting-and-Stopping-Containers" class="headerlink" title="Starting and Stopping Containers"></a>Starting and Stopping Containers</h2><ul>
<li><p>To create a new <code>container</code> from an <code>image</code> and start it, use <code>docker run</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run [options] &lt;image&gt; [command] [argument]</span><br></pre></td></tr></table></figure>

<p>  Usually, you would want to specify a name for your container, which means you add the <code>--name</code> option. For example:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run ––name&#x3D;Ubuntu-Test ubuntu:14.04</span><br></pre></td></tr></table></figure>
<p>  where <code>ubuntu:14.04</code> would be the <code>ubuntu</code> image with version/tag <code>14.04</code>. However, if you do not define a name for your newly created container, the <code>deamon</code> will <strong>generate a random string name</strong>, which you can later check with the <code>docker ps</code> command (see the section <a href="#Viewing-and-Removing-Containers">Viewing and Removing Containers</a>)</p>
<p>  However, this would only start a <code>container</code>. If you would like to interact with it, you need to add the <code>–i</code> and <code>–t</code> options to enter the interative mode. For example, to enter the Ubuntu bash in the ubuntu container created in the above example, you could run:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run –it ––name&#x3D;Ubuntu_Test ubuntu:14.04</span><br></pre></td></tr></table></figure>
<p>  Instead of using <code>-i</code> or <code>-t</code> options, use the <code>attach</code> command to connect to a running container as well:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker attach container_id</span><br></pre></td></tr></table></figure>
<p>  (To <strong>exit the container</strong>, you can type <code>EXIT</code>)</p>
</li>
<li><p>To stop a <code>container</code>, you could use the <code>docker stop</code> command:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop [option] &lt;container_id&gt;</span><br></pre></td></tr></table></figure>

<p>  By default, you get a 10 second grace period if you run <code>docker stop</code>. This means that the <code>stop</code> command instructs the <code>container</code> to <strong>stop services after that 10 seconds period</strong>. You can also use the <code>--time</code> option to define a different grace period expressed in seconds, for example:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop --time&#x3D;20 &lt;container_id&gt;</span><br></pre></td></tr></table></figure>

<p>  If you want to immediately kill a docker <code>container</code> without waiting for the grace period to end, use:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker kill [option] &lt;container_id&gt;</span><br></pre></td></tr></table></figure>

<p>  Additionally, a useful command is to <strong>stop (or kill) all running containers</strong>:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop $(docker ps –a –q)</span><br></pre></td></tr></table></figure>
<p>  If you want to <code>kill</code> those <code>container</code>s, just replace the <code>stop</code> with <code>kill</code>.</p>
</li>
</ul>
<h2 id="Viewing-and-Removing-Unwanted-Images"><a href="#Viewing-and-Removing-Unwanted-Images" class="headerlink" title="Viewing and Removing Unwanted Images"></a>Viewing and Removing Unwanted Images</h2><ul>
<li><p>To view the <code>image</code>s, you could use the command:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>
<p>  to provide you with a list of images that you have created. For example, they might look like this:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">REPOSITORY                      TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">bulletinboard                   1.0                 2cd431e8ee37        3 hours ago         182MB</span><br><span class="line">mysql                           8.0                 30f937e841c8        4 days ago          541MB</span><br><span class="line">node                            current-slim        8ec3841e41bb        4 days ago          165MB</span><br><span class="line">ubuntu                          latest              1d622ef86b13        4 weeks ago         73.9MB</span><br></pre></td></tr></table></figure></li>
<li><p>To remove an <code>image</code>, you need to specify <strong>both the name and the version</strong> (<code>tag</code>) in the format <code>&lt;name&gt;:&lt;version&gt;</code>. For example, to remove the <code>bulletinboard</code> image, you could do:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image rm -f bulletinboard:1.0</span><br></pre></td></tr></table></figure>

<p>  However, if it is at the <code>latest</code> version/tag, then you can just specify the name:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image rm -f ubuntu</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> The <code>-f</code> or <code>--force</code> option is <strong>only necessay when you have the <code>container</code> running</strong>. If it is not running, it can be removed just by specifying <code>docker image rm</code></li>
</ul>
</blockquote>
</li>
</ul>
<p><a name="Viewing-and-Removing-Containers"></a></p>
<h2 id="Viewing-and-Removing-Containers"><a href="#Viewing-and-Removing-Containers" class="headerlink" title="Viewing and Removing Containers"></a>Viewing and Removing Containers</h2><ul>
<li><p>To list all <strong>running containers</strong>, you can use the command:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure>
<p>  which, for example, could gives you:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CONTAINER ID        IMAGE                       COMMAND                  CREATED             STATUS                             PORTS                 NAMES</span><br><span class="line">a22b3d54d5f4        mysql&#x2F;mysql-server:latest   &quot;&#x2F;entrypoint.sh mysq…&quot;   18 seconds ago      Up 17 seconds (health: starting)   3306&#x2F;tcp, 33060&#x2F;tcp   test-sql-server</span><br></pre></td></tr></table></figure>

<p>  However, if you would like to see also stopped <code>container</code>s, you could use the <code>-a</code> or <code>--all</code> flag:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a</span><br></pre></td></tr></table></figure>

<p>  Some of the other <strong>useful options</strong> include:</p>
<table>
<thead>
<tr>
<th>Option</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>--filter</code> , <code>-f</code></td>
<td>-</td>
<td>Filter output based on conditions provided</td>
</tr>
<tr>
<td><code>--format</code></td>
<td>-</td>
<td>Pretty-print containers using a Go template</td>
</tr>
<tr>
<td><code>--last</code>, <code>-n</code></td>
<td>-1</td>
<td>Show n last created containers (includes all states)</td>
</tr>
<tr>
<td><code>--latest</code> , <code>-l</code></td>
<td>-</td>
<td>Show the latest created container (includes all states)</td>
</tr>
<tr>
<td><code>--no-trunc</code></td>
<td>-</td>
<td>Don’t truncate output</td>
</tr>
<tr>
<td><code>--quiet</code> , <code>-q</code></td>
<td>-</td>
<td>Only display numeric IDs</td>
</tr>
</tbody></table>
<p>  The <code>--filter</code> could be quite useful to select <code>container</code>s you want to see, for example, if you only want to see <code>container</code>s with name having the substring <code>test</code>, you could run:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps --filter &quot;name&#x3D;test&quot;</span><br></pre></td></tr></table></figure>

<p>  For a full list of examples using <code>--format</code>, please refer to the <a href="#https://docs.docker.com/engine/reference/commandline/ps/#filtering">Docker Doc here</a></p>
</li>
<li><p>On the other hand, to remove unwanted <code>container</code>s, you could use the command:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker container rm &lt;container-id&gt;</span><br></pre></td></tr></table></figure>

<p>  where the <code>&lt;container-id&gt;</code> could be seen if you run the <code>docker ps</code> command shown above. If the container is running, you could also force remove it with the <code>--force</code> or <code>-f</code> option.</p>
<p>  For other commands/options related to <code>docker container -rm</code> please refer to the <a href="#https://docs.docker.com/engine/reference/commandline/container_rm/">Docker Doc here</a></p>
</li>
</ul>
<h2 id="Copying-Files-to-and-from-a-Container"><a href="#Copying-Files-to-and-from-a-Container" class="headerlink" title="Copying Files to and from a Container"></a>Copying Files to and from a Container</h2><ul>
<li><p>To copy local files to a container, you can use teh command:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker cp &lt;localPath&gt;&#x2F;&lt;fromFile&gt; &lt;container-id&gt;:&lt;pathInContainer&gt;&#x2F;&lt;toFile&gt;</span><br></pre></td></tr></table></figure>

<p>  For example:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker cp foo.txt test-container:~&#x2F;foo.txt</span><br></pre></td></tr></table></figure>
<p>  Then you can see the file <code>foo.txt</code> in your container at the path <code>root/foo.txt</code></p>
</li>
<li><p>Similarily, to copy a file from a container to your local machine, you can use:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker cp &lt;container-id&gt;:&lt;pathInContainer&gt;&#x2F;&lt;fromFile&gt; &lt;localPath&gt;&#x2F;&lt;toFile&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="Configuring-your-Docker-Daemon"><a href="#Configuring-your-Docker-Daemon" class="headerlink" title="Configuring your Docker Daemon"></a>Configuring your Docker Daemon</h2><p>To configure the Docker daemon using a JSON file, create a file at <code>/etc/docker/daemon.json</code> on Linux systems, or <code>C:\ProgramData\docker\config\daemon.json</code> on Windows. On MacOS go to the whale in the <code>taskbar &gt; Preferences &gt; Daemon &gt; Advanced</code>.</p>
<p>For example, if you want your Docker daemon to run in <code>debug mode</code>, uses <code>TLS</code>, and listens for traffic routed to <code>192.168.59.3</code> on port <code>2376</code>, you would have the following configuration in your <code>daemon.json</code> ( You can learn what configuration options are available in the <a href="https://docs.docker.com/engine/reference/commandline/dockerd/#daemon-configuration-file" target="_blank" rel="noopener">dockerd reference docs</a>):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;debug&quot;: true,</span><br><span class="line">  &quot;tls&quot;: true,</span><br><span class="line">  &quot;tlscert&quot;: &quot;&#x2F;var&#x2F;docker&#x2F;server.pem&quot;,</span><br><span class="line">  &quot;tlskey&quot;: &quot;&#x2F;var&#x2F;docker&#x2F;serverkey.pem&quot;,</span><br><span class="line">  &quot;hosts&quot;: [&quot;tcp:&#x2F;&#x2F;192.168.59.3:2376&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>However, you could also manually start a daemon with the same configuration in your command line:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dockerd --debug \</span><br><span class="line">  --tls&#x3D;true \</span><br><span class="line">  --tlscert&#x3D;&#x2F;var&#x2F;docker&#x2F;server.pem \</span><br><span class="line">  --tlskey&#x3D;&#x2F;var&#x2F;docker&#x2F;serverkey.pem \</span><br><span class="line">  --host tcp:&#x2F;&#x2F;192.168.59.3:2376</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> If you use a <code>daemon.json</code> file <strong>and also pass options to the <code>dockerd</code> command</strong> manually or using start-up scripts, and these options conflict, Docker fails to start with an error such as:</li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">unable to configure the Docker daemon with file &#x2F;etc&#x2F;docker&#x2F;daemon.json:</span><br><span class="line">the following directives are specified both as a flag and in the configuration</span><br><span class="line">file: hosts: (from flag: [unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;docker.sock], from file: [tcp:&#x2F;&#x2F;127.0.0.1:2376])</span><br></pre></td></tr></table></figure>
<p>If you see an error similar to this one and you are starting the daemon manually with flags, you may need to <strong>adjust your flags or the daemon.json to remove the conflict</strong>.</p>
<p>This means if you want to enter the debug mode, you can set the <code>debug</code> key to <code>true</code> in the <code>daemon.json</code> file. This method works for every Docker platform and is recommended.</p>
<ul>
<li><p>If the file is empty, add the following:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;debug&quot;: true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>If the file already contains JSON, just add the key <code>&quot;debug&quot;: true</code>, being careful to add a comma to the end of the line if it is not the last line before the closing bracket. Also <strong>verify that if the <code>log-level</code> key is set, it is set to either <code>info</code> or <code>debug</code></strong>. <code>info</code> is the default, and possible values are <code>debug</code>, <code>info</code>, <code>warn</code>, <code>error</code>, <code>fatal</code>.</p>
</li>
<li><p>Send a HUP signal to the daemon to cause it to reload its configuration. </p>
<ul>
<li><p>On Linux hosts, use the following command.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo kill -SIGHUP $(pidof dockerd)</span><br></pre></td></tr></table></figure>
</li>
<li><p>On Windows hosts, restart Docker.</p>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Instead of following this procedure, you can also <code>stop</code> the Docker <code>daemon</code> and <code>restart</code> it manually with the <code>debug flag -D</code>. However, this may result in Docker <strong>restarting with a different environment than the one the hosts’ startup scripts create</strong>, and this may make debugging more difficult.</li>
</ul>
</blockquote>
<h2 id="Starting-your-Docker-Daemon-Manually"><a href="#Starting-your-Docker-Daemon-Manually" class="headerlink" title="Starting your Docker Daemon Manually"></a>Starting your Docker Daemon Manually</h2><p>Once Docker is installed, <strong>you need to start the Docker daemon</strong>. Most Linux distributions use <code>systemctl</code> to start services. If you do not have <code>systemctl</code>, use the <code>service</code> command.</p>
<ul>
<li><p><code>systemctl</code>:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl start docker</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>service</code>:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo service docker start</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="Starting-your-Containers-Automatically"><a href="#Starting-your-Containers-Automatically" class="headerlink" title="Starting your Containers Automatically"></a>Starting your Containers Automatically</h2><p>Docker provides restart policies to <strong>control whether your containers start automatically when they exit, or when Docker restarts</strong>. Restart policies ensure that linked containers are started in the correct order. Docker recommends that you use restart policies, and avoid using process managers to start containers.</p>
<p>To configure the <strong>restart policy</strong> for a container, use the <code>--restart</code> flag when using the <code>docker run</code> command. The value of the <code>--restart</code> flag can be any of the following:</p>
<table>
<thead>
<tr>
<th>Flag</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>no</code></td>
<td>Do not automatically restart the container. (the default)</td>
</tr>
<tr>
<td><code>on-failure</code></td>
<td>Restart the container <strong>if it exits due to an error</strong>, which manifests as a non-zero exit code.</td>
</tr>
<tr>
<td><code>always</code></td>
<td><strong>Always restart the container if it stops</strong>. <strong>If it is manually stopped</strong>, it is <strong>restarted only when Docker daemon restarts or the container itself is manually restarted</strong>. (See the second bullet listed in restart policy details)</td>
</tr>
<tr>
<td><code>unless-stopped</code></td>
<td>Similar to always, except that <strong>when the container is stopped (manually or otherwise)</strong>, it is <strong>not restarted even after Docker daemon restarts</strong>.</td>
</tr>
</tbody></table>
<p>The following example starts a Redis container and configures it to always restart unless it is explicitly stopped or Docker is restarted.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d --restart unless-stopped redis</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> A restart policy <strong>only takes effect after a container starts successfully (when you run the command specifying the restart policy)</strong>. In this case, starting successfully means that the container is up for at least 10 seconds and Docker has started monitoring it. This <strong>prevents a container</strong> which does not start at all from going <strong>into a restart loop</strong>.</li>
<li><input disabled type="checkbox"> <strong>If you manually stop a container</strong>, <strong>its restart policy is ignored until the Docker daemon restarts or the container is manually restarted</strong>. This is another attempt to <strong>prevent a restart loop</strong>.</li>
<li><input disabled type="checkbox"> Restart policies <strong>only apply to containers</strong>. Restart policies for swarm services are configured differently. See the flags related to service restart.</li>
</ul>
</blockquote>
<h2 id="Keep-Containers-Alive-during-Daemon-Downtime"><a href="#Keep-Containers-Alive-during-Daemon-Downtime" class="headerlink" title="Keep Containers Alive during Daemon Downtime"></a>Keep Containers Alive during Daemon Downtime</h2><p><strong>By default</strong>, when the <strong>Docker daemon terminates</strong>, it <strong>shuts down running containers</strong>. Starting with Docker Engine 1.12, you can <strong>configure the daemon so that containers remain running if the daemon becomes unavailable</strong>. This functionality is called <code>live restore</code>. </p>
<p>There are <strong>two ways to enable the <code>live restore</code> setting</strong> to <strong>keep containers alive when the daemon becomes unavailable</strong>. <strong>Only do one of the following</strong>.</p>
<ul>
<li><p>Add the configuration to the daemon configuration file. On Linux, this defaults to <code>/etc/docker/daemon.json</code>. On Docker Desktop for Mac or Docker Desktop for Windows, select the Docker icon from the task bar, then click Preferences -&gt; Daemon -&gt; Advanced.</p>
<ul>
<li><p>Use the following JSON to enable live-restore.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"live-restore"</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Then, restart the Docker daemon. <strong>On Linux</strong>, you can avoid a restart (and avoid any downtime for your containers) by <strong>reloading the Docker daemon</strong>. If you use <code>systemd</code>, then use the command <code>systemctl reload docker</code>. Otherwise, send a SIGHUP signal to the dockerd process.</p>
</li>
</ul>
</li>
<li><p>The other way is to use the <code>--live-restore</code> flag <strong>when you start the dockerd process manually with the <code>--live-restore</code> flag</strong>. This approach is <strong>not recommended because it does not set up the environment that systemd or another process manager would use when starting the Docker process</strong>. This can cause unexpected behavior.</p>
</li>
</ul>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> The live restore option <strong>only works to restore containers if the daemon options</strong>, such as bridge IP addresses and graph driver, <strong>did not change</strong>. If any of these <strong>daemon-level configuration options have changed, the live restore may not work and you may need to manually start the containers</strong>.</li>
<li><input disabled type="checkbox"> If the daemon is down <strong>for a long time</strong>, <strong>running containers may fill up the FIFO log the daemon normally reads</strong>. A full log blocks containers from logging more data. The default buffer size is 64K. <strong>If the buffers fill, you must restart the Docker daemon to flush them</strong>.</li>
</ul>
<p><strong>On Linux</strong>, you can modify the kernel’s buffer size by changing <code>/proc/sys/fs/pipe-max-size</code>. You cannot modify the buffer size on Docker Desktop for Mac or Docker Desktop for Windows.</p>
<ul>
<li><input disabled type="checkbox"> The live restore option <strong>only pertains to standalone containers, and not to swarm services</strong>. Swarm services are managed by <strong>swarm managers</strong>. If swarm managers are not available, swarm services continue to run on worker nodes but cannot be managed until enough swarm managers are available to maintain a quorum.</li>
</ul>
</blockquote>
<h2 id="Running-Multiple-Services-in-a-Container"><a href="#Running-Multiple-Services-in-a-Container" class="headerlink" title="Running Multiple Services in a Container"></a>Running Multiple Services in a Container</h2><p>This involves writing scripts and editing the Dockerfile. For details please refer to <a href="https://docs.docker.com/config/containers/multi-service_container/" target="_blank" rel="noopener">this link</a>.</p>
<h2 id="Viewing-Runtime-metrics-for-a-Container"><a href="#Viewing-Runtime-metrics-for-a-Container" class="headerlink" title="Viewing Runtime metrics for a Container"></a>Viewing Runtime metrics for a Container</h2><p>There are a couple of ways where you can view the current runtime metrics for your container.</p>
<ol>
<li><p>You can use the <code>docker stats</code> command to <strong>live stream a container’s runtime metrics</strong>. The command supports CPU, memory usage, memory limit, and network IO metrics.</p>
<p> The following is a sample output from the docker stats command:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker stats redis1 redis2</span><br><span class="line"></span><br><span class="line">CONTAINER           CPU %               MEM USAGE &#x2F; LIMIT     MEM %               NET I&#x2F;O             BLOCK I&#x2F;O</span><br><span class="line">redis1              0.07%               796 KB &#x2F; 64 MB        1.21%               788 B &#x2F; 648 B       3.568 MB &#x2F; 512 KB</span><br><span class="line">redis2              0.07%               2.746 MB &#x2F; 64 MB      4.29%               1.266 KB &#x2F;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Using Linux Control Groups</p>
<p> <strong><em>Q: What is a Linux Control Group?</em></strong></p>
<p> Truth be told, certain <strong>software applications in the wild may need to be controlled or limited—at least for the sake of stability and, to some degree, security</strong>. Far too often, <strong>a bug or just bad code</strong> can disrupt an entire machine and <strong>potentially cripple an entire ecosystem</strong>. Fortunately, a way exists to keep those same applications in check. <strong>Control groups (cgroups) is a kernel feature that limits, accounts for and isolates the CPU, memory, disk I/O and network’s usage of one or more processes</strong>.</p>
<p> The primary design goal for cgroups was to provide a unified interface to manage processes or whole operating-system-level virtualization, including Linux Containers, or LXC (a topic I plan to revisit in more detail in a follow-up article). The cgroups framework provides the following:</p>
<ul>
<li><p>Resource limiting: a group can be configured not to exceed a specified memory limit or use more than the desired amount of processors or be limited to specific peripheral devices.</p>
</li>
<li><p>Prioritization: one or more groups may be configured to utilize fewer or more CPUs or disk I/O throughput.</p>
</li>
<li><p>Accounting: a group’s resource usage is monitored and measured.</p>
</li>
<li><p>Control: groups of processes can be frozen or stopped and restarted.</p>
<p>For more details, please visit this <a href="https://www.linuxjournal.com/content/everything-you-need-know-about-linux-containers-part-i-linux-control-groups-and-process" target="_blank" rel="noopener">site</a>.</p>
<p>Now, <strong>for each container, one cgroup is created in each hierarchy</strong>. On older systems with older versions of the LXC userland tools, the name of the cgroup is the name of the container. With more recent versions of the LXC tools, the cgroup is <code>lxc/&lt;container_name&gt;</code>.</p>
</li>
</ul>
<p> <strong>For Docker containers using cgroups, the container name is the full ID or long ID of the container</strong>. If a container shows up as <code>ae836c95b4c3</code> in <code>docker ps</code>, its long ID might be something like <code>ae836c95b4c3c9e9179e0e91015512da89fdec91612f63cebae57df9a5444c79</code>. You can look it up with <code>docker inspect</code> or <code>docker ps --no-trunc</code>.</p>
<p> Putting everything together to look at the memory metrics for a Docker container, take a look at <code>/sys/fs/cgroup/memory/docker/&lt;longid&gt;/</code>, where for each subsystem (memory, CPU, and block I/O), <strong>one or more pseudo-files exist and contain statistics:</strong></p>
<pre><code>- **MEMORY METRICS: `MEMORY.STAT`**
- **CPU metrics: `cpuacct.stat`**
- **Network metrics** those are not directly exposed by the control group, but information can be gathered from other sources. For details, please follow the link below.</code></pre><p> For a detailed explaination of what you see in all those files, please refer to the <a href="https://docs.docker.com/config/containers/runmetrics/#metrics-from-cgroups-memory-cpu-block-io" target="_blank" rel="noopener">Offical Docker Documentation</a></p>
</li>
</ol>
<h2 id="View-Logs-for-a-Particular-Container-or-Service"><a href="#View-Logs-for-a-Particular-Container-or-Service" class="headerlink" title="View Logs for a Particular Container or Service"></a>View Logs for a Particular Container or Service</h2><p>The <code>docker logs</code> command <strong>shows information logged by a running container</strong>. The <code>docker service logs</code> command <strong>shows information logged by all containers participating in a service</strong>. The information that is logged and the format of the log depends almost entirely on the container’s endpoint command.</p>
<p>By default, <code>docker logs</code> or <code>docker service logs</code> <strong>shows the command’s output just as it would appear if you ran the command interactively in a terminal</strong>. UNIX and Linux commands typically open three I/O streams when they run, called <code>STDIN</code>, <code>STDOUT</code>, and <code>STDERR</code>. </p>
<ul>
<li><code>STDIN</code> is the <strong>command’s input stream</strong> (i.e. user input), which may include input from the keyboard or input from another command. </li>
<li><code>STDOUT</code> is usually a <strong>command’s normal output</strong></li>
<li><code>STDERR</code> is typically used to <strong>output error messages</strong>. </li>
</ul>
<p><strong>By default, <code>docker logs</code> shows the command’s <code>STDOUT</code> and <code>STDERR</code>.</strong> </p>
<p>However, in some cases, <strong><code>docker logs</code> may not show useful information unless you take additional steps</strong>.</p>
<ul>
<li><strong>If you use a logging driver</strong> which <strong>sends logs to a file</strong>, an external host, a database, or another logging back-end, docker logs may not show useful information.<ul>
<li>In this case, <strong>your logs are processed in other ways and you may choose not to use docker logs (continue to the section <a href="#Configuring-Logging-Drivers">Configure logging drivers</a>).</strong></li>
</ul>
</li>
<li><strong>If your image runs a non-interactive process</strong> such as a web server or <strong>a database</strong>, that application may <strong>send its output to log files instead of STDOUT and STDERR</strong>.<ul>
<li>In this case, the <strong>official <code>nginx</code> image shows one workaround</strong>, and the <strong>official <code>Apache httpd</code> image shows another</strong>.<ul>
<li>The official nginx image creates a symbolic link from <code>/var/log/nginx/access.log</code> to <code>/dev/stdout</code>, and creates another symbolic link from <code>/var/log/nginx/error.log</code> to <code>/dev/stderr</code>, <strong>overwriting the log files and causing logs to be sent to the relevant special device instead</strong>. See this <a href="https://github.com/nginxinc/docker-nginx/blob/8921999083def7ba43a06fabd5f80e4406651353/mainline/jessie/Dockerfile#L21-L23" target="_blank" rel="noopener">Dockerfile</a>.</li>
<li>The official httpd driver <strong>changes the httpd application’s configuration to write its normal output directly to /proc/self/fd/1</strong> (which is <code>STDOUT</code>) and <strong>its errors to /proc/self/fd/2</strong> (which is <code>STDERR</code>). See this <a href="https://github.com/docker-library/httpd/blob/b13054c7de5c74bbaa6d595dbe38969e6d4f860c/2.2/Dockerfile#L72-L75" target="_blank" rel="noopener">Dockerfile</a>.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><a name="Configuring-Logging-Drivers"></a></p>
<h2 id="Configuring-Logging-Drivers"><a href="#Configuring-Logging-Drivers" class="headerlink" title="Configuring Logging Drivers"></a>Configuring Logging Drivers</h2><p>Docker includes multiple logging mechanisms to help you get information from running containers and services. These mechanisms are called <strong>logging drivers</strong> (I interpret them as driving your logs to a specific place with a specific format).</p>
<p><strong>By default, Docker uses the <code>json</code> file to log all the outputs</strong>. The file of a container’s logs can be found in (if you use the default log format which is <code>json</code>):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;var&#x2F;lib&#x2F;docker&#x2F;containers&#x2F;&lt;container id&gt;&#x2F;&lt;container id&gt;-json.log</span><br></pre></td></tr></table></figure>
<p>This will contain the same log output as you will see if you run <code>docker logs &lt;container-id&gt;</code>. If you do not specify a logging driver, the default is json-file. Thus, the default output for commands such as <code>docker inspect &lt;CONTAINER&gt;</code> is also <code>JSON</code>.</p>
<p>To <strong>configure the Docker daemon from the default to a specific logging driver</strong>, set the <strong>value of <code>log-driver</code> to the name of the logging driver</strong> in the <strong><code>daemon.json</code> file</strong>, which is located in <code>/etc/docker/</code> on Linux hosts or <code>C:\ProgramData\docker\config\</code> on Windows server hosts.The following example explicitly sets the default logging driver to <code>syslog</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;log-driver&quot;: &quot;syslog&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>If the logging driver has configurable option</strong>s, you can set them in the <code>daemon.json</code> file as a <code>JSON</code> object <strong>with the key <code>log-opts</code></strong>. The following example sets two configurable options on the json-file logging driver:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;log-driver&quot;: &quot;json-file&quot;,</span><br><span class="line">  &quot;log-opts&quot;: &#123;</span><br><span class="line">    &quot;max-size&quot;: &quot;10m&quot;,</span><br><span class="line">    &quot;max-file&quot;: &quot;3&quot;,</span><br><span class="line">    &quot;labels&quot;: &quot;production_status&quot;,</span><br><span class="line">    &quot;env&quot;: &quot;os,customer&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>and you can also specify directly for a particular container (this will overwrite the JSON file):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d --name&#x3D;&lt;container-name&gt; \</span><br><span class="line">--log-driver json-file \</span><br><span class="line">--log-opt max-size&#x3D;10m --log-opt max-file&#x3D;3 --log-opt labels&#x3D;production_status --log-opt env&#x3D;os,customer \</span><br><span class="line">&lt;yourImage&gt;:&lt;tag&gt;</span><br></pre></td></tr></table></figure>
<p>where:</p>
<ul>
<li><code>max-size</code><ul>
<li>The <strong>maximum size of the log before it is rolled</strong>. A positive integer plus a modifier representing the unit of measure (k=kb, m=mb, or g=gb). Defaults to -1 (unlimited).    </li>
<li>Example: <code>--log-opt max-size=10m</code></li>
</ul>
</li>
<li><code>max-file</code> <ul>
<li>The <strong>maximum number of log files that can be present</strong>. <strong>If rolling the logs creates excess files, the oldest file is removed</strong>. Only effective when max-size is also set. A positive integer. <strong>Defaults to 1</strong>.</li>
<li>Example: <code>--log-opt max-file=3</code></li>
</ul>
</li>
<li><code>labels</code><ul>
<li>Applies when starting the Docker daemon. A comma-separated list of <strong>logging-related labels</strong> this daemon accepts. <strong>Used for advanced log tag options</strong>.    </li>
<li>Example: <code>--log-opt labels=production_status,geo</code></li>
</ul>
</li>
<li><code>env</code><ul>
<li>Applies when starting the Docker daemon. A comma-separated list of <strong>logging-related environment variables</strong> this daemon accepts. <strong>Used for advanced log tag options</strong>.    </li>
<li>Example: <code>--log-opt env=os,customer</code></li>
</ul>
</li>
</ul>
<p>For more details on the JSON File logging driver, please visit <a href="https://docs.docker.com/config/containers/logging/json-file/" target="_blank" rel="noopener">this link</a></p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> <code>log-opts</code> <strong>configuration options</strong> in the <code>daemon.json</code> configuration file <strong>must be provided as strings</strong>. Boolean and numeric values (such as the value for max-file in the example above) must therefore be enclosed in quotes (<code>&quot;</code>).</li>
</ul>
</blockquote>
<p>Now, To <strong>find the current default logging driver for the Docker daemon</strong>, run <code>docker info</code> and search for Logging Driver. You can use the following command on Linux, macOS, or PowerShell on Windows:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker info --format &#39;&#123;&#123;.LoggingDriver&#125;&#125;&#39;</span><br><span class="line"></span><br><span class="line">json-file</span><br></pre></td></tr></table></figure>

<p>To find the <strong>current logging driver for a running container</strong>, if the daemon is using the json-file logging driver, run the following docker inspect command, substituting the container name or ID for <code>&lt;CONTAINER&gt;</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker inspect -f &#39;&#123;&#123;.HostConfig.LogConfig.Type&#125;&#125;&#39; &lt;CONTAINER&gt;</span><br><span class="line"></span><br><span class="line">json-file</span><br></pre></td></tr></table></figure>

<h2 id="Use-environment-variables-or-labels-with-logging-drivers"><a href="#Use-environment-variables-or-labels-with-logging-drivers" class="headerlink" title="Use environment variables or labels with logging drivers"></a>Use environment variables or labels with logging drivers</h2><p>Some logging drivers add the value of a container’s <code>--env|-e</code> or –label flags to the container’s logs. This example starts a container using the Docker daemon’s default logging driver (let’s assume json-file) but sets the environment variable os=ubuntu.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -dit --label production_status&#x3D;testing -e os&#x3D;ubuntu alpine sh</span><br></pre></td></tr></table></figure>

<p>If the logging driver supports it, this adds additional fields to the logging output. The following output is generated by the json-file logging driver:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;attrs&quot;:&#123;&quot;production_status&quot;:&quot;testing&quot;,&quot;os&quot;:&quot;ubuntu&quot;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Supported-Logging-Drivers"><a href="#Supported-Logging-Drivers" class="headerlink" title="Supported Logging Drivers"></a>Supported Logging Drivers</h2><p>The following logging drivers are supported. If you are using logging driver plugins, you may see more options.</p>
<table>
<thead>
<tr>
<th>Driver</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>none</code></td>
<td>No logs are available for the container and docker logs does not return any output.</td>
</tr>
<tr>
<td><code>local</code></td>
<td>Logs are stored in a custom format designed for minimal overhead.</td>
</tr>
<tr>
<td><code>json-file</code></td>
<td>The logs are formatted as JSON. The default logging driver for Docker.</td>
</tr>
<tr>
<td><code>syslog</code></td>
<td>Writes logging messages to the syslog facility. The syslog daemon must be running on the host machine.</td>
</tr>
<tr>
<td><code>journald</code></td>
<td>Writes log messages to journald. The journald daemon must be running on the host machine.</td>
</tr>
<tr>
<td><code>gelf</code></td>
<td>Writes log messages to a Graylog Extended Log Format (GELF) endpoint such as Graylog or Logstash.</td>
</tr>
<tr>
<td><code>fluentd</code></td>
<td>Writes log messages to fluentd (forward input). The fluentd daemon must be running on the host machine.</td>
</tr>
<tr>
<td><code>awslogs</code></td>
<td>Writes log messages to Amazon CloudWatch Logs.</td>
</tr>
<tr>
<td><code>splunk</code></td>
<td>Writes log messages to splunk using the HTTP Event Collector.</td>
</tr>
<tr>
<td><code>etwlogs</code></td>
<td>Writes log messages as Event Tracing for Windows (ETW) events. Only available on Windows platforms.</td>
</tr>
<tr>
<td><code>gcplogs</code></td>
<td>Writes log messages to Google Cloud Platform (GCP) Logging.</td>
</tr>
<tr>
<td><code>logentries</code></td>
<td>Writes log messages to Rapid7 Logentries.</td>
</tr>
</tbody></table>
<p>However, there are <strong>limitations for using logging drivers in general</strong> as well:</p>
<ul>
<li>Users of <strong>Docker Enterprise can make use of “dual logging”</strong>, which enables you to use the docker logs command for any logging driver. Refer to reading logs when using remote logging drivers for information about using docker logs to read container logs locally for many third party logging solutions, including:<ul>
<li><code>syslog</code></li>
<li><code>gelf</code></li>
<li><code>fluentd</code></li>
<li><code>awslogs</code></li>
<li><code>splunk</code></li>
<li><code>etwlogs</code></li>
<li><code>gcplogs</code></li>
<li><code>Logentries</code></li>
</ul>
</li>
<li>When using <strong>Docker Community Engine</strong>, the docker logs command is only available on the following drivers:<br>local<ul>
<li><code>json-file</code></li>
<li><code>journald</code></li>
</ul>
</li>
<li>Reading log information <strong>requires decompressing rotated log files</strong>, which <strong>causes a temporary increase in disk usage</strong> (until the log entries from the rotated files are read) and an increased CPU usage while decompressing.</li>
<li>The capacity of the host storage where the Docker data directory resides determines the maximum size of the log file information.</li>
</ul>
<h2 id="Using-a-Logging-Driver-Plugin"><a href="#Using-a-Logging-Driver-Plugin" class="headerlink" title="Using a Logging Driver Plugin"></a>Using a Logging Driver Plugin</h2><p>Docker logging plugins allow you to extend and customize Docker’s logging capabilities beyond those of the built-in logging drivers. <strong>A logging service provider can implement their own plugins and make them available on Docker Hub, or a private registry</strong>.</p>
<ol>
<li><p>First, you need to install the logging driver plugin</p>
<ul>
<li>To install a logging driver plugin, use <code>docker plugin install &lt;org/image&gt;</code>, using the information provided by the plugin developer.</li>
</ul>
</li>
<li><p>You can <strong>list all installed plugins</strong> using <code>docker plugin ls</code>, and you can <strong>inspect a specific plugin</strong> using <code>docker inspect</code>.</p>
</li>
<li><p>If you wan to configure the plugin <strong>as the default logging driver</strong>:</p>
<ul>
<li>After the plugin is installed, you can configure the Docker daemon to use it as the default by setting the plugin’s name as the value of the <code>log-driver</code> key in the <code>daemon.json</code>, as detailed in the previous section. If the logging driver supports additional options, you can set those as the values of the <code>log-opts</code> array in the same file.</li>
</ul>
</li>
<li><p>If you want to configure <strong>a container to use the plugin</strong> as the logging driver:</p>
<ul>
<li>After the plugin is installed, you can configure a container to use the plugin as its logging driver by <strong>specifying the <code>--log-driver</code> flag to <code>docker run</code></strong>, as detailed in the previous section. If the logging driver supports additional options, you can specify them using one or more <code>--log-opt</code> flags with the option name as the key and the option value as the value.</li>
</ul>
</li>
</ol>
<h2 id="Customizing-the-Logging-Driver-Tag"><a href="#Customizing-the-Logging-Driver-Tag" class="headerlink" title="Customizing the Logging Driver Tag"></a>Customizing the Logging Driver Tag</h2><p>The tag log option specifies how to format a tag that identifies the container’s log messages. By default, the system uses the first 12 characters of the container ID. To override this behavior, specify a tag option:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --log-driver&#x3D;fluentd --log-opt fluentd-address&#x3D;myhost.local:24224 --log-opt tag&#x3D;&quot;testTag&quot;</span><br></pre></td></tr></table></figure>

<p>Often, you would like to use a special template markup:  --log-opt tag=".ImageName/.Name/.ID"  value yields syslog log lines like:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Aug  7 18:33:19 HOSTNAME hello-world&#x2F;foobar&#x2F;5790672ab6a0[9103]: Hello from Docker.</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>Markup</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>{{.ID}}</td>
<td>The first 12 characters of the container ID.</td>
</tr>
<tr>
<td>{{.FullID}}</td>
<td>The full container ID.</td>
</tr>
<tr>
<td>{{.Name}}</td>
<td>The container name.</td>
</tr>
<tr>
<td>{{.ImageID}}</td>
<td>The first 12 characters of the container’s image ID.</td>
</tr>
<tr>
<td>{{.ImageFullID}}</td>
<td>The container’s full image ID.</td>
</tr>
<tr>
<td>{{.ImageName}}</td>
<td>The name of the image used by the container.</td>
</tr>
<tr>
<td>{{.DaemonName}}</td>
<td>The name of the docker program (docker).</td>
</tr>
</tbody></table>
<h2 id="Dokcer-Network-Overview"><a href="#Dokcer-Network-Overview" class="headerlink" title="Dokcer Network Overview"></a>Dokcer Network Overview</h2><p>One of the reasons Docker containers and services are so powerful is that you can <strong>connect them together</strong>, or <strong>connect them to non-Docker workloads</strong>. Docker containers and services do not even need to be aware that they are deployed on Docker, or whether their peers are also Docker workloads or not. Whether your Docker hosts run Linux, Windows, or a mix of the two, you can use Docker to manage them in a platform-agnostic way.</p>
<p>However. this topic <strong>does not go into OS-specific details</strong> about how Docker networks work, so you will not find information about how Docker manipulates <code>iptables</code> rules on Linux or how it manipulates routing rules on Windows servers, and you will not find detailed information about how Docker forms and encapsulates packets or handles encryption. </p>
<h2 id="Network-Drivers"><a href="#Network-Drivers" class="headerlink" title="Network Drivers"></a>Network Drivers</h2><p>Docker’s networking subsystem is pluggable, <strong>using drivers</strong>. Several drivers <strong>exist by default</strong>, and provide core networking functionality:</p>
<ul>
<li><p><code>bridge</code>: </p>
<ul>
<li>The <strong>default</strong> network driver. If you don’t specify a driver, this is the type of network you are creating. Bridge networks are usually used when your <strong>applications run in standalone containers that need to communicate</strong>. </li>
<li>This is usually the best choice when you need <strong>multiple containers to communicate on the same Docker host</strong>.</li>
<li>For more details, see the <a href="#Using-bridge-networks">bridge networks section</a>.</li>
</ul>
</li>
<li><p><code>host</code>: </p>
<ul>
<li>For standalone containers, this will <strong>remove network isolation between the container and the Docker host, and use the host’s networking directly</strong>. <code>host</code> is only available for swarm services on <code>Docker 17.06</code> and higher.</li>
<li>This is the best choice when the <strong>network stack should not be isolated from the Docker host</strong>, but you want <strong>other aspects of the container to be isolated</strong>.</li>
<li>For more details, see the <a href="#Using-host-networks">host networks section</a></li>
</ul>
</li>
<li><p><code>overlay</code>: </p>
<ul>
<li>Overlay networks <strong>connect multiple Docker daemons together and enable swarm services to communicate with each other</strong>. You can also use <strong>overlay networks</strong> to facilitate communication between a swarm service and a standalone container, or between two standalone containers on different Docker daemons. This strategy removes the need to do OS-level routing between these containers.</li>
<li>This is the best choice when you need <strong>containers running on different Docker hosts to communicate</strong>, or when <strong>multiple applications work together using swarm services</strong>.</li>
<li>This is the best choice when you are <strong>migrating from a VM setup</strong> or <strong>need your containers to look like physical hosts</strong> on your network, each with a unique MAC address.</li>
<li>For more details, see the <a href="#Using-overlay-networks">overlay networks section</a></li>
</ul>
</li>
<li><p><code>macvlan</code>: </p>
<ul>
<li>Macvlan networks allow you to <strong>assign a MAC address to a container, making it appear as a physical device on your network</strong>. The Docker daemon routes traffic to containers by their MAC addresses. Using the macvlan driver is sometimes the best choice when dealing with legacy applications that expect to be directly connected to the physical network, rather than routed through the Docker host’s network stack. </li>
<li>For more details, see the <a href="#Using-mcvlan-networks">mcvlan networks section</a></li>
</ul>
</li>
<li><p><code>none</code>: </p>
<ul>
<li>For this container, <strong>disable all networking</strong>. Usually used in conjunction with a custom network driver. <code>none</code> is not available for swarm services. </li>
<li>For more details, see the <a href="#Using-none-networks">none networks section</a></li>
</ul>
</li>
<li><p><code>Network plugins</code>: </p>
<ul>
<li>You can <strong>install and use third-party network plugins</strong> with Docker. These plugins are available from Docker Hub or from third-party vendors. See the vendor’s documentation for installing and using a given network plugin.</li>
</ul>
</li>
</ul>
<p><a name="Using-bridge-networks"></a></p>
<h2 id="Using-bridge-networks"><a href="#Using-bridge-networks" class="headerlink" title="Using bridge networks"></a>Using <code>bridge</code> networks</h2><p>In terms of Docker, a <code>bridge</code> network uses a software bridge which allows <strong>containers connected to the same bridge network to communicate, while providing isolation from containers which are not connected to that bridge network</strong>. </p>
<p>The Docker bridge driver <strong>automatically installs rules in the host machine</strong> so that containers on different bridge networks cannot communicate directly with each other. However, <code>bridge</code> networks <strong>apply to containers running on the same Docker daemon host</strong>. For communication among containers running on different Docker daemon hosts, you can either manage routing at the OS level, or you can use an overlay network.</p>
<p>Now, for bridge networks, we can have either the <code>default bridge</code> network or the <code>user-defined bridge</code> network.</p>
<p>When you <strong>start Docker</strong>, <strong>a <code>default bridge</code> network (also called bridge) is created automatically</strong>, and newly-started containers connect to it unless otherwise specified. You <strong>can also create <code>user-defined custom bridge</code> networks</strong>. User-defined bridge networks are superior to the default bridge network.</p>
<ul>
<li><p><code>User-defined bridges</code> provide <strong>automatic DNS resolution between containers</strong>.</p>
<p>  Containers on the <code>default</code> bridge network can only access each other by IP addresses, unless you use the <code>--link</code> option, which is considered legacy. On a <strong><code>user-defined bridge</code> network, containers can resolve each other by name or alias</strong>.</p>
<p>  Imagine an application with a web front-end and a database back-end. If you call your containers <code>web</code> and <code>db</code>, the <code>web</code> container can connect to the <code>db</code> container at <code>db</code>, no matter which Docker host the application stack is running on.</p>
<p>  If you run the same application stack on the <code>default</code> bridge network, you need to <strong>manually create links between the containers</strong> (using the legacy <code>--link</code> flag). These links need to be <strong>created in both directions</strong>, so you can see this gets complex with more than two containers which need to communicate. Alternatively, you can manipulate the <code>/etc/hosts</code> files within the containers, but this creates problems that are difficult to debug.</p>
</li>
<li><p><code>User-defined bridges</code> provide <strong>better isolation</strong>.</p>
<p>  All containers without a <code>--network</code> specified, are attached to the default bridge network. This can be a risk, as unrelated stacks/services/containers are then able to communicate.</p>
<p>  Using a <code>user-defined network</code> provides a scoped network <strong>in which only containers attached to that network are able to communicate</strong>.</p>
<p>  If you use a <code>user-defined bridge</code>, <strong>during a container’s lifetime, you can connect or disconnect it from user-defined networks</strong> on the fly. To remove a container from the <code>default</code> bridge network, you need to stop the container and recreate it with different network options.</p>
</li>
<li><p>Each <code>user-defined network</code> creates a <strong>configurable bridge</strong>.</p>
<p>  If your containers use the <strong><code>default</code> bridge network</strong>, you can configure it, but <strong>all the containers use the same settings</strong>, such as <code>MTU</code> and <code>iptables</code> rules. In addition, configuring the default bridge network happens outside of Docker itself, and requires a restart of Docker.</p>
<p>  <code>User-defined bridge</code> networks are created and configured using <code>docker network create</code>. If different groups of applications have <strong>different network requirements</strong>, you can <strong>configure each <code>user-defined bridge</code> separately</strong>, as you create it.</p>
</li>
<li><p>Linked containers on the <strong><code>default bridge</code> network share environment variables</strong>.</p>
<p>  Originally, the only way to share environment variables between two containers was to link them using the <code>--link</code> flag. This type of variable sharing is <strong>not possible with <code>user-defined networks</code></strong>. However, there are <strong>superior ways to share environment variables</strong>. A few ideas:</p>
<ul>
<li><p>Multiple containers can <strong>mount a file or directory containing the shared information</strong>, using a Docker <code>volume</code>.</p>
</li>
<li><p>Multiple containers can be started together using <code>docker-compose</code> and the compose file can define the shared variables.</p>
</li>
<li><p>You can use <code>swarm</code> services instead of standalone containers, and take advantage of shared secrets and configs.</p>
</li>
</ul>
</li>
</ul>
<p>In general, containers connected to the <strong>same <code>user-defined bridge</code> network effectively expose all ports to each other</strong>. For a port to be <strong>accessible to containers or non-Docker hosts</strong> on <strong>different networks</strong>, that port must be <strong>published using the <code>-p</code> or <code>--publish</code> flag</strong>.</p>
<h2 id="Creating-and-Removing-a-user-defined-bridge"><a href="#Creating-and-Removing-a-user-defined-bridge" class="headerlink" title="Creating and Removing a user-defined bridge"></a>Creating and Removing a <code>user-defined bridge</code></h2><ul>
<li><p>You can use the <code>docker network create &lt;networkName&gt;</code> command to <strong>create a <code>user-defined bridge</code> network.</strong></p>
<p>  For example:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create --driver bridge my-net</span><br></pre></td></tr></table></figure>

<p>  or, since <code>bridge</code> is also the default:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create my-net</span><br></pre></td></tr></table></figure>

<p>  You can also specify the subnet, the IP address range, the gateway, and other options. See the <a href="https://docs.docker.com/engine/reference/commandline/network_create/#specify-advanced-options" target="_blank" rel="noopener">Docker network create reference</a> or the output of <code>docker network create --help</code> for details.</p>
</li>
<li><p>If you don’t need a <code>user-defined brigde</code>, you can <strong>use the <code>docker network rm &lt;networkName&gt;</code> command to remove a <code>user-defined bridge</code> network</strong>. If <strong>containers are currently connected to the network, disconnect them first</strong>.</p>
<p>  For example, if you have all containers disconnected from the <code>my-net</code> bridge, and you want to remove it:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network rm my-net</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="Connecting-and-Disconnecting-from-a-user-defined-bridge"><a href="#Connecting-and-Disconnecting-from-a-user-defined-bridge" class="headerlink" title="Connecting and Disconnecting from a user-defined bridge"></a>Connecting and Disconnecting from a <code>user-defined bridge</code></h2><ul>
<li><p>You can specify the connection to a <code>user-defined network</code> via 2 ways:</p>
<ul>
<li>with the <code>--network</code> flag when you <strong>create a container</strong></li>
<li>with the <code>docker network connect &lt;networkName&gt; &lt;containerName&gt;</code> when you have a <strong>running container</strong></li>
</ul>
<ol>
<li><p>When you <strong>create a new container</strong>, you can specify one or more <code>--network</code> flags. This example connects a <code>Nginx</code> container to the <code>my-net</code> network. It also publishes port <code>80</code> in the container to port <code>8080</code> on the Docker host, so <strong>external clients can access that port</strong>. <strong>Any other container connected to the <code>my-net</code> network</strong> has access to <strong>all ports on the <code>my-nginx</code> container</strong>, and vice versa.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker create --name my-nginx \</span><br><span class="line">  --network my-net \</span><br><span class="line">  --publish 8080:80 \</span><br><span class="line">  nginx:latest</span><br></pre></td></tr></table></figure>
</li>
<li><p>To connect a running container to an existing user-defined bridge, use the docker network connect command. The following command connects an already-running my-nginx container to an already-existing my-net network:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network connect my-net my-nginx</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> If you need <code>IPv6</code> support for Docker containers, you need to <strong>enable the option on the Docker daemon and reload its configuration</strong>, <strong>before creating any <code>IPv6</code> networks</strong> or assigning containers IPv6 addresses.<br>When you create your network, you can specify the <code>--ipv6</code> flag to enable IPv6. You can’t selectively disable IPv6 support on the default bridge network.</li>
</ul>
</blockquote>
</li>
</ol>
</li>
<li><p>To <strong>disconnect a running container from a <code>user-defined bridge</code></strong>, use the <code>docker network disconnect</code> command. The following command disconnects the <code>my-nginx</code> container from the <code>my-net</code> network.</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network disconnect my-net my-nginx</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="Enabling-Forwarding-from-Containers-to-Outside-World"><a href="#Enabling-Forwarding-from-Containers-to-Outside-World" class="headerlink" title="Enabling Forwarding from Containers to Outside World"></a>Enabling Forwarding from Containers to Outside World</h2><p>By default, traffic from containers connected to the <code>default</code> bridge network is <strong>not forwarded to the outside world</strong>. To <strong>enable forwarding</strong>, you need to change two settings. These are not Docker commands and they affect the Docker host’s kernel.</p>
<ol>
<li>Configure the Linux kernel to allow IP forwarding.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sysctl net.ipv4.conf.all.forwarding&#x3D;1</span><br></pre></td></tr></table></figure></li>
<li>Then change the policy for the iptables FORWARD policy from <code>DROP</code> to <code>ACCEPT</code>.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo iptables -P FORWARD ACCEPT</span><br></pre></td></tr></table></figure>
These settings <strong>do not persist across a reboot</strong>, so you may need to add them to a start-up script.</li>
</ol>
<h2 id="Viewing-and-Configuring-your-user-defined-bridge"><a href="#Viewing-and-Configuring-your-user-defined-bridge" class="headerlink" title="Viewing and Configuring your user-defined bridge"></a>Viewing and Configuring your <code>user-defined bridge</code></h2><ol>
<li><p>First, after you have created your <code>user-defined bridge</code>, you can use <code>docker network ls</code> to view the networks that docker has:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ docker network ls</span><br><span class="line"></span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">9210b6312956        test-net            bridge              local</span><br><span class="line">17e324f45964        bridge              bridge              local</span><br><span class="line">6ed54d316334        host                host                local</span><br><span class="line">7092879f2cc8        none                null                local</span><br></pre></td></tr></table></figure></li>
<li><p>Then you can use <code>docker inspect &lt;network-id&gt;</code> to see details about your <code>bridge</code>:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">$ docker inspect test-net</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;test-net&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;9210b6312956eb510fc1ad59f3ebc1ac14270fc27d44f3b98d0c71bcb5409d83&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2020-06-01T09:37:22.875610678+08:00&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;172.18.0.0&#x2F;16&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;172.18.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p> here you see that:</p>
<ul>
<li>there are <strong>no containers</strong> attached to it: <code>&quot;Containers&quot;: {}</code></li>
<li>your <strong>Gateway</strong> is: <code>&quot;Gateway&quot;: &quot;172.18.0.1&quot;</code></li>
</ul>
</li>
<li><p>Now, to test your <code>user-defined bridge</code>, you can create 4 containers: the first two will be connected to the bridge you created, the third will only be connected to be default bridge, and the fourth connected to both:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -dit --name alpine1 --network test-net alpine ash</span><br><span class="line"></span><br><span class="line">$ docker run -dit --name alpine2 --network test-net alpine ash</span><br><span class="line"></span><br><span class="line">$ docker run -dit --name alpine3 alpine ash</span><br><span class="line"></span><br><span class="line">$ docker run -dit --name alpine4 --network test-net alpine ash</span><br><span class="line"></span><br><span class="line">$ docker network connect bridge alpine4</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Since you can only specify <strong>one network when you use the <code>--network</code> flag for <code>docker run</code></strong>, if you need to <strong>connect to more than one network</strong>, you need to <strong>use <code>docker network connect</code> command with a running container</strong>.  </li>
</ul>
</blockquote>
</li>
<li><p>Now, if all the 4 containers are running properly, you can then <strong>inspect the <code>bridge</code> and the <code>test-net</code></strong> to see that the containers are included properly in the <code>&quot;containers&quot;</code> section. You should <strong>also be able to see the IP address</strong> that each one has been assigned.</p>
</li>
<li><p>Now, you can test their communication ability by connecting each one of them to the terminal (so that you  can do the <code>stdin</code> and see the <code>stdout</code> in your terminal) with the <code>docker container attach &lt;container-id&gt;</code> command. </p>
<p> On <code>user-defined network</code>s like <code>test-net</code>, containers can <strong>not only communicate by IP address</strong>, but can also <strong>resolve a container name to an IP address</strong>. This capability is called <strong>automatic service discovery</strong>. However, you will see that containers not connected to the same <code>bridge</code> cannot communicate with each other (both <code>alpine1</code> and <code>alpine2</code> cannot communicate with <code>alpine3</code>).</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">$ docker container attach alpine1</span><br><span class="line"></span><br><span class="line"># ping -c 2 alpine2</span><br><span class="line"></span><br><span class="line">PING alpine2 (172.18.0.3): 56 data bytes</span><br><span class="line">64 bytes from 172.18.0.3: seq&#x3D;0 ttl&#x3D;64 time&#x3D;0.085 ms</span><br><span class="line">64 bytes from 172.18.0.3: seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.090 ms</span><br><span class="line"></span><br><span class="line">--- alpine2 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 packets received, 0% packet loss</span><br><span class="line">round-trip min&#x2F;avg&#x2F;max &#x3D; 0.085&#x2F;0.087&#x2F;0.090 ms</span><br><span class="line"></span><br><span class="line"># ping -c 2 alpine4</span><br><span class="line"></span><br><span class="line">PING alpine4 (172.18.0.4): 56 data bytes</span><br><span class="line">64 bytes from 172.18.0.4: seq&#x3D;0 ttl&#x3D;64 time&#x3D;0.076 ms</span><br><span class="line">64 bytes from 172.18.0.4: seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.091 ms</span><br><span class="line"></span><br><span class="line">--- alpine4 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 packets received, 0% packet loss</span><br><span class="line">round-trip min&#x2F;avg&#x2F;max &#x3D; 0.076&#x2F;0.083&#x2F;0.091 ms</span><br><span class="line"></span><br><span class="line"># ping -c 2 alpine1</span><br><span class="line"></span><br><span class="line">PING alpine1 (172.18.0.2): 56 data bytes</span><br><span class="line">64 bytes from 172.18.0.2: seq&#x3D;0 ttl&#x3D;64 time&#x3D;0.026 ms</span><br><span class="line">64 bytes from 172.18.0.2: seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.054 ms</span><br><span class="line"></span><br><span class="line">--- alpine1 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 packets received, 0% packet loss</span><br><span class="line">round-trip min&#x2F;avg&#x2F;max &#x3D; 0.026&#x2F;0.040&#x2F;0.054 ms</span><br><span class="line">From alpine1, you should not be able to connect to alpine3 at all, since it is not on the alpine-net network.</span><br><span class="line"></span><br><span class="line"># ping -c 2 alpine3</span><br><span class="line"></span><br><span class="line">ping: bad address &#39;alpine3&#39;</span><br><span class="line"></span><br><span class="line">Ctrl+p Ctrl+q</span><br></pre></td></tr></table></figure>
<p> To exit the attached terminal, use <code>Ctrl+p</code> then <code>Ctrl+q</code>.</p>
</li>
<li><p>Finally, remember that <code>alpine4</code> is <strong>connected to both the <code>default</code> bridge network and <code>test-net</code></strong>. It should be able to reach all of the other containers. However, you will <strong>need to address <code>alpine3</code> by its IP address, which is the behavior of a default <code>bridge</code></strong>. Attach to it and run the tests.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">$ docker container attach alpine4</span><br><span class="line"></span><br><span class="line"># ping -c 2 alpine1</span><br><span class="line"></span><br><span class="line">PING alpine1 (172.18.0.2): 56 data bytes</span><br><span class="line">64 bytes from 172.18.0.2: seq&#x3D;0 ttl&#x3D;64 time&#x3D;0.074 ms</span><br><span class="line">64 bytes from 172.18.0.2: seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.082 ms</span><br><span class="line"></span><br><span class="line">--- alpine1 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 packets received, 0% packet loss</span><br><span class="line">round-trip min&#x2F;avg&#x2F;max &#x3D; 0.074&#x2F;0.078&#x2F;0.082 ms</span><br><span class="line"></span><br><span class="line"># ping -c 2 alpine2</span><br><span class="line"></span><br><span class="line">PING alpine2 (172.18.0.3): 56 data bytes</span><br><span class="line">64 bytes from 172.18.0.3: seq&#x3D;0 ttl&#x3D;64 time&#x3D;0.075 ms</span><br><span class="line">64 bytes from 172.18.0.3: seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.080 ms</span><br><span class="line"></span><br><span class="line">--- alpine2 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 packets received, 0% packet loss</span><br><span class="line">round-trip min&#x2F;avg&#x2F;max &#x3D; 0.075&#x2F;0.077&#x2F;0.080 ms</span><br><span class="line"></span><br><span class="line"># ping -c 2 alpine3</span><br><span class="line">ping: bad address &#39;alpine3&#39;</span><br><span class="line"></span><br><span class="line"># ping -c 2 172.17.0.2</span><br><span class="line"></span><br><span class="line">PING 172.17.0.2 (172.17.0.2): 56 data bytes</span><br><span class="line">64 bytes from 172.17.0.2: seq&#x3D;0 ttl&#x3D;64 time&#x3D;0.089 ms</span><br><span class="line">64 bytes from 172.17.0.2: seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.075 ms</span><br><span class="line"></span><br><span class="line">--- 172.17.0.2 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 packets received, 0% packet loss</span><br><span class="line">round-trip min&#x2F;avg&#x2F;max &#x3D; 0.075&#x2F;0.082&#x2F;0.089 ms</span><br><span class="line"></span><br><span class="line"># ping -c 2 alpine4</span><br><span class="line"></span><br><span class="line">PING alpine4 (172.18.0.4): 56 data bytes</span><br><span class="line">64 bytes from 172.18.0.4: seq&#x3D;0 ttl&#x3D;64 time&#x3D;0.033 ms</span><br><span class="line">64 bytes from 172.18.0.4: seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.064 ms</span><br><span class="line"></span><br><span class="line">--- alpine4 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 packets received, 0% packet loss</span><br><span class="line">round-trip min&#x2F;avg&#x2F;max &#x3D; 0.033&#x2F;0.048&#x2F;0.064 ms</span><br></pre></td></tr></table></figure>
</li>
<li><p>Now, you have finished your testsings, and you can <strong>stop and remove/disconnect all containers and the <code>test-net</code> network</strong>.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker container stop alpine1 alpine2 alpine3 alpine4</span><br><span class="line"></span><br><span class="line">$ docker container rm alpine1 alpine2 alpine3 alpine4</span><br><span class="line"></span><br><span class="line">$ docker network rm test-net</span><br></pre></td></tr></table></figure>

<p> or if you still need those containers:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ docker container stop alpine1 alpine2 alpine3 alpine4</span><br><span class="line"></span><br><span class="line">$ docker network disconnect test-net alpine1</span><br><span class="line"></span><br><span class="line">$ docker network disconnect test-net alpine2</span><br><span class="line"></span><br><span class="line">$ docker network disconnect test-net alpine4</span><br><span class="line"></span><br><span class="line">$ docker network rm test-net</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p><a name="Using-host-networks"></a></p>
<h2 id="Using-host-networks"><a href="#Using-host-networks" class="headerlink" title="Using host networks"></a>Using <code>host</code> networks</h2><p><a name="Using-overlay-networks"></a></p>
<h2 id="Using-overlay-networks"><a href="#Using-overlay-networks" class="headerlink" title="Using overlay networks"></a>Using <code>overlay</code> networks</h2><p>The <code>overlay</code> network driver creates a <strong>distributed network</strong> among <strong>multiple Docker daemon hosts</strong>. This network sits on top of (overlays) the host-specific networks, allowing containers connected to it (including swarm service containers) to communicate securely when encryption is enabled.</p>
<p>When you initialize a <code>swarm</code> or join a Docker host to an existing <code>swarm</code>, two new networks are created on that Docker host:</p>
<ul>
<li>an <code>overlay</code> network called <code>ingress</code>, which <strong>handles control and data traffic related to swarm services</strong>. When you create a <code>swarm</code> service and <strong>do not connect it to a <code>user-defined overlay</code></strong> network, it connects to the <code>ingress</code> network by default.<ul>
<li>You can <strong>create <code>user-defined overlay</code> networks using <code>docker network create</code></strong>, in the same way that you can create <code>user-defined bridge</code> networks. Remember that services or containers can be connected to more than one network at a time, and that services or containers can only communicate across networks they are each connected to.</li>
</ul>
</li>
<li>a <code>bridge</code> network called <code>docker_gwbridge</code>, which <strong>connects the individual Docker daemon to the other daemons participating in the swarm</strong>.</li>
</ul>
<h2 id="Creating-an-Overlay-Network-With-Swarm"><a href="#Creating-an-Overlay-Network-With-Swarm" class="headerlink" title="Creating an Overlay Network With Swarm"></a>Creating an Overlay Network With Swarm</h2><ol>
<li><p>First, there are two prerequisites you need to fulfill:</p>
<ul>
<li><p><strong>Firewall rules for Docker daemons</strong> using overlay networks<br>  You need the following ports open to traffic to and from each Docker host participating on an overlay network:</p>
<ul>
<li>TCP port 2377 for cluster management communications</li>
<li>TCP and UDP port 7946 for communication among nodes</li>
<li>UDP port 4789 for overlay network traffic</li>
</ul>
</li>
<li><p><strong>Before you can create an <code>overlay</code> network</strong>, you need to either** initialize your Docker daemon as a swarm manager using <code>docker swarm init</code> or join it to an existing swarm using <code>docker swarm join</code><strong>. Either of these creates the default <code>ingress</code> overlay network which is used by swarm services by default. You need to do this even if you never plan to use swarm services. **Afterward, you can create additional <code>user-defined overlay</code> networks</strong>.</p>
</li>
</ul>
</li>
<li><p>To create an <code>overlay</code> network <strong>for use with <code>swarm</code> services</strong>, use a command like the following:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create -d overlay my-overlay</span><br></pre></td></tr></table></figure>
<p> To create an overlay network which can be <strong>used by swarm services</strong> or <strong>standalone containers</strong> to communicate with other standalone containers running on other Docker daemons, add the –attachable flag:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create -d overlay --attachable my-attachable-overlay</span><br></pre></td></tr></table></figure>
</li>
<li><p>Encryption:</p>
<p> All swarm <strong>service management traffic</strong> is <strong>encrypted by default</strong>, using the AES algorithm in GCM mode. <strong>Manager nodes in the swarm rotate the key</strong> used to encrypt gossip data <strong>every 12 hours</strong>.</p>
<p> To <strong>encrypt application data</strong> as well, <strong>add <code>--opt</code> encrypted when creating the <code>overlay</code> network</strong>. This enables IPSEC encryption at the level of the vxlan. This encryption imposes a <strong>non-negligible performance penalty</strong>, so you should test this option before using it in production.</p>
<p> So, for example, to encrypt your application data as well:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create --opt encrypted --driver overlay --attachable my-attachable-multi-host-network</span><br></pre></td></tr></table></figure>
</li>
<li><p>Now, you can customized your default <code>ingress</code> network or your <code>docker_gwbridge</code>, and your <code>user-defined overlay</code>.</p>
</li>
<li><p>Now, you have 4 options on how to use this <code>overlay</code> system:</p>
<ul>
<li><p>Use the <strong>default <code>overlay</code> network</strong>, which demonstrates how to use the default overlay network that Docker sets up for you automatically when you initialize or join a swarm. This network is not the best choice for production systems.</p>
</li>
<li><p>Use <strong><code>user-defined overlay</code> networks</strong> which shows how to create and use your own custom overlay networks, to <strong>connect services</strong>. This is recommended for services running in production.</p>
</li>
<li><p>Use an <strong><code>overlay</code> network for standalone containers shows how to communicate between standalone containers on different Docker daemons</strong> using an overlay network.</p>
</li>
<li><p>Communicate between <strong>a container and a swarm service</strong>, which sets up communication between a standalone container and a swarm service, using an <code>attachable</code> overlay network. This is supported in Docker 17.06 and higher.</p>
</li>
</ul>
</li>
</ol>
<h2 id="Use-the-default-overlay-network"><a href="#Use-the-default-overlay-network" class="headerlink" title="Use the default overlay network"></a>Use the <code>default overlay</code> network</h2><p>In this example, you start an <code>alpin</code>e service and examine the characteristics of the network from the point of view of the individual service containers.</p>
<ol>
<li><p>Prerequisites:</p>
<p> This requires <strong>three physical or virtual Docker hosts which can all communicate with one another</strong>, all running new installations of Docker 17.03 or higher. This tutorial <strong>assumes that the three hosts are running on the same network</strong> with no firewall involved.</p>
<p> These hosts will be referred to as <code>manager</code>, <code>worker-1</code>, and <code>worker-2</code>. The manager host will function as both a <code>manager</code> and a <code>worker</code>, which means it can <strong>both run service tasks</strong> and <strong>manage the swarm</strong>. <code>worker-1</code> and <code>worker-2</code> will function as workers only,</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> To open those ports specified above, you can use the following command (on both worker and manager): <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --add-port&#x3D;22&#x2F;tcp --permanent</span><br><span class="line">firewall-cmd --add-port&#x3D;2376&#x2F;tcp --permanent</span><br><span class="line">firewall-cmd --add-port&#x3D;2377&#x2F;tcp --permanent</span><br><span class="line">firewall-cmd --add-port&#x3D;7946&#x2F;tcp --permanent</span><br><span class="line">firewall-cmd --add-port&#x3D;7946&#x2F;udp --permanent</span><br><span class="line">firewall-cmd --add-port&#x3D;4789&#x2F;udp --permanent </span><br></pre></td></tr></table></figure>
Afterwards, reload the firewall:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>
Then restart Docker.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>
For other means of doing the same thing, please visit <a href="https://www.digitalocean.com/community/tutorials/how-to-configure-the-linux-firewall-for-docker-swarm-on-ubuntu-16-04#method-2-%E2%80%94-opening-docker-swarm-ports-using-firewalld" target="_blank" rel="noopener">this link</a></li>
</ul>
</blockquote>
</li>
<li><p><strong>On <code>manager</code>, initialize the swarm</strong>. If the host only has one network interface, the <code>--advertise-addr</code> flag is optional.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker swarm init --advertise-addr&#x3D;&lt;IP-ADDRESS-OF-MANAGER&gt;</span><br></pre></td></tr></table></figure>

<p> Make a note of the text that is printed, as this contains the token that you will use to join <code>worker-1</code> and <code>worker-2</code> to the swarm. It is a good idea to store the token in a password manager.</p>
</li>
<li><p><strong>On <code>worker-1</code>, join the swarm</strong>. If the host only has one network interface, the <code>--advertise-addr</code> flag is optional.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker swarm join --token &lt;TOKEN&gt; \</span><br><span class="line">  --advertise-addr &lt;IP-ADDRESS-OF-WORKER-1&gt; \</span><br><span class="line">  &lt;IP-ADDRESS-OF-MANAGER&gt;:2377</span><br></pre></td></tr></table></figure>
</li>
<li><p>On <code>worker-2</code>, join the swarm. If the host only has one network interface, the <code>--advertise-addr</code> flag is optional.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker swarm join --token &lt;TOKEN&gt; \</span><br><span class="line">  --advertise-addr &lt;IP-ADDRESS-OF-WORKER-2&gt; \</span><br><span class="line">  &lt;IP-ADDRESS-OF-MANAGER&gt;:2377</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>On <code>manager</code>, list all the nodes</strong>. This command <strong>can only be done from a manager</strong>.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ docker node ls</span><br><span class="line"></span><br><span class="line">ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS</span><br><span class="line">d68ace5iraw6whp7llvgjpu48 *   ip-172-31-34-146    Ready               Active              Leader</span><br><span class="line">nvp5rwavvb8lhdggo8fcf7plg     ip-172-31-35-151    Ready               Active</span><br><span class="line">ouvx2l7qfcxisoyms8mtkgahw     ip-172-31-36-89     Ready               Active</span><br></pre></td></tr></table></figure>
</li>
<li><p>You can also use the <code>--filter</code> flag to filter by role:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ docker node ls --filter role&#x3D;manager</span><br><span class="line"></span><br><span class="line">ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS</span><br><span class="line">d68ace5iraw6whp7llvgjpu48 *   ip-172-31-34-146    Ready               Active              Leader</span><br><span class="line"></span><br><span class="line">$ docker node ls --filter role&#x3D;worker</span><br><span class="line"></span><br><span class="line">ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS</span><br><span class="line">nvp5rwavvb8lhdggo8fcf7plg     ip-172-31-35-151    Ready               Active</span><br><span class="line">ouvx2l7qfcxisoyms8mtkgahw     ip-172-31-36-89     Ready               Active</span><br></pre></td></tr></table></figure>
</li>
<li><p>List the Docker networks on <code>manager</code>, <code>worker-1</code>, and <code>worker-2</code> and notice that <strong>each of them now has an overlay network called <code>ingress</code></strong> and a <code>bridge</code> network called <code>docker_gwbridge</code>. Only the listing for manager is shown here:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ docker network ls</span><br><span class="line"></span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">495c570066be        bridge              bridge              local</span><br><span class="line">961c6cae9945        docker_gwbridge     bridge              local</span><br><span class="line">ff35ceda3643        host                host                local</span><br><span class="line">trtnl4tqnc3n        ingress             overlay             swarm</span><br><span class="line">c8357deec9cb        none                null                local</span><br></pre></td></tr></table></figure>
</li>
<li><p>The <code>docker_gwbridge</code> connects the <code>ingress</code> network to the Docker host’s network interface so that traffic can flow to and from swarm managers and workers. If you create <code>swarm</code> services and <strong>do not specify a network, they are connected to the <code>ingress</code> network</strong>. It is recommended that you use separate overlay networks for each application or group of applications which will work together. In the next procedure, you will create two overlay networks and connect a service to each of them.</p>
</li>
<li><p>CREATE THE <strong>SERVICES</strong></p>
<p> <strong>On <code>manager</code></strong>, create a new <code>overlay</code> network called <code>nginx-net</code>:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create -d overlay nginx-net</span><br></pre></td></tr></table></figure>

<p> You <strong>don’t need to create the <code>overlay</code> network on the other nodes</strong>, beacause it will be automatically created when one of those <strong>nodes starts running a service task which requires it</strong>.</p>
<p> On <code>manager</code>, create a 5-replica Nginx <strong>service connected to <code>nginx-net</code></strong>. The service will publish port 80 to the outside world. All of the service task containers can communicate with each other without opening any ports.</p>
<p> Note: Services can only be created on a manager.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ docker service create \</span><br><span class="line">  --name my-nginx \</span><br><span class="line">  --publish target&#x3D;80,published&#x3D;80 \</span><br><span class="line">  --replicas&#x3D;5 \</span><br><span class="line">  --network nginx-net \</span><br><span class="line">  nginx</span><br></pre></td></tr></table></figure>

<p> The default publish mode of <code>ingress</code>, which is used when you <strong>do not specify a mode</strong> for the <code>--publish</code> flag, means that if you browse to port 80 on <code>manager</code>, <code>worker-1</code>, or <code>worker-2</code>, you will be connected to port 80 on one of the 5 service tasks, even if no tasks are currently running on the node you browse to. If you want to publish the port using host mode, you can add mode=host to the –publish output. However, you should also use <code>--mode global</code> instead of <code>--replicas=5</code> in this case, since only one service task can bind a given port on a given node.</p>
</li>
<li><p>Run <code>docker service ls</code> to <strong>monitor the progress of service bring-up</strong>, which may take a few seconds.</p>
</li>
<li><p>Inspect the <code>nginx-net</code> network on <code>manager</code>, <code>worker-1</code>, and <code>worker-2</code>. Remember that you did not need to create it manually on <code>worker-1</code> and <code>worker-2</code> because Docker created it for you. The output will be long, but notice the <code>Containers</code> and <code>Peers</code> sections. Containers lists all service tasks (or standalone containers) connected to the overlay network from that host.</p>
<p>From manager, inspect the service using <code>docker service inspect my-nginx</code> and notice the information about the ports and endpoints used by the service.</p>
</li>
<li><p>Create a new network <code>nginx-net-2</code>, then update the service to use this network instead of <code>nginx-net</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create -d overlay nginx-net-2</span><br><span class="line">$ docker service update \</span><br><span class="line">  --network-add nginx-net-2 \</span><br><span class="line">  --network-rm nginx-net \</span><br><span class="line">  my-nginx</span><br></pre></td></tr></table></figure></li>
<li><p>Run <code>docker service ls</code> to verify that the service has been updated and all tasks have been redeployed. Run <code>docker network inspect nginx-net</code> to verify that no containers are connected to it. Run the same command for <code>nginx-net-2</code> and notice that all the service task containers are connected to it.</p>
<p>Note: Even though overlay networks are automatically created on swarm worker nodes as needed, they are not automatically removed.</p>
</li>
<li><p>Clean up the service and the networks. From <code>manager</code>, run the following commands. The manager will direct the workers to remove the networks automatically.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker service rm my-nginx</span><br><span class="line">$ docker network rm nginx-net nginx-net-2</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="Using-a-user-defined-overlay"><a href="#Using-a-user-defined-overlay" class="headerlink" title="Using a user-defined overlay"></a>Using a <code>user-defined overlay</code></h2><ol>
<li><p>First you need to create the <code>user-defined overlay</code> network.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create -d overlay my-overlay</span><br></pre></td></tr></table></figure>
</li>
<li><p>Start a service using the <code>overlay</code> network and publishing port <code>80</code> to port <code>8080</code> on the Docker host.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ docker service create \</span><br><span class="line">  --name my-nginx \</span><br><span class="line">  --network my-overlay \</span><br><span class="line">  --replicas 1 \</span><br><span class="line">  --publish published&#x3D;8080,target&#x3D;80 \</span><br><span class="line">  nginx:latest</span><br></pre></td></tr></table></figure>
</li>
<li><p>Run <code>docker network inspect my-overlay</code> and verify that the <code>my-nginx</code> <strong>service task</strong> is connected to it, by looking at the <strong>Containers section</strong>.</p>
</li>
<li><p>Inspect the <code>my-overlay</code> network on <code>manager</code>, <code>worker-1</code>, and <code>worker-2</code>. Remember that you did not need to create it manually on <code>worker-1</code> and <code>worker-2</code> because Docker created it for you. The output will be long, but notice the <code>Containers</code> and <code>Peers</code> sections. Containers lists all service tasks (or standalone containers) connected to the overlay network from that host.</p>
</li>
<li><p>Remove the service and the network on the <code>manager</code> after you see it works fine.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker service rm my-nginx</span><br><span class="line"></span><br><span class="line">$ docker network rm my-overlay</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="Using-an-overlay-network-for-standalone-containers-recommended"><a href="#Using-an-overlay-network-for-standalone-containers-recommended" class="headerlink" title="Using an overlay network for standalone containers (recommended)"></a>Using an <code>overlay</code> network for standalone containers (recommended)</h2><p>This example refers to the <strong>two nodes</strong> in our swarm as <code>host1</code> and <code>host2</code>. This example also uses Linux hosts, but the same commands work on Windows.</p>
<p>This example demonstrates DNS container discovery – specifically, how to <strong>communicate between standalone containers on different Docker daemons</strong> using an <code>overlay</code> network. In short, steps are:</p>
<ul>
<li>On <code>host1</code>, initialize the node as a swarm (<code>manager</code>).</li>
<li>On <code>host2</code>, join the node to the swarm (<code>worker</code>).</li>
<li>On <code>host1</code>, create an <strong>attachable overlay network</strong> (<code>test-net</code>).</li>
<li>On <code>host1</code>, run an <strong>interactive alpine container</strong> (<code>alpine1</code>) <strong>on <code>test-net</code></strong>.</li>
<li>On <code>host2</code>, run an <strong>interactive, and detached, alpine container</strong> (<code>alpine2</code>) on <code>test-net</code>.</li>
<li>On <code>host1</code>, <strong>from</strong> within a session of <strong><code>alpine1</code></strong>, <strong>ping <code>alpine2</code></strong>.</li>
</ul>
<ol>
<li><p>Set up the swarm.</p>
<p> a. On <code>host1</code>, <strong>initialize a swarm</strong> (and if prompted, use <code>--advertise-addr</code> to specify the IP address for the interface that communicates with other hosts in the swarm, for instance, the private IP address on AWS).<br> b. On <code>host2</code>, join the swarm as instructed above, usually in the form:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker swarm join --token &lt;your_token&gt; &lt;your_ip_address&gt;:2377</span><br><span class="line">This node joined a swarm as a worker.</span><br></pre></td></tr></table></figure>
</li>
<li><p>On <code>host1</code>, create an <strong>attachable overlay network</strong> called <code>test-net</code>:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create --driver&#x3D;overlay --attachable test-net</span><br><span class="line">uqsof8phj3ak0rq9k86zta6ht</span><br></pre></td></tr></table></figure>

<p> Notice the returned NETWORK ID – you will see it again when you connect to it from <code>host2</code>.</p>
</li>
<li><p>On <code>host1</code>, start an <strong>interactive (<code>-it</code>) container</strong> (<code>alpine1</code>) that <strong>connects to <code>test-net</code></strong>:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --name alpine1 --network test-net alpine</span><br><span class="line">&#x2F; #</span><br></pre></td></tr></table></figure>
</li>
<li><p>On <code>host2</code>, list the available networks – notice that <code>test-net</code> <strong>does not yet exist</strong> (because it is not currently required by any containers, though it is available. see next step):</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">ec299350b504        bridge              bridge              local</span><br><span class="line">66e77d0d0e9a        docker_gwbridge     bridge              local</span><br><span class="line">9f6ae26ccb82        host                host                local</span><br><span class="line">omvdxqrda80z        ingress             overlay             swarm</span><br><span class="line">b65c952a4b2b        none                null                local</span><br></pre></td></tr></table></figure>
</li>
<li><p>On <code>host2</code>, start a detached (<code>-d</code>) and interactive (<code>-it</code>) container (alpine2) that connects to test-net:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -dit --name alpine2 --network test-net alpine</span><br><span class="line">fb635f5ece59563e7b8b99556f816d24e6949a5f6a5b1fbd92ca244db17a4342</span><br></pre></td></tr></table></figure>

<p> where:</p>
<ul>
<li>Automatic DNS container discovery only works with unique container names.</li>
<li>Being <code>detached</code> means the container is <strong>no longer listening to the command line where <code>docker run</code> was run</strong>.  By design, containers started in detached mode <strong>exit when the root process used to run the container exits</strong>, unless you also specify the <code>--rm</code> option. If you use <code>-d</code> with <code>--rm</code>, the container is removed when it exits or when the daemon exits, whichever happens first.</li>
</ul>
</li>
<li><p>On <code>host2</code>, verify that <code>test-net</code> was created (and has the same NETWORK ID as test-net on host1):</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">...</span><br><span class="line">uqsof8phj3ak        test-net            overlay             swarm</span><br></pre></td></tr></table></figure>
</li>
<li><p>On <code>host1</code>, ping <code>alpine2</code> within the interactive terminal of alpine1:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F; # ping -c 2 alpine2</span><br><span class="line">PING alpine2 (10.0.0.5): 56 data bytes</span><br><span class="line">64 bytes from 10.0.0.5: seq&#x3D;0 ttl&#x3D;64 time&#x3D;0.600 ms</span><br><span class="line">64 bytes from 10.0.0.5: seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.555 ms</span><br><span class="line"></span><br><span class="line">--- alpine2 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 packets received, 0% packet loss</span><br><span class="line">round-trip min&#x2F;avg&#x2F;max &#x3D; 0.555&#x2F;0.577&#x2F;0.600 ms</span><br></pre></td></tr></table></figure>
</li>
<li><p>The two containers communicate with the <code>overlay</code> network connecting the two hosts. If you run another <code>alpine</code> container on <code>host2</code> that is <strong>not detached</strong>, you can ping <code>alpine1</code> from <code>host2</code> (and here we add the remove option for automatic container cleanup):</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --rm --name alpine3 --network test-net alpine</span><br><span class="line">&#x2F; # ping -c 2 alpine1</span><br><span class="line">&#x2F; # exit</span><br></pre></td></tr></table></figure>
</li>
<li><p>On host1, close the alpine1 session (which also stops the container):</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F; # exit</span><br></pre></td></tr></table></figure>
</li>
<li><p>Clean up your containers and networks:</p>
<p>You must <strong>stop and remove the containers on each host independently</strong> because Docker daemons operate independently and these are standalone containers. You only have to remove the network on <code>host1</code> because when you stop <code>alpine2</code> on <code>host2</code>, <code>test-net</code> disappears (as it is no longer required).</p>
<p>a. On <code>host2</code>, stop <code>alpine2</code>, check that <code>test-net</code> was removed, then remove <code>alpine2</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker container stop alpine2</span><br><span class="line">$ docker network ls</span><br><span class="line">$ docker container rm alpine2</span><br></pre></td></tr></table></figure>

<p>b. On <code>host1</code>, remove <code>alpine1</code> and <code>test-net</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker container rm alpine1</span><br><span class="line">$ docker network rm test-net</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="Customizing-your-ingress-network"><a href="#Customizing-your-ingress-network" class="headerlink" title="Customizing your ingress network"></a>Customizing your <code>ingress</code> network</h2><p>Most users never need to configure the <code>ingress</code> network, but Docker 17.05 and higher allow you to do so. This can be useful <strong>if the automatically-chosen subnet conflicts with one that already exists on your network</strong>, or you need to customize other low-level network settings such as the MTU.</p>
<p>Customizing the ingress network <strong>involves removing and recreating it</strong>. This is usually done <strong>before you create any services in the swarm</strong>. If you have existing services which publish ports, <strong>those services need to be removed</strong> before you can remove the ingress network.</p>
<p>During the time that no <code>ingress</code> network exists, existing services which do not publish ports continue to function but are not load-balanced. This affects services which publish ports, such as a WordPress service which publishes port 80.</p>
<p>Inspect the <code>ingress</code> network using <code>docker network inspect ingress</code>, and remove any services whose containers are connected to it. These are services that publish ports, such as a WordPress service which publishes port 80. If all such services are not stopped, the next step fails.</p>
<ol>
<li><p>Remove the existing ingress network:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ docker network rm ingress</span><br><span class="line"></span><br><span class="line">WARNING! Before removing the routing-mesh network, make sure all the nodes</span><br><span class="line">in your swarm run the same docker engine version. Otherwise, removal may not</span><br><span class="line">be effective and functionality of newly created ingress networks will be</span><br><span class="line">impaired.</span><br><span class="line">Are you sure you want to continue? [y&#x2F;N]</span><br></pre></td></tr></table></figure>
</li>
<li><p>Create a new overlay network using the <code>--ingress</code> flag, along with the custom options you want to set. This example sets the <code>MTU</code> to <code>1200</code>, sets the <code>subnet</code> to <code>10.11.0.0/16</code>, and sets the <code>gateway</code> to <code>10.11.0.2</code>.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create \</span><br><span class="line">  --driver overlay \</span><br><span class="line">  --ingress \</span><br><span class="line">  --subnet&#x3D;10.11.0.0&#x2F;16 \</span><br><span class="line">  --gateway&#x3D;10.11.0.2 \</span><br><span class="line">  --opt com.docker.network.driver.mtu&#x3D;1200 \</span><br><span class="line">  my-ingress</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note: </p>
<ul>
<li><input disabled type="checkbox"> You can name your <code>ingress</code> network with a name of something other than <code>ingress</code>, but you can only have one <code>ingress</code> network. An attempt to create a second one fails.</li>
</ul>
</blockquote>
</li>
<li><p>Restart the services that you stopped in the first step.</p>
</li>
</ol>
<h2 id="Customizing-your-docker-gwbridge-network"><a href="#Customizing-your-docker-gwbridge-network" class="headerlink" title="Customizing your docker_gwbridge network"></a>Customizing your <code>docker_gwbridge</code> network</h2><p><code>docker_gwbridge</code> <strong>connects the overlay networks (including the <code>ingress</code> network)</strong> to an individual Docker daemon’s physical network (<strong><code>swarm</code> host</strong>). Docker creates it automatically when you initialize a <code>swarm</code> or join a Docker host to a <code>swarm</code>, but it is <strong>not a Docker device</strong>. It exists in the kernel of the Docker host. If you need to customize its settings, you must do so <strong>before joining the Docker host to the swarm</strong>, or after temporarily removing the host from the swarm.</p>
<ol>
<li><p>Stop Docker, and delete the existing docker_gwbridge interface.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ip link set docker_gwbridge down</span><br><span class="line"></span><br><span class="line">$ sudo ip link del dev docker_gwbridge</span><br></pre></td></tr></table></figure>
</li>
<li><p>Start Docker. <strong>Do not join or initialize</strong> the swarm.</p>
</li>
<li><p><strong>Create or re-create the <code>docker_gwbridge</code> bridge manually with your custom settings</strong>, using the <code>docker network create</code> command. This example uses the <code>subnet</code> <code>10.11.0.0/16</code>. For a full list of customizable options, see <a href="https://docs.docker.com/engine/reference/commandline/network_create/#bridge-driver-options" target="_blank" rel="noopener">Bridge driver options</a>.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create \</span><br><span class="line">--subnet 10.11.0.0&#x2F;16 \</span><br><span class="line">--opt com.docker.network.bridge.name&#x3D;docker_gwbridge \</span><br><span class="line">--opt com.docker.network.bridge.enable_icc&#x3D;false \</span><br><span class="line">--opt com.docker.network.bridge.enable_ip_masquerade&#x3D;true \</span><br><span class="line">docker_gwbridge</span><br></pre></td></tr></table></figure>
</li>
<li><p>Initialize or join the <code>swarm</code>. Since the bridge <strong>already exists</strong>, Docker <strong>does not create it with automatic settings</strong>.</p>
</li>
</ol>
<h2 id="Customizing-your-user-defined-overlay-network"><a href="#Customizing-your-user-defined-overlay-network" class="headerlink" title="Customizing your user-defined overlay network"></a>Customizing your <code>user-defined overlay</code> network</h2><p><a name="Using-mcvlan-networks"></a></p>
<h2 id="Using-mcvlan-networks"><a href="#Using-mcvlan-networks" class="headerlink" title="Using mcvlan networks"></a>Using <code>mcvlan</code> networks</h2><p><a name="Using-none-networks"></a></p>
<h2 id="Using-none-networks"><a href="#Using-none-networks" class="headerlink" title="Using none networks"></a>Using <code>none</code> networks</h2><p><a name="MySQL-in-Docker"></a></p>
<h2 id="Using-MySQL-Server-in-Docker"><a href="#Using-MySQL-Server-in-Docker" class="headerlink" title="Using MySQL Server in Docker"></a>Using MySQL Server in Docker</h2><ol>
<li>You need to first setup your SQL server in docker via this <a href="https://dev.mysql.com/doc/mysql-installation-excerpt/8.0/en/docker-mysql-getting-started.html" target="_blank" rel="noopener">Official Guide</a></li>
<li>Then refer to <a href="https://jasonyux.github.io/2020/05/26/MySQL-Manual" target="_blank" rel="noopener">MySQL Manual</a> for further reference on using MySQL</li>
</ol>
<h2 id="Creating-and-Mounting-a-Volume-to-MySQL-data"><a href="#Creating-and-Mounting-a-Volume-to-MySQL-data" class="headerlink" title="Creating and Mounting a Volume to MySQL data"></a>Creating and Mounting a Volume to MySQL data</h2><ol>
<li><p>First, to create a volume, you need to run:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker volume create &lt;my-vol&gt;</span><br></pre></td></tr></table></figure>

<p> This will create a volume at your local directory <code>/var/lib/docker/volumes/&lt;my-vol&gt;/_data</code></p>
</li>
<li><p>You can list the volumes you have with:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker volume ls</span><br></pre></td></tr></table></figure>

<p> At this point, if you see some other volumes that are temporary created and you don’t want them, you can use:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker volume rm &lt;my-vol&gt;</span><br></pre></td></tr></table></figure>

<p> or use the <code>prune</code> keyword which will delete volumes that are not used by any containers:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker volume prune</span><br></pre></td></tr></table></figure>
</li>
<li><p>Now, you can mount a volume to your container with either the <code>-v</code> or <code>--mount</code> option. To store mount volumes to directory where <code>mysql</code> stores its data, you need to mount to <code>/var/opt/mssql</code>. Examples below produce the same result (this example uses the image called <code>mysql:latest</code> and creates a container <code>devtest</code>). </p>
<ul>
<li><p><code>--mount</code></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d \</span><br><span class="line">  --name devtest \</span><br><span class="line">  --mount source&#x3D;myvol2,target&#x3D;&#x2F;var&#x2F;opt&#x2F;mssql \</span><br><span class="line">  mysql:latest</span><br></pre></td></tr></table></figure></li>
<li><p><code>-v</code></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d \</span><br><span class="line">  --name devtest \</span><br><span class="line">  -v myvol2:&#x2F;var&#x2F;opt&#x2F;mssql \</span><br><span class="line">  mysql:latest</span><br></pre></td></tr></table></figure>
</li>
<li><p>To mount multiple volumes, you can do:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d \</span><br><span class="line">  --name devtest \</span><br><span class="line">  -v myvol2:&#x2F;var&#x2F;opt&#x2F;mssql \</span><br><span class="line">  -v myvol3:&#x2F;var \</span><br><span class="line">  mysql:latest</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> If the name of the volume you specified does not exist, <code>docker</code> will create one with that name for you.</li>
<li><input disabled type="checkbox"> It is also allowed to mount multiple containers to the same volume.</li>
</ul>
</blockquote>
</li>
</ul>
</li>
<li><p>You can then use <code>docker inspect devtest</code> to verify that the volume was created and mounted correctly. Look for the Mounts section:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&quot;Mounts&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;myvol2&quot;,</span><br><span class="line">        &quot;Source&quot;: &quot;&#x2F;var&#x2F;lib&#x2F;docker&#x2F;volumes&#x2F;myvol2&#x2F;_data&quot;,</span><br><span class="line">        &quot;Destination&quot;: &quot;&#x2F;app&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">        &quot;RW&quot;: true,</span><br><span class="line">        &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">    &#125;</span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<p> This shows that the mount is a volume, it shows the correct source and destination, and that the mount is read-write.</p>
</li>
<li><p>If you want to remove a volume, you need to <strong>stop and remove the container, and then remove the volume</strong>. Note volume removal is a separate step.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker container stop devtest</span><br><span class="line"></span><br><span class="line">$ docker container rm devtest</span><br><span class="line"></span><br><span class="line">$ docker volume rm myvol2</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="Use-a-Volume-for-Read-Only-Purpose"><a href="#Use-a-Volume-for-Read-Only-Purpose" class="headerlink" title="Use a Volume for Read-Only Purpose"></a>Use a Volume for Read-Only Purpose</h2><p>For some development applications, the container needs to write into the bind mount so that changes are propagated back to the Docker host. At other times, the container <strong>only needs read access to the data</strong>. Remember that multiple containers can mount the same volume, and it can be mounted read-write for some of them and read-only for others, at the same time.</p>
<p>Suppose you want to access the data in the volume <code>nginx-vol</code> for the following examples.</p>
<p>The following modifies the one above but <strong>mounts the directory as a read-only volume</strong>, by adding <code>readonly</code> or <code>ro</code> to the (empty by default) list of options, after the mount point within the container. If multiple options are present, separate them by commas.</p>
<p>The <code>--mount</code> and <code>-v</code> examples have the same result.</p>
<ul>
<li><p><code>--mount</code></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d \</span><br><span class="line">  --name&#x3D;nginxtest \</span><br><span class="line">  --mount source&#x3D;nginx-vol,destination&#x3D;&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html,readonly \</span><br><span class="line">  nginx:latest</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>-v</code></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d \</span><br><span class="line">  --name&#x3D;nginxtest \</span><br><span class="line">  -v nginx-vol:&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html:ro \</span><br><span class="line">  nginx:latest</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>Now you can use <code>docker inspect nginxtest</code> to <strong>verify that the readonly mount was created correctly</strong>. Look for the Mounts section, where you see <code>&quot;RW&quot;: false</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&quot;Mounts&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;nginx-vol&quot;,</span><br><span class="line">        &quot;Source&quot;: &quot;&#x2F;var&#x2F;lib&#x2F;docker&#x2F;volumes&#x2F;nginx-vol&#x2F;_data&quot;,</span><br><span class="line">        &quot;Destination&quot;: &quot;&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">        &quot;RW&quot;: false,</span><br><span class="line">        &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">    &#125;</span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<h2 id="Overview-of-Docker-Compose"><a href="#Overview-of-Docker-Compose" class="headerlink" title="Overview of Docker Compose"></a>Overview of Docker Compose</h2><p>Compose is a tool for <strong>defining and running multi-container Docker applications</strong>. With Compose, you use a <code>YAML</code> file to configure your application’s services. Then, with a single command, you create and start all the services from your configuration.</p>
<p>Using Compose is basically a <strong>three-step process</strong>:</p>
<ol>
<li><strong>Define</strong> your app’s environment with a <strong>Dockerfile</strong> so it can be reproduced anywhere.</li>
<li><strong>Define the services</strong> that make up your app in <code>docker-compose.yml</code> so they can be run together in an isolated environment.</li>
<li><strong>Run <code>docker-compose up</code></strong> and Compose starts and runs your entire app.</li>
</ol>
<p>A <code>docker-compose.yml</code> looks like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">version: &#39;2.0&#39;</span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    build: .</span><br><span class="line">    ports:</span><br><span class="line">    - &quot;5000:5000&quot;</span><br><span class="line">    volumes:</span><br><span class="line">    - .:&#x2F;code</span><br><span class="line">    - logvolume01:&#x2F;var&#x2F;log</span><br><span class="line">    links:</span><br><span class="line">    - redis</span><br><span class="line">  redis:</span><br><span class="line">    image: redis</span><br><span class="line">volumes:</span><br><span class="line">  logvolume01: &#123;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Installing-Docker-Compose"><a href="#Installing-Docker-Compose" class="headerlink" title="Installing Docker Compose"></a>Installing Docker Compose</h2><p>Docker Compose depends on the Docker engine to work properly. After you have installed the Docker engine, please refer to <a href="https://docs.docker.com/compose/install/" target="_blank" rel="noopener">this link</a> to install Docker Compose.</p>
<h2 id="QuickStart-with-Docker-Compose"><a href="#QuickStart-with-Docker-Compose" class="headerlink" title="QuickStart with Docker Compose"></a>QuickStart with Docker Compose</h2><p>For getting a sense of how <code>docker compose</code> works, please visit the <a href="https://docs.docker.com/compose/gettingstarted/" target="_blank" rel="noopener">this Docker Documentation</a>.</p>
<p>Some important steps are shown here:</p>
<ul>
<li><p>Step 5: Edit the Compose file to <strong>add a bind mount</strong></p>
<p>  Edit docker-compose.yml in your project directory to add a bind mount for the web service:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">version: &#39;3&#39;</span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    build: .</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;5000:5000&quot;</span><br><span class="line">    volumes:</span><br><span class="line">      - .:&#x2F;code</span><br><span class="line">    environment:</span><br><span class="line">      FLASK_ENV: development</span><br><span class="line">  redis:</span><br><span class="line">    image: &quot;redis:alpine&quot;</span><br></pre></td></tr></table></figure>

<p>  The new volumes key <strong>mounts the project directory (current directory)</strong> on the host <strong>to <code>/code</code> inside the container</strong>. Now, you need to re-build the image for it to take effect. Afterwards, by mounting a volume it is allowing you to modify the code on the fly, without having to rebuild the image. The environment key sets the <code>FLASK_ENV</code> environment variable, which tells flask run to run in development mode and reload the code on change. <strong>This mode should only be used in development</strong>.</p>
</li>
<li><p>Step 6: <strong>Re-build and run</strong> the app with Compose</p>
<p>  From your project directory, type docker-compose up to build the app with the updated Compose file, and run it.</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ docker-compose up</span><br><span class="line">Creating network &quot;composetest_default&quot; with the default driver</span><br><span class="line">Creating composetest_web_1 ...</span><br><span class="line">Creating composetest_redis_1 ...</span><br><span class="line">Creating composetest_web_1</span><br><span class="line">Creating composetest_redis_1 ... done</span><br><span class="line">Attaching to composetest_web_1, composetest_redis_1</span><br><span class="line">web_1    |  * Running on http:&#x2F;&#x2F;0.0.0.0:5000&#x2F; (Press CTRL+C to quit)</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/05/25/Docker-Manual/" data-id="ckamcbohu000060orfr6dh1u8" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Apache-Manual-md" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/05/22/Apache-Manual-md/" class="article-date">
  <time datetime="2020-05-22T05:40:13.000Z" itemprop="datePublished">2020-05-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/05/22/Apache-Manual-md/">Apache Maven Manual</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<p><strong>IMPORTANT</strong>:<br>Much of the content here is a personal summary/abbrieviation of contents on the <a href="https://maven.apache.org/users/index.html" target="_blank" rel="noopener">Offical Apache Maven Guide</a>. For more complete information, please refer to the offical site.</p>
<hr>
<h2 id="Apache-Maven-Introduction"><a href="#Apache-Maven-Introduction" class="headerlink" title="Apache Maven Introduction"></a>Apache Maven Introduction</h2><ul>
<li><strong>*Q: What is Apache Maven used for? *</strong></li>
</ul>
<p>In a nutshell Maven is an attempt to <strong>apply patterns to a project’s build infrastructure in order to promote comprehension and productivity</strong> by providing a clear path in the use of best practices. Maven is essentially a <strong>project management and comprehension tool</strong> and as such provides a way to help with managing:</p>
<ul>
<li>Builds</li>
<li>Documentation</li>
<li>Reporting</li>
<li>Dependencies</li>
<li>SCMs</li>
<li>Releases</li>
<li>Distribution</li>
</ul>
<p>Maven can provide benefits for your build process by <strong>employing standard conventions and practices</strong> to accelerate your development cycle while at the same time helping you achieve a higher rate of success.</p>
<h2 id="Installing-Maven"><a href="#Installing-Maven" class="headerlink" title="Installing Maven"></a>Installing Maven</h2><p>Please follow <a href="https://maven.apache.org/guides/getting-started/maven-in-five-minutes.html" target="_blank" rel="noopener">Apache Maven Guide</a></p>
<h2 id="Creating-a-Project-QuickStart"><a href="#Creating-a-Project-QuickStart" class="headerlink" title="Creating a Project (QuickStart)"></a>Creating a Project (QuickStart)</h2><p>First you might want to create a workspace folder where all your Maven project resides. Then, you could <strong>navigate to that folder’s directory</strong> and run:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn archetype:generate -DgroupId&#x3D;com.mycompany.app -DartifactId&#x3D;my-app -DarchetypeArtifactId&#x3D;maven-archetype-quickstart -DarchetypeVersion&#x3D;1.4 -DinteractiveMode&#x3D;false</span><br></pre></td></tr></table></figure>
<p>where the <code>-DartifactId=my-app</code> would be the new <strong>folder with name <code>my-app</code></strong> under that directory you created.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> If you have just installed Maven, it may take a while on the first run.</li>
</ul>
</blockquote>
<p>After it completes the setup, you can switch to that folder <code>my-app</code> and look at what’s created by Maven:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd my-app</span><br></pre></td></tr></table></figure>

<p>Under this directory you will notice the following <a href="https://maven.apache.org/guides/introduction/introduction-to-the-standard-directory-layout.html" target="_blank" rel="noopener">standard project structure</a>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">my-app</span><br><span class="line">|-- pom.xml</span><br><span class="line">&#96;-- src</span><br><span class="line">    |-- main</span><br><span class="line">    |   &#96;-- java</span><br><span class="line">    |       &#96;-- com</span><br><span class="line">    |           &#96;-- mycompany</span><br><span class="line">    |               &#96;-- app</span><br><span class="line">    |                   &#96;-- App.java</span><br><span class="line">    &#96;-- test</span><br><span class="line">        &#96;-- java</span><br><span class="line">            &#96;-- com</span><br><span class="line">                &#96;-- mycompany</span><br><span class="line">                    &#96;-- app</span><br><span class="line">                        &#96;-- AppTest.java</span><br></pre></td></tr></table></figure>

<p>where:</p>
<ul>
<li><code>src/main/java</code> directory contains the <strong>project source code</strong></li>
<li><code>src/test/java</code> directory contains the <strong>test source code</strong></li>
<li><code>pom.xml</code> file is the project’s <strong>Project Object Model</strong>, or POM.</li>
</ul>
<p><a name="Configure-Java-9"></a></p>
<h2 id="Configuring-for-Java-9-or-Later"><a href="#Configuring-for-Java-9-or-Later" class="headerlink" title="Configuring for Java 9 or Later"></a>Configuring for Java 9 or Later</h2><p><strong>By default</strong> your version of Maven might use an old version of the <code>maven-compiler-plugin</code> that is not compatible with Java 9 or later versions. To <strong>target Java 9 or later</strong>, you should at least use version <code>3.6.0</code> of the <code>maven-compiler-plugin</code> and set the <code>maven.compiler.release</code> property to the Java release you are targetting (e.g. 9, 10, 11, 12, etc.).</p>
<p>In the following example, we have configured our Maven project to use version <code>3.8.1</code> of maven-compiler-plugin and target Java 11. You should be able to <strong>edit it in the <code>pom.xml</code> file</strong>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties&gt;</span><br><span class="line">    &lt;maven.compiler.release&gt;11&lt;&#x2F;maven.compiler.release&gt;</span><br><span class="line">&lt;&#x2F;properties&gt;</span><br><span class="line"></span><br><span class="line">&lt;build&gt;</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;maven-compiler-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;3.8.1&lt;&#x2F;version&gt;</span><br><span class="line">            &lt;configuration&gt;</span><br><span class="line">                &lt;source&gt;13&lt;&#x2F;source&gt;</span><br><span class="line">                &lt;target&gt;13&lt;&#x2F;target&gt;</span><br><span class="line">            &lt;&#x2F;configuration&gt;</span><br><span class="line">        &lt;&#x2F;plugin&gt;</span><br><span class="line">	&lt;&#x2F;plugins&gt;</span><br><span class="line">&lt;&#x2F;build&gt;</span><br></pre></td></tr></table></figure>

<p><a name="Build-the-Project"></a></p>
<h2 id="Build-the-Project"><a href="#Build-the-Project" class="headerlink" title="Build the Project"></a>Build the Project</h2><p>Maven is based around the central concept of a <strong>build lifecycle</strong>, which consists of a number of <strong>phases</strong>. (Each of these build lifecycles is defined by a different list of build phases, wherein a build phase represents a stage in the lifecycle.)</p>
<p>For example, the <strong>default lifecycle comprises of the following phases</strong> (for a complete list of the lifecycle phases, refer to the Lifecycle Reference):</p>
<ul>
<li><code>validate</code> - validate the project is correct and all necessary information is available</li>
<li><code>compile</code> - compile the source code of the project</li>
<li><code>test</code> - test the compiled source code using a suitable unit testing framework. These tests should not require the code be packaged or deployed</li>
<li><code>package</code> - take the compiled code and package it in its distributable format, such as a <code>JAR</code>.</li>
<li><code>integration-test</code>: process and deploy the package if necessary into an environment where integration tests can be run</li>
<li><code>verify</code> - run any checks on results of integration tests to ensure quality criteria are met</li>
<li><code>install</code> - install the package into the local repository, for use as a dependency in other projects locally</li>
<li><code>deploy</code> - done in the build environment, copies the final package to the remote repository for sharing with other developers and projects.</li>
</ul>
<p>At this point, since you haven’t added anthing in the folder, you could directly do</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn package</span><br></pre></td></tr></table></figure>
<p>which, for Maven, when a phase is given, it will <strong>execute every phase in the sequence up to and including the one defined</strong>. For example, if we execute the <code>compile</code> phase, the phases that actually get executed are:</p>
<ul>
<li><code>validate</code><ul>
<li>generate-sources</li>
<li>process-sources</li>
<li>generate-resources</li>
<li>process-resources</li>
</ul>
</li>
<li><code>compile</code></li>
</ul>
<p>In the case where we executed <code>mvn package</code>, the command line will print out various actions, and <strong>end with the following</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> ...</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] BUILD SUCCESS</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Total time:  2.953 s</span><br><span class="line">[INFO] Finished at: 2019-11-24T13:05:10+01:00</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Unlike the first command executed (<code>archetype:generate</code>) you may notice the second is simply a single word - <code>package</code>. The difference is that the <strong>first one is a goal</strong> (i.e. the prefix <code>archetype</code> is the <strong>plugin</strong> that provides the goal <code>archetype:generate</code>. Maven is - at its heart - a plugin execution framework; all work is done by plugins), where as the <strong>second one is a phase</strong>.</li>
<li><input disabled type="checkbox"> After you run the <code>mvn package</code>, you will see that it created a <strong>new folder <code>target</code></strong>, in which there will be a <strong>packaged <code>JAR</code> file that is the snap-shot of the project</strong> (in this case, MAVEN starts with a <code>Hello World</code> java file)</li>
</ul>
</blockquote>
<p>Now, since you see that in the standard lifecycle, <code>package</code> already included <code>compile</code> phase, it means we could test the newly compiled and packaged <code>JAR</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp target&#x2F;my-app-1.0-SNAPSHOT.jar com.mycompany.app.App</span><br></pre></td></tr></table></figure>

<p>where</p>
<ul>
<li><code>-cp</code>, or <strong>CLASSPATH</strong> (where the JVM will look for the <strong>.class</strong> file. In this case, the file is packaged in the <strong>my-app-1.0-SNAPSHOT.jar</strong>), is used as an option to the Java command that specifies the <strong>location of classes and packages which are defined by the user</strong>, for example, a list of directories, <strong>JAR archives and ZIP archives</strong> to search for class files.</li>
<li><code>com.mycompany.app.App</code> is the java file that is created by MAVEN and packaged into <code>target/my-app-1.0-SNAPSHOT.jar</code></li>
</ul>
<h2 id="Running-Maven-Tools"><a href="#Running-Maven-Tools" class="headerlink" title="Running Maven Tools"></a>Running Maven Tools</h2><p>Although hardly a comprehensive list, these are the <strong>most common default lifecycle phases</strong> executed, also shown in the section <a href="#Build-the-Project">Build the Project</a></p>
<ul>
<li><code>validate</code></li>
<li><code>compile</code></li>
<li><code>test</code></li>
<li><code>package</code></li>
<li><code>integration-test</code></li>
<li><code>verify</code></li>
<li><code>install</code></li>
<li><code>deploy</code></li>
</ul>
<p>There are <strong>two other Maven lifecycles of note beyond the default list</strong> above. They are:</p>
<ul>
<li><code>clean</code>: cleans up artifacts created by prior builds</li>
<li><code>site</code>: generates site documentation for this project</li>
</ul>
<p><strong>Phases are actually mapped to underlying goals</strong> (A build <strong>phase is made up of a set of goals</strong>. Maven <strong>goals represent a specific task that contributes to the building and managing of a project</strong>). The specific goals executed per phase is dependent upon the packaging type of the project. For example, package executes <code>jar:jar</code> if the project type is a JAR, and <code>war:war</code> if the project type is - you guessed it - a WAR.</p>
<p>An interesting thing to note is that <strong>phases and goals may be executed in sequence</strong>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean dependency:copy-dependencies package</span><br></pre></td></tr></table></figure>

<p>This command will clean the project, copy dependencies, and package the project (<strong>executing all phases up to <code>package</code>, of course</strong>).</p>
<h2 id="Generating-a-Site"><a href="#Generating-a-Site" class="headerlink" title="Generating a Site"></a>Generating a Site</h2><p>This site will contain information about your project, organized by MAVEN:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn site</span><br></pre></td></tr></table></figure>
<p>This phase <strong>generates a site based upon information on the project’s <code>pom</code></strong>. You can look at the documentation generated under <code>target/site</code>.</p>
<h2 id="Creating-a-Project"><a href="#Creating-a-Project" class="headerlink" title="Creating a Project"></a>Creating a Project</h2><p>Different from the <code>quickstart</code> you could use, you could also create a standard project by:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mvn -B archetype:generate \</span><br><span class="line">  -DarchetypeGroupId&#x3D;org.apache.maven.archetypes \</span><br><span class="line">  -DgroupId&#x3D;com.mycompany.app \</span><br><span class="line">  -DartifactId&#x3D;&lt;yourProjectName&gt;</span><br></pre></td></tr></table></figure>
<p>Then, in the directory you created, you could look at the <code>POM</code> file:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">  xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">  xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0</span><br><span class="line">                      http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">  &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;my-app&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;packaging&gt;jar&lt;&#x2F;packaging&gt;</span><br><span class="line">  &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">  &lt;name&gt;Maven Quick Start Archetype&lt;&#x2F;name&gt;</span><br><span class="line">  &lt;url&gt;http:&#x2F;&#x2F;maven.apache.org&lt;&#x2F;url&gt;</span><br><span class="line">  &lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;junit&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;junit&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;version&gt;4.11&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">  &lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>
<p>The <code>POM</code> is the basic unit of work in Maven. This is important to remember because Maven is inherently <strong>project-centric</strong> in that everything revolves around the notion of a project. In short, the <strong><code>POM</code> contains every important piece of information about your project and is essentially one-stop-shopping for finding anything related to your project</strong>. </p>
<p>This is a very simple POM but still displays the key elements every POM contains, so let’s walk through each of them to familiarize you with the <strong>POM essentials</strong>:</p>
<ul>
<li><strong>project</strong> This is the top-level element in all Maven <code>pom.xml</code> files.</li>
<li><strong>modelVersion</strong> This element indicates what <strong>version of the object model this POM is using</strong>. The version of the model itself changes very infrequently but it is mandatory in order to ensure stability of use if and when the Maven developers deem it necessary to change the model.</li>
<li><strong>groupId</strong> This element indicates the unique <strong>identifier of the organization or group that created the project</strong>. The groupId is one of the key identifiers of a project and is typically based on the <strong>fully qualified domain name of your organization</strong>. For example <code>org.apache.maven.plugins</code> is the designated groupId for all Maven plugins.</li>
<li><strong>artifactId</strong> This element indicates the unique base name of the primary artifact being generated by this project. <strong>The primary artifact for a project is typically a JAR file</strong>. Secondary artifacts like source bundles also use the artifactId as part of their final name. A typical artifact produced by Maven would have the form <code>&lt;artifactId&gt;-&lt;version&gt;.&lt;extension&gt;</code> (<strong>for example, <code>my-app-1.0.jar</code></strong>).</li>
<li><strong>packaging</strong> This element indicates the <strong>package type to be used by this artifact</strong> (e.g. <code>JAR</code>, <code>WAR</code>, <code>EAR</code>, etc.). This not only means if the artifact produced is JAR, WAR, or EAR but can also <strong>indicate a specific lifecycle to use as part of the build process</strong>. (The lifecycle is a topic we will deal with further on in the guide. For now, just keep in mind that the indicated packaging of a project can play a part in customizing the build lifecycle.) The <strong>default value for the packaging element is <code>JAR</code></strong> so you do not have to specify this for most projects.</li>
<li><strong>version</strong> This element indicates the <strong>version of the artifact (your end product) generated by the project</strong>. Maven goes a long way to help you with version management and you will often see the SNAPSHOT designator in a version, which indicates that a project is in a state of development. We will discuss the use of snapshots and how they work further on in this guide.</li>
<li><strong>name</strong> This element indicates the <strong>display name used for the project (by default it will be the same name as artifactId)</strong>. This is often used in Maven’s generated documentation.</li>
<li><strong>url</strong> This element indicates where the <strong>project’s site can be found</strong>. This is often used in Maven’s generated documentation.</li>
<li><strong>description</strong> This element provides a <strong>basic description of your project</strong>. This is often used in Maven’s generated documentation.</li>
</ul>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> The value of the <code>version</code> tag in the pom.xml file shown below has the suffix: <code>-SNAPSHOT</code>. The SNAPSHOT value refers to the <strong>‘latest’ code along a <code>development</code> branch</strong>, and provides <strong>no guarantee the code is stable or unchanging</strong>. Conversely, the code in a <code>&#39;release&#39;</code> version (any version value without the suffix SNAPSHOT) is unchanging. In other words, a SNAPSHOT version is the ‘development’ version before the final ‘release’ version. The SNAPSHOT is “older” than its release.</li>
</ul>
</blockquote>
<p>For more complete understanding of a <strong>POM</strong> visit <a href="https://maven.apache.org/guides/introduction/introduction-to-the-pom.html" target="_blank" rel="noopener">Apache Maven POM Guide</a></p>
<p>After the archetype generation of your first project you will also notice the <strong>same source tree structure you had above in the quickstart project created</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">my-app</span><br><span class="line">|-- pom.xml</span><br><span class="line">&#96;-- src</span><br><span class="line">    |-- main</span><br><span class="line">    |   &#96;-- java</span><br><span class="line">    |       &#96;-- com</span><br><span class="line">    |           &#96;-- mycompany</span><br><span class="line">    |               &#96;-- app</span><br><span class="line">    |                   &#96;-- App.java</span><br><span class="line">    &#96;-- test</span><br><span class="line">        &#96;-- java</span><br><span class="line">            &#96;-- com</span><br><span class="line">                &#96;-- mycompany</span><br><span class="line">                    &#96;-- app</span><br><span class="line">                        &#96;-- AppTest.java</span><br></pre></td></tr></table></figure>

<h2 id="Compiling-Project-Source-Code"><a href="#Compiling-Project-Source-Code" class="headerlink" title="Compiling Project Source Code"></a>Compiling Project Source Code</h2><p>Change to the directory where <code>pom.xml</code> is created by <code>archetype:generate</code> (this will be the default directory we are using for MAVEN commands) and execute the following command to compile your application sources:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn compile</span><br></pre></td></tr></table></figure>

<p>Upon executing this command you should see output like the following:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[INFO] ----------------------------------------------------------------------------</span><br><span class="line">[INFO] Building Maven Quick Start Archetype</span><br><span class="line">[INFO]    task-segment: [compile]</span><br><span class="line">[INFO] ----------------------------------------------------------------------------</span><br><span class="line">[INFO] artifact org.apache.maven.plugins:maven-resources-plugin: \</span><br><span class="line">  checking for updates from central</span><br><span class="line">...</span><br><span class="line">[INFO] artifact org.apache.maven.plugins:maven-compiler-plugin: \</span><br><span class="line">  checking for updates from central</span><br><span class="line">...</span><br><span class="line">[INFO] [resources:resources]</span><br><span class="line">...</span><br><span class="line">[INFO] [compiler:compile]</span><br><span class="line">Compiling 1 source file to &lt;dir&gt;&#x2F;my-app&#x2F;target&#x2F;classes</span><br><span class="line">[INFO] ----------------------------------------------------------------------------</span><br><span class="line">[INFO] BUILD SUCCESSFUL</span><br><span class="line">[INFO] ----------------------------------------------------------------------------</span><br><span class="line">[INFO] Total time: 3 minutes 54 seconds</span><br><span class="line">[INFO] Finished at: Fri Sep 23 15:48:34 GMT-05:00 2005</span><br><span class="line">[INFO] Final Memory: 2M&#x2F;6M</span><br><span class="line">[INFO] ----------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>The <strong>first time you execute</strong> this (or any other) command, Maven will need to download all the plugins and related dependencies it needs to fulfill the command. This can take quite a while. If you execute the command again, Maven will now have what it needs, so it won’t need to download anything new and will be able to execute the command much more quickly.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> If you ran into error running this command, it might be cause because the code is not for the default compiler used by MAVEN. You can specify it similarly in the section [Configuing for Java 9 or Later](#<br>re-Java-9), by adding those before the root element ends:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt; </span><br><span class="line">... </span><br><span class="line">&lt;&#x2F;dependencies&gt; </span><br><span class="line">&lt;build&gt; </span><br><span class="line">&lt;plugins&gt; </span><br><span class="line">	&lt;plugin&gt;</span><br><span class="line">		&lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt; </span><br><span class="line">		&lt;artifactId&gt;maven-compiler-plugin&lt;&#x2F;artifactId&gt; </span><br><span class="line">		&lt;version&gt;3.8.1&lt;&#x2F;version&gt; </span><br><span class="line">		&lt;configuration&gt; </span><br><span class="line">			&lt;source&gt;13&lt;&#x2F;source&gt; </span><br><span class="line">			&lt;target&gt;13&lt;&#x2F;target&gt; </span><br><span class="line">		&lt;&#x2F;configuration&gt; </span><br><span class="line">	&lt;&#x2F;plugin&gt; </span><br><span class="line">&lt;&#x2F;plugins&gt; </span><br><span class="line">&lt;&#x2F;build&gt; </span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<p>As you can see from the output, the <strong>compiled classes were placed in <code>${basedir}/target/classes</code></strong>, which is another standard convention employed by Maven. </p>
<h2 id="Testing-Project-Source-Code"><a href="#Testing-Project-Source-Code" class="headerlink" title="Testing Project Source Code"></a>Testing Project Source Code</h2><p>Now you’re successfully compiling your application’s sources and now you’ve got some unit tests that you want to <strong>compile and execute</strong> (because every programmer always writes and executes their unit tests <em>nudge nudge wink wink</em>).</p>
<p>Execute the following command:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn test</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Maven downloads more dependencies this time. These are the dependencies and plugins <strong>necessary for executing the tests</strong> (it already has the dependencies it needs for compiling and won’t download them again).</li>
<li><input disabled type="checkbox"> <strong>Before compiling and executing the tests</strong> Maven <strong>compiles the main code</strong> (in case there are some changes. In this case all these classes are up to date because we haven’t changed anything since we compiled last).</li>
</ul>
</blockquote>
<p>If you simply want to compile your test sources (but not execute the tests), you can execute the following:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn test-compile</span><br></pre></td></tr></table></figure>

<h2 id="Packaging-into-a-Jar-File"><a href="#Packaging-into-a-Jar-File" class="headerlink" title="Packaging into a Jar File"></a>Packaging into a Jar File</h2><p>Making a JAR file is straight forward enough and can be accomplished by executing the following command:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn package</span><br></pre></td></tr></table></figure>

<p>If you take a look at the <code>POM</code> for your project you will notice the packaging element is set to <code>jar</code>. This is <strong>how Maven knows to produce a <code>JAR</code> file from the above command</strong>.</p>
<p>The generated file will be in <code>${basedir}/target directory</code> and you will see the generated <code>JAR</code> file there as well.</p>
<p><a name="Installing-into-Local"></a></p>
<h2 id="Installing-into-Local-Repository"><a href="#Installing-into-Local-Repository" class="headerlink" title="Installing into Local Repository"></a>Installing into Local Repository</h2><p>If you want to install the artifact you’ve generated (the JAR file) in your local repository (<code>${user.home}/.m2/repository</code>; for Windows,<code>C:\Users\&lt;Username&gt;\.m2\repository</code> is the default location). For more information on repositories you can refer to <a href="#https://maven.apache.org/guides/introduction/introduction-to-repositories.html">Apache Maven Introduction to Repositories</a> but let’s move on to installing our artifact! To do so execute the following command:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn install</span><br></pre></td></tr></table></figure>

<p>Upon executing this command you should see the following output:</p>
<p>Upon executing this command you should see the following output:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[INFO] ----------------------------------------------------------------------------</span><br><span class="line">[INFO] Building Maven Quick Start Archetype</span><br><span class="line">[INFO]    task-segment: [install]</span><br><span class="line">[INFO] ----------------------------------------------------------------------------</span><br><span class="line">[INFO] [resources:resources]</span><br><span class="line">[INFO] [compiler:compile]</span><br><span class="line">Compiling 1 source file to &lt;dir&gt;&#x2F;my-app&#x2F;target&#x2F;classes</span><br><span class="line">[INFO] [resources:testResources]</span><br><span class="line">[INFO] [compiler:testCompile]</span><br><span class="line">Compiling 1 source file to &lt;dir&gt;&#x2F;my-app&#x2F;target&#x2F;test-classes</span><br><span class="line">[INFO] [surefire:test]</span><br><span class="line">[INFO] Setting reports dir: &lt;dir&gt;&#x2F;my-app&#x2F;target&#x2F;surefire-reports</span><br><span class="line"> </span><br><span class="line">-------------------------------------------------------</span><br><span class="line"> T E S T S</span><br><span class="line">-------------------------------------------------------</span><br><span class="line">[surefire] Running com.mycompany.app.AppTest</span><br><span class="line">[surefire] Tests run: 1, Failures: 0, Errors: 0, Time elapsed: 0.001 sec</span><br><span class="line"> </span><br><span class="line">Results :</span><br><span class="line">[surefire] Tests run: 1, Failures: 0, Errors: 0</span><br><span class="line"> </span><br><span class="line">[INFO] [jar:jar]</span><br><span class="line">[INFO] Building jar: &lt;dir&gt;&#x2F;my-app&#x2F;target&#x2F;my-app-1.0-SNAPSHOT.jar</span><br><span class="line">[INFO] [install:install]</span><br><span class="line">[INFO] Installing &lt;dir&gt;&#x2F;my-app&#x2F;target&#x2F;my-app-1.0-SNAPSHOT.jar to \</span><br><span class="line">   &lt;local-repository&gt;&#x2F;com&#x2F;mycompany&#x2F;app&#x2F;my-app&#x2F;1.0-SNAPSHOT&#x2F;my-app-1.0-SNAPSHOT.jar</span><br><span class="line">[INFO] ----------------------------------------------------------------------------</span><br><span class="line">[INFO] BUILD SUCCESSFUL</span><br><span class="line">[INFO] ----------------------------------------------------------------------------</span><br><span class="line">[INFO] Total time: 5 seconds</span><br><span class="line">[INFO] Finished at: Tue Oct 04 13:20:32 GMT-05:00 2005</span><br><span class="line">[INFO] Final Memory: 3M&#x2F;8M</span><br><span class="line">[INFO] ----------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>Note that the <code>surefire</code> plugin (which executes the test) <strong>looks for tests contained in files with a particular naming convention</strong>. By default the tests included are:</p>
<ul>
<li><code>**/*Test.java</code></li>
<li><code>**/Test*.java</code></li>
<li><code>**/*TestCase.java</code></li>
</ul>
<p>And in the end you can find your files in <code>C:\Users\&lt;Username&gt;\.m2\repository\com\mycompany\app\</code> (for Windows)</p>
<h2 id="Other-Useful-Phases-in-Maven"><a href="#Other-Useful-Phases-in-Maven" class="headerlink" title="Other Useful Phases in Maven"></a>Other Useful Phases in Maven</h2><p>One of the highly prized features of Maven is: without any work on your part this POM has enough information to <strong>generate a web site for your project</strong>! You will most likely want to customize your Maven site but if you’re pressed for time all you need to do to provide basic information about your project is execute the following command:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn site</span><br></pre></td></tr></table></figure>

<p>There are plenty of other standalone goals that can be executed as well (again only with this <code>POM</code> file), for example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean</span><br></pre></td></tr></table></figure>

<p>This will <strong>remove the target directory with all the build data before starting so that it is fresh</strong>.</p>
<h2 id="Using-Plugins-in-Maven"><a href="#Using-Plugins-in-Maven" class="headerlink" title="Using Plugins in Maven"></a>Using Plugins in Maven</h2><p>Whenever you want to <strong>customise the build</strong> for a Maven project, this is <strong>done by adding or reconfiguring plugins</strong>.</p>
<p>For this example, we will <strong>configure the Java compiler</strong> to allow JDK 5.0 sources (we have in fact done this already when we configure for Java 9.0 or later). This is as simple as <strong>adding this to your <code>POM</code></strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">&lt;build&gt;</span><br><span class="line">  &lt;plugins&gt;</span><br><span class="line">    &lt;plugin&gt;</span><br><span class="line">      &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;maven-compiler-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;version&gt;3.3&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;configuration&gt;</span><br><span class="line">        &lt;source&gt;1.5&lt;&#x2F;source&gt;</span><br><span class="line">        &lt;target&gt;1.5&lt;&#x2F;target&gt;</span><br><span class="line">      &lt;&#x2F;configuration&gt;</span><br><span class="line">    &lt;&#x2F;plugin&gt;</span><br><span class="line">  &lt;&#x2F;plugins&gt;</span><br><span class="line">&lt;&#x2F;build&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>You’ll notice that all plugins in Maven look much like a dependency - and in some ways they are. This <strong>plugin will be automatically downloaded and used - including a specific version if you request it</strong> (the default is to use the latest available).</p>
<p>To find out <strong>what configuration is available</strong> for a plugin, you can see the <a href="https://maven.apache.org/plugins/" target="_blank" rel="noopener">Apache Maven Plugins List</a> and navigate to the plugin and goal you are using. For general information about how to configure the available parameters of a plugin, have a look at the <a href="https://maven.apache.org/guides/mini/guide-configuring-plugins.html" target="_blank" rel="noopener">Apache Maven Guide to Configuring Plugins</a>.</p>
<h2 id="Adding-Files-Resources-to-My-Jar"><a href="#Adding-Files-Resources-to-My-Jar" class="headerlink" title="Adding Files/Resources to My Jar"></a>Adding Files/Resources to My Jar</h2><p>Another common use case that can be satisfied which requires <strong>no changes to the POM</strong> that we have above is packaging resources in the JAR file. For this common task, Maven again relies on the <strong>Standard Directory Layout</strong>.</p>
<p>You see below in our example we have <strong>added the directory <code>${basedir}/src/main/resources</code></strong> into which we place <strong>any resources/files we wish to package in our JAR</strong>. The simple rule employed by Maven is this: <strong>any directories or files placed within the <code>${basedir}/src/main/resources</code> directory are packaged in your JAR with the exact same structure starting at the base of the JAR</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">my-app</span><br><span class="line">|-- pom.xml</span><br><span class="line">&#96;-- src</span><br><span class="line">    |-- main</span><br><span class="line">    |   |-- java</span><br><span class="line">    |   |   &#96;-- com</span><br><span class="line">    |   |       &#96;-- mycompany</span><br><span class="line">    |   |           &#96;-- app</span><br><span class="line">    |   |               &#96;-- App.java</span><br><span class="line">    |   &#96;-- resources</span><br><span class="line">    |       &#96;-- META-INF</span><br><span class="line">    |           &#96;-- application.properties</span><br><span class="line">    &#96;-- test</span><br><span class="line">        &#96;-- java</span><br><span class="line">            &#96;-- com</span><br><span class="line">                &#96;-- mycompany</span><br><span class="line">                    &#96;-- app</span><br><span class="line">                        &#96;-- AppTest.java</span><br></pre></td></tr></table></figure>
<p>Generates:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">|-- META-INF</span><br><span class="line">|   |-- MANIFEST.MF</span><br><span class="line">|   |-- application.properties</span><br><span class="line">|   &#96;-- maven</span><br><span class="line">|       &#96;-- com.mycompany.app</span><br><span class="line">|           &#96;-- my-app</span><br><span class="line">|               |-- pom.properties</span><br><span class="line">|               &#96;-- pom.xml</span><br><span class="line">&#96;-- com</span><br><span class="line">    &#96;-- mycompany</span><br><span class="line">        &#96;-- app</span><br><span class="line">            &#96;-- App.class</span><br></pre></td></tr></table></figure>
<p>But if you had a customized:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">my-app</span><br><span class="line">|-- pom.xml</span><br><span class="line">&#96;-- src</span><br><span class="line">    |-- main</span><br><span class="line">    |   |-- java</span><br><span class="line">    |   |   &#96;-- com</span><br><span class="line">    |   |       &#96;-- mycompany</span><br><span class="line">    |   |           &#96;-- app</span><br><span class="line">    |   |               &#96;-- App.java</span><br><span class="line">    |   &#96;-- resources</span><br><span class="line">    |       &#96;-- testFolder</span><br><span class="line">    |           &#96;-- test.java</span><br><span class="line">    &#96;-- test</span><br><span class="line">        &#96;-- java</span><br><span class="line">            &#96;-- com</span><br><span class="line">                &#96;-- mycompany</span><br><span class="line">                    &#96;-- app</span><br><span class="line">                        &#96;-- AppTest.java</span><br></pre></td></tr></table></figure>
<p>Generates:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">|-- META-INF</span><br><span class="line">|   |-- MANIFEST.MF</span><br><span class="line">|   &#96;-- maven</span><br><span class="line">|       &#96;-- com.mycompany.app</span><br><span class="line">|           &#96;-- my-app</span><br><span class="line">|               |-- pom.properties</span><br><span class="line">|               &#96;-- pom.xml</span><br><span class="line">|-- testFolder</span><br><span class="line">|   &#96;-- test.class</span><br><span class="line">|</span><br><span class="line">&#96;-- com</span><br><span class="line">    &#96;-- mycompany</span><br><span class="line">        &#96;-- app</span><br><span class="line">            &#96;-- App.class</span><br></pre></td></tr></table></figure>

<p>You see other files there like <code>META-INF/MANIFEST.MF</code> as well as a <code>pom.xml</code> and <code>pom.properties</code> file generated as well. These <strong>come standard with generation of a <code>JAR</code> in Maven</strong>. You can create your own manifest if you choose, but Maven will generate one by default if you don’t. The <code>pom.xml</code> and <code>pom.properties</code> files are packaged up in the JAR <strong>so that each artifact produced by Maven is self-describing and also allows you to utilize the metadata in your own application if the need arises</strong>. One simple use might be to retrieve the version of your application.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> To add resources to the <code>classpath</code> <strong>for your unit tests</strong>, you follow the <strong>same pattern as you do for adding resources to the JAR except the directory you place resources in is <code>${basedir}/src/test/resources</code></strong>.</li>
</ul>
</blockquote>
<h2 id="Resource-Filtering-in-Maven"><a href="#Resource-Filtering-in-Maven" class="headerlink" title="Resource Filtering in Maven"></a>Resource Filtering in Maven</h2><p>This is useful if sometimes a resource file will need to contain a value that can only be <strong>supplied at build time</strong>. Then, you can use Maven to perform <strong>variable replacement</strong> on project resources. When <strong>resource filtering is activated</strong>, Maven will scan <code>resources</code> for <strong>property references surrounded by <code>${&lt;property name&gt;}</code></strong>. When it finds these references it will <strong>replace them with the appropriate value</strong>.</p>
<p>To enable resource filtering, you need to <strong>set <code>filtering</code> to <code>true</code> in your <code>pom.xml</code></strong>, and <strong>add the directory <code>src/main/resources</code> which is the default location MAVEN will look into when it compiles</strong> (since we overwrote the value to <code>true</code>, this has to be re-written again):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">  xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">  xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0</span><br><span class="line">                      http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;my-app&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">  &lt;packaging&gt;jar&lt;&#x2F;packaging&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;name&gt;Maven Quick Start Archetype&lt;&#x2F;name&gt;</span><br><span class="line">  &lt;url&gt;http:&#x2F;&#x2F;maven.apache.org&lt;&#x2F;url&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;junit&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;junit&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;version&gt;4.11&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">  &lt;&#x2F;dependencies&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;build&gt;</span><br><span class="line">    &lt;resources&gt;</span><br><span class="line">      &lt;resource&gt;</span><br><span class="line">        &lt;directory&gt;src&#x2F;main&#x2F;resources&lt;&#x2F;directory&gt;</span><br><span class="line">        &lt;filtering&gt;true&lt;&#x2F;filtering&gt;</span><br><span class="line">      &lt;&#x2F;resource&gt;</span><br><span class="line">    &lt;&#x2F;resources&gt;</span><br><span class="line">  &lt;&#x2F;build&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<p>Now, to <strong>reference a property defined in your pom.xml</strong>, the property name uses the names of the XML elements that define the value, with “pom” being allowed as an alias for the project (root) element. So <code>${project.name}</code> refers to the name of the project, <code>${project.version}</code> refers to the version of the project, <code>${project.build.finalName}</code> refers to the final name of the file created when the built project is packaged, etc. </p>
<p>Similarly, values in the user’s <code>settings.xml</code> can be referenced using property names beginning with “settings” (for example, <code>{settings.localRepository}</code> refers to the path of the user’s local repository).</p>
<p>For example, let’s add a couple of properties to the <code>application.properties</code> file (which we put in the <code>src/main/resources</code> directory) whose <strong>values will be supplied when the resource is filtered</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># application.properties</span><br><span class="line">application.name&#x3D;$&#123;project.name&#125;</span><br><span class="line">application.version&#x3D;$&#123;project.version&#125;</span><br></pre></td></tr></table></figure>

<p>With that in place, you can execute the following command (process-resources is the build lifecycle phase where the resources are copied and filtered):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn process-resources</span><br></pre></td></tr></table></figure>

<p>and the <code>application.properties</code> file under <code>target/classes</code> (and will eventually go into the jar) looks like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># application.properties</span><br><span class="line">application.name&#x3D;Maven Quick Start Archetype</span><br><span class="line">application.version&#x3D;1.0-SNAPSHOT</span><br></pre></td></tr></table></figure>

<p>With that in place, you can execute the following command (process-resources is the build lifecycle <strong>phase where the resources are copied and filtered</strong>):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn process-resources</span><br></pre></td></tr></table></figure>

<p>and the <code>application.properties</code> file under <code>target/classes/META-INF</code> (and will eventually go into the jar) looks like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># application.properties</span><br><span class="line">application.name&#x3D;my-app</span><br><span class="line">application.version&#x3D;1.0-SNAPSHOT</span><br></pre></td></tr></table></figure>

<h2 id="Filtering-External-Files"><a href="#Filtering-External-Files" class="headerlink" title="Filtering External Files"></a>Filtering External Files</h2><p>To reference a property defined in an external file, all you need to do is <strong>add a reference to this external file in your <code>pom.xml</code></strong>.</p>
<p>First, let’s create our external properties file and call it <code>src/main/filters/filter.properties</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># filter.properties</span><br><span class="line">my.filter.value&#x3D;hello!</span><br></pre></td></tr></table></figure>

<p>Next, we’ll <strong>add a reference to this new file in the <code>pom.xml</code></strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">  xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">  xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0</span><br><span class="line">                      http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;my-app&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">  &lt;packaging&gt;jar&lt;&#x2F;packaging&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;name&gt;Maven Quick Start Archetype&lt;&#x2F;name&gt;</span><br><span class="line">  &lt;url&gt;http:&#x2F;&#x2F;maven.apache.org&lt;&#x2F;url&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;junit&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;junit&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;version&gt;4.11&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">  &lt;&#x2F;dependencies&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;build&gt;</span><br><span class="line">    &lt;filters&gt;</span><br><span class="line">      &lt;filter&gt;src&#x2F;main&#x2F;filters&#x2F;filter.properties&lt;&#x2F;filter&gt;</span><br><span class="line">    &lt;&#x2F;filters&gt;</span><br><span class="line">    &lt;resources&gt;</span><br><span class="line">      &lt;resource&gt;</span><br><span class="line">        &lt;directory&gt;src&#x2F;main&#x2F;resources&lt;&#x2F;directory&gt;</span><br><span class="line">        &lt;filtering&gt;true&lt;&#x2F;filtering&gt;</span><br><span class="line">      &lt;&#x2F;resource&gt;</span><br><span class="line">    &lt;&#x2F;resources&gt;</span><br><span class="line">  &lt;&#x2F;build&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<p>Then, if we add a reference to this property in the <code>application.properties</code> file:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># application.properties</span><br><span class="line">application.name&#x3D;$&#123;project.name&#125;</span><br><span class="line">application.version&#x3D;$&#123;project.version&#125;</span><br><span class="line">message&#x3D;$&#123;my.filter.value&#125;</span><br></pre></td></tr></table></figure>

<p>the next execution of the <code>mvn process-resources</code> command will put our new property value into <code>application.properties</code>.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> The file <code>filter.property</code> created in the <code>src/main/filters</code> will <strong>not get outputted by MAVEN to the <code>target</code> folder</strong>. This is because, it is <strong>not in the default location tree that MAVEN knows</strong>, so MAVEN will <strong>not compile</strong> it and include in your project.</li>
</ul>
</blockquote>
<p><a name="Using-External-Dependency"></a></p>
<h2 id="Using-External-Dependency"><a href="#Using-External-Dependency" class="headerlink" title="Using External Dependency"></a>Using External Dependency</h2><p>You have, in fact, been using an external dependency all this time, but here we’ll talk about how this works in a bit more detail. For a more thorough introduction, please refer to our Introduction to <a href="https://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html" target="_blank" rel="noopener">Apache Maven Dependency Mechanism</a>.</p>
<p>The dependencies section of the <code>pom.xml</code> lists <strong>all of the external dependencies that our project needs in order to build (whether it needs that dependency at compile time, test time, run time, or whatever)</strong>. Right now, our project is depending on <code>JUnit</code> only (I took out all of the resource filtering stuff for clarity):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">  xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">  xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0</span><br><span class="line">                      http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;my-app&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">  &lt;packaging&gt;jar&lt;&#x2F;packaging&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;name&gt;Maven Quick Start Archetype&lt;&#x2F;name&gt;</span><br><span class="line">  &lt;url&gt;http:&#x2F;&#x2F;maven.apache.org&lt;&#x2F;url&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;junit&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;junit&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;version&gt;4.11&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">  &lt;&#x2F;dependencies&gt;</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<p>For each external dependency, you’ll need to <strong>define at least 4 things: <code>groupId</code>, <code>artifactId</code>, <code>version</code>, and <code>scope</code></strong>. </p>
<ul>
<li>The <code>groupId</code>, <code>artifactId</code>, and <code>versio</code>n are the same as those given in the <strong><code>pom.xml</code> of the project that built that dependency</strong>. </li>
<li>The <code>scope</code> element indicates <strong>how your project uses that dependency</strong>, and can be values like <code>compile</code>, <code>test</code>, and <code>runtime</code>.</li>
</ul>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Where does Maven reference the dependency from? Maven <strong>looks in your local repository</strong> (<code>${user.home}/.m2/repository</code> is the <strong>default location) to find all dependencies</strong>.</li>
</ul>
</blockquote>
<p>This means that we could use code/projects made by others!</p>
<p>For example:</p>
<p>In a <a href="#Installing-into-Local">previous section</a>, we installed the artifact from our project (<code>my-app-1.0-SNAPSHOT.jar</code>) into the local repository. Once it’s installed there, another project can reference that jar as a dependency simply by <strong>adding the dependency information to its <code>pom.xml</code></strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">  xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">  xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0</span><br><span class="line">                      http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">  &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;my-other-app&lt;&#x2F;artifactId&gt;</span><br><span class="line">  ...</span><br><span class="line">  &lt;dependencies&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;my-app&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;scope&gt;compile&lt;&#x2F;scope&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">  &lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> If a <strong>remote repo is needed</strong>, you could use the mirror in MAVEN to setup the dependency correctly. By default, the remote repository Maven uses can be found (and browsed) at <a href="https://repo.maven.apache.org/maven2/" target="_blank" rel="noopener">https://repo.maven.apache.org/maven2/</a>. You can also set up your own remote repository (maybe a central repository for your company) to use instead of or in addition to the default remote repository. For more information on repositories you can refer to the <a href="https://maven.apache.org/guides/introduction/introduction-to-repositories.html" target="_blank" rel="noopener">Apache Maven Introduction to Repositories</a>. </li>
</ul>
</blockquote>
<p>Now, when we compile the project (<code>mvn compile</code>), we’ll see Maven download the <code>my-app</code> dependency for us.</p>
<h2 id="Deploying-Jar-into-a-Remote-Repository"><a href="#Deploying-Jar-into-a-Remote-Repository" class="headerlink" title="Deploying Jar into a Remote Repository"></a>Deploying Jar into a Remote Repository</h2><p>For deploying jars to an external repository, you have to <strong>configure the repository <code>url</code> in the <code>pom.xml</code></strong> and the <strong>authentication information for connectiong to the repository in the <code>settings.xml</code></strong>.</p>
<p>There are <strong>two locations where a <code>settings.xml</code> file may live</strong>:</p>
<ul>
<li>The Maven install: <code>${maven.home}/conf/settings.xml</code></li>
<li>A user’s install: <code>${user.home}/.m2/settings.xml</code></li>
</ul>
<p>The <strong>former</strong> <code>settings.xml</code> are also called <strong>global settings</strong>, the <strong>latter</strong> <code>settings.xml</code> are referred to as <strong>user settings</strong>. <strong>If both files exists, their contents gets merged, with the user-specific settings.xml being dominant</strong>.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> <code>settings.xml</code> is a configuration file that <strong>should not be bundled to any specific project</strong> whereas the <strong><code>pom.xml</code> can be distributed</strong>.</li>
</ul>
</blockquote>
<p>Now, going back to the exmple, we can use scp and username/password authentication:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"># pom.xml</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">  xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">  xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0</span><br><span class="line">                      http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;my-app&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">  &lt;packaging&gt;jar&lt;&#x2F;packaging&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;name&gt;Maven Quick Start Archetype&lt;&#x2F;name&gt;</span><br><span class="line">  &lt;url&gt;http:&#x2F;&#x2F;maven.apache.org&lt;&#x2F;url&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;dependencies&gt;</span><br><span class="line">    ...</span><br><span class="line">  &lt;&#x2F;dependencies&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!--</span><br><span class="line">   |</span><br><span class="line">   |</span><br><span class="line">   |</span><br><span class="line">   --&gt;</span><br><span class="line">  &lt;distributionManagement&gt;</span><br><span class="line">    &lt;repository&gt;</span><br><span class="line">      &lt;id&gt;mycompany-repository&lt;&#x2F;id&gt;</span><br><span class="line">      &lt;name&gt;MyCompany Repository&lt;&#x2F;name&gt;</span><br><span class="line">      &lt;url&gt;scp:&#x2F;&#x2F;repository.mycompany.com&#x2F;repository&#x2F;maven2&lt;&#x2F;url&gt;</span><br><span class="line">    &lt;&#x2F;repository&gt;</span><br><span class="line">  &lt;&#x2F;distributionManagement&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<p>and then in <code>settings.xml</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># settings.xml</span><br><span class="line">&lt;settings xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;SETTINGS&#x2F;1.0.0&quot;</span><br><span class="line">  xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">  xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;SETTINGS&#x2F;1.0.0</span><br><span class="line">                      http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;settings-1.0.0.xsd&quot;&gt;</span><br><span class="line">  ...</span><br><span class="line">  &lt;servers&gt;</span><br><span class="line">    &lt;server&gt;</span><br><span class="line">      &lt;id&gt;mycompany-repository&lt;&#x2F;id&gt;</span><br><span class="line">      &lt;username&gt;jvanzyl&lt;&#x2F;username&gt;</span><br><span class="line">      &lt;!-- Default value is ~&#x2F;.ssh&#x2F;id_dsa --&gt;</span><br><span class="line">      &lt;privateKey&gt;&#x2F;path&#x2F;to&#x2F;identity&lt;&#x2F;privateKey&gt; (default is ~&#x2F;.ssh&#x2F;id_dsa)</span><br><span class="line">      &lt;passphrase&gt;my_key_passphrase&lt;&#x2F;passphrase&gt;</span><br><span class="line">    &lt;&#x2F;server&gt;</span><br><span class="line">  &lt;&#x2F;servers&gt;</span><br><span class="line">  ...</span><br><span class="line">&lt;&#x2F;settings&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> If you are connecting to an openssh ssh server which has the parameter <code>&quot;PasswordAuthentication&quot;</code> set to <code>&quot;no&quot;</code> in the <code>sshd_confing</code>, you will have to type your password each time for username/password authentication (although you can log in using another ssh client by typing in the username and password). You might want to switch to public key authentication in this case.</li>
</ul>
</blockquote>
<h2 id="Creating-Documentation-with-a-Site"><a href="#Creating-Documentation-with-a-Site" class="headerlink" title="Creating Documentation with a Site"></a>Creating Documentation with a Site</h2><p>To get you jump started with Maven’s documentation system you can use the <code>archetype</code> mechanism to generate a site for your existing project using the following command:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mvn archetype:generate \</span><br><span class="line">  -DarchetypeGroupId&#x3D;org.apache.maven.archetypes \</span><br><span class="line">  -DarchetypeArtifactId&#x3D;maven-archetype-site \</span><br><span class="line">  -DgroupId&#x3D;com.mycompany.app \</span><br><span class="line">  -DartifactId&#x3D;my-app-site</span><br></pre></td></tr></table></figure>
<p>here we used the additional line: <code>-Darchetype ArtifactIds=maven-archetype-site</code>, which is an archetype to generate a sample Maven site.</p>
<p>Now head on over to the <a href="https://maven.apache.org/guides/mini/guide-site.html" target="_blank" rel="noopener">Apache Maven Guide to creating a site</a> to learn how to create the documentation for your project.</p>
<h2 id="Creating-Projects-of-Other-Types"><a href="#Creating-Projects-of-Other-Types" class="headerlink" title="Creating Projects of Other Types"></a>Creating Projects of Other Types</h2><p>For example, back in the base directory we can create a simple <code>web application</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mvn archetype:generate \</span><br><span class="line">    -DarchetypeGroupId&#x3D;org.apache.maven.archetypes \</span><br><span class="line">    -DarchetypeArtifactId&#x3D;maven-archetype-webapp \</span><br><span class="line">    -DgroupId&#x3D;com.mycompany.app \</span><br><span class="line">    -DartifactId&#x3D;my-webapp</span><br></pre></td></tr></table></figure>
<p>Here we used <code>-DarchetypeArtifactId=maven-archetype-webapp</code> to use an archetype to generate a sample Maven Webapp project. (For the available archetypes, see <a href="https://maven.apache.org/guides/introduction/introduction-to-archetypes.html" target="_blank" rel="noopener">https://maven.apache.org/guides/introduction/introduction-to-archetypes.html</a>)</p>
<p><a name="Creating-Multiple-Projects-at-Once"></a></p>
<h2 id="Creating-Multiple-Projects-at-Once"><a href="#Creating-Multiple-Projects-at-Once" class="headerlink" title="Creating Multiple Projects at Once"></a>Creating Multiple Projects at Once</h2><p>The basic idea is as follows:</p>
<ul>
<li>First, you could use Maven to create two (or more) projects. </li>
<li>Then, you need to create a <code>pom.xml</code> file that is <strong>above the two folder</strong></li>
<li>After that, you need to configure that <code>pom.xml</code> file to control the two (or more) project folders<ul>
<li>if you need to add dependencies between the two (or more)  sub-projects, you can also add them in the manner like the section <a href="#Using-External-Dependency">Using External Dependency</a></li>
</ul>
</li>
<li>Finally, configure the <code>parent</code> for the two (or more) sub-projects </li>
</ul>
<p>For example, if you created two projects with name <code>my-app</code> and <code>my-webapp</code>, you should have place your <code>pom.xml</code> above the two folders like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+- pom.xml</span><br><span class="line">+- my-app</span><br><span class="line">| +- pom.xml</span><br><span class="line">| +- src</span><br><span class="line">|   +- main</span><br><span class="line">|     +- java</span><br><span class="line">+- my-webapp</span><br><span class="line">| +- pom.xml</span><br><span class="line">| +- src</span><br><span class="line">|   +- main</span><br><span class="line">|     +- webapp</span><br></pre></td></tr></table></figure>
<p>And in the outer <code>pom.xml</code>, you should have the following information:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">  xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">  xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0</span><br><span class="line">                      http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;app&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">  &lt;packaging&gt;pom&lt;&#x2F;packaging&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;modules&gt;</span><br><span class="line">    &lt;module&gt;my-app&lt;&#x2F;module&gt;</span><br><span class="line">    &lt;module&gt;my-webapp&lt;&#x2F;module&gt;</span><br><span class="line">  &lt;&#x2F;modules&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<p>where </p>
<ul>
<li><code>&lt;artifactId&gt;app&lt;/artifactId&gt;</code> will be the entire project name which includes your two subprojects.</li>
<li>the two (or more) sub-projects you included will be inside the <code>&lt;modules&gt;&lt;/modules&gt;</code> section</li>
</ul>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> The parent <code>POM</code> created (called <code>app</code>), has a <strong><code>packaging</code> of <code>pom</code> and a list of <code>modules</code></strong> defined. This tells Maven to <strong>run all operations over the set of projects</strong> instead of just the current one</li>
</ul>
</blockquote>
<p>Finally, we need the following <code>parent</code> information to the <code>pom.xml</code> of the sub-projects like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">  xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">  xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0</span><br><span class="line">                      http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">  &lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;app&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">  &lt;&#x2F;parent&gt;</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>
<p>where </p>
<ul>
<li><code>&lt;artifactId&gt;app&lt;/artifactId&gt;</code> would be same as the <code>artifactId</code> in the outer <code>pom.xml</code> file you manually created.</li>
</ul>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> The <code>parent</code> definition ensures that the <code>POM</code> can always be located <strong>even if the project is distributed separately from its parent</strong> by <strong>looking it up in the repository</strong>.</li>
</ul>
</blockquote>
<p>Now, if you try to run from the top level, the outer directory where the outer <code>pom.xml</code> reside, the following command:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn verify</span><br></pre></td></tr></table></figure>
<p>Then you will have successfully find both of your projects compiled and packed in their respective <code>target</code> folder.</p>
<h2 id="Build-Lifecycle-Basics"><a href="#Build-Lifecycle-Basics" class="headerlink" title="Build Lifecycle Basics"></a>Build Lifecycle Basics</h2><p>Maven is based around the central concept of a build <strong>lifecycle</strong>. What this means is that the process for building and distributing a particular artifact (project) is clearly defined.</p>
<p>There are three built-in build <strong>lifecycles</strong>: <code>default</code>, <code>clean</code> and <code>site</code>. The <code>default</code> lifecycle handles your project deployment, the <code>clean</code> lifecycle handles project cleaning, while the <code>site</code> lifecycle handles the creation of your project’s site documentation.</p>
<p>Then, you need to understand that a build <strong><code>Lifecycle</code> is made up of <code>Phases</code></strong>, and a <strong><code>Phase</code> is made up of <code>Goals</code></strong>.</p>
<h2 id="Phases-in-a-Build-Lifecycle"><a href="#Phases-in-a-Build-Lifecycle" class="headerlink" title="Phases in a Build Lifecycle"></a>Phases in a Build Lifecycle</h2><p>Each of these build lifecycles is defined by a different list of build phases, wherein a build phase represents a stage in the lifecycle.</p>
<p>For example, the <code>default</code> lifecycle comprises of the following <code>phases</code> (these are not all the phases, only some are picked to illustrate the general concept behind <code>phases</code> and <code>lifecycles</code>):</p>
<ul>
<li><code>validate</code> - validate the project is correct and all necessary information is available</li>
<li><code>compile</code> - compile the source code of the project</li>
<li><code>test</code> - test the compiled source code using a suitable unit testing framework. These tests should not require the code be packaged or deployed</li>
<li><code>package</code> - take the compiled code and package it in its distributable format, such as a JAR.</li>
<li><code>verify</code> - run any checks on results of integration tests to ensure quality criteria are met</li>
<li><code>install</code> - install the package into the local repository, for use as a dependency in other projects locally</li>
<li><code>deploy</code> - done in the build environment, copies the final package to the remote repository for sharing with other developers and projects.</li>
</ul>
<p>Given the <code>default lifecycle</code> phases above, this means that when the <code>default</code> lifecycle is used, Maven will first validate the project, then will try to compile the sources, run those against the tests, package the binaries (e.g. jar), run integration tests against that package, verify the integration tests, install the verified package to the local repository, then deploy the installed package to a remote repository.</p>
<h2 id="Executing-Those-Phases"><a href="#Executing-Those-Phases" class="headerlink" title="Executing Those Phases"></a>Executing Those Phases</h2><p>You should first decide/select the <code>phase</code> that matches your outcome, and then run the command. If you want your <code>jar</code> to be made from your project, run <code>mvn package</code>. If you want to run the unit tests, run <code>mvn test</code>.</p>
<p><strong>If you are uncertain what you want, the preferred phase to call</strong> is:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn verify</span><br></pre></td></tr></table></figure>

<p>This command executes <strong>each <code>default</code> lifecycle <code>phase</code></strong> in order (<code>validate</code>, <code>compile</code>, <code>package</code>, etc.), up to and including, finally, executing <code>verify</code>.</p>
<h2 id="“Special”-Phases"><a href="#“Special”-Phases" class="headerlink" title="“Special” Phases"></a>“Special” Phases</h2><p>The phases named with <strong>hyphenated-words (pre-<em>, post-</em>, or process-*)</strong> are <strong>not usually directly called from the command line</strong>. These phases sequence the build, <strong>producing intermediate results that are not useful outside the build</strong>. In the case of invoking <code>integration-test</code>, the environment may be left in a hanging state.</p>
<p>For example:</p>
<p>Failsafe and code coverage plugins bind goals to <code>integration-test</code> and <code>verify</code> phases. But if <code>integration-test</code> were to be called from the command line, no reports are generated. If <code>verify</code> is run, the net result is test and coverage reports are available after the <code>verify</code> phase.</p>
<p>In fact, the worse for executing <code>integration-test</code> is that the integration test container environment is left in a hanging state; the Tomcat webserver or Docker instance is left running, and <strong>Maven may not even terminate by itself</strong>.</p>
<h2 id="Goals-in-a-Phase"><a href="#Goals-in-a-Phase" class="headerlink" title="Goals in a Phase"></a>Goals in a Phase</h2><p>A build phase is responsible for a specific step in the build lifecycle, the manner in which it carries out those responsibilities may vary: it depends on the specific <code>goals</code> (plugins) that are attached to the <code>phase</code>.</p>
<p>A plugin/<code>goal</code> represents <strong>a specific task (finer than a build phase)</strong> which contributes to the building and managing of a project. It may be bound to zero or more build phases. A goal not bound to any build phase could be executed outside of the build lifecycle by direct invocation. </p>
<p>The <strong>order of execution</strong> depends on the <strong>order in which the <code>goal(s)</code> and the build <code>phase(s)</code> are invoked</strong>. For example, consider the command below. The <code>clean</code> and <code>package</code> arguments are build phases, while the <code>dependency:copy-dependencies</code> is a <code>goal</code> (the goal <code>copy-dependencies</code> of a plugin <code>depedency</code>/<code>&quot;maven-dependency-plugin&quot;</code>).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean dependency:copy-dependencies package</span><br></pre></td></tr></table></figure>

<p>If this were to be executed, the <code>clean</code> phase will be executed first (meaning it will run all preceding phases of the <code>clean</code> lifecycle, plus the <code>clean</code> phase itself), and then the <code>dependency:copy-dependencies</code> goal, before finally executing the <code>package</code> phase (and all its preceding build phases of the <code>default</code> lifecycle).</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> A phase can also have <strong>no goals bounded</strong>. If so, no action will be executed during that phase. </li>
</ul>
</blockquote>
<h2 id="Customizing-your-Build-Lifecycle"><a href="#Customizing-your-Build-Lifecycle" class="headerlink" title="Customizing your Build Lifecycle"></a>Customizing your Build Lifecycle</h2><p>The first, and most common way, is to set the <code>packaging</code> for your project via the <strong>element <code>&lt;packaging&gt;</code> in your <code>POM.xml</code> file</strong>. Some of the <strong>valid packaging values</strong> are <code>jar</code>, <code>war</code>, <code>ear</code> and <code>pom</code>. If no packaging value has been specified, it will default to <code>jar</code></p>
<p>For example, in the section where you made multiple projects and had a parent <code>pom.xml</code> file, it looked like:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">  xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">  xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0</span><br><span class="line">                      http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">  &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;app&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">  &lt;packaging&gt;pom&lt;&#x2F;packaging&gt;</span><br><span class="line"></span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>

<p>where </p>
<ul>
<li><code>pom</code> for a packaging value means a project that is <strong>purely metadata</strong>, and it <strong>only binds goals to the <code>install</code> and <code>deploy</code> phases</strong>, which means <strong>during all the other phases there will be no action/execution</strong>.</li>
</ul>
<p>By default, if you have a <code>jar</code> as the packaging value, you will have the following <strong><code>goals</code> bounded to</strong> the following <code>phases</code></p>
<table>
<thead>
<tr>
<th>Phase</th>
<th>plugin:goal</th>
</tr>
</thead>
<tbody><tr>
<td>process-resources</td>
<td>resources:resources</td>
</tr>
<tr>
<td>compile</td>
<td>compiler:compile</td>
</tr>
<tr>
<td>process-test-resources</td>
<td>resources:testResources</td>
</tr>
<tr>
<td>test-compile</td>
<td>compiler:testCompile</td>
</tr>
<tr>
<td>test</td>
<td>surefire:test</td>
</tr>
<tr>
<td>package</td>
<td>jar:jar</td>
</tr>
<tr>
<td>install</td>
<td>install:install</td>
</tr>
<tr>
<td>deploy</td>
<td>deploy:deploy</td>
</tr>
</tbody></table>
<h2 id="Customizing-your-Build-Lifecycle-by-Plugins"><a href="#Customizing-your-Build-Lifecycle-by-Plugins" class="headerlink" title="Customizing your Build Lifecycle by Plugins"></a>Customizing your Build Lifecycle by Plugins</h2><p>The second way to <strong>add <code>goals</code> to <code>phases</code></strong> is to <strong>configure plugins in your project</strong>. Plugins are artifacts that <strong>provide <code>goals</code></strong> to Maven. This means that <strong>a plugin may have one or more <code>goals</code></strong> wherein each goal represents a capability of that plugin.</p>
<p>For example, the <code>Compiler</code> plugin has two goals: <code>compile</code> and <code>testCompile</code>. The former compiles the source code of your main code, while the latter compiles the source code of your test code.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Perhaps it is clear already, but to make sure: <strong>adding the plugin on its own is not enough information</strong> - you must also <strong>specify the <code>goals</code> you want to run from that plugin</strong>.</li>
<li><input disabled type="checkbox"> As you will see in the later sections, plugins can contain information that indicates <strong>which lifecycle phase</strong> to bind a goal to. If <strong>more than one goal is bound to a particular <code>phase</code></strong>, the <strong>order used</strong> is that those from the <strong><code>packaging</code> are executed first</strong>, followed by those configured in the <code>POM</code>. However, you can use the <code>&lt;executions&gt;</code> element to gain more control over the order of particular goals.</li>
</ul>
</blockquote>
<p>For example, the Modello plugin <strong>binds by default its goal <code>modello:java</code> to the<code>generate-sources</code> phase</strong> (Note: The <code>modello:java</code> goal generates Java source codes). So to use the Modello plugin and have it generate sources from a model and incorporate that into the build, you would add the following to your <code>POM</code> in the <code>&lt;plugins&gt;</code> section of <code>&lt;build&gt;</code>, and it will be <strong>executed in the <code>generate-sources</code> phase if you do not explicitly call it by itself</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"> &lt;plugin&gt;</span><br><span class="line">   &lt;groupId&gt;org.codehaus.modello&lt;&#x2F;groupId&gt;</span><br><span class="line">   &lt;artifactId&gt;modello-maven-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">   &lt;version&gt;1.8.1&lt;&#x2F;version&gt;</span><br><span class="line">   &lt;executions&gt;</span><br><span class="line">     &lt;execution&gt;</span><br><span class="line">       &lt;configuration&gt;</span><br><span class="line">         &lt;models&gt;</span><br><span class="line">           &lt;model&gt;src&#x2F;main&#x2F;mdo&#x2F;maven.mdo&lt;&#x2F;model&gt;</span><br><span class="line">         &lt;&#x2F;models&gt;</span><br><span class="line">         &lt;version&gt;4.0.0&lt;&#x2F;version&gt;</span><br><span class="line">       &lt;&#x2F;configuration&gt;</span><br><span class="line">       &lt;goals&gt;</span><br><span class="line">         &lt;goal&gt;java&lt;&#x2F;goal&gt;</span><br><span class="line">       &lt;&#x2F;goals&gt;</span><br><span class="line">     &lt;&#x2F;execution&gt;</span><br><span class="line">   &lt;&#x2F;executions&gt;</span><br><span class="line"> &lt;&#x2F;plugin&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>You might be wondering why that <code>&lt;executions&gt;</code> element is there. That is so that you can run the same goal multiple times with different configuration if needed.</p>
<p>Now, in the case of <code>modello:java</code>, it only makes sense in the <code>generate-sources</code> phase. <strong>But some goals can be used in more than one phase</strong>, and <strong>there may not be a sensible default</strong>. For those, you can <strong>specify the <code>phase</code> yourself</strong>.</p>
<p>For example, let’s say you have a goal <code>display:time</code> (that echos the current time to the commandline), and you want it to run in the <code>process-test-resources</code> phase to indicate when the tests were started. This would be configured like so:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"> &lt;plugin&gt;</span><br><span class="line">   &lt;groupId&gt;com.mycompany.example&lt;&#x2F;groupId&gt;</span><br><span class="line">   &lt;artifactId&gt;display-maven-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">   &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">   &lt;executions&gt;</span><br><span class="line">     &lt;execution&gt;</span><br><span class="line">       &lt;phase&gt;process-test-resources&lt;&#x2F;phase&gt;</span><br><span class="line">       &lt;goals&gt;</span><br><span class="line">         &lt;goal&gt;time&lt;&#x2F;goal&gt;</span><br><span class="line">       &lt;&#x2F;goals&gt;</span><br><span class="line">     &lt;&#x2F;execution&gt;</span><br><span class="line">   &lt;&#x2F;executions&gt;</span><br><span class="line"> &lt;&#x2F;plugin&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="Built-in-Lifecycle-and-Phase-Bindings"><a href="#Built-in-Lifecycle-and-Phase-Bindings" class="headerlink" title="Built-in Lifecycle and Phase Bindings"></a>Built-in Lifecycle and Phase Bindings</h2><p>You can see the default bindings for the lifecycle <code>clean</code>, <code>default</code>, and <code>site</code> <a href="https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html#lifecycle-reference" target="_blank" rel="noopener">here</a></p>
<h2 id="Built-in-Phase-and-Goal-Bindings"><a href="#Built-in-Phase-and-Goal-Bindings" class="headerlink" title="Built-in Phase and Goal Bindings"></a>Built-in Phase and Goal Bindings</h2><p>Some <code>phase</code>s have <code>goal</code>s bound to them by default. You can see the default bindings for each <code>phase</code> in the three lifecycles <code>clean</code>, <code>default</code>, <code>site</code> <a href="https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html#built-in-lifecycle-bindings" target="_blank" rel="noopener">here</a></p>
<h2 id="POM-Basics"><a href="#POM-Basics" class="headerlink" title="POM Basics"></a>POM Basics</h2><p>A Project Object Model or <code>POM</code> is the fundamental unit of work in Maven. It is an <strong><code>XML</code> file that contains information about the project and configuration details</strong> used by Maven to build the project. When executing a task or goal, <strong>Maven looks for the <code>POM</code> in the current directory</strong>. It reads the <code>POM</code>, gets the needed configuration information, then executes the goal.</p>
<p>For example, some of the configuration that can be specified in the <code>POM</code> are the project <code>dependencies</code>, the <code>plugins</code> or <code>goals</code> that can be executed, the build profiles, project version, description, developers, mailing lists and so on.</p>
<h2 id="Super-POM"><a href="#Super-POM" class="headerlink" title="Super POM"></a>Super POM</h2><p>The <code>Super POM</code> is Maven’s <strong>default <code>POM</code></strong>. All <strong><code>POMs</code> extend the <code>Super POM</code> unless explicitly set</strong>, meaning the configuration specified in the <code>Super POM</code> is inherited by the POMs you created for your projects. The snippet below is the Super POM for Maven 3.5.4.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line">&lt;project&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;repositories&gt;</span><br><span class="line">    &lt;repository&gt;</span><br><span class="line">      &lt;id&gt;central&lt;&#x2F;id&gt;</span><br><span class="line">      &lt;name&gt;Central Repository&lt;&#x2F;name&gt;</span><br><span class="line">      &lt;url&gt;https:&#x2F;&#x2F;repo.maven.apache.org&#x2F;maven2&lt;&#x2F;url&gt;</span><br><span class="line">      &lt;layout&gt;default&lt;&#x2F;layout&gt;</span><br><span class="line">      &lt;snapshots&gt;</span><br><span class="line">        &lt;enabled&gt;false&lt;&#x2F;enabled&gt;</span><br><span class="line">      &lt;&#x2F;snapshots&gt;</span><br><span class="line">    &lt;&#x2F;repository&gt;</span><br><span class="line">  &lt;&#x2F;repositories&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;pluginRepositories&gt;</span><br><span class="line">    &lt;pluginRepository&gt;</span><br><span class="line">      &lt;id&gt;central&lt;&#x2F;id&gt;</span><br><span class="line">      &lt;name&gt;Central Repository&lt;&#x2F;name&gt;</span><br><span class="line">      &lt;url&gt;https:&#x2F;&#x2F;repo.maven.apache.org&#x2F;maven2&lt;&#x2F;url&gt;</span><br><span class="line">      &lt;layout&gt;default&lt;&#x2F;layout&gt;</span><br><span class="line">      &lt;snapshots&gt;</span><br><span class="line">        &lt;enabled&gt;false&lt;&#x2F;enabled&gt;</span><br><span class="line">      &lt;&#x2F;snapshots&gt;</span><br><span class="line">      &lt;releases&gt;</span><br><span class="line">        &lt;updatePolicy&gt;never&lt;&#x2F;updatePolicy&gt;</span><br><span class="line">      &lt;&#x2F;releases&gt;</span><br><span class="line">    &lt;&#x2F;pluginRepository&gt;</span><br><span class="line">  &lt;&#x2F;pluginRepositories&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;build&gt;</span><br><span class="line">    &lt;directory&gt;$&#123;project.basedir&#125;&#x2F;target&lt;&#x2F;directory&gt;</span><br><span class="line">    &lt;outputDirectory&gt;$&#123;project.build.directory&#125;&#x2F;classes&lt;&#x2F;outputDirectory&gt;</span><br><span class="line">    &lt;finalName&gt;$&#123;project.artifactId&#125;-$&#123;project.version&#125;&lt;&#x2F;finalName&gt;</span><br><span class="line">    &lt;testOutputDirectory&gt;$&#123;project.build.directory&#125;&#x2F;test-classes&lt;&#x2F;testOutputDirectory&gt;</span><br><span class="line">    &lt;sourceDirectory&gt;$&#123;project.basedir&#125;&#x2F;src&#x2F;main&#x2F;java&lt;&#x2F;sourceDirectory&gt;</span><br><span class="line">    &lt;scriptSourceDirectory&gt;$&#123;project.basedir&#125;&#x2F;src&#x2F;main&#x2F;scripts&lt;&#x2F;scriptSourceDirectory&gt;</span><br><span class="line">    &lt;testSourceDirectory&gt;$&#123;project.basedir&#125;&#x2F;src&#x2F;test&#x2F;java&lt;&#x2F;testSourceDirectory&gt;</span><br><span class="line">    &lt;resources&gt;</span><br><span class="line">      &lt;resource&gt;</span><br><span class="line">        &lt;directory&gt;$&#123;project.basedir&#125;&#x2F;src&#x2F;main&#x2F;resources&lt;&#x2F;directory&gt;</span><br><span class="line">      &lt;&#x2F;resource&gt;</span><br><span class="line">    &lt;&#x2F;resources&gt;</span><br><span class="line">    &lt;testResources&gt;</span><br><span class="line">      &lt;testResource&gt;</span><br><span class="line">        &lt;directory&gt;$&#123;project.basedir&#125;&#x2F;src&#x2F;test&#x2F;resources&lt;&#x2F;directory&gt;</span><br><span class="line">      &lt;&#x2F;testResource&gt;</span><br><span class="line">    &lt;&#x2F;testResources&gt;</span><br><span class="line">    &lt;pluginManagement&gt;</span><br><span class="line">      &lt;!-- NOTE: These plugins will be removed from future versions of the super POM --&gt;</span><br><span class="line">      &lt;!-- They are kept for the moment as they are very unlikely to conflict with lifecycle mappings (MNG-4453) --&gt;</span><br><span class="line">      &lt;plugins&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">          &lt;artifactId&gt;maven-antrun-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">          &lt;version&gt;1.3&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;plugin&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">          &lt;artifactId&gt;maven-assembly-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">          &lt;version&gt;2.2-beta-5&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;plugin&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">          &lt;artifactId&gt;maven-dependency-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">          &lt;version&gt;2.8&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;plugin&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">          &lt;artifactId&gt;maven-release-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">          &lt;version&gt;2.5.3&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;plugin&gt;</span><br><span class="line">      &lt;&#x2F;plugins&gt;</span><br><span class="line">    &lt;&#x2F;pluginManagement&gt;</span><br><span class="line">  &lt;&#x2F;build&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;reporting&gt;</span><br><span class="line">    &lt;outputDirectory&gt;$&#123;project.build.directory&#125;&#x2F;site&lt;&#x2F;outputDirectory&gt;</span><br><span class="line">  &lt;&#x2F;reporting&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;profiles&gt;</span><br><span class="line">    &lt;!-- NOTE: The release profile will be removed from future versions of the super POM --&gt;</span><br><span class="line">    &lt;profile&gt;</span><br><span class="line">      &lt;id&gt;release-profile&lt;&#x2F;id&gt;</span><br><span class="line"> </span><br><span class="line">      &lt;activation&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">          &lt;name&gt;performRelease&lt;&#x2F;name&gt;</span><br><span class="line">          &lt;value&gt;true&lt;&#x2F;value&gt;</span><br><span class="line">        &lt;&#x2F;property&gt;</span><br><span class="line">      &lt;&#x2F;activation&gt;</span><br><span class="line"> </span><br><span class="line">      &lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">          &lt;plugin&gt;</span><br><span class="line">            &lt;inherited&gt;true&lt;&#x2F;inherited&gt;</span><br><span class="line">            &lt;artifactId&gt;maven-source-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;executions&gt;</span><br><span class="line">              &lt;execution&gt;</span><br><span class="line">                &lt;id&gt;attach-sources&lt;&#x2F;id&gt;</span><br><span class="line">                &lt;goals&gt;</span><br><span class="line">                  &lt;goal&gt;jar-no-fork&lt;&#x2F;goal&gt;</span><br><span class="line">                &lt;&#x2F;goals&gt;</span><br><span class="line">              &lt;&#x2F;execution&gt;</span><br><span class="line">            &lt;&#x2F;executions&gt;</span><br><span class="line">          &lt;&#x2F;plugin&gt;</span><br><span class="line">          &lt;plugin&gt;</span><br><span class="line">            &lt;inherited&gt;true&lt;&#x2F;inherited&gt;</span><br><span class="line">            &lt;artifactId&gt;maven-javadoc-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;executions&gt;</span><br><span class="line">              &lt;execution&gt;</span><br><span class="line">                &lt;id&gt;attach-javadocs&lt;&#x2F;id&gt;</span><br><span class="line">                &lt;goals&gt;</span><br><span class="line">                  &lt;goal&gt;jar&lt;&#x2F;goal&gt;</span><br><span class="line">                &lt;&#x2F;goals&gt;</span><br><span class="line">              &lt;&#x2F;execution&gt;</span><br><span class="line">            &lt;&#x2F;executions&gt;</span><br><span class="line">          &lt;&#x2F;plugin&gt;</span><br><span class="line">          &lt;plugin&gt;</span><br><span class="line">            &lt;inherited&gt;true&lt;&#x2F;inherited&gt;</span><br><span class="line">            &lt;artifactId&gt;maven-deploy-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;configuration&gt;</span><br><span class="line">              &lt;updateReleaseInfo&gt;true&lt;&#x2F;updateReleaseInfo&gt;</span><br><span class="line">            &lt;&#x2F;configuration&gt;</span><br><span class="line">          &lt;&#x2F;plugin&gt;</span><br><span class="line">        &lt;&#x2F;plugins&gt;</span><br><span class="line">      &lt;&#x2F;build&gt;</span><br><span class="line">    &lt;&#x2F;profile&gt;</span><br><span class="line">  &lt;&#x2F;profiles&gt;</span><br><span class="line"> </span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<p>Here, we can see some default settings that the <code>SUPER POM</code> has:</p>
<ul>
<li>the build <strong>target directory</strong> set to <code>&lt;directory&gt;${project.basedir}/target&lt;/directory&gt;</code></li>
<li>the build <strong>source directory</strong> set to <code>&lt;sourceDirectory&gt;${project.basedir}/src/main/java&lt;/sourceDirectory&gt;</code></li>
<li>the <strong>central repository</strong> set to <code>&lt;url&gt;https://repo.maven.apache.org/maven2&lt;/url&gt;</code></li>
</ul>
<h2 id="Minimal-POM"><a href="#Minimal-POM" class="headerlink" title="Minimal POM"></a>Minimal POM</h2><p>The <strong>minimum requirement</strong> for a <code>POM</code> are the following:</p>
<ul>
<li>project root</li>
<li>modelVersion - should be set to 4.0.0</li>
<li>groupId - the id of the project’s group.</li>
<li>artifactId - the id of the artifact (project)</li>
<li>version - the version of the artifact under the specified group</li>
</ul>
<p>For example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;project&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">  &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;my-app&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;1&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>
<p>This is because a needs project’s <strong>fully qualified artifact name</strong>, which will be <strong>in the form of <code>&lt;groupId&gt;:&lt;artifactId&gt;:&lt;version&gt;</code></strong>. As for the example above, its fully qualified artifact name is <code>&quot;com.mycompany.app:my-app:1&quot;</code>.</p>
<p>Also, as mentioned in the previous section, if the configuration details are <strong>not specified</strong>, <strong>Maven will use their defaults</strong>. One of these default values is the packaging type. Every Maven project has a packaging type. If it is not specified in the <code>POM</code>, then the default value “<code>jar</code>“ would be used.</p>
<h2 id="Project-POM-Inheritance"><a href="#Project-POM-Inheritance" class="headerlink" title="Project/POM Inheritance"></a>Project/POM Inheritance</h2><p>Elements in the <code>POM</code> that are merged when you inherit another parent <code>POM</code> are the following:</p>
<ul>
<li>dependencies</li>
<li>developers and contributors</li>
<li>plugin lists (including reports)</li>
<li>plugin executions with matching ids</li>
<li>plugin configuration</li>
<li>resources</li>
</ul>
<p>The <code>Super POM</code> is one example of a parent <code>POM</code> that is inherited by default, however you can also <strong>introduce your own parent <code>POM</code>s by specifying the <code>parent</code> element in the <code>POM</code></strong>, as demonstrated in the following examples.</p>
<ol>
<li><p>If we have everything <strong>ordered nicely</strong> in the following structure, where the parent <code>POM</code> sits right above the children:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">|-- childProject</span><br><span class="line">|   &#96;-- pom.xml</span><br><span class="line">&#96;-- pom.xml</span><br></pre></td></tr></table></figure>
<p>For example, if the <strong>child artifact is <code>com.mycompany.app:childProject:1</code></strong>, </p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;project&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">  &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;childProject&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;1&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<p> And the <strong>parent artifact is <code>com.mycompany.app:parentProject:1</code></strong>, then, we could easily <strong>configure the child <code>POM</code></strong> by adding the <code>&lt;parent&gt;</code> element:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;project&gt;</span><br><span class="line">  &lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;parentProject&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1&lt;&#x2F;version&gt;</span><br><span class="line">  &lt;&#x2F;parent&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">  &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;childProject&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;1&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>If we did not have everything in place, and had the following structure:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line"> |-- childProject</span><br><span class="line"> |   &#96;-- pom.xml</span><br><span class="line"> &#96;-- parentProject</span><br><span class="line">     &#96;-- pom.xml</span><br></pre></td></tr></table></figure>
<p>Then we just need to <strong>add an additional <code>relativePath</code> element</strong> to specify where to find tha parent <code>POM</code>, since we did not have the <code>parent</code> element at the default structure.</p>
<p> So we would <strong>configure the child <code>POM</code></strong> by:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;project&gt;</span><br><span class="line">  &lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;parentProject&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;relativePath&gt;..&#x2F;parent&#x2F;pom.xml&lt;&#x2F;relativePath&gt;</span><br><span class="line">  &lt;&#x2F;parent&gt;</span><br><span class="line"></span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">  &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;childProject&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;1&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>However, in both cases, since the <strong>child <code>POM</code> knows to inherit</strong> from its parent <code>POM</code>, we could further <strong>simplify the child <code>POM</code> to</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;project&gt;</span><br><span class="line">  &lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;parentProject&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1&lt;&#x2F;version&gt;</span><br><span class="line">	(&lt;relativePath&gt;..&#x2F;parent&#x2F;pom.xml&lt;&#x2F;relativePath&gt;)</span><br><span class="line">  &lt;&#x2F;parent&gt;</span><br><span class="line"></span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">  &lt;artifactId&gt;childProject&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>
<p>So that the <strong>child project will have the same <code>groupID</code> and <code>version</code> as the parent, as the information would be inherited</strong>.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> This is different from the example in the section <a href="#Creating-Multiple-Projects-at-Once">Creating Multiple Projects at Once</a> section, because we <strong>did not have the <code>&lt;packaging&gt;pom&lt;/packaging&gt;</code></strong>. The difference is that, in this case (without specifying <code>packaging</code>) the <strong><code>parentProject</code> is/will be used by its child projects</strong> (like Java Inheritance), but in the other case, the <strong>parent uses the children projects</strong> (like Java Composition) <a href="#Project/POM-Aggregation">see below</a></li>
<li><input disabled type="checkbox"> If you want to <strong>compile a specific children project</strong>, you might need to <strong>change the parent <code>POM</code> to <code>&lt;packaging&gt;pom&lt;/packaging&gt;</code></strong>. If you need to access the source codes in the parent directory, you should add the dependencies.</li>
</ul>
</blockquote>
<p><a name="Project/POM-Aggregatio"></a></p>
<h2 id="Project-POM-Aggregation"><a href="#Project-POM-Aggregation" class="headerlink" title="Project/POM Aggregation"></a>Project/POM Aggregation</h2><p>Project Aggregation is similar to Project Inheritance, but there is an essential difference:</p>
<ul>
<li>Project Inheritance would have <code>childrenProjects</code> (<code>modules</code>) using/inheriting the <code>parentProject</code>(<code>parent</code>)</li>
<li>Project Aggregation would have <code>parentProjects</code> (<code>parent</code>) using/composed of the <code>childProjects</code> (<code>modules</code>)</li>
</ul>
<p>So, instead of specifying the parent <code>POM</code> from the <code>module</code>, it <strong>specifies the <code>modules</code> in the parent <code>POM</code></strong>. By doing so, the parent project now knows its <code>modules</code>, and <strong>if a Maven command is invoked against the parent project</strong>, <strong>that Maven command will then be executed to the parent’s <code>modules</code> (its <code>childProjects</code>)as well</strong>. To do Project Aggregation, you must do the following:</p>
<ul>
<li><strong>Configure the <code>parent</code> POMs</strong> <code>packaging</code> to the value “<code>pom</code>“.</li>
<li><strong>Specify in the parent POM</strong> the directories of its modules (children POMs).</li>
</ul>
<ol>
<li><p>If the directory structure follows that of the default structure:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line"> |-- my-module</span><br><span class="line"> |   &#96;-- pom.xml</span><br><span class="line"> &#96;-- pom.xml</span><br></pre></td></tr></table></figure>
<p>Then we need to add the <code>&lt;packaging&gt;</code> element and the <code>&lt;modules&gt;</code> element in the <strong>parent <code>POM</code></strong>:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;project&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">  &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;parent&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;1&lt;&#x2F;version&gt;</span><br><span class="line">  &lt;packaging&gt;pom&lt;&#x2F;packaging&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;modules&gt;</span><br><span class="line">    &lt;module&gt;my-module&lt;&#x2F;module&gt;</span><br><span class="line">  &lt;&#x2F;modules&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>
<p>Now, whenever a Maven command processes <code>com.mycompany.app:parent:1</code>, that same Maven command would be ran against <code>com.mycompany.app:my-module:1</code> as well. Furthermore, some commands (goals specifically) handle project aggregation differently.</p>
</li>
<li><p>If we have the directory structure to the following:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line"> |-- my-module</span><br><span class="line"> |   &#96;-- pom.xml</span><br><span class="line"> &#96;-- parent</span><br><span class="line">     &#96;-- pom.xml</span><br></pre></td></tr></table></figure>

<p> Then we need to specify the <strong>relative path to the module</strong> in the parent <code>POM</code>.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;project&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">  &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;parent&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;1&lt;&#x2F;version&gt;</span><br><span class="line">  &lt;packaging&gt;pom&lt;&#x2F;packaging&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;modules&gt;</span><br><span class="line">    &lt;module&gt;..&#x2F;my-module&lt;&#x2F;module&gt;</span><br><span class="line">  &lt;&#x2F;modules&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="Combining-Project-Inheritance-and-Project-Aggregation"><a href="#Combining-Project-Inheritance-and-Project-Aggregation" class="headerlink" title="Combining Project Inheritance and Project Aggregation"></a>Combining Project Inheritance and Project Aggregation</h2><p>To achieve this, you just edit both child and parent <code>POM</code> in the same way introduced above:</p>
<ul>
<li>Specify in every child POM who their parent POM is. (Project Inheritance)</li>
<li>Change the parent POMs packaging to the value “pom” . (Project Aggregation)</li>
<li>Specify in the parent POM the directories of its modules. (Project Aggregation)</li>
</ul>
<p>For a simple example:<br><code>com.mycompany.app:paernt:1</code>‘s POM</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;project&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">  &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;parent&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;1&lt;&#x2F;version&gt;</span><br><span class="line">  &lt;packaging&gt;pom&lt;&#x2F;packaging&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;modules&gt;</span><br><span class="line">    &lt;module&gt;..&#x2F;my-module&lt;&#x2F;module&gt;</span><br><span class="line">  &lt;&#x2F;modules&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<p><code>com.mycompany.app:my-module:1</code>‘s POM</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;project&gt;</span><br><span class="line">  &lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;parent&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;relativePath&gt;..&#x2F;parent&#x2F;pom.xml&lt;&#x2F;relativePath&gt;</span><br><span class="line">  &lt;&#x2F;parent&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">  &lt;artifactId&gt;my-module&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Variables-in-POM"><a href="#Variables-in-POM" class="headerlink" title="Variables in POM"></a>Variables in <code>POM</code></h2><p>One of the practices that Maven encourages is don’t repeat yourself. However, there are circumstances where you will need to use the same value in several different locations. To assist in ensuring the value is only specified once, Maven allows you to <strong>use both your own and pre-defined variables in the <code>POM</code></strong>.</p>
<p>For example, to access the <code>project.version</code> variable (this is pre-defined), you would reference it like so:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;version&gt;$&#123;project.version&#125;&lt;&#x2F;version&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> If you get an error, you might need to make the variable by yourself in the parent <code>pom</code>. To do this, <a href="#own-variable">see below</a></li>
</ul>
</blockquote>
<ul>
<li><p>Some of the <strong>pre-defined variables</strong> are:</p>
<ul>
<li><strong>Project Model Variables</strong>:<br>Any field of the model that is a single value element can be referenced as a variable. For example, <code>${project.groupId}</code>, <code>${project.version}</code>, <code>${project.build.sourceDirectory}</code> and so on. Refer to the POM reference to see a full list of properties.</li>
<li><strong>Special Variables</strong><ul>
<li><code>project.basedir</code>    The directory that the current project resides in.</li>
<li><code>project.baseUri</code>    The directory that the current project resides in, represented as an URI. Since Maven 2.1.0</li>
<li><code>maven.build.timestamp</code>    The timestamp that denotes the start of the build (UTC). Since Maven 2.1.0-M1</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><a name="own-variable"></a></p>
<ul>
<li>You can also use your <strong>own variable</strong> if you define it in the <code>&lt;properties&gt;</code> section:  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;project&gt;</span><br><span class="line">  ...</span><br><span class="line">  &lt;properties&gt;</span><br><span class="line">    &lt;mavenVersion&gt;3.0&lt;&#x2F;mavenVersion&gt;</span><br><span class="line">  &lt;&#x2F;properties&gt;</span><br><span class="line">  &lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;org.apache.maven&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;maven-artifact&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;version&gt;$&#123;mavenVersion&#125;&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;org.apache.maven&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;maven-core&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;version&gt;$&#123;mavenVersion&#125;&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">  &lt;&#x2F;dependencies&gt;</span><br><span class="line">  ...</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="Profiles"><a href="#Profiles" class="headerlink" title="Profiles"></a>Profiles</h2><p>In short, Maven profiles can be used to create <strong>customized build configurations</strong>.</p>
<p>Profiles are specified using the element <code>&lt;profile&gt;</code> in the <code>POM</code>itself (in the extra section <code>&lt;profiles&gt;</code>), and can be <strong>triggered in many different ways</strong>. They modify the POM at build time, and are meant to be used in complementary sets to give equivalent-but-different parameters for a set of target environments (providing, for example, the path of the appserver root in the development, testing, and production environments). As such, profiles can easily lead to differing build results from different members of your team. </p>
<p>Profiles (<code>&lt;profiles&gt;</code>) can be <strong>specified in any of the four file locations</strong>:</p>
<ul>
<li><p>Per Project</p>
<ul>
<li>Defined in the POM itself (<code>pom.xml</code>).</li>
</ul>
</li>
<li><p>Per User</p>
<ul>
<li>Defined in the Maven-settings (<code>%USER_HOME%/.m2/settings.xml</code>).</li>
</ul>
</li>
<li><p>Global</p>
<ul>
<li>Defined in the global Maven-settings (<code>${maven.home}/conf/settings.xml</code>).</li>
</ul>
</li>
<li><p>Profile descriptor (<strong>unsupported in Maven 3.0 and above</strong>)</p>
<ul>
<li>a descriptor located in project basedir (profiles.xml) </li>
</ul>
</li>
</ul>
<h2 id="Viewing-Active-Profiles"><a href="#Viewing-Active-Profiles" class="headerlink" title="Viewing Active Profiles"></a>Viewing Active Profiles</h2><p>To see which profiles are already active, you can use the <code>help</code> plugin from MAVEN:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn help:active-profiles</span><br></pre></td></tr></table></figure>

<p>and by default, nothing is actived so you will see nothing:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Active Profiles for Project &#39;com.mycompany.app:my-app:pom:1.0-SNAPSHOT&#39;:</span><br><span class="line"></span><br><span class="line">The following profiles are active:</span><br></pre></td></tr></table></figure>
<p>If we want to <strong>automatically show the active profiles</strong> when we are doing, for example, the <code>compile</code> phase, we can use the similar approach shown in the section [Customizing your Build Lifecycle by Plugins](#Customizing-your-Build Lifecycle-by-Plugins) by <strong>adding the <code>help</code> plugin and the <code>goal</code></strong> in our phase <code>compile</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;maven-help-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;3.2.0&lt;&#x2F;version&gt;</span><br><span class="line">            &lt;executions&gt;</span><br><span class="line">                &lt;execution&gt;</span><br><span class="line">                    &lt;id&gt;show-profiles&lt;&#x2F;id&gt;</span><br><span class="line">                    &lt;phase&gt;compile&lt;&#x2F;phase&gt;</span><br><span class="line">                    &lt;goals&gt;</span><br><span class="line">                        &lt;goal&gt;active-profiles&lt;&#x2F;goal&gt;</span><br><span class="line">                    &lt;&#x2F;goals&gt;</span><br><span class="line">                &lt;&#x2F;execution&gt;</span><br><span class="line">            &lt;&#x2F;executions&gt;</span><br><span class="line">        &lt;&#x2F;plugin&gt;</span><br><span class="line">    &lt;&#x2F;plugins&gt;</span><br><span class="line">&lt;&#x2F;build&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Making-a-Profile"><a href="#Making-a-Profile" class="headerlink" title="Making a Profile"></a>Making a Profile</h2><p>Within each <code>&lt;profile&gt;</code> element, we can <strong>configure many elements such as <code>dependencies</code>, <code>plugins</code>, <code>resources</code>, <code>finalName</code></strong>.</p>
<p>For example (configured a <code>plugin</code>):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;profiles&gt;</span><br><span class="line">	&lt;profile&gt;</span><br><span class="line">	  &lt;id&gt;test&lt;&#x2F;id&gt;</span><br><span class="line"></span><br><span class="line">	  &lt;build&gt;</span><br><span class="line">	     &lt;plugins&gt;</span><br><span class="line">	        &lt;plugin&gt;</span><br><span class="line">	           &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">	           &lt;artifactId&gt;maven-antrun-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">	           &lt;version&gt;1.1&lt;&#x2F;version&gt;</span><br><span class="line">	           &lt;executions&gt;</span><br><span class="line">	              &lt;execution&gt;</span><br><span class="line">	                 &lt;phase&gt;test&lt;&#x2F;phase&gt;</span><br><span class="line">	                 &lt;goals&gt;</span><br><span class="line">	                    &lt;goal&gt;run&lt;&#x2F;goal&gt;</span><br><span class="line">	                 &lt;&#x2F;goals&gt;</span><br><span class="line">	                 &lt;configuration&gt;</span><br><span class="line">	                 &lt;tasks&gt;</span><br><span class="line">	                    &lt;echo&gt;Using app.test.properties&lt;&#x2F;echo&gt;</span><br><span class="line">	                    &lt;copy file&#x3D;&quot;src&#x2F;main&#x2F;resources&#x2F;app.test.properties&quot; </span><br><span class="line">	                    	tofile&#x3D;&quot;$&#123;project.build.outputDirectory&#125;&#x2F;env.properties&quot;&#x2F;&gt;</span><br><span class="line">	                 &lt;&#x2F;tasks&gt;</span><br><span class="line">	                 &lt;&#x2F;configuration&gt;</span><br><span class="line">	              &lt;&#x2F;execution&gt;</span><br><span class="line">	           &lt;&#x2F;executions&gt;</span><br><span class="line">	        &lt;&#x2F;plugin&gt;</span><br><span class="line">	     &lt;&#x2F;plugins&gt;</span><br><span class="line">	  &lt;&#x2F;build&gt;</span><br><span class="line"></span><br><span class="line">	&lt;&#x2F;profile&gt;</span><br><span class="line">&lt;&#x2F;profiles&gt;</span><br></pre></td></tr></table></figure>
<p>Another simpler example could be:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;profiles&gt;</span><br><span class="line">  &lt;profile&gt;</span><br><span class="line">    &lt;id&gt;no-tests&lt;&#x2F;id&gt;</span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;maven.test.skip&gt;true&lt;&#x2F;maven.test.skip&gt;</span><br><span class="line">    &lt;&#x2F;properties&gt;</span><br><span class="line">  &lt;&#x2F;profile&gt;</span><br><span class="line">&lt;&#x2F;profiles&gt;</span><br></pre></td></tr></table></figure>
<p>(This will skip the <code>test</code> phase in the artifact if you activate it.)</p>
<p>In general, it is <strong>recommended</strong> to specify a profile in the <strong><code>POM</code> of the project</strong>. This is because it will be <strong>portable</strong> since the <code>POM</code> file will be included in the final product. In contrast, profiles specified in <strong>external files</strong> (i.e <strong>in <code>settings.xml</code></strong> or <code>profiles.xml</code>) are <strong>not portable</strong> in the strictest sense. Also, you can <strong>specify much more modifications in the profile in the <code>POM</code> than in the <code>settings.xml</code></strong>. For more details, see the section <a href="#Profiles-in-POM-and-in-Settings">Profiles in <code>POM</code>s and in <code>Settings</code></a>.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> In the above examples, there is an <code>&lt;id&gt;</code> element for that <code>profile</code>. <strong>This will be used later to activate the profile</strong>, so it is important to give it a sensible name,</li>
<li><input disabled type="checkbox"> We can also <strong>configure as many profiles</strong> as we want by <strong>giving them unique <code>id</code>s</strong>.</li>
</ul>
</blockquote>
<h2 id="Activate-a-Profile"><a href="#Activate-a-Profile" class="headerlink" title="Activate a Profile"></a>Activate a Profile</h2><p>You can activate a profile in a number of ways:</p>
<ul>
<li>For a <strong>single run</strong><ul>
<li>explicitly add the <code>-P &lt;profile-id&gt;</code> at the end of a command</li>
</ul>
</li>
<li><strong>Automatically for a project</strong> (per project)<ul>
<li>through the <code>POM</code> file</li>
</ul>
</li>
<li><strong>Automatically for all projects of a user</strong> (per user)<ul>
<li>Through Maven settings</li>
</ul>
</li>
<li><strong>Triggered</strong><ul>
<li>Based on environment variables</li>
<li>OS settings</li>
<li>Present or missing files</li>
</ul>
</li>
</ul>
<h2 id="Activate-Profile-for-a-Single-Run"><a href="#Activate-Profile-for-a-Single-Run" class="headerlink" title="Activate Profile for a Single Run"></a>Activate Profile for a Single Run</h2><p>This can be done by adding the option <code>-P &lt;profile-id&gt;</code> so that the profile will be <strong>activated for that specific run</strong>.</p>
<p>For example, to use the <code>no-test</code> profile (assuming that profile is added to the <code>pom</code> file of this project), we could use:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn package -P no-test</span><br></pre></td></tr></table></figure>
<p>This will execute all phases up to and until <code>package</code>, except <strong>skipping the <code>test</code> phase</strong>, as <strong>specified by our <code>no-test</code> profile</strong>.</p>
<p>You could also activate multiple profiles by using comma as a delimiter:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn package -P no-test,profile2,profile3</span><br></pre></td></tr></table></figure>

<h2 id="Activate-Profile-Automatically-for-a-Project"><a href="#Activate-Profile-Automatically-for-a-Project" class="headerlink" title="Activate Profile Automatically for a Project"></a>Activate Profile Automatically for a Project</h2><p>This can be done by adding another section <code>&lt;activation&gt;</code> in the same section where you specified the <code>&lt;profile&gt;</code>. </p>
<p>For example, if we want to automatically activate the profile <code>no-test</code> for a project (again, assuming that profile is added to the <code>pom</code> file of this project), then we would have in the <code>pom</code> file:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;profiles&gt;</span><br><span class="line">  &lt;profile&gt;</span><br><span class="line">    &lt;id&gt;no-test&lt;&#x2F;id&gt;</span><br><span class="line">    &lt;activation&gt;</span><br><span class="line">	  &lt;activateByDefault&gt;true&lt;&#x2F;activateByDefault&gt;</span><br><span class="line">    &lt;&#x2F;activation&gt;</span><br><span class="line"></span><br><span class="line">	&lt;properties&gt;</span><br><span class="line">	  &lt;maven.test.skip&gt;true&lt;&#x2F;maven.test.skip&gt;</span><br><span class="line">	&lt;&#x2F;properties&gt;</span><br><span class="line">  &lt;&#x2F;profile&gt;</span><br><span class="line">&lt;profiles&gt;</span><br></pre></td></tr></table></figure>
<p>This will activate the profile <code>no-test</code> everytime when the project is run.</p>
<h2 id="Deactivating-a-Profile"><a href="#Deactivating-a-Profile" class="headerlink" title="Deactivating a Profile"></a>Deactivating a Profile</h2><p>Deactivating a profile is done by adding the option <code>-P !&lt;profile-id&gt;</code> or <code>-P -&lt;profile-id&gt;</code></p>
<p>However, one important thing to note is that, if you have several profiles that are <strong>activated by default</strong>, running the <code>-P !&lt;profile-id&gt;</code> or <code>-P -&lt;profile-id&gt;</code> would <strong>override the configuration such that all those profiles that are activated by default would be ignored/deactivated</strong>.</p>
<h2 id="Activate-Profile-Automatically-for-all-Projects-per-user"><a href="#Activate-Profile-Automatically-for-all-Projects-per-user" class="headerlink" title="Activate Profile Automatically for all Projects (per user)"></a>Activate Profile Automatically for all Projects (per user)</h2><p>Profiles can be activated in the <strong>Maven settings file</strong> (per user, <code>%USER_HOME%/.m2/settings.xml</code>; globally/all users, <code>${maven.home}/conf/settings.xml</code>), via the <code>&lt;activeProfiles&gt;</code> section. This section takes a list of <code>&lt;activeProfile&gt;</code> elements, each containing a <code>&lt;profile-id&gt;</code> inside.</p>
<p>For example, to activate the <code>no-test</code> profile for all projects of a user, add the following to the <code>%USER_HOME%/.m2/settings.xml</code>: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;settings&gt;</span><br><span class="line">  ...</span><br><span class="line">  &lt;activeProfiles&gt;</span><br><span class="line">    &lt;activeProfile&gt;no-test&lt;&#x2F;activeProfile&gt;</span><br><span class="line">  &lt;&#x2F;activeProfiles&gt;</span><br><span class="line">  ...</span><br><span class="line">&lt;&#x2F;settings&gt;</span><br></pre></td></tr></table></figure>
<p>So that profiles listed in the <code>&lt;activeProfiles&gt;</code> tag would be <strong>activated by default every time that user runs a project</strong>.</p>
<h2 id="Activate-Profiles-by-Triggers"><a href="#Activate-Profiles-by-Triggers" class="headerlink" title="Activate Profiles by Triggers"></a>Activate Profiles by Triggers</h2><p>Profiles can be automatically triggered based on the detected state of the build environment. <strong>These triggers are specified via an <code>&lt;activation&gt;</code> section in the profile itself</strong>.</p>
<ul>
<li><p>Triggered by a specific JDK version:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;profiles&gt;</span><br><span class="line">  &lt;profile&gt;</span><br><span class="line">    &lt;activation&gt;</span><br><span class="line">      &lt;jdk&gt;1.4&lt;&#x2F;jdk&gt;</span><br><span class="line">    &lt;&#x2F;activation&gt;</span><br><span class="line">    ...</span><br><span class="line">  &lt;&#x2F;profile&gt;</span><br><span class="line">&lt;&#x2F;profiles&gt;</span><br></pre></td></tr></table></figure>

<p>  The above will trigger the profile when the JDK’s version <strong>starts with “1.4”</strong> (eg. “1.4.0_08”, “1.4.2_07”, “1.4”)</p>
</li>
<li><p>Triggered by a specific OS setting:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;profiles&gt;</span><br><span class="line">  &lt;profile&gt;</span><br><span class="line">    &lt;activation&gt;</span><br><span class="line">      &lt;os&gt;</span><br><span class="line">        &lt;name&gt;Windows XP&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;family&gt;Windows&lt;&#x2F;family&gt;</span><br><span class="line">        &lt;arch&gt;x86&lt;&#x2F;arch&gt;</span><br><span class="line">        &lt;version&gt;5.1.2600&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;&#x2F;os&gt;</span><br><span class="line">    &lt;&#x2F;activation&gt;</span><br><span class="line">    ...</span><br><span class="line">  &lt;&#x2F;profile&gt;</span><br><span class="line">&lt;&#x2F;profiles&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Triggered by a specific property</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;profiles&gt;</span><br><span class="line">  &lt;profile&gt;</span><br><span class="line">    &lt;activation&gt;</span><br><span class="line">      &lt;property&gt;</span><br><span class="line">        &lt;name&gt;debug&lt;&#x2F;name&gt;</span><br><span class="line">      &lt;&#x2F;property&gt;</span><br><span class="line">    &lt;&#x2F;activation&gt;</span><br><span class="line">    ...</span><br><span class="line">  &lt;&#x2F;profile&gt;</span><br><span class="line">&lt;&#x2F;profiles&gt;</span><br></pre></td></tr></table></figure>

<p>  The profile above will be activated when the system property “debug” is specified with <strong>any value</strong>.</p>
<p>  Or, you can specify it to be activated when the system property “debug” is <strong>not defined</strong>, or is defined with <strong>a value which is not “true”</strong>.</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;profiles&gt;</span><br><span class="line">  &lt;profile&gt;</span><br><span class="line">    &lt;activation&gt;</span><br><span class="line">      &lt;property&gt;</span><br><span class="line">        &lt;name&gt;debug&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;value&gt;!true&lt;&#x2F;value&gt;</span><br><span class="line">      &lt;&#x2F;property&gt;</span><br><span class="line">    &lt;&#x2F;activation&gt;</span><br><span class="line">    ...</span><br><span class="line">  &lt;&#x2F;profile&gt;</span><br><span class="line">&lt;&#x2F;profiles&gt;</span><br></pre></td></tr></table></figure>

<p>  The above can be activated by typing one of those on the command line:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mvn groupId:artifactId:goal</span><br><span class="line">mvn groupId:artifactId:goal -Ddebug&#x3D;false</span><br></pre></td></tr></table></figure></li>
<li><p>Triggered by a missing/present file</p>
<p>  This example will trigger the profile when the generated file <code>target/generated-sources/axistools/wsdl2java/org/apache/maven</code> is <strong>missing</strong>.</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;profiles&gt;</span><br><span class="line">  &lt;profile&gt;</span><br><span class="line">    &lt;activation&gt;</span><br><span class="line">      &lt;file&gt;</span><br><span class="line">        &lt;missing&gt;target&#x2F;generated-sources&#x2F;axistools&#x2F;wsdl2java&#x2F;org&#x2F;apache&#x2F;maven&lt;&#x2F;missing&gt;</span><br><span class="line">      &lt;&#x2F;file&gt;</span><br><span class="line">    &lt;&#x2F;activation&gt;</span><br><span class="line">    ...</span><br><span class="line">  &lt;&#x2F;profile&gt;</span><br><span class="line">&lt;&#x2F;profiles&gt;</span><br></pre></td></tr></table></figure>

<p>  Or you could <strong>switch the <code>&lt;missing&gt;</code> to <code>&lt;exists&gt;</code></strong> if you want to trigger the profile <strong>when that file is present</strong>.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> As of Maven 2.0.9, the tags <code>&lt;exists&gt;</code> and <code>&lt;missing&gt;</code> could be <strong>interpolated</strong>. <strong>Supported variables</strong> are system properties like <code>${user.home}</code> and environment variables like <code>${env.HOME}</code>. Please note that <strong>properties and values defined in the POM</strong> itself are <strong>not available</strong> for interpolation here</li>
</ul>
</blockquote>
</li>
</ul>
<p><a name="Profiles-in-POM-and-in-Settings"></a></p>
<h2 id="Profiles-in-POMs-and-in-Settings"><a href="#Profiles-in-POMs-and-in-Settings" class="headerlink" title="Profiles in POMs and in Settings"></a>Profiles in <code>POM</code>s and in <code>Settings</code></h2><ul>
<li><p>Profiles in external files (<code>settings.xml</code>)</p>
<p>  Profiles specified in external files (i.e in <code>settings.xml</code> or <code>profiles.xml</code>) are not portable in the strictest sense. Things like repository lists could simply be a proprietary repository of approved artifacts, and won’t change the outcome of the build. Therefore, you will <strong>only be able to modify</strong> </p>
<ul>
<li><code>&lt;repositories&gt;</code></li>
<li><code>&lt;pluginRepositories&gt;</code></li>
<li><code>&lt;properties&gt;</code></li>
</ul>
</li>
<li><p>Profiles in <code>POM</code>s</p>
<p>If your profiles can be reasonably specified inside the <code>POM</code>, you will have a better portability <strong>since these profiles are specified inline</strong>. Therefore, you have many more options as well. The <strong>trade-off</strong>, of course, is that you can <strong>only modify that project and it’s sub-modules</strong>.</p>
<p>  Profiles specified in the <code>POM</code> can modify the following <code>POM</code> elements:</p>
<ul>
<li><code>&lt;repositories&gt;</code></li>
<li><code>&lt;pluginRepositories&gt;</code></li>
<li><code>&lt;dependencies&gt;</code></li>
<li><code>&lt;plugins&gt;</code></li>
<li><code>&lt;properties&gt;</code> (not actually available in the main POM, but used behind the scenes)</li>
<li><code>&lt;modules&gt;</code></li>
<li><code>&lt;reporting&gt;</code></li>
<li><code>&lt;dependencyManagement&gt;</code></li>
<li><code>&lt;distributionManagement&gt;</code></li>
<li>a subset of the <code>&lt;build&gt;</code> element, which consists of:<ul>
<li><code>&lt;defaultGoal&gt;</code></li>
<li><code>&lt;resources&gt;</code></li>
<li><code>&lt;testResources&gt;</code></li>
<li><code>&lt;finalName&gt;</code></li>
<li><code>&lt;plugin&gt;</code>???</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> If you have conflicting profiles in both the <code>pom</code> file and the <code>settings.xml</code> file, take note that <strong>profiles in the <code>settings.xml</code> takes higher priority</strong> than profiles in the <code>POM</code>.</li>
</ul>
</blockquote>
<h2 id="Standard-Directory-Output"><a href="#Standard-Directory-Output" class="headerlink" title="Standard Directory Output"></a>Standard Directory Output</h2><p>Having a common directory layout would allow for users familiar with one Maven project to immediately feel at home in another Maven project. The following table documents the <strong>directory layout expected by Maven</strong> and the directory layout created by Maven. Please try to conform to this structure as much as possible; however, if you can’t these settings <strong>can be overridden via the project descriptor</strong>.</p>
<table>
<thead>
<tr>
<th>Directory</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>src/main/java</code></td>
<td>Application/Library sources</td>
</tr>
<tr>
<td><code>src/main/resources</code></td>
<td>Application/Library resources</td>
</tr>
<tr>
<td><code>src/main/filters</code></td>
<td>Resource filter files</td>
</tr>
<tr>
<td><code>src/main/webapp</code></td>
<td>Web application sources</td>
</tr>
<tr>
<td><code>src/test/java</code></td>
<td>Test sources</td>
</tr>
<tr>
<td><code>src/test/resources</code></td>
<td>Test resources</td>
</tr>
<tr>
<td><code>src/test/filters</code></td>
<td>Test resource filter files</td>
</tr>
<tr>
<td><code>src/it</code></td>
<td>Integration Tests (primarily for plugins)</td>
</tr>
<tr>
<td><code>src/assembly</code></td>
<td>Assembly descriptors</td>
</tr>
<tr>
<td><code>src/site</code></td>
<td>Site</td>
</tr>
<tr>
<td><code>LICENSE.txt</code></td>
<td>Project’s license</td>
</tr>
<tr>
<td><code>NOTICE.txt</code></td>
<td>Notices and attributions required by libraries that the project depends on</td>
</tr>
<tr>
<td><code>README.txt</code></td>
<td>Project’s readme</td>
</tr>
</tbody></table>
<p>This means that <strong>at the top level</strong>, we will have <strong>files descriptive of the project</strong>: a <code>pom.xml</code> file, and textual documents meant for the user to be able to read immediately on receiving the source: <code>README.txt</code>, <code>LICENSE.txt</code>, etc.</p>
<p>So there are just <strong>two subdirectories of this structure</strong>: <code>src</code> and <code>target</code>. The <strong>only other directories that would be expected</strong> here are metadata like <code>CVS</code>, <strong><code>.git</code></strong> or <code>.svn</code>, and any subprojects in a multiproject build (each of which would be laid out as above).</p>
<ul>
<li>The <code>src</code> directory contains <strong>all of the source material for building the project</strong>, its site and so on. It contains a subdirectory for each type: main for the main build artifact, test for the unit test code and resources, site and so on.</li>
<li>The <code>target</code> directory is used to house <strong>all output of the build</strong>.</li>
</ul>
<p>Also, it is important to see that, within artifact producing source directories (ie. main and test), <strong>there is one directory for the language java</strong> (under which the normal package hierarchy exists), and one for resources (the structure which is copied to the target classpath given the default resource definition). But <strong>if there are other contributing sources to the artifact build, they would be under other subdirectories</strong>: for example <code>src/main/antlr</code> would contain Antlr grammar definition files.</p>
<h2 id="Transitive-Dependency"><a href="#Transitive-Dependency" class="headerlink" title="Transitive Dependency"></a>Transitive Dependency</h2><p>Maven avoids the need to <strong>specify the libraries that your own dependencies require</strong> by including <strong>transitive dependencies</strong> automatically.</p>
<p>This feature is facilitated by <strong>reading the project files of your dependencies from the remote repositories specified</strong>. In general, <strong>all dependencies of those projects are used in your project</strong>, as are any that the project inherits from its parents, or from its dependencies, and so on.  A problem arises only if a cyclic dependency is discovered.</p>
<p>However, with transitive dependency, the graph of included libraries will grow quite large. Therefore, there are <strong>additional features that can be used to limit which dependencies are included</strong>:</p>
<ul>
<li>Dependency Mediation</li>
<li>Dependency Management</li>
<li>Dependency Scope</li>
<li>Dependency Exclusion</li>
<li>Optional Dependency</li>
</ul>
<h2 id="Dependency-Mediation"><a href="#Dependency-Mediation" class="headerlink" title="Dependency Mediation"></a>Dependency Mediation</h2><p>This determines <strong>what version of an artifact/dependency will be chosen</strong> when multiple versions are encountered as dependencies. By default, Maven picks the “nearest definition”. That is, it uses the version of the closest dependency to your project in the tree of dependencies. </p>
<p>However, you can always guarantee a version by declaring it <strong>explicitly in your project’s <code>POM</code></strong> (see section <a href="#Using-External-Dependency">Using External Dependency</a>). You basically need to add the following to your <code>POM</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;myDependency&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;version&gt;aSpecificVersion&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;scope&gt;compile&lt;&#x2F;scope&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>
<p>Or, you could use the <a href="#Dependency-Management">Dependency Management</a> in the section below.</p>
<p><a name="Dependency-Management"></a></p>
<h2 id="Dependency-Management"><a href="#Dependency-Management" class="headerlink" title="Dependency Management"></a>Dependency Management</h2><p>The dependency management section is a mechanism for <strong>centralizing dependency information</strong>. When you have a set of projects that inherit from a common parent, it’s possible to put all information about the dependency in the common POM and have simpler references to the artifacts in the child POMs.</p>
<ol>
<li>For example, you could use it to control the <strong>versions of the artifacts in a set of dependencies</strong>:</li>
</ol>
<p>If you have a parent Project A and child Project B:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"># Project A</span><br><span class="line">&lt;project&gt;</span><br><span class="line"> &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"> &lt;groupId&gt;maven&lt;&#x2F;groupId&gt;</span><br><span class="line"> &lt;artifactId&gt;A&lt;&#x2F;artifactId&gt;</span><br><span class="line"> &lt;packaging&gt;pom&lt;&#x2F;packaging&gt;</span><br><span class="line"> &lt;name&gt;A&lt;&#x2F;name&gt;</span><br><span class="line"> &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line"></span><br><span class="line"> &lt;dependencyManagement&gt;</span><br><span class="line">   &lt;dependencies&gt;</span><br><span class="line">     &lt;dependency&gt;</span><br><span class="line">       &lt;groupId&gt;test&lt;&#x2F;groupId&gt;</span><br><span class="line">       &lt;artifactId&gt;a&lt;&#x2F;artifactId&gt;</span><br><span class="line">       &lt;version&gt;1.2&lt;&#x2F;version&gt;</span><br><span class="line">     &lt;&#x2F;dependency&gt;</span><br><span class="line">     &lt;dependency&gt;</span><br><span class="line">       &lt;groupId&gt;test&lt;&#x2F;groupId&gt;</span><br><span class="line">       &lt;artifactId&gt;b&lt;&#x2F;artifactId&gt;</span><br><span class="line">       &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">       &lt;scope&gt;compile&lt;&#x2F;scope&gt;</span><br><span class="line">     &lt;&#x2F;dependency&gt;</span><br><span class="line">     &lt;dependency&gt;</span><br><span class="line">       &lt;groupId&gt;test&lt;&#x2F;groupId&gt;</span><br><span class="line">       &lt;artifactId&gt;c&lt;&#x2F;artifactId&gt;</span><br><span class="line">       &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">       &lt;scope&gt;compile&lt;&#x2F;scope&gt;</span><br><span class="line">     &lt;&#x2F;dependency&gt;</span><br><span class="line">     &lt;dependency&gt;</span><br><span class="line">       &lt;groupId&gt;test&lt;&#x2F;groupId&gt;</span><br><span class="line">       &lt;artifactId&gt;d&lt;&#x2F;artifactId&gt;</span><br><span class="line">       &lt;version&gt;1.2&lt;&#x2F;version&gt;</span><br><span class="line">     &lt;&#x2F;dependency&gt;</span><br><span class="line">   &lt;&#x2F;dependencies&gt;</span><br><span class="line"> &lt;&#x2F;dependencyManagement&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>
<p>at this point, if you have the following Project B configuration:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># Project B</span><br><span class="line">&lt;project&gt;</span><br><span class="line">  &lt;parent&gt;</span><br><span class="line">    &lt;artifactId&gt;A&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;groupId&gt;maven&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">  &lt;&#x2F;parent&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">  &lt;groupId&gt;maven&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;B&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;packaging&gt;pom&lt;&#x2F;packaging&gt;</span><br><span class="line">  &lt;name&gt;B&lt;&#x2F;name&gt;</span><br><span class="line">  &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;test&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;a&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;test&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;c&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">  &lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>
<p>Then version of artifact <code>a</code> and <code>c</code> would be <code>1.2</code> and <code>1.0</code>, respectively. </p>
<p>However, if you have the following configuration:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># Project B</span><br><span class="line">&lt;project&gt;</span><br><span class="line">  &lt;parent&gt;</span><br><span class="line">    &lt;artifactId&gt;A&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;groupId&gt;maven&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">  &lt;&#x2F;parent&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">  &lt;groupId&gt;maven&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;B&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;packaging&gt;pom&lt;&#x2F;packaging&gt;</span><br><span class="line">  &lt;name&gt;B&lt;&#x2F;name&gt;</span><br><span class="line">  &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;test&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;a&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;test&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;c&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">  &lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>
<p>Then you would have version of <code>1.0</code> for both <code>a</code> and <code>c</code>. Also, the <code>scope</code> of <code>a</code> would become <code>runtime</code></p>
<ol start="2">
<li>Now, consider reverse case where we have two children <code>POM</code>s, Project A and Project B, with the following configurations:</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># Project A:</span><br><span class="line"></span><br><span class="line">&lt;project&gt;</span><br><span class="line">  ...</span><br><span class="line">  &lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;group-a&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;artifact-a&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;exclusions&gt;</span><br><span class="line">        &lt;exclusion&gt;</span><br><span class="line">          &lt;groupId&gt;group-c&lt;&#x2F;groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;excluded-artifact&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;exclusion&gt;</span><br><span class="line">      &lt;&#x2F;exclusions&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;group-a&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;artifact-b&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;type&gt;bar&lt;&#x2F;type&gt;</span><br><span class="line">      &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">  &lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>
<p>and </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;project&gt;</span><br><span class="line">  ...</span><br><span class="line">  &lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;group-c&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;artifact-b&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;type&gt;war&lt;&#x2F;type&gt;</span><br><span class="line">      &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;group-a&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;artifact-b&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;type&gt;bar&lt;&#x2F;type&gt;</span><br><span class="line">      &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">  &lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>
<p>We see that these two example <code>POM</code>s <strong>share a common dependency (<code>group-a</code> artifact <code>artifact-b</code>)</strong> and each has one non-trivial dependency. This <strong>information can be put in the parent <code>POM</code></strong> like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"># created a parent POM</span><br><span class="line">&lt;project&gt;</span><br><span class="line">  ...</span><br><span class="line">  &lt;dependencyManagement&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;group-a&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;artifact-a&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line"> </span><br><span class="line">        &lt;exclusions&gt;</span><br><span class="line">          &lt;exclusion&gt;</span><br><span class="line">            &lt;groupId&gt;group-c&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;excluded-artifact&lt;&#x2F;artifactId&gt;</span><br><span class="line">          &lt;&#x2F;exclusion&gt;</span><br><span class="line">        &lt;&#x2F;exclusions&gt;</span><br><span class="line"> </span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line"> </span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;group-c&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;artifact-b&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;type&gt;war&lt;&#x2F;type&gt;</span><br><span class="line">        &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line"> </span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;group-a&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;artifact-b&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;type&gt;bar&lt;&#x2F;type&gt;</span><br><span class="line">        &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line">  &lt;&#x2F;dependencyManagement&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>
<p>Now, if the two children inherits the parent, we could simplify the children <code>POM</code>s:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># Project A</span><br><span class="line">&lt;project&gt;</span><br><span class="line">  ...</span><br><span class="line">  &lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;group-a&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;artifact-a&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;group-a&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;artifact-b&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;!-- This is not a jar dependency, so we must specify type. --&gt;</span><br><span class="line">      &lt;type&gt;bar&lt;&#x2F;type&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">  &lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>
<p>and </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># Project B</span><br><span class="line">&lt;project&gt;</span><br><span class="line">  ...</span><br><span class="line">  &lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;group-c&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;artifact-b&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;!-- This is not a jar dependency, so we must specify type. --&gt;</span><br><span class="line">      &lt;type&gt;war&lt;&#x2F;type&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;group-a&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;artifact-b&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;!-- This is not a jar dependency, so we must specify type. --&gt;</span><br><span class="line">      &lt;type&gt;bar&lt;&#x2F;type&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">  &lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> In two of these dependency references, we had to specify the <code>&lt;type&gt;</code> element. This is because the <strong>minimal set of information for matching a dependency reference against a <code>&lt;dependencyManagement&gt;</code> section is actually <code>{groupId, artifactId, type, classifier}</code></strong>. In many cases, these dependencies will refer to <strong><code>jar</code> artifacts with no classifier</strong>. <strong>This allows us to shorthand the identity set to <code>{groupId, artifactId}</code></strong>. However, in other cases, we would need to include the <code>&lt;type&gt;</code> element.</li>
</ul>
</blockquote>
<h2 id="Difference-between-using-lt-dependency-gt-and-lt-dependencyManagement-gt"><a href="#Difference-between-using-lt-dependency-gt-and-lt-dependencyManagement-gt" class="headerlink" title="Difference between using &lt;dependency&gt; and &lt;dependencyManagement&gt;"></a>Difference between using <code>&lt;dependency&gt;</code> and <code>&lt;dependencyManagement&gt;</code></h2><ul>
<li>if you use <code>&lt;dependencies&gt;</code> in the parent <code>pom</code> and specify all the dependencies your chlidren will need, this will<ul>
<li>create a shorter child poms, as technically you don’t need to specify them again, unless you want to override something, like the <code>version</code>.</li>
<li>it means that <strong>those dependencies will ALWAYS be defined for ALL the child modules</strong>. </li>
</ul>
</li>
<li>if you use <code>&lt;dependencyManagement&gt;</code> in the parent <code>POM</code>, this will<ul>
<li>allow you to chose <strong>which child modules will have a dependency specified in th parent</strong>. If nothing/no dependency is specified in the children <code>POM</code>, then no dependency will be ensued.</li>
</ul>
</li>
</ul>
<h2 id="Dependency-Scope"><a href="#Dependency-Scope" class="headerlink" title="Dependency Scope"></a>Dependency Scope</h2><p>Dependency scope is used to limit the transitivity of a dependency, and also to affect the classpath used for various build tasks.</p>
<p>There are <strong>6 scopes available</strong>:</p>
<ul>
<li><code>compile</code> <ul>
<li>This is the default scope, used if none is specified. <strong>Compile dependencies are available in all classpaths of a project</strong>. Furthermore, those dependencies are <strong>propagated to dependent projects</strong>.</li>
</ul>
</li>
<li><code>provided</code><ul>
<li>This is much like compile, but indicates you <strong>expect the JDK or a container to provide the dependency at runtime</strong>. For example, when building a web application for the Java Enterprise Edition, you would <strong>set the dependency on the Servlet API and related Java EE APIs to scope <code>provided</code></strong> because the <strong>web container provides those classes</strong>. This scope is only available on the compilation and test classpath, and is <strong>not transitive</strong>.</li>
</ul>
</li>
<li><code>runtime</code><ul>
<li>This scope indicates that the dependency is <strong>not required for compilation</strong>, but is <strong>for execution</strong>. It is in the runtime and test classpaths, but not the compile classpath.</li>
</ul>
</li>
<li><code>test</code><ul>
<li>This scope indicates that the dependency is not required for normal use of the application, and is <strong>only available for the test compilation and execution phases</strong>. This scope is <strong>not transitive</strong>.</li>
</ul>
</li>
<li><code>system</code><ul>
<li>This scope is <strong>similar to <code>provided</code> except that you have to provide the JAR which contains it explicitly</strong>. The artifact is <strong>always available and is not looked up in a repository</strong>.</li>
</ul>
</li>
<li><code>import</code><ul>
<li>This scope is only supported on a dependency of type <code>pom</code> in the <code>&lt;dependencyManagement&gt;</code> section (see <a href="#Dependency-Management">Depedency Management</a>). It indicates the <strong>dependency to be replaced with the effective list of dependencies in the specified POM’s <code>&lt;dependencyManagement&gt;</code> section</strong>. Since they are replaced, dependencies with a scope of import do not actually participate in limiting the transitivity of a dependency.</li>
</ul>
</li>
</ul>
<p>However, each of the scopes (except for <code>import</code>) <strong>affects transitive dependencies in different ways</strong>, as is demonstrated in the table below. </p>
<p>If a <strong>parent dependency</strong> is set to the scope in the <strong>left column</strong>, <strong>transitive dependencies of the child dependency</strong> with the <strong>scope across the top row</strong> <strong>will result in a dependency in the main project with the scope listed at the intersection</strong>. If no scope is listed, it means the dependency will be omitted.</p>
<table>
<thead>
<tr>
<th>-</th>
<th>compile</th>
<th>provided</th>
<th>runtime</th>
<th>test</th>
</tr>
</thead>
<tbody><tr>
<td><strong>compile</strong></td>
<td>compile(*)</td>
<td>-</td>
<td>runtime</td>
<td>-</td>
</tr>
<tr>
<td><strong>provided</strong></td>
<td>provided</td>
<td>-</td>
<td>provided</td>
<td>-</td>
</tr>
<tr>
<td><strong>runtime</strong></td>
<td>runtime</td>
<td>-</td>
<td>runtime</td>
<td>-</td>
</tr>
<tr>
<td><strong>test</strong></td>
<td>test</td>
<td>-</td>
<td>test</td>
<td>-</td>
</tr>
</tbody></table>
<h2 id="Importing-Dependencies"><a href="#Importing-Dependencies" class="headerlink" title="Importing Dependencies"></a>Importing Dependencies</h2><p>The examples in the previous section describe how to specify managed dependencies through inheritance. However, in larger projects it may be impossible to accomplish this <strong>since a project can only inherit from a single parent</strong>. To accommodate this, projects can <strong>import managed dependencies from other projects</strong>. This is accomplished by declaring a <code>pom</code> artifact as a dependency with a scope of <code>import</code>.</p>
<p>Consider the case of a <code>POM</code> file:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># Project X</span><br><span class="line">&lt;project&gt;</span><br><span class="line"> &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"> &lt;groupId&gt;maven&lt;&#x2F;groupId&gt;</span><br><span class="line"> &lt;artifactId&gt;X&lt;&#x2F;artifactId&gt;</span><br><span class="line"> &lt;packaging&gt;pom&lt;&#x2F;packaging&gt;</span><br><span class="line"> &lt;name&gt;X&lt;&#x2F;name&gt;</span><br><span class="line"> &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line"> </span><br><span class="line"> &lt;dependencyManagement&gt;</span><br><span class="line">   &lt;dependencies&gt;</span><br><span class="line">     &lt;dependency&gt;</span><br><span class="line">       &lt;groupId&gt;test&lt;&#x2F;groupId&gt;</span><br><span class="line">       &lt;artifactId&gt;a&lt;&#x2F;artifactId&gt;</span><br><span class="line">       &lt;version&gt;1.1&lt;&#x2F;version&gt;</span><br><span class="line">     &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">     &lt;dependency&gt;</span><br><span class="line">       &lt;groupId&gt;test&lt;&#x2F;groupId&gt;</span><br><span class="line">       &lt;artifactId&gt;b&lt;&#x2F;artifactId&gt;</span><br><span class="line">       &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">       &lt;scope&gt;compile&lt;&#x2F;scope&gt;</span><br><span class="line">     &lt;&#x2F;dependency&gt;</span><br><span class="line">   &lt;&#x2F;dependencies&gt;</span><br><span class="line"> &lt;&#x2F;dependencyManagement&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Then if you would like another project that is not its child to have the <strong><code>&lt;dependencyManagement&gt;</code> configured the same way</strong>, then you would do this:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;project&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">    &lt;groupId&gt;com.sample&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;project1&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;packaging&gt;jar&lt;&#x2F;packaging&gt;</span><br><span class="line"></span><br><span class="line">	&lt;dependencyManagement&gt;</span><br><span class="line">	        &lt;dependencies&gt;</span><br><span class="line">	            &lt;!-- Imports the bill-of-materials POM. --&gt;</span><br><span class="line">	            &lt;dependency&gt;</span><br><span class="line">	                &lt;groupId&gt;maven&lt;&#x2F;groupId&gt;</span><br><span class="line">	                &lt;artifactId&gt;X&lt;&#x2F;artifactId&gt;</span><br><span class="line">	                &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">	                &lt;type&gt;pom&lt;&#x2F;type&gt;</span><br><span class="line">	                &lt;scope&gt;import&lt;&#x2F;scope&gt;</span><br><span class="line">	            &lt;&#x2F;dependency&gt;</span><br><span class="line">	        &lt;&#x2F;dependencies&gt;</span><br><span class="line">	&lt;&#x2F;dependencyManagement&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>If you would like that project to <strong>use the <code>&lt;dependencies&gt;</code> directly</strong> that is specified in the configurations of Project X, then you would do this:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;project&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">    &lt;groupId&gt;com.sample&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;project1&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;packaging&gt;jar&lt;&#x2F;packaging&gt;</span><br><span class="line"></span><br><span class="line">	&lt;dependencyManagement&gt;</span><br><span class="line">	        &lt;dependencies&gt;</span><br><span class="line">	            &lt;!-- Imports the bill-of-materials POM. --&gt;</span><br><span class="line">	            &lt;dependency&gt;</span><br><span class="line">	                &lt;groupId&gt;maven&lt;&#x2F;groupId&gt;</span><br><span class="line">	                &lt;artifactId&gt;X&lt;&#x2F;artifactId&gt;</span><br><span class="line">	                &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">	                &lt;type&gt;pom&lt;&#x2F;type&gt;</span><br><span class="line">	                &lt;scope&gt;import&lt;&#x2F;scope&gt;</span><br><span class="line">	            &lt;&#x2F;dependency&gt;</span><br><span class="line">	        &lt;&#x2F;dependencies&gt;</span><br><span class="line">	&lt;&#x2F;dependencyManagement&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;!-- Add a dependency from the BOM POM.</span><br><span class="line">        Note: no version or scope is required, it&#39;s inherited from the BOM POM! --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;test&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;a&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/05/22/Apache-Manual-md/" data-id="ckai5yba00000ssorfsxh613e" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Git-Summary" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/05/20/Git-Summary/" class="article-date">
  <time datetime="2020-05-20T12:46:25.000Z" itemprop="datePublished">2020-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/05/20/Git-Summary/">Git Manual</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<p><strong>IMPORTANT</strong>:<br>Much of the content here is a personal summary/abbrieviation of contents on the <a href="https://git-scm.com/book/en/v2" target="_blank" rel="noopener">Offical Git Guide</a>. For more complete information, please refer to the offical site.</p>
<hr>
<h2 id="Git-Intro"><a href="#Git-Intro" class="headerlink" title="Git Intro"></a>Git Intro</h2><ul>
<li>Version Control<ul>
<li>Version control is a <strong>system</strong> that records and manages changes for a file or a set of file, so that you could later revert those changes if needed</li>
</ul>
</li>
<li>Why Version Control<ul>
<li>Many default version-control method of choice is to simply copy files into another directory, and renaming them somehow to keep track of the changes</li>
<li>however, this could be inconvenient and error prone</li>
</ul>
</li>
<li>Solutions<ul>
<li>One of the most popular <strong>VCS</strong> tools was a system called <strong>RCS</strong>, which is still distributed with many computers today. <strong>RCS</strong> works by <strong>keeping patch sets</strong> (that is, the differences between files) <strong>in a special format on disk</strong>; it can then re-create what any file looked like at any point in time by adding up all the patches.<ul>
<li><em>Problem</em><ul>
<li>The next major issue that people encounter is that they need to collaborate with developers on other systems.</li>
</ul>
</li>
</ul>
</li>
<li>Centralized Version Control Systems (<strong>CVCSs</strong>) were developed as a solution to the problem above. These systems (such as CVS, Subversion, and Perforce) have <strong>a single server that contains all the versioned files</strong>, and <strong>a number of clients that check out files from that central place</strong>. For many years, this has been the standard for version control.<ul>
<li><em>Advantages</em><ul>
<li>everyone knows to a certain degree what everyone else on the project is doing. Administrators have fine-grained control over who can do what, and it’s far easier to administer a CVCS than it is to deal with local databases on every client.</li>
</ul>
</li>
<li><em>Problems</em><ul>
<li>If that server goes down for an hour, then during that hour nobody can collaborate at all or save versioned changes to anything they’re working on. If the hard disk the central database is on becomes corrupted, and proper backups haven’t been kept, you lose absolutely everything — the entire history of the project except whatever single snapshots people happen to have on their local machines.</li>
</ul>
</li>
</ul>
</li>
<li>Here Distributed Version Control Systems (<strong>DVCSs</strong>) step in. In a DVCS (such as Git, Mercurial, Bazaar or Darcs), clients don’t just check out the latest snapshot of the files; rather, they <strong>fully mirror the repository, including its full history</strong>. Thus, if any server dies, and these systems were collaborating via that server, <strong>any of the client repositories can be copied back up to the server to restore it</strong>. Every clone is really a full backup of all the data.<ul>
<li><em>Advantages</em><ul>
<li>you can collaborate with different groups of people in different ways simultaneously within the same project. This allows you to set up several types of workflows that aren’t possible in centralized systems, such as hierarchical models.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Git-Setup"><a href="#Git-Setup" class="headerlink" title="Git Setup"></a>Git Setup</h2><h2 id="Getting-Help-in-Git"><a href="#Getting-Help-in-Git" class="headerlink" title="Getting Help in Git"></a>Getting Help in Git</h2><p>To get more information about a command in Git, use any of the three below:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git help &lt;verb&gt;</span><br><span class="line">$ git &lt;verb&gt; --help</span><br><span class="line">$ man git-&lt;verb&gt;</span><br></pre></td></tr></table></figure>
<p>It is recommended to use <code>git &lt;verb&gt; --help</code> because it sticks to the pattern of command line code. For example, for a quick refresher on the available options for a Git command, you do <code>git &lt;verb&gt; -h</code></p>
<ul>
<li><em>Notice</em><ul>
<li>Those commands are accessible even offline</li>
</ul>
</li>
</ul>
<h2 id="Git-Basics"><a href="#Git-Basics" class="headerlink" title="Git Basics"></a>Git Basics</h2><ul>
<li><p><strong>Getting a Git Repository</strong><br>This can be done in two ways</p>
<ol>
<li>take a local directory that is currently <strong>not under version control</strong> and turn it into a Git repository</li>
<li><code>clone</code> an existing Git repository from elsewhere</li>
</ol>
<p>Then you will end up with a Git repo on your local machine</p>
</li>
</ul>
<ol>
<li><p>To do achieve the <strong>first option</strong>, you need to first go to the project directory (for Windows):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cd your_path</span><br></pre></td></tr></table></figure>
<p>Then type:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git init</span><br></pre></td></tr></table></figure>
<p>This creates a new subdirectory named <strong>.git</strong> that contains all of your necessary repository files — a Git repository skeleton. At this point, <strong>nothing in your project is tracked yet</strong>.</p>
<p>To start version-controlling, you need to <code>git add</code> your file that you need to control, and then <code>git commit</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git add yourFile1</span><br><span class="line">$ git add yourFile2</span><br><span class="line">$ git commit -m &#39;Initial project version&#39;</span><br></pre></td></tr></table></figure></li>
<li><p>To achieve the <strong>second option</strong>, for example, a project you’d like to contribute to — the command you need is <code>git clone</code>, so that Git receives <strong>a full copy of nearly all data that the server has</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone &lt;url&gt;</span><br></pre></td></tr></table></figure>
<p>For example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git clone https:&#x2F;&#x2F;github.com&#x2F;libgit2&#x2F;libgit2 mylibgit</span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li><p><em>Notice</em></p>
<ul>
<li>you can <code>clone</code> a <strong>Git linkable library</strong> only</li>
<li>The above command will <strong>create a directory named libgit2</strong> under the <strong>current directory</strong>, initializes a .git directory inside it, pulls down all the data for that repository, and checks out a working copy of the latest version. </li>
<li>Git has a number of <strong>different transfer protocols you can use</strong>. The previous example uses the <code>https://</code> protocol, but you may also see <code>git://</code> or <code>user@server:path/to/repo.git</code>, which uses the SSH transfer protocol.</li>
</ul>
<p>If you want to <strong>clone the repository into a directory named something other than libgit2</strong>, you can specify the new directory name as an additional argument:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git clone https:&#x2F;&#x2F;github.com&#x2F;libgit2&#x2F;libgit2 customizedName</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="Recording-Changes"><a href="#Recording-Changes" class="headerlink" title="Recording Changes"></a>Recording Changes</h2><p>Typically, you’ll want to <strong>start making changes</strong> and <strong>committing snapshots of those changes</strong> (i.e. recording/saving those changes) into your repository each time the project reaches a state you want to record.</p>
<p>As you edit files, Git sees them as <strong>modified</strong>, because you’ve changed them since your last commit. As you work, you selectively <strong>stage these modified files</strong> and then <strong>commit/save all those staged changes</strong>, and the cycle repeats.</p>
<ul>
<li><em>Note</em><ul>
<li>Not all files under the directory will be <strong>tracked</strong>, and only <strong>tracked</strong> files will Git know about</li>
<li>once you <code>git add</code> to start your file to start tracking. Then it will be <strong>snapedshotted</strong> if you then call <code>git commit</code></li>
</ul>
</li>
</ul>
<h2 id="Checking-File-Status"><a href="#Checking-File-Status" class="headerlink" title="Checking File Status"></a>Checking File Status</h2><p>The main tool you use to <strong>determine which files are in which state</strong> is the <code>git status</code> command. </p>
<p>For example, if you see:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Your branch is up-to-date with &#39;origin&#x2F;master&#39;.</span><br><span class="line">nothing to commit, working directory clean</span><br></pre></td></tr></table></figure>
<p>A <strong>clean working directory</strong> means <strong>none of your tracked files are modified</strong>.</p>
<ul>
<li><em>Note</em><ul>
<li>this command can also show <strong>untracked</strong> files under the <strong>current directory</strong></li>
<li>if you want to <strong>start tracking</strong> those, you can call <code>git add fileNeedsToBeTracked</code></li>
</ul>
</li>
</ul>
<h2 id="Modifying-a-Tracked-File"><a href="#Modifying-a-Tracked-File" class="headerlink" title="Modifying a Tracked File"></a>Modifying a Tracked File</h2><p>There are three status that a tracked file can be at <strong>after being modified</strong>:</p>
<ol>
<li><strong>Unstaged and uncomitted</strong><ul>
<li>This happens <strong>right after</strong> you have <strong>modified a tracked file</strong>. At this point, if you did not call <code>git add thatFile</code> again, Git will only know about the previous checkpoint.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Changes not staged for commit:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span><br><span class="line">  (use &quot;git restore &lt;file&gt;...&quot; to discard changes in working directory)</span><br><span class="line">        modified:   firstFile.txt</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><strong>Staged but uncommitted</strong><ul>
<li>This happens when you have modified a tracked file and called <code>git add thatFile</code>. Now, <strong>Git knows about it and it is thrown into the staging area</strong><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git restore --staged &lt;file&gt;...&quot; to unstage)</span><br><span class="line">        new file:   LICENSE</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><strong>Staged and committed</strong><ul>
<li>This happens when you call <code>git commit yourFile</code>, so that the <strong>changes move from the stanging area to be saved in your local repository</strong></li>
</ul>
</li>
</ol>
<h2 id="Difference-between-git-add-and-git-commit"><a href="#Difference-between-git-add-and-git-commit" class="headerlink" title="Difference between git add and git commit"></a>Difference between <code>git add</code> and <code>git commit</code></h2><ul>
<li><strong><em>Q: why add and commit as two functions? They seem to be two repeated checkpoint procedures.</em></strong></li>
</ul>
<p>The <code>git add</code> command adds a <strong>change in the working directory to the staging area</strong>. It tells Git that you want to include updates to a particular file in the next commit. However, <code>git add</code> doesn’t really affect the repository in any significant way—changes are not actually recorded until you run git commit.</p>
<p>The command <code>git commit</code> takes <strong>all changes in the Staging Area</strong>, wraps them together and** puts them in your Local Repository<strong>. A commit is simply a checkpoint telling git to track all changes that have occurred up to this point using our last commit as a comparison. **After committing, your Staging Area will be empty</strong>.</p>
<h2 id="Abbreviated-version-for-git-status"><a href="#Abbreviated-version-for-git-status" class="headerlink" title="Abbreviated version for git status"></a>Abbreviated version for <code>git status</code></h2><p>To quickly view which file is at which status, you can execute <code>git status -s</code> to see <strong>each file under the current directory with their status</strong></p>
<p>For example, you could see</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MM LICENSE.txt</span><br><span class="line">AM README.md</span><br><span class="line">M  firstFile.txt</span><br><span class="line">A  justTracked.txt</span><br><span class="line">?? unTracked.txt</span><br></pre></td></tr></table></figure>
<ul>
<li><code>A</code> stands for files just added after <strong>.git</strong> existed or <code>git init</code> was called</li>
<li><code>M</code> stands for files being modified<ul>
<li>a green <code>M</code> (at position 0) means it is <strong>modified and staged</strong></li>
<li>a red <code>M</code> (at position 1, if there is) means it is <strong>modified but unstaged</strong></li>
</ul>
</li>
<li><code>??</code> stands for files <strong>not being tracked</strong> by Git</li>
</ul>
<ul>
<li>[x]<em>Note</em><ul>
<li>Although it is not shown above, but the first letter will be green, and if there is a second letter, it will be red.</li>
</ul>
</li>
</ul>
<h2 id="Ignoring-Files"><a href="#Ignoring-Files" class="headerlink" title="Ignoring Files"></a>Ignoring Files</h2><p>A <strong>gitignore file</strong> specifies intentionally <strong>untracked files</strong> that Git should ignore. Files already tracked by Git are not affected.</p>
<p><strong>Each line in a gitignore file</strong> specifies a pattern. When deciding whether to ignore a path, Git normally checks gitignore patterns from multiple sources, with the following order of precedence, from highest to lowest.</p>
<ol>
<li>First, you need to have/create a <strong>.gitignore</strong> file under the repository. This can be simply done by <code>touch .gitignore</code></li>
<li>Then, you need to add texts to that file to specify rules for ignoring files. This can be done by <code>cat &gt;&gt; .gitgnore</code>, where <code>&gt;&gt;</code> means append. Then you press enter and start typing texts/rules, and when you finish, enter <code>Ctrl-D</code> to save.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cat &gt;&gt; .gitignore</span><br><span class="line">unTracked.txt</span><br><span class="line">*.[oa]</span><br><span class="line">*~</span><br></pre></td></tr></table></figure>
(alternatively, you could use <code>&gt;</code> instead of <code>&gt;&gt;</code>, which will override the content)<br>Now, since <strong>unTracked.txt</strong> was not tracked, it will be ignored and <strong>will not appear</strong> if you execute <code>git status</code></li>
</ol>
<ul>
<li><em>Note</em><ul>
<li><code>*</code> matches anything except a slash</li>
<li><code>?</code> matches any one character except “/“</li>
<li><code>[a-zA-Z]</code>is the range notation, which can be used to match <strong>one of the characters</strong> in a range.</li>
<li><code>!</code> negates a pattern. Put a backslash <code>\</code> in front of the first <code>!</code> for patterns that begin with a literal <code>!</code>, for example, <code>\!important.txt</code></li>
<li><code>**/someDirectory</code> means match in all directories named [someDirectory]. For example, <code>**/foo</code> matches file or directory “foo” anywhere</li>
<li><code>someDirectory/**</code> matches everything <strong>inside [someDirectory]</strong>. For example, <code>abc/**</code> matches all files inside directory [abc], relative to the location of the [.gitignore] file</li>
<li><code>someDirectory/**/otherDirectory</code> matches neted directories between [someDirectory] and [otherDirectory]</li>
</ul>
</li>
</ul>
<h2 id="Knowing-the-Modifications"><a href="#Knowing-the-Modifications" class="headerlink" title="Knowing the Modifications"></a>Knowing the Modifications</h2><ol>
<li><p>By just executing <code>git diff</code> will compare what is in your <strong>working directory</strong> with what is in your <strong>staging area</strong>. The result tells you the <strong>changes you’ve made that you haven’t yet staged</strong>.</p>
<p>For example:  </p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ git diff</span><br><span class="line">warning: LF will be replaced by CRLF in firstFile.txt.</span><br><span class="line">The file will have its original line endings in your working directory</span><br><span class="line">diff --git a&#x2F;firstFile.txt b&#x2F;firstFile.txt</span><br><span class="line">index 640bb73..caada99 100644</span><br><span class="line">--- a&#x2F;firstFile.txt</span><br><span class="line">+++ b&#x2F;firstFile.txt</span><br><span class="line">@@ -1,3 +1,5 @@</span><br><span class="line"> hello</span><br><span class="line"> hello</span><br><span class="line"> hello</span><br><span class="line">+</span><br><span class="line">+aa</span><br></pre></td></tr></table></figure>
<p>The <code>+</code> and <code>+aa</code> lines in the end means those are the lines added to the file, but <strong>not being staged yet.</strong></p>
</li>
<li><p>By executing <code>git diff --staged</code> will compare changes of the files between the <strong>staged</strong> state and the <strong>last edited</strong> state.</p>
<p>For example:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ git diff --staged</span><br><span class="line">diff --git a&#x2F;firstFile.txt b&#x2F;firstFile.txt</span><br><span class="line">index e69de29..640bb73 100644</span><br><span class="line">--- a&#x2F;firstFile.txt</span><br><span class="line">+++ b&#x2F;firstFile.txt</span><br><span class="line">@@ -0,0 +1,3 @@</span><br><span class="line">+hello</span><br><span class="line">+hello</span><br><span class="line">+hello</span><br></pre></td></tr></table></figure>
<p>Notice that the last two lines <code>+</code> and <code>+aa</code> are not present.</p>
</li>
</ol>
<h2 id="Committing-Changes"><a href="#Committing-Changes" class="headerlink" title="Committing Changes"></a>Committing Changes</h2><p>Now if you want to commit to those changes, you can execute <code>git commit</code>. However, this will <strong>only commit changes that are staged</strong>, so <strong>modified yet unstaged</strong> changes will not be recorded.</p>
<p>After executing <code>git commit</code>, it will bring up your editor of choice, which can be chosen when you setup your Git.</p>
<p>For example</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git commit</span><br><span class="line">[master 2031fb7] first commit made</span><br><span class="line"> 4 files changed, 11 insertions(+)</span><br><span class="line"> create mode 100644 LICENSE.txt</span><br><span class="line"> create mode 100644 README.md</span><br><span class="line"> create mode 100644 justTracked.txt</span><br></pre></td></tr></table></figure>

<ul>
<li><em>Note</em><ul>
<li>the <strong>first line will be intentionally made blank</strong>, which is for you to write/describe what has been changed.</li>
<li>you can use the command <code>git commit -v</code> to also have the <strong>difference shown in the editor</strong> as well, so you know exactly what you have done</li>
<li>for a quick commit, you can do <code>git commit -m &quot;yourMessageHere&quot;</code>, which finishes the commit without even opening the editor</li>
<li>you also see which <strong>branch you committed to</strong> (<code>master</code>), what <strong>SHA-1 checksum</strong> the commit has (<code>2031fb7</code>)</li>
</ul>
</li>
</ul>
<p>After you have made a commmit, <strong>all the tracked file will not appear</strong> if you execute <code>git status -s</code></p>
<h2 id="Committing-and-Skipping-the-Staging"><a href="#Committing-and-Skipping-the-Staging" class="headerlink" title="Committing and Skipping the Staging"></a>Committing and Skipping the Staging</h2><p> If you want to skip the staging area, Git provides a simple shortcut. Adding the <code>-a</code> option to the <code>git commit</code> command makes Git automatically <strong>stage every file that is already tracked</strong> before doing the commit, letting you skip the <code>git add</code> part.</p>
<p>Though this is convenient, but be careful; sometimes this flag will cause you to include unwanted changes.</p>
<h2 id="Removing-Tracked-File-Untracking-File"><a href="#Removing-Tracked-File-Untracking-File" class="headerlink" title="Removing Tracked File/ Untracking File"></a>Removing Tracked File/ Untracking File</h2><ul>
<li><p>If you want to <strong>remove a tracked file</strong>, meaning you want to delete the file, you need to execute <code>git rm yourFile</code>. This will:</p>
<ol>
<li>remove the file from the <strong>current working directory</strong></li>
<li>remove the file from the <strong>staging area</strong></li>
</ol>
<p>Now, the <strong>next time you commit</strong>, it will be <strong>no longer tracked</strong> by Git since it will be completely removed.</p>
</li>
<li><p>If you want to <strong>untrack a tracked file</strong>, you execute <code>git rm --cached yourFile</code>. This will keep the file in your directory, but removed from the Git.</p>
<p>Now, same as before, you will still need to execute <code>git commit</code> to complete the removal from the Git</p>
</li>
</ul>
<h2 id="Renaming-a-File"><a href="#Renaming-a-File" class="headerlink" title="Renaming a File"></a>Renaming a File</h2><p>If you rename a file, and wants it still being tracked by Git properly, you should do<br><code>git mv myFile myNewFile</code></p>
<p>Now, if you call <code>git status</code>, you will see:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git mv README.md README</span><br><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Your branch is up-to-date with &#39;origin&#x2F;master&#39;.</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)</span><br><span class="line"></span><br><span class="line">    renamed:    README.md -&gt; README</span><br></pre></td></tr></table></figure>

<p>This is also equivalent of doing seperately three lines:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mv README.md README</span><br><span class="line">$ git rm README.md</span><br><span class="line">$ git add README</span><br></pre></td></tr></table></figure>

<h2 id="Viewing-Commits"><a href="#Viewing-Commits" class="headerlink" title="Viewing Commits"></a>Viewing Commits</h2><p>You can see all commits in a repo by:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git log</span><br></pre></td></tr></table></figure>
<p>By default, with no arguments, <code>git log</code> lists the commits made in that repository in <strong>reverse chronological order</strong></p>
<ul>
<li><p>Useful options for <code>git log</code></p>
<ul>
<li><p><code>git log -p -2</code> will display <strong>2 most recent commits</strong>, and also showing the <strong>patches/changes made</strong></p>
</li>
<li><p><code>git log --stat</code> helps you quickly browse what happened during a series of commits that a collaborator has added. It will show additional information such as: <strong>a list of modified files</strong>, <strong>how many files were changed</strong>, and <strong>how many lines in those files were added and removed</strong>. It also puts a <strong>summary of the information at the end</strong>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ git log --stat</span><br><span class="line">commit cae63d011d113c1d45818de4bec434216e10e9ef (HEAD -&gt; master)</span><br><span class="line">Author: Xiao Yu &lt;jasonyux17@gmail.com&gt;</span><br><span class="line">Date:   Wed May 20 10:59:55 2020 +0800</span><br><span class="line"></span><br><span class="line">    tested git file removal and untracking</span><br><span class="line"></span><br><span class="line"> firstFile.txt   | 6 ------</span><br><span class="line"> justTracked.txt | 0</span><br><span class="line"> 2 files changed, 6 deletions(-)</span><br><span class="line"></span><br><span class="line">commit 0e6428a6389d7748a0da2f0798be94999ce8c248</span><br><span class="line">Author: Xiao Yu &lt;jasonyux17@gmail.com&gt;</span><br><span class="line">Date:   Wed May 20 10:34:31 2020 +0800</span><br><span class="line"></span><br><span class="line">    second commit made</span><br><span class="line"></span><br><span class="line"> firstFile.txt | 1 +</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"></span><br><span class="line">commit 2031fb7fd0a90cf62d1c13d7cfb972e1ce10ad30</span><br><span class="line">Author: Xiao Yu &lt;jasonyux17@gmail.com&gt;</span><br><span class="line">Date:   Wed May 20 10:28:14 2020 +0800</span><br><span class="line"></span><br><span class="line">    first commit made</span><br><span class="line"></span><br><span class="line"> LICENSE.txt     | 5 +++++</span><br></pre></td></tr></table></figure></li>
<li><p><code>git log --pretty=oneline</code> This option <strong>changes the log output to formats</strong> other than the default. A few prebuilt options are available for you to use. The <code>oneline</code> option <strong>prints each commit on a single line</strong>, which is useful if you’re looking at a lot of commits.</p>
</li>
<li><p><code>git log --pretty=format:&quot;%h - %an, %ar : %s&quot;</code> This is customizing the format of the commit output. For example,</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git log --pretty&#x3D;format:&quot;%h - %an - %ar, commit: %s&quot;</span><br><span class="line">cae63d0 - Xiao Yu - 23 minutes ago, commit: tested git file removal and untracking</span><br><span class="line">0e6428a - Xiao Yu - 49 minutes ago, commit: second commit made</span><br><span class="line">2031fb7 - Xiao Yu - 55 minutes ago, commit: first commit made</span><br><span class="line">75d2c61 - Xiao Yu - 18 hours ago, commit: Initial project version</span><br></pre></td></tr></table></figure>
<p>So we can have options such as:</p>
<ul>
<li><code>%h</code> Abbreviated commit hash</li>
<li><code>%an</code> author name</li>
<li><code>%ar</code> author date, relative to now</li>
<li><code>%s</code> subject/commit message</li>
</ul>
</li>
<li><p><code>git log --since=&quot;2008-10-01&quot;</code> Limit the commits to those made after the specified date. You can also put “2.weeks” or “2 years 1 day 3 minutes ago”</p>
</li>
<li><p><code>git log --before=&quot;2008-10-01&quot;</code> Limit the commits to those made before the specified date.</p>
</li>
<li><p><code>git log --author=&quot;Xiao Yu&quot;</code> Only show commits in which the author entry matches the specified string.</p>
</li>
<li><p><code>git log --committer=&quot;Xiao Yu&quot;</code> Only show commits in which the committer entry matches the specified string.</p>
</li>
<li><p><code>git log --no-merges</code> to prevent the display of merge commits cluttering up your log history, which usually are not informative</p>
</li>
</ul>
</li>
</ul>
<h2 id="Changing-your-Staging"><a href="#Changing-your-Staging" class="headerlink" title="Changing your Staging"></a>Changing your Staging</h2><ol>
<li><p>If you forget to do some small changes, but you have just committed, you can easily “re-commit” by</p>
<ul>
<li>first make those additional changes you forgot</li>
<li>then <strong>stage them</strong></li>
<li>then <strong>committ again</strong> using <code>git commit --amend</code> to automatically include the new changes <strong>into the previous commit</strong></li>
</ul>
</li>
<li><p>If you want to “re-stage” a file for making additional changes, you use <code>git restore --staged &lt;file&gt;</code>. In fact, this adviced by the command <code>git status</code> as well:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git restore --staged &lt;file&gt;...&quot; to unstage)</span><br><span class="line">        modified:   README.md</span><br></pre></td></tr></table></figure>
<p>Now, the file [README.md] is unstaged and you can add changes to it and restage.</p>
</li>
</ol>
<h2 id="Changing-Undoing-your-Commit"><a href="#Changing-Undoing-your-Commit" class="headerlink" title="Changing/Undoing your Commit"></a>Changing/Undoing your Commit</h2><p>If you want to <strong>revert the file to its previous committed state</strong> (you cannot revert to those added state),  you have several options to do. You could:</p>
<ol>
<li><p>Run <code>git restore &lt;file&gt;</code>. In fact, this is also adviced by the command <code>git status</code> <strong>if the file is in the unstaged area</strong>. It is usually used for <strong>restoring files in the working tree from either the index or another commit</strong>. This command <strong>does not update your branch</strong>.</p>
</li>
<li><p>Run <code>git reset &lt;commit-id&gt;</code> is about <strong>updating your branch, moving the tip</strong> in order to add or remove commits from the branch</p>
</li>
<li><p>Run <code>git revert</code> which <strong>creates a new commit that undoes the changes from a previous commit</strong>. This command <strong>adds new history to the project</strong> (it doesn’t modify existing history).</p>
</li>
<li><p>Run <code>git checkout &lt;commit-id&gt;</code>. This is the most conservative and prefered by myself. It <strong>first move the HEAD to that commit</strong>, so that you can view changes at that point. However, this will make the <strong>HEAD DETACHED</strong>, because it <strong>does not follow any branch</strong> (in fact, Git will create a temporary branch for you, which will disappear once you switch to other branches), which means that if you do some changes here, they <strong>will not be visible once <code>checkout</code> to other branches</strong>. Therefore, now you will need to run <code>git branch -b &lt;yourBranchName&gt;</code> to create a branch <strong>and attach this <code>DETACHED HEAD</code> to that branch</strong>. Now, everything will be saved if you move around and switch bewteen branches.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> If you use the <code>restore</code> command, <strong>any local changes you made to that file are gon</strong>e — Git just <strong>replaced that file with the most recently-committed version</strong>. Don’t ever use this command unless you absolutely know that you don’t want those unsaved local changes.</li>
</ul>
</blockquote>
<p> If you would like to <strong>keep the changes</strong> you’ve made to that file but <strong>still need to get it out of the way for now</strong>, we’ll go over stashing and branching in <a href="#Git-Branching">Git Branching</a>; these are generally better ways to go.</p>
</li>
</ol>
<h2 id="Working-with-Remotes"><a href="#Working-with-Remotes" class="headerlink" title="Working with Remotes"></a>Working with Remotes</h2><p>To be able to collaborate on any Git project, you need to know how to <strong>manage your remote repositories</strong>. Remote repositories are <strong>versions of your project that are hosted on the Internet or network somewhere</strong>. Managing these remote repositories involves <strong>pushing and pulling data to and from them</strong> when you need to share work.</p>
<ul>
<li>To show the remote server for repo in the current  directory, you can execute <code>git remote</code>, or <code>git remote -v</code> to see the URLs stored as well.</li>
<li>To add a remote server, you can execute <code>git remote add &lt;shortname&gt; &lt;url&gt;</code>, which will configure the <strong>shortname/nickname</strong> for that repo. Then you can <strong>use that shortname to access that repo</strong>.<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> You can only add remote repo in an existing repo</li>
<li><input disabled type="checkbox"> Executing <code>git clone &lt;url&gt;</code> will give you a default shortname of <code>origin</code></li>
</ul>
</blockquote>
</li>
</ul>
<h2 id="Difference-between-git-clone-and-git-remote-add"><a href="#Difference-between-git-clone-and-git-remote-add" class="headerlink" title="Difference between git clone and git remote add"></a>Difference between <code>git clone</code> and <code>git remote add</code></h2><ul>
<li><p><code>git remote add</code> just creates an entry in your git config that specifies a name for a particular URL. You must have an existing git repo to use this. You will not see a folder or any file from that repo. To get them, you need to use <code>git pull &lt;shortname&gt; &lt;branch&gt;</code></p>
</li>
<li><p><code>git clone</code> creates a new git repository by copying an existing one located at the URL you specify. This will be physical.</p>
</li>
</ul>
<h2 id="Fetching-and-Pulling-from-Remote-Repos"><a href="#Fetching-and-Pulling-from-Remote-Repos" class="headerlink" title="Fetching and Pulling from Remote Repos"></a>Fetching and Pulling from Remote Repos</h2><ol>
<li><code>git fetch &lt;remote&gt;</code> This command goes out to that remote project and <strong>pulls down all the data from that remote project that you don’t have yet</strong>. After you do this, you should have references to all the branches from that remote, which you can merge in or inspect at any time (merge operations will be discussed in <a href="#Git-Branching">Git Branching</a>.</li>
<li>If you <strong>cloned a repository</strong>, the command  <code>git fetch origin</code> fetches <strong>any new work that has been pushed to that server</strong> since you cloned (or last fetched from) it<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> <code>git fetch</code> command only <strong>downloads the data to your local repository</strong> — it <strong>doesn’t automatically merge it</strong> with any of your work <strong>or modify what you’re currently working on</strong>. You have to merge it manually into your work when you’re ready</li>
<li><input disabled type="checkbox"> <code>get pull</code> will <strong>fetch and merge the remote branches into your current branch</strong>. More covered in <a href="#Git-Branching">Git Branching</a></li>
</ul>
</blockquote>
</li>
</ol>
<h2 id="Viewing-Changes-After-Fetching"><a href="#Viewing-Changes-After-Fetching" class="headerlink" title="Viewing Changes After Fetching"></a>Viewing Changes After Fetching</h2><p>After you have fetched from your repo with <code>git fetch &lt;remote&gt;</code>, it will automatically update (or create) all the so-called <strong>“remote-tracking branches”</strong> for that remote (if you only want to fetch from a specific branch, you need to run <code>git fetch &lt;remote&gt;/&lt;branchName&gt;</code>).</p>
<p>Now, to see what has been changed, you can use the <code>^</code> or <code>..</code> operator. For example, If you want to see what remote <code>master</code> has compared to your local <code>master</code>, you ask Git to show you exactly this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log &lt;remote&gt;&#x2F;master ^master</span><br></pre></td></tr></table></figure>

<p>which means <strong>all commits reachable from <code>&lt;remote&gt;/master</code> which do not include commits reachable from <code>master</code></strong> or, alternatively</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log master..&lt;remote&gt;&#x2F;master</span><br></pre></td></tr></table></figure>

<h2 id="Pushing-Sharing-to-Your-Remote"><a href="#Pushing-Sharing-to-Your-Remote" class="headerlink" title="Pushing/Sharing to Your Remote"></a>Pushing/Sharing to Your Remote</h2><p>When you have your project at a point that you want to share, you have to push it upstream. The command for this is simple: <code>git push &lt;remote&gt; &lt;branch&gt;</code>. If you want to <strong>push your master branch to your origin server</strong> (again, cloning generally sets up both of those names for you automatically), then you can run this to <strong>push any commits you’ve done</strong> back up to the server:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin master</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> This command works only <strong>if you cloned from a server</strong> to which you <strong>have write access</strong> and <strong>if nobody has pushed in the meantime</strong>. If someone else if pushing, your push will be rejected and you will have to <strong>fetch their work first and incorporate it into yours</strong> before you’ll be allowed to push. </li>
</ul>
</blockquote>
<h2 id="Renaming-or-Removing-Remote-Repo"><a href="#Renaming-or-Removing-Remote-Repo" class="headerlink" title="Renaming or Removing Remote Repo"></a>Renaming or Removing Remote Repo</h2><ol>
<li>If you want to rename a shorthand for a remote repo, you can execute <code>git remote rename &lt;originalName&gt; &lt;newName&gt;</code> to change a remote’s shortname.</li>
<li>If you want to <strong>remove a remote for some reason</strong> — you’ve moved the server or are no longer using a particular mirror, or perhaps a contributor isn’t contributing anymore, you can use <code>git remote remove &lt;shortname&gt;</code></li>
</ol>
<h2 id="Inspecting-a-Remote-for-Pushing-and-Pulling-Information"><a href="#Inspecting-a-Remote-for-Pushing-and-Pulling-Information" class="headerlink" title="Inspecting a Remote for Pushing and Pulling Information"></a>Inspecting a Remote for Pushing and Pulling Information</h2><p>If you want to see more information about a particular remote, you can use the <code>git remote show &lt;remote&gt;</code> command</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ git remote show pb</span><br><span class="line">* remote pb</span><br><span class="line">  Fetch URL: https:&#x2F;&#x2F;github.com&#x2F;paulboone&#x2F;ticgit</span><br><span class="line">  Push  URL: https:&#x2F;&#x2F;github.com&#x2F;paulboone&#x2F;ticgit</span><br><span class="line">  HEAD branch: master</span><br><span class="line">  Remote branches:</span><br><span class="line">    master tracked</span><br><span class="line">    ticgit tracked</span><br><span class="line">  Local ref configured for &#39;git push&#39;:</span><br><span class="line">    master pushes to master (local out of date)</span><br></pre></td></tr></table></figure>
<p>It lists the URL for the remote repository as well as the tracking branch information. The command helpfully tells you that if you’re on the master branch and you run git pull, it will automatically merge in the master branch on the remote after it fetches all the remote references. It also lists all the remote references it has pulled down.</p>
<p>In general, it will show you:</p>
<ul>
<li>which <strong>branch is automatically pushed to when you run <code>git push</code> while on certain branches</strong></li>
<li>which <strong>remote branches on the server you don’t yet have</strong></li>
<li>which <strong>remote branches you have but have been removed from the server</strong></li>
<li>multiple <strong>local branches that are able to merge</strong> automatically with their remote-tracking branch when you run <code>git pull</code></li>
</ul>
<h2 id="Tagging"><a href="#Tagging" class="headerlink" title="Tagging"></a>Tagging</h2><p>Git has the ability to <strong>tag specific points in a repository’s history as being important</strong>. Typically, people use this functionality to mark release points (<code>v1.0</code>, <code>v2.0</code> and so on).</p>
<h2 id="Listing-the-Tags-of-a-Repo"><a href="#Listing-the-Tags-of-a-Repo" class="headerlink" title="Listing the Tags of a Repo"></a>Listing the Tags of a Repo</h2><p>You can list <strong>all the tags</strong> by calling:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git tag</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> this command lists the tags in <strong>alphabetical order</strong>; the order in which they are displayed <strong>has no real importance</strong>.</li>
</ul>
</blockquote>
<p>You can also filter the tags by using the optional <code>-l</code> or <code>--list</code>, for example</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git tag -l &quot;v1.8.5*&quot;</span><br></pre></td></tr></table></figure>
<p>This will list all the tags that *<em>starts with *</em><code>v1.8.5</code></p>
<h2 id="Creating-Tags"><a href="#Creating-Tags" class="headerlink" title="Creating Tags"></a>Creating Tags</h2><p>You can have two types of tags:</p>
<ol>
<li><p>a <strong>lightweight tag</strong></p>
<ul>
<li>it’s just a pointer to a specific commit. It <strong>does not have much information</strong> attached to it. (It does have a <strong>Checksum</strong>, and includes the <strong>author information</strong>) It is often used as a <strong>temporary tag</strong>.</li>
</ul>
</li>
<li><p>an <strong>annotated tag</strong></p>
<ul>
<li>stored as full objects in the Git database. They’re <strong>checksummed</strong>; contain the <strong>tagger name, email, and date; have a tagging message; and can be signed and verified with GNU Privacy Guard (GPG)</strong>. It’s generally recommended that you create annotated tags so you can have all this information</li>
</ul>
</li>
</ol>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Those tags will be attached to the <strong>lastest committed version</strong> of your repo</li>
</ul>
</blockquote>
<h2 id="Creating-a-Lightweight-Tag"><a href="#Creating-a-Lightweight-Tag" class="headerlink" title="Creating a Lightweight Tag"></a>Creating a Lightweight Tag</h2><p> This is basically the commit checksum stored in a file — no other information is kept. To create a lightweight tag, <strong>don’t supply</strong> any of the <code>-a</code>, <code>-s</code>, or <code>-m</code> options, just provide a tag name.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git tag &lt;tag-id&gt;</span><br></pre></td></tr></table></figure>


<h2 id="Creating-an-Annotated-Tag"><a href="#Creating-an-Annotated-Tag" class="headerlink" title="Creating an Annotated Tag"></a>Creating an Annotated Tag</h2><p>This is created by   </p>
<p><code>$ git tag -a &lt;tag-id&gt; -m &quot;yourMessage&quot;</code></p>
<ul>
<li><code>-a</code>, <code>-s</code>, or <code>-u</code> <code>&lt;keyid&gt;</code> is passed, the command <strong>creates a tag object</strong>, and <strong>requires a tag message</strong>. Unless <code>-m &lt;msg&gt;</code> or <code>-F &lt;file&gt;</code> is given, <strong>an editor is started for the user to type in the tag message</strong>.</li>
</ul>
<p>Then to see the message in that tag, use</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git show &lt;tag-id&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Don’t be mistaken to execute <code>git tag show &lt;tag-id&gt;</code>!</li>
</ul>
</blockquote>
<h2 id="Tagging-Previous-Commits"><a href="#Tagging-Previous-Commits" class="headerlink" title="Tagging Previous Commits"></a>Tagging Previous Commits</h2><p>To <strong>tag any specific commit</strong>, you specify the <strong>commit checksum (or part of it)</strong> at the end of the command:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git tag -a &lt;tag-id&gt; -m &quot;yourMessage&quot; &lt;commit-checksum&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Sharing-Tags"><a href="#Sharing-Tags" class="headerlink" title="Sharing Tags"></a>Sharing Tags</h2><p>By default, the <code>git push</code> command <strong>doesn’t transfer tags to remote servers</strong>. You will have to explicitly push tags to a shared server after you have created them. This process is just like sharing remote branches — you can run </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push &lt;repo-shortname&gt; &lt;tagname&gt;</span><br></pre></td></tr></table></figure>
<p>To push <strong>all the tags</strong>, you run</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push &lt;repo-shortname&gt; --tags</span><br></pre></td></tr></table></figure>

<h2 id="Deleting-Tags"><a href="#Deleting-Tags" class="headerlink" title="Deleting Tags"></a>Deleting Tags</h2><p>You can use</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git tag -d &lt;tag-id&gt;</span><br></pre></td></tr></table></figure>
<p>to delete a specific tag. However, this does not remove the tag from the remote servers.</p>
<p>To delete the tag from the server, you could either use:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin --delete &lt;tag-id&gt;</span><br></pre></td></tr></table></figure>
<p>or, the slightly less intuitive command</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin :refs&#x2F;tags&#x2F;v1.4-lw</span><br></pre></td></tr></table></figure>
<p>which means the <strong>null value before the colon</strong> is being pushed to the <strong>remote tag name</strong>, effectively deleting it.</p>
<h2 id="Viewing-Files-at-a-Different-State-using-Tag"><a href="#Viewing-Files-at-a-Different-State-using-Tag" class="headerlink" title="Viewing Files at a Different State using Tag"></a>Viewing Files at a Different State using Tag</h2><p>You can view the different versions of files by using its tag. This is done by a <code>git checkout</code> of that tag, although this puts your repository in “detached HEAD” state, (which has some ill side effects)</p>
<ul>
<li>in a detached-head state, if you <strong>make changes and then create a commit</strong>, the tag will stay the same, but your <strong>new commit won’t belong to any branch and will be unreachable</strong>, except by the exact commit hash. Thus, if you need to make changes — say you’re fixing a bug on an older version, for instance — you will <strong>generally want to create a branch</strong> (covered more in <a href="#Git-Branching">Git Branching</a>)</li>
</ul>
<p><strong><em>Q: What does <code>git checkout</code> mean?</em></strong></p>
<p>If you call <code>git log</code>, you will see something called <code>HEAD</code>. <code>HEAD</code> is a label noting where you are in the <strong>commit tree</strong>. It moves with you when you <strong>move from one commit to another</strong>. <code>git checkout &lt;commit&gt;</code> is the basic mechanism for <strong>moving around in the commit tree, moving your focus (HEAD) to the specified commit</strong>.</p>
<p>The commit can be specified by any of a number of ways, <strong>commit hash</strong>, <strong>branch name</strong>, <strong>tag name</strong>, the relative syntax (HEAD^, HEAD~1, etc.) and so on. (It is often useful to consider a checkout to be changing branches)</p>
<h2 id="Git-Alias"><a href="#Git-Alias" class="headerlink" title="Git Alias"></a>Git Alias</h2><p>Alias can be understood as shortcuts to execute commands. They can be setup by using the <code>git config</code> command.</p>
<p>For example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global alias.co checkout</span><br><span class="line">$ git config --global alias.br branch</span><br><span class="line">$ git config --global alias.ci commit</span><br><span class="line">$ git config --global alias.st status</span><br></pre></td></tr></table></figure>
<p>This means that </p>
<ul>
<li><code>git checkout</code> becomes <code>git co</code></li>
<li><code>git branch</code> becomes <code>git br</code></li>
<li><code>git commit</code> becomes <code>git ci</code></li>
<li><code>git status</code> becomes <code>git st</code></li>
</ul>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> <code>global</code> means access for <strong>one user</strong> (yourself) in <strong>all the repos</strong>. In comparison, <code>local</code> means for <strong>one user</strong> in this <strong>specific repo</strong>. <code>system</code> means for <strong>all users</strong> in <strong>all repos</strong>.</li>
</ul>
</blockquote>
<p>Some useful <strong>alias</strong> include:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global alias.last &#39;log -1 HEAD&#39;</span><br></pre></td></tr></table></figure>
<p>So you can see the last commit easily:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git last</span><br><span class="line">commit e946cadfbd3b378582b0be5e5385a7702d1d10da (HEAD -&gt; master, tag: v1.0)</span><br><span class="line">Author: Xiao Yu &lt;jasonyux17@gmail.com&gt;</span><br><span class="line">Date:   Wed May 20 10:59:55 2020 +0800</span><br><span class="line"></span><br><span class="line">    amended: edited AND deleted file removal and untracking</span><br></pre></td></tr></table></figure>

<h2 id="Resetting-the-Alias"><a href="#Resetting-the-Alias" class="headerlink" title="Resetting the Alias"></a>Resetting the Alias</h2><p>If you find certain alias used before as a bad idea, you can do</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global --unset alias.&lt;yourAlias&gt;</span><br></pre></td></tr></table></figure>

<p>You can also directly edit in the config file to change the alias by:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global --edit</span><br></pre></td></tr></table></figure>

<p>which will open the default text editor and then you can edit your alias directly (delete it if not needed).</p>
<p><a name="Git-Branching"></a></p>
<h2 id="Git-Branching"><a href="#Git-Branching" class="headerlink" title="Git Branching"></a>Git Branching</h2><p> Git doesn’t store data as a series of changesets or differences, but instead as a <strong>series of snapshots</strong>.</p>
<p>When you <strong>make a commit</strong>, Git stores a <strong>commit object that contains a pointer to the snapshot</strong> of the content you staged. This object also contains the author’s name and email address, the message that you typed, and <strong>pointers to the commit or commits that directly came before this commit</strong> (its parent or parents): <strong>zero parents for the initial commit</strong>, <strong>one parent for a normal commit</strong>, and <strong>multiple parents for a commit that results from a merge of two or more branches</strong>.</p>
<ol>
<li>When you staged a file/files<ul>
<li>Staging the files computes a <strong>checksum for each one</strong> (the SHA-1 hash we mentioned in Getting Started)</li>
<li>then <strong>stores that version of the file in the Git repository</strong> (Git refers to them as <strong>blobs</strong>)</li>
<li>finally <strong>adds that checksum to the staging area</strong></li>
</ul>
</li>
<li>When you commit by running <code>git commit</code><ul>
<li>Git <strong>checksums each subdirectory</strong> (in this case, just the root project directory) </li>
<li>stores them as a <strong>tree object</strong> in the Git repository. </li>
<li>Git then creates a commit object that has the metadata and a <strong>pointer to the root project tree</strong> so it can re-create that snapshot when needed.</li>
</ul>
</li>
</ol>
<p>If you had 3 files that were staged, and you committed them, you will get in totl five objects: <strong>three blobs</strong> (each representing the contents of one of the three files), <strong>one tree</strong> that lists the contents of the directory and specifies which file names are stored as which blobs, and <strong>one commit</strong> with the pointer to that root tree and all the commit metadata.</p>
<p>If you make some changes and commit again, the next <strong>commit object</strong> stores a <strong>(parent) pointer</strong> to the <strong>commit object</strong> that came immediately before it. Essentially it is like a linked list of <strong>commit objects</strong>.</p>
<p><strong>A branch in Git is simply a lightweight movable pointer to one of these commits objects</strong>. The default branch name in Git is <strong>master</strong> (default when you run <code>git init</code>). As you start making commits, you’re given a master branch that <strong>points to the last commit you made</strong>. Every time you commit, the master branch pointer moves forward automatically.</p>
<h2 id="Create-a-New-Branch"><a href="#Create-a-New-Branch" class="headerlink" title="Create a New Branch"></a>Create a New Branch</h2><p> Creating a new branch means <strong>creating a new pointer for you to move around</strong>. Let’s say you want to create a new branch called testing. You do this with the git branch command:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git branch &lt;newBranchName&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> this new branch will by default point to the <strong>current commit object (the head)</strong> you are working on.</li>
<li><input disabled type="checkbox"> you can see the head commit object by running <code>git log</code></li>
</ul>
</blockquote>
<h2 id="Switching-Branches"><a href="#Switching-Branches" class="headerlink" title="Switching Branches"></a>Switching Branches</h2><p>To switch to an existing branch, you run the <code>git checkout</code> command. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout &lt;branchName&gt;</span><br></pre></td></tr></table></figure>

<p>For example, if you have another branch called <code>testing</code>, you switch to that by <code>git checkout testing</code>.</p>
<p>This will move the <strong>head</strong> to the <strong>new branch you are at</strong>. This means that now, if you make modifications and commit, you will create a <strong>new commit object that the head/your current branch points to</strong>, but <strong>the other branch still points to the original commit object</strong>.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Now, if you run <code>git log</code>, you will <strong>not see the new commit object that is made by the testing branch</strong>. By default, git log will only show commit history below the branch you’ve checked out.</li>
<li><input disabled type="checkbox"> In general, if you move backward in the tree, you will not be able to see future <strong>commit objects</strong> by running <code>git log</code></li>
<li><input disabled type="checkbox"> To <strong>show commit history for the desired branch</strong> you have to explicitly specify it: <code>git log &lt;branchName&gt;</code>. To <strong>show all of the branches</strong>, run <code>git log --all</code>.</li>
<li><input disabled type="checkbox"> You can actually create a new branch and switching to it at the same time — this can be done in one operation with <code>git checkout -b &lt;newBranchName&gt;</code></li>
</ul>
</blockquote>
<p>However, if you have made some changes in this new branch and <strong>switched back to the old branch</strong>, your current working directory will be <strong>reverted back to the snapshot that old branch points to</strong>. Now, if you make some changes on the old branch, the <strong>two branch will diverge</strong>:</p>
<ul>
<li>the new branch does not know that change made in the old branch</li>
<li>the old branch cannot go forward directly to the new branch because <strong>a commit object</strong> that both shared has been changed now</li>
<li>basically, you will have two different commit objects, one for the <strong>old branch</strong>, and another for the <strong>new branch</strong>, both links to the same parent. </li>
</ul>
<p>But don’t worry, <strong>in the end you can merge them together when you’re ready</strong>.</p>
<hr>
<p><strong>Making a Disaster</strong>:</p>
<ol>
<li>You can create a branch that points to the current <strong>head</strong> position, and then switch to the <strong>master</strong> branch. Then you can move the <strong>head</strong> using the checksum of the first commit by doing <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout &lt;checkSum&gt;</span><br></pre></td></tr></table></figure>
Now, the master head will point to the inital commit. If your friend is also working on this branch, they will be dismayed as thinking somehow all the progress is lost, but in fact it is kept by the other branch that you just created.</li>
</ol>
<hr>
<h2 id="Viewing-the-Diversion-Tree"><a href="#Viewing-the-Diversion-Tree" class="headerlink" title="Viewing the Diversion Tree"></a>Viewing the Diversion Tree</h2><p>The entire tree for all branches can be seen by running</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git log --oneline --graph --all</span><br></pre></td></tr></table></figure>
<p>For example, it can look like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git log --oneline --graph --all</span><br><span class="line">* ae182e6 (HEAD, testing) first commit made now more with the new testing branch</span><br><span class="line">| * e946cad (tag: v1.0, master) amended: edited AND deleted file removal and untracking</span><br><span class="line">| * 0e6428a second commit made</span><br><span class="line">| * 2031fb7 (tag: v0.1) first commit made</span><br><span class="line">|&#x2F;</span><br><span class="line">* 75d2c61 Initial project version</span><br></pre></td></tr></table></figure>
<p>So we see that the two branches are diverged at the first <strong>commit object</strong>.</p>
<h2 id="Merging-Different-Branches"><a href="#Merging-Different-Branches" class="headerlink" title="Merging Different Branches"></a>Merging Different Branches</h2><p>There are basically two cases: </p>
<ol>
<li><p>You have <strong>two diverged branches</strong>, but <strong>they used different files</strong>, or, to put it more suggestively, the <strong>file they shared are the same</strong>. In this case, it is simple for Git to figure out how to merge (basically just putting all the files together), and you run:<br><img src="/.com//05/20/Git-Summary/mergingCase1.png" alt="Picture from git-scm.com, figure 25"></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master</span><br><span class="line">$ git merge testing</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> This means that you are merging files <strong>from the testing branch to the master branch</strong></li>
<li><input disabled type="checkbox"> The merge operation will only be allowed if you have <strong>committed in the testing branch</strong>/current working directory</li>
</ul>
</blockquote>
</li>
<li><p>You have <strong>two diverged branches</strong>, and they <strong>share a file that is modified differently in both branches</strong>. Now, if you want to merge them, Git will show you:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git merge testing</span><br><span class="line">Auto-merging firstFile.txt</span><br><span class="line">CONFLICT (content): Merge conflict in firstFile.txt</span><br><span class="line">Automatic merge failed; fix conflicts and then commit the result.</span><br></pre></td></tr></table></figure>
<p>In this example, [firstFile.txt] is modified for both branches, and they both depend on it. Therefore, the merging cannot be completed, and you will need to <strong>manually edit that file</strong>.</p>
<p>When you finish editing that file, you run <code>git add &lt;thatFile&gt;</code> to <strong>mark it as resolved</strong>, and then call <code>git commit</code> to <strong>complete the merge</strong>.</p>
</li>
</ol>
<p>In the end, when you have finished all the work, you can delete the branch you don’t need by:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git branch -d &lt;branchName&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Branch-Management"><a href="#Branch-Management" class="headerlink" title="Branch Management"></a>Branch Management</h2><p>There are a handful of commands with <code>git branch</code> that is useful for branch management:</p>
<ul>
<li><code>git branch</code> This will show you a list of branches that yuo have, with an asterisk <code>*</code> in front of the current branch you are on.</li>
<li><code>git branch -v</code> Shows you a list of branches with their last commit message </li>
<li><code>git branch --merged</code> shows you branches that have been merged</li>
<li><code>git branch --unmerged</code> shows you branches that have not been merged</li>
</ul>
<blockquote>
<p>Note</p>
<ul>
<li><input disabled type="checkbox"> Each of the command above shows the information <strong>relative to the current branch</strong>. To specify which branch you want to know, you can do, for example, <code>git branch --no-merged testing</code> (to get information <strong>relative to the testing branch</strong>)</li>
</ul>
</blockquote>
<h2 id="Typical-WorkFlow-Using-Git-Branches"><a href="#Typical-WorkFlow-Using-Git-Branches" class="headerlink" title="Typical WorkFlow Using Git Branches"></a>Typical WorkFlow Using Git Branches</h2><p>Usually, people tend to put <strong>code that is entirely stable in their master branch</strong> — possibly only code that has been or will be released. They have another parallel branch named <strong>develop</strong> or <strong>next</strong> that they work from or use to test stability — it isn’t necessarily always stable, but whenever it gets to a <strong>stable state, it can be merged into master</strong>.</p>
<p>  In general, for some larger projects, you will want your branches are at various levels of stability, ordered from most stable top branch (<strong>master</strong>) to the least stable bottom branch(<strong>topic</strong>, for example); when they reach a <strong>more stable level, they’re merged into the branch above them</strong>.</p>
<p><img src="/.com//05/20/Git-Summary/branchManagement.png" alt="picture from https://git-scm.com/book/en/v2/Git-Branching-Branching-Workflows"></p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> It’s important to remember when you’re doing all this that <strong>these branches are completely local</strong>. When you’re branching and merging, <strong>everything is being done only in your Git repository</strong> — there is no communication with the server, for now.</li>
</ul>
</blockquote>
<h2 id="Remote-Branches"><a href="#Remote-Branches" class="headerlink" title="Remote Branches"></a>Remote Branches</h2><p><strong>Remote-tracking branches</strong> are references to the state of remote branches. They’re <strong>local references that you can’t move</strong>; <strong>Git moves them for you whenever you do any network communication</strong>, to make sure they accurately represent the state of the remote repository. Think of them as bookmarks, to remind you where the branches in your remote repositories were the last time you connected to them.</p>
<p><strong>Remote-tracking branch names</strong> take the form <code>&lt;remoteShortName&gt;/&lt;branch&gt;</code>. For instance, if you wanted to see what the <code>master</code> branch on your <code>origin</code> remote looked like as of the last time you communicated with it, you would check the <code>origin/master</code> branch. This means that, if you were working on an issue with a partner and they <strong>pushed up an <code>iss53</code> branch</strong>, but <strong>you also have your own local <code>iss53</code> branch</strong>, the branch on the server would be represented by the remote-tracking branch <code>origin/iss53</code> <strong>updated with your friend’s version</strong></p>
<p>Now, to synchronize your work with a given remote, you run </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git fetch &lt;remoteShortName&gt; command</span><br></pre></td></tr></table></figure>
<p>This command looks up which server “<code>origin</code>” is (for example, it might be cloned from <code>git.ourcompany.com</code>), <strong>fetches any data from it that you don’t yet have</strong>, and updates your local database, moving your <code>origin/master</code> pointer to its new, more up-to-date position, but your <strong>current <code>master</code> pointer is still the same as you were working with</strong>.</p>
<h2 id="Colaborating-with-Multiple-Repos"><a href="#Colaborating-with-Multiple-Repos" class="headerlink" title="Colaborating with Multiple Repos"></a>Colaborating with Multiple Repos</h2><p>Say you have a main repo that you have cloned, with the shortname <code>origin</code> at <code>git.outcompany.com</code>, and you have another team working on that repo as well, with their repo being at <code>git team1.ourcompany.com</code></p>
<p><img src="/.com//05/20/Git-Summary/remoteBranches1.png" alt="Picture from https://git-scm.com/book/en/v2/Git-Branching-Remote-Branches, Figure 33"></p>
<p>You can add their work to your current repo by</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git remote add git.team1.ourcompany.com teamone</span><br></pre></td></tr></table></figure>

<p>Now, you have their repo with the shortname <code>teamone</code>. You can fetch their progress to your local machine by:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git fetch teamone</span><br></pre></td></tr></table></figure>

<p>In this case, since <code>teamone</code> actually didn’t have anything more than the server had, nothing will be fecthed, but you will still obtain a <strong>branch <code>teamone</code> that marks their progress</strong></p>
<p><img src="/.com//05/20/Git-Summary/remoteBranches2.png" alt="Picture from https://git-scm.com/book/en/v2/Git-Branching-Remote-Branches, Figure 34"></p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> At this point, if all you have called is <code>fetch</code>, you will <strong>not have a physical copy of their work on your local machine</strong>, but just a <strong>unmovable pointer</strong>. To get their work to your local machine and work on it, you need to call <code>git merge teamone/master</code> and switch to that, or <code>git checkout -b teamone teamone/master</code>, which creates a new <strong>local branch called <code>teamone</code> that has all the progress on the server of <code>teamone</code></strong>.</li>
</ul>
</blockquote>
<h2 id="Pushing-Your-Branch-to-the-Server"><a href="#Pushing-Your-Branch-to-the-Server" class="headerlink" title="Pushing Your Branch to the Server"></a>Pushing Your Branch to the Server</h2><p> Your <strong>local branches aren’t automatically synchronized</strong> to the remotes you write to — you have to explicitly push the branches you want to share. That way, you can use private branches for work you don’t want to share, and <strong>push up only the topic branches you want to collaborate on</strong>.</p>
<p>To do this, you run:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push &lt;remoteShortName&gt; &lt;yourBranchName&gt;</span><br></pre></td></tr></table></figure>

<p>For example, you want to push up a branch <code>serverfix</code> to the server with shortname <code>origin</code>, you run:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin serverfix</span><br><span class="line">Counting objects: 24, done.</span><br><span class="line">Delta compression using up to 8 threads.</span><br><span class="line">Compressing objects: 100% (15&#x2F;15), done.</span><br><span class="line">Writing objects: 100% (24&#x2F;24), 1.91 KiB | 0 bytes&#x2F;s, done.</span><br><span class="line">Total 24 (delta 2), reused 0 (delta 0)</span><br><span class="line">To https:&#x2F;&#x2F;github.com&#x2F;schacon&#x2F;simplegit</span><br><span class="line"> * [new branch]      serverfix -&gt; serverfix</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> The command <code>git push origin serverfix</code> is a bit of a shortcut. The slightly more complete version is <code>git push origin serverfix:serverfix</code>, which means to <strong>push the <code>serverfix</code> branch of the local machine (left side of colon) to the <code>serverfix</code> branch of the server (right side of colon)</strong>. This means you could also push to have <strong>different names</strong> by <code>git push origin serverfix:anotherNameOnServer</code></li>
</ul>
</blockquote>
<h2 id="Tracking-Branches"><a href="#Tracking-Branches" class="headerlink" title="Tracking Branches"></a>Tracking Branches</h2><p>Checking out a <strong>local branch from a remote-tracking branch automatically creates what is called a “tracking branch”</strong> (and the branch it tracks is called an “upstream branch”). Tracking branches are local branches that have a <strong>direct relationship to a remote branch</strong>. If you’re on a tracking branch and type <code>git pull</code>, Git automatically knows which server to <code>fetch</code> from and which branch to merge in.</p>
<p>For example, when you made a <code>clone</code> from the server with shorthand <code>origin</code>, you made a <strong>tracking branch</strong> with a <strong>master</strong> branch that <strong>tracks</strong> the <strong>origin/master</strong> branch.</p>
<p>In general, when you do</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b &lt;branchName&gt; &lt;remoteShortName&gt;&#x2F;&lt;branchName&gt;</span><br></pre></td></tr></table></figure>

<p>You create a tracking branch of <code>&lt;branchName&gt;</code> tracking the <code>&lt;remoteShortName&gt;/&lt;branchName&gt;</code></p>
<p>In fact, this is so common that you could do the <strong>same thing</strong> by running, more explicitly:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout --track origin&#x2F;serverfix</span><br><span class="line">Branch serverfix set up to track remote branch serverfix from origin.</span><br><span class="line">Switched to a new branch &#39;serverfix&#39;</span><br></pre></td></tr></table></figure>
<p>But this will setup the <strong>same branchname as the branchname on the remote</strong>. If you want to <strong>change the local branchname</strong>, use the first one <code>git checkout -b &lt;branchName&gt; &lt;remoteShortName&gt;/&lt;branchName&gt;</code></p>
<h2 id="Difference-between-git-fetch-and-git-pull"><a href="#Difference-between-git-fetch-and-git-pull" class="headerlink" title="Difference between git fetch and git pull"></a>Difference between <code>git fetch</code> and <code>git pull</code></h2><p><code>git fetch</code> only gets you information on what their progess is, but <strong>does not have a physical copy</strong> of their work. <code>git pull</code> gets you both the information about their progess <strong>and a physical copy on your local machine</strong> of their work on server. </p>
<p><code>git pull</code>  is essentially a <code>git fetch</code> immediately followed by a <code>git merge</code> in most cases. If you <strong>have a tracking branch set up</strong> as demonstrated in the last section, either by explicitly setting it or by having it created for you by the clone or checkout commands, <code>git pull</code> <strong>will look up what server and branch your current branch is tracking</strong>, <strong>fetch from that server and then try to merge in that remote branch for you</strong>.</p>
<h2 id="Viewing-the-Current-Tracking-Branch"><a href="#Viewing-the-Current-Tracking-Branch" class="headerlink" title="Viewing the Current Tracking Branch"></a>Viewing the Current Tracking Branch</h2><p>You can view the current tracking branches by:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git fetch --all</span><br><span class="line">$ git branch -vv</span><br><span class="line">  iss53     7e424c3 [origin&#x2F;iss53: ahead 2] Add forgotten brackets</span><br><span class="line">  master    1ae2a45 [origin&#x2F;master] Deploy index fix</span><br><span class="line">* serverfix f8674d9 [teamone&#x2F;server-fix-good: ahead 3, behind 1] This should do it</span><br><span class="line">  testing   5ea463a Try something new</span><br></pre></td></tr></table></figure>
<p>So here we can see that:</p>
<ul>
<li><code>iss53</code> branch is tracking <code>origin/iss53</code> and is “ahead” by two, meaning that we have <strong>two commits locally that are not pushed to the server</strong>. </li>
<li><code>master</code> branch is tracking <code>origin/master</code> and is up to date. </li>
<li><code>serverfix</code> branch is tracking the <code>server-fix-good</code> branch on our teamone server and is ahead by three and behind by one, meaning that there is <strong>one commit on the server we haven’t merged in</strong> yet and three commits locally that we haven’t pushed. </li>
<li><code>testing</code> branch is <strong>not tracking any remote branch</strong>.<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> We ran <code>git fetch --all</code> before to make sure the <strong>data we have locally about the server is up-to-date</strong>. This means that <code>git branch --vv</code> will only <strong>compare the cached data from the server, and it does not update from the server if there are any changes</strong>.</li>
</ul>
</blockquote>
</li>
</ul>
<h2 id="Switching-a-Tracking-Branch"><a href="#Switching-a-Tracking-Branch" class="headerlink" title="Switching a Tracking Branch"></a>Switching a Tracking Branch</h2><p>If you have a <strong>local branch that you want to track another branch on the server</strong>, you can use the <code>-u</code> or <code>--set-upstream-to</code> option to <code>git branch</code> to explicitly set your <strong>current branch</strong> at any time:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ git branch -u &lt;remoteShortName&gt;&#x2F;&lt;branchName&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Deleting-a-Remote-Branch"><a href="#Deleting-a-Remote-Branch" class="headerlink" title="Deleting a Remote Branch"></a>Deleting a Remote Branch</h2><p>Suppose you’re <strong>done with a remote branch</strong> — say you and your collaborators are finished with a feature and have <strong>merged it into your remote’s master branch</strong> (or whatever branch your stable codeline is in). You can delete a remote branch using the </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push &lt;remoteShortName&gt; --delete &lt;remoteBranchName&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> You don’t need to use <code>--delete &lt;remoteShortName&gt;/&lt;remoteBranchName&gt;</code>, because it is repetitive</li>
<li><input disabled type="checkbox"> This operation <strong>does not remove the branch in the server immediately</strong>. All this does is <strong>remove the pointer from the server</strong>. The Git server will generally keep the data there for a while <strong>until a garbage collection runs</strong>, so if it was accidentally deleted, it’s often easy to recover.</li>
</ul>
</blockquote>
<h2 id="Rebasing"><a href="#Rebasing" class="headerlink" title="Rebasing"></a>Rebasing</h2><p>In Git, there are <strong>two main ways to integrate changes from one branch into another</strong>: the <code>merge</code> and the <code>rebase</code>. </p>
<p>This second operation <code>rebase</code> basically stand from the fact that <code>merge</code> does a three-way-merge, so that in all case, even if two branches had <strong>modification on completely different files</strong>.</p>
<p>So if you <code>rebase</code>, what you want to do is actually this:</p>
<p><img src="/.com//05/20/Git-Summary/rebase1.png" alt="Picture from https://git-scm.com/book/en/v2/Git-Branching-Rebasing, Figure 37"></p>
<p>So, you can take the <strong>patch of the change that was introduced in C4</strong> and <strong>reapply</strong> it on top of C3. With the <code>rebase</code> command, you can take all the changes that were committed on one branch and <strong>replay them on a different branch</strong>.</p>
<p>To place <code>experiment</code> on top of <code>master</code>, you run:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout experiment</span><br><span class="line">$ git rebase master</span><br></pre></td></tr></table></figure>

<p>By <strong>replaying the changes</strong>, it means that this <code>rebase</code> operation does:</p>
<ul>
<li>going to the common ancestor of the two branches (the one you’re on and the one you’re rebasing onto) </li>
<li>getting the <strong>diff introduced by each commit of the branch you’re on</strong>, <strong>saving those diffs</strong> to temporary files, <strong>resetting the current branch to the same commit as the branch you are rebasing onto</strong>, and finally <strong>applying each change in turn</strong></li>
</ul>
<p>Finally, if you want to put your <strong>master</strong> in place of the head of the same branch as <strong>experiment</strong>, you need to switch back to <strong>master</strong> and <strong>merge</strong>. This time, it is guaranteed to have no conflicts because the diversion will be eliminated as the changes are <strong>replayed</strong> and the <strong>ancestors will become the same</strong>.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> The end product from <code>merge</code> and <code>rebase</code> will be the same, but rebasing makes for a <strong>cleaner history</strong>. If you examine the <code>log</code> of a rebased branch, it looks like a <strong>linear history</strong>: it appears that all the work happened in series, even when it originally happened in parallel.</li>
<li><input disabled type="checkbox"> Of course, do not rebase commits that exist outside your repository and that <strong>people may have based work on</strong>, because the changes are applied to that branch and it might <strong>destory their work</strong>.</li>
</ul>
</blockquote>
<h2 id="A-More-Complicated-Rebase"><a href="#A-More-Complicated-Rebase" class="headerlink" title="A More Complicated Rebase"></a>A More Complicated Rebase</h2><p>Conside the case:<br><img src="/.com//05/20/Git-Summary/complicatedRebase.png" alt="Picture from https://git-scm.com/book/en/v2/Git-Branching-Rebasing#rebasing-merging-example, Figure 39"><br>And you want to rebase the <strong>client</strong> branch to go from the <strong>master</strong> branch. This can be done simply using one line:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rebase --onto master server client</span><br></pre></td></tr></table></figure>

<p>This means to take the <strong>client</strong> branch, figure out the <strong>patches since it diverged from the server branch</strong>, and <strong>replay these patches in the client branch as if it was based directly off the master branch instead.</strong></p>
<hr>
<p><strong>Making a Disaster</strong></p>
<hr>
<h2 id="A-Disasterous-Case"><a href="#A-Disasterous-Case" class="headerlink" title="A Disasterous Case"></a>A Disasterous Case</h2><p>Consider if the server side actually <code>rebased</code> their <code>master</code> branch, and your work depends on it, and you did a <code>pull</code>, which automatically <code>merges</code> so it looks like this:<br><img src="/.com//05/20/Git-Summary/rebase2.png" alt="Picture from https://git-scm.com/book/en/v2/Git-Branching-Rebasing#rebasing-merging-example, Figure 46"></p>
<p>However, since we know that <code>C4</code> and <code>C6</code> are deleted/rebased because they are useless, we would also want <code>C4</code> and <code>C6</code> become removed. This can be done by <code>git pull --rebase</code> instead of <code>git pull</code>, which automatically successfully figure out what is <strong>uniquely yours</strong> and apply them back <strong>on top of the new branch</strong>.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> If you are using <code>git pull</code> and want to make <code>--rebase</code> the <strong>default</strong>, you can set the <code>pull.rebase config</code> value with something like <code>git config --global pull.rebase true</code>.</li>
</ul>
</blockquote>
<h2 id="Running-Git-On-Server"><a href="#Running-Git-On-Server" class="headerlink" title="Running Git On Server"></a>Running Git On Server</h2><p>Running a Git server is fairly straightforward. First, you <strong>choose which protocols you want your server to support</strong>. </p>
<p>A <strong>remote repository is generally a bare repository</strong> — a Git repository that has no working directory. Because the repository is only used as a collaboration point, there is no reason to have a snapshot checked out on disk; it’s just the Git data. In the simplest terms, a bare repository is the contents of your project’s <strong>.git directory</strong> and nothing else.</p>
<p>Basically, a <strong>bare repository does not directly contain the actual files and code that you want to edit</strong> on your local machine. However, when you do <code>git clone</code> from it, you will get the progress <strong>and the code</strong> translated from the bare repo on the server to your local machine where you cloned it. Everytime you push changes to the <strong>remote bare repo</strong>, only the <strong>progress information</strong> will be pushed, but there will <strong>still be no actual code files in the remote bare repo</strong></p>
<h2 id="The-Protocals-for-Git-Data-Transfer"><a href="#The-Protocals-for-Git-Data-Transfer" class="headerlink" title="The Protocals for Git Data Transfer"></a>The Protocals for Git Data Transfer</h2><p>Git can use four distinct protocols to transfer data: <strong>Local</strong>, <strong>HTTP</strong>, <strong>Secure Shell</strong> (SSH) and <strong>Git</strong>.</p>
<ol>
<li><p><strong>Local</strong> Protocal</p>
<ul>
<li><p>The most basic is the Local protocol, in which the <strong>remote repository is in another directory on the same host</strong>. This is often used if everyone on your team has access to a shared filesystem such as an NFS mount, or in the less likely case that everyone logs in to the same computer.</p>
</li>
<li><p>Then to clone a local bare repository, you run </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git clone &#x2F;your&#x2F;gitrepo&#x2F;directory.git</span><br></pre></td></tr></table></figure>
<p>Or you can run</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git clone file:&#x2F;&#x2F;&#x2F;your&#x2F;gitrepo&#x2F;directory.git</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Doing it in the first way is a faster transfer process, but it will let Git use <strong>hardlinks</strong> or <strong>directly copy the files it needs</strong>.</li>
<li><input disabled type="checkbox"> Doing it the second way will fire up the processes that Git normally uses to <strong>transfer data over a network</strong>, which is generally much <strong>less efficient</strong>. The main reason to specify the <code>file://</code> prefix is if you want a <strong>clean copy of the repository with extraneous references or objects left out</strong></li>
</ul>
</blockquote>
</li>
</ul>
</li>
<li><p><strong>HTTP</strong> Protocols</p>
<ul>
<li>Smart HTTP<ul>
<li>Smart HTTP operates very similarly to the SSH or Git protocols but runs over standard HTTPS ports and can use various HTTP authentication mechanisms, meaning it’s often easier on the user than something like SSH, since <strong>you can use things like username/password authentication rather than having to set up SSH keys</strong>.</li>
<li>This has become the most popilar way to use Git now, and in fact, for services like GitHub, <strong>the URL you use to view the repository online</strong> (for example, <a href="https://github.com/schacon/simplegit" target="_blank" rel="noopener">https://github.com/schacon/simplegit</a>) <strong>is the same URL you can use to clone and, if you have access, push over</strong>.</li>
</ul>
</li>
<li>Dumb HTTP<ul>
<li>If the server does not respond with a Git HTTP smart service, the Git client will try to fall back to the simpler Dumb HTTP protocol. The <strong>Dumb protocol expects the bare Git repository to be served like normal files from the web server</strong>. The beauty of Dumb HTTP is the <strong>simplicity of setting it up</strong>. Basically, all you have to do is <strong>put a bare Git repository under your HTTP document root and set up a specific post-update hook, and you’re done</strong> (See Git Hooks). </li>
</ul>
</li>
</ul>
</li>
<li><p><strong>SSH</strong> Protocal</p>
<ul>
<li><p>A common transport protocol for Git when self-hosting is over SSH. This is because SSH access to servers is already set up in most places — and if it isn’t, it’s easy to do. SSH is also an authenticated network protocol and, because it’s ubiquitous, it’s generally easy to set up and use.</p>
</li>
<li><p>To clone a Git repository over SSH, you can specify an <code>ssh:// URL</code> like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git clone ssh:&#x2F;&#x2F;[user@]server&#x2F;project.git</span><br></pre></td></tr></table></figure>
<p>Or you can use the shorter scp-like syntax for the SSH protocol:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git clone [user@]server:project.git</span><br></pre></td></tr></table></figure>

<p>In both cases above, if you don’t specify the optional <code>&lt;username&gt;</code>, Git assumes the user you’re currently logged in as ?.</p>
<blockquote>
<p>Note</p>
<ul>
<li><input disabled type="checkbox"> A negative aspect of SSH is that it <strong>doesn’t support anonymous access to your Git repository</strong>. If you’re using SSH, people <strong>must have SSH access to your machine</strong>, even in a read-only capacity, which doesn’t make SSH conducive to open source projects for which people might simply want to clone your repository to examine it.</li>
</ul>
</blockquote>
</li>
</ul>
</li>
<li><p><strong>Git Protocal</strong></p>
<ul>
<li><p>Finally, we have the Git protocol. This is a special daemon that comes packaged with Git; it listens on a dedicated port (9418) that provides a service similar to the SSH protocol, but with <strong>absolutely no authentication</strong>. In order for a repository to be served over the Git protocol, you <strong>must create a <code>git-daemon-export-ok</code> file</strong> — the daemon won’t serve a repository without that file in it — but, other than that, there is <strong>no security</strong>. Either the Git repository is available for everyone to <code>clone</code>, or it isn’t. This is means that <strong>it will be read-only for either everyone or no-one.</strong> </p>
</li>
<li><p>However, you can also setup <strong>push access</strong>, but, this means that, given the lack of authentication, it will be <strong>pushable for everyone or no-one on the internet</strong>.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> It is the fastest network transfer protocal available currently. It uses the same data-transfer mechanism as the SSH protocol <strong>but without the encryption and authentication overhead</strong>. </li>
<li><input disabled type="checkbox"> It’s generally undesirable for the Git protocol to be the only access to your project. <strong>Generally, you’ll pair it with SSH or HTTPS access for the few developers who have push (write) access and have everyone else use <code>git://</code> for read-only access</strong>. It’s also probably the most difficult protocol to set up. It must run its own daemon, which requires xinetd or systemd configuration or the like, which isn’t always a walk in the park. </li>
</ul>
</blockquote>
</li>
</ul>
</li>
</ol>
<h2 id="Setting-up-Git-on-a-Server"><a href="#Setting-up-Git-on-a-Server" class="headerlink" title="Setting up Git on a Server"></a>Setting up Git on a Server</h2><h2 id="Setting-up-an-Existing-Git-Repo-on-Github"><a href="#Setting-up-an-Existing-Git-Repo-on-Github" class="headerlink" title="Setting up an Existing Git Repo on Github"></a>Setting up an Existing Git Repo on Github</h2><ol>
<li><p>First you need to decide which protocal to use. Github provides two protocals: HTTP and SSH, which you can get when you see the <code>Quick Setup</code> tab or when you are inside the repo with the <code>Clone or Download</code>.</p>
</li>
<li><p>Then, you navigate to your existing repo in your Git Bash, and add the remote repo by:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git remote add &lt;remoteShortName&gt; &lt;remoteURLYouJustCopied&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>Then you can push any of your branch in your local repo to the remote repo by:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push &lt;remoteShortName&gt; &lt;localBranchName:remoteBranchName&gt;</span><br></pre></td></tr></table></figure>
<p> If the <remoteBranchName> is the same as your <localBranchName>, then you can just</localBranchName></remoteBranchName></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push &lt;remoteShortName&gt; &lt;localBranchName&gt;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="Distributed-WorkFlows"><a href="#Distributed-WorkFlows" class="headerlink" title="Distributed WorkFlows"></a>Distributed WorkFlows</h2><p> The aim for these flows is how to contribute code successfully to a project and make it <strong>as easy on you and the project maintainer as possible</strong>, and also how to <strong>maintain a project successfully with a number of developers contributing</strong>.</p>
<p> In general, due to the flexibility of Git, it presents <strong>a vast range of workflow possibilities for your project and/or your team</strong>, so we’ll cover a few common paradigms that take advantage of this flexibility.</p>
<ol>
<li><p><strong>Centralized Workflow</strong><br><img src="/.com//05/20/Git-Summary/centralized_workflow.png" alt="Picture from https://git-scm.com/book/en/v2/Distributed-Git-Distributed-Workflows, Figure 54"></p>
<p> This means that if two developers clone from the hub and both make changes, <strong>the first developer to push their changes back up can do so with no problems</strong>. The <strong>second developer must merge</strong> in the first one’s work before pushing changes up, so as not to overwrite the first developer’s changes.    </p>
</li>
<li><p><strong>Integration-Manager Workflow</strong><br>Because Git allows you to have multiple remote repositories, it’s possible to have a workflow where each developer has <strong>write access to their own public repository</strong> and <strong>read access to everyone else’s</strong>. </p>
<p> <img src="/.com//05/20/Git-Summary/integration-manager.png" alt="Picture from https://git-scm.com/book/en/v2/Distributed-Git-Distributed-Workflows, Figure 55"></p>
<p> This scenario often includes a <strong>canonical repository that represents the “official” project</strong>. To contribute to that project, you <strong>create your own public clone</strong> of the project and push your changes to it. Then, you can send a <strong>request to the maintainer of the main project to pull in your changes</strong>. The maintainer can then add your repository as a remote, <strong>test your changes locally</strong>, <strong>merge them into their branch</strong>, and <strong>push back to their repository</strong>. </p>
<ol>
<li>The project maintainer/manager pushes to their public/blessed repository.</li>
<li>A contributor/developer clones that repository and makes changes.</li>
<li>The contributor/developer pushes to their own public repository.</li>
<li>The contributor/developer sends the maintainer an email asking them to pull changes.</li>
<li>The maintainer/manager adds the contributor/developer’s repository as a remote and merges locally.</li>
<li>The maintainer/manager pushes merged changes to the main repository.</li>
</ol>
</li>
</ol>
<h2 id="Commit-Guidelines"><a href="#Commit-Guidelines" class="headerlink" title="Commit Guidelines"></a>Commit Guidelines</h2><p>Having a good guideline for <strong>creating commits and sticking to it</strong> makes working with Git and collaborating with others a lot easier. The Git project provides a document that lays out a number of good tips for creating commits from which to submit patches — you can read it in the Git source code in the <code>Documentation/SubmittingPatches</code> file</p>
<ul>
<li><p>Do <strong>not commit/make whitespace changes</strong> (i.e. adding meaningless whitespaces into the program and committing those as changes). This can be easily detected by running</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git diff</span><br></pre></td></tr></table></figure></li>
<li><p>Try to make <strong>each commit a logically separate changeset</strong>. If you can, try to make your <strong>changes digestible</strong> — don’t code for a whole weekend on five different issues and then submit them all as one massive commit on Monday. Even if you don’t commit during the weekend, use the staging area on Monday to split your work into at least one commit per issue, with a <strong>useful message per commit</strong>.</p>
</li>
<li><p>Creating <strong>quality commit messages</strong> makes using and collaborating with Git a lot easier. <strong>As a general rule</strong>, your messages should start with a single line that’s no more than about 50 characters and that describes the changeset concisely, followed by a blank line, followed by a more detailed explanation. (The <strong>Git project requires that the more detailed explanation include your motivation for the change and contrast its implementation with previous behavior</strong> — this is a good guideline to follow. Write your <strong>commit message in the imperative</strong>: “Fix bug” and not “Fixed bug” or “Fixes bug.”)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">CAPITALIZED, short (50 chars or less) summary</span><br><span class="line"></span><br><span class="line">More detailed explanatory text, if necessary.  Wrap it to about 72</span><br><span class="line">characters or so.  In some contexts, the first line is treated as the</span><br><span class="line">subject of an email and the rest of the text as the body.  The blank</span><br><span class="line">line separating the summary from the body is critical (unless you omit</span><br><span class="line">the body entirely); tools like rebase can get confused if you run the</span><br><span class="line">two together.</span><br><span class="line"></span><br><span class="line">Write your commit message in the imperative: &quot;Fix bug&quot; and not &quot;Fixed bug&quot;</span><br><span class="line">or &quot;Fixes bug.&quot;  This convention matches up with commit messages generated</span><br><span class="line">by commands like git merge and git revert.</span><br><span class="line"></span><br><span class="line">Further paragraphs come after blank lines.</span><br><span class="line"></span><br><span class="line">- Bullet points are okay, too</span><br><span class="line"></span><br><span class="line">- Typically a hyphen or asterisk is used for the bullet, followed by a</span><br><span class="line">  single space, with blank lines in between, but conventions vary here</span><br><span class="line"></span><br><span class="line">- Use a hanging indent</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="Branch-Naming"><a href="#Branch-Naming" class="headerlink" title="Branch Naming"></a>Branch Naming</h2><p>Sometimes, the maintainer of the Git project tends to <strong>namespace these branches</strong> — such as <code>sc/ruby_client</code>, where <code>sc</code> is short for the person who contributed the work, and <code>ruby_client</code> is the branch the person worked on. </p>
<p>Therefore, it is sometimes a good idea to format your branchname to:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b &lt;yourNickName&#x2F;descriptiveBranchName&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Forking-a-Project"><a href="#Forking-a-Project" class="headerlink" title="Forking a Project"></a>Forking a Project</h2><p>Sometimes you want to work with a project that you do <strong>not have open push access to</strong>, but you might have the <strong>fork</strong> option, which allows you to <strong>clone the repo at least</strong>.</p>
<p>In this case, if you want to add some feature to the project, say <code>featureA</code>, you could:</p>
<ol>
<li><strong>clone the project to your local machine</strong></li>
<li>create a new branch <code>featureA</code> and work on it</li>
<li>create your <strong>own remote repo</strong> of the same project by <strong>forking that project</strong></li>
<li><strong>push changes</strong> (preferably <strong>just the branch you edited</strong>, because if the change is <code>cherry-picked</code> or rejected, you don’t need to do too much rewindings) <strong>to your own remote repo that your forked</strong></li>
<li>Now you need to <strong>notify the maintainers of the original project that you have work you’d like them to merge</strong>. This is often called a <strong>pull request</strong>, and you typically generate such a request either via the website — <strong>GitHub has its own “Pull Request” mechanism</strong> — or you can run the <code>git request-pull</code> command and email the subsequent output to the project maintainer manually.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git request-pull &lt;targetRemoteShortName&gt;&#x2F;&lt;targetBranch&gt; &lt;myRemote&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> To keep your forked project up-to-date, you could add another <code>upstream</code> remote to your local forked repo. Then, to update your local <code>master</code> branch with what the server has, you can run <code>git fetch upsteam/master</code> and then <code>checkout</code> to your local <code>master</code>, run <code>git merge upstream/master</code> to merge in the new changes</li>
</ul>
</blockquote>
</li>
</ol>
<h2 id="Difference-bewtween-git-merge-squash-and-git-rebase"><a href="#Difference-bewtween-git-merge-squash-and-git-rebase" class="headerlink" title="Difference bewtween git merge --squash and git rebase"></a>Difference bewtween <code>git merge --squash</code> and <code>git rebase</code></h2><p>Sometimes, when there where quite a lot of updates in the server’s <code>master</code> branch, and you would like your new changes to be based on the latest commit/change made, you would either do a <code>rebase</code> or your <code>featureA</code> branch to be directly off from the latest <code>&lt;remoteRepo&gt;/master</code> branch, or you could do a <code>merge --squash</code>.</p>
<ul>
<li>doing a <code>rebase</code> would produce a cleaner history by actually moving your branch to continue off from the <code>&lt;remoteRepo&gt;/master</code> branch. This means it deletes the your original diverged branch and places it newly there.</li>
<li>doing a <code>merge --squash</code> would <strong>not delete your original diverged branch</strong>, <strong>and base it off from the lastest <code>&lt;remoteRepo&gt;/master</code> branch</strong>. It does <strong>not delete the divergent history</strong>. This works by <strong>squashing all your changes/commit objects in your divergent branch to a single one</strong>, and puts it at the tip of the <code>&lt;remoteRepo&gt;/master</code> branch.</li>
</ul>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> After you do a <code>git merge --squash &lt;targetBranch&gt;</code>, you need to *<em>call another <code>git commit</code> *</em>manually to finish the change.</li>
</ul>
</blockquote>
<h2 id="Nofifying-Changes-via-Email"><a href="#Nofifying-Changes-via-Email" class="headerlink" title="Nofifying Changes via Email"></a>Nofifying Changes via Email</h2><p>Sometimes, some projects might accept patches via a developer <strong>mailing list instead of pull requests</strong>. In this case, you need to mail your changes by:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git format-patch -M &lt;remoteShortName&gt;&#x2F;master</span><br></pre></td></tr></table></figure>
<p>For example</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git format-patch -M testRepo&#x2F;master</span><br><span class="line">0001-TESTING-EMAIL-PATCH.patch</span><br></pre></td></tr></table></figure>

<ul>
<li>The <code>git format-patch</code> is used to generate the mbox-formatted files that you can email to the list.</li>
</ul>
<p>This will create a <strong>patch file</strong> under your current directory, which will look like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ cat 0001-TESTING-EMAIL-PATCH.patch</span><br><span class="line">From 41d19b4ea8be07b026f28cd4052bfdbc4a2f38b0 Mon Sep 17 00:00:00 2001</span><br><span class="line">From: Xiao Yu &lt;jasonyux17@gmail.com&gt;</span><br><span class="line">Date: Thu, 21 May 2020 17:53:36 +0800</span><br><span class="line">Subject: [PATCH] TESTING EMAIL PATCH</span><br><span class="line"></span><br><span class="line">Created a new file for testing to send an email patch.</span><br><span class="line">---</span><br><span class="line"> newFileTestingEmailPatch.txt | 0</span><br><span class="line"> 1 file changed, 0 insertions(+), 0 deletions(-)</span><br><span class="line"> create mode 100644 newFileTestingEmailPatch.txt</span><br><span class="line"></span><br><span class="line">diff --git a&#x2F;newFileTestingEmailPatch.txt b&#x2F;newFileTestingEmailPatch.txt</span><br><span class="line">new file mode 100644</span><br><span class="line">index 0000000..e69de29</span><br><span class="line">--</span><br><span class="line">2.26.2.windows.1</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> If you want to edit some writings. you can also <strong>edit text between the — line and the beginning of the patch (the diff –git line)</strong>, if you <strong>don’t want them to show up in the commit message</strong>, so that the developers can read it, but that content is ignored by the patching process.</li>
</ul>
</blockquote>
<p>To email this to a mailing list, you can <strong>either paste the file into your email</strong> program or <strong>send it via a command-line program</strong>. Pasting the text often causes formatting issues, especially with “smarter” clients that don’t preserve newlines and other whitespace appropriately.</p>
<ol>
<li><p>Sending it via commandline through an <strong>IMAP</strong> server</p>
<ul>
<li><p>You will need to navigate to your <code>~/.gitconfig</code> file and add those lines in the end of the file:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[imap]</span><br><span class="line">  folder &#x3D; &quot;[Gmail]&#x2F;Drafts&quot;</span><br><span class="line">  host &#x3D; imaps:&#x2F;&#x2F;imap.gmail.com</span><br><span class="line">  user &#x3D; user@gmail.com</span><br><span class="line">  pass &#x3D; YX]8g76G_2^sFbd</span><br><span class="line">  port &#x3D; 993</span><br><span class="line">  sslverify &#x3D; false</span><br></pre></td></tr></table></figure>
<p>If your IMAP server <strong>doesn’t use SSL</strong>, the last two lines probably aren’t necessary, and the host value will be <code>imap://</code> instead of <code>imaps://</code>. When that is set up, you can use <code>git imap-send</code> to place the patch series in the Drafts folder of the specified IMAP server:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ cat *.patch | git imap-send</span><br><span class="line">Resolving imap.gmail.com... ok</span><br><span class="line">Connecting to [74.125.142.109]:993... ok</span><br><span class="line">Logging in...</span><br><span class="line">sending 2 messages</span><br><span class="line">100% (2&#x2F;2) done</span><br><span class="line">At this point, you should be able to go to your Drafts folder, change the To field to the mailing list you’re sending the patch to, possibly CC the maintainer or person responsible for that section, and send it off.</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>Sending through a <strong>SMTP</strong> server</p>
<ul>
<li><p>Similary, you will need to edit the <code>~/.gitconfig</code> file to add in the end:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[sendemail]</span><br><span class="line">  smtpencryption &#x3D; tls</span><br><span class="line">  smtpserver &#x3D; smtp.gmail.com</span><br><span class="line">  smtpuser &#x3D; user@gmail.com</span><br><span class="line">  smtpserverport &#x3D; 587</span><br></pre></td></tr></table></figure>

<p>After this is done, you can use git send-email to send your patches:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git send-email *.patch</span><br><span class="line">0001-add-limit-to-log-function.patch</span><br><span class="line">0002-increase-log-output-to-30-from-25.patch</span><br><span class="line">Who should the emails appear to be from? [Jessica Smith &lt;jessica@example.com&gt;]</span><br><span class="line">Emails will be sent from: Jessica Smith &lt;jessica@example.com&gt;</span><br><span class="line">Who should the emails be sent to? jessica@example.com</span><br><span class="line">Message-ID to be used as In-Reply-To for the first email? y</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ol>
<h2 id="Maintaining-a-Project"><a href="#Maintaining-a-Project" class="headerlink" title="Maintaining a Project"></a>Maintaining a Project</h2><p>Basically, your aim is to <strong>accept work in a way that is clearest for other contributors and sustainable</strong> by you over the long run.</p>
<p>Maintaining using patches from email</p>
<ul>
<li>basically, you need to run <code>git apply</code> for a <strong><code>git diff</code> formatted object</strong>, or <code>git am</code> for a <strong><code>patch</code> formatted object</strong>.</li>
</ul>
<h2 id="Using-git-apply"><a href="#Using-git-apply" class="headerlink" title="Using git apply"></a>Using <code>git apply</code></h2><p>If you received the patch from someone who <strong>generated it with <code>git diff</code> or some variation of the Unix diff command</strong> (which is not recommended; see the next section), you can <strong>apply it with the git apply command</strong>. Assuming you saved the patch at <code>/tmp/patch-ruby-client.patch</code>, you can apply the patch like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git apply &#x2F;tmp&#x2F;patch-ruby-client.patch</span><br></pre></td></tr></table></figure>
<p> This will also <strong>handle file adds, deletes, and renames</strong> if they’re <strong>described in the <code>git diff</code></strong> format, which <strong>patch won’t</strong> do. Finally, <code>git apply</code> is an <strong>“apply all or abort all”</strong> model where either everything is applied or nothing is, whereas <code>git am</code> for <code>patch</code> can <strong>partially apply</strong> patchfiles, leaving your working directory in a weird state. <code>git apply</code> is overall much more conservative than patch. </p>
<p>However, you can use <code>git apply --check</code>, for example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git apply --check 0001-see-if-this-helps-the-gem.patch</span><br></pre></td></tr></table></figure>

<p>To <strong>check</strong> if a <code>patch</code> applies cleanly to <strong>your working directory</strong>. If there is no output, then the patch should apply cleanly. </p>
<h2 id="Using-git-am"><a href="#Using-git-am" class="headerlink" title="Using git am"></a>Using <code>git am</code></h2><p>To apply a <code>patch</code> generated by <code>format-patch</code>, you use <code>git am</code> (the command is named am as it is used to “apply a series of patches from a mailbox”).</p>
<ul>
<li><p>if someone <strong>emailed you the patch properly using <code>git send-email</code></strong>, namely the content of the patch being the mail content + subject title, and you <strong>download that into an mbox format</strong>, then you can point <code>git am</code> to that <strong>mbox file</strong>, and it will start applying all the patches it sees.</p>
</li>
<li><p>if someone uploaded a <strong>patch file</strong> generated via <code>git format-patch</code> to a ticketing system or something similar, you can save the file locally and then <strong>pass that file saved on your disk</strong> to <code>git am</code> to apply it</p>
</li>
</ul>
<p>However, it’s possible that the <strong>patch won’t apply cleanly</strong>. Perhaps your main branch has diverged too far from the branch the patch was built from, or the patch depends on another patch you haven’t applied yet. In that case, the <code>git am process</code> <strong>will fail and ask you what you want to do</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git am 0001-see-if-this-helps-the-gem.patch</span><br><span class="line">Applying: See if this helps the gem</span><br><span class="line">error: patch failed: ticgit.gemspec:1</span><br><span class="line">error: ticgit.gemspec: patch does not apply</span><br><span class="line">Patch failed at 0001.</span><br><span class="line">When you have resolved this problem run &quot;git am --resolved&quot;.</span><br><span class="line">If you would prefer to skip this patch, instead run &quot;git am --skip&quot;.</span><br><span class="line">To restore the original branch and stop patching run &quot;git am --abort&quot;.</span><br></pre></td></tr></table></figure>

<p>This command puts conflict <strong>markers in any files it has issues with</strong>, much like a conflicted merge or rebase operation. You solve this issue much the same way — <strong>edit the file to resolve the conflict</strong>, stage the new file, and then run <code>git am --resolved</code> to <strong>continue to the next patch in the series of patches that you haven’t  yet completed</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ (fix the file)</span><br><span class="line">$ git add ticgit.gemspec</span><br><span class="line">$ git am --resolved</span><br><span class="line">Applying: See if this helps the gem</span><br></pre></td></tr></table></figure>

<h2 id="Managing-Using-the-Remote-Branches"><a href="#Managing-Using-the-Remote-Branches" class="headerlink" title="Managing Using the Remote Branches"></a>Managing Using the Remote Branches</h2><p>If your contribution came from a Git user who set up their own repository, pushed a number of changes into it, and then <strong>sent you the URL to the repository and the name of the remote branch the changes are in</strong>, you can <strong>add them as a remote and do merges locally</strong>.</p>
<p>For example, if a developer named Jessica sends you an email saying that she has a great <strong>new feature</strong> in the <strong><code>ruby-client</code> branch</strong> of <strong>her repository</strong>, you can test it by adding the remote and <strong>checking out that branch locall</strong>y:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git remote add jessica git:&#x2F;&#x2F;github.com&#x2F;jessica&#x2F;myproject.git</span><br><span class="line">$ git fetch jessica</span><br><span class="line">$ git checkout -b rubyclient jessica&#x2F;ruby-client</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> You do a <code>fetch</code> here <strong>instead of a direct <code>pull</code></strong> because you might not want to automatically merge her work into any of your branch. You might want to see if her work functions properly before you run <code>merge</code>.</li>
</ul>
</blockquote>
<p>However, if you aren’t working with a person consistently but do something like a one-time pull, you can use the URL of their remote repository to the <code>git pull</code> command. This does a one-time pull and <strong>doesn’t save the URL as a remote reference</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git pull https:&#x2F;&#x2F;github.com&#x2F;onetimeguy&#x2F;project</span><br><span class="line">From https:&#x2F;&#x2F;github.com&#x2F;onetimeguy&#x2F;project</span><br><span class="line"> * branch            HEAD       -&gt; FETCH_HEAD</span><br><span class="line">Merge made by the &#39;recursive&#39; strategy.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Here the command <code>git pull https://github.com/onetimeguy/project</code> <strong>pulls in all the progress to your current branch</strong>. If you just want to <strong>pull a specific branch</strong>, remember to add the option of the <branchname> like this <code>git pull https://github.com/onetimeguy/project &lt;remoteBranchName&gt;</code></branchname></li>
</ul>
</blockquote>
<h2 id="Determining-What-is-Changed"><a href="#Determining-What-is-Changed" class="headerlink" title="Determining What is Changed"></a>Determining What is Changed</h2><p>Now you have a <strong><code>topic</code> branch that contains contributed work</strong>. At this point, you can determine what you’d like to do with it. This section revisits a couple of commands so you can see <strong>exactly what you’ll be introducing if you merge this</strong> into your main branch.</p>
<ol>
<li><p>to see <strong>only commits that are different</strong> between the <code>topic</code> branch and your <code>master</code> branch (for example), you could run </p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git log &lt;branch1&gt; --not &lt;branch2&gt;</span><br></pre></td></tr></table></figure>

<p> In this example:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ git log topic --not master</span><br><span class="line">commit 5b6235bd297351589efc4d73316f0a68d484f118</span><br><span class="line">Author: Scott Chacon &lt;schacon@gmail.com&gt;</span><br><span class="line">Date:   Fri Oct 24 09:53:59 2008 -0700</span><br><span class="line"></span><br><span class="line">    See if this helps the gem</span><br><span class="line"></span><br><span class="line">commit 7482e0d16d04bea79d0dba8988cc78df655f16a0</span><br><span class="line">Author: Scott Chacon &lt;schacon@gmail.com&gt;</span><br><span class="line">Date:   Mon Oct 22 19:38:36 2008 -0700</span><br><span class="line"></span><br><span class="line">    Update gemspec to hopefully work better</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note</p>
<ul>
<li><input disabled type="checkbox"> To see what <strong>changes each commit introduces</strong>, remember that you can pass the <code>-p</code> option to <code>git log</code> and it will <strong>append the <code>diff</code> introduced to each commit</strong>.</li>
</ul>
</blockquote>
</li>
<li><p>The more useful case might be seeing a full <code>diff</code> of <strong>what would happen if you merge the <code>topic</code> branch</strong>. So you might want to run:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git diff &lt;branch1&gt;...&lt;branch2&gt;</span><br></pre></td></tr></table></figure>

<p> In this example:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git diff master...topic</span><br></pre></td></tr></table></figure>
<p> This command shows you only the work your current <code>topic</code> branch has introduced <strong>since its common ancestor</strong> with <code>master</code>.</p>
<p> This triple dot technically is a shorthand command created by Git to achieve the following:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git merge-base contrib master</span><br><span class="line">36c7dba2c95e6bbb78dfa822519ecfec6e1ca649</span><br><span class="line">$ git diff 36c7db</span><br></pre></td></tr></table></figure>

<p> or, more concisely:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git diff $(git merge-base contrib master)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> You might think there is an easier way by doing <code>git diff master</code>. This might work, but not always. This is because this command gives you a <code>diff</code> by <strong>comparing the last commit of the topic branch you’re on and the last commit on the master branch</strong>. This means that if your <code>master</code> branch <strong>has moved forward since you created the <code>topic</code> branch from it</strong>, then you’ll get seemingly strange results. For example, if you’ve <strong>added a line in a file on the <code>master</code> branch</strong>, <strong>a direct comparison of the snapshots will look like the <code>topic</code> branch is going to remove that line</strong>.</li>
</ul>
</blockquote>
</li>
</ol>
<h2 id="Determining-your-Merging-Workflow"><a href="#Determining-your-Merging-Workflow" class="headerlink" title="Determining your Merging Workflow"></a>Determining your Merging Workflow</h2><p>Basically, you need to decide how to manage all your <code>merge</code> and <code>rebase</code> actions, so that you could easily track changes and make it easier to understand. There are several <strong>example styles that you could use for managing your project merges:</strong></p>
<ol>
<li><a href="#merging-flow-small">Merging Workflow for small projects</a></li>
<li><a href="#merging-flow-large">Merging Workflow for large projects</a></li>
<li><a href="#rebase-and-cherry">Rebasing and Cherry-Picking Workflows</a></li>
</ol>
<p><a name="merging-flow-small"></a></p>
<h2 id="Small-Merging-Workflow"><a href="#Small-Merging-Workflow" class="headerlink" title="Small Merging Workflow"></a>Small Merging Workflow</h2><p>The simplest way is to do <code>git merge</code> all the time to your <code>master</code> branch. However, this might cause unpleasant history line to review. However, this is often manageable for small projects, and typically you will have <strong>a main track with two branches</strong>: <code>master</code> and <code>develop</code>, in which you determine that <strong><code>master</code> is updated only when a very stable release is cut</strong> and <strong>all new code is integrated into the <code>develop</code> branch</strong>.</p>
<p>Then, since you typically first <code>merge</code> into your <code>develop</code> before deciding whether or not it is to be released in the <code>master</code> branch:</p>
<p><img src="/.com//05/20/Git-Summary/merging-workflows-1.png" alt="Picture from https://git-scm.com/book/en/v2/Distributed-Git-Maintaining-a-Project, Figure 76"><br>And then if you do decide to <code>merge</code> in to the <code>master</code> branch:<br><img src="/.com//05/20/Git-Summary/merging-workflows-2.png" alt="Picture from https://git-scm.com/book/en/v2/Distributed-Git-Maintaining-a-Project, Figure 77"></p>
<p><a name="merging-flow-large"></a></p>
<h2 id="Large-Merging-Workflow"><a href="#Large-Merging-Workflow" class="headerlink" title="Large Merging Workflow"></a>Large Merging Workflow</h2><p>This workflow will have four <code>branch</code>es on the main track: <code>master</code>,<code>next</code>,<code>pu</code>,and <code>maint</code>.</p>
<ul>
<li><code>master</code> branch will still be the one with the <strong>most stable version of the system</strong></li>
<li><code>next</code> branch will be controlling/merging the <code>topics</code>/<code>features</code> branches that you <strong>got from your colaborators repo</strong> and you tested are <strong>functioning properly</strong>, considering whether to include or not.</li>
<li><code>pu</code> branch means <strong>proposed updates</strong>, these could be branches with work that are interesting but <strong>need more work</strong></li>
<li><code>maint</code> branch usually stores the project <strong>at the state of the last release</strong>, so that it <strong>can be forked off to provide backported patches in case a maintenance release is required</strong>. </li>
</ul>
<p>For example, you might have your <code>topic</code> branches from your colaborators’ repos like this:<br><img src="/.com//05/20/Git-Summary/large-merges-1.png" alt="Picture from https://git-scm.com/book/en/v2/Distributed-Git-Maintaining-a-Project, Figure 76"><br>And you organizes/maintains your main <code>branch</code>es (<code>maint</code> not shown here) like this:<br><img src="/.com//05/20/Git-Summary/large-merges-2.png" alt="Picture from https://git-scm.com/book/en/v2/Distributed-Git-Maintaining-a-Project, Figure 76"></p>
<p><a name="rebase-and-cherry"></a></p>
<h2 id="Rebasing-and-Cherry-Picking-Workflow"><a href="#Rebasing-and-Cherry-Picking-Workflow" class="headerlink" title="Rebasing and Cherry-Picking Workflow"></a>Rebasing and Cherry-Picking Workflow</h2><p>Other maintainers prefer to <code>rebase</code> or <code>cherry-pick</code> contributed work on top of their master branch, rather than merging it in, to <strong>keep a mostly linear history</strong>. When you have work in a <code>topic</code> branch and have determined that you want to integrate it, you move to that branch and run the <code>rebase</code> command to <strong>rebuild the changes on top of your current <code>master</code></strong> (or <code>develop</code>, and so on) branch. <strong>If that works well</strong>, you can fast-forward your master branch, and you’ll end up with a linear project history.</p>
<p>Or you could do a cherry-pick, which <strong>does not remove the original branch</strong> but <strong>“rebases” on top of the current branch</strong>, and you can <strong>choose which commit/commits you would like to incorporate</strong> (which means you might want to incorporate only several commits in that branch, but not all).</p>
<p>For example, if you are given this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">      A---B---C topic</span><br><span class="line">     &#x2F;</span><br><span class="line">D---E---F---G master</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Then a <code>rebase</code> command:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git rebase master topic</span><br></pre></td></tr></table></figure>

<p>  You get:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">              A&#39;--B&#39;--C&#39; topic</span><br><span class="line">             &#x2F;</span><br><span class="line">D---E---F---G master</span><br></pre></td></tr></table></figure></li>
<li><p>The run <code>cherry-pick &lt;from-commit-id&gt;^..&lt;to-commit-id&gt;</code>:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master -b topic_new</span><br><span class="line">$ git cherry-pick A^..C</span><br></pre></td></tr></table></figure>

<p>  You get:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">      A---B---C topic</span><br><span class="line">     &#x2F;</span><br><span class="line">D---E---F---G master</span><br><span class="line">             \</span><br><span class="line">              A&#39;--B&#39;--C&#39; topic_new</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="Rerere-in-Git"><a href="#Rerere-in-Git" class="headerlink" title="Rerere in Git"></a>Rerere in Git</h2><p>Rerere stands for “reuse recorded resolution” — it’s a way of shortcutting manual conflict resolution. When rerere is enabled, Git will keep a set of pre- and post-images from successful merges, and if it notices that there’s a conflict that looks exactly like one you’ve already fixed, it’ll just use the fix from last time, without bothering you with it.</p>
<p>This feature comes in <strong>two parts</strong>: <strong>a configuration setting</strong> and <strong>a command</strong>. The configuration setting is <code>rerere.enabled</code>, and it’s handy enough to put in your <code>global config</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global rerere.enabled true</span><br></pre></td></tr></table></figure>

<p>Now, whenever you <strong>do a <code>merge</code> that resolves conflicts</strong>, the <strong>resolution will be recorded</strong> in the cache in case you need it in the future.</p>
<p>If you need to, you can interact with the rerere cache using the <code>git rerere</code> command. When it’s invoked alone, Git <strong>checks its database of resolutions and tries to find a match with any current merge conflicts</strong> and <strong>resolve</strong> them (although this is <strong>done automatically if <code>rerere.enabled</code> is set to true</strong>).</p>
<h2 id="Generating-a-Build-Number"><a href="#Generating-a-Build-Number" class="headerlink" title="Generating a Build Number"></a>Generating a Build Number</h2><p>If you run <code>git describe</code>, Git generates a string consisting of the <strong>name of the most recent tag</strong> earlier than that commit, followed by the <strong>number of commits</strong> since that tag, followed finally by a <strong>partial SHA-1 value of the commit being described</strong> (prefixed with the letter “g” meaning Git):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git describe</span><br><span class="line">v1.0-3-gca2e64e</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note</p>
<ul>
<li><input disabled type="checkbox"> By default, the <code>git describe</code> command <strong>requires annotated tags</strong> (tags created with the -a or -s flag); if you want to take advantage of <strong>lightweight (non-annotated) tags</strong> as well, add the <code>--tags</code> option to the command. </li>
</ul>
</blockquote>
<h2 id="Preparing-a-Release-Using-a-Zip-Gzip"><a href="#Preparing-a-Release-Using-a-Zip-Gzip" class="headerlink" title="Preparing a Release Using a Zip/Gzip"></a>Preparing a Release Using a Zip/Gzip</h2><p>Now you want to release a build. One of the things you’ll want to do is <strong>create an archive of the latest snapshot of your code</strong> for those poor souls who don’t use Git. The command to do this is <code>git archive</code>:</p>
<ul>
<li><p>To create a <strong>GZip</strong> file with the <strong>name being the build number generated</strong> from the previous section, you do:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git archive master --prefix&#x3D;&#39;projectArchive&#x2F;&#39; | gzip &gt; &#96;git describe master&#96;.tar.gz</span><br><span class="line"></span><br><span class="line">$ ls *.tar.gz</span><br><span class="line">v1.0-3-gca2e64e.tar.gz</span><br></pre></td></tr></table></figure>
<p>  where the <code>--prefix=&#39;projectArchive&#39;</code> means that if you open that Gzip file, you will find a directory called <code>projectArchive</code> in which all your files are saved.</p>
</li>
<li><p>You can also create a <strong>zip</strong> archive in much the same way, but by passing the <code>--format=zip</code> option to <code>git archive</code>:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git archive master --format&#x3D;zip &gt; &#96;git describe master&#96;.zip</span><br></pre></td></tr></table></figure>
<p>  Here you will have <strong>all the files directly in that Zip</strong>, without opening any more directory</p>
</li>
</ul>
<h2 id="Shortlog"><a href="#Shortlog" class="headerlink" title="Shortlog"></a>Shortlog</h2><p>If you use the <code>git shortlog</code> command. It summarizes <strong>all the commits in the range you give it</strong>; for example, the following gives you a summary of all the commits <strong>since your last release, if your last release was named v0.1</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git shortlog --no-merges master --not v0.1</span><br><span class="line">Xiao Yu (4):</span><br><span class="line">      second commit made</span><br><span class="line">      amended: edited AND deleted file removal and untracking</span><br><span class="line">      first commit made now more with the new testing branch</span><br><span class="line">      testing rebase, added a new file independent for the branch master</span><br></pre></td></tr></table></figure>

<h2 id="Git-Commit-Selection-Tools"><a href="#Git-Commit-Selection-Tools" class="headerlink" title="Git Commit Selection Tools"></a>Git Commit Selection Tools</h2><p>Now you’ll explore a number of very powerful things that Git can do that you may not necessarily use on a day-to-day basis but that you <strong>may need at some point</strong>.</p>
<table>
<thead>
<tr>
<th>Revision Selection Type</th>
<th>Command</th>
<th>Outcome/Example</th>
<th>Note</th>
</tr>
</thead>
<tbody><tr>
<td>Showing a <strong>single commit</strong> using Short SHA-1</td>
<td><code>git show &lt;commit-sha-1&gt;</code></td>
<td><code>git show ae1934jf</code></td>
<td>-</td>
</tr>
<tr>
<td>Showing a <strong>single commit</strong> at the top of a branch</td>
<td><code>git show &lt;branchName&gt;</code></td>
<td><code>git show topic1</code> gives to top commit at branch <code>topic1</code></td>
<td>You can use <code>git rev-parse &lt;branchName&gt;</code> to get a SHA-1 code of the top commit from a branch</td>
</tr>
<tr>
<td>Showing a <strong>single commit</strong> using a reflog</td>
<td><code>git show &lt;reflog-data-of-HEAD&gt;</code></td>
<td><code>git show HEAD@{5}</code></td>
<td>The reflog is data that keeps track of your HEAD position, which you can get from running <code>git reflog</code></td>
</tr>
<tr>
<td>Showing a <strong>single commit</strong> using ancestry reference using <code>^</code> (means the parent of something)</td>
<td><code>git show &lt;commit-id&gt;^</code></td>
<td><code>git show HEAD^</code> shows the parent of the HEAD</td>
<td>You can also specify a number for going back multiple times, <code>d921970^2</code> means “the second parent of <code>d921970</code>.”</td>
</tr>
<tr>
<td>Showing <strong>multiple commits</strong> using the difference of two branches</td>
<td><code>git log &lt;branch1&gt;..&lt;branch2&gt;</code> — that means “all commits <strong>on <code>&lt;branch2&gt;</code></strong> that are not reachable from <code>&lt;branch1&gt;</code></td>
<td><code>git log master..topic1</code></td>
<td>The sequence of the <code>&lt;branch&gt;</code> matters in this command.</td>
</tr>
<tr>
<td>Showing <strong>multiple commits</strong> using the difference of two branches</td>
<td><code>git log &lt;branch1&gt;...&lt;branch2&gt;</code> which specifies all the commits that are reachable by either of two references <strong>but not by both of them</strong>/all the <strong>divergent commits</strong></td>
<td><code>git log master...topic1</code></td>
<td>A common switch to use with the log command in this case is <code>--left-right</code>, which shows you <strong>which branch (side) of the range each commit is in</strong>. This helps make the output more useful: <code>$ git log --left-right master...experiment</code></td>
</tr>
</tbody></table>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Whenver you want to <strong>see multiple commits</strong>, <strong>use <code>git log</code></strong> would be better than <code>git show</code>, because you can use <code>git log --oneline</code> to simplify the output while it is not available for <strong><code>git show</code></strong>, which is more for <strong>looking at a specific commit</strong>.</li>
</ul>
</blockquote>
<h2 id="Git-Tools-for-Interactive-Staging"><a href="#Git-Tools-for-Interactive-Staging" class="headerlink" title="Git Tools for Interactive Staging"></a>Git Tools for Interactive Staging</h2><p>These can help you <strong>craft your commits to include only certain combinations</strong> and parts of files. These tools are helpful if you modify a number of files extensively, then <strong>decide that you want those changes to be partitioned into several focused commits</strong> rather than one big messy commit. </p>
<p>Basically, <strong>interactive staging is initiated if you call <code>git add -i</code></strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ git add -i</span><br><span class="line">           staged     unstaged path</span><br><span class="line">  1:    unchanged        +0&#x2F;-1 TODO</span><br><span class="line">  2:    unchanged        +1&#x2F;-1 index.html</span><br><span class="line">  3:    unchanged        +5&#x2F;-1 lib&#x2F;simplegit.rb</span><br><span class="line"></span><br><span class="line">*** Commands ***</span><br><span class="line">  1: [s]tatus     2: [u]pdate      3: [r]evert     4: [a]dd untracked</span><br><span class="line">  5: [p]atch      6: [d]iff        7: [q]uit       8: [h]elp</span><br><span class="line">What now&gt;</span><br></pre></td></tr></table></figure>

<p>Here, you will see <strong>changes that are staged</strong>, <strong>changes that are unstaged</strong>, and the <strong>file/path</strong></p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Function</th>
<th>Example</th>
</tr>
</thead>
<tbody><tr>
<td><code>1</code> or <code>s</code></td>
<td>Shows the same content as you see above, with the updated status</td>
<td>-</td>
</tr>
<tr>
<td><code>2</code> or <code>u</code></td>
<td>First allows you to <strong>select file(s) of interest</strong>, and then <strong>add them to be staged</strong></td>
<td>When you typed <code>2</code> or <code>u</code>, you will see <code>Update&gt;&gt;</code>, and you can type in <code>1,2</code> to select the first and second file, and press enter so you will see the files with <code>*</code> mark as selected. Then press <code>Enter</code> again to do the changes.</td>
</tr>
<tr>
<td><code>3</code> or <code>r</code></td>
<td>First allows you to <strong>select file(s) of interest</strong>, and then *<em>undo the staging *</em></td>
<td>Similar as above</td>
</tr>
<tr>
<td><code>5</code> or <code>p</code></td>
<td>First allows you to <strong>select file(s) of interest</strong>, and then <strong>goes through each of the changes in that file</strong> and <strong>and let you decide whether if to incorporate the changes</strong></td>
<td>Similar as above, but when you need to select which change to add, you will be prompted with <code>Stage this hunk [y,n,a,d,/,j,J,g,e,?]</code>, with typing <code>?</code> allowing to see what each letter means</td>
</tr>
<tr>
<td><code>6</code> or <code>d</code></td>
<td>First allows you to <strong>select file(s) of interest that are staged</strong>, then you can see the <strong>staged diff</strong></td>
<td>Similar as above</td>
</tr>
</tbody></table>
<h2 id="Git-Tools-for-Stashing"><a href="#Git-Tools-for-Stashing" class="headerlink" title="Git Tools for Stashing"></a>Git Tools for Stashing</h2><p>When things are in a messy state and <strong>you want to switch branches for a bit to work on something else</strong>, but you <strong>don’t want to do a commit of half-done work</strong> just so you can get back to this point later, you can use <code>git stash</code> or <code>git stash push</code></p>
<p>For example, you have some modifications done but need to switch urgently to something else:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)</span><br><span class="line"></span><br><span class="line">	modified:   index.html</span><br><span class="line"></span><br><span class="line">Changes not staged for commit:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span><br><span class="line">  (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)</span><br><span class="line"></span><br><span class="line">	modified:   lib&#x2F;simplegit.rb</span><br></pre></td></tr></table></figure>
<p>Then you do:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ git stash push</span><br><span class="line">Saved working directory and index state \</span><br><span class="line">  &quot;WIP on master: 049d078 Create index file&quot;</span><br><span class="line">HEAD is now at 049d078 Create index file</span><br><span class="line">(To restore them type &quot;git stash apply&quot;)</span><br><span class="line"></span><br><span class="line">$ git status</span><br><span class="line"># On branch master</span><br><span class="line">nothing to commit, working directory clean</span><br></pre></td></tr></table></figure>

<p>At this point, you can switch branches and do work elsewhere; <strong>your changes are stored on your stack</strong>. To see which stashes you’ve stored, you can use git stash list:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git stash list</span><br><span class="line">stash@&#123;0&#125;: WIP on master: 049d078 Create index file</span><br><span class="line">stash@&#123;1&#125;: WIP on master: c264051 Revert &quot;Add file_size&quot;</span><br><span class="line">stash@&#123;2&#125;: WIP on master: 21d80a5 Add number to log</span><br></pre></td></tr></table></figure>

<p>Then, when you finished your urgent work, you can reapply by <code>git stash apply stash@{&lt;number&gt;}</code>, which will <strong>reapply changes on the branch you run this command</strong>, much like a <code>rebase</code></p>
<p>For example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git stash apply stash@&#123;2&#125; --index</span><br></pre></td></tr></table></figure>
<p>The <code>--index</code> is often added because, when changes to your files were reapplied, by default the file you <strong>staged before will not be restaged</strong>, since it only reapplies the changes. To also <strong>re-stage what you have staged</strong>, you must run the <code>git stash apply</code> command with a <code>--index</code> option to tell the command to try to reapply the staged changes.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Similar to <code>rebase</code> or <code>merge</code>, there could be <strong>conflicts as changes might not re-apply cleanly</strong>, if the files you edited in your stash were edited again. To resolve the conflicts, the same mechanism for <code>merge</code> conflicts will pop up for you to deal with.</li>
<li><input disabled type="checkbox"> After you have applied a stash, remember to <code>drop</code> it (i.e. delete it), because by default <code>git stash apply</code> will <strong>only apply the changes</strong>, and you have to <strong>delete that resolved stash manually</strong> by <code>git stash drop stash@{&lt;number&gt;}</code></li>
<li><input disabled type="checkbox"> By default, <code>git stash</code> will stash <strong>only modified and staged tracked files</strong>. If you specify <code>--include-untracked</code> or <code>-u</code>, you can <strong>stash untracked files that are not ignored</strong>. To even include the ignored files, use <code>--all</code> or <code>-a</code> instead.</li>
</ul>
</blockquote>
<p>You can also use the <strong>interactive stash</strong> by running <code>git stash --patch</code> (not <code>-i</code>. This will prompt you interactively which of the <strong>changes you would like to stash</strong> and which you would like to <strong>keep/commit in your working directory</strong>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ git stash --patch</span><br><span class="line">diff --git a&#x2F;lib&#x2F;simplegit.rb b&#x2F;lib&#x2F;simplegit.rb</span><br><span class="line">index 66d332e..8bb5674 100644</span><br><span class="line">--- a&#x2F;lib&#x2F;simplegit.rb</span><br><span class="line">+++ b&#x2F;lib&#x2F;simplegit.rb</span><br><span class="line">@@ -16,6 +16,10 @@ class SimpleGit</span><br><span class="line">         return &#96;#&#123;git_cmd&#125; 2&gt;&amp;1&#96;.chomp</span><br><span class="line">       end</span><br><span class="line">     end</span><br><span class="line">+</span><br><span class="line">+    def show(treeish &#x3D; &#39;master&#39;)</span><br><span class="line">+      command(&quot;git show #&#123;treeish&#125;&quot;)</span><br><span class="line">+    end</span><br><span class="line"></span><br><span class="line"> end</span><br><span class="line"> test</span><br><span class="line">Stash this hunk [y,n,q,a,d,&#x2F;,e,?]? y</span><br><span class="line"></span><br><span class="line">Saved working directory and index state WIP on master: 1b65b17 added the index file</span><br></pre></td></tr></table></figure>

<p>A last option is to <strong>create a new branch</strong> for recovering your stashed work. This is done by <code>git stash branch &lt;newBranchname&gt;</code>, for you with your selected branch name, <strong>checks out the commit you were on when you stashed your work</strong>, <strong>reapplies your work there</strong>, and then <strong>drops the stash if it applies</strong> successfully:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ git stash branch testchanges</span><br><span class="line">M	index.html</span><br><span class="line">M	lib&#x2F;simplegit.rb</span><br><span class="line">Switched to a new branch &#39;testchanges&#39;</span><br><span class="line">On branch testchanges</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)</span><br><span class="line"></span><br><span class="line">	modified:   index.html</span><br><span class="line"></span><br><span class="line">Changes not staged for commit:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span><br><span class="line">  (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)</span><br><span class="line"></span><br><span class="line">	modified:   lib&#x2F;simplegit.rb</span><br><span class="line"></span><br><span class="line">Dropped refs&#x2F;stash@&#123;0&#125; (29d385a81d163dfd45a452a2ce816487a6b8b014)</span><br></pre></td></tr></table></figure>

<h2 id="Git-Tools-for-Cleanig-Up-Your-Workspace"><a href="#Git-Tools-for-Cleanig-Up-Your-Workspace" class="headerlink" title="Git Tools for Cleanig Up Your Workspace"></a>Git Tools for Cleanig Up Your Workspace</h2><p>You can use <code>git clean</code> for deleting files that are <strong>not tracked</strong>. However, you’ll want to be pretty careful with this command, since, If you change your mind, there is often <strong>no retrieving the content of those files</strong>.</p>
<p>Therefore, often you might want to run <code>git clean --dry-run</code> or <code>git clean -n</code> to see what will happen before you run <code>git clean</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git clean --dry-run</span><br><span class="line">Would remove v1.0-3-gca2e64e.tar.gz</span><br><span class="line">Would remove v1.0-3-gca2e64e.zip</span><br></pre></td></tr></table></figure>
<p>However, these do <strong>not include ignored files</strong>. To include those files for removal, you need to add the option <code>-x</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git clean --dry-run -x</span><br><span class="line">Would remove .gitignore</span><br><span class="line">Would remove unTracked.txt</span><br><span class="line">Would remove v1.0-3-gca2e64e.tar.gz</span><br><span class="line">Would remove v1.0-3-gca2e64e.zip</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note </p>
<ul>
<li><input disabled type="checkbox"> Sometimes you might need to add the flag <code>-f</code> to do a <code>git clean</code>, because it is required if the Git <strong>configuration variable <code>clean.requireForce</code> is not explicitly set to <code>false</code></strong>. Therefore, you will need to force it by <code>-f</code>.</li>
</ul>
</blockquote>
<h2 id="Git-Tools-for-Signing-a-Commit"><a href="#Git-Tools-for-Signing-a-Commit" class="headerlink" title="Git Tools for Signing a Commit"></a>Git Tools for Signing a Commit</h2><p>In more recent versions of Git (v1.7.9 and above), you can now also <strong>sign individual commits</strong>. If you’re interested in signing commits directly instead of just the tags, all you need to do is add a <code>-S</code> to your <code>git commit</code> command.</p>
<p>However, first you need to get your <strong>GPG configured and your personal key installed</strong>.</p>
<p>If you don’t have a key installed, you can generate one with <code>gpg --gen-key</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gpg --gen-key</span><br></pre></td></tr></table></figure>

<p>Then you can check it with:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ gpg --list-keys</span><br><span class="line">&#x2F;Users&#x2F;schacon&#x2F;.gnupg&#x2F;pubring.gpg</span><br><span class="line">---------------------------------</span><br><span class="line">pub   2048R&#x2F;0A46826A 2014-06-04</span><br><span class="line">uid                  Scott Chacon (Git signing key) &lt;schacon@gmail.com&gt;</span><br><span class="line">sub   2048R&#x2F;874529A9 2014-06-04</span><br></pre></td></tr></table></figure>

<p>Once you have a private key to sign with, you can configure Git to use it for signing things by setting the <code>user.signingkey</code> config setting.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global user.signingkey 0A46826A</span><br><span class="line">Now Git will use your key by default to sign tags and commits if you want.</span><br></pre></td></tr></table></figure>

<p>Now, you can sign your commit properly with <code>-S</code>, which will pop up a window for putting in the <strong>password you created when you create the key</strong>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -a -S -m &#39;Signed commit&#39;</span><br><span class="line"></span><br><span class="line">You need a passphrase to unlock the secret key for</span><br><span class="line">user: &quot;Scott Chacon (Git signing key) &lt;schacon@gmail.com&gt;&quot;</span><br><span class="line">2048-bit RSA key, ID 0A46826A, created 2014-06-04</span><br><span class="line"></span><br><span class="line">[master 5c3386c] Signed commit</span><br><span class="line"> 4 files changed, 4 insertions(+), 24 deletions(-)</span><br><span class="line"> rewrite Rakefile (100%)</span><br><span class="line"> create mode 100644 lib&#x2F;git.rb</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/05/20/Git-Summary/" data-id="ckafdqrd30001rkt67oi12842" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/06/09/Spring-Framework-Guide/">Spring Framework Guide</a>
          </li>
        
          <li>
            <a href="/2020/06/09/SpringBoot-Manual/">Spring Boot Manual</a>
          </li>
        
          <li>
            <a href="/2020/06/02/Redis-Manual/">Redis Manual</a>
          </li>
        
          <li>
            <a href="/2020/05/26/MySQL-Manual/">MySQL Manual</a>
          </li>
        
          <li>
            <a href="/2020/05/25/Docker-Manual/">Docker Manual</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Xiao Yu<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>