<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>From a Beginner to a Disaster</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="From a Beginner to a Disaster">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="From a Beginner to a Disaster">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Xiao Yu">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="From a Beginner to a Disaster" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">From a Beginner to a Disaster</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Xiao.Y</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Go-Manual" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/06/15/Go-Manual/" class="article-date">
  <time datetime="2020-06-15T02:57:30.000Z" itemprop="datePublished">2020-06-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/06/15/Go-Manual/">Go Manual</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<p><strong>IMPORTANT</strong>:<br>Much of the content here is a personal summary/abbrieviation of contents on the <a href="https://golang.org/doc/" target="_blank" rel="noopener">Offical Go Documentation</a>. For more complete information, please refer to the offical site.</p>
<hr>
<h2 id="Installing-Go"><a href="#Installing-Go" class="headerlink" title="Installing Go"></a>Installing Go</h2><p>Please follow the <a href="https://golang.org/doc/install" target="_blank" rel="noopener">Offical Guide on Installing Go</a>.</p>
<h2 id="Packages"><a href="#Packages" class="headerlink" title="Packages"></a>Packages</h2><p>(additional reference: <a href="https://www.callicoder.com/golang-packages/#:~:text=Go%20Package,following%20syntax%20%2D%20package" target="_blank" rel="noopener">https://www.callicoder.com/golang-packages/#:~:text=Go%20Package,following%20syntax%20%2D%20package</a>)</p>
<p>Every <strong>Go program is made up of packages</strong>, and every <strong>Go source file belongs to a package</strong>. To declare a source file to be part of a package, we use the following syntax -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> &lt;packagename&gt;</span><br></pre></td></tr></table></figure>

<p>The above package declaration must be the first line of code in your Go source file. All the functions, types, and variables defined in your Go source file become part of the declared package.</p>
<p>You can <strong>choose to export a member defined in your package to outside packages</strong>, or keep them private to the same package. Other packages can <strong>import and reuse the functions or types that are exported from your package</strong>.</p>
<p>Let‚Äôs see an example</p>
<p>Almost all the code that we will see in this tutorial series include the following line -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br></pre></td></tr></table></figure>

<p><code>fmt</code> is a core library package that contains functionalities related to formatting and printing output or reading input from various I/O sources. It exports functions like <code>Println()</code>, <code>Printf()</code>, <code>Scanf()</code> etc, for other packages to reuse.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> By convention, the <strong>package name is</strong> the same as the <strong>last element of the import path</strong>. For instance, the <code>&quot;math/rand&quot;</code> package comprises files that begin with the statement <code>package rand</code>.</li>
</ul>
</blockquote>
<h3 id="The-main-package-and-main-function"><a href="#The-main-package-and-main-function" class="headerlink" title="The main package and main() function"></a>The <code>main</code> package and <code>main()</code> function</h3><p>Go programs start running in the <code>main</code> package. It is a <strong>special package that is used with programs that are meant to be executable</strong>. The <strong><code>main()</code> function is a special function that is the entry point of an executable program</strong>.</p>
<p>By convention, Executable programs (the ones with the main package) are called Commands. Others are called simply Packages.</p>
<p>Usually, you would have a <code>main</code> package at the top level of your project, and then create sub-directories for other packages. For example, you could have the following structure:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">myProject&#x2F;</span><br><span class="line">	main.go</span><br><span class="line">	subModule&#x2F;</span><br><span class="line">		test1.go</span><br><span class="line">		test2.go</span><br><span class="line">	anotherModule&#x2F;</span><br><span class="line">		test3.go</span><br></pre></td></tr></table></figure>

<h2 id="Running-a-Program"><a href="#Running-a-Program" class="headerlink" title="Running a Program"></a>Running a Program</h2><p><strong>Programs start running in <code>package main</code></strong>.</p>
<p>For example, using the <code>math/rand</code> pacakge, we could generate a random number by:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"math/rand"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">"hello, world\n"</span>)</span><br><span class="line">	fmt.Println(rand.Intn(<span class="number">10</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> The environment in which these programs are executed is <strong>deterministic, so each time you run the example program rand.Intn will return the same number</strong>. To see a <strong>different number</strong>, <strong>seed the number generator</strong>; see <code>rand.Seed</code>.</li>
</ul>
</blockquote>
<h2 id="Imports"><a href="#Imports" class="headerlink" title="Imports"></a>Imports</h2><p>To import a <strong>go package (a collection of go files)</strong>, it first needs to be <strong>included in your GoPath</strong>.</p>
<p>There are two ways to import packages in Go -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Multiple import statements</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"time"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"math"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"math/rand"</span></span><br><span class="line"><span class="comment">// Factored import statements</span></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">	<span class="string">"math"</span></span><br><span class="line">    <span class="string">"math/rand"</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>It is generally considered a <strong>good style to use the factored import statement</strong>.</p>
<p>Notice that the imported package name basically follow the directory hierarchy (as mentioned before, Go‚Äôs convention is that - the package name is the same as the last element of the import path). For example, the name of the package imported as <code>math/rand</code> is rand. It is <strong>imported with path <code>math/rand</code> because It is nested inside the math package as a subdirectory</strong>.</p>
<h3 id="Import-Paths"><a href="#Import-Paths" class="headerlink" title="Import Paths"></a>Import Paths</h3><p>(additional reference: <a href="https://www.callicoder.com/golang-packages/" target="_blank" rel="noopener">https://www.callicoder.com/golang-packages/</a>)</p>
<p>All import paths are relative to the <strong>GoPath or GoModule (this will be talked about later) path</strong>.</p>
<p>For example, if you have <code>github.com/callicode/packer</code> as the directory where you initiate your <code>go.module</code> file, then you can refer to packages <strong>relative to that module‚Äôs directory</strong>:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"github.com/callicoder/packer/numbers"</span></span><br><span class="line">    <span class="string">"github.com/callicoder/packer/strings"</span>  </span><br><span class="line">    <span class="string">"github.com/callicoder/packer/strings/greeting"</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="Package-Alias"><a href="#Package-Alias" class="headerlink" title="Package Alias"></a>Package Alias</h3><p>You can use <strong>package alias to resolve conflicts between different packages of the same name</strong>, or just to give a short name to the imported package</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import (</span><br><span class="line">    str &quot;strings&quot;   &#x2F;&#x2F; Package Alias, so that you can use str.some_function() for strings.some_function()</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="Adding-3rd-party-Packages"><a href="#Adding-3rd-party-Packages" class="headerlink" title="Adding 3rd party Packages"></a>Adding 3rd party Packages</h3><p>Adding 3rd party packages to your project is very easy with Go modules. You can just import the package to any of the source files in your project, and the next time you build/run the project, Go automatically downloads it for you -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"rsc.io/quote"</span>  <span class="comment">// a third-party package</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(quote.Go())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>And the output will look like:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ go run main.go</span><br><span class="line">go: finding rsc.io&#x2F;quote v1.5.2</span><br><span class="line">go: downloading rsc.io&#x2F;quote v1.5.2</span><br><span class="line">go: extracting rsc.io&#x2F;quote v1.5.2</span><br><span class="line">go: downloading rsc.io&#x2F;sampler v1.3.0</span><br><span class="line">go: extracting rsc.io&#x2F;sampler v1.3.0</span><br><span class="line">go: downloading golang.org&#x2F;x&#x2F;text v0.0.0-20170915032832-14c0d48ead0c</span><br><span class="line">go: extracting golang.org&#x2F;x&#x2F;text v0.0.0-20170915032832-14c0d48ead0c</span><br><span class="line">go: finding rsc.io&#x2F;sampler v1.3.0</span><br><span class="line">go: finding golang.org&#x2F;x&#x2F;text v0.0.0-20170915032832-14c0d48ead0c</span><br><span class="line"></span><br><span class="line">Don&#39;t communicate by sharing memory, share memory by communicating.</span><br></pre></td></tr></table></figure>
<p>Go will also add this new dependency to the <code>go.mod</code> file.</p>
<h2 id="Exports"><a href="#Exports" class="headerlink" title="Exports"></a>Exports</h2><p>In Go, a <strong>function/variable/type is exported if its name begins with a capital letter</strong>. For example, <code>Pizza()</code> is an exported name, as is <code>Pi</code>, which is exported from the <code>math</code> package.</p>
<p><code>pizza</code> and <code>pi</code> do not start with a capital letter, <strong>so they are not exported</strong>. This means that they are <strong>not accessible from outside the package when using imports</strong>.</p>
<p>So, in short:</p>
<ul>
<li>Anything (variable, type, or function) that <strong>starts with a capital letter is exported</strong>, and visible outside the package.</li>
<li>Anything that <strong>does not start with a capital letter is not exported</strong>, and is <strong>visible only inside the same package</strong>.</li>
</ul>
<p>For example:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"math"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// MaxInt64 is an exported name</span></span><br><span class="line">	fmt.Println(<span class="string">"Max value of int64: "</span>, <span class="keyword">int64</span>(math.MaxInt64))</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Phi is an exported name</span></span><br><span class="line">	fmt.Println(<span class="string">"Value of Phi (œï): "</span>, math.Phi)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// pi starts with a small letter, so it is NOT exported</span></span><br><span class="line">	fmt.Println(<span class="string">"Value of Pi (ùúã): "</span>, math.pi)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Output</span><br><span class="line">.&#x2F;exported_names.go:16:38: cannot refer to unexported name math.pi</span><br><span class="line">.&#x2F;exported_names.go:16:38: undefined: math.pi</span><br></pre></td></tr></table></figure>

<h2 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h2><p>(additional reference: <a href="https://www.callicoder.com/golang-functions/" target="_blank" rel="noopener">https://www.callicoder.com/golang-functions/</a>)</p>
<p>In Golang, we declare a function using the <code>func</code> keyword. A function has a <strong>name</strong>, a list of comma-separated <strong>input parameters</strong> along with their types, the** result type(s)<strong>, and a **body</strong>.</p>
<p>Following is an example of a simple function called avg that takes two input parameters of type float64 and returns the average of the inputs. The <strong>result is also of type <code>float64</code></strong> -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">avg</span><span class="params">(x <span class="keyword">float64</span>, y <span class="keyword">float64</span>)</span> <span class="title">float64</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> (x + y) / <span class="number">2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Notice that the <strong>type comes after the variable name</strong>.</p>
<h3 id="Function-Parameters-and-Return-Types"><a href="#Function-Parameters-and-Return-Types" class="headerlink" title="Function Parameters and Return Types"></a>Function Parameters and Return Types</h3><p>The <strong>input parameters and return type(s) are optional for a function</strong>. A function can be declared without any input and output.</p>
<p>The <code>main()</code> function is an example of such a function -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Here is another example -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sayHello</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"Hello, World"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Input-Type-Abbreviation"><a href="#Input-Type-Abbreviation" class="headerlink" title="Input Type Abbreviation"></a>Input Type Abbreviation</h3><p>You need to <strong>specify the type only once</strong> for multiple <strong>consecutive</strong> parameters of the same type</p>
<p>If a function has two or more consecutive parameters of the same type, then it suffices to specify the type <strong>only once for the last parameter of that type</strong>.</p>
<p>For example, we can declare the avg function that we saw in the previous section like this as well -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">avg</span><span class="params">(x, y <span class="keyword">float64</span>)</span> <span class="title">float64</span></span> &#123; &#125;</span><br><span class="line"><span class="comment">// Same as - func avg(x float64, y float64) float64 &#123; &#125;</span></span><br></pre></td></tr></table></figure>

<p>Here is another example -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printPersonDetails</span><span class="params">(firstName, lastName <span class="keyword">string</span>, age <span class="keyword">int</span>)</span></span> &#123; &#125;</span><br><span class="line"><span class="comment">// Same as - func printPersonDetails(firstName string, lastName string, age int) &#123; &#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Multiple-Return-Results"><a href="#Multiple-Return-Results" class="headerlink" title="Multiple Return Results"></a>Multiple Return Results</h3><p>Go is capable of returning multiple results. You just need to <strong>specify the return types separated by comma inside parentheses</strong>, and then return multiple comma-separated values from the function.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">swap</span><span class="params">(x, y <span class="keyword">string</span>)</span> <span class="params">(<span class="keyword">string</span>, <span class="keyword">string</span>)</span></span> &#123;	<span class="comment">// returning two strings</span></span><br><span class="line">	<span class="keyword">return</span> y, x</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	a, b := swap(<span class="string">"hello"</span>, <span class="string">"world"</span>)	<span class="comment">// notice the use of :=, the short declaration, which will come later in this guide</span></span><br><span class="line">	fmt.Println(a, b)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>A common approach using this feature is to <strong>return an error value from a function</strong> if there could be an abnormal behavior with some input.</p>
<p>Let‚Äôs see an example - The <code>getStockPriceChange</code> function that we saw will return <code>¬±Inf (Infinity)</code> if the <code>prevPrice</code> is <code>0</code>. If you want to return an <code>error</code> instead, you can do so by <strong>adding another return value of type <code>error</code></strong> and return the <code>error</code> value like so -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getStockPriceChangeWithError</span><span class="params">(prevPrice, currentPrice <span class="keyword">float64</span>)</span> <span class="params">(<span class="keyword">float64</span>, <span class="keyword">float64</span>, error)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> prevPrice == <span class="number">0</span> &#123;</span><br><span class="line">		err := errors.New(<span class="string">"Previous price cannot be zero"</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">	change := currentPrice - prevPrice</span><br><span class="line">	percentChange := (change / prevPrice) * <span class="number">100</span></span><br><span class="line">	<span class="keyword">return</span> change, percentChange, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The <strong><code>error</code> type is a built-in type in Golang</strong>. Go programs use error values to indicate an abnormal situation. Don‚Äôt worry if you don‚Äôt understand about errors for now. You‚Äôll learn more about error handling in a later section.</p>
<h3 id="Named-return-values"><a href="#Named-return-values" class="headerlink" title="Named return values"></a>Named return values</h3><p>Go‚Äôs return values may be named. If so, they are treated as <strong>variables defined at the top of the function</strong>.</p>
<p>For example:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">split</span><span class="params">(sum <span class="keyword">int</span>)</span> <span class="params">(x, y <span class="keyword">int</span>)</span></span> &#123;	<span class="comment">// notice the specified type</span></span><br><span class="line">	x = sum * <span class="number">4</span> / <span class="number">9</span>		<span class="comment">// notice the change from := (short declaration) to = (assignment)</span></span><br><span class="line">	y = sum - x</span><br><span class="line">	<span class="keyword">return</span>		<span class="comment">// naked return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(split(<span class="number">17</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> A good practise would be <strong>using those names to document the meaning of the return values.</strong></li>
</ul>
</blockquote>
<p>A <strong>return statement without arguments returns the named return values</strong>. This is known as a ‚Äúnaked‚Äù return.</p>
<p>Naked return statements <strong>should</strong> be used only in <strong>short functions</strong>, as with the example shown here. They can harm readability in longer functions.</p>
<h3 id="Blank-Identifier"><a href="#Blank-Identifier" class="headerlink" title="Blank Identifier"></a>Blank Identifier</h3><p>Sometimes you may want to <strong>ignore some of the results from a function that returns multiple values</strong>.</p>
<p>For example, Let‚Äôs say that you‚Äôre using the <code>split</code> function that we defined in the previous section, but you‚Äôre only interested in the final result of <code>y</code>, not the intermediate <code>x</code>.</p>
<p>Well, you can use a blank identifier instead -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_, y := split(<span class="number">17</span>)</span><br></pre></td></tr></table></figure>

<p><strong>Q: Why can you not just declare a variable but not use it?</strong></p>
<p>The problem is that in Go, you‚Äôll be forced to use the variables you declared because <strong>Go doesn‚Äôt allow creating variables that you never use</strong>.</p>
<h2 id="Variables"><a href="#Variables" class="headerlink" title="Variables"></a>Variables</h2><p>(additional reference: <a href="https://www.callicoder.com/golang-variables-zero-values-type-inference/" target="_blank" rel="noopener">https://www.callicoder.com/golang-variables-zero-values-type-inference/</a>)</p>
<p>Every program needs to store some data/information in memory. The data is stored in memory at a particular memory location.</p>
<p>A variable is just a convenient name given to a memory location where the data is stored. Apart from a <strong>name</strong>, every variable also has an <strong>associated type</strong>.</p>
<p>For example, Golang has a data type called <code>int8</code>. It represents 8-bit integers whose values can range from <code>-128</code> to <code>127</code>. It <strong>also defines the operations</strong> that can be done on <code>int8</code> data type such as addition, subtraction, multiplication, division etc.</p>
<h3 id="Declaring-Variables"><a href="#Declaring-Variables" class="headerlink" title="Declaring Variables"></a>Declaring Variables</h3><p>In Golang, We use the <code>var</code> keyword to declare variables -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> firstName <span class="keyword">string</span></span><br><span class="line"><span class="keyword">var</span> lastName <span class="keyword">string</span>  </span><br><span class="line"><span class="keyword">var</span> age <span class="keyword">int</span></span><br></pre></td></tr></table></figure>

<p>You can also declare multiple variables at once like so -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	firstName <span class="keyword">string</span></span><br><span class="line">	lastName  <span class="keyword">string</span></span><br><span class="line">	age       <span class="keyword">int</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>You can even combine multiple variable declarations of the same type with comma -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	firstName, lastName <span class="keyword">string</span></span><br><span class="line">	age                 <span class="keyword">int</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="Zero-Values"><a href="#Zero-Values" class="headerlink" title="Zero Values"></a>Zero Values</h3><p>Any <strong>variable declared without an initial value</strong> will have a zero-value depending on the type of the variable-</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Zero Value</th>
</tr>
</thead>
<tbody><tr>
<td>bool</td>
<td>false</td>
</tr>
<tr>
<td>string</td>
<td>‚Äù‚Äù</td>
</tr>
<tr>
<td>int, int8, int16 etc.</td>
<td>0</td>
</tr>
<tr>
<td>float32, float64</td>
<td>0.0</td>
</tr>
</tbody></table>
<p>The example below demonstrates the concept of zero values:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> (</span><br><span class="line">		firstName, lastName <span class="keyword">string</span></span><br><span class="line">		age                 <span class="keyword">int</span></span><br><span class="line">		salary              <span class="keyword">float64</span></span><br><span class="line">		isConfirmed         <span class="keyword">bool</span></span><br><span class="line">	)</span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">"firstName: %s, lastName: %s, age: %d, salary: %f, isConfirmed: %t\n"</span>,</span><br><span class="line">		firstName, lastName, age, salary, isConfirmed)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Output</span><br><span class="line">firstName: , lastName: , age: 0, salary: 0.000000, isConfirmed: false</span><br></pre></td></tr></table></figure>

<h3 id="Variable-Initialization"><a href="#Variable-Initialization" class="headerlink" title="Variable Initialization"></a>Variable Initialization</h3><p>Here is how you can initialize variables during declaration -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> firstName <span class="keyword">string</span> = <span class="string">"Satoshi"</span></span><br><span class="line"><span class="keyword">var</span> lastName <span class="keyword">string</span> = <span class="string">"Nakamoto"</span></span><br><span class="line"><span class="keyword">var</span> age <span class="keyword">int</span> = <span class="number">35</span></span><br></pre></td></tr></table></figure>

<p>You can also use multiple declarations like this -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	firstName <span class="keyword">string</span> = <span class="string">"Satoshi"</span></span><br><span class="line">	lastName  <span class="keyword">string</span> = <span class="string">"Nakamoto"</span></span><br><span class="line">	age       <span class="keyword">int</span>    = <span class="number">35</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>Or even combine multiple variable declarations of the same type with comma and initialize them like so -</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var (</span><br><span class="line">	firstName, lastName string &#x3D; &quot;Satoshi&quot;, &quot;Nakamoto&quot;</span><br><span class="line">	age int &#x3D; 35</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> All these styles are allowed in both package level declaration and function level declaration</li>
</ul>
</blockquote>
<h3 id="Type-Inference"><a href="#Type-Inference" class="headerlink" title="Type Inference"></a>Type Inference</h3><p>Although Go is a Statically typed language (a language is statically-typed if the <strong>type of a variable is known at compile-time</strong> instead of at run-time), It doesn‚Äôt require you to explicitly specify the type of every variable you declare.</p>
<p>When you declare a variable with an initial value, Golang automatically <strong>infers the type</strong> of the variable from the <strong>value on the right-hand side</strong>. So you need not specify the type when you‚Äôre initializing the variable at the time of declaration -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name = <span class="string">"Rajeev Singh"</span> <span class="comment">// Type declaration is optional here.</span></span><br><span class="line">    fmt.Printf(<span class="string">"Variable 'name' is of type %T\n"</span>, name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Output</span><br><span class="line">Variable &#39;name&#39; is of type string</span><br></pre></td></tr></table></figure>
<p>In the above example, Golang automatically infers the type of the variable as string from the value on the right-hand side. <strong>If you try to reassign the variable to a value of some other type, then the compiler will throw an error</strong> -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">"Rajeev Singh"</span>  <span class="comment">// Type inferred as `string`</span></span><br><span class="line">name = <span class="number">1234</span> <span class="comment">// Compiler Error</span></span><br></pre></td></tr></table></figure>

<p>This also means that type inference allows us to <strong>declare and initialize multiple variables of different data types</strong> in a single line like so -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// Multiple variable declarations with inferred types. No type is explicitly specified here</span></span><br><span class="line">    <span class="keyword">var</span> firstName, lastName, age, salary = <span class="string">"John"</span>, <span class="string">"Maxwell"</span>, <span class="number">28</span>, <span class="number">50000.0</span></span><br><span class="line"></span><br><span class="line">    fmt.Printf(<span class="string">"firstName: %T, lastName: %T, age: %T, salary: %T\n"</span>, </span><br><span class="line">        firstName, lastName, age, salary)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Output</span><br><span class="line">firstName: string, lastName: string, age: int, salary: float64</span><br></pre></td></tr></table></figure>

<h3 id="Short-Variable-Declarations"><a href="#Short-Variable-Declarations" class="headerlink" title="Short Variable Declarations"></a>Short Variable Declarations</h3><p>Inside a function, the <code>:=</code> short assignment statement can be used in place of a <code>var</code> declaration <strong>with implicit/inferred type</strong>.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> i, j <span class="keyword">int</span> = <span class="number">1</span>, <span class="number">2</span></span><br><span class="line">	k := <span class="number">3</span></span><br><span class="line">	c, python, java := <span class="literal">true</span>, <span class="literal">false</span>, <span class="string">"yes!"</span>		<span class="comment">// all of them would work in a function level</span></span><br><span class="line"></span><br><span class="line">	fmt.Println(i, j, k, c, python, java)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Outside a function</strong>, every statement <strong>needs to begin with a keyword</strong> (<code>var</code>, <code>func</code>, and so on) and so the <code>:=</code> construct is not available.</p>
<h3 id="Scope-of-Variables"><a href="#Scope-of-Variables" class="headerlink" title="Scope of Variables"></a>Scope of Variables</h3><p>A var statement can be <strong>at package or function level</strong>.</p>
<ul>
<li>If you defined a variable at the function level, then it is visible <strong>only inside that function</strong>.</li>
<li>If you defined a variable at the package level, then it is visible to <strong>all functions inside that package</strong>.</li>
</ul>
<p>However, when you declared a variable inside a function with the same name as the variable defined in the package level, then, from that declaration onwards, <strong>the variable defined in the function will be used</strong>.</p>
<p>For example:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span>(</span><br><span class="line">	age <span class="keyword">int8</span> = <span class="number">10</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	fmt.Println(age)</span><br><span class="line">	testScope</span><br><span class="line">	fmt.Println(age)	<span class="comment">// still 10</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testScope</span><span class="params">()</span></span>&#123;</span><br><span class="line">	fmt.Println(<span class="string">"Inside testScope"</span>)</span><br><span class="line"></span><br><span class="line">	fmt.Println(age)</span><br><span class="line">	<span class="keyword">var</span> age <span class="keyword">int8</span> = <span class="number">20</span>	<span class="comment">// overrides the value in the function level</span></span><br><span class="line">	fmt.Println(age)</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"Exited testScope"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Types"><a href="#Types" class="headerlink" title="Types"></a>Types</h2><p>Go is a <strong>statically typed programming language</strong>. Every variable in Golang has an associated type.</p>
<p>Data types classify a related set of data. They define how the data is stored in memory, what are the possible values that a variable of a particular data type can hold, and the operations that can be done on them.</p>
<h3 id="Basic-Types"><a href="#Basic-Types" class="headerlink" title="Basic Types"></a>Basic Types</h3><p>Go‚Äôs basic types are</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">string</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span>  <span class="keyword">int8</span>  <span class="keyword">int16</span>  <span class="keyword">int32</span>  <span class="keyword">int64</span>	<span class="comment">// signed</span></span><br><span class="line"><span class="keyword">uint</span> <span class="keyword">uint8</span> <span class="keyword">uint16</span> <span class="keyword">uint32</span> <span class="keyword">uint64</span> <span class="keyword">uintptr</span>	<span class="comment">// unsigned</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">byte</span> <span class="comment">// alias for uint8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">rune</span> <span class="comment">// alias for int32</span></span><br><span class="line">     <span class="comment">// represents a Unicode code point</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">float32</span> <span class="keyword">float64</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">complex64</span> <span class="keyword">complex128</span>	<span class="comment">// e.g. 0.867 + 0.5i. By default it will be type complex128</span></span><br></pre></td></tr></table></figure>
<p>The example shows variables of several types, and also that variable declarations may be ‚Äúfactored‚Äù into blocks, as with import statements.</p>
<p>The <code>int</code>, <code>uint</code>, and <code>uintptr</code> types are usually 32 bits wide on 32-bit systems and 64 bits wide on 64-bit systems. <strong>When you need an integer value you should use <code>int</code></strong> unless you have a specific reason to use a sized or unsigned integer type.</p>
<h3 id="Byte-and-Rune"><a href="#Byte-and-Rune" class="headerlink" title="Byte and Rune"></a>Byte and Rune</h3><p>Golang has two integer type aliases called <code>byte</code> and <code>rune</code> that are aliases for <code>uint8</code> and <code>int32</code> data types respectively -</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Alias For</th>
</tr>
</thead>
<tbody><tr>
<td>byte</td>
<td>uint8</td>
</tr>
<tr>
<td>rune</td>
<td>int32</td>
</tr>
</tbody></table>
<p>In Go, the <code>byte</code> and <code>rune</code> data types are used to <strong>distinguish characters from integer values</strong>.</p>
<p>Golang <strong>doesn‚Äôt have a <code>char</code> data type</strong>. It uses** <code>byte</code> and <code>rune</code> to represent character values<strong>. The **<code>byte</code> data type represents ASCII characters</strong> and the <strong><code>rune</code> data type represents</strong> a more broader set of Unicode characters that are encoded in <strong>UTF-8 format</strong>.</p>
<p>Characters are expressed in Golang by enclosing them in single quotes like this: ‚ÄòA‚Äô.</p>
<p><strong>The default type for character values is <code>rune</code></strong>. That means, if you don‚Äôt declare a type explicitly when declaring a variable with a character value, then Go will infer the type as <code>rune</code> -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> firstLetter = <span class="string">'A'</span> <span class="comment">// Type inferred as `rune` (Default type for character values)</span></span><br></pre></td></tr></table></figure>

<p>You can create a <code>byte</code> variable by explicitly specifying the type -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> lastLetter <span class="keyword">byte</span> = <span class="string">'Z'</span></span><br></pre></td></tr></table></figure>

<p>Both byte and rune data types are essentially integers. For example, a <code>byte</code> variable with value ‚Äòa‚Äô is converted to the integer 97. Similarly, a <code>rune</code> variable with a unicode value ‚Äò‚ô•‚Äô is converted to the corresponding unicode codepoint <code>U+2665</code>, where <code>U+</code> means unicode and the numbers are hexadecimal, which is essentially an integer.</p>
<h3 id="Operations-on-Numberic-Types"><a href="#Operations-on-Numberic-Types" class="headerlink" title="Operations on Numberic Types"></a>Operations on Numberic Types</h3><p>Go provides several operators for performing operations on numeric types -</p>
<ul>
<li>Arithmetic Operators: <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>%</code></li>
<li>Comparison Operators: <code>==</code>, <code>!=</code>, <code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>, <code>&gt;=</code></li>
<li>Bitwise Operators: <code>&amp;</code>, <code>|</code>, <code>^</code>, <code>&lt;&lt;</code>, <code>&gt;&gt;</code></li>
<li>Increment and Decrement Operators: <code>++</code>, <code>--</code></li>
<li>Assignment Operators: <code>+=</code>, <code>-=</code>, <code>*=</code>, <code>/=</code>, <code>%=</code>, <code>&lt;&lt;=</code>, <code>&gt;&gt;=</code>, <code>&amp;=</code>, <code>|=</code>, <code>^=</code></li>
</ul>
<p>Here is an example demonstrating some of the above operators -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"math"</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> a, b = <span class="number">4</span>, <span class="number">5</span></span><br><span class="line">	<span class="keyword">var</span> res1 = (a + b) * (a + b)/<span class="number">2</span>  <span class="comment">// Arithmetic operations</span></span><br><span class="line"></span><br><span class="line">	a++ <span class="comment">// Increment a by 1</span></span><br><span class="line"></span><br><span class="line">	b += <span class="number">10</span> <span class="comment">// Increment b by 10</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> res2 = a ^ b <span class="comment">// Bitwise XOR</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> r = <span class="number">3.5</span></span><br><span class="line">	<span class="keyword">var</span> res3 = math.Pi * r * r  <span class="comment">// Operations on floating-point type</span></span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">"res1 : %v, res2 : %v, res3 : %v\n"</span>, res1, res2, res3)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Output</span><br><span class="line">res1 : 40, res2 : 10, res3 : 38.48451000647496</span><br></pre></td></tr></table></figure>

<h3 id="Operations-on-Boolean-Types"><a href="#Operations-on-Boolean-Types" class="headerlink" title="Operations on Boolean Types"></a>Operations on Boolean Types</h3><p>You can use the following operators on boolean types -</p>
<ul>
<li>Logical Operators:<ul>
<li><code>&amp;&amp;</code> (logical conjunction, ‚Äúand‚Äù)</li>
<li><code>||</code> (logical disjunction, ‚Äúor‚Äù)</li>
<li><code>!</code>   (logical negation)</li>
</ul>
</li>
<li>Equality and Inequality: <ul>
<li><code>==</code> (‚Äúequals‚Äù)</li>
<li><code>!=</code> (‚Äúnot equals‚Äù)</li>
</ul>
</li>
</ul>
<p>The operators <strong><code>&amp;&amp;</code> and <code>||</code> follow short-circuiting rules</strong>. That means, in the expression <code>E1 &amp;&amp; E2</code>, if <code>E1</code> evaluates to <code>false</code> then <code>E2</code> won‚Äôt be evaluated. Similarly, in the expression <code>E1 || E2</code>, if <code>E1</code>evaluates to <code>true</code> then <code>E2</code> won‚Äôt be evaluated.</p>
<p>Here is an example of Boolean types-</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> truth = <span class="number">3</span> &lt;= <span class="number">5</span></span><br><span class="line">	<span class="keyword">var</span> falsehood = <span class="number">10</span> != <span class="number">10</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Short Circuiting</span></span><br><span class="line">	<span class="keyword">var</span> res1 = <span class="number">10</span> &gt; <span class="number">20</span> &amp;&amp; <span class="number">5</span> == <span class="number">5</span> <span class="comment">// Second operand is not evaluated since first evaluates to false</span></span><br><span class="line">	<span class="keyword">var</span> res2 = <span class="number">2</span>*<span class="number">2</span> == <span class="number">4</span> || <span class="number">10</span>%<span class="number">3</span> == <span class="number">0</span> <span class="comment">// Second operand is not evaluated since first evaluates to true</span></span><br><span class="line"></span><br><span class="line">	fmt.Println(truth, falsehood, res1, res2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Output</span><br><span class="line">true false false true</span><br></pre></td></tr></table></figure>

<h3 id="Operations-on-Complex-Types"><a href="#Operations-on-Complex-Types" class="headerlink" title="Operations on Complex Types"></a>Operations on Complex Types</h3><p>You can perform arithmetic operations like addition, subtraction, multiplication, and division on complex numbers -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> a = <span class="number">3</span> + <span class="number">5i</span></span><br><span class="line">	<span class="keyword">var</span> b = <span class="number">2</span> + <span class="number">4i</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> res1 = a + b</span><br><span class="line">	<span class="keyword">var</span> res2 = a - b</span><br><span class="line">	<span class="keyword">var</span> res3 = a * b</span><br><span class="line">	<span class="keyword">var</span> res4 = a / b</span><br><span class="line"></span><br><span class="line">	fmt.Println(res1, res2, res3, res4)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Output</span><br><span class="line">(5+9i) (1+1i) (-14+22i) (1.3-0.1i)</span><br></pre></td></tr></table></figure>

<h3 id="Strings"><a href="#Strings" class="headerlink" title="Strings"></a>Strings</h3><p>In Go, a string is a <strong>sequence of <code>bytes</code></strong>.</p>
<p>Strings in Golang are declared either using double quotes as in <code>&quot;Hello World&quot;</code> or back ticks as in <code>`Hello World`</code>.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Normal String (Can not contain newlines, and can have escape characters like `\n`, `\t` etc)</span></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">"Steve Jobs"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Raw String (Can span multiple lines. Escape characters are not interpreted)</span></span><br><span class="line"><span class="keyword">var</span> bio = <span class="string">`Steve Jobs was an American entrepreneur and inventor.</span></span><br><span class="line"><span class="string">           He was the CEO and co-founder of Apple Inc.`</span></span><br></pre></td></tr></table></figure>

<p><strong>Double-quoted strings cannot contain newlines</strong> but they <strong>can have escape characters</strong> like <code>\n</code>, <code>\t</code> etc. In double-quoted strings, a <code>\n</code> character is replaced with a newline, and a <code>\t</code> character is replaced with a tab space, and so on.</p>
<p>Strings enclosed within <strong>back ticks are raw strings</strong>. They <strong>can span multiple lines</strong>. Moreover, <strong>Escape characters don‚Äôt have any special meaning</strong> in raw strings.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> website = <span class="string">"\thttps://www.callicoder.com\t\n"</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> siteDescription = <span class="string">`\t\tCalliCoder is a programming blog where you can find</span></span><br><span class="line"><span class="string">                           practical guides and tutorials on programming languages, </span></span><br><span class="line"><span class="string">                           web development, and desktop app development.\t\n`</span></span><br><span class="line"></span><br><span class="line">    fmt.Println(website, siteDescription)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Output</span><br><span class="line">        https:&#x2F;&#x2F;www.callicoder.com      </span><br><span class="line"> \t\tCalliCoder is a programming blog where you can find</span><br><span class="line">                           practical guides and tutorials on programming languages, </span><br><span class="line">                           web development, and desktop app development.\t\n</span><br></pre></td></tr></table></figure>

<p>There is quite a lot about operations in String, which will be covered later, but not in this section.</p>
<h3 id="Type-Conversion"><a href="#Type-Conversion" class="headerlink" title="Type Conversion"></a>Type Conversion</h3><p>The expression T(v) converts the value v to the type T.</p>
<p>Some numeric conversions:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i <span class="keyword">int</span> = <span class="number">42</span></span><br><span class="line"><span class="keyword">var</span> f <span class="keyword">float64</span> = <span class="keyword">float64</span>(i)</span><br><span class="line"><span class="keyword">var</span> u <span class="keyword">uint</span> = <span class="keyword">uint</span>(f)</span><br></pre></td></tr></table></figure>

<p>Or, put more simply:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i := <span class="number">42</span></span><br><span class="line">f := <span class="keyword">float64</span>(i)</span><br><span class="line">u := <span class="keyword">uint</span>(f)</span><br></pre></td></tr></table></figure>

<p>Unlike in C, in Go assignment between items of different type requires an explicit conversion.</p>
<p>Additionally, Golang has <strong>a strong type system</strong>. It <strong>doesn‚Äôt allow you to mix numeric types in an expression</strong>. For example, You cannot add an <code>int</code> variable to a <code>float64</code> variable or even an <code>int</code> variable to an <code>int64</code> variable. You cannot even perform an assignment between mixed types -</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var a int64 &#x3D; 4</span><br><span class="line">var b int &#x3D; a  &#x2F;&#x2F; Compiler Error (Cannot use a (type in64) as type int in assignment)</span><br><span class="line"></span><br><span class="line">var c int &#x3D; 500</span><br><span class="line"></span><br><span class="line">var result &#x3D; a + c &#x2F;&#x2F; Compiler Error (Invalid Operation: mismatched types int64 and int)</span><br></pre></td></tr></table></figure>

<p>Unlike other statically typed languages like C, C++, and Java, <strong>Go doesn‚Äôt provide any implicit type conversion</strong>. </p>
<h2 id="Constants"><a href="#Constants" class="headerlink" title="Constants"></a>Constants</h2><p>In Golang, we use the term <strong><code>constant</code> to represent fixed (unchanging) values</strong> such as <code>5</code>, <code>1.34</code>, <code>true</code>, <code>&quot;Hello&quot;</code> etc.</p>
<p>Constants can be character, string, boolean, or numeric values. In fact, all the literals in Golang, be it integer literals like <code>5</code>, <code>1000</code>, or floating-point literals like <code>4.76</code>, <code>1.89</code>, or boolean literals like <code>true</code>, <code>false</code>, or string literals like <code>&quot;Hello&quot;</code>, <code>&quot;John&quot;</code> are constants (cannot be modified). This means that <strong>self-made types cannot be declared as <code>constant</code>s</strong>.</p>
<p>Some examples are:</p>
<table>
<thead>
<tr>
<th>Constants</th>
<th>Examples</th>
</tr>
</thead>
<tbody><tr>
<td>integer constants</td>
<td>1000, 67413</td>
</tr>
<tr>
<td>floating-point constants</td>
<td>4.56, 128.372</td>
</tr>
<tr>
<td>boolean constants</td>
<td>true, false</td>
</tr>
<tr>
<td>rune constants</td>
<td>‚ÄòC‚Äô, ‚Äò√§‚Äô</td>
</tr>
<tr>
<td>complex constants</td>
<td>2.7i, 3 + 5i</td>
</tr>
<tr>
<td>string constants</td>
<td>‚ÄúHello‚Äù, ‚ÄúRajeev‚Äù</td>
</tr>
</tbody></table>
<h3 id="Declaring-a-Constant"><a href="#Declaring-a-Constant" class="headerlink" title="Declaring a Constant"></a>Declaring a Constant</h3><p>Literals are basically constants without a name. To <strong>declare a constant and give it a name</strong>, you can <strong>use the <code>const</code> keyword</strong> like so -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sunRisesInTheEast = <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>You can also specify a type in the declaration like this -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a <span class="keyword">int</span> = <span class="number">1234</span></span><br><span class="line"><span class="keyword">const</span> b <span class="keyword">string</span> = <span class="string">"Hi"</span></span><br></pre></td></tr></table></figure>

<p>Multiple declarations in a single statement is also possible -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> country, code = <span class="string">"India"</span>, <span class="number">91</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	employeeId <span class="keyword">string</span> = <span class="string">"E101"</span></span><br><span class="line">	salary <span class="keyword">float64</span> = <span class="number">50000.0</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>Constants declarations are very similar to variable declaratios, except that <strong>constans cannot be declared using the <code>:=</code> syntax, but with <code>=</code></strong>.</p>
<h3 id="Typed-and-Untyped-Constants"><a href="#Typed-and-Untyped-Constants" class="headerlink" title="Typed and Untyped Constants"></a>Typed and Untyped Constants</h3><p>This basically has the same mechanism of a typed and an untyped variable. So it is not covered here again. Even the default types used for type inference are the same.</p>
<p>If you really would like to see the details on constants, please visit <a href="https://www.callicoder.com/golang-typed-untyped-constants/" target="_blank" rel="noopener">https://www.callicoder.com/golang-typed-untyped-constants/</a> for more details.</p>
<h2 id="Control-Flow-Statements"><a href="#Control-Flow-Statements" class="headerlink" title="Control Flow Statements"></a>Control Flow Statements</h2><p>Go has <strong>only one looping construct</strong>, the for loop.</p>
<h3 id="For-Loop"><a href="#For-Loop" class="headerlink" title="For Loop"></a>For Loop</h3><p>The basic for loop has three components separated by semicolons (same as Java):</p>
<ul>
<li>the init statement: executed before the first iteration</li>
<li>the condition expression: evaluated before every iteration</li>
<li>the post statement: executed at the end of every iteration</li>
</ul>
<p>The init statement will often be a short variable declaration, <strong>and the variables declared there are visible only in the scope of the for statement</strong>. Also, alike Java, <strong>the init and post statements are optional</strong>. For example:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	sum := <span class="number">1</span></span><br><span class="line">	<span class="keyword">for</span> ; sum &lt; <span class="number">1000</span>; &#123;</span><br><span class="line">		sum += sum</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(sum)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Unlike other languages like C, Java, or JavaScript there are <strong>no parentheses surrounding the three components of the for statement</strong> and the <strong>braces <code>{ }</code> for code block are always required</strong>.</p>
<h3 id="‚ÄúWhile‚Äù-Loop"><a href="#‚ÄúWhile‚Äù-Loop" class="headerlink" title="‚ÄúWhile‚Äù Loop"></a>‚ÄúWhile‚Äù Loop</h3><p>There is no actual <code>while</code> loop in Go. However, since the init and post statements are optional, the <code>for</code> loop abbreviated <strong>could be used as a while loop</strong>:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	sum := <span class="number">1</span></span><br><span class="line">	<span class="keyword">for</span> sum &lt; <span class="number">1000</span> &#123;	<span class="comment">// equivalent as while(sum &lt; 1000) in Java</span></span><br><span class="line">		sum += sum</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(sum)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>If you <strong>omit the loop condition it loops forever</strong>, so an infinite loop is compactly expressed.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> &#123;	<span class="comment">// same as while(true) in Java</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Break-Continue-in-For-Loop"><a href="#Break-Continue-in-For-Loop" class="headerlink" title="Break/Continue in For Loop"></a>Break/Continue in For Loop</h3><p>You can use <code>break</code> statement to break out of a loop before its normal termination. Here is an example -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> num := <span class="number">1</span>; num &lt;= <span class="number">100</span>; num++ &#123;</span><br><span class="line">		<span class="keyword">if</span> num%<span class="number">3</span> == <span class="number">0</span> &amp;&amp; num%<span class="number">5</span> == <span class="number">0</span> &#123;</span><br><span class="line">			fmt.Printf(<span class="string">"First positive number divisible by both 3 and 5 is %d\n"</span>, num)</span><br><span class="line">			<span class="keyword">break</span>	<span class="comment">// same as other languages</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Similarly, the <code>continue</code> statement is <strong>used to stop running the loop body midway and continue to the next iteration of the loop</strong>.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> num := <span class="number">1</span>; num &lt;= <span class="number">10</span>; num++ &#123;</span><br><span class="line">		<span class="keyword">if</span> num%<span class="number">2</span> == <span class="number">0</span> &#123;</span><br><span class="line">			<span class="keyword">continue</span>	<span class="comment">// same as other languages</span></span><br><span class="line">		&#125;</span><br><span class="line">		fmt.Printf(<span class="string">"%d "</span>, num)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="if-else-if-else-Control-Flow"><a href="#if-else-if-else-Control-Flow" class="headerlink" title="if/else if/else Control Flow"></a><code>if</code>/<code>else if</code>/<code>else</code> Control Flow</h3><p>Go‚Äôs <code>if</code>/<code>else if</code>/<code>else</code> statements are like its for loops; <strong>the expression need not be surrounded by parentheses <code>( )</code></strong> but <strong>the braces <code>{ }</code> are required</strong>.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> x = <span class="number">25</span>		<span class="comment">// inferred as int</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> x % <span class="number">5</span> == <span class="number">0</span> &#123;		<span class="comment">// you could surrond it with ( ), but it is optional in Go</span></span><br><span class="line">		fmt.Printf(<span class="string">"%d is a multiple of 5\n"</span>, x)</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		fmt.Printf(<span class="string">"%d is a not multiple of 5\n"</span>, x)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The <code>else if</code> is similar to <code>if</code>, except that there can be multiple of them:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> BMI = <span class="number">21.0</span></span><br><span class="line">	<span class="keyword">if</span> BMI &lt; <span class="number">18.5</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"You are underweight"</span>);</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> BMI &gt;= <span class="number">18.5</span> &amp;&amp; BMI &lt; <span class="number">25.0</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"Your weight is normal"</span>);</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> BMI &gt;= <span class="number">25.0</span> &amp;&amp; BMI &lt; <span class="number">30.0</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"You're overweight"</span>)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"You're obese"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="if-else-if-Short-Declaration"><a href="#if-else-if-Short-Declaration" class="headerlink" title="if/else if Short Declaration"></a><code>if</code>/<code>else if</code> Short Declaration</h3><p>Like for, the <code>if/else if</code> statement can start with a short statement to execute before the condition.</p>
<p>Variables declared by the statement are only <strong>in scope until the end of the entire <code>if</code>/<code>else if</code>/<code>else</code> loop</strong>. For example:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">IfWithShortStatement</span> <span class="params">(input <span class="keyword">int</span>)</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> upper,lower:= <span class="number">100</span>, <span class="number">0</span>; input &lt; upper &amp;&amp; upper &gt; lower &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"%d is within %d and %d, exclusive\n"</span>,input,lower,upper)</span><br><span class="line">	&#125;<span class="keyword">else</span> <span class="keyword">if</span> upper,lower = <span class="number">200</span>,<span class="number">100</span>; input &lt; upper &amp;&amp; upper &gt; lower &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"%d is within %d and %d, exclusive\n"</span>,input,lower,upper)</span><br><span class="line">	&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"current number is: high %d, low %d\n"</span>,upper,lower)	<span class="comment">// upper and lower is still available here</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// here, both variables will no longer be available</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Note that, <strong>if you‚Äôre using a short statement</strong>, then you <strong>can‚Äôt use parentheses</strong>. So the following code will generate a syntax error -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// You can't use parentheses when `if` contains a short statement</span></span><br><span class="line"><span class="keyword">if</span> (n := <span class="number">15</span>; n%<span class="number">2</span> == <span class="number">0</span>) &#123; <span class="comment">// Syntax Error</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Switch-Statement"><a href="#Switch-Statement" class="headerlink" title="Switch Statement"></a>Switch Statement</h3><p>A switch statement is a shorter way to write a sequence of <code>if</code> - <code>else</code> statements. It <strong>runs the first case whose value is equal to the condition expression</strong>.</p>
<p>Go‚Äôs switch is like the one in C, C++, Java, JavaScript, and PHP, except that <strong>Go only runs the selected case</strong>, not all the cases that follow. In effect, <strong>the <code>break</code> statement that is needed at the end of each case in those languages is provided automatically in Go</strong>. </p>
<p>Another important difference is that <strong>Go‚Äôs switch cases need not be constants</strong>, and the <strong>values involved need not be integers</strong>.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"runtime"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Print(<span class="string">"Go runs on "</span>)</span><br><span class="line">	<span class="keyword">switch</span> os := runtime.GOOS; os &#123;		<span class="comment">// so the variable os is the switch condition</span></span><br><span class="line">	<span class="keyword">case</span> <span class="string">"darwin"</span>:</span><br><span class="line">		fmt.Println(<span class="string">"OS X."</span>)</span><br><span class="line">	<span class="keyword">case</span> <span class="string">"linux"</span>:</span><br><span class="line">		fmt.Println(<span class="string">"Linux."</span>)</span><br><span class="line">	<span class="keyword">case</span> <span class="string">"windows"</span>:</span><br><span class="line">		fmt.Println(<span class="string">"Windows"</span>)</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="comment">// freebsd, openbsd,</span></span><br><span class="line">		<span class="comment">// plan9</span></span><br><span class="line">		fmt.Printf(<span class="string">"%s.\n"</span>, os)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Switch-Without-A-Condition"><a href="#Switch-Without-A-Condition" class="headerlink" title="Switch Without A Condition"></a>Switch Without A Condition</h3><p>Switch <strong>without a condition</strong> is the same as <code>switch true</code>.</p>
<p>This construct can be a clean way to write long if-then-else chains.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	t := time.Now()</span><br><span class="line">	<span class="keyword">switch</span> &#123;</span><br><span class="line">	<span class="keyword">case</span> t.Hour() &lt; <span class="number">12</span>:</span><br><span class="line">		fmt.Println(<span class="string">"Good morning!"</span>)</span><br><span class="line">	<span class="keyword">case</span> t.Hour() &lt; <span class="number">17</span>:</span><br><span class="line">		fmt.Println(<span class="string">"Good afternoon."</span>)</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		fmt.Println(<span class="string">"Good evening."</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Defer"><a href="#Defer" class="headerlink" title="Defer"></a>Defer</h3><p>A defer statement defers the <strong>execution of a function until the surrounding function returns</strong> (it is like the <code>finally</code> cause in a <code>try</code> block in Java)</p>
<p>The deferred call‚Äôs arguments <strong>are evaluated immediately, but the function call is not executed until the surrounding function returns</strong>.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Go program to illustrate the </span></span><br><span class="line"><span class="comment">// concept of the defer statement </span></span><br><span class="line"><span class="keyword">package</span> main </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">// Functions </span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mul</span><span class="params">(a1, a2 <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123; </span><br><span class="line">  </span><br><span class="line">    res := a1 * a2 </span><br><span class="line">    fmt.Println(<span class="string">"Result: "</span>, res) </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> </span><br><span class="line">&#125; </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">show</span><span class="params">()</span></span> &#123; </span><br><span class="line">    fmt.Println(<span class="string">"Hello!, GeeksforGeeks"</span>) </span><br><span class="line">&#125; </span><br><span class="line">  </span><br><span class="line"><span class="comment">// Main function </span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123; </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// Calling mul() function </span></span><br><span class="line">    <span class="comment">// Here mul function behaves </span></span><br><span class="line">    <span class="comment">// like a normal function </span></span><br><span class="line">    mul(<span class="number">23</span>, <span class="number">45</span>) </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// Calling mul()function </span></span><br><span class="line">    <span class="comment">// Using defer keyword </span></span><br><span class="line">    <span class="comment">// Here the mul() function </span></span><br><span class="line">    <span class="comment">// is defer function </span></span><br><span class="line">    <span class="keyword">defer</span> mul(<span class="number">23</span>, <span class="number">56</span>) </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// Calling show() function twice</span></span><br><span class="line">    show()</span><br><span class="line">	show() </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Output:</span><br><span class="line"></span><br><span class="line">Result:  1035</span><br><span class="line">Hello!, GeeksforGeeks</span><br><span class="line">Hello!, GeeksforGeeks</span><br><span class="line">Result:  1288</span><br></pre></td></tr></table></figure>

<h3 id="Stacking-Defers"><a href="#Stacking-Defers" class="headerlink" title="Stacking Defers"></a>Stacking Defers</h3><p>Deferred function calls are pushed onto a stack. When a function returns, its** deferred calls are executed in last-in-first-out order**.</p>
<p>For example, <code>9</code> will be the first result that you will see:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"counting"</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">		<span class="keyword">defer</span> fmt.Println(i)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"done"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Pointers"><a href="#Pointers" class="headerlink" title="Pointers"></a>Pointers</h2><p>(additional reference: <a href="https://www.callicoder.com/golang-pointers/a" target="_blank" rel="noopener">https://www.callicoder.com/golang-pointers/a</a>)</p>
<p>Go has pointers. <strong>A pointer holds the memory address of a value</strong>.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A pointer of type T</span></span><br><span class="line"><span class="keyword">var</span> p *T</span><br></pre></td></tr></table></figure>

<p>The type <code>*T</code> is a pointer to a <code>T</code> value. Its zero value is <code>nil</code>. For example:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a pointer of type int</span></span><br><span class="line"><span class="keyword">var</span> p *<span class="keyword">int</span></span><br></pre></td></tr></table></figure>
<p>The above pointer can <strong>only store the memory address of <code>int</code> variables</strong>.</p>
<h3 id="Initializing-a-Pointer"><a href="#Initializing-a-Pointer" class="headerlink" title="Initializing a Pointer"></a>Initializing a Pointer</h3><p>To initialize a pointer with the memory address of another variable you can use <code>&amp;</code>. <strong>The address of a variable can be retrieved using the <code>&amp;</code> operator</strong>:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">i := <span class="number">42</span></span><br><span class="line"><span class="keyword">var</span> p *<span class="keyword">int</span> = &amp;i</span><br></pre></td></tr></table></figure>

<p>Just like the other types, <strong>pointers can also be inferred</strong> by Go:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">i := <span class="number">42</span></span><br><span class="line">p := &amp;i		<span class="comment">// var p = &amp;i, both are equivalent as above</span></span><br></pre></td></tr></table></figure>

<h3 id="Dereferening-a-Pointer"><a href="#Dereferening-a-Pointer" class="headerlink" title="Dereferening a Pointer"></a>Dereferening a Pointer</h3><p>The <strong><code>*</code> operator on a variable (not a type)</strong> denotes the <strong>pointer‚Äôs underlying value by going to that address and fetching its value</strong>.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fmt.Println(*p) <span class="comment">// read i through the pointer p</span></span><br><span class="line">*p = <span class="number">21</span>         <span class="comment">// set i through the pointer p</span></span><br></pre></td></tr></table></figure>
<p>This is known as ‚Äúdereferencing‚Äù or ‚Äúindirecting‚Äù.</p>
<p>However, you <strong>if use a pointer on another pointer</strong>, then:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">p2 = &amp;p1	<span class="comment">// where p1 is already a pointer pointing to a variable</span></span><br><span class="line">fmt.Println(*p2)	<span class="comment">// retrieves the address that p1 stores</span></span><br><span class="line">fmt.Prinln(**p2)	<span class="comment">// retrieves the value that p1's address points to</span></span><br></pre></td></tr></table></figure>

<p>You can not only access the value of the pointed variable using <code>*</code> operator, but you <strong>can change it as well</strong>. The following example <strong>sets the value stored in the variable <code>a</code></strong> through the pointer p -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> a = <span class="number">1000</span></span><br><span class="line">	<span class="keyword">var</span> p = &amp;a</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"a (before) = "</span>, a)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Changing the value stored in the pointed variable through the pointer</span></span><br><span class="line">	*p = <span class="number">2000</span></span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"a (after) = "</span>, a)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Output</span><br><span class="line">a (before) &#x3D;  1000</span><br><span class="line">a (after) &#x3D;  2000</span><br></pre></td></tr></table></figure>

<h3 id="Creating-a-Pointer-using-the-built-in-new-function"><a href="#Creating-a-Pointer-using-the-built-in-new-function" class="headerlink" title="Creating a Pointer using the built-in new() function"></a>Creating a Pointer using the built-in <code>new()</code> function</h3><p>You can also create a pointer using the built-in <code>new()</code> function. The <code>new()</code> function <strong>takes a type as an argument</strong>, allocates enough memory to accommodate a value of that type, <strong>initializes it with the zero value</strong> and <strong>returns a pointer to it</strong>.</p>
<p>Here is an example -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	ptr := <span class="built_in">new</span>(<span class="keyword">int</span>) <span class="comment">// Pointer to an `int` type, at this point *ptr is 0</span></span><br><span class="line">	*ptr = <span class="number">100</span>	<span class="comment">// now *ptr is 100</span></span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">"Ptr = %#x, Ptr value = %d\n"</span>, ptr, *ptr)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Output</span><br><span class="line">Ptr &#x3D; 0xc420014058, Ptr value &#x3D; 100</span><br></pre></td></tr></table></figure>

<p>However, unlike C, Go has <strong>no pointer arithmetic</strong>. For example, you <strong>cannot increment/decrement a pointer to move to the next/previous memory address</strong>. You <strong>cannot add or subtract an integer value to/from a pointer</strong>. You can also compare two pointers using relational operators <code>&lt;</code>, <code>&gt;</code> etc. Any such operation will result in a compile time error:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> x = <span class="number">67</span></span><br><span class="line">	<span class="keyword">var</span> p = &amp;x</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> p1 = p + <span class="number">1</span> <span class="comment">// Compiler Error: invalid operation</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You can, however, <strong>compare two pointers of the same type for equality using <code>==</code> operator</strong>. This basically compares the address stored, if they have the <strong>same address, then it returns <code>true</code></strong>, <strong>otherwise <code>false</code></strong>.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> a = <span class="number">75</span></span><br><span class="line">	<span class="keyword">var</span> p1 = &amp;a</span><br><span class="line">	<span class="keyword">var</span> p2 = &amp;a</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> p1 == p2 &#123;</span><br><span class="line">		fmt.Println(<span class="string">"Both pointers p1 and p2 point to the same variable."</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Structs"><a href="#Structs" class="headerlink" title="Structs"></a>Structs</h2><p>(additional reference: <a href="https://www.callicoder.com/golang-structs/" target="_blank" rel="noopener">https://www.callicoder.com/golang-structs/</a>)</p>
<p>A struct is a user-defined type that contains a collection of named fields/properties. It is used to group related data together to form a single unit.</p>
<p>If you‚Äôre coming from an object-oriented background, you can think of a struct as <strong>a lightweight class that supports composition but NOT inheritance</strong>.</p>
<h3 id="Defining-a-Struct-Type"><a href="#Defining-a-Struct-Type" class="headerlink" title="Defining a Struct Type"></a>Defining a Struct Type</h3><p>You can define a new <code>struct</code> type like this -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;	<span class="comment">// note this is a curly brace</span></span><br><span class="line">	FirstName <span class="keyword">string</span>	<span class="comment">// you could also use: FirstName,Lastname string</span></span><br><span class="line">	LastName  <span class="keyword">string</span></span><br><span class="line">	Age       <span class="keyword">int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>The <code>type</code> keyword introduces a new type</strong>. It is followed by the name of the type (<code>Person</code>) and the keyword <strong><code>struct</code> to indicate that we‚Äôre defining a <code>struct</code></strong> (another option would be <code>interface</code>, which will be covered later). The <code>struct</code> contains a list of fields inside the <strong>curly braces { }</strong>. Each field has a name and a type.</p>
<h3 id="Instantiating-a-Struct-Type"><a href="#Instantiating-a-Struct-Type" class="headerlink" title="Instantiating a Struct Type"></a>Instantiating a Struct Type</h3><p>Just like other data types, you can declare a variable of a struct type like this -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Declares a variable of type 'Person'</span></span><br><span class="line"><span class="keyword">var</span> p Person <span class="comment">// All the struct fields are initialized with their zero value</span></span><br></pre></td></tr></table></figure>

<p>The above code creates a variable of <strong>type <code>Person</code> that is by default set to zero</strong>. For a <code>struct</code>, zero means <strong>all the fields are set to their corresponding zero value</strong>. So the fields <code>FirstName</code> and <code>LastName</code> are set to <code>&quot;&quot;</code>, and <code>Age</code> is set to <code>0</code>.</p>
<p>You can <strong>initialize a variable of a <code>struct</code> type</strong> by passing in values required by that struct with <code>{ }</code> -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Initialize a struct by supplying the value of all the struct fields.</span></span><br><span class="line"><span class="keyword">var</span> p = Person&#123;<span class="string">"Rajeev"</span>, <span class="string">"Singh"</span>, <span class="number">26</span>&#125;</span><br></pre></td></tr></table></figure>

<p>Note that you <strong>need to pass the field values in the same order in which they are declared in the struct (if you don‚Äôt specify the variable names)</strong>. Also, you can‚Äôt initialize only a subset of fields with the above syntax -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p = Person&#123;<span class="string">"Rajeev"</span>&#125; <span class="comment">// Compiler Error: too few values in struct initializer</span></span><br></pre></td></tr></table></figure>

<p>However, Go also supports the <code>name: value</code> syntax for initializing a <code>struct</code>, so that the <strong>order of fields becomes irrelevant</strong>.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p = Person&#123;LastName: <span class="string">"Singh"</span>, Age: <span class="number">25</span>, FirstName: <span class="string">"Rajeev"</span>&#125;</span><br></pre></td></tr></table></figure>

<p>The <strong><code>name: value</code> syntax</strong> allows you to <strong>initialize only a subset of fields</strong>. All the uninitialized fields are set to their corresponding zero value:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p = Person&#123;FirstName: <span class="string">"Alien"</span>&#125; <span class="comment">// LastName: "", Age: 0</span></span><br></pre></td></tr></table></figure>

<h3 id="Accessing-fields-of-a-Struct"><a href="#Accessing-fields-of-a-Struct" class="headerlink" title="Accessing fields of a Struct"></a>Accessing fields of a Struct</h3><p>This is same as accessing the field of a Java object - you use the <code>.</code> operator:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Car <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name, Model, Color <span class="keyword">string</span></span><br><span class="line">	WeightInKg         <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	c := Car&#123;</span><br><span class="line">		Name:       <span class="string">"Ferrari"</span>,</span><br><span class="line">		Model:      <span class="string">"GTC4"</span>,</span><br><span class="line">		Color:      <span class="string">"Red"</span>,</span><br><span class="line">		WeightInKg: <span class="number">1920</span>,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Accessing struct fields using the dot operator</span></span><br><span class="line">	fmt.Println(<span class="string">"Car Name: "</span>, c.Name)</span><br><span class="line">	fmt.Println(<span class="string">"Car Color: "</span>, c.Color)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Assigning a new value to a struct field</span></span><br><span class="line">	c.Color = <span class="string">"Black"</span></span><br><span class="line">	fmt.Println(<span class="string">"Car: "</span>, c)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Pointer-to-Structs"><a href="#Pointer-to-Structs" class="headerlink" title="Pointer to Structs"></a>Pointer to Structs</h3><p>Similar to those built-in <code>struct</code>s, you can <strong>get a pointer to a <code>struct</code> using the <code>&amp;</code> operator on it</strong> -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">	RollNumber <span class="keyword">int</span></span><br><span class="line">	Name       <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// instance of student struct type</span></span><br><span class="line">	s := Student&#123;<span class="number">11</span>, <span class="string">"Jack"</span>&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Pointer to the student struct</span></span><br><span class="line">	ps := &amp;s</span><br><span class="line">	fmt.Println(ps)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Accessing struct fields via pointer</span></span><br><span class="line">	fmt.Println((*ps).Name)</span><br><span class="line">	fmt.Println(ps.Name) <span class="comment">// Same as above: No need to explicitly dereference the pointer</span></span><br><span class="line"></span><br><span class="line">	ps.RollNumber = <span class="number">31</span></span><br><span class="line">	fmt.Println(ps)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Notice that. to access the field <code>X</code> of a struct when we have the struct pointer <code>p</code> we could write <code>(*p).X</code>. However, that notation is cumbersome, so the language <strong>permits us instead to write just <code>p.X</code>, without the explicit dereference (it only dereferences for one level, so nested pointers still need <code>*</code>)</strong>.</p>
<h3 id="Creating-a-struct-using-the-built-in-new-function"><a href="#Creating-a-struct-using-the-built-in-new-function" class="headerlink" title="Creating a struct using the built-in new() function"></a>Creating a <code>struct</code> using the built-in <code>new()</code> function</h3><p>You can also <strong>use the built-in <code>new()</code></strong> function to create an instance of a struct, but alike its previous usage, it <strong>returns to you the address of that <code>struct</code></strong>. The <code>new()</code> function allocates enough memory to fit all the struct fields, <strong>sets each of them to their zero value and returns a pointer to the newly allocated <code>struct</code></strong> -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Employee <span class="keyword">struct</span> &#123;</span><br><span class="line">	Id   <span class="keyword">int</span></span><br><span class="line">	Name <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// You can also get a pointer to a struct using the built-in new() function</span></span><br><span class="line">	<span class="comment">// It allocates enough memory to fit a value of the given struct type, and returns a pointer to it</span></span><br><span class="line">	pEmp := <span class="built_in">new</span>(Employee)</span><br><span class="line"></span><br><span class="line">	pEmp.Id = <span class="number">1000</span></span><br><span class="line">	pEmp.Name = <span class="string">"Sachin"</span></span><br><span class="line"></span><br><span class="line">	fmt.Println(pEmp)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Exported-and-Unexported-Fields-in-a-Struct"><a href="#Exported-and-Unexported-Fields-in-a-Struct" class="headerlink" title="Exported and Unexported Fields in a Struct"></a>Exported and Unexported Fields in a Struct</h3><p>Any <code>struct</code> type that starts with a capital letter is exported and accessible from outside packages. Similarly, <strong>any <code>struct</code> field that starts with a capital letter is exported (visible outside package)</strong>.</p>
<p>On the contrary, all the names starting with a small letter are visible only inside the same package.</p>
<p>Let‚Äôs see an example. Consider the following package hierarchy of our Go program -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> model</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Customer <span class="keyword">struct</span> &#123;  <span class="comment">// exported struct type</span></span><br><span class="line">	Id <span class="keyword">int</span>				<span class="comment">// exported field</span></span><br><span class="line">	Name <span class="keyword">string</span>			<span class="comment">// exported field</span></span><br><span class="line">	addr address        <span class="comment">// unexported field (only accessible inside package `model`)</span></span><br><span class="line">	married <span class="keyword">bool</span>  		<span class="comment">// unexported field (only accessible inside package `model`)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then, to initialize the <code>Customer</code> struct, you would <strong>need to explicitly use the <code>name: value</code> declaration</strong>:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"example/model"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	c := model.Customer&#123;</span><br><span class="line">		Id: <span class="number">1</span>, </span><br><span class="line">		Name: <span class="string">"Rajeev Singh"</span>,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	c.married = <span class="literal">true</span>	<span class="comment">// Error: can not refer to unexported field or method</span></span><br><span class="line"></span><br><span class="line">	a := model.address&#123;&#125; <span class="comment">// Error: can not refer to unexported name</span></span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"Programmer = "</span>, c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In the above example, if you use <code>c := model.Customer{1,&quot;Rajjev Singh&quot;}</code>, it will give you <code>Compile Error</code>.</p>
<h3 id="Structs-and-Short-Declarations"><a href="#Structs-and-Short-Declarations" class="headerlink" title="Structs and Short Declarations"></a>Structs and Short Declarations</h3><p>Now, since pointers are used to store a reference to a piece of data, <strong>(short) variable declarations without specifying a pointer actually make a new copy of the variable</strong>:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// the below three all have the same value but different memory address</span></span><br><span class="line"></span><br><span class="line">a1 := <span class="number">10</span></span><br><span class="line">a2 := a1</span><br><span class="line"><span class="keyword">var</span> a3 <span class="keyword">int</span> = a1</span><br></pre></td></tr></table></figure>

<p>This is the same with using a <code>struct</code>:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Point <span class="keyword">struct</span> &#123;</span><br><span class="line">	X <span class="keyword">float64</span></span><br><span class="line">	Y <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// Structs are value types.</span></span><br><span class="line">	p1 := Point&#123;<span class="number">10</span>, <span class="number">20</span>&#125;</span><br><span class="line">	p2 := p1 <span class="comment">// A COPY of the struct `p1` is assigned to `p2`</span></span><br><span class="line">	fmt.Println(<span class="string">"p1 = "</span>, p1)</span><br><span class="line">	fmt.Println(<span class="string">"p2 = "</span>, p2)</span><br><span class="line"></span><br><span class="line">	p2.X = <span class="number">15</span>	<span class="comment">// does not change p1</span></span><br><span class="line">	fmt.Println(<span class="string">"\nAfter modifying p2:"</span>)</span><br><span class="line">	fmt.Println(<span class="string">"p1 = "</span>, p1)</span><br><span class="line">	fmt.Println(<span class="string">"p2 = "</span>, p2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Equality"><a href="#Equality" class="headerlink" title="Equality =="></a>Equality <code>==</code></h3><p>This means that if you <strong>use <code>==</code> between two <code>struct</code>s</strong>, it <strong>compares the actual value of the fields in that <code>struct</code></strong>. This is diffrent from Java, where <code>==</code> would be used to compare the memory address (you can compare addresses <strong>if you are comparing two pointers</strong>).</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Point <span class="keyword">struct</span> &#123;</span><br><span class="line">	X <span class="keyword">float64</span></span><br><span class="line">	Y <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// Two structs are equal if all their corresponding fields are equal.</span></span><br><span class="line">	p1 := Point&#123;<span class="number">3.4</span>, <span class="number">5.2</span>&#125;</span><br><span class="line">	p2 := Point&#123;<span class="number">3.4</span>, <span class="number">5.2</span>&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> p1 == p2 &#123;</span><br><span class="line">		fmt.Println(<span class="string">"Point p1 and p2 are equal."</span>)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"Point p1 and p2 are not equal."</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Output</span><br><span class="line">Point p1 and p2 are equal.</span><br></pre></td></tr></table></figure>

<h2 id="Arrays"><a href="#Arrays" class="headerlink" title="Arrays"></a>Arrays</h2><p>(additional reference: <a href="https://www.callicoder.com/golang-arrays/" target="_blank" rel="noopener">https://www.callicoder.com/golang-arrays/</a>)</p>
<p>An array is a fixed-size collection of elements of the same type. The elements of the array are stored sequentially and can be accessed using their index. (Similar to other programming languages)</p>
<h3 id="Declaring-an-Array"><a href="#Declaring-an-Array" class="headerlink" title="Declaring an Array"></a>Declaring an Array</h3><p>The <strong>type <code>[n]T</code></strong> is an <strong>array of n values</strong> of <strong>type <code>T</code></strong>.</p>
<p>The expression:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a [<span class="number">10</span>]<span class="keyword">int</span></span><br></pre></td></tr></table></figure>
<p>declares a <strong>variable <code>a</code> as an array of ten integers (<code>int</code>)</strong>.</p>
<p>An array‚Äôs length is part of its type, so arrays cannot be resized. This seems limiting, but don‚Äôt worry; Go provides a convenient way of working with arrays.</p>
<p>Now let‚Äôs see a complete example -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> x [<span class="number">5</span>]<span class="keyword">int</span> <span class="comment">// An array of 5 integers</span></span><br><span class="line">	fmt.Println(x)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> y [<span class="number">8</span>]<span class="keyword">string</span> <span class="comment">// An array of 8 strings</span></span><br><span class="line">	fmt.Println(y)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> z [<span class="number">3</span>]<span class="keyword">complex128</span> <span class="comment">// An array of 3 complex numbers</span></span><br><span class="line">	fmt.Println(z)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Output</span><br><span class="line">[0 0 0 0 0]</span><br><span class="line">[       ]</span><br><span class="line">[(0+0i) (0+0i) (0+0i)]</span><br></pre></td></tr></table></figure>

<p>By default, all the array elements are initialized with the zero value of the corresponding array type.</p>
<p>You can <strong>declare and initialize an array at the same time</strong> like this (similar to Java) -</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Declaring and initializing an array at the same time</span></span><br><span class="line"><span class="keyword">var</span> a = [<span class="number">5</span>]<span class="keyword">int</span>&#123;<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>&#125;</span><br></pre></td></tr></table></figure>

<p>You can also let Go <strong>infer the size of an array at initialization time</strong>:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arr := []<span class="keyword">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;		<span class="comment">// infers the size to 5</span></span><br><span class="line">fmt.Println(<span class="built_in">len</span>(arr))</span><br></pre></td></tr></table></figure>

<h3 id="Slices"><a href="#Slices" class="headerlink" title="Slices"></a>Slices</h3><p>An array has a fixed size. A slice, on the other hand, is a dynamically-sized, flexible view into the elements of an array. In practice, slices are much more common than arrays.</p>
<p>The type <code>[]T</code> can also be seen as <strong>a slice with elements of type <code>T</code></strong>.</p>
<p>A slice is formed by specifying two indices, a low and high bound, separated by a colon:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a[low : high]</span><br></pre></td></tr></table></figure>

<p>This selects a half-open range which <strong>includes the first element, but excludes the last one</strong> (alike Python).</p>
<p>The following expression creates a slice which <strong>includes elements 1 through 3</strong> of <code>a</code>:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a[<span class="number">1</span>:<span class="number">4</span>] 	<span class="comment">// takes elements 1 to 3, inclusive</span></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/06/15/Go-Manual/" data-id="ckbgcm43g0000r8orh3afhr12" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Spring-Framework-Guide" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/06/09/Spring-Framework-Guide/" class="article-date">
  <time datetime="2020-06-09T07:25:30.000Z" itemprop="datePublished">2020-06-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/06/09/Spring-Framework-Guide/">Spring Framework Guide</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<p><strong>IMPORTANT</strong>:<br>Much of the content here is a personal summary/abbrieviation of contents on the <a href="https://docs.spring.io/spring/docs/5.3.0-SNAPSHOT/spring-framework-reference/index.html" target="_blank" rel="noopener">Offical Spring Framework Documentation</a>. For more complete information, please refer to the offical site.</p>
<hr>
<p>This is a <strong>Guide</strong>, since it is mostly <strong>conceptual</strong> and does not include much actual coding (except for examples illustrating those concepts). For more practical uses/examples, please refer to the <a href="https://jasonyux.github.io/2020/06/09/SpringBoot-Manual/" target="_blank" rel="noopener">Spring Boot Manual</a> or the <a href>Spring Cloud Manual</a>.</p>
<h2 id="Spring-Intro"><a href="#Spring-Intro" class="headerlink" title="Spring Intro"></a>Spring Intro</h2><p>The term ‚ÄúSpring‚Äù means different things in different contexts. It can be used to refer to the Spring Framework project itself, which is where it all started. Over time, other Spring projects have been built on top of the Spring Framework. Most often, when people say ‚ÄúSpring‚Äù, they mean the entire family of projects. This reference documentation focuses on the foundation: the Spring Framework itself.</p>
<p>When you learn about a framework, it‚Äôs important to know not only what it does but <strong>what principles it follows</strong>. Here are the guiding principles of the Spring Framework:</p>
<ul>
<li>Provide choice at every level. Spring lets you <strong>defer design decisions as late as possible</strong>. For example, you can switch persistence providers through configuration without changing your code. </li>
<li>Accommodate diverse perspectives. Spring embraces flexibility and is not opinionated about how things should be done. It <strong>supports a wide range of application needs with different perspectives</strong>.</li>
<li>Maintain strong backward compatibility. Spring‚Äôs evolution has been carefully managed to force <strong>few breaking changes between versions.</strong> Spring supports a carefully chosen range of JDK versions and third-party libraries to facilitate maintenance of applications and libraries that depend on Spring.</li>
<li>Care about API design. The Spring team puts a lot of thought and time into <strong>making APIs that are intuitive and that hold up across many versions and many years.</strong></li>
<li>Set high standards for code quality. The Spring Framework puts a strong emphasis on meaningful, current, and accurate javadoc. It is one of very few projects that can claim <strong>clean code structure with no circular dependencies between packages.</strong></li>
</ul>
<h2 id="IoC-Inversion-of-Control"><a href="#IoC-Inversion-of-Control" class="headerlink" title="IoC - Inversion of Control"></a>IoC - Inversion of Control</h2><p>IoC is also known as <strong>dependency injection (DI)</strong>. It is a process whereby <strong>objects define their dependencies</strong> (that is, the other objects they work with) <strong><em>only</em></strong> <strong>through constructor arguments</strong>, arguments to a factory method, or properties that are set on the object instance after it is constructed or returned from a factory method. The <strong>container then injects those dependencies when it creates the bean.</strong> This process is fundamentally the inverse (hence the name, Inversion of Control) of the bean itself controlling the instantiation or location of its dependencies by using direct construction of classes or a mechanism such as the Service Locator pattern.</p>
<p>In Spring, the <strong>objects that form the backbone of your application and that are managed by the Spring IoC container</strong> are called <strong>beans</strong>. A bean is an object that is instantiated, assembled, and otherwise managed by a Spring IoC container. Otherwise, a bean is simply one of many objects in your application. Beans, and the dependencies among them, are <strong>reflected in the configuration metadata used by a container.</strong></p>
<p>The <strong>main tasks performed by IoC container</strong> are:</p>
<ul>
<li>to instantiate the application class</li>
<li>to configure the object</li>
<li>to assemble the dependencies between the objects</li>
</ul>
<p>And there are <strong>two types of IoC containers</strong>. They are:</p>
<ul>
<li>BeanFactory (<code>org.springframework.beans</code>)</li>
<li>ApplicationContext (<code>org.springframework.context</code>)</li>
</ul>
<p>In short, the <code>BeanFactory</code> provides the <strong>configuration framework and basic functionality</strong>, and the <code>ApplicationContext</code> <strong>adds more enterprise-specific functionality</strong>. The <code>ApplicationContext</code> is a complete superset of the <code>BeanFactory</code> and is used exclusively in this chapter in descriptions of Spring‚Äôs IoC container. For more information on using the <code>BeanFactory</code> instead of the <code>ApplicationContext</code>, see <a href="https://docs.spring.io/spring/docs/5.3.0-SNAPSHOT/spring-framework-reference/core.html#beans-beanfactory" target="_blank" rel="noopener">The BeanFactory</a>.</p>
<h3 id="Java-Beans-vs-Spring-Beans-vs-POJOs"><a href="#Java-Beans-vs-Spring-Beans-vs-POJOs" class="headerlink" title="Java Beans vs Spring Beans vs POJOs"></a>Java Beans vs Spring Beans vs POJOs</h3><p>(additional reference: <a href="http://www.shaunabram.com/beans-vs-pojos/" target="_blank" rel="noopener">http://www.shaunabram.com/beans-vs-pojos/</a>)</p>
<ul>
<li><p>JavaBeans are classes that <strong>encapsulate many objects into a single object (the bean)</strong>. It is a java class that should <strong>follow following conventions</strong>:</p>
<ul>
<li><p>Must implement <code>Serializable.</code></p>
</li>
<li><p>It should have a public <code>no-arg</code> constructor.</p>
</li>
<li><p>All properties in java bean must be <code>private</code> with <code>public getters()</code> and <code>public setter()</code> methods.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestBean</span> </span>&#123; </span><br><span class="line">	<span class="keyword">private</span> String name; </span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span></span>&#123; </span><br><span class="line">	        <span class="keyword">this</span>.name = name; </span><br><span class="line">    &#125; </span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span>&#123; </span><br><span class="line">	        <span class="keyword">return</span> name; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>  <strong>setter methods</strong>:</p>
<ul>
<li>It should be <code>public</code> in nature.</li>
<li>The return-type should be <code>void</code>.</li>
<li>The setter method should be prefixed with <code>set</code>.</li>
<li>It should take some argument i.e. it should not be no-arg method.</li>
</ul>
<p>  <strong>getter methods</strong></p>
<ul>
<li>It should be <code>public</code> in nature.</li>
<li>The return-type should <strong>not be <code>void</code></strong> i.e. according to our requirement we have to give return-type.</li>
<li>The getter method should be prefixed with <code>get</code>.</li>
<li>It should not take any argument.</li>
</ul>
<p>  <strong>Boolean properties getter method</strong></p>
<ul>
<li>name can be prefixed with either ‚Äú<code>get</code>‚Äù or ‚Äú<code>is</code>‚Äù. But recommended to use ‚Äú<code>is</code>‚Äù.</li>
<li>returns a <code>boolean</code></li>
</ul>
</li>
<li><p><strong>POJO is an acronym for Plain Old Java Object</strong>. The term was coined by <a href="http://www.martinfowler.com/bliki/POJO.html" target="_blank" rel="noopener">Martin Fowler et. al.</a>, as a ‚Äòfancy‚Äô way to describe ordinary Java Objects that do not require a framework to use, nor need to be run in a application server environment.</p>
</li>
<li><p><strong>A Spring bean is basically an object managed by Spring</strong>. More specifically, it is an object that is instantiated, configured and otherwise managed by a Spring Framework container. Spring beans are defined in a Spring configuration file (or, more recently, by using annotations), instantiated by the Spring container, and then injected into your application.</p>
<p>  Spring can manage just about any object, even if it doesn‚Äôt have JavaBean type characteristics such as default constructors or mutator methods (getters and setters).</p>
</li>
</ul>
<h3 id="IoC-Container-Overview"><a href="#IoC-Container-Overview" class="headerlink" title="IoC Container Overview"></a>IoC Container Overview</h3><p>The <code>org.springframework.context.ApplicationContext</code> interface represents the Spring IoC container and is responsible for <strong>instantiating, configuring, and assembling the beans</strong>. The container gets its instructions on <strong>what objects to instantiate, configure, and assemble by reading configuration metadata.</strong> </p>
<p>The <strong>configuration metadata</strong> is represented in XML, <strong>Java annotations</strong>, or Java code.</p>
<p>The following diagram shows a high-level view of how Spring works. Your application classes are combined with configuration metadata so that, after the ApplicationContext is created and initialized, you have a fully configured and executable system or application.</p>
<p><img src="/.com//06/09/Spring-Framework-Guide/SpringIoC.png" alt="Picture from https://docs.spring.io/spring/docs/5.3.0-SNAPSHOT/spring-framework-reference/core.html#beans" title="Picture from https://docs.spring.io/spring/docs/5.3.0-SNAPSHOT/spring-framework-reference/core.html#beans"></p>
<p>A Spring IoC container manages one or more beans. These beans are created with the configuration metadata that you supply to the container (e.g. via an XML file).</p>
<p>Within the container itself, <strong>these bean definitions are represented as <code>BeanDefinition</code> objects, which contain (among other information) the following metadata:</strong></p>
<ul>
<li>A package-qualified class name: typically, the <strong>actual implementation class of the bean</strong> being defined.</li>
<li>Bean behavioral configuration elements, which state how the bean should behave in the container (<code>scope</code>, <code>lifecycle callbacks</code>, and so forth).</li>
<li>References to other beans that are needed for the bean to do its work. These references are also called collaborators or <strong>dependencies</strong>.</li>
<li>Other configuration settings to set in the newly created object‚Äâ‚Äî‚Äâfor example, the size limit of the pool or the number of connections to use in a bean that manages a connection pool.</li>
</ul>
<p>This metadata <strong>translates to a set of properties that make up each bean definition</strong>. The following table describes these properties:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Explained in</th>
</tr>
</thead>
<tbody><tr>
<td>Class</td>
<td><a href="#Instantiating-Beans">Instantiating Beans</a></td>
</tr>
<tr>
<td>Name</td>
<td><a href="#Naming-Beans">Naming Beans</a></td>
</tr>
<tr>
<td>Scope</td>
<td><a href="#Bean-Scopes">Bean Scopes</a></td>
</tr>
<tr>
<td>Constructor arguments</td>
<td><a href="#Dependency-Injection">Dependency Injection</a></td>
</tr>
<tr>
<td>Properties</td>
<td><a href="#Dependency-Injection">Dependency Injection</a></td>
</tr>
<tr>
<td>Autowiring mode</td>
<td><a href="#Autowiring-Collaborators">Autowiring Collaborators</a></td>
</tr>
<tr>
<td>Lazy initialization mode</td>
<td><a href="#Lazy-initialized-Beans">Lazy-initialized Beans</a></td>
</tr>
<tr>
<td>Initialization method</td>
<td><a href="#Initialization-Callbacks">Initialization Callbacks</a></td>
</tr>
<tr>
<td>Destruction method</td>
<td><a href="#Destruction-Callbacks">Destruction Callbacks</a></td>
</tr>
</tbody></table>
<h3 id="Configuration-Metadata"><a href="#Configuration-Metadata" class="headerlink" title="Configuration Metadata"></a>Configuration Metadata</h3><p>As the preceding diagram shows, the <strong>Spring IoC container consumes a form of configuration metadata</strong>. This configuration metadata represents how you, as an application developer, <strong>tell the Spring container to instantiate, configure, and assemble the objects in your application</strong>.</p>
<p>Configuration metadata is can be supplied using one of the three forms:</p>
<ul>
<li>XML file</li>
<li>Java-based configuration</li>
<li>Annotation-based configuration</li>
</ul>
<p>(the following chapters only cover <strong>Java-based Configuration</strong>. If you prefer other means of configuration, please refer to the <a href="https://docs.spring.io/spring/docs/5.3.0-SNAPSHOT/spring-framework-reference/core.html#beans" target="_blank" rel="noopener">Offical Documentation</a> for more information.)</p>
<h3 id="Java-Based-Configuration"><a href="#Java-Based-Configuration" class="headerlink" title="Java Based Configuration"></a>Java Based Configuration</h3><p>The central artifacts in Spring‚Äôs new Java-configuration support are <strong><code>@Configuration</code>-annotated classes</strong> and <strong><code>@Bean</code>-annotated methods</strong>.</p>
<p>The <code>@Bean</code> annotation is used to indicate that <strong>a method instantiates, configures, and initializes a new object (type signature of the method) to be managed by the Spring IoC container</strong>. For those familiar with Spring‚Äôs <code>&lt;beans/&gt;</code> XML configuration, the <code>@Bean</code> annotation plays the same role as the <code>&lt;bean/&gt;</code> element. You can use <code>@Bean</code>-annotated methods with any Spring <code>@Component</code>. However, they are most often used with <code>@Configuration</code> beans.</p>
<p>Annotating a class with <code>@Configuration</code> indicates that <strong>its primary purpose is as a source of bean definitions</strong>. Furthermore, <code>@Configuration</code> classes let <strong>inter-bean dependencies be defined by calling other <code>@Bean</code> methods in the same class</strong>. The simplest possible <code>@Configuration</code> class reads as follows:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MyService <span class="title">myService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyServiceImpl();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Unlike full <code>@Configuration</code>, lite <code>@Bean</code> methods (declared within classes that are not annotated with @Configuration) <strong>cannot declare inter-bean dependencies</strong>. Instead, they operate on their containing component‚Äôs internal state and, optionally, on arguments that they may declare. Such a <code>@Bean</code> method should therefore not invoke other <code>@Bean</code> methods. <strong>Each such method is literally only a factory method for a particular bean reference, without any special runtime semantics</strong>.</li>
</ul>
</blockquote>
<p>The <code>@Bean</code> and <code>@Configuration</code> annotations are discussed in depth in the following sections. <strong>First, however, we need to cover the various ways of creating a spring container</strong> using by Java-based configuration.</p>
<h3 id="Instantiating-the-Spring-Container-Using-AnnotationConfigApplicationContext"><a href="#Instantiating-the-Spring-Container-Using-AnnotationConfigApplicationContext" class="headerlink" title="Instantiating the Spring Container Using AnnotationConfigApplicationContext"></a>Instantiating the Spring Container Using <code>AnnotationConfigApplicationContext</code></h3><p>When <code>@Configuration</code> classes are provided as input, <strong>the <code>@Configuration</code> class itself is registered as a bean definition and all declared <code>@Bean</code> methods within the class are also registered as bean definitions</strong>.</p>
<p>This means that instead of using XML files, you can use <code>@Configuration</code> classes as input when instantiating an <code>AnnotationConfigApplicationContext</code>. This allows for completely XML-free usage of the Spring container, as the following example shows:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    ApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext(AppConfig<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    MyService myService = ctx.getBean(MyService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    myService.doStuff();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>AnnotationConfigApplicationContext</code> is not limited to working only with <code>@Configuration</code> classes. <strong>Any <code>@Component</code> or JSR-330 annotated class may be supplied as input to the constructor</strong>, as the following example shows:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">    ApplicationContext ctx &#x3D; new AnnotationConfigApplicationContext(MyServiceImpl.class, Dependency1.class, Dependency2.class);</span><br><span class="line">    MyService myService &#x3D; ctx.getBean(MyService.class);</span><br><span class="line">    myService.doStuff();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The preceding example assumes that <code>MyServiceImpl</code>, <code>Dependency1</code>, and <code>Dependency2</code> <strong>use Spring dependency injection annotations such as <code>@Autowired</code></strong>.</p>
<h3 id="Building-the-Container-Programmatically-by-Using-register-Class-lt-gt-‚Ä¶‚Äã"><a href="#Building-the-Container-Programmatically-by-Using-register-Class-lt-gt-‚Ä¶‚Äã" class="headerlink" title="Building the Container Programmatically by Using register(Class&lt;?&gt;‚Ä¶‚Äã)"></a>Building the Container Programmatically by Using <code>register(Class&lt;?&gt;‚Ä¶‚Äã)</code></h3><p>One thing we see before for using <code>AnnotationConfigApplicationContext</code> is that the configurations need to be specified when you instantiate the <code>ApplicationContext</code>. However, sometimes you might need to programmatically add configurations later. This can be done by <strong>instantiate an <code>AnnotationConfigApplicationContext</code> by using a no-arg constructor and then configure it by using the <code>register()</code> method</strong>. This approach is particularly useful when programmatically building an <code>AnnotationConfigApplicationContext</code>. The following example shows how to do so:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    AnnotationConfigApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext();</span><br><span class="line">    ctx.register(AppConfig<span class="class">.<span class="keyword">class</span>, <span class="title">OtherConfig</span>.<span class="title">class</span>)</span>;</span><br><span class="line">    ctx.register(AdditionalConfig<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    ctx.refresh();</span><br><span class="line">    MyService myService = ctx.getBean(MyService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    myService.doStuff();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Enabling-Component-Scanning-with-scan-String‚Ä¶‚Äã"><a href="#Enabling-Component-Scanning-with-scan-String‚Ä¶‚Äã" class="headerlink" title="Enabling Component Scanning with scan(String‚Ä¶‚Äã)"></a>Enabling Component Scanning with <code>scan(String‚Ä¶‚Äã)</code></h3><p>To enable component scanning, you can <strong>annotate your <code>@Configuration</code> class</strong> as follows:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages = <span class="string">"com.acme"</span>)  <span class="comment">// this enables component scanning</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span>  </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In the preceding example, the <strong><code>com.acme</code> package is scanned to look for any <code>@Component</code>-annotated classes</strong>, and those classes are registered as Spring bean definitions within the container. </p>
<p>Additionally, <strong>you can use the <code>AnnotationConfigApplicationContext</code> object with the <code>scan(String‚Ä¶‚Äã)</code> method</strong> to allow for the same component-scanning functionality, as the following example shows:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    AnnotationConfigApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext();</span><br><span class="line">    ctx.scan(<span class="string">"com.acme"</span>);</span><br><span class="line">    ctx.refresh();</span><br><span class="line">    MyService myService = ctx.getBean(MyService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>In the preceding example, <strong>assuming that <code>AppConfig</code> is declared within the <code>com.acme</code> package (or any package underneath)</strong>. The above works <strong>since <code>@Configuration</code> classes are meta-annotated</strong> with <code>@Component</code>, so they are <strong>candidates for component-scanning as well</strong>. Then the <strong><code>AppConfig</code> along with its components is picked up during the call to <code>scan()</code></strong>. Upon <code>refresh()</code>, all its <code>@Bean</code> methods are processed and registered as bean definitions within the container.</p>
<h3 id="Using-the-Bean-Annotation"><a href="#Using-the-Bean-Annotation" class="headerlink" title="Using the @Bean Annotation"></a>Using the <code>@Bean</code> Annotation</h3><p>You can use the <code>@Bean</code> annotation in a <code>@Configuration</code>-annotated or in a <code>@Component</code>-annotated class.</p>
<p>To declare a bean, you can annotate <strong>a method with the <code>@Bean</code> annotation</strong>. You use this method to register a bean definition within an <code>ApplicationContext</code> of the type specified as the method‚Äôs return value. <strong>By default, the bean name is the same as the method name.</strong> The following example shows a <code>@Bean</code> method declaration:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TransferServiceImpl <span class="title">transferService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> TransferServiceImpl();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The preceding configuration is exactly equivalent to the following Spring XML:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;beans&gt;</span><br><span class="line">    &lt;bean id&#x3D;&quot;transferService&quot; class&#x3D;&quot;com.acme.TransferServiceImpl&quot;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;beans&gt;</span><br></pre></td></tr></table></figure>

<p>Both would make a <strong>bean (method for getting an Object) named <code>transferService</code> available in the <code>ApplicationContext</code></strong>, bound to an <strong>object instance of type <code>TransferServiceImpl</code></strong>, as the following text image shows:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transferService -&gt; com.acme.TransferServiceImpl</span><br></pre></td></tr></table></figure>

<p>You can also <strong>declare your <code>@Bean</code> method with an interface</strong> (or base class) return type, as the following example shows:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TransferService <span class="title">transferService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> TransferServiceImpl();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>However, this <strong>limits the visibility for advance type prediction</strong> to the specified interface type (<code>TransferService</code>), such that the full type (<code>TransferServiceImpl</code>) is known to the container only once.</p>
<h3 id="Determining-a-Bean‚Äôs-Runtime-Type"><a href="#Determining-a-Bean‚Äôs-Runtime-Type" class="headerlink" title="Determining a Bean‚Äôs Runtime Type"></a>Determining a Bean‚Äôs Runtime Type</h3><p>The runtime type of a specific bean is non-trivial to determine. A specified class in the bean metadata definition is just an initial class reference, potentially combined with a declared factory method or being a FactoryBean class which <strong>may lead to a different runtime type of the bean</strong>, or not being set at all in case of an instance-level factory method (which is resolved via the specified factory-bean name instead).</p>
<p>The recommended way to find out about the actual runtime type of a particular bean is <strong>a <code>BeanFactory.getType</code> call for the specified bean name</strong>. This takes all of the above cases into account and returns the type of object that a BeanFactory.getBean call is going to return for the same bean name.</p>
<h3 id="Bean-Dependencies"><a href="#Bean-Dependencies" class="headerlink" title="Bean Dependencies"></a>Bean Dependencies</h3><p><strong>A <code>@Bean</code>-annotated method can have an arbitrary number of parameters that describe the dependencies</strong> required to build that bean. For instance, if our <code>TransferService</code> requires an <code>AccountRepository</code>, we can <strong>materialize that dependency with a method parameter</strong>, as the following example shows:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TransferService <span class="title">transferService</span><span class="params">(AccountRepository accountRepository)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> TransferServiceImpl(accountRepository);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The resolution mechanism is pretty much identical to <code>constructor-based dependency injection</code>. See below sections for more details.</p>
<h3 id="Dependency-Injection"><a href="#Dependency-Injection" class="headerlink" title="Dependency Injection"></a>Dependency Injection</h3><p><strong>Dependency injection (DI) is a process whereby objects define their dependencies</strong> (that is, the other objects with which they work) <strong><em>only</em> through</strong> constructor arguments, arguments to a factory method, or properties that are set on the object instance after it is constructed or returned from a factory method.</p>
<p>The <strong>container then injects those dependencies when it creates the bean</strong>.</p>
<p>Code is cleaner with the DI principle, and decoupling is more effective when objects are provided with their dependencies. The object does not look up its dependencies and does not know the location or class of the dependencies. As a result, your classes become easier to test, particularly when the dependencies are on interfaces or abstract base classes, which allow for stub or mock implementations to be used in unit tests.</p>
<p>DI exists in two major variants: </p>
<ul>
<li><strong>Constructor-based dependency injection</strong></li>
<li><strong>Setter-based dependency injection</strong></li>
</ul>
<h3 id="Constructor-based-dependency-injection"><a href="#Constructor-based-dependency-injection" class="headerlink" title="Constructor-based dependency injection"></a>Constructor-based dependency injection</h3><p>(additional reference: <a href="https://www.tutorialspoint.com/spring/constructor_based_dependency_injection.htm" target="_blank" rel="noopener">https://www.tutorialspoint.com/spring/constructor_based_dependency_injection.htm</a>)</p>
<p>Constructor-based DI is accomplished when the container invokes a <strong>class constructor with a number of arguments, each representing a dependency on the other class</strong>.</p>
<p>Consider you have an application which has a text editor component and you want to provide a spell check. Your standard code would look something like this:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TextEditor</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> SpellChecker spellChecker;</span><br><span class="line">   </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">TextEditor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      spellChecker = <span class="keyword">new</span> SpellChecker();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>What we‚Äôve done here is, create a dependency between the TextEditor and the SpellChecker.** In an inversion of control scenario, we would instead do something like this:**</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TextEditor</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> SpellChecker spellChecker;</span><br><span class="line">   </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">TextEditor</span><span class="params">(SpellChecker spellChecker)</span> </span>&#123;  <span class="comment">// Constructor based DI</span></span><br><span class="line">      <span class="keyword">this</span>.spellChecker = spellChecker;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Here, the <code>TextEditor</code> should not worry about <code>SpellChecker</code> implementation. <strong>The <code>SpellChecker</code> will be implemented independently and will be provided to the <code>TextEditor</code> at the time of <code>TextEditor</code> instantiation</strong>. This entire procedure is controlled by the Spring Framework.</p>
<h3 id="Constructor-Arguments-Resolution"><a href="#Constructor-Arguments-Resolution" class="headerlink" title="Constructor Arguments Resolution"></a>Constructor Arguments Resolution</h3><p>There may be an ambiguity while passing arguments to the constructor,** in case there are more than one parameters**. To resolve this ambiguity, the order in which the constructor arguments are defined in a bean definition is the order in which those arguments are supplied to the appropriate constructor. Consider the following class:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> x.y;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Foo</span><span class="params">(Bar bar, Baz baz)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The following configuration works fine:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Foo <span class="title">foo</span><span class="params">(Bar bar, Baz baz)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Foo(bar, baz)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Let us check one more case where we pass different types to the constructor, and we want to specify a specific value for them. Consider the following class:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> x.y;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Foo</span><span class="params">(<span class="keyword">int</span> year, String name)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The container can also use type matching with simple types, if you explicitly specify the type of the constructor argument using the type attribute. For example ‚àí</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Foo <span class="title">foo</span><span class="params">(<span class="keyword">int</span> year, String name)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Foo(<span class="number">2001</span>,<span class="string">"Zara"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>If you are using XML</strong>, then the best way to pass constructor arguments is to <strong>use the index attribute to specify explicitly the index of constructor arguments. Here, the index is 0 based.</strong> For example:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span> = <span class="string">"foo"</span> <span class="attr">class</span> = <span class="string">"x.y.Foo"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span> = <span class="string">"0"</span> <span class="attr">value</span> = <span class="string">"2001"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span> = <span class="string">"1"</span> <span class="attr">value</span> = <span class="string">"Zara"</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>A final note, in case you are passing a reference to an object as an argument, you need to use ref attribute of <code>&lt;constructor-arg&gt;</code> tag in the XML, and if you are passing a <code>value</code> directly then you should use value attribute as shown above.</p>
<h3 id="Setter-based-Dependency-Injection"><a href="#Setter-based-Dependency-Injection" class="headerlink" title="Setter-based Dependency Injection"></a>Setter-based Dependency Injection</h3><p>Setter-based DI is accomplished by the <strong>container calling <code>setter</code> methods on your beans after invoking a no-argument constructor or a no-argument static factory method</strong> to instantiate your bean.</p>
<p>For example:</p>
<p>(referece: <a href="https://www.tutorialspoint.com/spring/setter_based_dependency_injection.htm" target="_blank" rel="noopener">https://www.tutorialspoint.com/spring/setter_based_dependency_injection.htm</a>)</p>
<p>the content of <code>TextEditor.java</code> file:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TextEditor</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> SpellChecker spellChecker;</span><br><span class="line">   </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">TextEditor</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// a setter method to inject the dependency.</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSpellChecker</span><span class="params">(SpellChecker spellChecker)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.spellChecker = spellChecker;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// a getter method to return spellChecker</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> SpellChecker <span class="title">getSpellChecker</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> spellChecker;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">spellCheck</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      spellChecker.checkSpelling();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Here you need to check the <strong>naming convention of the setter methods</strong>. To set an object <code>SpellChecker</code> we are using <code>setSpellChecker()</code> method which is very similar to Java POJO classes. Then the content of another dependent class file <code>SpellChecker.java</code> could be:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpellChecker</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">SpellChecker</span><span class="params">()</span></span>&#123;</span><br><span class="line">      System.out.println(<span class="string">"Inside SpellChecker constructor."</span> );</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkSpelling</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">"Inside checkSpelling."</span> );</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Finally, the configuration would look like:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> TextEditor <span class="title">textEditor</span><span class="params">(SpellChecker spellChecker)</span></span>&#123;</span><br><span class="line">		TextEditor textEditor = <span class="keyword">new</span> TextEditor();</span><br><span class="line">		textEditor.setSpellChecker(spellChecker);</span><br><span class="line">		<span class="keyword">return</span> textEditor;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> SpellChecker <span class="title">spellChecker</span><span class="params">()</span></span>&#123;  <span class="comment">// this is necessary as the above Bean uses the Bean SpellChecker</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SpellChecker();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Finally, just to finish the example, you would have your main class (called <code>Example</code> here):</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.mySpringProject.app.testIoC.AppConfig;</span><br><span class="line"><span class="keyword">import</span> com.mySpringProject.app.testIoC.TextEditor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.AnnotationConfigApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Example</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext(AppConfig<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        TextEditor txtedr = ctx.getBean(TextEditor<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        txtedr.spellCheck();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>You will see that the container <strong>managed the construction of objects/dependencies for us</strong>, so that <code>SpellChecker</code> is first created, and then passed into the <code>TextEditor</code> object. Lastly, you would be able to call the method <code>spellCheck()</code>.</p>
<h3 id="Constructor-based-or-Setter-based-DI"><a href="#Constructor-based-or-Setter-based-DI" class="headerlink" title="Constructor-based or Setter-based DI"></a>Constructor-based or Setter-based DI</h3><p>Since <strong>you can mix constructor-based and setter-based DI</strong>, it is a good rule of thumb to use <strong>constructors for mandatory dependencies and setter methods or configuration methods for optional dependencies</strong>. Note that use of the <code>@Required</code> annotation on a setter method can be used to make the property be a required dependency; however, constructor injection with programmatic validation of arguments is preferable.</p>
<p>Using only constructor injection, lets you implement application components as <strong>immutable objects and ensures that required dependencies are not null</strong>. Furthermore, constructor-injected components are always returned to the client (calling) code in a fully initialized state.</p>
<p><strong>Setter injection should primarily only be used for optional dependencies</strong> that can be assigned reasonable default values within the class. Otherwise, not-null checks must be performed everywhere the code uses the dependency.</p>
<h3 id="Lazy-initialized-Beans"><a href="#Lazy-initialized-Beans" class="headerlink" title="Lazy-initialized Beans"></a>Lazy-initialized Beans</h3><p>By default, <strong><code>ApplicationContext</code> implementations eagerly create and configure all singleton beans as part of the initialization process.</strong> Generally, this pre-instantiation is desirable, because errors in the configuration or surrounding environment are discovered immediately, as opposed to hours or even days later. When this behavior is not desirable, you can <strong>prevent pre-instantiation of a singleton bean by marking the bean definition as being lazy-initialized</strong>.** A lazy-initialized bean tells the IoC container to create a bean instance when it is first requested, rather than at startup**.</p>
<p>To achieve this in a Java-annotation based configuration, you add the <code>@Lazy</code> to the configuration class. This will make all <code>@Bean</code> bean methods to become lazily initialized:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Lazy;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Lazy</span>  <span class="comment">// all beans inside this class will be lazily initialized</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TextEditor <span class="title">textEditor</span><span class="params">(SpellChecker spellChecker)</span></span>&#123;</span><br><span class="line">        TextEditor textEditor = <span class="keyword">new</span> TextEditor();</span><br><span class="line">        textEditor.setSpellChecker(spellChecker);</span><br><span class="line">        <span class="keyword">return</span> textEditor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SpellChecker <span class="title">spellChecker</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SpellChecker();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>If you only want to lazily initialize a speicific bean, then add <code>@Lazy(true)</code> or <code>@Lazy()</code> above that bean:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Lazy;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Lazy</span>()  <span class="comment">// this will be lazily initialized</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TextEditor <span class="title">textEditor</span><span class="params">(SpellChecker spellChecker)</span></span>&#123;</span><br><span class="line">        TextEditor textEditor = <span class="keyword">new</span> TextEditor();</span><br><span class="line">        textEditor.setSpellChecker(spellChecker);</span><br><span class="line">        <span class="keyword">return</span> textEditor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SpellChecker <span class="title">spellChecker</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SpellChecker();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Component-Scanning"><a href="#Component-Scanning" class="headerlink" title="Component Scanning"></a>Component Scanning</h3><p>(additional reference: <a href="https://www.baeldung.com/spring-bean-annotations" target="_blank" rel="noopener">https://www.baeldung.com/spring-bean-annotations</a>)</p>
<p>Spring can automatically <strong>scan a package for beans if component scanning is enabled.</strong></p>
<p><code>@ComponentScan</code> <strong>configures which packages to scan for classes with annotation configuration</strong>. We can specify the base package names directly with one of the <code>basePackages</code> or <code>value</code> arguments (<code>value</code> is an alias for <code>basePackages</code>):</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages = <span class="string">"com.baeldung.annotations"</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VehicleFactoryConfig</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>Also, we can <strong>point to classes directly</strong> in the base packages with the <code>basePackageClasses</code> argument:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackageClasses = VehicleFactoryConfig<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">VehicleFactoryConfig</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>Alternatively, we can use** <code>@ComponentScans</code> to specify multiple <code>@ComponentScan</code> configurations**:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScans</span>(&#123;  <span class="comment">// notice this is ComponentScans, not ComponentScan</span></span><br><span class="line">  <span class="meta">@ComponentScan</span>(basePackages = <span class="string">"com.baeldung.annotations"</span>), </span><br><span class="line">  <span class="meta">@ComponentScan</span>(basePackageClasses = VehicleFactoryConfig<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">&#125;)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">VehicleFactoryConfig</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Using-Component-Annotation"><a href="#Using-Component-Annotation" class="headerlink" title="Using @Component Annotation"></a>Using <code>@Component</code> Annotation</h3><p><code>@Component</code> is a class level annotation. <strong>During the component scan, Spring Framework automatically detects classes annotated with <code>@Component</code></strong>.</p>
<p>For example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CarUtility</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>By default, the bean instances of this class have the same name as the class name with a lowercase initial. On top of that, we can specify a different name using the optional value argument of this annotation.</p>
<p>Since <code>@Repository</code>,<code>@Service</code>, <code>@Configuration</code>, and <code>@Controller</code> are all meta-annotations of <code>@Component</code>, they share the same bean naming behavior. Also, <strong>Spring automatically picks them up during the component scanning process</strong>.</p>
<p>For example, you can have an <code>@Component</code> with:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span> <span class="comment">// or @Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Config2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> WordDictionary <span class="title">wordDictionary</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> WordDictionary();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then in your main <code>@Configuration</code>, you have:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.context.annotation.*;</span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">@ComponentScans(</span><br><span class="line">        &#123;@ComponentScan(basePackageClasses&#x3D;Config2.class)&#125;  &#x2F;&#x2F; Scans that class for beans</span><br><span class="line">)</span><br><span class="line">public class AppConfig &#123;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public TextEditor textEditor(SpellChecker spellChecker)&#123;</span><br><span class="line">        TextEditor textEditor &#x3D; new TextEditor();</span><br><span class="line">        textEditor.setSpellChecker(spellChecker);</span><br><span class="line">        return textEditor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public SpellChecker spellChecker()&#123;</span><br><span class="line">        return new SpellChecker();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Finally, in your main class, you would be able to use <code>WordDictionary</code> class even if it was not specified in the <code>ApplicationContext</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.mySpringProject.app.testIoC.AppConfig;</span><br><span class="line"><span class="keyword">import</span> com.mySpringProject.app.testIoC.TextEditor;</span><br><span class="line"><span class="keyword">import</span> com.mySpringProject.app.testIoC.WordDictionary;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.AnnotationConfigApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Example</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext(AppConfig<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        TextEditor txtedr = ctx.getBean(TextEditor<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        WordDictionary dict = ctx.getBean(WordDictionary<span class="class">.<span class="keyword">class</span>)</span>;  <span class="comment">// not directly in AppConfig, but scanned</span></span><br><span class="line">        txtedr.spellCheck();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Using-Autowired-to-configure-your-beans-and-dependencies"><a href="#Using-Autowired-to-configure-your-beans-and-dependencies" class="headerlink" title="Using @Autowired to configure your beans and dependencies"></a>Using @Autowired to configure your beans and dependencies</h3><p>(additional reference: <a href="https://www.baeldung.com/spring-autowire" target="_blank" rel="noopener">https://www.baeldung.com/spring-autowire</a>)</p>
<p>Starting with Spring 2.5, the framework introduced a new style of Dependency Injection driven by <code>@Autowired</code> Annotations. This annotation allows Spring to <strong>automatically resolve and inject collaborating beans into your bean</strong>. It has the following adavantages:</p>
<ul>
<li><p>Autowiring can significantly <strong>reduce the need to specify properties or constructor arguments</strong>. (Other mechanisms such as a bean template discussed elsewhere in this chapter are also valuable in this regard.)</p>
</li>
<li><p>Autowiring can <strong>update a configuration as your objects evolve</strong>. For example, if you need to add a dependency to a class, that dependency can be satisfied automatically without you needing to modify the configuration. Thus autowiring can be especially useful during development, without negating the option of switching to explicit wiring when the code base becomes more stable.</p>
</li>
</ul>
<p>Once annotation injection is enabled, autowiring can be used on properties, setters, and constructors.</p>
<h3 id="Autowired-on-properties"><a href="#Autowired-on-properties" class="headerlink" title="@Autowired on properties"></a><code>@Autowired</code> on properties</h3><p>First, to enable annotation-driven injection, you need to be using <code>AnnotationConfigApplicationContext</code> to load your spring configuration as below:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Example</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext();  <span class="comment">// actually what we've been doing so far</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then, you can have the following <code>Component</code>s/classes:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mySpringProject.app.testIoC.AutowiredSamples;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FooforMatter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">message</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"foo"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>And importantly, this class:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mySpringProject.app.testIoC.AutowiredSamples;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FooService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> FooforMatter fooforMatter;  <span class="comment">// notice that this field is Autowired. </span></span><br><span class="line">									    <span class="comment">// It means that it will be automatically created and attached</span></span><br><span class="line">										<span class="comment">// to the FooService object</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FooforMatter <span class="title">getFooforMatter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fooforMatter;  <span class="comment">// so that we can use the message() method</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now, all you need to do in your <code>@Configuration</code> clas is to <strong>point it to the correctly component using the component scan</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(<span class="string">"com.mySpringProject.app.testIoC.AutowiredSamples"</span>)  <span class="comment">// the package where we had the @Components</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AutowiredConfig</span> </span>&#123;	<span class="comment">// no bean needs to be declared inside this configuration</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then, in the main application class, we can see the message by:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.mySpringProject.app.testIoC.AutowiredConfig;</span><br><span class="line"><span class="keyword">import</span> com.mySpringProject.app.testIoC.AutowiredSamples.FooService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.AnnotationConfigApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Example</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext(AutowiredConfig<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">        FooService fsrv = ctx.getBean(FooService<span class="class">.<span class="keyword">class</span>)</span>;  <span class="comment">// Autowired figured this out for us</span></span><br><span class="line">        System.out.println(fsrv.getFooforMatter().message());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Autowired-on-constructors"><a href="#Autowired-on-constructors" class="headerlink" title="@Autowired on constructors"></a><code>@Autowired</code> on constructors</h3><p>The @Autowired annotation can also be used on constructors. In the below example, when the annotation is used on a constructor, an instance of FooFormatter is injected as an argument to the constructor when FooService is created:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FooService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> FooFormatter fooFormatter;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FooService</span><span class="params">(FooFormatter fooFormatter)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fooFormatter = fooFormatter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now, an instance of <code>FooFormatter</code> is injected as an argument to the constructor when <code>FooService</code> is created.</p>
<p>This technically has the same effect as using <code>@Autowired</code> on a specific field, but it turns out that** using <code>@Autowired</code> on a constructor is always the better approach**. This is because:</p>
<ul>
<li>you can only <strong><code>@Autowired</code> one field at a time</strong>, but above <strong>a constructor, all arguments will be instantiated/autowired</strong>.</li>
<li>using <code>@Autowired</code> on a field is <strong>vulnerable for the problem of having a <code>NullPointerException</code></strong>. This is because if the autowired field is not correctly instantiated, the** main object that depends on it might still be created, but invoking methods of that private field will cause <code>NullPointerException</code><strong>. However, by **having the <code>@Autowired</code> for a constructor, it forces the main object to be created WITH an instantiation of that dependent object</strong>.</li>
</ul>
<h3 id="Optional-Dependencies-for-Autowired"><a href="#Optional-Dependencies-for-Autowired" class="headerlink" title="Optional Dependencies for @Autowired"></a>Optional Dependencies for <code>@Autowired</code></h3><p>(additional reference: <a href="https://www.baeldung.com/spring-autowire" target="_blank" rel="noopener">https://www.baeldung.com/spring-autowire</a>)</p>
<p>Spring expects <code>@Autowired</code> dependencies to be available when the dependent bean is being constructed. <strong>If the framework cannot resolve a bean for wiring</strong>, it will throw the below-quoted exception and prevent the Spring container from launching successfully:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Caused by: org.springframework.beans.factory.NoSuchBeanDefinitionException: </span><br><span class="line">No qualifying bean of type [com.autowire.sample.FooDAO] found for dependency: </span><br><span class="line">expected at least 1 bean which qualifies as autowire candidate for this dependency. </span><br><span class="line">Dependency annotations: </span><br><span class="line">&#123;@org.springframework.beans.factory.annotation.Autowired(required&#x3D;true)&#125;</span><br></pre></td></tr></table></figure>

<p>To avoid this from happening, <strong>a bean can optional be specified as below</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class FooService &#123;</span><br><span class="line"> </span><br><span class="line">    @Autowired(required &#x3D; false)</span><br><span class="line">    private FooDAO dataAccessor; </span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a name="Bean-Scopes"></a></p>
<h3 id="Bean-Scopes"><a href="#Bean-Scopes" class="headerlink" title="Bean Scopes"></a>Bean Scopes</h3><p>(additional reference: <a href="https://www.baeldung.com/spring-bean-scopes" target="_blank" rel="noopener">https://www.baeldung.com/spring-bean-scopes</a>)</p>
<p>When you create a bean definition, you create a recipe for creating actual instances of the class defined by that bean definition. The idea that a bean definition is a recipe is important, because it means that, as with a class, you can create many object instances from a single recipe.</p>
<p>In addition to all those configurations that you can specify to a bean, you can also specify its scope:** the scope of a bean defines the life cycle and visibility of that bean in the contexts in which it is used**.</p>
<p>The latest version of Spring framework defines 6 types of scopes:</p>
<ul>
<li><a href="#Singleton-Scope">singleton</a></li>
<li><a href="#Prototype-Scope">prototype</a></li>
<li><a href="#Request-Scope">request</a></li>
<li><a href="#Session-Scope">session</a></li>
<li><a href="#Application-Scope">application</a></li>
<li><a href="#Websocket-Scope">websocket</a></li>
</ul>
<p>The <strong>last four scopes listed above</strong> - <code>request</code>, <code>session</code>, <code>application</code> and <code>websocket</code> - are <strong>only available in a web-aware application</strong>.</p>
<p><a name="Singleton-Scope"></a></p>
<h4 id="Singleton-Scope"><a href="#Singleton-Scope" class="headerlink" title="Singleton Scope"></a>Singleton Scope</h4><p>Defining a bean with singleton scope <strong>means the container creates a single instance of that bean, and all requests for that bean name will return the same object, which is cached</strong>. Any modifications to the object will be reflected in all references to the bean. This scope is the default value if no other scope is specified.</p>
<p>For example, if you have a Person object that stores a name:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// standard constructor, getters and setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Afterwards, we define the bean with singleton scope by using the <code>@Scope</code> annotation:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Scope</span>(<span class="string">"singleton"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Person <span class="title">personSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Person();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now, if you use the <code>getBean(Person.class)</code> to create that object, you will <strong>only get one and the same instance of it no matter how many times you this method call</strong>. This also means that if you change the <code>name</code> field of one of the <code>Person</code> object you get, it will be changed for all <code>Person</code> objects that you got.</p>
<p><a name="Prototype-Scope"></a></p>
<h4 id="Prototype-Scope"><a href="#Prototype-Scope" class="headerlink" title="Prototype Scope"></a>Prototype Scope</h4><p>A bean with <code>prototype</code> scope will <strong>return a different instance every time it is requested from the container</strong>. It is defined by setting the value <code>prototype</code> to the <code>@Scope</code> annotation in the bean definition:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Scope</span>(<span class="string">"prototype"</span>)  <span class="comment">// everytime this bean is used, a new Person object will be created</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Person <span class="title">personPrototype</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Person();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now, if you make multiple calls of <code>getBean(Person.class)</code>, you will get multiple <code>Person</code> objects instantiated (as many as the number of times you called the method). This will not cause the problem that, if you change the name of one <code>Person</code> object, all <code>name</code>s of other <code>Person</code> objects will be changed.</p>
<p>As mentioned, there are four additional scopes that are only available in a web-aware application context. These are less often used in practice:</p>
<p><a name="Request-Scope"></a></p>
<h4 id="Request-Scope"><a href="#Request-Scope" class="headerlink" title="Request Scope"></a>Request Scope</h4><p>The request scope creates a bean instance for a <strong>single HTTP request</strong>.</p>
<p>We can define the bean with request scope using the <code>@Scope</code> annotation:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Scope</span>(value = WebApplicationContext.SCOPE_REQUEST, proxyMode = ScopedProxyMode.TARGET_CLASS)</span><br><span class="line"><span class="function"><span class="keyword">public</span> HelloMessageGenerator <span class="title">requestScopedBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> HelloMessageGenerator();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The <code>proxyMode</code> attribute is <strong>necessary here because</strong>, at the moment of the instantiation of the web application context, <strong>there is no active request</strong>. Spring will create a proxy to be injected as a dependency, and instantiate the target bean when it is needed in a request.</p>
<p>We can also use a <strong><code>@RequestScope</code> composed annotation that acts as a shortcut for the above definition</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@RequestScope</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> HelloMessageGenerator <span class="title">requestScopedBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> HelloMessageGenerator();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Next, we can define <strong>a <code>controller</code> that has an injected reference to the <code>requestScopedBean</code></strong>. We need to access the same request twice in order to test the web specific scopes.</p>
<p>If we display the message each time the request is run, we can see that the value is reset to null, even though it is later changed in the method. This is because of <strong>a different bean instance being returned for each request</strong>.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScopesController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span>(name = <span class="string">"requestScopedBean"</span>)</span><br><span class="line">    HelloMessageGenerator requestScopedBean;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/scopes/request"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getRequestScopeMessage</span><span class="params">(<span class="keyword">final</span> Model model)</span> </span>&#123;</span><br><span class="line">        model.addAttribute(<span class="string">"previousMessage"</span>, requestScopedBean.getMessage());</span><br><span class="line">        requestScopedBean.setMessage(<span class="string">"Good morning!"</span>);</span><br><span class="line">        model.addAttribute(<span class="string">"currentMessage"</span>, requestScopedBean.getMessage());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"scopesExample"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="Session-Scope"></a></p>
<h4 id="Session-Scope"><a href="#Session-Scope" class="headerlink" title="Session Scope"></a>Session Scope</h4><p>The session scope creates for <strong>an HTTP Session</strong>.</p>
<p>We can define the bean with session scope in a similar manner:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Scope</span>(value = WebApplicationContext.SCOPE_SESSION, proxyMode = ScopedProxyMode.TARGET_CLASS)</span><br><span class="line"><span class="function"><span class="keyword">public</span> HelloMessageGenerator <span class="title">sessionScopedBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> HelloMessageGenerator();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>There‚Äôs also a dedicated composed annotation we can use to simplify the bean definition:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@SessionScope</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> HelloMessageGenerator <span class="title">sessionScopedBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> HelloMessageGenerator();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Next, we define a controller with a reference to the <code>sessionScopedBean</code>. Again, we need to run two requests in order to show that the value of the message field is the same for the session.</p>
<p>In this case, when the request is made for the first time, the value message is null. But once, it is changed, then that value is retained for subsequent requests as the same instance of the bean is returned for the entire session.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScopesController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span>(name = <span class="string">"sessionScopedBean"</span>)</span><br><span class="line">    HelloMessageGenerator sessionScopedBean;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/scopes/session"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSessionScopeMessage</span><span class="params">(<span class="keyword">final</span> Model model)</span> </span>&#123;</span><br><span class="line">        model.addAttribute(<span class="string">"previousMessage"</span>, sessionScopedBean.getMessage());</span><br><span class="line">        sessionScopedBean.setMessage(<span class="string">"Good afternoon!"</span>);</span><br><span class="line">        model.addAttribute(<span class="string">"currentMessage"</span>, sessionScopedBean.getMessage());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"scopesExample"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a name="Application-Scope"></a></p>
<h4 id="Application-Scope"><a href="#Application-Scope" class="headerlink" title="Application Scope"></a>Application Scope</h4><p>The application scope creates the bean instance for the <strong>lifecycle of a ServletContext</strong>.</p>
<p>This is similar to the singleton scope but there is a very important difference with regards to the scope of the bean.</p>
<p>When beans are application scoped the same instance of the bean is shared across multiple servlet-based applications running in the same ServletContext, while singleton-scoped beans are scoped to a single application context only.</p>
<p>Let‚Äôs create the bean with application scope:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Scope</span>(</span><br><span class="line">  value = WebApplicationContext.SCOPE_APPLICATION, proxyMode = ScopedProxyMode.TARGET_CLASS)</span><br><span class="line"><span class="function"><span class="keyword">public</span> HelloMessageGenerator <span class="title">applicationScopedBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> HelloMessageGenerator();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Analogously as for the request and session scopes, we can use a shorter version:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ApplicationScope</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> HelloMessageGenerator <span class="title">applicationScopedBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> HelloMessageGenerator();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now, let‚Äôs create a controller that references this bean:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScopesController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span>(name = <span class="string">"applicationScopedBean"</span>)</span><br><span class="line">    HelloMessageGenerator applicationScopedBean;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/scopes/application"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getApplicationScopeMessage</span><span class="params">(<span class="keyword">final</span> Model model)</span> </span>&#123;</span><br><span class="line">        model.addAttribute(<span class="string">"previousMessage"</span>, applicationScopedBean.getMessage());</span><br><span class="line">        applicationScopedBean.setMessage(<span class="string">"Good afternoon!"</span>);</span><br><span class="line">        model.addAttribute(<span class="string">"currentMessage"</span>, applicationScopedBean.getMessage());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"scopesExample"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In this case, value message once set in the applicationScopedBean will be retained for all subsequent requests, sessions and even for a different servlet application that will access this bean, provided it is running in the same ServletContext.</p>
<p><a name="Websocket-Scope"></a></p>
<h4 id="Websocket-Scope"><a href="#Websocket-Scope" class="headerlink" title="Websocket Scope"></a>Websocket Scope</h4><p>The websocket scope creates it for a particular <strong>WebSocket session</strong>.</p>
<p>Finally, let‚Äôs create the bean with websocket scope:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">@Scope(scopeName &#x3D; &quot;websocket&quot;, proxyMode &#x3D; ScopedProxyMode.TARGET_CLASS)</span><br><span class="line">public HelloMessageGenerator websocketScopedBean() &#123;</span><br><span class="line">    return new HelloMessageGenerator();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>WebSocket-scoped beans when first accessed are stored in the WebSocket session attributes. The same instance of the bean is then returned whenever that bean is accessed during the entire WebSocket session.</p>
<p>We can also say that it exhibits singleton behavior but limited to a WebSocket session only.</p>
<h3 id="Specifying-Bean-Scope"><a href="#Specifying-Bean-Scope" class="headerlink" title="Specifying Bean Scope"></a>Specifying Bean Scope</h3><p>Spring includes the <code>@Scope</code> annotation so that you can specify the scope of a bean.</p>
<p>You can specify that your <strong>beans defined with the <code>@Bean</code> annotation should have a specific scope</strong>. You can use any of the standard scopes specified in the <a href="#Bean-Scopes">Bean Scopes</a> section above.</p>
<p>The default scope is singleton, but you can override this with the @Scope annotation, as the following example shows:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Scope</span>(<span class="string">"prototype"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Encryptor <span class="title">encryptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Method-Injection"><a href="#Method-Injection" class="headerlink" title="Method Injection"></a>Method Injection</h3><p>In most application scenarios, most beans in the container are singletons. When a singleton bean needs to collaborate with another singleton bean or a non-singleton bean needs to collaborate with another non-singleton bean, you typically handle the dependency by defining one bean as a property of the other. <strong>A problem arises when the bean lifecycles are different</strong>. Suppose <strong>singleton bean A needs to use non-singleton (prototype) bean B, perhaps on each method invocation on A</strong>. The container <strong>creates the singleton bean A only once, and thus only gets one opportunity to set the properties</strong>. The container cannot provide bean A with a new instance of bean B every time one is needed.</p>
<p>The solution is to use the <code>@Lookup</code>, namely, Method Injection.</p>
<h3 id="Using-Lookup-for-Method-Injection"><a href="#Using-Lookup-for-Method-Injection" class="headerlink" title="Using @Lookup for Method Injection"></a>Using @Lookup for Method Injection</h3><p><code>@Lookup</code> is a method annotated that tells <strong>Spring to return an instance of the method‚Äôs return type every time when we invoke it.</strong></p>
<p>First, let‚Äôs create a prototype bean that we will later inject into a singleton bean:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">package com.mySpringProject.app.testIoC.MethodInjectionSamples;</span><br><span class="line"></span><br><span class="line">import org.springframework.context.annotation.Scope;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">@Scope(&quot;prototype&quot;)  &#x2F;&#x2F; so that everytime a bean of this is created, you get a new SchoolNotification</span><br><span class="line">public class SchoolNotification &#123;</span><br><span class="line">    static int count &#x3D; 0;</span><br><span class="line"></span><br><span class="line">    public SchoolNotification()&#123;</span><br><span class="line">        System.out.println(&quot;Notification &quot;+(++count) +&quot; created&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>And if we create a singleton bean that uses <code>@Lookup</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">package com.mySpringProject.app.testIoC.MethodInjectionSamples;</span><br><span class="line"></span><br><span class="line">import org.springframework.beans.factory.annotation.Lookup;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">@Component	&#x2F;&#x2F; no @Scope specifed defaults it to a singleton</span><br><span class="line">public class StudentService &#123;</span><br><span class="line"></span><br><span class="line">    @Lookup  &#x2F;&#x2F; this will be overridden by the container, calling: beanFactory.getBean()(StudentNotification.class)</span><br><span class="line">    public SchoolNotification getSchoolNotification()&#123;  </span><br><span class="line">        return null;  &#x2F;&#x2F; therefore, whatever you have here doesn&#39;t really matter</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Using <code>@Lookup</code>, we can get an new instance of SchoolNotification through our singleton bean** everytime when the method <code>getSchoolNotification</code> is called** (assuming you have a <code>ScopeConfig</code> class with <code>@Configuration</code> and <code>ComponentScan</code> setup correctly):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">package com.mySpringProject.app;</span><br><span class="line"></span><br><span class="line">import com.mySpringProject.app.testIoC.*;</span><br><span class="line">import com.mySpringProject.app.testIoC.AutowiredSamples.FooService;</span><br><span class="line">import com.mySpringProject.app.testIoC.MethodInjectionSamples.StudentService;</span><br><span class="line">import org.springframework.context.ApplicationContext;</span><br><span class="line">import org.springframework.context.annotation.AnnotationConfigApplicationContext;</span><br><span class="line"></span><br><span class="line">public class Example &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        ApplicationContext ctx &#x3D; new AnnotationConfigApplicationContext(ScopeConfig.class);</span><br><span class="line">        </span><br><span class="line">        StudentService stdsrv1 &#x3D; ctx.getBean(StudentService.class);</span><br><span class="line">        StudentService stdsrv2 &#x3D; ctx.getBean(StudentService.class);</span><br><span class="line">        StudentService stdsrv3 &#x3D; ctx.getBean(StudentService.class);</span><br><span class="line">        StudentService stdsrv4 &#x3D; ctx.getBean(StudentService.class);</span><br><span class="line"></span><br><span class="line">        stdsrv1.getSchoolNotification();</span><br><span class="line">        stdsrv2.getSchoolNotification();</span><br><span class="line">        stdsrv3.getSchoolNotification();</span><br><span class="line">        stdsrv4.getSchoolNotification();</span><br><span class="line">        stdsrv1.getSchoolNotification();	&#x2F;&#x2F; you will see that the count monotonously increases</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Customizing-the-Nature-of-Bean"><a href="#Customizing-the-Nature-of-Bean" class="headerlink" title="Customizing the Nature of Bean"></a>Customizing the Nature of Bean</h3><p>The Spring Framework provides a number of interfaces you can use to customize the nature of a bean. This section groups them as follows:</p>
<ul>
<li>Lifecycle Callbacks</li>
<li><code>ApplicationContextAware</code> and <code>BeanNameAware</code></li>
<li>Other <code>Aware</code> Interfaces</li>
</ul>
<h4 id="Lifecycle-Callbacks"><a href="#Lifecycle-Callbacks" class="headerlink" title="Lifecycle Callbacks"></a>Lifecycle Callbacks</h4><p>(additional reference: <a href="https://www.tutorialspoint.com/spring/spring_bean_life_cycle.htm" target="_blank" rel="noopener">https://www.tutorialspoint.com/spring/spring_bean_life_cycle.htm</a>; <a href="https://www.baeldung.com/running-setup-logic-on-startup-in-spring" target="_blank" rel="noopener">https://www.baeldung.com/running-setup-logic-on-startup-in-spring</a>)</p>
<p>The life cycle of a Spring bean is easy to understand. When a bean is instantiated, it may be required to perform some initialization to get it into a usable state. Similarly, when the bean is no longer required and is removed from the container, some cleanup may be required.</p>
<p>The whole concept of lifecycle callbacks is to solve the problem of handling too much control to the container. For example, We can‚Äôt simply include our logic in the beans‚Äô constructors or call methods after instantiation of any object; we are simply not in control during those processes:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InvalidInitExampleBean</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Environment env;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">InvalidInitExampleBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        env.getActiveProfiles();  <span class="comment">// this could get called before Spring bean is fully initialized</span></span><br><span class="line">			                      <span class="comment">// namely, before env gets initialized and attached</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Therefore, this is problematic because calling not yet initialized fields will of course <strong>result in <code>NullPointerExceptions</code></strong>.</p>
<h5 id="Initialization-Callbacks"><a href="#Initialization-Callbacks" class="headerlink" title="Initialization Callbacks"></a>Initialization Callbacks</h5><p>The <code>org.springframework.beans.factory.InitializingBean</code> interface lets a bean perform initialization work after the container has set all necessary properties on the bean. The <strong><code>InitializingBean</code> interface specifies a single method</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br></pre></td></tr></table></figure>

<p>However, it is <strong>not recommend that you use the <code>InitializingBean</code> interface, because it unnecessarily couples the code to Spring</strong>. Alternatively, we suggest using the <code>@PostConstruct</code> annotation or specifying a POJO initialization method.</p>
<p>The <code>@PostConstruct</code> annotation can be used for annotating** a method that should be run once immediately after the bean‚Äôs initialization**. Keep in mind that the annotated method will be executed by Spring even if there is nothing to inject.</p>
<p>Here‚Äôs <code>@PostConstruct</code> in action:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PostConstructExampleBean</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Environment environment;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@PostConstruct</span>  <span class="comment">// called immediately after successful initialization</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">betterApproach</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        env.getActiveProfiles();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>In the example above you can see that the Environment instance was <strong>safely injected and then called in the <code>@PostConstruct</code> annotated method without throwing a <code>NullPointerException</code></strong>.</p>
<h5 id="Destruction-Callbacks"><a href="#Destruction-Callbacks" class="headerlink" title="Destruction Callbacks"></a>Destruction Callbacks</h5><p>Implementing the <code>org.springframework.beans.factory.DisposableBean</code> interface lets a bean get a callback when the container that contains it is destroyed. The <strong><code>DisposableBean</code> interface specifies a single method</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br></pre></td></tr></table></figure>

<p>It is recommended that you <strong>do not use the <code>DisposableBean</code> callback interface</strong>, because it unnecessarily couples the code to Spring. Alternatively, we <strong>suggest using the <code>@PreDestroy</code> annotation</strong> or specifying a generic method that is supported by bean definitions.</p>
<p><strong>A method annotated with <code>@PreDestroy</code> runs only once, just before Spring removes our bean from the application context</strong>.</p>
<p>Same as with <code>@PostConstruct</code>, the methods annotated with <code>@PreDestroy</code> can have any access level but can‚Äôt be static.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserRepository</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> DbConnection dbConnection;</span><br><span class="line">    <span class="meta">@PreDestroy</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        dbConnection.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The <strong>purpose of this method should be to release resources or perform any other cleanup tasks before the bean gets destroyed</strong>, for example closing a database connection.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Note that both <code>@PostConstruct</code> and <code>@PreDestroy</code> annotations are part of Java EE. And since Java EE <strong>has been deprecated in Java 9 and removed in Java 11</strong> we have to add an additional dependency to use these annotations if you are using versions of Java beyond 11.</li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;javax.annotation&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;javax.annotation-api&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.3.2&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<h5 id="Default-initMethod-and-destroyMethod"><a href="#Default-initMethod-and-destroyMethod" class="headerlink" title="Default initMethod and destroyMethod"></a>Default <code>initMethod</code> and <code>destroyMethod</code></h5><p>When you write initialization and destroy method callbacks that do not use the Spring-specific <code>InitializingBean</code> and <code>DisposableBean</code> callback interfaces, you <strong>should</strong> typically write methods with names such as <code>init()</code>, <code>initialize()</code>, <code>dispose()</code>, and so on. Ideally, the names of such lifecycle callback methods are <strong>standardized across a project so that all developers use the same method names and ensure consistency</strong>.</p>
<p>More importantly, you can <strong>specify a default <code>initMethod</code> property or a <code>destroyMethod</code></strong> that can be used to always execute a method <strong>after a bean‚Äôs initialization/before destruction</strong>.</p>
<p>Here‚Äôs what a bean looks like:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InitMethodExampleBean</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Environment environment;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// do some initialization work;</span></span><br><span class="line">		<span class="comment">// notice no interface nor annotation is used here</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You can notice that there are <strong>no special interfaces implemented nor any special annotations used</strong>.</p>
<p>Then, we can <strong>define the bean using the <code>@Bean(intiMethod=&quot;&lt;initMethodName&gt;&quot;)</code> annotation</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span>(initMethod=<span class="string">"init"</span>)  <span class="comment">// the key step</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> InitMethodExampleBean <span class="title">exBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> InitMethodExampleBean();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>And this is will be equivalent to the XML config:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">default-init-method</span>=<span class="string">"init"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"initMethodExampleBean"</span> <span class="attr">class</span>=<span class="string">"com.something.InitMethodExampleBean"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The presence of the <code>initMethod=&quot;init&quot;</code> attribute on the top-level causes the <strong>Spring IoC container to recognize a method called <code>init</code> on the bean class as the initialization method callback</strong>. When a bean is created and assembled, if the bean class has such a method, it is invoked at the appropriate time.</p>
<p>You can configure destroy method callbacks similarly by using the <code>@Bean(destroyMethod=&quot;&lt;destroyMethoName&gt;&quot;)</code> attribute on the top-level.</p>
<h5 id="Combining-Lifecycle-Mechanisms"><a href="#Combining-Lifecycle-Mechanisms" class="headerlink" title="Combining Lifecycle Mechanisms"></a>Combining Lifecycle Mechanisms</h5><p>Multiple lifecycle mechanisms configured for the same bean, with different initialization methods, are called as follows <strong>in order</strong>:</p>
<ul>
<li>Methods annotated with <code>@PostConstruct</code></li>
<li><code>afterPropertiesSet()</code> as defined by the <code>InitializingBean</code> callback interface</li>
<li>A custom configured <code>init()</code> method</li>
</ul>
<p>Destroy methods are called in the same order:</p>
<ul>
<li>Methods annotated with <code>@PreDestroy</code></li>
<li><code>destroy()</code> as defined by the <code>DisposableBean</code> callback interface</li>
<li>A custom configured <code>destroy()</code> method</li>
</ul>
<h5 id="Startup-and-Shutdown-Callbacks"><a href="#Startup-and-Shutdown-Callbacks" class="headerlink" title="Startup and Shutdown Callbacks"></a>Startup and Shutdown Callbacks</h5><p>The <code>Lifecycle</code> interface defines the <strong>essential methods for any object that has its own lifecycle requirements</strong> (such as starting and stopping some background process):</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Lifecycle</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">start</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isRunning</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Any Spring-managed object may implement the <code>Lifecycle</code> interface. Then, when the <code>ApplicationContext</code> itself receives start and stop signals (for example, <strong>for a stop/restart scenario at runtime</strong>), it <strong>cascades those calls to all <code>Lifecycle</code> implementations defined within that context</strong>. It does this by delegating to a <code>LifecycleProcessor</code>, shown in the following listing:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">LifecycleProcessor</span> <span class="keyword">extends</span> <span class="title">Lifecycle</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onRefresh</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onClose</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Notice that the <code>LifecycleProcessor</code> is itself an extension of the <code>Lifecycle</code> interface. It also <strong>adds two other methods for reacting to the context being refreshed and closed</strong>.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Note that the regular <code>org.springframework.context.Lifecycle</code> interface is a plain contract for explicit start and stop notifications and <strong>does not imply auto-startup at context refresh time</strong>. For fine-grained control over auto-startup of a specific bean (including startup phases), consider implementing <code>org.springframework.context.SmartLifecycle</code> instead.</li>
</ul>
</blockquote>
<h5 id="Order-of-Startup-and-Shutdown-with-Dependencies"><a href="#Order-of-Startup-and-Shutdown-with-Dependencies" class="headerlink" title="Order of Startup and Shutdown with Dependencies"></a>Order of Startup and Shutdown with Dependencies</h5><p>The order of startup and shutdown invocations can be important. If a ‚Äúdepends-on‚Äù relationship exists between any two objects, the dependent side starts after its dependency, and it stops before its dependency. However, sometimes you might not want this order of execution. In this case, you would need to use the <code>SmartLifeCycle</code> Interface:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SmartLifecycle</span> <span class="keyword">extends</span> <span class="title">Lifecycle</span>, <span class="title">Phased</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isAutoStartup</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">stop</span><span class="params">(Runnable callback)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>and the <code>Phased</code> interface looks like:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Phased</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getPhase</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>When starting, the <strong>objects with the lowest phase start first</strong>. When <strong>stopping, the reverse order is followed</strong>. Therefore, an object that implements <code>SmartLifecycle</code> and whose <code>getPhase()</code> method returns <code>Integer.MIN_VALUE</code> would be among the first to start and the last to stop. At the other end of the spectrum, a phase value of <code>Integer.MAX_VALUE</code> would indicate that the object should be started last and stopped first (likely because it depends on other processes to be running). When considering the phase value, it is also important to know that the <strong>default phase for any ‚Äúnormal‚Äù Lifecycle object that does not implement <code>SmartLifecycle</code> is <code>0</code></strong>.</p>
<h5 id="Shuttingdown-a-Non-Web-application"><a href="#Shuttingdown-a-Non-Web-application" class="headerlink" title="Shuttingdown a Non-Web application"></a>Shuttingdown a Non-Web application</h5><p>If you use Spring‚Äôs IoC container in a non-web application environment (for example, in a rich client desktop environment), you should <strong>register a shutdown hook</strong> with the JVM. Doing so ensures a <strong>graceful shutdown and calls the relevant destroy methods on your singleton beans so that all resources are released</strong>. You must <strong>still configure and implement these destroy callbacks correctly</strong> (e.g. with <code>@Bean(destoryMethod=&quot;dispose&quot;)</code>, and implement the <code>dispose()</code> methods).</p>
<p>To register a shutdown hook, call the <code>registerShutdownHook()</code> method that is declared on the <code>ConfigurableApplicationContext</code> interface, as the following example shows:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.ConfigurableApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Boot</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">final</span> String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ConfigurableApplicationContext ctx = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"beans.xml"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// add a shutdown hook for the above context...</span></span><br><span class="line">        ctx.registerShutdownHook();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// app runs here...</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// main method exits, hook is called prior to the app shutting down...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="ApplicationContextAware-and-BeanNameAware"><a href="#ApplicationContextAware-and-BeanNameAware" class="headerlink" title="ApplicationContextAware and BeanNameAware"></a><code>ApplicationContextAware</code> and <code>BeanNameAware</code></h5><p>When an <strong><code>ApplicationContext</code> creates an object instance that implements the <code>org.springframework.context.ApplicationContextAware</code> interface</strong>, the <strong>instance is provided with a reference to that <code>ApplicationContext</code></strong>. This means that object could manipulate the container. The following listing shows the definition of the ApplicationContextAware interface:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ApplicationContextAware</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Thus, beans can programmatically manipulate the <code>ApplicationContext</code> that created them, through the <code>ApplicationContext</code> interface or by casting the reference to a known subclass of this interface (such as <code>ConfigurableApplicationContext</code>, which exposes additional functionality). One use would be the programmatic retrieval of other beans. Sometimes this capability is useful. <strong>However, in general, you should avoid it, because it couples the code to Spring and does not follow the Inversion of Control style</strong>, where collaborators are provided to beans as properties.</p>
<p>When an <code>ApplicationContext</code> creates a class that implements the <code>org.springframework.beans.factory.BeanNameAware</code> interface, <strong>the class is provided with a reference to the bean</strong> with name defined in its associated object definition. The following listing shows the definition of the BeanNameAware interface:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BeanNameAware</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setBeanName</span><span class="params">(String name)</span> <span class="keyword">throws</span> BeansException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The callback is <strong>invoked after population of normal bean properties but before an initialization callback such as <code>InitializingBean</code>, <code>afterPropertiesSet</code>, or a custom <code>init-method</code></strong>.</p>
<h4 id="Bean-Definition-Inheritance"><a href="#Bean-Definition-Inheritance" class="headerlink" title="Bean Definition Inheritance"></a>Bean Definition Inheritance</h4><p>(additional reference: <a href="https://www.tutorialspoint.com/spring/spring_bean_definition_inheritance.htm" target="_blank" rel="noopener">https://www.tutorialspoint.com/spring/spring_bean_definition_inheritance.htm</a>)</p>
<p>A bean definition can contain a lot of configuration information, including constructor arguments, property values, and container-specific information, such as the initialization method, a static factory method name, and so on. <strong>A child bean definition inherits configuration data from a parent definition</strong>. The child definition can override some values or add others as needed. Using parent and child bean definitions can save a lot of typing. Effectively, this is a form of templating.</p>
<p>In Java, this should be simple enough to have the <code>extends</code> keyword for that specific class, and then use <code>@Bean</code> at the correct place. You could also inherit an <code>@Configuration</code> class, which will also inherit all the <code>@Bean</code> configurations with it.</p>
<p>Without using the XML file, it should be similar to the normal Java inheritance.</p>
<h4 id="Customizing-your-Container"><a href="#Customizing-your-Container" class="headerlink" title="Customizing your Container"></a>Customizing your Container</h4><p>Typically, an application developer does not need to subclass ApplicationContext implementation classes. Instead, the Spring IoC container can be extended by plugging in implementations of special integration interfaces, or simply by using some anotations, in order to <strong>add some customized functionalities for the container (e.g. <code>@Autowired</code> is one example)</strong></p>
<h5 id="Using-Primary"><a href="#Using-Primary" class="headerlink" title="Using @Primary"></a>Using @Primary</h5><p>Because autowiring by type <strong>may lead to multiple candidates</strong>, it is often necessary to have more control over the selection process. One way to accomplish this is with Spring‚Äôs <code>@Primary</code> annotation. <code>@Primary</code> indicates that <strong>a particular bean should be given preference when multiple beans are candidates to be autowired to a single-valued dependency</strong>. If exactly one primary bean exists among the candidates, it becomes the autowired value.</p>
<p>Consider the following configuration that defines <strong><code>firstMovieCatalog</code> as the primary <code>MovieCatalog</code></strong> if an <code>MovieCatalog</code> is to be autowired:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MovieConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MovieCatalog <span class="title">firstMovieCatalog</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MovieCatalog <span class="title">secondMovieCatalog</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>With the preceding configuration, the following <code>MovieRecommender</code> is autowired with the <code>firstMovieCatalog</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MovieRecommender</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MovieCatalog movieCatalog;  <span class="comment">// so that the firstMovieCatalog would be created</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Using-Qualifier"><a href="#Using-Qualifier" class="headerlink" title="Using @Qualifier"></a>Using @Qualifier</h5><p><code>@Primary</code> is an effective way to use autowiring by type with several instances when one primary candidate can be determined. When you need even more control over the selection process, for example <strong>letting each bean to be autowired in a different setting</strong>, you can use Spring‚Äôs <code>@Qualifier</code> annotation. <strong>You can associate qualifier values with specific arguments, narrowing the set of type matches so that a specific bean is chosen for each argument</strong>. In the simplest case, this can be a plain descriptive value, as shown in the following example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MovieRecommender</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier</span>(<span class="string">"main"</span>)</span><br><span class="line">    <span class="keyword">private</span> MovieCatalog movieCatalog;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You can also specify the <code>@Qualifier</code> annotation on individual constructor arguments or method parameters, as shown in the following example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MovieRecommender</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MovieCatalog movieCatalog;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">(@Qualifier(<span class="string">"main"</span>)</span> MovieCatalog movieCatalog) </span>&#123;  <span class="comment">// specifies which MovieCatalog gets used</span></span><br><span class="line">        <span class="keyword">this</span>.movieCatalog = movieCatalog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Type-Matching-for-Generics"><a href="#Type-Matching-for-Generics" class="headerlink" title="Type Matching for Generics"></a>Type Matching for Generics</h5><p>In addition to the <code>@Qualifier</code> annotation, you can use <strong>Java generic types as an implicit form of qualification</strong>. For example, suppose you have the following configuration:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> StringStore <span class="title">stringStore</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> StringStore();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IntegerStore <span class="title">integerStore</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> IntegerStore();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Assuming that the preceding beans <strong>implement a generic interface, (that is, <code>Store&lt;String&gt;</code> and <code>Store&lt;Integer&gt;</code>)</strong>, you can <code>@Autowire</code> the <code>Store</code> interface and the generic is used as a qualifier, as the following example shows:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> Store&lt;String&gt; s1; <span class="comment">// equivalent as having a &lt;String&gt; qualifier, injects the stringStore bean</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> Store&lt;Integer&gt; s2; <span class="comment">// equivalent as having a &lt;Integer&gt; qualifier, injects the integerStore bean</span></span><br></pre></td></tr></table></figure>

<p>Generic qualifiers also apply when autowiring <code>List</code>s, <code>Map</code> instances and <code>Array</code>s. The following example autowires a generic List:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Inject all Store beans as long as they have an &lt;Integer&gt; generic</span></span><br><span class="line"><span class="comment">// Store&lt;String&gt; beans will not appear in this list</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> List&lt;Store&lt;Integer&gt;&gt; s;</span><br></pre></td></tr></table></figure>

<h5 id="Using-Resource"><a href="#Using-Resource" class="headerlink" title="Using @Resource"></a>Using @Resource</h5><p>(additional reference: <a href="https://www.baeldung.com/spring-annotations-resource-inject-autowire" target="_blank" rel="noopener">https://www.baeldung.com/spring-annotations-resource-inject-autowire</a>)</p>
<p>The <code>@Resource</code> annotation is part of the JSR-250 annotation collection and is packaged with Jakarta EE. This is used for <strong>field or setter dependency injection</strong>. This annotation has the following execution order:</p>
<ul>
<li>Match by Name (if a name is specified as an argument to <code>@Resource</code>, so it resolves the bean with the name specified)</li>
<li>Match by Type (if a name is not specified as an argument to <code>@Resource</code>, so it resolves the name by type )</li>
<li>Match by Qualifier (if a name is specified as an argument to <code>@Resource</code>, but there is no bean with that name nor resolvable by type, then need to be resolved by <code>@Qualifier</code>)</li>
</ul>
<p>These execution paths are applicable to both setter and field injection.</p>
<ul>
<li><p><strong>Field Injection</strong> with <code>@Resource</code></p>
<ul>
<li><p>Match by name: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FieldResourceInjection</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span>(name=<span class="string">"namedFile"</span>)  <span class="comment">// injection by finding the corresponding Bean</span></span><br><span class="line">    <span class="keyword">private</span> File defaultFile;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printMessage</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Hello"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Your configuration:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResourceConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(name=<span class="string">"namedFile"</span>)  <span class="comment">// match by name</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> File <span class="title">generateFile</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> NamedFile(<span class="string">"test NamedFile"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(name=<span class="string">"annotatedFile"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> File <span class="title">generateAnotatedFile</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AnnotatedFile(<span class="string">"test NamedFile"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FieldResourceInjection <span class="title">testInjectionByName</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> FieldResourceInjection();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Match by Type:</p>
<p>This works the same as having <code>@Autowired</code>, so that you canont have two beans with the same type produced:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FieldResourceInjection</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span>  <span class="comment">// injection by finding the corresponding type amongst the Beans</span></span><br><span class="line">    <span class="keyword">private</span> File defaultFile;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printMessage</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Hello"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The Configuration file:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line">	<span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">import</span> java.io.File;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Configuration</span></span><br><span class="line">	<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResourceConfig</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	    <span class="meta">@Bean</span>(name=<span class="string">"namedFile"</span>)  <span class="comment">// won't work if there is another Bean with outputting a File object</span></span><br><span class="line">	    <span class="function"><span class="keyword">public</span> File <span class="title">generateFile</span><span class="params">()</span></span>&#123;</span><br><span class="line">	        <span class="keyword">return</span> <span class="keyword">new</span> NamedFile(<span class="string">"test NamedFile"</span>);</span><br><span class="line">	    &#125;</span><br><span class="line">	</span><br><span class="line">	    <span class="meta">@Bean</span></span><br><span class="line">	    <span class="function"><span class="keyword">public</span> FieldResourceInjection <span class="title">testInjectionByName</span><span class="params">()</span></span>&#123;</span><br><span class="line">	        <span class="keyword">return</span> <span class="keyword">new</span> FieldResourceInjection();</span><br><span class="line">	    &#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Match by Qualifier:</p>
<p>This works the same as match by name, but instead of specifying the name in the <code>@Resource</code>, you specify in <code>@Qualifier()</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FieldResourceInjection</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">	<span class="meta">@Qualifier</span>(<span class="string">"namedFile"</span>)  <span class="comment">// injection by finding the corresponding Bean</span></span><br><span class="line">    <span class="keyword">private</span> File defaultFile;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printMessage</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Hello"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Your configuration:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResourceConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(name=<span class="string">"namedFile"</span>)  <span class="comment">// match by qualifier, but pretty much the same as Match By Name</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// properly, the following also works</span></span><br><span class="line">	<span class="comment">// @Bean</span></span><br><span class="line">	<span class="comment">// @Qualifer("namedFile")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> File <span class="title">generateFile</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> NamedFile(<span class="string">"test NamedFile"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(name=<span class="string">"annotatedFile"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> File <span class="title">generateAnotatedFile</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AnnotatedFile(<span class="string">"test NamedFile"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FieldResourceInjection <span class="title">testInjectionByName</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> FieldResourceInjection();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>Setter Injection</strong></p>
<ul>
<li><p>The only difference is that the <code>@Resource</code> is placed above the setter method instead of the field. For example, matching by name would look like:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FieldResourceInjection</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> File defaultFile;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Resource</span>(name=<span class="string">"namedFile"</span>)  <span class="comment">// injection by finding the corresponding Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFile</span><span class="params">(File namedFile)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.defaultFile = namedFile;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printMessage</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Hello"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Your configuration:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResourceConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(name=<span class="string">"namedFile"</span>)  <span class="comment">// match by name</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> File <span class="title">generateFile</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> NamedFile(<span class="string">"test NamedFile"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(name=<span class="string">"annotatedFile"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> File <span class="title">generateAnotatedFile</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AnnotatedFile(<span class="string">"test NamedFile"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FieldResourceInjection <span class="title">testInjectionByName</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> FieldResourceInjection();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>the other matching schemes follow the same pattern, so they are not shown here.</p>
</li>
</ul>
</li>
</ul>
<h5 id="Using-Value"><a href="#Using-Value" class="headerlink" title="Using @Value"></a>Using <code>@Value</code></h5><p><code>@Value</code> is typically used to inject externalized properties:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MovieRecommender</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String catalog;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MovieRecommender</span><span class="params">(@Value(<span class="string">"$&#123;catalog.name&#125;"</span>)</span> String catalog) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.catalog = catalog;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>With the following configuration:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@PropertySource</span>(<span class="string">"classpath:application.properties"</span>)  <span class="comment">// refers to an external .properties file</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123; &#125;</span><br></pre></td></tr></table></figure>

<p>And the following <code>application.properties</code> file:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">catalog.name&#x3D;MovieCatalog</span><br></pre></td></tr></table></figure>

<p>In that case, the <code>catalog</code> parameter and field will be equal to the <code>&quot;MovieCatalog&quot;</code> value.</p>
<p>Also, built-in converter support provided by Spring allows <strong>simple type conversion (to Integer or int for example) to be automatically handled</strong>. Multiple comma-separated values can be automatically converted to String array without extra effort.</p>
<p>When <code>@Value</code> <strong>contains a <code>SpEL</code> expression</strong> the value will <strong>be dynamically computed at runtime as the following example shows</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MovieRecommender</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String catalog;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MovieRecommender</span><span class="params">(@Value(<span class="string">"#&#123;systemProperties['user.catalog'] + 'Catalog' &#125;"</span>)</span> String catalog) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.catalog = catalog;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>SpEL</code> also enables the use of more complex data structures:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MovieRecommender</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Integer&gt; countOfMoviesPerCatalog;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MovieRecommender</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            @Value(<span class="string">"#&#123;&#123;'Thriller': 100, 'Comedy': 300&#125;&#125;"</span>)</span> Map&lt;String, Integer&gt; countOfMoviesPerCatalog) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.countOfMoviesPerCatalog = countOfMoviesPerCatalog;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Classpath-Scanning-and-Managed-Components"><a href="#Classpath-Scanning-and-Managed-Components" class="headerlink" title="Classpath Scanning and Managed Components"></a>Classpath Scanning and Managed Components</h3><h4 id="Component-and-Further-Stereotype-Annotations"><a href="#Component-and-Further-Stereotype-Annotations" class="headerlink" title="@Component and Further Stereotype Annotations"></a><code>@Component</code> and Further Stereotype Annotations</h4><p>(additional reference: <a href="https://www.baeldung.com/spring-bean-annotations" target="_blank" rel="noopener">https://www.baeldung.com/spring-bean-annotations</a>)</p>
<p>For example, the <code>@Repository</code> annotation is a marker for any class that fulfills the role or stereotype of a repository (also known as Data Access Object or <code>DAO</code>). Among the uses of this marker is the automatic translation of exceptions.</p>
<p>Spring provides further stereotype annotations: <code>@Component</code>, <code>@Service</code>, and <code>@Controller</code>. <strong><code>@Component</code> is a generic stereotype</strong> for any Spring-managed component. <strong><code>@Repository</code>, <code>@Service</code>, and <code>@Controller</code> are specializations of <code>@Component</code> for more specific use cases</strong> (in the persistence, service, and presentation layers, respectively). Therefore, you can annotate your component classes with <code>@Component</code>, but, by annotating them with <code>@Repository</code>, <code>@Service</code>, or <code>@Controller</code> instead, your classes are more properly suited for processing by tools or associating with aspects.</p>
<h5 id="Using-Repository"><a href="#Using-Repository" class="headerlink" title="Using @Repository"></a>Using <code>@Repository</code></h5><p><code>DAO</code> or <code>Repository</code> classes usually represent the <strong>database access layer in an application</strong>, and should be annotated with <code>@Repository</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VehicleRepository</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>One advantage of using this annotation is that it has <strong>automatic persistence exception translation enabled</strong>. When using a persistence framework such as Hibernate, native exceptions thrown within classes annotated with <code>@Repository</code> will be automatically translated into subclasses of Spring‚Äôs <code>DataAccessExeption</code>.</p>
<p>To enable exception translation, we need to declare our own <code>PersistenceExceptionTranslationPostProcessor</code> bean:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PersistenceExceptionTranslationPostProcessor <span class="title">exceptionTranslation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> PersistenceExceptionTranslationPostProcessor();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Note, that in most cases, Spring does the step above automatically.</p>
<h5 id="Using-Service"><a href="#Using-Service" class="headerlink" title="Using @Service"></a>Using <code>@Service</code></h5><p>The <strong>business logic of an application usually resides within the service layer</strong> ‚Äì so we‚Äôll use the @Service annotation to indicate that a class belongs to that layer:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VehicleService</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...    </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Using-Controller"><a href="#Using-Controller" class="headerlink" title="Using @Controller"></a>Using <code>@Controller</code></h5><p><code>@Controller</code> is a class level annotation which tells the Spring Framework that <strong>this class serves as a controller in Spring MVC</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VehicleController</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Automatic-Detecting-Stereotype-Annotations"><a href="#Automatic-Detecting-Stereotype-Annotations" class="headerlink" title="Automatic Detecting Stereotype Annotations"></a>Automatic Detecting Stereotype Annotations</h4><p>Spring can automatically detect stereotyped classes and register corresponding <code>BeanDefinition</code> instances with the <code>ApplicationContext</code>. For example, the following two classes are eligible for such autodetection:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleMovieLister</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MovieFinder movieFinder;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SimpleMovieLister</span><span class="params">(MovieFinder movieFinder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.movieFinder = movieFinder;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>and</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JpaMovieFinder</span> <span class="keyword">implements</span> <span class="title">MovieFinder</span> </span>&#123;</span><br><span class="line">    <span class="comment">// implementation elided for clarity</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>To autodetect these classes and register the corresponding beans, you need to <strong>add <code>@ComponentScan</code> to your <code>@Configuration</code> class, where the basePackages attribute is a common parent package for the two classes</strong>. (Alternatively, you can specify a comma- or semicolon- or space-separated list that includes the parent package of each class.)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages = <span class="string">"org.example"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span>  </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Customizing-ComponentScanning-using-Filters"><a href="#Customizing-ComponentScanning-using-Filters" class="headerlink" title="Customizing ComponentScanning using Filters"></a>Customizing ComponentScanning using Filters</h4><p>By default, classes annotated with <code>@Component</code>,<code>@Repository</code>, <code>@Service</code>, <code>@Controller</code>, <code>@Configuration</code>, or a custom annotation that itself is annotated with <code>@Component</code> are the only detected candidate components. However, you can modify and extend this behavior by applying custom filters. <strong>Add them as <code>includeFilters</code> or <code>excludeFilters</code> attributes of the <code>@ComponentScan</code> annotation</strong>.</p>
<table>
<thead>
<tr>
<th>Filter Type</th>
<th>Example Expression</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>annotation (default)</td>
<td>SomeAnnotation</td>
<td>An annotation to be present or meta-present at the type level in target components.</td>
</tr>
<tr>
<td>assignable</td>
<td>SomeClass</td>
<td>A class (or interface) that the target components are assignable to (extend or implement).</td>
</tr>
<tr>
<td>aspectj</td>
<td>.*Service+</td>
<td>An AspectJ type expression to be matched by the target components.</td>
</tr>
<tr>
<td>regex</td>
<td>org.example.Default.*</td>
<td>A regex expression to be matched by the target components‚Äô class names.</td>
</tr>
<tr>
<td>custom</td>
<td>MyTypeFilter</td>
<td>A custom implementation of the org.springframework.core.type.TypeFilter interface.</td>
</tr>
</tbody></table>
<p>For example, you can have the configuration to** ignoring all <code>@Repository</code> annotations** and <strong>using ‚Äústub‚Äù repositories instead</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages = <span class="string">"org.example"</span>,</span><br><span class="line">        includeFilters = <span class="meta">@Filter</span>(type = FilterType.REGEX, pattern = <span class="string">".*Stub.*Repository"</span>),</span><br><span class="line">        excludeFilters = <span class="meta">@Filter</span>(Repository<span class="class">.<span class="keyword">class</span>))</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="AOP-Aspect-Oriented-Programming-with-Spring"><a href="#AOP-Aspect-Oriented-Programming-with-Spring" class="headerlink" title="AOP - Aspect Oriented Programming with Spring"></a>AOP - Aspect Oriented Programming with Spring</h2><p>(additional reference: <a href="https://www.tutorialspoint.com/springaop/springaop_overview.htm" target="_blank" rel="noopener">https://www.tutorialspoint.com/springaop/springaop_overview.htm</a>)</p>
<p>Aspect-oriented Programming (AOP) complements Object-oriented Programming (OOP) by providing another way of thinking about program structure. The key unit of modularity in OOP is the class, whereas in AOP the unit of modularity is the aspect. Aspects enable the modularization of concerns (such as transaction management) that cut across multiple types and objects. (Such concerns are often termed ‚Äúcrosscutting‚Äù concerns in AOP literature.)</p>
<p>One of the key components of Spring is the AOP framework. <strong>While the Spring IoC container does not depend on AOP (meaning you do not need to use AOP if you don‚Äôt want to), AOP complements Spring IoC to provide a very capable middleware solution.</strong></p>
<p>The key unit of modularity in OOP is the class, whereas in AOP the unit of modularity is the aspect. <strong>Dependency Injection helps you decouple your application objects from each other</strong>, while <strong>AOP helps you decouple cross-cutting concerns from the objects that they affect</strong>. AOP is like triggers in programming languages such as Perl, .NET, Java, and others.</p>
<p>Spring AOP module lets interceptors intercept an application. For example, when a method is executed, you can add extra functionality before or after the method execution.</p>
<h4 id="Core-Concepts-in-AOP"><a href="#Core-Concepts-in-AOP" class="headerlink" title="Core Concepts in AOP"></a>Core Concepts in AOP</h4><p>Before we start working with AOP, let us become familiar with the AOP concepts and terminologies. These terms are not specific to Spring, rather they are related to AOP.</p>
<table>
<thead>
<tr>
<th>Terms</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>Aspect</td>
<td><strong>A module which has a set of APIs</strong> providing cross-cutting requirements. For example, a logging module would be called AOP aspect for logging. An application can have any number of aspects depending on the requirement.</td>
</tr>
<tr>
<td>Join point</td>
<td>This represents <strong>a point in your application where you can plug-in AOP aspect</strong>. You can also say, it is the actual place in the application where an action will be taken using Spring AOP framework.</td>
</tr>
<tr>
<td>Advice</td>
<td>This is the** actual action to be taken either before or after the method execution<strong>. This is the **actual piece of code that is invoked</strong> during program execution by Spring AOP framework.</td>
</tr>
<tr>
<td>PointCut</td>
<td>This is <strong>a set of one or more joinpoints where an advice should be executed</strong>. You can specify PointCuts using expressions or patterns as we will see in our AOP examples.</td>
</tr>
<tr>
<td>Introduction</td>
<td>An introduction allows you <strong>to add new methods or attributes to existing classes</strong>.</td>
</tr>
<tr>
<td>Target object</td>
<td><strong>The object being advised</strong> by one or more aspects. This object will always be a proxied object. Also referred to as the advised object.</td>
</tr>
<tr>
<td>AOP proxy</td>
<td><strong>An object</strong> created by the AOP framework <strong>in order to implement the aspect contracts (advise method executions and so on)</strong>. In the Spring Framework, an AOP proxy is a JDK dynamic proxy or a CGLIB proxy.</td>
</tr>
<tr>
<td>Weaving</td>
<td>Weaving is the <strong>process of linking aspects with other application types or objects to create an advised object</strong>. This can be done at compile time, load time, or at runtime.</td>
</tr>
</tbody></table>
<p>Spring aspects can work with <strong>five kinds of advice</strong> mentioned in the following table.</p>
<table>
<thead>
<tr>
<th>Advice Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>before</td>
<td>Run advice before the method execution.</td>
</tr>
<tr>
<td>after</td>
<td>Run advice after the method execution, <strong>regardless of its outcome</strong>.</td>
</tr>
<tr>
<td>after-returning</td>
<td>Run advice after the method execution, <strong>only if the method completes successfully</strong>.</td>
</tr>
<tr>
<td>after-throwing</td>
<td>Run advice after the method execution, <strong>only if the method exits by throwing an exception</strong>.</td>
</tr>
<tr>
<td>around</td>
<td>Run advice <strong>before and after</strong> the advised method is invoked.</td>
</tr>
</tbody></table>
<p>Around advice is the most general kind of advice. Since Spring AOP, like AspectJ, provides a full range of advice types, it is recommended that you <strong>use the least powerful advice type that can implement the required behavior</strong>. For example, if you need only to update a cache with the return value of a method, you are better off implementing an after returning advice than an around advice, although an around advice can accomplish the same thing. Using the most specific advice type provides a simpler programming model with less potential for errors.</p>
<p>The concept of join points matched by pointcuts is the key to AOP, which distinguishes it from older technologies offering only interception. <strong>Pointcuts enable advice to be targeted independently of the object-oriented hierarchy</strong>. For example, you can apply an around advice providing declarative transaction management to a set of methods that span multiple objects (such as all business operations in the service layer).</p>
<h4 id="Enabling-AspectJ"><a href="#Enabling-AspectJ" class="headerlink" title="Enabling AspectJ"></a>Enabling AspectJ</h4><p>To use annotations from AspectJ, you need to make sure that you have the <code>aspectjweaver.jar</code> in your classpath. Since we are using Maven and will be mainly focused on Java-annotation based, it is as simple as adding a dependency in your <code>POM</code> file:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.aspectj&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;aspectjweaver&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.8.9&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>Then, to <strong>enable <code>@AspectJ</code> support with Java <code>@Configuration</code></strong>, add the <code>@EnableAspectJAutoProxy</code> annotation, as the following example shows:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> By auto-proxying, we mean that, if Spring determines that <strong>a bean is advised by one or more aspects, it automatically generates a proxy for that bean to intercept method invocations and ensures that advice is executed as needed</strong>.</li>
</ul>
</blockquote>
<h5 id="Declaring-an-Aspect"><a href="#Declaring-an-Aspect" class="headerlink" title="Declaring an Aspect"></a>Declaring an Aspect</h5><p>With <code>@AspectJ</code> support enabled, <strong>any bean defined in your application context with a class that is an <code>@AspectJ</code> aspect (has the <code>@Aspect</code> annotation) is automatically detected by Spring and used to configure Spring AOP</strong>. </p>
<p>The following shows a <code>NotVeryUsefulAspect</code> class definition, which is annotated with the <code>org.aspectj.lang.annotation.Aspect annotation</code> to become an aspect:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.xyz;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NotVeryUsefulAspect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Aspects (classes annotated with <code>@Aspect</code>) can have methods and fields, the same as any other class</strong>. They can also contain pointcut, advice, and introduction (inter-type) declarations.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> You can register aspect classes as regular beans in your Spring XML configuration or autodetect them through classpath scanning‚Äâ‚Äî‚Äâthe same as any other Spring-managed bean. However, <strong>note that the <code>@Aspect</code>annotation is not sufficient for autodetection in the classpath</strong>. For that purpose, you need to <strong>add a separate <code>@Component</code> annotation</strong> (or, alternatively, a custom stereotype annotation that qualifies, as per the rules of Spring‚Äôs component scanner).</li>
<li><input disabled type="checkbox"> In Spring AOP, <strong>aspects themselves cannot be the targets of advice from other aspects</strong>. The <code>@Aspect</code> annotation on a class marks it as an aspect and, hence, excludes it from auto-proxying.</li>
</ul>
</blockquote>
<h4 id="Declaring-a-Pointcut"><a href="#Declaring-a-Pointcut" class="headerlink" title="Declaring a Pointcut"></a>Declaring a Pointcut</h4><p>Pointcuts determine join points of interest and thus enable us to <strong>control when advice executes</strong>. Spring AOP <strong>only supports method execution join points for Spring beans</strong>, so you can think of a pointcut as matching the execution of methods on Spring beans.</p>
<p>A pointcut declaration has two parts: </p>
<ul>
<li>a method signature comprising a name and any parameters <ul>
<li>this will look like a standard java method, except that it <strong>must have a <code>void</code> return type</strong></li>
</ul>
</li>
<li>a pointcut expression that determines exactly which method executions we are interested in.</li>
</ul>
<p>The following example defines a pointcut named <code>anyOldTransfer</code> that <strong>matches the execution of any method named transfer</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut</span>(<span class="string">"execution(* transfer(..))"</span>) <span class="comment">// the pointcut expression</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">anyOldTransfer</span><span class="params">()</span> </span>&#123;&#125; <span class="comment">// the pointcut signature</span></span><br><span class="line">					             <span class="comment">// this can be used later for advice annotations to refer to this pointcut.</span></span><br></pre></td></tr></table></figure>

<p>The pointcut expression that forms the value of the <code>@Pointcut</code> annotation is a regular AspectJ 5 pointcut expression. For a full discussion of AspectJ‚Äôs pointcut language, see the <a href="https://www.eclipse.org/aspectj/doc/released/progguide/index.html" target="_blank" rel="noopener">Offical AspectJ Programming Guide</a>.</p>
<h5 id="Supported-Pointcut-Designators"><a href="#Supported-Pointcut-Designators" class="headerlink" title="Supported Pointcut Designators"></a>Supported Pointcut Designators</h5><p>Spring AOP supports the following AspectJ pointcut designators (PCD) for use in pointcut expressions:</p>
<ul>
<li><code>execution</code>: For matching <strong>method execution</strong> join points. This is the primary pointcut designator to use when working with Spring AOP.</li>
<li><code>within</code>: Limits matching to join points <strong>within certain types</strong> (the execution of a method declared within a matching type when using Spring AOP).</li>
<li><code>this</code>: Limits matching to join points (the execution of methods when using Spring AOP) <strong>where the bean reference (Spring AOP proxy) is an instance of the given type</strong>.</li>
<li><code>target</code>: Limits matching to join points (the execution of methods when using Spring AOP) where the <strong>target object (application object being proxied) is an instance of the given type</strong>.</li>
<li><code>args</code>: Limits matching to join points (the execution of methods when using Spring AOP) where the <strong>arguments are instances of the given types</strong>.</li>
<li><code>@target</code>: Limits matching to join points (the execution of methods when using Spring AOP) where <strong>the class of the executing object has an annotation of the given type</strong>.</li>
<li><code>@args</code>: Limits matching to join points (the execution of methods when using Spring AOP) where <strong>the runtime type of the actual arguments passed have annotations of the given types</strong>.</li>
<li><code>@within</code>: Limits matching to join points** within types that have the given annotation (the execution of methods declared in types with the given annotation when using Spring AOP)**.</li>
<li><code>@annotation</code>: Limits matching to join points where the <strong>subject of the join point (the method being executed in Spring AOP) has the given annotation</strong>.</li>
<li><code>bean</code>: <strong>Spring AOP also supports an additional PCD named <code>bean</code></strong>. This PCD lets you limit the matching of join points to <strong>a particular named Spring bean or to a set of named Spring beans</strong> (when using wildcards).</li>
</ul>
<h4 id="More-on-using-quot-execution-quot"><a href="#More-on-using-quot-execution-quot" class="headerlink" title="More on using &quot;execution&quot;"></a>More on using <code>&quot;execution&quot;</code></h4><p>Spring AOP users <strong>are likely to use the execution pointcut designator the most often</strong>. The format of an execution expression follows:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution(modifiers-pattern? ret-type-pattern declaring-type-pattern? name-pattern(param-pattern) <span class="keyword">throws</span>-pattern?)</span><br></pre></td></tr></table></figure>

<p>All parts except the returning type pattern (ret-type-pattern in the preceding snippet), the name pattern, and the parameters pattern are optional (<strong>the ones ending with ‚Äú<code>?</code>‚Äú are optional</strong>). The returning type pattern determines what the return type of the method must be in order for a join point to be matched. <strong><code>*</code></strong> is most frequently used as the returning type pattern. It <strong>matches any return type</strong>. A fully-qualified type name matches only when the method returns the given type. <strong>The name pattern matches the method name</strong>. You can use the <strong><code>*</code> wildcard as all or part of a name pattern</strong>. If you <strong>specify a declaring type pattern, include a trailing <code>.</code> to join it to the name pattern component</strong>. The <strong>parameters pattern</strong> is slightly more complex: <strong><code>()</code> matches a method that takes no parameters, whereas <code>(..)</code> matches any number (zero or more) of parameters.</strong> The <strong><code>(*)</code> pattern matches a method that takes one parameter of any type</strong>. <code>(*,String)</code> matches a method that takes two parameters. The first can be of any type, while the second must be a String. Consult the <a href="https://www.eclipse.org/aspectj/doc/released/progguide/semantics-pointcuts.html" target="_blank" rel="noopener">Language Semantics</a> section of the AspectJ Programming Guide for more information.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Declaring type pattern means: <strong>Package or class</strong> (ex: <code>com.app.service.*</code> - applies to all classes in this package; <code>com.app.service.UserService</code> - applies only to UserService class; <code>*</code> - all)</li>
</ul>
</blockquote>
<h4 id="Combining-PointCut-Expressions"><a href="#Combining-PointCut-Expressions" class="headerlink" title="Combining PointCut Expressions"></a>Combining PointCut Expressions</h4><p>You can <strong>combine pointcut expressions</strong> by using <code>&amp;&amp;</code>, <code>||</code> and <code>!</code>. You can also <strong>refer to pointcut expressions by name(method name)</strong>. The following example shows three pointcut expressions:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut</span>(<span class="string">"execution(public * *(..))"</span>)  <span class="comment">// anyPublicOperation matches if a method execution</span></span><br><span class="line">										<span class="comment">// join point represents the execution of any public method.</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">anyPublicOperation</span><span class="params">()</span> </span>&#123;&#125; </span><br><span class="line"></span><br><span class="line"><span class="meta">@Pointcut</span>(<span class="string">"within(com.xyz.someapp.trading..*)"</span>)  <span class="comment">// inTrading matches if a method execution is in the trading module.</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">inTrading</span><span class="params">()</span> </span>&#123;&#125; </span><br><span class="line"></span><br><span class="line"><span class="meta">@Pointcut</span>(<span class="string">"anyPublicOperation() &amp;&amp; inTrading()"</span>)  <span class="comment">// tradingOperation matches if a method execution</span></span><br><span class="line">												  <span class="comment">// represents any public method in the trading module.</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">tradingOperation</span><span class="params">()</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Examples-of-common-PCDs"><a href="#Examples-of-common-PCDs" class="headerlink" title="Examples of common PCDs"></a>Examples of common PCDs</h4><p>The following examples show some <strong>common pointcut expressions</strong>:</p>
<p>The execution of any public method (<strong>any return-type, any name, any number of arguments</strong>):</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution(<span class="keyword">public</span> * *(..))</span><br></pre></td></tr></table></figure>
<p>The execution of any <strong>method with a name that begins with <code>set</code></strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution(* set*(..))</span><br></pre></td></tr></table></figure>
<p>The execution of <strong>any method defined by the <code>AccountService</code> interface</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution(* com.xyz.service.AccountService.*(..))</span><br></pre></td></tr></table></figure>
<p>The execution of <strong>any method defined in the <code>service</code>package</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution(* com.xyz.service.*.*(..))  <span class="comment">// notice the extra "." needed connecting the package name and method name</span></span><br></pre></td></tr></table></figure>
<p>The execution of <strong>any method defined in the <code>service</code> package or one of its sub-packages</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution(* com.xyz.service..*.*(..))</span><br></pre></td></tr></table></figure>
<p><strong>Any join point</strong> (method execution <strong>only in Spring AOP</strong>, not all methods) <strong>within the service package</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">within(com.xyz.service.*)</span><br></pre></td></tr></table></figure>
<p><strong>Any join point</strong> (method execution <strong>only in Spring AOP</strong>) within the service package or one of its sub-packages:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">within(com.xyz.service..*)</span><br></pre></td></tr></table></figure>
<p>Any join point (<strong>method execution only in Spring AOP</strong>) where the <strong>proxy</strong> implements the AccountService interface:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">this(com.xyz.service.AccountService)</span><br></pre></td></tr></table></figure>
<p>Any join point (<strong>method execution only in Spring AOP</strong>) where the <strong>target object implements the <code>AccountService</code> interface</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">target(com.xyz.service.AccountService)</span><br></pre></td></tr></table></figure>
<p>Any join point (<strong>method execution only in Spring AOP</strong>) that <strong>takes a single parameter</strong> and where the <strong>argument</strong> passed at <strong>runtime is <code>Serializable</code></strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">args(java.io.Serializable)</span><br></pre></td></tr></table></figure>
<p>Any join point (<strong>method execution only in Spring AOP</strong>) where the <strong>target object has a <code>@Transactional</code> annotation</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@target</span>(org.springframework.transaction.annotation.Transactional)</span><br></pre></td></tr></table></figure>
<p>Any join point (<strong>method execution only in Spring AOP</strong>) where the <strong>declared type of the target object has an <code>@Transactional</code> annotation</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@within(org.springframework.transaction.annotation.Transactional)</span><br></pre></td></tr></table></figure>
<p>Any join point (<strong>method execution only in Spring AOP</strong>) where the <strong>executing method has an <code>@Transactional</code> annotation</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@annotation</span>(org.springframework.transaction.annotation.Transactional)</span><br></pre></td></tr></table></figure>
<p>Any join point (<strong>method execution only in Spring AOP</strong>) which takes a single parameter, and where the <strong>runtime type of the argument passed has the <code>@Classified</code> annotation:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@args(com.xyz.security.Classified)</span><br></pre></td></tr></table></figure>
<p>Any join point (method execution only in Spring AOP) on a Spring bean named tradeService:</p>
<pre><code>bean(tradeService)</code></pre><p>Any join point (method execution only in Spring AOP) on Spring beans having names that match the wildcard expression *Service:</p>
<pre><code>bean(*Service)</code></pre><h4 id="Structuring-your-Pointcuts"><a href="#Structuring-your-Pointcuts" class="headerlink" title="Structuring your Pointcuts"></a>Structuring your Pointcuts</h4><p>When working with enterprise applications, developers often want to refer to modules of the application and particular sets of operations from within several aspects. It is recommended to <strong>define a ‚Äú<code>SystemArchitecture</code>‚Äù aspect that captures common pointcut expressions</strong> for this purpose. Such an aspect typically resembles the following example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xyz.someapp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SystemArchitecture</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A join point is in the web layer if the method defined</span></span><br><span class="line"><span class="comment">     * is in the com.xyz.someapp.web package or any sub-package</span></span><br><span class="line"><span class="comment">     * under that.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"within(com.xyz.someapp.web..*)"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">inWebLayer</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A join point is in the service layer if the method defined</span></span><br><span class="line"><span class="comment">     * is in the com.xyz.someapp.service package or any sub-package</span></span><br><span class="line"><span class="comment">     * under that.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"within(com.xyz.someapp.service..*)"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">inServiceLayer</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A join point is in the data access layer if the method defined</span></span><br><span class="line"><span class="comment">     * is in the com.xyz.someapp.dao package or any sub-package</span></span><br><span class="line"><span class="comment">     * under that.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"within(com.xyz.someapp.dao..*)"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">inDataAccessLayer</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A business service is the execution of any method defined on a service</span></span><br><span class="line"><span class="comment">     * interface. This definition assumes that interfaces are placed in the</span></span><br><span class="line"><span class="comment">     * "service" package, and that implementation types are in sub-packages.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * If you group service interfaces by functional area (for example,</span></span><br><span class="line"><span class="comment">     * in packages com.xyz.someapp.abc.service and com.xyz.someapp.def.service) then</span></span><br><span class="line"><span class="comment">     * the pointcut expression "execution(* com.xyz.someapp..service.*.*(..))"</span></span><br><span class="line"><span class="comment">     * could be used instead.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Alternatively, you can write the expression using the 'bean'</span></span><br><span class="line"><span class="comment">     * PCD, like so "bean(*Service)". (This assumes that you have</span></span><br><span class="line"><span class="comment">     * named your Spring service beans in a consistent fashion.)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"execution(* com.xyz.someapp..service.*.*(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">businessService</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A data access operation is the execution of any method defined on a</span></span><br><span class="line"><span class="comment">     * dao interface. This definition assumes that interfaces are placed in the</span></span><br><span class="line"><span class="comment">     * "dao" package, and that implementation types are in sub-packages.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"execution(* com.xyz.someapp.dao.*.*(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dataAccessOperation</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Writing-good-Pointcuts"><a href="#Writing-good-Pointcuts" class="headerlink" title="Writing good Pointcuts"></a>Writing good Pointcuts</h4><p>During compilation, <strong>AspectJ processes pointcuts in order to optimize matching performance</strong>. Examining code and determining if each join point matches (statically or dynamically) a given pointcut is a <strong>costly process</strong>. (A dynamic match means the match cannot be fully determined from static analysis and that a test is placed in the code to determine if there is an actual match when the code is running). On first encountering a pointcut declaration, AspectJ <strong>rewrites it into an optimal form for the matching process</strong>. What does this mean? Basically, pointcuts are rewritten in DNF (Disjunctive Normal Form) and <strong>the components of the pointcut are sorted such that those components that are cheaper to evaluate are checked first</strong>. This means you <strong>do not have to worry about understanding the performance of various pointcut designators and may supply them in any order in a pointcut declaration</strong>.</p>
<p>However, AspectJ can work only with what it is told. For optimal performance of matching, you should think about <strong>what they are trying to achieve and narrow the search space for matches as much as possible in the definition</strong>. The existing designators naturally fall into one of three groups: kinded, scoping, and contextual:</p>
<ul>
<li><strong>Kinded designators</strong> select a particular kind of join point: execution, get, set, call, and handler.</li>
<li><strong>Scoping designators</strong> select a group of join points of interest (probably of many kinds): within and withincode</li>
<li><strong>Contextual designators</strong> match (and optionally bind) based on context: this, target, and @annotation</li>
</ul>
<p><strong>A well written pointcut should include at least the first two types (kinded and scoping)</strong>. You can include the contextual designators to match based on join point context or bind that context for use in the advice. Supplying only a kinded designator or only a contextual designator works but could affect weaving performance (time and memory used), due to extra processing and analysis.</p>
<h4 id="Declaring-an-Advice"><a href="#Declaring-an-Advice" class="headerlink" title="Declaring an Advice"></a>Declaring an Advice</h4><p>Advice is** associated with a pointcut expression and runs before, after, or around method executions matched by the pointcut**. The pointcut expression may be either a simple reference to a named pointcut or a pointcut expression declared in place.</p>
<p>In plain words, pointcuts matches the place/method execution, and the <strong>advice is the actual piece of code that will execute at that pointcut position (could be before (the method execution), after (the method execution), or around (the method execution))</strong>.</p>
<h5 id="Before"><a href="#Before" class="headerlink" title="Before"></a>Before</h5><p>You can declare <code>before</code> advice in an aspect by using the <code>@Before</code> annotation. This will then <strong>execute (if matched) before the execution of the matched method</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeforeExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"com.xyz.myapp.SystemArchitecture.dataAccessOperation()"</span>)  <span class="comment">// a better approach would be having a pointcut</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAccessCheck</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now, you could utilize the pointcutting scheme you learnt, which can be applied in two ways in an <code>Advice</code>:</p>
<ul>
<li>in-place pointcut expression</li>
<li>refering to the pointcut expression</li>
</ul>
<p>For example, the following two would be equivalent as the above:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeforeExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"execute(* com.xyz.myapp.SystemArchitecture.dataAccessOperation(**))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAccessCheck</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>or the recommended if suitable approach:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeforeExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Pointcut</span>(<span class="string">"execute(* com.xyz.myapp.SystemArchitecture.dataAccessOperation(**))"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">daoProcess</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"daoProcess()"</span>)  <span class="comment">// uses that Pointcut</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAccessCheck</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="After-Returning-Advice"><a href="#After-Returning-Advice" class="headerlink" title="After Returning Advice"></a>After Returning Advice</h5><p>After returning advice runs <strong>when a matched method execution returns normally</strong>. You can declare it by using the <code>@AfterReturning</code> annotation:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterReturning;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AfterReturningExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterReturning</span>(<span class="string">"com.xyz.myapp.SystemArchitecture.dataAccessOperation()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAccessCheck</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Note that y<strong>ou can have multiple advice declarations (and other members as well), all inside the same aspect</strong>. We show only a single advice declaration in these examples to focus the effect of each one.</p>
<p>One useful feature of After returning advice is that you can <strong>use the return value of that method to do some additional work</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterReturning;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AfterReturningExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterReturning</span>(</span><br><span class="line">        pointcut=<span class="string">"com.xyz.myapp.SystemArchitecture.dataAccessOperation()"</span>,</span><br><span class="line">        returning=<span class="string">"retVal"</span>)  <span class="comment">// this needs to be the same as the object in the argument below</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAccessCheck</span><span class="params">(Object retVal)</span> </span>&#123;  <span class="comment">// this matches the return object for all types</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The name used in the returning attribute must correspond to the name of a parameter in the advice method.** When a method execution returns, the return value is passed to the advice method as the corresponding argument value.** A returning clause also restricts matching to only those method executions that return a value of the specified type (in this case, Object, which matches any return value).</p>
<h5 id="After-Throwing-Advice"><a href="#After-Throwing-Advice" class="headerlink" title="After Throwing Advice"></a>After Throwing Advice</h5><p>After throwing advice runs <strong>when a matched method execution exits by throwing an exception</strong>. You can declare it by using the <code>@AfterThrowing</code> annotation, as the following example shows:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterThrowing;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AfterThrowingExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterThrowing</span>(<span class="string">"com.xyz.myapp.SystemArchitecture.dataAccessOperation()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doRecoveryActions</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Often, you want the advice to run <strong>only when exceptions of a given type are thrown</strong>, and you also often <strong>need access to the thrown exception in the advice body</strong>. You can use the <code>throwing</code> attribute to both restrict matching (if desired‚Äâ‚Äî‚Äâuse Throwable as the exception type otherwise) and bind the thrown exception to an advice parameter. The following example shows how to do so:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterThrowing;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AfterThrowingExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterThrowing</span>(</span><br><span class="line">        pointcut=<span class="string">"com.xyz.myapp.SystemArchitecture.dataAccessOperation()"</span>,</span><br><span class="line">        throwing=<span class="string">"ex"</span>)  <span class="comment">// so that you can use that thrown exception</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doRecoveryActions</span><span class="params">(DataAccessException ex)</span> </span>&#123;  <span class="comment">// if the Exception ex is NOT of type DataAccessException,</span></span><br><span class="line">															 <span class="comment">// this will NOT run</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The name used in the throwing attribute must correspond to the name of a parameter in the advice method. When a method execution exits by throwing an exception, the exception is passed to the advice method as the corresponding argument value. <strong>A throwing clause also restricts matching to only those</strong> method executions that <strong>throw an exception of the specified type</strong> (<code>DataAccessException</code>, in this case).</p>
<h5 id="After-Finally-Advice"><a href="#After-Finally-Advice" class="headerlink" title="After (Finally) Advice"></a>After (Finally) Advice</h5><p>After (finally) advice runs when a matched method execution exits. It is declared by using the <code>@After</code>annotation. After advice must be prepared to handle <strong>both normal and exception return conditions</strong>. It is typically used for releasing resources and similar purposes. The following example shows how to use after finally advice:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.After;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AfterFinallyExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span>(<span class="string">"com.xyz.myapp.SystemArchitecture.dataAccessOperation()"</span>)  <span class="comment">// runs no matter if the matched method</span></span><br><span class="line">																	  <span class="comment">// exits successfully or not</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doReleaseLock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Around-Advice"><a href="#Around-Advice" class="headerlink" title="Around Advice"></a>Around Advice</h5><p>The last kind of advice is around advice. Around advice runs ‚Äúaround‚Äù a matched method‚Äôs execution. It has the opportunity to <strong>do work both before and after the method executes</strong> and to determine <strong>when, how, and even if the method actually gets to execute at all (see the next paragraph).</strong> Around advice is often used if you need to share state before and after a method execution in a <strong>thread-safe manner</strong> (<strong>starting and stopping a timer, for example</strong>). Always use the least powerful form of advice that meets your requirements (that is, do not use around advice if before advice would do).</p>
<p>Around advice is declared by using the <code>@Around</code> annotation. <strong>The first parameter</strong> of the <strong>advice method must be of type ProceedingJoinPoint</strong>. Within the body of the advice, <strong>calling <code>proceed()</code> on the ProceedingJoinPoint causes the underlying method to execute</strong>. The <strong>proceed method can also pass in an Object[]</strong>. The <strong>values in the array are used as the arguments to the method execution when it proceeds</strong>.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Around;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AroundExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around</span>(<span class="string">"com.xyz.myapp.SystemArchitecture.businessService()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">doBasicProfiling</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="comment">// start stopwatch</span></span><br><span class="line">        Object retVal = pjp.proceed();</span><br><span class="line">        <span class="comment">// stop stopwatch</span></span><br><span class="line">        <span class="keyword">return</span> retVal;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Note that <code>proceed()</code> may be invoked once, many times, or not at all within the body of the around advice. All of these are legal.</p>
<p>Additionally, there are <strong>other methods of the <code>ProceedingJoinPoint</code> object that you can use to fetch information about the method that your are pointcutting</strong>:</p>
<ul>
<li><code>getArgs()</code>: Returns the method arguments.</li>
<li><code>getThis()</code>: Returns the proxy object.</li>
<li><code>getTarget()</code>: Returns the target object.</li>
<li><code>getSignature()</code>: Returns a description of the method that is being advised.</li>
<li><code>toString()</code>: Prints a useful description of the method being advised.</li>
</ul>
<h4 id="Passing-Parameters-to-Advice"><a href="#Passing-Parameters-to-Advice" class="headerlink" title="Passing Parameters to Advice"></a>Passing Parameters to Advice</h4><p>We have already seen how to bind the returned value or exception value (using after returning and after throwing advice). <strong>To make argument values available to the advice</strong> body, you can use the binding form of <code>args</code>. </p>
<p>If you use a parameter name in place of a type name in an args expression, the value of the corresponding argument is passed as the parameter value when the advice is invoked. An example should make this clearer. Suppose you want to advise the execution of <code>DAO</code> operations that <strong>take an <code>Account</code> object as the first parameter</strong>, and <strong>you need access to that <code>Account</code> object in the advice body</strong>. You could write the following:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before</span>(<span class="string">"com.xyz.myapp.SystemArchitecture.dataAccessOperation() &amp;&amp; args(account,..)"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">validateAccount</span><span class="params">(Account account)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The <code>args(account,..)</code> part of the pointcut expression serves two purposes. </p>
<ul>
<li>First, it <strong>restricts matching to only those method executions where the method takes at least one parameter</strong>, and the argument passed to that parameter is an instance of Account. </li>
<li>Second, it <strong>makes the actual <code>Account</code> object available to the advice</strong> through the account parameter.</li>
</ul>
<p>Another way of writing this is to <strong>declare a <code>Pointcut</code> that ‚Äúprovides‚Äù the <code>Account</code> object value when it matches a join point</strong>, and then refer to the named pointcut from the advice. This would look as follows:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut</span>(<span class="string">"com.xyz.myapp.SystemArchitecture.dataAccessOperation() &amp;&amp; args(account,..)"</span>)  <span class="comment">// Pointcutting</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">accountDataAccessOperation</span><span class="params">(Account account)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Before</span>(<span class="string">"accountDataAccessOperation(account)"</span>)  <span class="comment">// notice it is passed in here as well</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">validateAccount</span><span class="params">(Account account)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Using-Advice-Parameters-for-Generics"><a href="#Using-Advice-Parameters-for-Generics" class="headerlink" title="Using Advice Parameters for Generics"></a>Using Advice Parameters for Generics</h4><p>Spring AOP can handle generics used in class declarations and method parameters. Suppose you have a generic type like the following:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Sample</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sampleGenericMethod</span><span class="params">(T param)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sampleGenericCollectionMethod</span><span class="params">(Collection&lt;T&gt; param)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You can r<strong>estrict interception of method types to certain parameter types</strong> by typing the advice parameter to the parameter type for which you want to intercept the method:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before</span>(<span class="string">"execution(* ..Sample+.sampleGenericMethod(*)) &amp;&amp; args(param)"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeSampleMethod</span><span class="params">(MyType param)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Advice implementation</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Howver, this approach <strong>does not work for generic Collections</strong>. So you cannot define a pointcut as follows:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before</span>(<span class="string">"execution(* ..Sample+.sampleGenericCollectionMethod(*)) &amp;&amp; args(param)"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeSampleMethod</span><span class="params">(Collection&lt;MyType&gt; param)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Advice implementation</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To make this work, we would have to inspect every element of the collection, which is not reasonable, as we also cannot decide how to treat null values in general. To achieve something similar to this, you have to type the parameter to <code>Collection&lt;?&gt;</code> and manually check the type of the elements.</p>
<h4 id="Advice-Ordering"><a href="#Advice-Ordering" class="headerlink" title="Advice Ordering"></a>Advice Ordering</h4><p>The problem comes when you have multiple advice executing at the same join point. Suppose you have two advices running at the same join point,, what would happen?</p>
<ul>
<li>The *<em>highest precedence advice (<code>@Order(&lt;the smallest int&gt;)</code>) runs first ‚Äúon the way in‚Äù *</em>(so, given two pieces of before advice, the one with highest precedence runs first). </li>
<li><strong>‚ÄúOn the way out‚Äù from a join point, the highest precedence advice (<code>@Order(&lt;the smallest int&gt;)</code>) runs last</strong> (so, given two pieces of after advice, the one with the highest precedence will run second).</li>
</ul>
<p>Note that this means both (or more if you do have more) advices <strong>WILL execute</strong>, but the order of execution will be defined by the <code>@Order</code> annotation that you specify.</p>
<p>For example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AspectModule1</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"execution(* com.mySpringProject.app.testIoC.MethodInjectionSamples.*.get*(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPointCut</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Placed a Pointcut here"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"testPointCut()"</span>)</span><br><span class="line">	<span class="meta">@Order</span>(<span class="number">1</span>)  <span class="comment">// this will run first</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printMessage</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Pointcutted 1 Entering here"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"testPointCut()"</span>)</span><br><span class="line">	<span class="meta">@Order</span>(<span class="number">2</span>)  <span class="comment">// this runs second</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printMessage2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Pointcutted 2 Entering here"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@After</span>(<span class="string">"testPointCut()"</span>)</span><br><span class="line">	<span class="meta">@Order</span>(<span class="number">1</span>)  <span class="comment">// this will run last</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printMessage</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Pointcutted 1 Exiting here"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span>(<span class="string">"testPointCut()"</span>)</span><br><span class="line">	<span class="meta">@Order</span>(<span class="number">2</span>)  <span class="comment">// this runs second last</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printMessage2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Pointcutted 2 Exiting here"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> When two pieces of advice <strong>defined in different aspects both need to run at the same join point</strong>, unless you specify otherwise, the order of execution is undefined.</li>
</ul>
</blockquote>
<h4 id="Using-Introductions-DeclareParents"><a href="#Using-Introductions-DeclareParents" class="headerlink" title="Using Introductions/@DeclareParents"></a>Using Introductions/@DeclareParents</h4><p>Introductions (known as inter-type declarations in AspectJ) enable an aspect to declare that advised objects implement a given interface, and to provide an implementation of that interface on behalf of those objects.</p>
<p>You can make an introduction by using the <code>@DeclareParents</code> annotation. This annotation is used to <strong>declare that matching types have a new parent</strong> (hence the name). </p>
<p>For example, <strong>given an interface named <code>UsageTracked</code></strong> and an <strong>implementation of that interface named <code>DefaultUsageTracked</code></strong>, the following aspect declares that <strong>all implementors of service interfaces also implement the <code>UsageTracked</code> interface</strong>.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.DeclareParents;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AspectConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// this should make them all implement the Interface ProvidePrint, using implementations of DefaultPrint</span></span><br><span class="line">    <span class="meta">@DeclareParents</span>(value=<span class="string">"com.mySpringProject.app.testIoC.IntroductionsWithDeclareParents.*"</span>,</span><br><span class="line">        defaultImpl = DefaultPrint<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">static</span> <span class="title">ProvidePrint</span> <span class="title">testObj</span></span>; <span class="comment">// the Interface that matching classes will implement</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>with the simple interface <code>ProvidePrint</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mySpringProject.app.testIoC.IntroductionsWithDeclareParents;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ProvidePrint</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printIntroductionMessage</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now, suppose there is just one class inside that package:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mySpringProject.app.testIoC.IntroductionsWithDeclareParents;</span><br><span class="line"></span><br><span class="line"><span class="comment">// unaware of the interface ProvidePrint</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NormalObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> count;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NormalObject</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.count = count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCount</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.count = count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>and you have that <code>defaultImp = DefaultPrint.class</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mySpringProject.app.testIoC.IntroductionsWithDeclareParents;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultPrint</span> <span class="keyword">implements</span> <span class="title">ProvidePrint</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printIntroductionMessage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Default Implementations."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Then the result is that any <code>bean</code> created inside/being matched by the package <code>value=&quot;com.mySpringProject.app.testIoC.IntroductionsWithDeclareParents.*&quot;</code> <strong>will all automatically implement the necessary method <code>public void printIntroductionMessage()</code></strong>, with the <strong>actual implementation using the one from <code>defaultImpl = DefaultPrint.class</code></strong>.</p>
<p>So that when you create that <code>NormalObject</code> class using a bean, you can:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NormalObject testObj = ctx.getBean(NormalObject<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">System.out.println(<span class="string">"Count is: "</span>+testObj.getCount());  <span class="comment">// to test we get the correct object</span></span><br><span class="line">((ProvidePrint)testObj).printIntroductionMessage();  <span class="comment">// it will automatically implement the interface we specified</span></span><br></pre></td></tr></table></figure>

<p>However, what if the interface method <code>public void printIntroductionMessage();</code> has already been implemented by that <code>NormalObject</code> class? It turns out that the <strong>container will run the method native to that <code>NormalObject</code> class in the end</strong>. This means that the <strong>implementation in your <code>DefaultImplementation</code> class will only run if the method has not been implemented</strong>.</p>
<h4 id="Understanding-the-Mechanism-of-an-AOP-Proxy"><a href="#Understanding-the-Mechanism-of-an-AOP-Proxy" class="headerlink" title="Understanding the Mechanism of an AOP Proxy"></a>Understanding the Mechanism of an AOP Proxy</h4><p>Spring AOP is proxy-based. It is vitally important that you grasp the semantics of what that last statement actually means before you write your own aspects or use any of the Spring AOP-based aspects supplied with the Spring Framework.</p>
<p>Consider first the scenario where you have a plain-vanilla, un-proxied, nothing-special-about-it, straight object reference, as the following code snippet shows:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimplePojo</span> <span class="keyword">implements</span> <span class="title">Pojo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// this next method invocation is a direct call on the 'this' reference</span></span><br><span class="line">        <span class="keyword">this</span>.bar();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// some logic...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Now, when you use this class and call the method <code>foo()</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Pojo pojo = <span class="keyword">new</span> SimplePojo();</span><br><span class="line">        <span class="comment">// this is a direct method call on the 'pojo' reference</span></span><br><span class="line">        pojo.foo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This means that JVM first reaches that object <code>Pojo</code>, then looks for the <code>foo()</code> method, and finally executes and returns the result back if there is any <code>return</code> arguments.</p>
<p>However, <strong>things change slightly</strong> when the reference <strong>that client code has is a proxy</strong>. Consider the following diagram and code snippet:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ProxyFactory factory = <span class="keyword">new</span> ProxyFactory(<span class="keyword">new</span> SimplePojo());</span><br><span class="line">        factory.addInterface(Pojo<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        factory.addAdvice(<span class="keyword">new</span> RetryAdvice());</span><br><span class="line"></span><br><span class="line">        Pojo pojo = (Pojo) factory.getProxy();</span><br><span class="line">        <span class="comment">// this is a method call on the proxy!</span></span><br><span class="line">        pojo.foo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The key thing to understand here is that the client code inside the <code>main(..)</code> method of the Main class <strong>has a reference to the proxy</strong>, which contains an inner reference to the actual object you built. This means <strong>that method (<code>pojo.foo()</code>)</strong> calls on that object reference are <strong>calls on the proxy</strong>. Therefore, you can see it as the proxy having the full power to control the executions of that object you built.</p>
<p>As a result, the proxy can delegate to all of the interceptors (advice) that are relevant to that particular method call. <strong>However, once the call has finally reached the target object (the SimplePojo, reference in this case)</strong>, any method calls that it may make on itself, such as <code>this.bar()</code> or <code>this.foo()</code>, are going to be <strong>invoked against the actual object/<code>SimplePojo</code> reference, and not the proxy</strong>. </p>
<p>This has important implications. It means that self-invocation is not going to result in the advice associated with a method invocation getting a chance to execute.</p>
<p>Okay, so what is to be done about this? The best approach (the term, ‚Äúbest,‚Äù is used loosely here) is to refactor your code such that the self-invocation does not happen. This does entail some work on your part, but it is the best, least-invasive approach. The next approach is absolutely horrendous, and we hesitate to point it out, precisely because it is so horrendous. You can (painful as it is to us) totally tie the logic within your class to Spring AOP, as the following example shows:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimplePojo</span> <span class="keyword">implements</span> <span class="title">Pojo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// this works, but... gah!</span></span><br><span class="line">        ((Pojo) AopContext.currentProxy()).bar();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// some logic...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>This totally couples your code to Spring AOP, and it makes the class itself aware of the fact that it is being used in an AOP context</strong>, which flies in the face of AOP. It also requires some additional configuration when the proxy is being created, as the following example shows:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ProxyFactory factory = <span class="keyword">new</span> ProxyFactory(<span class="keyword">new</span> SimplePojo());</span><br><span class="line">        factory.addInterface(Pojo<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        factory.addAdvice(<span class="keyword">new</span> RetryAdvice());</span><br><span class="line">        factory.setExposeProxy(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">        Pojo pojo = (Pojo) factory.getProxy();</span><br><span class="line">        <span class="comment">// this is a method call on the proxy!</span></span><br><span class="line">        pojo.foo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Finally, it must be noted that <strong>AspectJ does not have this self-invocation issue because it is not a proxy-based AOP framework</strong>. (However, since this guide do uses the <code>AOP framework</code>, this is relevant.)</p>
<h4 id="Manually-Creating-AspectJ-Proxies"><a href="#Manually-Creating-AspectJ-Proxies" class="headerlink" title="Manually Creating @AspectJ Proxies"></a>Manually Creating <code>@AspectJ</code> Proxies</h4><p>If you used <code>@EnableAspectJAutoProxy</code>, then this will not be necessary (also, as I tested in my program, <strong>once this is declared (at any place)</strong>, <strong>the auto proxy mechanism will be enabled everywhere</strong> in the same project). However, if you want to have full control of what is happening under the hood, you can choose to manually create/add proxies to your POJOs.</p>
<p>You can use the <code>org.springframework.aop.aspectj.annotation.AspectJProxyFactory</code> class to <strong>create a proxy for a target object that is advised by one or more <code>@AspectJ</code> aspects</strong>. The basic usage for this class is very simple, as the following example shows:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create a factory that can generate a proxy for the given target object</span></span><br><span class="line">AspectJProxyFactory factory = <span class="keyword">new</span> AspectJProxyFactory(targetObject);</span><br><span class="line"></span><br><span class="line"><span class="comment">// add an aspect, the class must be an @AspectJ aspect</span></span><br><span class="line"><span class="comment">// you can call this as many times as you need with different aspects</span></span><br><span class="line">factory.addAspect(SecurityManager<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// you can also add existing aspect instances, the type of the object supplied must be an @AspectJ aspect</span></span><br><span class="line">factory.addAspect(usageTracker);</span><br><span class="line"></span><br><span class="line"><span class="comment">// now get the proxy object...</span></span><br><span class="line">MyInterfaceType proxy = factory.getProxy();</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/06/09/Spring-Framework-Guide/" data-id="ckb7qqory0001xworgz0y9qwv" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-SpringBoot-Manual" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/06/09/SpringBoot-Manual/" class="article-date">
  <time datetime="2020-06-09T03:35:00.000Z" itemprop="datePublished">2020-06-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/06/09/SpringBoot-Manual/">Spring Boot Manual</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<p><strong>IMPORTANT</strong>:<br>Much of the content here is a personal summary/abbrieviation of contents on the <a href="https://docs.spring.io/spring-boot/docs/2.3.0.RELEASE/reference/html/" target="_blank" rel="noopener">Offical Spring Boot Documentation</a>. For more complete information, please refer to the offical site.</p>
<hr>
<h2 id="Spring-Boot-Installation"><a href="#Spring-Boot-Installation" class="headerlink" title="Spring Boot Installation"></a>Spring Boot Installation</h2><p>For instructions on installing and a quick overview of using Spring Boot, please refer to this <a href="https://docs.spring.io/spring-boot/docs/2.3.0.RELEASE/reference/html/getting-started.html#getting-started-installing-spring-boot" target="_blank" rel="noopener">page</a></p>
<h2 id="Structuring-Your-Code"><a href="#Structuring-Your-Code" class="headerlink" title="Structuring Your Code"></a>Structuring Your Code</h2><p>Technically, Spring Boot does not require any specific code layout to work. However, there are <strong>some best practices that help:</strong></p>
<ul>
<li><p>Your <code>main application</code> class:</p>
<ul>
<li><p>It is generally recommend that you locate <strong>your <code>main application</code> class in a root package above other<br>classes.</strong> The <code>@SpringBootApplication</code> annotation is often placed on your main class, and it implicitly<br>defines a base ‚Äúsearch package‚Äù for certain items</p>
</li>
<li><p>For example, the follwoing structure:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">com</span><br><span class="line">+- example</span><br><span class="line">	+- myapplication</span><br><span class="line">		+- Application.java</span><br><span class="line">		|</span><br><span class="line">		+- customer</span><br><span class="line">		|   +- Customer.java</span><br><span class="line">		|   +- CustomerController.java</span><br><span class="line">		|   +- CustomerService.java</span><br><span class="line">		|   +- CustomerRepository.java</span><br><span class="line">		|</span><br><span class="line">		+- order</span><br><span class="line">			+- Order.java</span><br><span class="line">			+- OrderController.java</span><br><span class="line">			+- OrderService.java</span><br><span class="line">			+- OrderRepository.java</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>Your primary <code>configuration</code> class</p>
<ul>
<li>Although it is possible to use <code>SpringApplication</code> with <code>XML</code> sources, we generally recommend that <strong>your primary source be a single <code>@Configuration</code> class</strong>. Usually the <strong>class that defines the main method is a good candidate as the primary <code>@Configuration</code></strong>.</li>
<li>You can also <strong>import configuration classes</strong>:<ul>
<li>The <strong><code>@Import</code> annotation can be used to import additional configuration classes</strong>. Alternatively, you can <strong>use <code>@ComponentScan</code> to automatically pick up all Spring components</strong>, including <code>@Configuration</code> classes.</li>
</ul>
</li>
<li><strong>Import XML Configuration</strong><ul>
<li>If you need to use an XML based configuration, we recommend that you <strong>still start with a <code>@Configuration</code> class</strong>. You can <strong>then use an <code>@ImportResource</code> annotation</strong> to load XML configuration files.</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> A single <code>@SpringBootApplication</code> annotation can be <strong>used to enable three features</strong>, that is:<ul>
<li><code>@EnableAutoConfiguration</code>: enable Spring Boot‚Äôs auto-configuration mechanism</li>
<li><code>@ComponentScan</code>: enable @Component scan on the package where the application is located (see the best practices)</li>
<li><code>@Configuration</code>: allow to register extra beans in the context or import additional configuration classes<br>SO, the <code>@SpringBootApplication</code> annotation is <strong>equivalent to using <code>@Configuration</code>, <code>@EnableAutoConfiguration</code>, and <code>@ComponentScan</code> with their default attributes</strong>, as shown in the following example:</li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.myapplication;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span> <span class="comment">// same as @Configuration @EnableAutoConfiguration @ComponentScan</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(Application<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Auto-Configuration"><a href="#Auto-Configuration" class="headerlink" title="Auto-Configuration"></a>Auto-Configuration</h3><p>(additional reference: <a href="https://www.javatpoint.com/spring-boot-auto-configuration" target="_blank" rel="noopener">https://www.javatpoint.com/spring-boot-auto-configuration</a>)</p>
<p>You can also choose to use the Spring Boot <code>auto-configuration</code>, which attempts to automatically configure your Spring application based on the jar dependencies that you have added.</p>
<p>For example, if the H2 database Jar is <strong>present in the classpath and we have not configured any beans</strong> related to the database manually, the Spring Boot‚Äôs auto-configuration feature automatically configures it in the project.</p>
<p>To enable <code>auto-configuration</code>, you need to <strong>add either <code>@EnableAutoConfiguration</code> or <code>@SpringBootApplication</code> annotations to one of your <code>@Configuration</code> classes</strong>.</p>
<p>However, if you find that specific auto-configuration classes that you do not want are being applied, you can also specify to disable <strong>disable the specific auto-configuration classes</strong>. We <strong>use the <code>exclude</code> attribute of the annotation <code>@EnableAutoConfiguration</code></strong> to disable the auto-configuration classes. For example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.*;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.jdbc.*;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span>(proxyBeanMethods = <span class="keyword">false</span>)  </span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span>(exclude=&#123;DataSourceAutoConfiguration<span class="class">.<span class="keyword">class</span>&#125;)  </span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">MyConfiguration</span></span>&#123;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We can <strong>use the attribute <code>excludeName</code></strong> of the annotation <code>@EnableAutoConfiguration</code> and specify the qualified name of the class, <strong>if the class is not on the class path</strong>. We can exclude any number of auto-configuration classes by using the property <code>spring.autoconfigure.exclude</code>.</p>
<p>This is also supported if you use the <code>@SpringBootApplication</code> annotation:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.jdbc.*;</span><br><span class="line"><span class="meta">@SpringBootApplication</span>(exclude=&#123;DataSourceAutoConfiguration<span class="class">.<span class="keyword">class</span>&#125;)  // <span class="title">also</span> <span class="title">supported</span></span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">MyApplication</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Spring-Beans-and-Dependency-Injection-in-Spring-Boot"><a href="#Spring-Beans-and-Dependency-Injection-in-Spring-Boot" class="headerlink" title="Spring Beans and Dependency Injection in Spring Boot"></a>Spring Beans and Dependency Injection in Spring Boot</h3><p>You are free to use any of the standard <strong>Spring Framework techniques</strong> to define your beans and their injected dependencies. For simplicity, we often find that <strong>using <code>@ComponentScan</code> (to find your beans) and using <code>@Autowired</code> (to do constructor injection) works well</strong>. If you structure your code as suggested above <strong>(locating your application class in a root package), you can add <code>@ComponentScan</code> without any arguments, as it will automatically scan all component classes in current package and all its subpackages</strong>. All of your application components (<code>@Component</code>, <code>@Service</code>, <code>@Repository</code>, <code>@Controller</code> etc.) are automatically registered as Spring Beans.</p>
<p>For example, if you have in your sub-package a <code>@Service</code> as shown below, it will be automatically included in the configuration:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DatabaseAccountService</span> <span class="keyword">implements</span> <span class="title">AccountService</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> RiskAssessor riskAssessor;  <span class="comment">// Notice this will be final</span></span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">DatabaseAccountService</span><span class="params">(RiskAssessor riskAssessor)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.riskAssessor = riskAssessor;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Notice how <strong>using constructor injection lets the <code>riskAssessor</code> field be marked as <code>final</code></strong>, indicating that the reference to that <code>riskAssessor</code> object cannot be subsequently changed (mutator methods of that object can still be used, of course).</p>
<h2 id="Running-Your-Application"><a href="#Running-Your-Application" class="headerlink" title="Running Your Application"></a>Running Your Application</h2><p>One of the biggest advantages of packaging your application as a jar and using an embedded HTTP server is that you can run your application as you would any other. Debugging Spring Boot applications is also easy. You do not need any special IDE plugins or extensions.</p>
<p>If you use the Spring Boot Maven or Gradle plugins to create an executable <code>jar</code>, you can <strong>run your application using <code>java -jar</code></strong>, as shown in the following example: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar target&#x2F;myapplication-0.0.1-SNAPSHOT.jar</span><br></pre></td></tr></table></figure>

<p>It is also possible to run a packaged application with remote debugging support enabled. Doing so lets you attach a debugger to your packaged application, as shown in the following example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ java -Xdebug -Xrunjdwp:server&#x3D;y,transport&#x3D;dt_socket,address&#x3D;8000,suspend&#x3D;n \</span><br><span class="line">-jar target&#x2F;myapplication-0.0.1-SNAPSHOT.jar</span><br></pre></td></tr></table></figure>

<h3 id="Compiling-and-Running-using-Maven-Plugin"><a href="#Compiling-and-Running-using-Maven-Plugin" class="headerlink" title="Compiling and Running using Maven Plugin"></a>Compiling and Running using Maven Plugin</h3><p>The Spring Boot Maven plugin includes a <code>run</code> goal that can be used to quickly compile and run your application. Applications run in an exploded form, as they do in your IDE. The following example shows a typical Maven command to run a Spring Boot application:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mvn spring-boot:run</span><br></pre></td></tr></table></figure>

<p>You might also want to use the <code>MAVEN_OPTS</code> operating system environment variable, as shown in the following example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ export MAVEN_OPTS&#x3D;-Xmx1024m</span><br></pre></td></tr></table></figure>

<p>where:</p>
<ul>
<li><code>-Xmx1024m</code> specifies the maximum size, in bytes, of the memory allocation pool. This value must <strong>a multiple of 1024 greater than 2 MB</strong>. Append the letter <code>k</code> or <code>K</code> to indicate kilobytes, or <code>m</code> or <code>M</code> to indicate megabytes. The default value is chosen at runtime based on system configuration.</li>
</ul>
<h2 id="Developer-Tools"><a href="#Developer-Tools" class="headerlink" title="Developer Tools"></a>Developer Tools</h2><p>Spring Boot includes an additional set of tools that can make the application development experience a little more pleasant. The <code>spring-boot-devtools module</code> can be included in any project to <strong>provide additional development-time features</strong>.</p>
<p>For example, if you have worked on latest UI development frameworks e.g. <code>Node</code>, <code>angular</code>, <code>gulp</code> etc. then you must have appreciated the <strong>auto-reload of UI in browser</strong> whenever there is <strong>change in some code</strong>. Its pretty useful and saves a lot of time.</p>
<p>Well, <strong>same feature can be utilized in spring boot applications using <code>spring-boot-devtools</code> dependency provided features</strong>.</p>
<h3 id="Enabling-spring-boot-devtools"><a href="#Enabling-spring-boot-devtools" class="headerlink" title="Enabling spring-boot-devtools"></a>Enabling <code>spring-boot-devtools</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">	&lt;dependency&gt;</span><br><span class="line">		&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">		&lt;artifactId&gt;spring-boot-devtools&lt;&#x2F;artifactId&gt;</span><br><span class="line">		&lt;optional&gt;true&lt;&#x2F;optional&gt;</span><br><span class="line">	&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;&#x2F;dependencies&gt;</span><br></pre></td></tr></table></figure>

<p>where we flagged the dependency as <code>optional</code> because:</p>
<ul>
<li>Flagging the <strong>dependency as <code>optional</code> in maven</strong> (as shown above) <strong>prevents devtools from being transitively applied to other modules</strong> that use your project.</li>
</ul>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> <strong>Developer tools are automatically disabled when running a fully packaged application</strong>. If your application is launched from <code>java -jar</code> or if it is started from a special classloader, then it is considered a ‚Äúproduction application‚Äù. If that does not apply to you (i.e. if you run your application from a container), consider excluding devtools or set the <code>-Dspring.devtools.restart.enabled=false</code> system property.</li>
</ul>
</blockquote>
<h3 id="Configuring-your-spring-boot-devtools"><a href="#Configuring-your-spring-boot-devtools" class="headerlink" title="Configuring your spring-boot-devtools"></a>Configuring your <code>spring-boot-devtools</code></h3><p>(additional reference: <a href="https://howtodoinjava.com/spring-boot2/developer-tools-module-tutorial/#:~:text=The%20spring%2Dboot%2Ddevtools%20module,default%2C%20live%20reload%20is%20enabled" target="_blank" rel="noopener">https://howtodoinjava.com/spring-boot2/developer-tools-module-tutorial/#:~:text=The%20spring%2Dboot%2Ddevtools%20module,default%2C%20live%20reload%20is%20enabled</a>)</p>
<p>To improve the performance, <strong>dev tools cache the static content/template files to serve them faster to browser/client</strong>. This is <strong>very good feature in production</strong> where every milli-second performance improvement matters. But <strong>in development environment, it can be a problem and cause stale cache problem</strong> and you may not see your changes immediatly in browser. For this reason, <code>springboot-devtools</code> <strong>disables the caching options by default</strong>.</p>
<p>Also, because you need more information about web requests while developing Spring MVC and Spring WebFlux applications, <strong>developer tools will enable <code>DEBUG</code> logging for the web logging group</strong>. This will give you <strong>information about the incoming request, which handler is processing it, the response outcome, etc</strong>.</p>
<p>More importantly, you can also <strong>configure the <code>springboot-devtools</code> to meet your own needs</strong>:</p>
<ol>
<li><p>You can enable the static caching to use in production environment by setting a property:</p>
 <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># inside application.properties</span></span><br><span class="line"><span class="meta">spring.freemarker.cache</span> = <span class="string">true 	# false by default in production environment</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Other such properties</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># spring.thymeleaf.cache = false</span></span><br><span class="line"><span class="comment"># spring.mustache.cache = false</span></span><br><span class="line"><span class="comment"># spring.groovy.template.cache = false</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>If you wish to log all request details (including potentially sensitive information), you can turn on the <code>spring.mvc.log-request-details</code> or <code>spring.codec.log-request-details</code> configuration properties.</p>
 <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># inside application.properties</span></span><br><span class="line"><span class="meta">spring.mvn.log-request-details</span> = <span class="string">true 	# or spring.codec.log-request-details = true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>The <code>spring-boot-devtools</code> module <strong>includes an embedded LiveReload server that can be used to trigger a browser refresh when a resource is changed</strong>. Precondition is that your browser should have supported extention for it. You can find such browser extentions in this <a href="https://livereload.com/extensions/" target="_blank" rel="noopener">link</a>.</p>
<p> <strong>By default, live reload is enabled</strong>. If you wish to disable this feature for some reason, then set <code>sping.devtools.livereload.enabled</code> property to <code>false</code>.</p>
 <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#inside application.properties</span></span><br><span class="line"><span class="meta">spring.devtools.livereload.enabled</span>  = <span class="string">false 	# Set false to disable live reload</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>For a complete list of the properties that are applied by the devtools, see <a href="https://github.com/spring-projects/spring-boot/tree/v2.3.0.RELEASE/spring-boot-project/spring-boot-devtools/src/main/java/org/springframework/boot/devtools/env/DevToolsPropertyDefaultsPostProcessor.java" target="_blank" rel="noopener">DevToolsPropertyDefaultsPostProcessor</a>.</p>
</li>
</ol>
<h3 id="Automatic-Reload"><a href="#Automatic-Reload" class="headerlink" title="Automatic Reload"></a>Automatic Reload</h3><p>The automatic reload has been introduced in the section above, which triggers a browser refresh when a resource is changed. By default, it is triggered on these paths:</p>
<ul>
<li><code>/META-INF/maven</code></li>
<li><code>/META-INF/resources</code></li>
<li><code>/resources</code></li>
<li><code>/static</code></li>
<li><code>/public</code></li>
<li><code>/templates</code></li>
</ul>
<p>If you want to <strong>disable auto-reload in browser for files in few of these paths</strong>, then use <code>spring.devtools.restart.exclude property</code>. For example:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.devtools.restart.exclude</span>=<span class="string">static/**,public/**</span></span><br></pre></td></tr></table></figure>

<p>If you want to <strong>watch those addtional files/paths not in the default list</strong> to reload the application, use the <code>spring.devtools.restart.additional-paths</code> property.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.devtools.restart.additional-paths&#x3D;script&#x2F;**</span><br></pre></td></tr></table></figure>

<p>Similarily, If you want to <strong>exclude those additional paths</strong>, use the <code>spring.devtools.restart.additional-exclude property</code>.</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.devtools.restart.additional-exclude</span>=<span class="string">styles/**</span></span><br></pre></td></tr></table></figure>

<h3 id="Automatic-Restart"><a href="#Automatic-Restart" class="headerlink" title="Automatic Restart"></a>Automatic Restart</h3><p>Auto-restart means <strong>reloading the java classes and consiguration at server side</strong>. After the server side changes are re-deployed dynamically, server restart happen and load the modified code and configutation.</p>
<p>This can be a useful feature when working in an IDE, as it gives a very fast feedback loop for code changes. By default, <strong>any entry on the classpath that points to a directory is monitored for changes</strong>. Note that certain resources, such as <strong>static assets and view templates, do not need to restart the application (these would be more appropriate for auto-reload)</strong>.</p>
<p>As DevTools monitors classpath resources, the <strong>only way to trigger a restart is to update the classpath</strong>. The way in which you cause the classpath to be updated depends on the IDE that you are using. In Eclipse, saving a modified file causes the classpath to be updated and triggers a restart. <strong>In IntelliJ IDEA, building the project (Build ‚Üí Build Project) triggers the restart</strong>.</p>
<p>In general, <strong>automatic restart works very well when used with LiveReload</strong>. See the <a href="#LiveReload">LiveReload</a> section for details. If you use JRebel, automatic restarts are disabled in favor of dynamic class reloading. Other devtools features (such as LiveReload and property overrides) can still be used.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> DevTools relies on the application context‚Äôs shutdown hook to close it during a restart. It does not work correctly if you have disabled the shutdown hook (<code>SpringApplication.setRegisterShutdownHook(false)</code>).</li>
</ul>
</blockquote>
<p><strong>To enable/disable automatic restart</strong>, you could use the property <code>spring.devtools.restart.enabled</code>:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># inside application.properties</span><br><span class="line">spring.devtools.restart.enabled = false 	# disables restart. Set to true to enable it</span><br></pre></td></tr></table></figure>

<p><strong>To enable/disable logging of auto-configuration changes</strong>, you need to use <code>pring.devtools.restart.log-condition-evaluation-delta</code>. <strong>By default, each time your application restarts, a report showing the condition evaluation delta is logged</strong>. The report shows the changes to your application‚Äôs auto-configuration as you make changes such as adding or removing beans and setting configuration properties.</p>
<p>To disable the logging of the report, set the following property:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># inside application.properties</span><br><span class="line">spring.devtools.restart.log-condition-evaluation-delta = false 		# set to true to enable it</span><br></pre></td></tr></table></figure>

<p>Doing so still <strong>initializes the restart classloader</strong>, but it does not watch for file changes.</p>
<p>If you need to <strong>completely disable restart support</strong> (for example, because it does not work with a specific library), you need to set the <strong><code>spring.devtools.restart.enabled</code> System property to <code>false</code> before calling <code>SpringApplication.run(‚Ä¶)</code></strong>, as shown in the following example: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">	System.setProperty(<span class="string">"spring.devtools.restart.enabled"</span>, <span class="string">"false"</span>);</span><br><span class="line">	SpringApplication.run(MyApp<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>To trigger a restart with a Trigger File</strong>, you need to set the property <code>spring.devtools.restart.trigger-file</code>. This is useful if automatic restarts may not be desirable on every file change and sometimes can slower down development time due to frequent restarts. To solve this problem, you can use a trigger file. <strong>Spring boot will keep monitoring that file and once it will detect any modification in that file, it will restart the server and reload all your previous changes</strong>.</p>
<p>To use a trigger file, <strong>set the <code>spring.devtools.restart.trigger-file</code> property to the name (excluding<br>any path) of your trigger file</strong>. The trigger file <strong>must appear somewhere on your classpath</strong>.</p>
<p>For example, if you have a project with the following structure:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">src</span><br><span class="line">+- main</span><br><span class="line">	+- resources</span><br><span class="line">		+- .reloadtrigger</span><br></pre></td></tr></table></figure>

<p>Then your trigger-file property would be:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.devtools.restart.trigger-file=.reloadtrigger</span><br></pre></td></tr></table></figure>

<p>Restarts <strong>will now only happen when the <code>src/main/resources/.reloadtrigger</code> is updated</strong>.</p>
<p>Some IDEs have features that save you from needing to update your trigger file manually. For IntelliJ, you can follow the instructions in <a href="https://www.jetbrains.com/help/idea/spring-boot.html#configure-application-update-policies-with-devtools" target="_blank" rel="noopener">their documentation</a>.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> You might want to <strong>set <code>spring.devtools.restart.trigger-file</code> as a global setting (adding a <code>spring-boot-devtools.properties</code> file to <code>$HOME/.config/spring-boot</code> directory, for example)</strong>, so that all your projects behave in the same way.</li>
</ul>
</blockquote>
<h3 id="Auto-Reload-vs-Auto-Restart"><a href="#Auto-Reload-vs-Auto-Restart" class="headerlink" title="Auto-Reload vs Auto-Restart"></a>Auto-Reload vs Auto-Restart</h3><p><strong>Auto-reload</strong> (or auto-refresh) refer to <strong>UI reload at browser to see static content changes</strong>. <strong>Auto-restart</strong> is referred to <strong>reloading the server side code and configurations</strong> followed by server restart.</p>
<p>The <strong>restart technology provided by Spring Boot works by using two classloaders</strong>. Classes that do not change (for example, those from third-party jars) are loaded into a base classloader. Classes that you are actively developing are loaded into a restart classloader. When the application is restarted, <strong>the restart classloader is thrown away and a new one is created</strong>. This approach means that application <strong>restarts are typically much faster than ‚Äúcold starts‚Äù</strong>, since the base classloader is already available and populated.</p>
<p>If you find that** restarts are not quick enough for your applications or you encounter classloading issues<strong>, you **could consider reloading</strong> technologies such as JRebel from ZeroTurnaround. These work by rewriting classes as they are loaded to make them more amenable to reloading.</p>
<h3 id="Customizing-the-Restart-Classloader"><a href="#Customizing-the-Restart-Classloader" class="headerlink" title="Customizing the Restart Classloader"></a>Customizing the Restart Classloader</h3><p><strong>By default</strong>, any <strong>open project in your IDE is loaded with the ‚Äúrestart‚Äù classloader</strong>, and <strong>any regular <code>.jar</code> file is loaded with the ‚Äúbase‚Äù classloader</strong>. If you work on a multi-module project, and not every module is imported into your IDE, you may need to customize things. To do so, you can create a <code>META-INF/spring-devtools.properties</code> file.</p>
<p>The <code>spring-devtools.properties</code> file can contain properties prefixed with <code>restart.exclude</code> and <code>restart.include</code>. <strong>The <code>include</code> elements</strong> are items that should be** pulled up into the ‚Äúrestart‚Äù classloader<strong>, and the **<code>exclude</code> elements</strong> are items that should be <strong>pushed down into the ‚Äúbase‚Äù classloader</strong>. The <strong>value of the property is a regex pattern that is applied to the classpath, as shown in the following example:</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">restart.exclude.companycommonlibs=/mycorp-common-[\\w\\d-\.]+\.jar</span><br><span class="line">restart.include.projectcommon=/mycorp-myproj-[\\w\\d-\.]+\.jar</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Restart functionality <strong>does not work well with objects that are deserialized</strong> by using a standard <code>ObjectInputStream</code>. If you need to deserialize data, you may need to use Spring‚Äôs <code>ConfigurableObjectInputStream</code> in combination with <code>Thread.currentThread().getContextClassLoader()</code>.</li>
</ul>
</blockquote>
<p><a name="LiveReload"></a></p>
<h3 id="LiveReload"><a href="#LiveReload" class="headerlink" title="LiveReload"></a>LiveReload</h3><p>The <strong><code>spring-boot-devtools</code> module includes an embedded LiveReload server that can be used to trigger a browser refresh when a resource is changed</strong>. LiveReload browser extensions are freely available for Chrome, Firefox and Safari from livereload.com.</p>
<p>If you do not want to start the LiveReload server when your application runs, you can set the<br><code>spring.devtools.livereload.enabled</code> property to <code>false</code>.</p>
<p>However, note that <strong>you can only run one LiveReload server at a time</strong>. Before starting your application, ensure that no other LiveReload servers are running. If you start multiple applications from your IDE, only the first has LiveReload support.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> <strong>In Intellij</strong>, you might need to configure some settings to make this feature available. For more details, please follow the link: <a href="https://mkyong.com/spring-boot/intellij-idea-spring-boot-template-reload-is-not-working/" target="_blank" rel="noopener">https://mkyong.com/spring-boot/intellij-idea-spring-boot-template-reload-is-not-working/</a></li>
</ul>
</blockquote>
<h3 id="Configure-your-File-System-Watcher"><a href="#Configure-your-File-System-Watcher" class="headerlink" title="Configure your File System Watcher"></a>Configure your File System Watcher</h3><p>If you find that there are times when certain <strong>changes are not reflected</strong> when devtools restarts the application, you might need to configure your File System Watcher.</p>
<p>FileSystemWatcher works by polling the class changes with a certain time interval, and then waiting for a predefined quiet period to make sure there are no more changes. So if you find that certain changes are not     reflected, try increasing the <code>spring.devtools.restart.poll-interval</code> and <code>spring.devtools.restart.quiet-period</code> parameters to the values that fit your development environment:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.devtools.restart.poll-interval=2s</span><br><span class="line">spring.devtools.restart.quiet-period=1s</span><br></pre></td></tr></table></figure>

<p>The monitored classpath directories are now <strong>polled every 2 seconds for changes</strong>, and a <strong>1 second quiet period is maintained</strong> to make sure there are no additional class changes.</p>
<h3 id="Global-Settings-File"><a href="#Global-Settings-File" class="headerlink" title="Global Settings File"></a>Global Settings File</h3><p>You can configure <strong>global devtools settings</strong> by adding any of the following files to the <code>$HOME/.config/spring-boot directory</code>:</p>
<ol>
<li>spring-boot-devtools.properties</li>
<li>spring-boot-devtools.yaml</li>
<li>spring-boot-devtools.yml</li>
</ol>
<p>Any <strong>properties added to these file apply to all Spring Boot applications on your machine that use devtools.</strong> For example, to configure restart to always use a trigger file, you would add the following property:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># inside ~/.config/spring-boot/spring-boot-devtools.properties </span><br><span class="line">spring.devtools.restart.trigger-file=.reloadtrigger</span><br></pre></td></tr></table></figure>

<h3 id="Remote-Applications"><a href="#Remote-Applications" class="headerlink" title="Remote Applications"></a>Remote Applications</h3><p>The Spring Boot developer tools are not limited to local development. You can also use several features when running applications remotely. Remote support is opt-in as enabling it can be a security risk. It should only be enabled when running on a trusted network or when secured with SSL.</p>
<p>To enable it, you need to make sure that <code>devtools</code> is included in the repackaged archive, as shown in<br>the following listing:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">	&lt;plugins&gt;</span><br><span class="line">		&lt;plugin&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-maven-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">			&lt;configuration&gt;</span><br><span class="line">				&lt;excludeDevtools&gt;false&lt;&#x2F;excludeDevtools&gt;</span><br><span class="line">			&lt;&#x2F;configuration&gt;</span><br><span class="line">		&lt;&#x2F;plugin&gt;</span><br><span class="line">	&lt;&#x2F;plugins&gt;</span><br><span class="line">&lt;&#x2F;build&gt;</span><br></pre></td></tr></table></figure>
<p>Then you need to set the <code>spring.devtools.remote.secret</code> property. Like any important password or secret, the value <strong>should be unique and strong such that it cannot be guessed or brute-forced</strong>.</p>
<p>Then, to run the remote application within your IDE, you need to run <code>org.springframework.boot.devtools.RemoteSpringApplication</code> with the <strong>same classpath as the remote project that you connect to</strong>. The application‚Äôs single <strong>required argument is the remote URL</strong> to which it connects.</p>
<p>For example, if you are using Eclipse or STS and you have a project named <code>my-app</code> that you have deployed to Cloud Foundry, you would do the following:</p>
<ul>
<li>Select <code>Run Configurations‚Ä¶</code> from the Run menu.</li>
<li>Create a new <code>Java Application</code> ‚Äúlaunch configuration‚Äù.</li>
<li>Browse for the <code>my-app</code> project.</li>
<li>Use <code>org.springframework.boot.devtools.RemoteSpringApplication</code> as the main class.</li>
<li>Add <code>https://myapp.cfapps.io</code> to the Program arguments (or whatever your remote URL is).</li>
</ul>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Because the <strong>remote client is using the same classpath as the real application it can directly read application properties</strong>. This is how the** <code>spring.devtools.remote.secret</code> property is read and passed to the server for authentication**.</li>
<li><input disabled type="checkbox"> It is always advisable to use <code>https://</code> as the connection protocol, so that traffic is encrypted and passwords cannot be intercepted.</li>
</ul>
</blockquote>
<h3 id="Updates-in-your-Remote-Application"><a href="#Updates-in-your-Remote-Application" class="headerlink" title="Updates in your Remote Application"></a>Updates in your Remote Application</h3><p>The <strong>remote client monitors your application classpath for changes in the same way as the local restart</strong>. Any updated resource is pushed to the remote application and (if required) triggers a restart. This can be helpful if you iterate on a feature that uses a cloud service that you do not have locally. Generally, remote updates and restarts are much quicker than a full rebuild and deploy cycle.</p>
<p>On a slower development environment, it may happen that the <strong>quiet period is not enough</strong>, and the <strong>changes in the classes may be split into batches</strong>. The server is <strong>restarted after the first batch of class changes is uploaded</strong>. The next batch can‚Äôt be sent to the application, since the server is restarting. This is typically manifested by <strong>a warning in the <code>RemoteSpringApplication</code> logs about failing to upload some of the classes, and a consequent retry</strong>. But it may also lead to application code inconsistency and failure to restart after the first batch of changes is uploaded. If you observe such problems constantly, try increasing the <code>spring.devtools.restart.poll-interval</code> and <code>spring.devtools.restart.quiet-period</code> parameters to the values that fit your development environment.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Files are <strong>only monitored when the remote client is running</strong>. If you change a file before starting the remote client, it is not pushed to the remote server.</li>
</ul>
</blockquote>
<h2 id="Spring-Boot-Features"><a href="#Spring-Boot-Features" class="headerlink" title="Spring Boot Features"></a>Spring Boot Features</h2><p>The SpringApplication class provides a convenient way to bootstrap a Spring application that is started from a <code>main()</code> method. In many situations, you can <strong>delegate to the <code>static SpringApplication.run</code> method</strong>, as shown in the following example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">	SpringApplication.run(MySpringConfiguration<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>When your application starts, you should see something similar to the following output:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">  .   ____          _            __ _ _</span><br><span class="line"> &#x2F;\\ &#x2F; ___&#39;_ __ _ _(_)_ __  __ _ \ \ \ \</span><br><span class="line">( ( )\___ | &#39;_ | &#39;_| | &#39;_ \&#x2F; _&#96; | \ \ \ \</span><br><span class="line"> \\&#x2F;  ___)| |_)| | | | | || (_| |  ) ) ) )</span><br><span class="line">  &#39;  |____| .__|_| |_|_| |_\__, | &#x2F; &#x2F; &#x2F; &#x2F;</span><br><span class="line"> &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;|_|&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;|___&#x2F;&#x3D;&#x2F;_&#x2F;_&#x2F;_&#x2F;</span><br><span class="line"> :: Spring Boot ::        (v2.3.0.RELEASE)</span><br><span class="line"></span><br><span class="line">2020-06-16 15:35:35.216  INFO 47936 --- [  restartedMain] App                                      : Starting App on XY-Laptop with PID 47936 (E:\Maven Workspace\testSpringBoot\target\classes started by 26238 in E:\Maven Workspace\testSpringBoot)</span><br><span class="line">2020-06-16 15:35:35.218  INFO 47936 --- [  restartedMain] App                                      : No active profile set, falling back to default profiles: default</span><br><span class="line">2020-06-16 15:35:35.248  INFO 47936 --- [  restartedMain] .e.DevToolsPropertyDefaultsPostProcessor : Devtools property defaults active! Set &#39;spring.devtools.add-properties&#39; to &#39;false&#39; to disable</span><br><span class="line">2020-06-16 15:35:35.248  INFO 47936 --- [  restartedMain] .e.DevToolsPropertyDefaultsPostProcessor : For additional web related logging consider setting the &#39;logging.level.web&#39; property to &#39;DEBUG&#39;</span><br><span class="line">2020-06-16 15:35:36.345  INFO 47936 --- [  restartedMain] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8080 (http)</span><br><span class="line">2020-06-16 15:35:36.351  INFO 47936 --- [  restartedMain] o.apache.catalina.core.StandardService   : Starting service [Tomcat]</span><br><span class="line">2020-06-16 15:35:36.351  INFO 47936 --- [  restartedMain] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat&#x2F;9.0.35]</span><br><span class="line">2020-06-16 15:35:36.399  INFO 47936 --- [  restartedMain] o.a.c.c.C.[Tomcat].[localhost].[&#x2F;]       : Initializing Spring embedded WebApplicationContext</span><br><span class="line">2020-06-16 15:35:36.399  INFO 47936 --- [  restartedMain] o.s.web.context.ContextLoader            : Root WebApplicationContext: initialization completed in 1151 ms</span><br><span class="line">2020-06-16 15:35:36.504  INFO 47936 --- [  restartedMain] o.s.s.concurrent.ThreadPoolTaskExecutor  : Initializing ExecutorService &#39;applicationTaskExecutor&#39;</span><br><span class="line">2020-06-16 15:35:36.588  INFO 47936 --- [  restartedMain] o.s.b.d.a.OptionalLiveReloadServer       : LiveReload server is running on port 35729</span><br><span class="line">2020-06-16 15:35:36.623  INFO 47936 --- [  restartedMain] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path &#39;&#39;</span><br><span class="line">2020-06-16 15:35:36.630  INFO 47936 --- [  restartedMain] App                                      : Started App in 1.652 seconds (JVM running for 1.947)</span><br></pre></td></tr></table></figure>

<h3 id="Startup-Failures"><a href="#Startup-Failures" class="headerlink" title="Startup Failures"></a>Startup Failures</h3><p>If your application fails to start, registered <code>FailureAnalyzers</code> get a chance to <strong>provide a dedicated error message and a concrete action to fix the problem</strong>. For instance, if you start a web application on port 8080 and that port is already in use, you should see something similar to the following message:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">***************************</span><br><span class="line">APPLICATION FAILED TO START</span><br><span class="line">***************************</span><br><span class="line">Description:</span><br><span class="line">Embedded servlet container failed to start. Port 8080 was already in use.</span><br><span class="line">Action:</span><br><span class="line">Identify and stop the process that&#39;s listening on port 8080 or configure this</span><br><span class="line">application to listen on another port.</span><br></pre></td></tr></table></figure>

<p>If no failure analyzers are able to handle the exception, you can still display the full conditions report to better understand what went wrong. To do so, you need to enable the debug property or enable <code>DEBUG</code> logging for <code>org.springframework.boot.autoconfigure.logging.ConditionEvaluationReportLoggingListener</code>.</p>
<p>For instance, <strong>if you are running your application by using <code>java -jar</code></strong>, you can enable the debug<br>property as follows:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar myproject<span class="number">-0.0</span><span class="number">.1</span>-SNAPSHOT.jar --debug</span><br></pre></td></tr></table></figure>

<h3 id="Lazy-Initialization"><a href="#Lazy-Initialization" class="headerlink" title="Lazy Initialization"></a>Lazy Initialization</h3><p><code>SpringApplication</code> allows an application to be <strong>initialized lazily (similar to that of the Spring Framework)</strong>. When lazy initialization is enabled, <strong>beans are created as they are needed rather than during application startup</strong>. As a result, enabling <strong>lazy initialization can reduce the time that it takes your application to start</strong>. In a web application, enabling lazy initialization will result in many web-related beans not being initialized until an HTTP request is received.</p>
<p>A downside of lazy initialization is that <strong>it can delay the discovery of a problem with the application</strong>. If a misconfigured bean is initialized lazily, a failure will no longer occur during startup and the problem will only become apparent when the bean is initialized. Care must also be taken to ensure that the <strong>JVM has sufficient memory to accommodate all of the application‚Äôs beans and not just those that are initialized during startup</strong>.</p>
<p>To enable lazy initialization, you can use:</p>
<ul>
<li>the <code>lazyInitialization</code> method on <code>SpringApplicationBuilder</code></li>
<li>the <code>setLazyInitialization</code> method on <code>SpringApplication</code></li>
<li>it can be enabled using the <code>spring.main.lazy-initialization</code> property, for example: <code>spring.main.lazy-initialization=true</code></li>
<li>or you can set a specific bean to be lazy initialized with <code>@Lazy(true)</code>, or at a class level with <code>@Lazy</code> (making all beans of that class to be lazily initialized)</li>
</ul>
<h3 id="Customzing-your-SpringApplication"><a href="#Customzing-your-SpringApplication" class="headerlink" title="Customzing your SpringApplication"></a>Customzing your SpringApplication</h3><p>If the <code>SpringApplication</code> defaults are** not to your taste, you can instead create a local instance** and customize it. For example, to turn off the banner (more details on customzing your banner, please visit this <a href="https://docs.spring.io/spring-boot/docs/2.3.1.RELEASE/reference/html/spring-boot-features.html#boot-features-banner" target="_blank" rel="noopener">link</a>), you could write:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">	SpringApplication app = <span class="keyword">new</span> SpringApplication(MySpringConfiguration<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">	app.setBannerMode(Banner.Mode.OFF);</span><br><span class="line">	app.run(args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>It is also possible to configure the <code>SpringApplication</code> by using an <code>application.properties</code> file. See <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-external-config" target="_blank" rel="noopener">Externalized Configuration</a> for details.</p>
<p>When deployed on platforms, applications can provide information about their availability to the platform using infrastructure such as <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/" target="_blank" rel="noopener">Kubernetes Probes</a>. Spring Boot includes out-of-the box <strong>support for the commonly used ‚Äúliveness‚Äù and ‚Äúreadiness‚Äù availability states</strong>. If you are using Spring Boot‚Äôs ‚Äúactuator‚Äù support then these states are exposed as health endpoint groups.</p>
<p>In addition, you can also obtain availability states by injecting the <code>ApplicationAvailability</code> interface into your own beans.</p>
<h3 id="Application-Liveness"><a href="#Application-Liveness" class="headerlink" title="Application Liveness"></a>Application Liveness</h3><h3 id="Application-Readiness"><a href="#Application-Readiness" class="headerlink" title="Application Readiness"></a>Application Readiness</h3><h3 id="Application-Event-and-Listeners"><a href="#Application-Event-and-Listeners" class="headerlink" title="Application Event and Listeners"></a>Application Event and Listeners</h3><h3 id="Web-Applications"><a href="#Web-Applications" class="headerlink" title="Web Applications"></a>Web Applications</h3><h3 id="Accessing-Application-Arguements"><a href="#Accessing-Application-Arguements" class="headerlink" title="Accessing Application Arguements"></a>Accessing Application Arguements</h3><p>If you need to <strong>access the application arguments that were passed to <code>SpringApplication.run(‚Ä¶)</code></strong>, you can <strong>inject a <code>org.springframework.boot.ApplicationArguments</code> bean.</strong> The <code>ApplicationArguments</code> interface provides access to both the raw <code>String[]</code> arguments as well as parsed option and non-option arguments, as shown in the following example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span>	<span class="comment">// bean injected here</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MyBean</span><span class="params">(ApplicationArguments args)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">boolean</span> debug = args.containsOption(<span class="string">"debug"</span>);</span><br><span class="line">		List&lt;String&gt; files = args.getNonOptionArgs();</span><br><span class="line">		<span class="comment">// if run with "--debug logfile.txt" debug=true, files=["logfile.txt"]</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Running-Specific-Code-for-SpringApplication"><a href="#Running-Specific-Code-for-SpringApplication" class="headerlink" title="Running Specific Code for SpringApplication"></a>Running Specific Code for SpringApplication</h3><p>If you need to run some specific code once the SpringApplication has started, you can implement the <code>ApplicationRunner</code> or <code>CommandLineRunner</code> interfaces. <strong>Both interfaces work in the same way and offer a single run method, which is called just before <code>SpringApplication.run(‚Ä¶)</code> completes</strong>.</p>
<p>The <code>CommandLineRunner</code> interfaces provides <strong>access to application arguments as a simple string array</strong>, whereas the ApplicationRunner uses the ApplicationArguments interface discussed earlier. The following example shows a CommandLineRunner with a run method:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.*;</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> <span class="keyword">implements</span> <span class="title">CommandLineRunner</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String... args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// Do something...</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>If several <code>CommandLineRunner</code> or <code>ApplicationRunner</code> beans are defined that must be called in a specific order, you can additionally implement the <code>org.springframework.core.Ordered</code> interface or <strong>use the <code>org.springframework.core.annotation.Order</code> annotation (e.g. @Order(1), remember that the smaller the number, the higher the priority)</strong>.</p>
<h3 id="Applicaiton-Exit"><a href="#Applicaiton-Exit" class="headerlink" title="Applicaiton Exit"></a>Applicaiton Exit</h3><p>Each SpringApplication registers a shutdown hook with the JVM to ensure that the ApplicationContext closes gracefully on exit. All the standard Spring lifecycle callbacks (such as the DisposableBean interface or the @PreDestroy annotation) can be used. </p>
<p>In addition, beans may implement the org.springframework.boot.ExitCodeGenerator interface if they wish to return a specific exit code when SpringApplication.exit() is called. This exit code can then be passed to System.exit() to return it as a status code, as shown in the following example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExitCodeApplication</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ExitCodeGenerator <span class="title">exitCodeGenerator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> () -&gt; <span class="number">42</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		System.exit(SpringApplication.exit(SpringApplication.run(ExitCodeApplication<span class="class">.<span class="keyword">class</span>,<span class="title">args</span>)))</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Also, the <code>ExitCodeGenerator</code> interface may be implemented by exceptions. When such an exception is encountered, Spring Boot <strong>returns the exit code provided by the implemented <code>getExitCode()</code> method</strong>.</p>
<h2 id="Externalized-Configuration"><a href="#Externalized-Configuration" class="headerlink" title="Externalized Configuration"></a>Externalized Configuration</h2><p>Spring Boot lets you externalize your configuration so that you can work with the same application code in different environments. You can <strong>use properties files, YAML files, environment variables, and command-line arguments to externalize configuration</strong>. </p>
<p><strong>Property values can be injected</strong> directly into your beans by using the <code>@Value</code> annotation, accessed through Spring‚Äôs <code>Environment</code> abstraction, or be bound to structured objects through <code>@ConfigurationProperties</code>. Spring Boot uses a <strong>very particular PropertySource order that is designed to allow sensible overriding of values</strong>. Properties are considered in the following order:</p>
<ol>
<li>Devtools global settings properties in the <code>$HOME/.config/spring-boot</code> directory when devtools is active.</li>
<li><code>@TestPropertySource</code> annotations on your tests.</li>
<li>properties attribute on your tests. Available on <code>@SpringBootTest</code> and the test annotations for testing a particular slice of your application.</li>
<li>Command line arguments.</li>
<li>Properties from <code>SPRING_APPLICATION_JSON</code> (inline JSON embedded in an environment variable or system property).</li>
<li>ServletConfig init parameters.</li>
<li>ServletContext init parameters.</li>
<li>JNDI attributes from java:comp/env.</li>
<li>Java System properties (<code>System.getProperties()</code>).</li>
<li>OS environment variables.</li>
<li>A RandomValuePropertySource that has properties only in <code>random.*</code>.</li>
<li>Profile-specific application properties outside of your packaged jar (<code>application-{profile}.properties</code> and YAML variants).</li>
<li>Profile-specific application properties packaged inside your jar (<code>application-{profile}.properties</code> and YAML variants).</li>
<li>Application properties outside of your packaged jar (<code>application.properties</code> and <code>YAML</code> variants).</li>
<li>Application properties packaged inside your jar (<code>application.properties</code> and <code>YAML</code> variants).</li>
<li><code>@PropertySource</code> annotations on your <code>@Configuration</code> classes. Please note that such property sources are not added to the Environment until the application context is being refreshed. This is too late to configure certain properties such as <code>logging.*</code> and <code>spring.main.*</code> which are read before refresh begins.</li>
<li>Default properties (specified by setting <code>SpringApplication.setDefaultProperties</code>).</li>
</ol>
<p>To provide a concrete example, suppose you develop a @Component that uses a name property, as shown in the following example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.stereotype.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.*;</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Value</span>(<span class="string">"$&#123;name&#125;"</span>)</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>On your application classpath (for example, inside your jar) you can have an<br>application.properties file that provides a sensible default property value for name. When running<br>in a new environment, an application.properties file can be provided outside of your jar that<br>overrides the name. For one-off testing, you can launch with a specific command line switch (for<br>example, java -jar app.jar ‚Äìname=‚ÄùSpring‚Äù).</p>
<h3 id="Using-a-Wildcard-for-Loading-Configuration-Files"><a href="#Using-a-Wildcard-for-Loading-Configuration-Files" class="headerlink" title="Using a Wildcard for Loading Configuration Files"></a>Using a Wildcard for Loading Configuration Files</h3><p>Spring Boot also supports wildcard locations when loading configuration files. By default, a wildcard location of <code>config/*/</code> outside of your jar is supported. Wildcard locations are also supported when specifying <code>spring.config.additional-location</code> and <code>spring.config.location</code>. </p>
<p>Wildcard locations are particularly <strong>useful in an environment such as Kubernetes</strong> when there are multiple sources of config properties. For example, if you have some Redis configuration and some MySQL configuration, you might want to keep those two pieces of configuration separate, while <strong>requiring that both those are present in an <code>application.properties</code> that the <code>app</code> can bind to</strong>. This might result in <strong>two separate <code>application.properties</code> files mounted at different locations such as <code>/config/redis/application.properties</code> and <code>/config/mysql/application.properties</code></strong>. In such a case, <strong>having a wildcard location of <code>config/*/</code>, will result in both files being processed</strong>.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> A wildcard location <strong>must contain only one and end with <code>/</code> for search locations</strong> that are directories or <strong><code>*/&lt;filename&gt;</code> for search locations that are files</strong>. Locations with wildcards are sorted alphabetically based on the absolute path of the file names.</li>
</ul>
</blockquote>
<h3 id="Generating-and-Using-Random-Values"><a href="#Generating-and-Using-Random-Values" class="headerlink" title="Generating and Using Random Values"></a>Generating and Using Random Values</h3><p>The <code>RandomValuePropertySource</code> is useful for injecting random values <strong>(for example, into secrets or test cases</strong>). It can produce integers, longs, uuids, or strings, as shown in the following example</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">my.secret=$&#123;random.value&#125;</span><br><span class="line">my.number=$&#123;random.int&#125;</span><br><span class="line">my.bignumber=$&#123;random.long&#125;</span><br><span class="line">my.uuid=$&#123;random.uuid&#125;</span><br><span class="line">my.number.less.than.ten=$&#123;random.int(10)&#125;</span><br><span class="line">my.number.in.range=$&#123;random.int[1024,65536]&#125;</span><br></pre></td></tr></table></figure>

<p>The <code>random.int*</code> syntax is <code>OPEN value (,max) CLOSE</code> where the <code>OPEN</code>,<code>CLOSE</code> are any character and value,max are integers. If <code>max</code> is provided, then <code>value</code> is the minimum value and <code>max</code> is the maximum value <strong>(exclusive)</strong>.</p>
<h3 id="Command-Line-Properties"><a href="#Command-Line-Properties" class="headerlink" title="Command Line Properties"></a>Command Line Properties</h3><p>By default, <code>SpringApplication</code> <strong>converts any command line option arguments</strong> (that is, arguments starting with <code>--</code>, such as <code>--server.port=9000</code>) <strong>to a property and adds them to the Spring <code>Environment</code></strong>. As mentioned previously, <strong>command line properties always take precedence over other property sources</strong>.</p>
<p>If you do not want command line properties to be added to the <code>Environment</code>, you can <strong>disable them by using <code>SpringApplication.setAddCommandLineProperties(false)</code></strong>.</p>
<h3 id="Application-Properties-File"><a href="#Application-Properties-File" class="headerlink" title="Application Properties File"></a>Application Properties File</h3><p>SpringApplication loads properties from <code>application.properties</code> files in the following locations and adds them to the Spring Environment:</p>
<ol>
<li>A <code>/config</code> subdirectory of the current directory</li>
<li>The current directory</li>
<li>A classpath <code>/config</code> package</li>
<li>The classpath root</li>
</ol>
<p>The list is <strong>ordered by precedence (properties defined in locations higher in the list override those<br>defined in lower locations)</strong>.</p>
<p>If you do not like <code>application.properties</code> as the configuration file name, you can <strong>switch to another file name by specifying a <code>spring.config.name</code> environment property</strong>. You can also <strong>refer to an explicit location by using the <code>spring.config.location</code> environment property</strong> (which is a comma-separated list of directory locations or file paths). The following example shows how to specify a different file name:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar myproject.jar --spring.config.name=myproject</span><br></pre></td></tr></table></figure>

<p>The following example shows how to specify two locations:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar myproject.jar</span><br><span class="line">--spring.config.location=classpath:/default.properties,classpath:/override.properties</span><br></pre></td></tr></table></figure>

<p>However, if you <strong>used a directory for searching that <code>application.properties</code></strong>, so that you <strong>specify custom config locations by using <code>spring.config.location</code></strong>, they replace the default search locations. </p>
<p>For example, if <code>spring.config.location</code> is configured with the value <code>classpath:/custom-config/</code>,<code>file:./custom-config/</code>, the search order becomes the following:</p>
<ol>
<li><code>file:./custom-config/</code></li>
<li><code>classpath:custom-config/</code></li>
</ol>
<p><strong>Instead of/Overrriding the default locations</strong> (<code>file:./config/</code> is searched first):</p>
<ol>
<li><code>file:./config/</code></li>
<li><code>file:./config/*/</code></li>
<li><code>file:./</code></li>
<li><code>classpath:/config/</code></li>
<li><code>classpath:/</code></li>
</ol>
<p>To prevent the overriding behavior, use <code>spring.config.additionallocation</code>, so that they are <strong>used in addition to the default locations</strong>. Additional locations <strong>are searched before the default locations</strong>. For example, if additional locations of <code>classpath:/customconfig/</code>, <code>file:./custom-config/</code> are configured, the search order becomes the following:</p>
<ol>
<li><code>file:./custom-config/</code></li>
<li><code>classpath:custom-config/</code></li>
<li><code>file:./config/</code></li>
<li><code>file:./config/*/</code></li>
<li><code>file:./</code></li>
<li><code>classpath:/config/</code></li>
<li><code>classpath:/</code></li>
</ol>
<h3 id="Profile-Specific-Properties"><a href="#Profile-Specific-Properties" class="headerlink" title="Profile Specific Properties"></a>Profile Specific Properties</h3><p>In addition to <code>application.properties</code> files, <strong>profile-specific properties</strong> can also be defined by using the following naming convention: <code>application-{profile}.properties</code></p>
<p><strong>Profile-specific properties are loaded from the same locations as standard <code>application.properties</code></strong>, with <strong>profile-specific files always overriding the non-specific ones</strong>, whether or not the profile specific files are inside or outside your packaged jar.</p>
<p>If several profiles are specified, a last-wins strategy applies. For example, profiles specified by the <code>spring.profiles.active</code> property are added after those configured through the SpringApplication API and therefore take precedence.</p>
<p>If that didn‚Äôt work, you can use either command line options or the <code>SpringApplication.setAdditionalProfiles()</code> option (if both are specified, the command line option takes precedence):</p>
<ul>
<li><p>Command line option:</p>
<ul>
<li>add the option: <code>-Dspring.profiles.active=dev</code> or <code>-Dspring.profiles.active=prod</code> to enable the usage of the <code>application-dev.properties</code> profile or the <code>application-prod.properties</code> profile, respectively</li>
</ul>
</li>
<li><p>SpringApplication</p>
<ul>
<li><p>before calling <code>SpringApplication.run()</code> function, do:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    SpringApplication app = <span class="keyword">new</span> SpringApplication(App<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    app.setAdditionalProfiles(<span class="string">"dev"</span>);</span><br><span class="line">    app.run(args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>to turn on the <code>application-dev.properties</code>. Switch to <code>(&quot;prod&quot;)</code> to enable the <code>application-prod.properties</code>.</p>
</li>
</ul>
</li>
</ul>
<h3 id="Injecting-Property-Values"><a href="#Injecting-Property-Values" class="headerlink" title="Injecting Property Values"></a>Injecting Property Values</h3><p>Basically, once the <code>application.properties</code> or other customized <code>application.properties</code> has been loaded, you can inject values with the placeholder <code>${}</code>.</p>
<p>In the main application where you run your SpringApplication, you can inject them easily with <code>@Value(&quot;${&lt;some-expression&gt;}&quot;)</code>. For example:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># inside application.properties</span><br><span class="line">app.my.name=jason</span><br></pre></td></tr></table></figure>

<p>then in your main application:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;app.my.name&#125;"</span>)</span><br><span class="line"><span class="keyword">private</span> String appName;</span><br></pre></td></tr></table></figure>

<p>However, in some other places, besides the main application, you might need to specify your <code>application.properties</code> file again before injecting the <code>@Value</code>. For example, in a <code>@Configuration</code> file at some other place in your project hierarchy:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@PropertySource</span>(<span class="string">"classpath:application.properties"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ProfileManager <span class="title">profileManager</span><span class="params">(@Autowired Environment env, @Value(<span class="string">"$&#123;app.testname&#125;"</span>)</span> String s) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ProfileManager(env,s);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Here constructor injection is used. For reason why constructor injection is preferred over field injection, please visit the Spring Framework Guide.</li>
</ul>
</blockquote>
<h3 id="Type-safe-Configuration-Properties"><a href="#Type-safe-Configuration-Properties" class="headerlink" title="Type-safe Configuration Properties"></a>Type-safe Configuration Properties</h3><h4 id="JavaBean-properties-binding"><a href="#JavaBean-properties-binding" class="headerlink" title="JavaBean properties binding"></a>JavaBean properties binding</h4><p>It is possible to bind a bean declaring standard JavaBean properties as shown in the following<br>example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(<span class="string">"acme"</span>)	<span class="comment">// matches the all the properties starting with `acme`</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AcmeProperties</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> enabled;	<span class="comment">// matches acme.enabled</span></span><br><span class="line">    <span class="keyword">private</span> InetAddress remoteAddress;  <span class="comment">// matches acme.remote-address</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Security security = <span class="keyword">new</span> Security();	<span class="comment">// matches acme.security.*</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEnabled</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEnabled</span><span class="params">(<span class="keyword">boolean</span> enabled)</span> </span>&#123; ... &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> InetAddress <span class="title">getRemoteAddress</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRemoteAddress</span><span class="params">(InetAddress remoteAddress)</span> </span>&#123; ... &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Security <span class="title">getSecurity</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Security</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String username;	<span class="comment">// matches acme.security.username</span></span><br><span class="line">        <span class="keyword">private</span> String password;	<span class="comment">// matches acme.security.password</span></span><br><span class="line">        <span class="keyword">private</span> List&lt;String&gt; roles = <span class="keyword">new</span> ArrayList&lt;&gt;(Collections.singleton(<span class="string">"USER"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123; ... &#125;	<span class="comment">// notice the setters here</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123; ... &#125;	<span class="comment">// notice the setters here</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">getRoles</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRoles</span><span class="params">(List&lt;String&gt; roles)</span> </span>&#123; ... &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Constructor-Binding"><a href="#Constructor-Binding" class="headerlink" title="Constructor Binding"></a>Constructor Binding</h4><p>The previous example could be made immutable with constructor binding and making them <code>final</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConstructorBinding;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.bind.DefaultValue;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ConstructorBinding</span>		<span class="comment">// enables constructor binding, so it looks for constructors for parameters to be injected</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(<span class="string">"acme"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AcmeProperties</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> enabled;	<span class="comment">// notice the final keyword</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> InetAddress remoteAddress;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Security security;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AcmeProperties</span><span class="params">(<span class="keyword">boolean</span> enabled, InetAddress remoteAddress, Security</span></span></span><br><span class="line"><span class="function"><span class="params">            security)</span> </span>&#123;		<span class="comment">// this woud be required for constructor binding</span></span><br><span class="line">        <span class="keyword">this</span>.enabled = enabled;</span><br><span class="line">        <span class="keyword">this</span>.remoteAddress = remoteAddress;</span><br><span class="line">        <span class="keyword">this</span>.security = security;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEnabled</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> InetAddress <span class="title">getRemoteAddress</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Security <span class="title">getSecurity</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Security</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String username;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String password;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> List&lt;String&gt; roles;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Security</span><span class="params">(String username, String password,</span></span></span><br><span class="line"><span class="function"><span class="params">                        @DefaultValue(<span class="string">"USER"</span>)</span> List&lt;String&gt; roles) </span>&#123;		<span class="comment">// notice the constructor here as well</span></span><br><span class="line">            <span class="keyword">this</span>.username = username;</span><br><span class="line">            <span class="keyword">this</span>.password = password;</span><br><span class="line">            <span class="keyword">this</span>.roles = roles;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">getRoles</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In this setup, the <strong><code>@ConstructorBinding</code> annotation</strong> is used to indicate that constructor binding should be used. This means that the <strong>binder will expect to find a constructor</strong> with the parameters that you wish to have bound (Nested members of a <code>@ConstructorBinding</code> class (such as Security in the example above) will also be bound via their constructor).</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> To use <strong>constructor binding the class must be enabled using <code>@EnableConfigurationProperties</code> or configuration property scanning</strong>. You <strong>cannot use constructor binding with beans that are created by the regular Spring mechanisms</strong> (e.g. <code>@Component</code> beans, beans created via @Bean methods or beans loaded using <code>@Import</code>).</li>
</ul>
</blockquote>
<h3 id="Enabling-ConfigurationProperties"><a href="#Enabling-ConfigurationProperties" class="headerlink" title="Enabling @ConfigurationProperties"></a>Enabling @ConfigurationProperties</h3><p>Spring Boot provides <strong>infrastructure to bind <code>@ConfigurationProperties</code> types and register them as beans</strong>. You can either enable configuration properties on a class-by-class basis or** enable configuration property scanning** that works in a similar manner to component scanning. </p>
<p>Sometimes, classes annotated with <code>@ConfigurationProperties</code> might not be suitable for scanning, for example, if you‚Äôre developing your own auto-configuration or you want to enable them conditionally. In these cases, specify the list of types to process using the <code>@EnableConfigurationProperties</code> annotation. This can be done on any <code>@Configuration</code> class, as shown in the following example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>(proxyBeanMethods = <span class="keyword">false</span>)</span><br><span class="line"><span class="meta">@EnableConfigurationProperties</span>(AcmeProperties<span class="class">.<span class="keyword">class</span>)	// <span class="title">this</span> <span class="title">will</span> <span class="title">be</span> <span class="title">not</span> <span class="title">necessary</span> <span class="title">if</span> </span></span><br><span class="line"><span class="class">														// <span class="title">you</span> <span class="title">use</span> @<span class="title">ConfigurationPropertiesScane</span> <span class="title">below</span></span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">MyConfiguration</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To use configuration property scanning, add the <code>@ConfigurationPropertiesScan</code> annotation to your application. Typically, it is added to the main application class that is annotated with <code>@SpringBootApplication</code> but it can be added to any <code>@Configuration</code> class.</p>
<p>By default, scanning will occur from the package of the class that declares the annotation. If you want to define specific packages to scan, you can do so as shown in the following example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@ConfigurationPropertiesScan</span>(&#123; <span class="string">"com.example.app"</span>, <span class="string">"org.acme.another"</span> &#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>One important thing to note is that:</p>
<ul>
<li><p>When <strong>the <code>@ConfigurationProperties</code> bean is registered using configuration property scanning or via <code>@EnableConfigurationProperties</code></strong>, the <strong>bean has a conventional name: <code>&lt;prefix&gt;-&lt;fqn&gt;</code></strong>, where <code>&lt;prefix&gt;</code> is the environment key prefix specified in the <code>@ConfigurationProperties</code> annotation and <code>&lt;fqn&gt;</code> is the fully qualified name of the bean. If the annotation does not provide any prefix, only the fully qualified name of the bean is used. </p>
<p>  The bean name in the example above is <code>acme-com.example.AcmeProperties</code>. This means you can do </p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span>(name = <span class="string">"acme-com.example.AcmeProperties"</span>)		<span class="comment">// instead of @Autowire, if you prefer</span></span><br><span class="line"><span class="keyword">private</span> AcmeProperties acmeProperties;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>In general, it is not recommended to inject other beans while using property binding. However, if you still want to <strong>inject other beans using the constructor</strong>, the <strong>configuration properties bean must be annotated with <code>@Component</code></strong> and use JavaBean-based property binding.</p>
<h3 id="Properties-Binding-to-a-Bean"><a href="#Properties-Binding-to-a-Bean" class="headerlink" title="Properties Binding to a Bean"></a>Properties Binding to a Bean</h3><p>To configure a bean from the Environment properties, add @ConfigurationProperties to its bean registration, as shown in the following example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"another"</span>)</span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> AnotherComponent <span class="title">anotherComponent</span><span class="params">(...)</span> </span>&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Any JavaBean property defined with the <code>another</code> prefix is mapped onto that <code>AnotherComponent</code> bean in manner similar to the preceding <code>AcmeProperties</code> example.</p>
<h3 id="Binding-Maps"><a href="#Binding-Maps" class="headerlink" title="Binding Maps"></a>Binding Maps</h3><p>When binding to Map properties, if the key contains <strong>anything other than lowercase alpha-numeric characters or <code>-</code>, you need to use the bracket notation so that the original value is preserved</strong>. If the key is <strong>not surrounded by <code>[]</code></strong>, any characters that are <strong>not alpha-numeric or <code>-</code> are removed.</strong> For example, consider binding the following properties to a Map:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">acme:</span></span><br><span class="line">	<span class="attr">map:</span></span><br><span class="line">		<span class="string">"[/key1]"</span><span class="string">:</span> <span class="string">value1</span></span><br><span class="line">		<span class="string">"[/key2]"</span><span class="string">:</span> <span class="string">value2</span></span><br><span class="line">		<span class="string">/key3:</span> <span class="string">value3</span></span><br></pre></td></tr></table></figure>

<p>The properties above will bind to a Map with <code>/key1</code>, <code>/key2</code> and <code>key3</code> as the keys in the map. (For YAML files, the brackets need to be surrounded by quotes for the keys to be parsed properly.)</p>
<h3 id="Relaxed-Name-Matching-and-Binding-for-Enviromental-Variables"><a href="#Relaxed-Name-Matching-and-Binding-for-Enviromental-Variables" class="headerlink" title="Relaxed Name Matching and Binding for Enviromental Variables"></a>Relaxed Name Matching and Binding for Enviromental Variables</h3><p>Spring Boot uses some relaxed rules for binding <code>Environment</code> properties to <code>@ConfigurationProperties</code> beans, so there <strong>does not need to be an exact match between the Environment property name and the bean property name</strong>. Common examples where this is useful include dash-separated environment properties (for example, <code>context-path</code> binds to <code>contextPath</code>), and capitalized environment properties (for example, <code>PORT</code> binds to <code>port</code>).</p>
<p>Spring Boot‚Äôs relaxed binding rules are, as much as possible, designed to be compatible with naming  estrictions in different operating systems, such as Unix and Linux.</p>
<p>To convert a property name in the canonical-form to an environment variable name you can follow<br>these rules:</p>
<ul>
<li>Replace dots (<code>.</code>) with underscores (<code>_</code>).</li>
<li><strong>Remove any dashes</strong> (<code>-</code>).</li>
<li>Convert to uppercase.</li>
</ul>
<p>For example, the configuration property <code>spring.main.log-startup-info</code> would be an environment variable named <code>SPRING_MAIN_LOGSTARTUPINFO</code>.</p>
<h3 id="Properties-Type-Conversion"><a href="#Properties-Type-Conversion" class="headerlink" title="Properties Type Conversion"></a>Properties Type Conversion</h3><p>Spring Boot attempts to <strong>coerce the external application properties to the right type</strong> when it binds to the <code>@ConfigurationProperties</code> beans. </p>
<p>If you need <strong>custom type conversion</strong>, you can provide a <code>ConversionService</code> bean (with a bean named <code>conversionService</code>) or custom property editors (through a <code>CustomEditorConfigurer</code> bean) or custom Converters (with bean definitions annotated as <code>@ConfigurationPropertiesBinding</code>).</p>
<h4 id="Converting-time-durations"><a href="#Converting-time-durations" class="headerlink" title="Converting time durations"></a>Converting time durations</h4><p>Spring Boot has dedicated support for expressing durations. If you expose a <code>java.time.Duration</code> property, the following formats in application properties are available: </p>
<ul>
<li>A regular <code>long</code> representation (using milliseconds as the default unit unless a <code>@DurationUnit</code> has been specified)</li>
<li>The standard ISO-8601 format used by <code>java.time.Duration</code></li>
<li>A more readable format where the value and the unit are coupled (e.g. <code>10s</code> means 10 seconds)</li>
</ul>
<p>Consider the following example:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># inside your application,properties, suppose those units are in seconds</span><br><span class="line">app.time.sessionTimeout=240</span><br><span class="line">app.time.readTimeout=120</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(<span class="string">"app.system"</span>)</span><br><span class="line"><span class="meta">@PropertySource</span>(<span class="string">"classpath:application.properties"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppSystemProperties</span> </span>&#123;</span><br><span class="line">	<span class="meta">@DurationUnit</span>(ChronoUnit.SECONDS)</span><br><span class="line">	<span class="keyword">private</span> Duration sessionTimeout;</span><br><span class="line">	<span class="meta">@DurationUnit</span>(ChronoUnit.SECONDS)</span><br><span class="line">	<span class="keyword">private</span> Duration readTimeout;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Duration <span class="title">getSessionTimeout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.sessionTimeout;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSessionTimeout</span><span class="params">(Duration sessionTimeout)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.sessionTimeout = sessionTimeout;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Duration <span class="title">getReadTimeout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.readTimeout;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setReadTimeout</span><span class="params">(Duration readTimeout)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.readTimeout = readTimeout;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>If you specified a session timeout of <code>30</code> seconds in <code>application.properties</code>, getting <code>30</code>, <code>PT30S</code> and <code>30s</code> are all equivalent, if you specified <code>@DurationUnit(ChronoUnit.SECONDS)</code>. A read timeout of <code>500ms</code> can be specified in any of the following form: <code>500</code>, <code>PT0.5S</code> and <code>500ms</code>, without specifying the <code>@DurationUnit</code>.</p>
<p>Alternatively, you can use <strong>constructor binding</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConstructorBinding</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(<span class="string">"app.time"</span>)</span><br><span class="line"><span class="meta">@PropertySource</span>(<span class="string">"classpath:application.properties"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TimeProperties</span> </span>&#123;</span><br><span class="line">    <span class="meta">@DurationUnit</span>(ChronoUnit.SECONDS)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> sessionTimeout;</span><br><span class="line">    <span class="meta">@DurationUnit</span>(ChronoUnit.SECONDS)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Duration readTimeout;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TimeProperties</span><span class="params">(<span class="keyword">long</span> sessionTimeout, Duration readTimeout)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sessionTimeout = sessionTimeout;</span><br><span class="line">        <span class="keyword">this</span>.readTimeout = readTimeout;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getSessionTimeout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.sessionTimeout;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Duration <span class="title">getReadTimeout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.readTimeout;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Converting-Periods"><a href="#Converting-Periods" class="headerlink" title="Converting Periods"></a>Converting Periods</h4><p>In addition to durations, Spring Boot can also work with <code>java.time.Period type</code>. This is essentially the same as <code>Duration</code> shown above.</p>
<p>The following formats can be used in application properties:</p>
<ul>
<li>An regular <code>int</code> representation (using days as the default unit unless a <code>@PeriodUnit</code> has been specified)</li>
<li>The standard <code>ISO-8601</code> format used by <code>java.time.Period</code></li>
<li>A simpler format where the value and the unit pairs are coupled (e.g. <code>1y3d</code> means 1 year and 3 days)</li>
</ul>
<h4 id="Converting-Data-Size"><a href="#Converting-Data-Size" class="headerlink" title="Converting Data Size"></a>Converting Data Size</h4><p>Spring Framework has a DataSize value type that expresses a size in bytes. If you expose a DataSize<br>property, the following formats in application properties are available:</p>
<ul>
<li>A regular long representation (using bytes as the default unit unless a <code>@DataSizeUnit</code> has been specified)</li>
<li>A more readable format where the value and the unit are coupled (e.g. <code>10MB</code> means 10 megabytes)</li>
</ul>
<p>Consider the following example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(<span class="string">"app.io"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppIoProperties</span> </span>&#123;</span><br><span class="line">	<span class="meta">@DataSizeUnit</span>(DataUnit.MEGABYTES)</span><br><span class="line">	<span class="keyword">private</span> DataSize bufferSize = DataSize.ofMegabytes(<span class="number">2</span>);</span><br><span class="line">	<span class="keyword">private</span> DataSize sizeThreshold = DataSize.ofBytes(<span class="number">512</span>);</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> DataSize <span class="title">getBufferSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.bufferSize;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBufferSize</span><span class="params">(DataSize bufferSize)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.bufferSize = bufferSize;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> DataSize <span class="title">getSizeThreshold</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.sizeThreshold;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSizeThreshold</span><span class="params">(DataSize sizeThreshold)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.sizeThreshold = sizeThreshold;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>To specify a buffer size of 10 megabytes, <code>10</code> and <code>10MB</code> are equivalent. A size threshold of 256 bytes can be specified as <code>256</code> or <code>256B</code>.</p>
<p>You can also use any of the supported units. These are:</p>
<ul>
<li><code>B</code> for bytes</li>
<li><code>KB</code> for kilobytes</li>
<li><code>MB</code> for megabytes</li>
<li><code>GB</code> for gigabytes</li>
<li><code>TB</code> for terabytes</li>
</ul>
<p>The default unit is bytes and can be overridden using <code>@DataSizeUnit</code> as illustrated in the sample above.</p>
<h3 id="Validating-ConfigurationProperties"><a href="#Validating-ConfigurationProperties" class="headerlink" title="Validating @ConfigurationProperties"></a>Validating <code>@ConfigurationProperties</code></h3><p>Spring Boot attempts to <strong>validate<code>@ConfigurationProperties</code> classes whenever they are annotated with Spring‚Äôs <code>@Validated</code> annotation</strong>. You can use JSR-303 <code>javax.validation</code> constraint annotations directly on your configuration class. To do so, ensure that a compliant JSR-303 implementation is on your classpath and then add constraint annotations to your fields, as shown in the following example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix=<span class="string">"acme"</span>)</span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AcmeProperties</span> </span>&#123;</span><br><span class="line">	<span class="meta">@NotNull</span></span><br><span class="line">	<span class="keyword">private</span> InetAddress remoteAddress;</span><br><span class="line">	<span class="comment">// ... getters and setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This will prevent the application from running if that field annotated with <code>@NotNull</code> is actually <code>null</code>. Then, if that is the case, you will see the error in console:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Property: app.time.writeTimeout</span><br><span class="line">Value: null</span><br><span class="line">Reason: cannot be null</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> To use this feature, you need to add the dependency<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-boot-starter-validation&lt;&#x2F;artifactId&gt;</span><br></pre></td></tr></table></figure></li>
<li><input disabled type="checkbox"> You can also trigger validation by annotating the <code>@Bean</code> method that creates the configuration properties with <code>@Validated</code></li>
</ul>
</blockquote>
<p>To ensure that validation is always <strong>triggered for nested properties</strong>, the <strong>associated field must be annotated with <code>@Valid</code></strong>, even when no properties are found. The following example builds on the preceding <code>AcmeProperties</code> example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix=<span class="string">"acme"</span>)</span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AcmeProperties</span> </span>&#123;</span><br><span class="line">	<span class="meta">@NotNull</span></span><br><span class="line">	<span class="keyword">private</span> InetAddress remoteAddress;</span><br><span class="line">	<span class="meta">@Valid</span>	<span class="comment">// notice the @Valid here</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> Security security = <span class="keyword">new</span> Security();</span><br><span class="line">	<span class="comment">// ... getters and setters</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Security</span> </span>&#123;</span><br><span class="line">		<span class="meta">@NotEmpty</span></span><br><span class="line">		<span class="keyword">public</span> String username;</span><br><span class="line">		<span class="comment">// ... getters and setters</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Logging"><a href="#Logging" class="headerlink" title="Logging"></a>Logging</h2><p>There are also quite some options that you can specify with logging. You can change the default logging level to options such as <code>debug</code> or <code>trace</code> to see more information about how Spring Boot configured your application, <code>logging-file-name</code> to produce logs to a local file.</p>
<h3 id="Log-Format"><a href="#Log-Format" class="headerlink" title="Log Format"></a>Log Format</h3><p>The** default log output** from Spring Boot resembles the following example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">2020-06-19 18:33:04.627  INFO 25956 --- [  restartedMain] .e.DevToolsPropertyDefaultsPostProcessor : Devtools property defaults active! Set &#39;spring.devtools.add-properties&#39; to &#39;false&#39; to disable</span><br><span class="line">2020-06-19 18:33:04.628  INFO 25956 --- [  restartedMain] .e.DevToolsPropertyDefaultsPostProcessor : For additional web related logging consider setting the &#39;logging.level.web&#39; property to &#39;DEBUG&#39;</span><br><span class="line">2020-06-19 18:33:05.317  INFO 25956 --- [  restartedMain] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8080 (http)</span><br><span class="line">2020-06-19 18:33:05.322  INFO 25956 --- [  restartedMain] o.apache.catalina.core.StandardService   : Starting service [Tomcat]</span><br><span class="line">2020-06-19 18:33:05.322  INFO 25956 --- [  restartedMain] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat&#x2F;9.0.35]</span><br><span class="line">2020-06-19 18:33:05.408  INFO 25956 --- [  restartedMain] o.a.c.c.C.[Tomcat].[localhost].[&#x2F;]       : Initializing Spring embedded WebApplicationContext</span><br><span class="line">2020-06-19 18:33:05.409  INFO 25956 --- [  restartedMain] o.s.web.context.ContextLoader            : Root WebApplicationContext: initialization completed in 781 ms</span><br><span class="line">2020-06-19 18:33:05.645  INFO 25956 --- [  restartedMain] o.s.s.concurrent.ThreadPoolTaskExecutor  : Initializing ExecutorService &#39;applicationTaskExecutor&#39;</span><br><span class="line">2020-06-19 18:33:05.758  INFO 25956 --- [  restartedMain] o.s.b.d.a.OptionalLiveReloadServer       : LiveReload server is running on port 35729</span><br><span class="line">2020-06-19 18:33:05.791  INFO 25956 --- [  restartedMain] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path &#39;&#39;</span><br></pre></td></tr></table></figure>

<p>The following items are output:</p>
<ul>
<li>Date and Time: Millisecond precision and easily sortable.</li>
<li>Log Level: <code>ERROR</code>, <code>WARN</code>, <code>INFO</code>, <code>DEBUG</code>, or <code>TRACE</code>.</li>
<li>Process ID.</li>
<li>A <code>---</code> separator to distinguish the start of actual log messages.</li>
<li>Thread name: Enclosed in square brackets (may be truncated for console output).</li>
<li>Logger name: This is usually the source class name (often abbreviated).</li>
<li>The log message.</li>
</ul>
<h3 id="debug-log"><a href="#debug-log" class="headerlink" title="debug log"></a><code>debug</code> log</h3><p>By default, <code>ERROR-level</code>, <code>WARN-level</code>, and <code>INFO-level</code> messages are logged. You can also enable a ‚Äúdebug‚Äù mode by starting your application with a <code>--debug</code> flag, or by specifying <code>debug=true</code> in your <code>application.properties</code>.</p>
<p>When the debug mode is enabled, <strong>a selection of core loggers</strong> (embedded container, Hibernate, and Spring Boot)** are configured to output more information<strong>. Enabling the debug mode does **not</strong> configure your application to <strong>log all messages with <code>DEBUG</code> level</strong>.</p>
<h3 id="trace-log"><a href="#trace-log" class="headerlink" title="trace log"></a><code>trace</code> log</h3><p>Alternatively, you can enable a ‚Äútrace‚Äù mode by starting your application with a <code>--trace</code> flag (or <code>trace=true</code> in your <code>application.properties</code>). Doing so enables <strong>trace logging for a selection of core loggers</strong> (embedded container, Hibernate schema generation, and the whole Spring portfolio).</p>
<h3 id="Configuring-Log-Levels-for-a-specific-logger"><a href="#Configuring-Log-Levels-for-a-specific-logger" class="headerlink" title="Configuring Log Levels for a specific logger"></a>Configuring Log Levels for a specific logger</h3><p>All the supported logging systems can have the logger levels set in the Spring Environment (for example, in <code>application.properties</code>) by <strong>using <code>logging.level.&lt;logger-name&gt;=&lt;level&gt;</code></strong> where level is one of <code>TRACE</code>, <code>DEBUG</code>, <code>INFO</code>, <code>WARN</code>, <code>ERROR</code>, <code>FATAL</code>, or <code>OFF</code>. The root logger can be configured by using <code>logging.level.root</code>.</p>
<p>The following example shows potential logging settings in <code>application.properties</code>:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">logging.level.root=warn</span><br><span class="line">logging.level.org.springframework.web=debug</span><br><span class="line">logging.level.org.hibernate=error</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> In the previous section, it is seen that <strong>some of the loggers have the name <code>o.s.boot</code> or <code>o.s.b</code></strong>. They <strong>actually stand for <code>org.springframework.boot</code></strong>. So you can configure them by specifying the logger level of <code>org.springframework.boot</code>.</li>
</ul>
</blockquote>
<h3 id="Configuring-Log-Levels-using-Log-Groups"><a href="#Configuring-Log-Levels-using-Log-Groups" class="headerlink" title="Configuring Log Levels using Log Groups"></a>Configuring Log Levels using Log Groups</h3><p>It‚Äôs often useful to be able to <strong>group related loggers together so that they can all be configured at the same time</strong>. For example, you might commonly change the logging levels for all Tomcat related loggers, but you can‚Äôt easily remember top level packages.</p>
<p>To help with this, Spring Boot allows you to <strong>define logging groups in your Spring Environment</strong>. For example, here‚Äôs how you could define a ‚Äútomcat‚Äù group by adding it to your <code>application.properties</code>:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logging.group.tomcat=org.apache.catalina, org.apache.coyote, org.apache.tomcat</span><br></pre></td></tr></table></figure>

<p>Once defined, you can change the level for all the loggers in the group with a single line:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logging.level.tomcat=TRACE</span><br></pre></td></tr></table></figure>
<p>Spring Boot includes the following <strong>pre-defined logging groups</strong> that can be used out-of-the-box:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Loggers</th>
</tr>
</thead>
<tbody><tr>
<td>web</td>
<td><code>org.springframework.core.codec</code>, <code>org.springframework.http</code>, <code>org.springframework.web</code>, <code>org.springframework.boot.actuate.endpoint.web</code>, <code>org.springframework.boot.web.servlet.ServletContextInitializerBeans</code></td>
</tr>
<tr>
<td>sql</td>
<td><code>org.springframework.jdbc.core</code>, <code>org.hibernate.SQL</code>, <code>org.jooq.tools.LoggerListener</code></td>
</tr>
</tbody></table>
<h3 id="File-Output"><a href="#File-Output" class="headerlink" title="File Output"></a>File Output</h3><p><strong>By default</strong>, Spring Boot <strong>logs only to the console</strong> and does not write log files. If you want to write log files in addition to the console output, you need to set a <code>logging.file.name</code> or <code>logging.file.path property</code>.</p>
<p>For example, to specify your output logging file to <code>./myLog.log</code>, where the current directory would be your project directory (where your <code>POM</code> file resides), you could write:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># inside application.properties</span><br><span class="line">logging.file.name&#x3D;.&#x2F;myLog.log</span><br></pre></td></tr></table></figure>

<p>The following table shows how the <code>logging.*</code> properties can be used together:</p>
<table>
<thead>
<tr>
<th><code>logging.file.name</code></th>
<th><code>logging.file.path</code></th>
<th>Example</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>(none)</td>
<td>(none)</td>
<td><code>logging.file.name=</code></td>
<td>Console only logging.</td>
</tr>
<tr>
<td>Specific file</td>
<td>(none)</td>
<td><code>logging.file.name=my.log</code></td>
<td>Writes to the specified log file. Names can be an exact location or relative to the current directory.</td>
</tr>
<tr>
<td>(none)</td>
<td>Specific directory</td>
<td><code>logging.file.path=/var/log</code></td>
<td>Writes <code>spring.log</code> to the specified directory.  Names can be an exact location or relative to the current directory.</td>
</tr>
</tbody></table>
<p>Log files rotate when they reach 10 MB and, as with console output, ERROR-level, WARN-level, and INFO<br>-level messages are logged by default. However, if you have specified <code>debug</code> or <code>trace</code> that modifies the console log output, the log written to file will also include those <code>debug</code> or <code>trace</code> information.</p>
<p>Besides that, there are** several other defaults that Spring Boot uses but can be configured**:</p>
<ul>
<li>Size limits can be changed using the <code>logging.file.max-size</code> property (by default it is 10MB). </li>
<li>Rotated log files of the last 7 days are kept by default unless the <code>logging.file.max-history</code> property has been set. </li>
<li>The total size of log archives can be capped using <code>logging.file.total-sizecap</code>. When the total size of log archives exceeds that threshold, backups will be deleted. </li>
<li>To force log archive cleanup on application startup, use the <code>logging.file.clean-history-on-start</code> property.</li>
</ul>
<h3 id="Logback-Extensions"><a href="#Logback-Extensions" class="headerlink" title="Logback Extensions"></a>Logback Extensions</h3><p>By default, the logging system you use is Logback. You can use and configure other logging systems as well (for more details, please visit <a href="https://docs.spring.io/spring-boot/docs/2.3.1.RELEASE/reference/html/spring-boot-features.html#boot-features-custom-log-configuration" target="_blank" rel="noopener">this link</a>). But <strong>if you use Logback</strong>, Spring Boot  includes <strong>a number of extensions to Logback that can help with advanced configuration</strong>.</p>
<p>You can use these extensions in your <code>logback-spring.xml</code> configuration file.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Because the <strong>standard <code>logback.xml</code> configuration file is loaded too early</strong>, you <strong>cannot use extensions in it</strong>. You need to either use <code>logback-spring.xml</code> or define a <code>logging.config</code> property.</li>
<li><input disabled type="checkbox"> The extensions <strong>cannot be used with Logback‚Äôs configuration scanning</strong>. If you attempt to do so, making changes to the configuration file results in an error.</li>
</ul>
</blockquote>
<h5 id="Profile-Specific-Configuration"><a href="#Profile-Specific-Configuration" class="headerlink" title="Profile Specific Configuration"></a>Profile Specific Configuration</h5><p>The <code>&lt;springProfile&gt;</code> tag lets you optionally <strong>include or exclude sections of configuration based on the active Spring profiles</strong>. Profile sections are supported anywhere within the <code>&lt;configuration&gt;</code> element. </p>
<p>Use the <code>name</code> attribute to specify which profile accepts the configuration. The <code>&lt;springProfile&gt;</code> tag can contain a simple profile name (for example <code>staging</code>) or a profile expression. </p>
<ul>
<li>A profile expression allows for more complicated profile logic to be expressed, for example <code>production &amp; (eu-central | eu-west)</code>. Check the <a href="https://docs.spring.io/spring/docs/5.2.6.RELEASE/spring-framework-reference/core.html#beans-definition-profiles-java" target="_blank" rel="noopener">reference guide</a> for more details.</li>
</ul>
<p>The following listing shows three sample profiles:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">"staging"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- configuration to be enabled when the "staging" profile is active --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">"dev | staging"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- configuration to be enabled when the "dev" or "staging" profiles are active --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">"!production"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- configuration to be enabled when the "production" profile is not active --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="Environment-Properties"><a href="#Environment-Properties" class="headerlink" title="Environment Properties"></a>Environment Properties</h5><p>The <code>&lt;springProperty&gt;</code> tag lets you expose properties from the Spring Environment for use within Logback. Doing so can be useful <strong>if you want to access values from your <code>application.properties</code> file</strong> in your Logback configuration. </p>
<p>The tag works in a similar way to Logback‚Äôs standard <code>&lt;property&gt;</code> tag. However, rather than specifying a direct value, you <strong>specify the source of the property</strong> (from the Environment). If you need to store the property somewhere other than in <code>local</code> scope, you can use the <code>scope</code> attribute. If you need a <code>fallback</code> value (in case the property is not set in the Environment), you can use the <code>defaultValue</code> attribute. The following example shows how to expose properties for use within Logback:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">springProperty</span> <span class="attr">scope</span>=<span class="string">"context"</span> <span class="attr">name</span>=<span class="string">"fluentHost"</span> <span class="attr">source</span>=<span class="string">"myapp.fluentd.host"</span> <span class="attr">defaultValue</span>=<span class="string">"localhost"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"FLUENT"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.more.appenders.DataFluentAppender"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">remoteHost</span>&gt;</span>$&#123;fluentHost&#125;<span class="tag">&lt;/<span class="name">remoteHost</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line"><span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/06/09/SpringBoot-Manual/" data-id="ckb7qqorv0000xworfjw0fm12" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Redis-Manual" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/06/02/Redis-Manual/" class="article-date">
  <time datetime="2020-06-02T01:10:15.000Z" itemprop="datePublished">2020-06-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/06/02/Redis-Manual/">Redis Manual</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<p><strong>IMPORTANT</strong>:<br>Much of the content here is a personal summary/abbrieviation of contents on the <a href="https://redislabs.com/ebook/part-1-getting-started/chapter-1-getting-to-know-redis/" target="_blank" rel="noopener">Offical Redis Guide</a>. For more complete information, please refer to the offical site.</p>
<hr>
<h2 id="Redis-Intro"><a href="#Redis-Intro" class="headerlink" title="Redis Intro"></a>Redis Intro</h2><p>Redis is an <strong>in-memory remote database</strong> that offers high performance, replication, and a unique data model to produce a platform for solving problems. By supporting <strong>five different types of data structures</strong> (<code>Strings</code>, <code>Lists</code>, <code>Sets</code>, <code>Hashes</code>, and <code>Sorted sets</code>), Redis accommodates a wide variety of problems that can be naturally mapped into what Redis offers.</p>
<p>To be specific, Redis is a very fast <strong>non-relational database</strong> that stores a <strong>mapping of keys to five different types of values</strong>. Redis supports <strong>in-memory persistent storage on disk</strong>, replication to scale read performance, and client-side sharding1 to scale write performance.</p>
<ul>
<li><strong>non-relational</strong><ul>
<li>In Redis, there are no tables, and there‚Äôs no database-defined or -enforced way of relating data in Redis with other data in Redis. Generally speaking, many Redis users will choose to <strong>store data in Redis</strong> only when the performance or functionality of Redis is necessary, using other relational or non-relational data storage for data where slower performance is acceptable, or where data is too large to fit in memory economically.</li>
</ul>
</li>
</ul>
<h2 id="Data-Structures-in-Redis"><a href="#Data-Structures-in-Redis" class="headerlink" title="Data Structures in Redis"></a>Data Structures in Redis</h2><table>
<thead>
<tr>
<th>Structure type</th>
<th>What it contains</th>
<th>Structure read/write ability</th>
</tr>
</thead>
<tbody><tr>
<td><code>STRING</code></td>
<td>Strings, integers, or floating-point values</td>
<td>Operate on the whole string, parts, increment/ decrement the integers and floats</td>
</tr>
<tr>
<td><code>LIST</code></td>
<td>Linked list of strings</td>
<td>Push or pop items from both ends, trim based on offsets, read individual or multiple items, find or remove items by value</td>
</tr>
<tr>
<td><code>SET</code></td>
<td>Unordered collection of unique strings</td>
<td>Add, fetch, or remove individual items, check membership, intersect, union, difference, fetch random items</td>
</tr>
<tr>
<td><code>HASH</code></td>
<td>Unordered hash table of keys to values</td>
<td>Add, fetch, or remove individual items, fetch the whole hash</td>
</tr>
<tr>
<td><code>ZSET</code> (sorted set)</td>
<td>Ordered mapping of string members to floating-point scores, ordered by score</td>
<td>Add, fetch, or remove individual values, fetch items based on score ranges or member value</td>
</tr>
</tbody></table>
<p>In the following sections, we will use the <code>redis cli</code> to pratice using redis commands and data structures.</p>
<p><a name="String-Basics"></a></p>
<h2 id="Strings-in-Redis-Basics"><a href="#Strings-in-Redis-Basics" class="headerlink" title="Strings in Redis - Basics"></a><code>String</code>s in Redis - Basics</h2><p>The operations available to <code>STRING</code>s start with what‚Äôs available in other <code>key-value</code> stores. We can <code>GET</code>values, <code>SET</code> values, and <code>DEL</code> values. After you have installed and tested Redis, within <code>redis-cli</code> you can try to <code>SET</code>, <code>GET</code>, and <code>DEL</code> values in Redis. The basic meanings are shown below in the table:</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>What it does</th>
</tr>
</thead>
<tbody><tr>
<td><code>GET</code></td>
<td><strong>Fetches the value</strong> stored at the <strong>given key</strong></td>
</tr>
<tr>
<td><code>SET</code></td>
<td><strong>Sets the value</strong> stored at the <strong>given key</strong></td>
</tr>
<tr>
<td><code>DEL</code></td>
<td><strong>Deletes the key-value pair</strong> stored at the <strong>given key</strong> (works for all types)</td>
</tr>
</tbody></table>
<p>Example demonstrating each of the commands:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; set hello value</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get hello</span><br><span class="line">&quot;value&quot;</span><br><span class="line">127.0.0.1:6379&gt; del hello</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; get hello</span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> You see outputs such as <code>(integer) 1</code>, which usually represents execution success/true. <code>(nil)</code> represents execution failure, and <code>(integer) 0</code> also means failure but to the extent where the output means <code>false</code>, for example when a value (rather than the key) DNE.</li>
</ul>
</blockquote>
<p><a name="List-Basics"></a></p>
<h2 id="Lists-in-Redis-Basics"><a href="#Lists-in-Redis-Basics" class="headerlink" title="Lists in Redis - Basics"></a><code>List</code>s in Redis - Basics</h2><p>The operations that can be performed on <code>LIST</code>s are typical of what we find in <code>LinkedList</code> data structures in almost any programming language. We can <code>push</code> items to the front and the back of the <code>LIST</code> with <code>LPUSH</code>/<code>RPUSH</code>; we can <code>pop</code> items from the front and back of the list with <code>LPOP</code>/<code>RPOP</code>; we can <code>fetch</code> an item at a given position with <code>LINDEX</code>; and we can <code>fetch</code> a range of items with <code>LRANGE</code>. </p>
<table>
<thead>
<tr>
<th>Command</th>
<th>What it does</th>
</tr>
</thead>
<tbody><tr>
<td><code>RPUSH</code></td>
<td>Pushes the value onto the <strong>right end</strong> of the list. If list DNE, creates a new list</td>
</tr>
<tr>
<td><code>LRANGE</code></td>
<td>Fetches a <strong>range of values</strong> from the list</td>
</tr>
<tr>
<td><code>LINDEX</code></td>
<td>Fetches <strong>an item at a given position</strong> in the list (begins at index <code>0</code>)</td>
</tr>
<tr>
<td><code>LPOP</code></td>
<td>Pops the value from the <strong>left end</strong> of the list and returns it</td>
</tr>
</tbody></table>
<p>For example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; rpush test-list item1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; rpush test-list item2</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; rpush test-list item1</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; lrange test-list 0 -1</span><br><span class="line">1) &quot;item1&quot;</span><br><span class="line">2) &quot;item2&quot;</span><br><span class="line">3) &quot;item1&quot;</span><br><span class="line">127.0.0.1:6379&gt; lindex test-list 1</span><br><span class="line">&quot;item2&quot;</span><br><span class="line">127.0.0.1:6379&gt; lpop test-list</span><br><span class="line">&quot;item1&quot;</span><br><span class="line">127.0.0.1:6379&gt; lrange test-list 0 -1</span><br><span class="line">1) &quot;item2&quot;</span><br><span class="line">2) &quot;item1&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> See that <strong>duplicates in values</strong> are allowed. </li>
</ul>
</blockquote>
<p><a name="Set-Basics"></a></p>
<h2 id="Sets-in-Redis-Basics"><a href="#Sets-in-Redis-Basics" class="headerlink" title="Sets in Redis - Basics"></a><code>Set</code>s in Redis - Basics</h2><p>In Redis, <code>SET</code>s are similar to <code>LIST</code>s in that they‚Äôre a sequence of strings, but unlike <code>LIST</code>s, Redis <code>SET</code>s use a <strong>hash table</strong> to keep <strong>all values/strings unique</strong>. </p>
<p>Because Redis <code>SET</code>s are <strong>unordered</strong>, we <strong>can‚Äôt <code>push</code> and <code>pop</code> items</strong> from the ends like we did with <code>LIST</code>s. Instead, we <strong><code>add</code> and <code>remove</code> items by value</strong> with the <code>SADD</code> and <code>SREM</code> commands. We can also find out whether an item is in the <code>SET</code> quickly with <code>SISMEMBER</code>, or <code>fetch</code> the entire set with <code>SMEMBERS</code> (this can be slow for large SETs, so be careful)</p>
<table>
<thead>
<tr>
<th>Comamnd</th>
<th>What it does</th>
</tr>
</thead>
<tbody><tr>
<td><code>SADD</code></td>
<td><strong>Adds the item</strong> to the set</td>
</tr>
<tr>
<td><code>SMEMBERS</code></td>
<td>Returns the <strong>entire set of items</strong></td>
</tr>
<tr>
<td><code>SISMEMBER</code></td>
<td><strong>Checks if an item</strong> is in the set</td>
</tr>
<tr>
<td><code>SREM</code></td>
<td><strong>Removes the item</strong> from the set, <strong>if it exists</strong></td>
</tr>
</tbody></table>
<p>For example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; sadd test-set item1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; sadd test-set item2</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; sadd test-set item1</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; smembers test-set</span><br><span class="line">1) &quot;item2&quot;</span><br><span class="line">2) &quot;item1&quot;</span><br><span class="line">127.0.0.1:6379&gt; sismember test-set item1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; sismember test-set item3</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; srem test-set item1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; srem test-set item1</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; smembers test-set</span><br><span class="line">1) &quot;item2&quot;</span><br></pre></td></tr></table></figure>

<p><a name="Hash-Basics"></a></p>
<h2 id="Hashes-in-Redis-Basics"><a href="#Hashes-in-Redis-Basics" class="headerlink" title="Hashes in Redis - Basics"></a><code>Hash</code>es in Redis - Basics</h2><p>Whereas <code>LIST</code>s and <code>SET</code>s in Redis hold sequences of items, Redis <code>HASH</code>es store a <strong>mapping of (distinct) keys to values</strong>. The values that can be stored in <code>HASH</code>es are the same as what can be stored as normal <code>STRING</code>s: strings themselves, or if a value can be interpreted as a number, that value can be incremented or decremented.</p>
<p>In a lot of ways, we can think of <strong><code>HASH</code>es in Redis as miniature versions of Redis itself</strong>. </p>
<table>
<thead>
<tr>
<th>Command</th>
<th>What it does</th>
</tr>
</thead>
<tbody><tr>
<td><code>HSET</code></td>
<td>Creats a hashtable, and <strong>stores the key-value pair</strong> in tha hashtable</td>
</tr>
<tr>
<td><code>HGET</code></td>
<td>Fetches the <strong>value at the given hash key</strong></td>
</tr>
<tr>
<td><code>HGETALL</code></td>
<td>Fetches the <strong>entire hashtable</strong></td>
</tr>
<tr>
<td><code>HDEL</code></td>
<td><strong>Removes a key-value pair</strong> from the hash, if it exists</td>
</tr>
</tbody></table>
<p>For example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hset test-hasht key1 value1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; hset test-hasht key2 value2</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; hset test-hasht key1 value2</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; hgetall test-hasht</span><br><span class="line">1) &quot;key1&quot;</span><br><span class="line">2) &quot;value2&quot;</span><br><span class="line">3) &quot;key2&quot;</span><br><span class="line">4) &quot;value2&quot;</span><br><span class="line">127.0.0.1:6379&gt; hget test-hasht key1</span><br><span class="line">&quot;value2&quot;</span><br><span class="line">127.0.0.1:6379&gt; hdel test-hasht key2</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; hgetall test-hasht</span><br><span class="line">1) &quot;key1&quot;</span><br><span class="line">2) &quot;value2&quot;</span><br></pre></td></tr></table></figure>

<p><a name="ZSet-Basics"></a></p>
<h2 id="Sorted-sets-Zsets-in-Redis-Basics"><a href="#Sorted-sets-Zsets-in-Redis-Basics" class="headerlink" title="Sorted sets/Zsets in Redis - Basics"></a><code>Sorted set</code>s/<code>Zset</code>s in Redis - Basics</h2><p>Like Redis <code>HASH</code>es, <code>ZSET</code>s also hold <strong>pairs of key and value</strong>. The <strong>keys (called <code>member</code>s) are unique</strong>, and the <strong>values (called <code>score</code>s) are limited to floating-point numbers</strong>. <code>ZSET</code>s have the unique property in Redis of being able to be accessed by member (like a HASH), but <strong>items can also be accessed by the sorted order and values of the <code>score</code>s</strong>. </p>
<table>
<thead>
<tr>
<th>Command</th>
<th>What it does</th>
</tr>
</thead>
<tbody><tr>
<td><code>ZADD</code></td>
<td><strong>Adds member/key with the given score</strong> to the ZSET. The order of input is <code>score</code> and then <code>member</code>.</td>
</tr>
<tr>
<td><code>ZRANGE</code></td>
<td>Fetches the items in the ZSET <strong>from their positions in sorted order</strong></td>
</tr>
<tr>
<td><code>ZRANGEBYSCORE</code></td>
<td>Fetches items in the ZSET <strong>based on a range of scores</strong></td>
</tr>
<tr>
<td><code>ZREM</code></td>
<td>Removes the <strong>item</strong> from the ZSET, if it exists</td>
</tr>
</tbody></table>
<p>For example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zadd test-zset 100 member1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; zadd test-zset 200 member2</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; zadd test-zset 200 member3</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; zrange test-zset 0 -1 withscores</span><br><span class="line">1) &quot;member1&quot;</span><br><span class="line">2) &quot;100&quot;</span><br><span class="line">3) &quot;member2&quot;</span><br><span class="line">4) &quot;200&quot;</span><br><span class="line">5) &quot;member3&quot;</span><br><span class="line">6) &quot;200&quot;</span><br><span class="line">127.0.0.1:6379&gt; zrange test-zset 0 -1</span><br><span class="line">1) &quot;member1&quot;</span><br><span class="line">2) &quot;member2&quot;</span><br><span class="line">3) &quot;member3&quot;</span><br><span class="line">127.0.0.1:6379&gt; zrangebyscore test-zset 0 150 withscores</span><br><span class="line">1) &quot;member1&quot;</span><br><span class="line">2) &quot;100&quot;</span><br><span class="line">127.0.0.1:6379&gt; zrem test-zset member1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; zrange test-zset 0 -1 withscores</span><br><span class="line">1) &quot;member2&quot;</span><br><span class="line">2) &quot;200&quot;</span><br><span class="line">3) &quot;member3&quot;</span><br><span class="line">4) &quot;200&quot;</span><br></pre></td></tr></table></figure>

<h2 id="Connecting-a-Python-Standalone-Container-to-Redis"><a href="#Connecting-a-Python-Standalone-Container-to-Redis" class="headerlink" title="Connecting a Python Standalone Container to Redis"></a>Connecting a Python Standalone Container to Redis</h2><p>The basic idea is as follows (assuming you already have a <code>redis</code> container):</p>
<ul>
<li>create a <code>bridge</code> that allows the two containers to automatically resolve each other‚Äôs IP by container name</li>
<li>connect your <code>redis</code> container to that <code>bridge</code></li>
<li>create a <code>python</code> container, connecting it to the same <code>bridge</code> you just created, and configuring your mount volume(s)</li>
<li>install Redis libraries in the <code>python</code> container</li>
<li>connect your to the <code>redis</code> container by <code>connected = redis.Redis(host=&#39;&lt;your-redis-container-name&gt;&#39;, port=6379)</code>.<br>(alternatively, you could use <code>docker-compose</code> to achieve the same thing.)</li>
</ul>
<ol>
<li><p>Create a <code>user-defined bridge</code> with the name <code>redis-py</code> in Docker with the following command:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create -d bridge redis-py</span><br></pre></td></tr></table></figure></li>
<li><p>Connect your already exitsed <code>redis</code> container to that bridge. If you do not have a <code>redis</code> container yet, you need to set one up first. You connect the <code>redis</code> container (called <code>test-redis</code> in this example) to that bridge <code>redis-py</code> by running:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network connect redis-py test-redis</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Here you would also need to remember the port name your <code>redis</code> container uses. By default, it should be <code>6379</code>. You can see the port once you run your <code>redis</code> container with <code>docker exec -it test-redis redis-cli</code>, and it will show, for example: <code>127.0.0.1:6379&gt;</code>.</li>
</ul>
</blockquote>
</li>
<li><p>Now you need to build another <code>python</code> container. You can first pull the image with <code>docker pull python</code>, and then start a container with:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --name&#x3D;test-py-red \</span><br><span class="line">	--network redis-py \</span><br><span class="line">	-e REDIS_HOST&#x3D;test-redis \</span><br><span class="line">	-e REDIS_PORT&#x3D;6379 \</span><br><span class="line">	-p 8080:80 \</span><br><span class="line">	-v python-vol:&#x2F;data \</span><br><span class="line">	python bash</span><br></pre></td></tr></table></figure>
<p> Note that some of the commands above are <strong>optional</strong>:</p>
<ul>
<li><code>-e REDIS_HOST=test-redis</code><ul>
<li>this will configure your enviromental variable <code>REDIS_HOST</code> to be set to <code>test-redis</code> (your <code>redis</code> container name). However, this is not necessary.</li>
</ul>
</li>
<li><code>e REDIS_PORT=6379</code><ul>
<li>this will configure your enviromental variable <code>REDIS_PORT</code> to be set to <code>6379</code> (your <code>redis</code> port). However, this is not necessary.</li>
</ul>
</li>
<li><code>v python-vol:/data</code> (recommended to have a mount)<ul>
<li>this will mount the directory <code>/data</code> in your <code>python</code> container to the external local volume <code>python-vol</code></li>
</ul>
</li>
</ul>
</li>
<li><p>Now, since we specified <code>python bash</code> in the last line, it will start in bash inside the container. This allows you to install the <code>redis</code> library for python:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip install --trusted-host pypi.python.org Flask Redis</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> A problem with this is that if you remove the container, you will need to execute to re-install this library again. A solution could be to build your own Dockerfile and create your own image with:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FROM python:latest</span><br><span class="line">WORKDIR &#x2F;app</span><br><span class="line">ADD . &#x2F;app</span><br><span class="line">RUN pip install --trusted-host pypi.python.org Flask Redis</span><br><span class="line">EXPOSE 80 </span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
</li>
<li><p>Finally, you can connect to your <code>redis</code> container names <code>test-redis</code> with:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python</span><br></pre></td></tr></table></figure>
<p> which enters the <code>python</code> command line.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import redis</span><br></pre></td></tr></table></figure>
<p> which imports the <code>redis</code> library you just installed</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; connected &#x3D; redis.Redis(host&#x3D;&#39;test-redis&#39;,port&#x3D;6379)</span><br></pre></td></tr></table></figure>
<p> which connects to the <code>test-redis</code> container at port <code>6379</code>, so that now you can access <code>redis</code> contents and comamnds such as:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; connected.set(&#39;hello&#39;,&#39;world&#39;)</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="Antonomy-of-a-Redis-Web-Application"><a href="#Antonomy-of-a-Redis-Web-Application" class="headerlink" title="Antonomy of a Redis Web Application"></a>Antonomy of a Redis Web Application</h2><p>Consider the case that you are managing a large online retail store, and you have millions of customers using it. Now, besides managing your website‚Äôs functionality, you would need several things to consider related to user-generated information:</p>
<ul>
<li>login management</li>
<li>user browsing data</li>
<li>‚Ä¶<br>You may thing that you could simply use a database like SQL. However, the problem is that most relational databases are limited to inserting, updating, or deleting <strong>roughly 200‚Äì2,000 individual rows every second per database server</strong>. Though bulk inserts/updates/deletes can be performed faster, a customer will only be updating a small handful of rows for each web page view, so higher-speed bulk insertion doesn‚Äôt help here.</li>
</ul>
<p>At present, due to the relatively large load through the day (assume averaging roughly 1,200 writes per second, close to 6,000 writes per second at peak), you needed to <strong>set up 10 relational database servers to deal with the load during peak hours</strong>. But now, you would like to try the new <code>redis</code> tool and see if all those data could be managed more easily.</p>
<h2 id="Login-and-Cookie-Caching"><a href="#Login-and-Cookie-Caching" class="headerlink" title="Login and Cookie Caching"></a>Login and Cookie Caching</h2><p>Whenever we sign in to services on the internet, such as bank accounts or web mail, these services <strong>remember who we are using cookies</strong>. <strong>Cookies are small pieces of data</strong> that websites ask our <strong>web browsers to store and resend</strong> on every request to that service. </p>
<p>For <strong>login cookies</strong>, there are two common methods of storing login information in cookies: <strong>a signed cookie</strong> or <strong>a token cookie</strong>.</p>
<p>In general, cookies <strong>do not store passwords</strong>.</p>
<ul>
<li><p><strong>Signed cookies</strong> typically store the <code>username</code> when they last logged in, or maybe their user ID, and whatever else the service may find useful. Along with this user-specific information, the <strong>cookie also includes a signature that allows the server to verify that the information that the browser sent hasn‚Äôt been altered</strong> (like replacing the login name of one user with another).</p>
</li>
<li><p><strong>Token cookies</strong> use a series of <strong>random bytes as the data</strong> in the cookie. The series of random bytes is generated when you logged in successfully, and then <strong>the server issues you that long random number token as a secret identifier</strong>. Then, on the server, <strong>the token is used as a key to look up the user who owns that token by querying a database of some kind</strong>. Over time, old tokens can be deleted to make room for new tokens (so that your loggin session expires).</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>Cookie type</th>
<th>Pros</th>
<th>Cons</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Signed cookie</strong></td>
<td>Everything needed to verify the cookie is in the cookie. Additional information can be included and signed easily</td>
<td>Correctly handling signatures is hard. It‚Äôs easy to forget to sign and/or verify data, allowing security vulnerabilities</td>
</tr>
<tr>
<td><strong>Token cookie</strong></td>
<td>Adding information is easy. Very small cookie, so mobile and slow clients can send requests faster</td>
<td>More information to store on the server. If using a relational database, cookie loading / storing can be expensive</td>
</tr>
</tbody></table>
<p>To get started, we‚Äôll use a <code>HASH</code> to store our <strong>mapping from login cookie tokens</strong> to the <strong>user that‚Äôs logged in</strong>. </p>
<ul>
<li><p>To <strong>check the login</strong>, we need to fetch the user based on the token and return it, if it‚Äôs available. The following listing shows how we check login cookies.</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># conn=redis.Redis(host='&lt;yourhost&gt;', port='&lt;yourPort&gt;')</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_token</span><span class="params">(conn, token)</span>:</span></span><br><span class="line">	<span class="keyword">return</span> conn.hget(<span class="string">'login:'</span>, token)  <span class="comment"># Fetch and return the given user, if available.</span></span><br></pre></td></tr></table></figure>


</li>
</ul>
<ul>
<li><p>Then, for a visit, we‚Äôll <strong>update the login <code>HASH</code> for the user and record the current timestamp for the token</strong> in the <code>ZSET</code> of recent users. If the user was viewing an item, we also add the item to the user‚Äôs recently viewed <code>ZSET</code> and trim that <code>ZSET</code> <strong>if it grows past 25 items</strong>. The function that does all of this can be seen next.</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update_token</span><span class="params">(conn, token, user, item=None)</span>:</span></span><br><span class="line">	timestamp = time.time()  <span class="comment">#Get the timestamp.</span></span><br><span class="line"></span><br><span class="line">	conn.hset(<span class="string">'login:'</span>, token, user)  <span class="comment">#Keep a mapping from the token to the logged-in user.</span></span><br><span class="line">	conn.zadd(<span class="string">'recent:'</span>, token, timestamp)  <span class="comment">#Record when the token was last seen.</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> item:</span><br><span class="line">		conn.zadd(<span class="string">'viewed:'</span> + token, item, timestamp)  <span class="comment">#Record that the user viewed the item.</span></span><br><span class="line">		conn.zremrangebyrank(<span class="string">'viewed:'</span> + token, <span class="number">0</span>, <span class="number">-26</span>)  <span class="comment">#Remove old items, keeping the most recent 25.</span></span><br></pre></td></tr></table></figure>

<p>  And you know what? That‚Äôs it. We‚Äôve now <strong>recorded when a user with the given session last viewed an item and what item that user most recently looked at</strong>. On a server made in the last few years, you can record this information <strong>for at least 20,000 item views every second</strong>, which is more than three times what we needed to perform against the database. This can be made even faster, which we‚Äôll talk about later. But even for this version, we‚Äôve improved performance by 10‚Äì100 times over a typical relational database in this context.</p>
</li>
<li><p>Over time, memory use will grow, and we‚Äôll want to <strong>clean out old data</strong>. As a way of limiting our data, we‚Äôll only <strong>keep the most recent 10 million sessions</strong>.</p>
<p>  For our cleanup, we‚Äôll <code>fetch</code> the size of the <code>ZSET</code> in a loop. If the <code>ZSET</code> is too large, we‚Äôll fetch the oldest items up to 100 at a time (because we‚Äôre using timestamps, this is just the first 100 items in the ZSET), <strong>remove them from the <code>recent ZSET</code></strong>, <strong>delete the login tokens from the <code>login HASH</code></strong>, and <strong>delete the relevant <code>viewed ZSET</code>s</strong>. If the ZSET isn‚Äôt too large, we‚Äôll <strong>sleep for one second and try again later</strong>. The code for cleaning out old sessions is shown next.</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">QUIT = <span class="literal">False</span></span><br><span class="line">LIMIT = <span class="number">10000000</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clean_sessions</span><span class="params">(conn)</span>:</span></span><br><span class="line">	<span class="keyword">while</span> <span class="keyword">not</span> QUIT:</span><br><span class="line">		size = conn.zcard(<span class="string">'recent:'</span>)  <span class="comment"># Find out how many tokens are known.</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> size &lt;= LIMIT:</span><br><span class="line">			time.sleep(<span class="number">1</span>)  <span class="comment"># We‚Äôre still under our limit; sleep and try again.</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			end_index = min(size - LIMIT, <span class="number">100</span>)</span><br><span class="line">			tokens = conn.zrange(<span class="string">'recent:'</span>, <span class="number">0</span>, end_index<span class="number">-1</span>)  <span class="comment"># Fetch the token IDs that should be removed.</span></span><br><span class="line">		</span><br><span class="line">			session_keys = []</span><br><span class="line">			<span class="keyword">for</span> token <span class="keyword">in</span> tokens:</span><br><span class="line">				session_keys.append(<span class="string">'viewed:'</span> + token)  <span class="comment"># Prepare the key names for the tokens to delete.</span></span><br><span class="line">		</span><br><span class="line">			conn.delete(*session_keys)</span><br><span class="line">			conn.hdel(<span class="string">'login:'</span>, *tokens)</span><br><span class="line">			conn.zrem(<span class="string">'recent:'</span>, *tokens)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> The <code>cleanup</code> function written above may be run as a <strong>daemon process</strong>, to be run periodically via a cron job, or even to be run during every execution. As a general rule, if the function includes a <code>while not QUIT</code>: line, it‚Äôs <strong>supposed to be run as a daemon</strong>, though it could probably be modified to be run periodically, depending on its purpose.</li>
<li><input disabled type="checkbox"> You also notice that we called three functions with a syntax similar to <code>conn.delete(*vtokens)</code>. Basically, we‚Äôre <strong>passing a sequence of arguments to the underlying function without previously unpacking</strong> the arguments. For further details on the semantics of how this works, you can visit the Python language tutorial website by visiting this short url: <a href="https://mng.bz/8I7W" target="_blank" rel="noopener">https://mng.bz/8I7W</a>.</li>
</ul>
</blockquote>
<h2 id="Storing-Shopping-Carts-Info"><a href="#Storing-Shopping-Carts-Info" class="headerlink" title="Storing Shopping Carts Info"></a>Storing Shopping Carts Info</h2><p>Because we‚Äôve had such good luck with session cookies and recently viewed items, we‚Äôll push our <strong>shopping cart information</strong> into Redis. Since we‚Äôre already keeping user session cookies in Redis (along with recently viewed items), we can use the <strong>same cookie ID for referencing the shopping cart</strong>.</p>
<p>The shopping cart that we‚Äôll use is simple: it‚Äôs a <code>HASH</code> that <strong>maps an item ID to the quantity of that item that the customer would like to purchase</strong>. We‚Äôll have the web application handle validation for item count, so we only need to update counts in the cart as they change. If the user wants more than 0 items, we add the item(s) to the <code>HASH</code> (replacing an earlier count if it existed). If not, we remove the entry from the hash. Our <code>add_to_cart()</code> function can be seen in this listing.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_to_cart</span><span class="params">(conn, session, item, count)</span>:</span></span><br><span class="line">	<span class="keyword">if</span> count &lt;= <span class="number">0</span>:</span><br><span class="line">		conn.hrem(<span class="string">'cart:'</span> + session, item)  <span class="comment"># Remove the item from the cart.</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		conn.hset(<span class="string">'cart:'</span> + session, item, count)  <span class="comment"># Add the item to the cart.</span></span><br></pre></td></tr></table></figure>

<p>Now, we‚Äôll update our <code>session cleanup</code> function to include <strong>deleting old shopping carts</strong> as   <code>clean_full_sessions()</code> in the next listing.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clean_full_sessions</span><span class="params">(conn)</span>:</span></span><br><span class="line">	<span class="keyword">while</span> <span class="keyword">not</span> QUIT:</span><br><span class="line">		size = conn.zcard(<span class="string">'recent:'</span>)</span><br><span class="line">		<span class="keyword">if</span> size &lt;= LIMIT:</span><br><span class="line">			time.sleep(<span class="number">1</span>)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			end_index = min(size - LIMIT, <span class="number">100</span>)</span><br><span class="line">			sessions = conn.zrange(<span class="string">'recent:'</span>, <span class="number">0</span>, end_index<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">			session_keys = []</span><br><span class="line">			<span class="keyword">for</span> sess <span class="keyword">in</span> sessions:</span><br><span class="line">				session_keys.append(<span class="string">'viewed:'</span> + sess)</span><br><span class="line">				session_keys.append(<span class="string">'cart:'</span> + sess)  <span class="comment"># The required added line to delete the shopping cart for old sessions.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			conn.delete(*session_keys)</span><br><span class="line">			conn.hdel(<span class="string">'login:'</span>, *sessions)</span><br><span class="line">			conn.zrem(<span class="string">'recent:'</span>, *sessions)</span><br></pre></td></tr></table></figure>

<p>We now have <strong>both sessions and the shopping cart stored in Redis</strong>, which helps to reduce request size, as well as allows the performing of statistical calculations on visitors to our site based on what items they looked at, what items ended up in their shopping carts, and what items they finally purchased.</p>
<h2 id="Webpage-Caching"><a href="#Webpage-Caching" class="headerlink" title="Webpage Caching"></a>Webpage Caching</h2><p>Caching is different from a cookie. While they both act as some kind of storage, <strong>cache is actually a part of computer memory</strong>, whereas <strong>cookie is just stored and used by web browsers</strong>. </p>
<p>In genearl, when a processor wants something (e.g. values(a,b) for doing an operation (a+b)), it <strong>first search in cache if cache have these values</strong> then processor will fetch values form cache (fetching values from cache is really fast), but if cache don‚Äôt have these values <strong>then it will search in RAM</strong> (fetching values from ram is faster than hdd,ssd but slower than cache) if ram don‚Äôt have <strong>then it will search in hhd or ssd</strong>.</p>
<p><strong>In the context of web services</strong>, this means that cache in general can deal with larger data pieces than cookies, so one common way of using it in web services is for <strong>storing static website contents</strong>. Since those static contenst don‚Äôt need to be dynamically generated upon every request, we can store most of the information in cache for <strong>faster browsing experience</strong>. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cache_request</span><span class="params">(conn, request)</span>:</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">not</span> can_cache(request):</span><br><span class="line">		<span class="keyword">return</span> callback(request)  <span class="comment"># calls the request back to generate the content</span></span><br><span class="line"></span><br><span class="line">	page_key = <span class="string">"cache:"</span> + hash_request(request)  <span class="comment"># hash the request for lookup and storing</span></span><br><span class="line">	</span><br><span class="line">	content = conn.get(pagekey)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> content <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># reached here means content is cachable but not stored in cache</span></span><br><span class="line"></span><br><span class="line">		content = callback(request) <span class="comment"># content not cached. calls the request back to generate the content</span></span><br><span class="line">		conn.setex(page_key, <span class="number">300</span>, content)  <span class="comment"># cache the content and set expire in 300 seconds</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> content</span><br></pre></td></tr></table></figure>

<h2 id="Database-row-caching"><a href="#Database-row-caching" class="headerlink" title="Database row caching"></a>Database row caching</h2><p>For a daily deal with inventory counts being reduced and affecting whether someone can buy the item, the site cannot be entirely cached. However, an easy solution would be caching <strong>but also remmeber updating that specific database row</strong>. This means that you can choose to update the <strong>cached row for that specific item every few seconds</strong>, if there are <strong>many buyers</strong>. But if the data doesn‚Äôt change often, or when back-ordered items are acceptable, it may make sense to only update the cache every minute.</p>
<p>This can be done via using two <code>ZSET</code>s, one called <code>delay:</code> that tells you how often you should update your database row, and another called <code>schedule:</code> which tells you when the database row has been last updated in your cache.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cache_rows</span><span class="params">(conn)</span>:</span>  <span class="comment"># this will be a daemon process</span></span><br><span class="line">	<span class="keyword">while</span> <span class="keyword">not</span> QUIT:</span><br><span class="line">		next = conn.zrange(<span class="string">'schedule:'</span>,<span class="number">0</span>,<span class="number">0</span>, withscores=TRUE)  <span class="comment"># this fetches the first/earliest item that we have updated, if there is</span></span><br><span class="line"></span><br><span class="line">		now = time.time()</span><br><span class="line">		<span class="keyword">if</span> next <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> next[<span class="number">0</span>][<span class="number">1</span>] &gt; now:  <span class="comment"># if there are no items in schedule: </span></span><br><span class="line">											  <span class="comment"># or time hasn't come yet for updating</span></span><br><span class="line">			time.sleep(<span class="number">0.05</span>)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			row_id = next[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">			delay = conn.zscore(<span class="string">'delay:'</span>, row_id)  <span class="comment"># delay also stores information on whether</span></span><br><span class="line">												   <span class="comment"># we should remove the item in the scheduling</span></span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span> delay &lt;= <span class="number">0</span>:</span><br><span class="line">				conn.zrem(<span class="string">'delay:'</span>, row_id)</span><br><span class="line">				conn.zrem(<span class="string">'schedule:'</span>, row_id)</span><br><span class="line">				conn.delete(<span class="string">'inv:'</span> + row_id)  </span><br><span class="line">			<span class="keyword">else</span>:  <span class="comment"># now we need to handle the cache updating</span></span><br><span class="line"></span><br><span class="line">				d_row = Inventory.get(row_id)  <span class="comment"># gets the database row</span></span><br><span class="line"></span><br><span class="line">				conn.zadd(<span class="string">'schedule:'</span>, row_id, now+delay)  <span class="comment"># re-schedule the item for update</span></span><br><span class="line">				</span><br><span class="line">				conn.set(<span class="string">'inv:`+row_id, json.dumps(row.to_dict()))  # updates the cache with the latest database row</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">def add_schedule_row_cache(conn, row_id, delay):</span></span><br><span class="line"><span class="string">	conn.zadd('</span>delay:<span class="string">', row_id, delay)  # adds the item and tells how often it should be updated</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	conn.zadd('</span>schedule:<span class="string">', row_id, time.time())  # adds the item with the time it was placed in cache</span></span><br></pre></td></tr></table></figure>

<h2 id="Simple-Webpage-Analytics"><a href="#Simple-Webpage-Analytics" class="headerlink" title="Simple Webpage Analytics"></a>Simple Webpage Analytics</h2><p>In the previous examples, we were able to cache webpage contents. However, we did not limit how much pages should be cached, as we did not specify the <code>can_cache()</code> function yet. But what would be a sensible way to <strong>decide which webpage should be cached and which one shouldn‚Äôt</strong>? </p>
<p>A simple idea is to only include (for example) 10,000 webpages that has items you are browing the most often. For the other webpages with items that you browse only occaasionally, you do not store them in cache. However, you also need to be able to include possible new trending items, so you cannot just simply discard all items below the 10,000 limit. One solution you could use is to <strong>rescale the view counts of the top 10,000 items you viewed to be half</strong> has much as they were before.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rescale_viewed</span><span class="params">(conn)</span>:</span></span><br><span class="line">	<span class="keyword">while</span> <span class="keyword">not</span> QUIT:</span><br><span class="line">		conn.zremrangebyrank(<span class="string">'viewed:'</span>, <span class="number">20000</span>, <span class="number">-1</span>)  <span class="comment"># Remove any item not in the top 20,000 viewed items.</span></span><br><span class="line"></span><br><span class="line">		conn.zinterstore(<span class="string">'viewed:'</span>, &#123;<span class="string">'viewed:'</span>: <span class="number">.5</span>&#125;)  <span class="comment"># Rescale all counts to be 1/2 of what they were before.</span></span><br><span class="line"></span><br><span class="line">		time.sleep(<span class="number">300</span>)  <span class="comment"># Do it again in 5 minutes.</span></span><br></pre></td></tr></table></figure>
<p>where the line:</p>
<ul>
<li><code>conn.zinterstore(&#39;viewed:&#39;, {&#39;viewed:&#39;: .5})</code>, the function <code>ZINTERSTORE</code> lets us combine one or more <code>ZSET</code>s and <strong>multiply every score in the input <code>ZSET</code>s by a given number</strong>. (Each input <code>ZSET</code> can be multiplied by a different number.)</li>
</ul>
<p>Now, one sensible way to call this function is to place it in the place where you kept a reference to every item visited when you do login and shopping cart info storing. So you can place it in here:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update_token</span><span class="params">(conn, token, user, item=None)</span>:</span></span><br><span class="line">	timestamp = time.time()</span><br><span class="line">	conn.hset(<span class="string">'login:'</span>, token, user)</span><br><span class="line">	conn.zadd(<span class="string">'recent:'</span>, token, timestamp)</span><br><span class="line">	<span class="keyword">if</span> item <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">		conn.zadd(<span class="string">'viewed:'</span> + token, item, timestamp)</span><br><span class="line">		conn.zremrangebyrank(<span class="string">'viewed:'</span> + token, <span class="number">0</span>, <span class="number">-26</span>)</span><br><span class="line"></span><br><span class="line">		conn.zincrby(<span class="string">'viewed:'</span>, item, <span class="number">-1</span>)  <span class="comment"># the added line, move the item forward if viewed again</span></span><br></pre></td></tr></table></figure>

<p>With the <code>rescaling</code> and the <code>counting</code>, we now have a <strong>constantly updated list of the most-frequently viewed items</strong>. Now all we need to do is to specify our <code>can_cache()</code> function to take into consideration our new method of deciding whether a page can be cached, and we‚Äôre done:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">can_cache</span><span class="params">(conn, request)</span>:</span></span><br><span class="line">	item_id = extract_item_id(request)  <span class="comment"># Get the item ID for the page, if any.</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> item_id <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">or</span> is_dynamic(request):  <span class="comment"># Check whether the page can be statically cached and whether this is an item page.</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">	rank = conn.zrank(<span class="string">'viewed:'</span>, item_id)  <span class="comment"># Get the rank of the item.</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> rank <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> rank &lt; <span class="number">10000</span>  <span class="comment"># Return whether the item has a high enough view count to be cached.</span></span><br></pre></td></tr></table></figure>

<h2 id="Strings-in-Redis"><a href="#Strings-in-Redis" class="headerlink" title="Strings in Redis"></a><code>String</code>s in Redis</h2><p>In this section, we‚Äôll talk about the simplest structure available to Redis, the STRING. This builds on the section <a href="#String-Basics"><code>String</code>s in Redis - Basics</a>, and here it covers the basic <strong>numeric increment and decrement operations</strong>, followed later by the <strong>bit and substring manipulation</strong> calls, and you‚Äôll come to understand that even the simplest of structures has a few surprises that can make it useful in a variety of powerful ways.</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Example use and description</th>
</tr>
</thead>
<tbody><tr>
<td><code>INCR</code></td>
<td><code>INCR key-name</code> ‚Äî Increments the value stored at the key <strong>by 1</strong></td>
</tr>
<tr>
<td><code>DECR</code></td>
<td><code>DECR key-name</code> ‚Äî Decrements the value stored at the key <strong>by 1</strong></td>
</tr>
<tr>
<td><code>INCRBY</code></td>
<td><code>INCRBY key-name amount</code> ‚Äî Increments the value stored at the key <strong>by the provided integer value</strong></td>
</tr>
<tr>
<td><code>DECRBY</code></td>
<td><code>DECRBY key-name amount</code> ‚Äî Decrements the value stored at the key <strong>by the provided integer value</strong></td>
</tr>
<tr>
<td><code>INCRBYFLOAT</code></td>
<td><code>INCRBYFLOAT key-name amount</code> ‚Äî Increments the value stored at the key <strong>by the provided float value</strong> (available in Redis 2.6 and later)</td>
</tr>
</tbody></table>
<p>This means that, when setting a <code>STRING</code> value in Redis, if that <strong>value could be interpreted as a base-10 integer or a floating-point value</strong>, Redis will detect this and <strong>allow you to manipulate the value using the various <code>INCR*</code> and <code>DECR*</code> operations</strong>. So, if you try to <strong>increment or decrement</strong> a key that has a value that <strong>can‚Äôt be interpreted as an integer or float</strong>, you‚Äôll receive <strong>an error</strong>.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> If you try to <strong>increment or decrement a key that doesn‚Äôt exist or is an empty string</strong>, Redis will operate as though that <strong>key‚Äôs value were zero</strong>. </li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> redis; conn=redis.Redis(host=<span class="string">'cust-redis'</span>,port=<span class="number">6379</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.get(<span class="string">'new-key'</span>)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.incr(<span class="string">'new-key'</span>)  <span class="comment"># incrementing a non-existant key by 1</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.incr(<span class="string">'new-key-2'</span>)  <span class="comment"># incrementing a non-existant key by </span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.get(<span class="string">'new-key-2'</span>)</span><br><span class="line"><span class="string">b'1'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.incr(<span class="string">'new-key'</span>,<span class="number">10</span>)  <span class="comment"># python implemented to have the option of passing in a value</span></span><br><span class="line"><span class="number">11</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.incrby(<span class="string">'new-key'</span>,<span class="number">10</span>)</span><br><span class="line"><span class="number">21</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.decr(<span class="string">'new-key'</span>,<span class="number">10</span>)</span><br><span class="line"><span class="number">11</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.decrby(<span class="string">'new-key'</span>,<span class="number">10</span>)</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.set(<span class="string">'new-key'</span>,<span class="number">10</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.get(<span class="string">'new-key'</span>)</span><br><span class="line"><span class="string">b'10'</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> You see those <code>b</code> in front of the result string because these data are <strong>byte literal</strong>s instead of <strong>String</strong> objects. Therefore, to <strong>get rid of the <code>b</code></strong>, you can <strong>add the method <code>decode(&#39;utf8&#39;)</code> to the end</strong>.</li>
</ul>
</blockquote>
<p>Redis additionally offers methods for <strong>reading and writing parts of byte string values</strong> (integer and float values can also be accessed as though they‚Äôre byte strings, though that use is somewhat uncommon).</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Example use and description</th>
</tr>
</thead>
<tbody><tr>
<td><code>APPEND</code></td>
<td><code>APPEND key-name value</code> ‚Äî Concatenates the provided value to the string already stored at the given key</td>
</tr>
<tr>
<td><code>GETRANGE</code></td>
<td><code>GETRANGE key-name start end</code> ‚Äî Fetches the substring, including all characters from the start offset to the end offset, inclusive</td>
</tr>
<tr>
<td><code>SETRANGE</code></td>
<td><code>SETRANGE key-name offset value</code> ‚Äî Sets the substring starting at the provided offset to the given value</td>
</tr>
<tr>
<td><code>GETBIT</code></td>
<td><code>GETBIT key-name offset</code> ‚Äî Treats the byte string as a bit string, and returns the value of the bit in the string at the provided bit offset</td>
</tr>
<tr>
<td><code>SETBIT</code></td>
<td><code>SETBIT key-name offset value</code> ‚Äî Treats the byte string as a bit string, and sets the value of the bit in the string at the provided bit offset</td>
</tr>
<tr>
<td><code>BITCOUNT</code></td>
<td><code>BITCOUNT key-name [start end]</code> ‚Äî Counts the number of 1 bits in the string, optionally starting and finishing at the provided byte offsets</td>
</tr>
<tr>
<td><code>BITOP</code></td>
<td><code>BITOP operation dest-key key-name [key-name ‚Ä¶]</code> ‚Äî Performs one of the bitwise operations, AND, OR, XOR, or NOT, on the strings provided, storing the result in the destination key</td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.append(<span class="string">'new-string-key'</span>, <span class="string">'hello '</span>)  <span class="comment"># append the string ‚Äòhello ‚Äô to the previously nonexistent key </span></span><br><span class="line"><span class="number">6L</span>  <span class="comment"># When appending a value, Redis returns the length of the string so far.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.append(<span class="string">'new-string-key'</span>, <span class="string">'world!'</span>)</span><br><span class="line"><span class="number">12L</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.substr(<span class="string">'new-string-key'</span>, <span class="number">3</span>, <span class="number">7</span>)  <span class="comment"># Redis uses 0-indexing. It is inclusive of the endpoints by default.</span></span><br><span class="line"><span class="string">'lo wo'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.setrange(<span class="string">'new-string-key'</span>, <span class="number">0</span>, <span class="string">'H'</span>)  <span class="comment"># Sets the 0th char to 'H'</span></span><br><span class="line"><span class="number">12</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.setrange(<span class="string">'new-string-key'</span>, <span class="number">6</span>, <span class="string">'W'</span>)</span><br><span class="line"><span class="number">12</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.get(<span class="string">'new-string-key'</span>)</span><br><span class="line"><span class="string">'Hello World!'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.setrange(<span class="string">'new-string-key'</span>, <span class="number">11</span>, <span class="string">', how are you?'</span>)  <span class="comment"># With setrange, we can replace anywhere inside the string</span></span><br><span class="line">                                                           <span class="comment"># and we can make the string longer as a result</span></span><br><span class="line"><span class="number">25</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.get(<span class="string">'new-string-key'</span>)</span><br><span class="line"><span class="string">'Hello World, how are you?'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.setbit(<span class="string">'another-key'</span>, <span class="number">2</span>, <span class="number">1</span>)  <span class="comment"># If we write to a bit beyond the size of the string, it‚Äôs filled with 0s.</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.setbit(<span class="string">'another-key'</span>, <span class="number">7</span>, <span class="number">1</span>)</span><br><span class="line"><span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.get(<span class="string">'another-key'</span>)  <span class="comment"># If you want to interpret the bits stored in Redis</span></span><br><span class="line">                             <span class="comment"># you have 0010 0001, which is '!' in ASCII</span></span><br><span class="line"><span class="string">'!'</span></span><br></pre></td></tr></table></figure>

<h2 id="Lists-in-Redis"><a href="#Lists-in-Redis" class="headerlink" title="Lists in Redis"></a><code>List</code>s in Redis</h2><p>In this section, we‚Äôll talk about <code>LIST</code>s, which store an ordered sequence of <code>STRING</code> values. This builds on from the section <a href="#List-Basics"><code>List</code>s in Redis - Basics</a>. We‚Äôll cover some of the most commonly used <code>LIST</code> manipulation commands for pushing and popping items from <code>LIST</code>s. </p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Example use and description</th>
</tr>
</thead>
<tbody><tr>
<td><code>RPUSH</code></td>
<td><code>RPUSH key-name value [value ‚Ä¶]</code> ‚Äî Pushes the value(s) onto the <strong>right end</strong> of the list</td>
</tr>
<tr>
<td><code>LPUSH</code></td>
<td><code>LPUSH key-name value [value ‚Ä¶]</code> ‚Äî Pushes the value(s) onto the <strong>left end</strong> of the list</td>
</tr>
<tr>
<td><code>RPOP</code></td>
<td><code>RPOP key-name</code> ‚Äî Removes and returns the <strong>rightmost</strong> item from the list</td>
</tr>
<tr>
<td><code>LPOP</code></td>
<td><code>LPOP key-name</code> ‚Äî Removes and returns the <strong>leftmost</strong> item from the list</td>
</tr>
<tr>
<td><code>LINDEX</code></td>
<td><code>LINDEX key-name offset</code> ‚Äî Returns the item at the given offset/index</td>
</tr>
<tr>
<td><code>LRANGE</code></td>
<td><code>LRANGE key-name start end</code> ‚Äî Returns the items in the list at the offsets from start to end, <strong>inclusive</strong></td>
</tr>
<tr>
<td><code>LTRIM</code></td>
<td><code>LTRIM key-name start end</code> ‚Äî Trims the list to <strong>only include items at indices between start and end</strong>, <strong>inclusive</strong></td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.rpush(<span class="string">'list-key'</span>, <span class="string">'last'</span>)</span><br><span class="line"><span class="number">1L</span>  <span class="comment"># When we push items onto the list, it returns the length of the list after the push has completed.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.lpush(<span class="string">'list-key'</span>, <span class="string">'first'</span>)</span><br><span class="line"><span class="number">2L</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.rpush(<span class="string">'list-key'</span>, <span class="string">'new last'</span>)</span><br><span class="line"><span class="number">3L</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.lrange(<span class="string">'list-key'</span>, <span class="number">0</span>, <span class="number">-1</span>)</span><br><span class="line">[<span class="string">'first'</span>, <span class="string">'last'</span>, <span class="string">'new last'</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.lpop(<span class="string">'list-key'</span>)</span><br><span class="line"><span class="string">'first'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.lpop(<span class="string">'list-key'</span>)</span><br><span class="line"><span class="string">'last'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.lrange(<span class="string">'list-key'</span>, <span class="number">0</span>, <span class="number">-1</span>)</span><br><span class="line">[<span class="string">'new last'</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.rpush(<span class="string">'list-key'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>)  <span class="comment"># We can push multiple items at the same time.</span></span><br><span class="line"><span class="number">4L</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.lrange(<span class="string">'list-key'</span>, <span class="number">0</span>, <span class="number">-1</span>)</span><br><span class="line">[<span class="string">'new last'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.ltrim(<span class="string">'list-key'</span>, <span class="number">2</span>, <span class="number">-1</span>)  <span class="comment"># Only keep elements from the 2nd position to the last</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.lrange(<span class="string">'list-key'</span>, <span class="number">0</span>, <span class="number">-1</span>)</span><br><span class="line">[<span class="string">'b'</span>, <span class="string">'c'</span>]</span><br></pre></td></tr></table></figure>

<p>Among the <code>LIST</code> commands we didn‚Äôt introduce before are a few commands that allow you to <strong>move items from one list to another</strong>, and even <strong>block while waiting for other clients to add items</strong> to <code>LIST</code>s. </p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Example use and description</th>
</tr>
</thead>
<tbody><tr>
<td><code>BLPOP</code></td>
<td><code>BLPOP key-name [key-name ‚Ä¶] timeout</code> ‚Äî Pops the leftmost item from the first non-empty LIST, or waits the timeout in seconds for an item</td>
</tr>
<tr>
<td><code>BRPOP</code></td>
<td><code>BRPOP key-name [key-name ‚Ä¶] timeout</code> ‚Äî Pops the rightmost item from the first non-empty LIST, or waits the timeout in seconds for an item</td>
</tr>
<tr>
<td><code>RPOPLPUSH</code></td>
<td><code>RPOPLPUSH source-key dest-key</code> ‚Äî Pops the rightmost item from the source and LPUSHes the item to the destination, also returning the item to the user</td>
</tr>
<tr>
<td><code>BRPOPLPUSH</code></td>
<td><code>BRPOPLPUSH source-key dest-key timeout</code> ‚Äî Pops the rightmost item from the source and LPUSHes the item to the destination, also returning the item to the user, and waiting up to the timeout if the source is empty</td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Let‚Äôs add some items to a couple of lists to start.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.rpush(<span class="string">'list'</span>, <span class="string">'item1'</span>)</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.rpush(<span class="string">'list'</span>, <span class="string">'item2'</span>)</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.rpush(<span class="string">'list2'</span>, <span class="string">'item3'</span>)</span><br><span class="line"><span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.brpoplpush(<span class="string">'list2'</span>, <span class="string">'list'</span>, <span class="number">1</span>)  <span class="comment"># move an item from one list to the other, also returning the item.</span></span><br><span class="line"><span class="string">'item3'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.brpoplpush(<span class="string">'list2'</span>, <span class="string">'list'</span>, <span class="number">1</span>)  <span class="comment"># When a list is empty, the blocking pop will stall for the timeout, </span></span><br><span class="line">                                         <span class="comment"># and return None (which isn‚Äôt displayed in the interactive console).</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.lrange(<span class="string">'list'</span>, <span class="number">0</span>, <span class="number">-1</span>)</span><br><span class="line">[<span class="string">'item3'</span>, <span class="string">'item1'</span>, <span class="string">'item2'</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.brpoplpush(<span class="string">'list'</span>, <span class="string">'list2'</span>, <span class="number">1</span>)</span><br><span class="line"><span class="string">'item2'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.blpop([<span class="string">'list'</span>, <span class="string">'list2'</span>], <span class="number">1</span>)</span><br><span class="line">(<span class="string">'list'</span>, <span class="string">'item3'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.blpop([<span class="string">'list'</span>, <span class="string">'list2'</span>], <span class="number">1</span>)</span><br><span class="line">(<span class="string">'list'</span>, <span class="string">'item1'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.blpop([<span class="string">'list'</span>, <span class="string">'list2'</span>], <span class="number">1</span>)</span><br><span class="line">(<span class="string">'list2'</span>, <span class="string">'item2'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.blpop([<span class="string">'list'</span>, <span class="string">'list2'</span>], <span class="number">1</span>) <span class="comment"># block for 1 second until this operation is completed</span></span><br><span class="line">(<span class="number">1.02</span>s)  </span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Sets-in-Redis"><a href="#Sets-in-Redis" class="headerlink" title="Sets in Redis"></a><code>Set</code>s in Redis</h2><p>In this section, we‚Äôll discuss some of the most frequently used commands that operate on <code>SET</code>s. This builds on from the section <a href="#Set-Basics"><code>Set</code>s in Redis - Basics</a>. You‚Äôll learn about the standard operations for inserting, removing, and moving members between <code>SET</code>s, as well as commands to perform intersection, union, and differences on <code>SET</code>s. </p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Example use and description</th>
</tr>
</thead>
<tbody><tr>
<td><code>SADD</code></td>
<td><code>SADD key-name item [item ‚Ä¶]</code> ‚Äî Adds the items to the set and returns the number of items added that weren‚Äôt already present</td>
</tr>
<tr>
<td><code>SREM</code></td>
<td><code>SREM key-name item [item ‚Ä¶]</code> ‚Äî Removes the items and returns the number of items that were removed</td>
</tr>
<tr>
<td><code>SISMEMBER</code></td>
<td><code>SISMEMBER key-name item</code> ‚Äî Returns whether the item is in the SET</td>
</tr>
<tr>
<td><code>SCARD</code></td>
<td><code>SCARD key-name</code> ‚Äî Returns the number of items in the SET</td>
</tr>
<tr>
<td><code>SMEMBERS</code></td>
<td><code>SMEMBERS key-name</code> ‚Äî Returns all of the items in the SET as a Python set</td>
</tr>
<tr>
<td><code>SRANDMEMBER</code></td>
<td><code>SRANDMEMBER key-name [count]</code> ‚Äî Returns one or more random items from the SET. When count is positive, Redis will return count distinct randomly chosen items, and when count is negative, Redis will return count randomly chosen items that may not be distinct.</td>
</tr>
<tr>
<td><code>SPOP</code></td>
<td><code>SPOP key-name</code> ‚Äî Removes and returns a random item from the SET</td>
</tr>
<tr>
<td><code>SMOVE</code></td>
<td><code>SMOVE source-key dest-key item</code> ‚Äî If the item is in the source, removes the item from the source and adds it to the destination, returning if the item was moved</td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.sadd(<span class="string">'set-key'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>)</span><br><span class="line"><span class="number">3</span>  <span class="comment"># Adding items to the SET returns the number of items that weren‚Äôt already in the SET.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.srem(<span class="string">'set-key'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.srem(<span class="string">'set-key'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>)</span><br><span class="line"><span class="literal">False</span>  <span class="comment"># Removing items from the SET returns whether an item was removed; </span></span><br><span class="line">       <span class="comment"># note that the client is buggy in that respect ‚Äî Redis itself returns the total number of items removed.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.scard(<span class="string">'set-key'</span>)  <span class="comment"># We can get the number of items in the SET.</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.smembers(<span class="string">'set-key'</span>)</span><br><span class="line">set([<span class="string">'a'</span>, <span class="string">'b'</span>])</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.smove(<span class="string">'set-key'</span>, <span class="string">'set-key2'</span>, <span class="string">'a'</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.smove(<span class="string">'set-key'</span>, <span class="string">'set-key2'</span>, <span class="string">'c'</span>)</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.smembers(<span class="string">'set-key2'</span>)</span><br><span class="line">set([<span class="string">'a'</span>])</span><br></pre></td></tr></table></figure>

<h2 id="Hashes-in-Redis"><a href="#Hashes-in-Redis" class="headerlink" title="Hashes in Redis"></a><code>Hash</code>es in Redis</h2><p>In this section, we‚Äôll talk about the most commonly used commands that manipulate <code>HASH</code>es. This builds on fro the section <a href="#Hash-Basics"><code>Hash</code>es in Redis - Basics</a>. You‚Äôll learn more about the operations for adding and removing key-value pairs to <code>HASH</code>es, as well as commands to fetch all of the <code>HASH</code> contents along with the ability to increment or decrement values.</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Example use and description</th>
</tr>
</thead>
<tbody><tr>
<td><code>HMGET</code></td>
<td><code>HMGET key-name key [key ‚Ä¶]</code> ‚Äî Fetches the values at the fields/keys in the HASH</td>
</tr>
<tr>
<td><code>HMSET</code></td>
<td><code>HMSET key-name key value [key value ‚Ä¶]</code> ‚Äî Sets the values of the fields in the HASH</td>
</tr>
<tr>
<td><code>HDEL</code></td>
<td><code>HDEL key-name key [key ‚Ä¶]</code> ‚Äî Deletes the key-value pairs in the HASH, returning the number of pairs that were found and deleted</td>
</tr>
<tr>
<td><code>HLEN</code></td>
<td><code>HLEN key-name</code> ‚Äî Returns the number of key-value pairs in the HASH</td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.hmset(<span class="string">'hash-key'</span>, &#123;<span class="string">'k1'</span>:<span class="string">'v1'</span>, <span class="string">'k2'</span>:<span class="string">'v2'</span>, <span class="string">'k3'</span>:<span class="string">'v3'</span>&#125;)</span><br><span class="line"><span class="literal">True</span>  <span class="comment"># We can add multiple items to the hash in one call.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.hmget(<span class="string">'hash-key'</span>, [<span class="string">'k2'</span>, <span class="string">'k3'</span>])</span><br><span class="line">[<span class="string">'v2'</span>, <span class="string">'v3'</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.hlen(<span class="string">'hash-key'</span>)</span><br><span class="line"><span class="number">3</span>  <span class="comment"># The HLEN command is typically used for debugging very large HASHes.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.hdel(<span class="string">'hash-key'</span>, <span class="string">'k1'</span>, <span class="string">'k3'</span>)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> The <code>HMGET</code>/<code>HMSET</code> commands are similar to their single-argument versions (<code>HSET</code>/<code>HGET</code>), only differing in that they <strong>take a list or dictionary for arguments</strong> instead of the single entries.</li>
</ul>
</blockquote>
<p>With the availability of <code>HGETALL</code>, it may not seem as though <code>HKEYS</code> and <code>HVALUES</code> would be that useful, but when you expect your values to be large, you can fetch the keys, and then get the values one by one to keep from blocking other requests.</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Example use and description</th>
</tr>
</thead>
<tbody><tr>
<td><code>HEXISTS</code></td>
<td><code>HEXISTS key-name key</code> ‚Äî Returns whether the given key exists in the HASH</td>
</tr>
<tr>
<td><code>HKEYS</code></td>
<td><code>HKEYS key-name</code> ‚Äî Fetches the keys in the HASH</td>
</tr>
<tr>
<td><code>HVALS</code></td>
<td><code>HVALS key-name</code> ‚Äî Fetches the values in the HASH</td>
</tr>
<tr>
<td><code>HGETALL</code></td>
<td><code>HGETALL key-name</code> ‚Äî Fetches all key-value pairs from the HASH</td>
</tr>
<tr>
<td><code>HINCRBY</code></td>
<td><code>HINCRBY key-name key increment</code> ‚Äî Increments the value stored at the given key by the integer increment</td>
</tr>
<tr>
<td><code>HINCRBYFLOAT</code></td>
<td><code>HINCRBYFLOAT key-name key increment</code> ‚Äî Increments the value stored at the given key by the float increment</td>
</tr>
</tbody></table>
<p><code>HINCRBY</code> and <code>HINCRBYFLOAT</code> should remind you of the <code>INCRBY</code> and <code>INCRBYFLOAT</code> operations available on <code>STRING</code> keys, and they have the same semantics, applied to <code>HASH</code> values.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.hmset(<span class="string">'hash-key2'</span>, &#123;<span class="string">'short'</span>:<span class="string">'hello'</span>, <span class="string">'long'</span>:<span class="number">1000</span>*<span class="string">'1'</span>&#125;)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.hkeys(<span class="string">'hash-key2'</span>)</span><br><span class="line">[<span class="string">'long'</span>, <span class="string">'short'</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.hexists(<span class="string">'hash-key2'</span>, <span class="string">'num'</span>)</span><br><span class="line"><span class="literal">False</span>  <span class="comment"># We can also check the existence of specific keys.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.hincrby(<span class="string">'hash-key2'</span>, <span class="string">'num'</span>)  <span class="comment"># Incrementing a previously nonexistent key in a hash behaves just like on strings; </span></span><br><span class="line">                                      <span class="comment"># Redis operates as though the value had been 0.</span></span><br><span class="line"><span class="number">1L</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.hexists(<span class="string">'hash-key2'</span>, <span class="string">'num'</span>)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>

<h2 id="ZSets-in-Redis"><a href="#ZSets-in-Redis" class="headerlink" title="ZSets in Redis"></a><code>ZSet</code>s in Redis</h2><p>In this section, we‚Äôll talk about commands that operate on <code>ZSET</code>s. This builds on from the section <a href="#ZSet-Basics"><code>ZSet</code>s in Redis - Basics</a>. You‚Äôll learn how to add and update items in <code>ZSET</code>s, as well as how to use the <code>ZSET</code> intersection and union commands.</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Example use and description</th>
</tr>
</thead>
<tbody><tr>
<td><code>ZADD</code></td>
<td><code>ZADD key-name score member [score member ‚Ä¶]</code> ‚Äî Adds members with the given scores to the ZSET</td>
</tr>
<tr>
<td><code>ZREM</code></td>
<td><code>ZREM key-name member [member ‚Ä¶]</code> ‚Äî Removes the members from the ZSET, returning the number of members that were removed</td>
</tr>
<tr>
<td><code>ZCARD</code></td>
<td><code>ZCARD key-name</code> ‚Äî Returns the number of members in the ZSET</td>
</tr>
<tr>
<td><code>ZINCRBY</code></td>
<td><code>ZINCRBY key-name increment member</code> ‚Äî Increments the member in the ZSET</td>
</tr>
<tr>
<td><code>ZCOUNT</code></td>
<td><code>ZCOUNT key-name min max</code> ‚Äî Returns the <strong>number of members</strong> with <strong>scores between the provided minimum and maximum</strong></td>
</tr>
<tr>
<td><code>ZRANK</code></td>
<td><code>ZRANK key-name member</code> ‚Äî Returns the <strong>position of the given member</strong> in the ZSET</td>
</tr>
<tr>
<td><code>ZSCORE</code></td>
<td><code>ZSCORE key-name member</code> ‚Äî Returns the score of the member in the ZSET</td>
</tr>
<tr>
<td><code>ZRANGE</code></td>
<td><code>ZRANGE key-name start stop [WITHSCORES]</code> ‚Äî Returns the members and optionally the scores for the <strong>members with ranks between start and stop</strong></td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.zadd(<span class="string">'zset-key'</span>, <span class="string">'a'</span>, <span class="number">3</span>, <span class="string">'b'</span>, <span class="number">2</span>, <span class="string">'c'</span>, <span class="number">1</span>)  <span class="comment"># Adding members to ZSETs in Python has the arguments </span></span><br><span class="line">                                                   <span class="comment"># reversed compared to standard Redis, which makes the order the same as HASHes.</span></span><br><span class="line"><span class="number">3</span>  </span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.zcard(<span class="string">'zset-key'</span>)</span><br><span class="line"><span class="number">3</span>  <span class="comment"># Knowing how large a ZSET is can tell us in some cases if it‚Äôs necessary to trim our ZSET.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.zincrby(<span class="string">'zset-key'</span>, <span class="string">'c'</span>, <span class="number">3</span>)</span><br><span class="line"><span class="number">4.0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.zscore(<span class="string">'zset-key'</span>, <span class="string">'b'</span>)</span><br><span class="line"><span class="number">2.0</span>  <span class="comment"># Fetching scores of individual members can be useful if we‚Äôve been keeping counters or toplists.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.zrank(<span class="string">'zset-key'</span>, <span class="string">'c'</span>)</span><br><span class="line"><span class="number">2</span>  <span class="comment"># By fetching the 0-indexed position of a member, we can then later use ZRANGE to fetch a range of the values easily.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.zcount(<span class="string">'zset-key'</span>, <span class="number">0</span>, <span class="number">3</span>)</span><br><span class="line"><span class="number">2L</span>  <span class="comment"># Counting the number of items with a given range of scores can be quite useful for some tasks.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.zrem(<span class="string">'zset-key'</span>, <span class="string">'b'</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.zrange(<span class="string">'zset-key'</span>, <span class="number">0</span>, <span class="number">-1</span>, withscores=<span class="literal">True</span>)</span><br><span class="line">[(<span class="string">'a'</span>, <span class="number">3.0</span>), (<span class="string">'c'</span>, <span class="number">4.0</span>)]</span><br></pre></td></tr></table></figure>

<p>For <strong>debugging</strong>, we usually fetch the entire <code>ZSET</code> with this <code>ZRANGE</code> call, but real use cases will usually fetch items a relatively small group at a time.</p>
<p>Below shows several more <code>ZSET</code> commands in Redis that you‚Äôll find useful.</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Example use and description</th>
</tr>
</thead>
<tbody><tr>
<td><code>ZREVRANK</code></td>
<td><code>ZREVRANK key-name member</code> ‚Äî Returns the position of the member in the ZSET, with members ordered in reverse</td>
</tr>
<tr>
<td><code>ZREVRANGE</code></td>
<td><code>ZREVRANGE key-name start stop [WITHSCORES]</code> ‚Äî Fetches the given members from the ZSET by rank, with members in reverse order</td>
</tr>
<tr>
<td><code>ZRANGEBYSCORE</code></td>
<td><code>ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT offset count]</code> ‚Äî Fetches the <strong>members between min and max</strong></td>
</tr>
<tr>
<td><code>ZREVRANGEBYSCORE</code></td>
<td><code>ZREVRANGEBYSCORE key max min [WITHSCORES] [LIMIT offset count]</code> ‚Äî Fetches the members in reverse order between min and max</td>
</tr>
<tr>
<td><code>ZREMRANGEBYRANK</code></td>
<td><code>ZREMRANGEBYRANK key-name start stop</code> ‚Äî Removes the items from the ZSET with ranks between start and stop</td>
</tr>
<tr>
<td><code>ZREMRANGEBYSCORE</code></td>
<td><code>ZREMRANGEBYSCORE key-name min max</code> ‚Äî Removes the items from the ZSET with scores between min and max</td>
</tr>
<tr>
<td><code>ZINTERSTORE</code></td>
<td><code>ZINTERSTORE dest-key key-count key [key ‚Ä¶] [WEIGHTS weight [weight ‚Ä¶]]</code> ‚Äî Performs a SET-like intersection of the provided ZSETs</td>
</tr>
<tr>
<td><code>ZUNIONSTORE</code></td>
<td><code>ZUNIONSTORE dest-key key-count key [key ‚Ä¶] [WEIGHTS weight [weight ‚Ä¶]]</code> ‚Äî Performs a SET-like union of the provided ZSETs</td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># We‚Äôll start out by creating a couple of ZSETs.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.zadd(<span class="string">'zset-1'</span>, <span class="string">'a'</span>, <span class="number">1</span>, <span class="string">'b'</span>, <span class="number">2</span>, <span class="string">'c'</span>, <span class="number">3</span>)</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.zadd(<span class="string">'zset-2'</span>, <span class="string">'b'</span>, <span class="number">4</span>, <span class="string">'c'</span>, <span class="number">1</span>, <span class="string">'d'</span>, <span class="number">0</span>)</span><br><span class="line"><span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.zinterstore(<span class="string">'zset-i'</span>, [<span class="string">'zset-1'</span>, <span class="string">'zset-2'</span>])  <span class="comment"># When performing ZINTERSTORE or ZUNIONSTORE, our default aggregate is sum (which adds the value of the shared members)</span></span><br><span class="line"><span class="number">2L</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.zrange(<span class="string">'zset-i'</span>, <span class="number">0</span>, <span class="number">-1</span>, withscores=<span class="literal">True</span>)</span><br><span class="line">[(<span class="string">'c'</span>, <span class="number">4.0</span>), (<span class="string">'b'</span>, <span class="number">6.0</span>)]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.zunionstore(<span class="string">'zset-u'</span>, [<span class="string">'zset-1'</span>, <span class="string">'zset-2'</span>], aggregate=<span class="string">'min'</span>)  <span class="comment"># here we are using min, which selects the minimum of the shared members</span></span><br><span class="line"><span class="number">4L</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.zrange(<span class="string">'zset-u'</span>, <span class="number">0</span>, <span class="number">-1</span>, withscores=<span class="literal">True</span>)</span><br><span class="line">[(<span class="string">'d'</span>, <span class="number">0.0</span>), (<span class="string">'a'</span>, <span class="number">1.0</span>), (<span class="string">'c'</span>, <span class="number">1.0</span>), (<span class="string">'b'</span>, <span class="number">2.0</span>)]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.sadd(<span class="string">'set-1'</span>, <span class="string">'a'</span>, <span class="string">'d'</span>) </span><br><span class="line"><span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.zunionstore(<span class="string">'zset-u2'</span>, [<span class="string">'zset-1'</span>, <span class="string">'zset-2'</span>, <span class="string">'set-1'</span>]) </span><br><span class="line"><span class="number">4L</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.zrange(<span class="string">'zset-u2'</span>, <span class="number">0</span>, <span class="number">-1</span>, withscores=<span class="literal">True</span>)</span><br><span class="line">[(<span class="string">'d'</span>, <span class="number">1.0</span>), (<span class="string">'a'</span>, <span class="number">2.0</span>), (<span class="string">'c'</span>, <span class="number">4.0</span>), (<span class="string">'b'</span>, <span class="number">6.0</span>)]</span><br></pre></td></tr></table></figure>

<h2 id="Publish-Subscribe-in-Redis"><a href="#Publish-Subscribe-in-Redis" class="headerlink" title="Publish/Subscribe in Redis"></a><code>Publish</code>/<code>Subscribe</code> in Redis</h2><p> Generally, the concept of <code>publish</code>/<code>subscribe</code>, also known as <code>pub/sub</code>, is characterized by listeners subscribing to <code>channels</code>, with publishers sending binary string messages to <code>channels</code>. </p>
<ul>
<li>Anyone <strong>listening to a given channel will receive all messages sent to that channel</strong> while they‚Äôre connected and listening. You can think of it like a radio station, where subscribers can listen to multiple radio stations at the same time</li>
<li>Any publishers can <strong>send messages to a given channel</strong>, like being a radio station.</li>
</ul>
<table>
<thead>
<tr>
<th>Command</th>
<th>Example use and description</th>
</tr>
</thead>
<tbody><tr>
<td><code>SUBSCRIBE</code></td>
<td><code>SUBSCRIBE channel [channel ‚Ä¶]</code> ‚Äî Subscribes to the given channels</td>
</tr>
<tr>
<td><code>UNSUBSCRIBE</code></td>
<td><code>UNSUBSCRIBE [channel [channel ‚Ä¶]]</code> ‚Äî Unsubscribes from the provided channels, or unsubscribes all channels if no channel is given</td>
</tr>
<tr>
<td><code>PUBLISH</code></td>
<td><code>PUBLISH channel message</code> ‚Äî Publishes a message to the given channel</td>
</tr>
<tr>
<td><code>PSUBSCRIBE</code></td>
<td><code>PSUBSCRIBE pattern [pattern ‚Ä¶]</code> ‚Äî Subscribes to messages broadcast to channels that match the given pattern</td>
</tr>
<tr>
<td><code>PUNSUBSCRIBE</code></td>
<td><code>PUNSUBSCRIBE [pattern [pattern ‚Ä¶]]</code> ‚Äî Unsubscribes from the provided patterns, or unsubscribes from all subscribed patterns if none are given</td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">publisher</span><span class="params">(n)</span>:</span></span><br><span class="line">	time.sleep(<span class="number">1</span>)  <span class="comment"># We sleep initially in the function to let the SUBSCRIBEr connect and start listening for messages.</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> xrange(n):</span><br><span class="line">				conn.publish(<span class="string">'channel'</span>, i)</span><br><span class="line">				time.sleep(<span class="number">1</span>)  <span class="comment"># After publishing, we‚Äôll pause for a moment so that we can see this happen over time.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">run_pubsub</span><span class="params">()</span>:</span></span><br><span class="line">	threading.Thread(target=publisher, args=(<span class="number">3</span>,)).start()  <span class="comment"># start the publisher thread to send three messages.</span></span><br><span class="line"></span><br><span class="line">	pubsub = conn.pubsub()</span><br><span class="line">	pubsub.subscribe([<span class="string">'channel'</span>])  <span class="comment"># We‚Äôll set up the pubsub object and subscribe to a channel.</span></span><br><span class="line"></span><br><span class="line">	count = <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> item <span class="keyword">in</span> pubsub.listen():  <span class="comment"># listen to subscription messages by iterating over the result of pubsub.listen().</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">print</span> item  <span class="comment"># print every message that we receive.</span></span><br><span class="line"></span><br><span class="line">		count += <span class="number">1</span></span><br><span class="line">		<span class="keyword">if</span> count == <span class="number">4</span>:  <span class="comment"># We‚Äôll stop listening for new messages after the subscribe message and three real messages by unsubscribing.</span></span><br><span class="line">			pubsub.unsubscribe()</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>run_pubsub()  <span class="comment"># Actually run the functions to see them work.</span></span><br><span class="line"></span><br><span class="line">&#123;<span class="string">'pattern'</span>: <span class="literal">None</span>, <span class="string">'type'</span>: <span class="string">'subscribe'</span>, <span class="string">'channel'</span>: <span class="string">'channel'</span>, <span class="string">'data'</span>: <span class="number">1L</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># When subscribing, we receive a message on the channel.</span></span><br><span class="line"><span class="comment"># These are the structures that are produced as items when we iterate over pubsub.listen().</span></span><br><span class="line">&#123;<span class="string">'pattern'</span>: <span class="literal">None</span>, <span class="string">'type'</span>: <span class="string">'message'</span>, <span class="string">'channel'</span>: <span class="string">'channel'</span>, <span class="string">'data'</span>: <span class="string">'0'</span>&#125;</span><br><span class="line">&#123;<span class="string">'pattern'</span>: <span class="literal">None</span>, <span class="string">'type'</span>: <span class="string">'message'</span>, <span class="string">'channel'</span>: <span class="string">'channel'</span>, <span class="string">'data'</span>: <span class="string">'1'</span>&#125;</span><br><span class="line">&#123;<span class="string">'pattern'</span>: <span class="literal">None</span>, <span class="string">'type'</span>: <span class="string">'message'</span>, <span class="string">'channel'</span>: <span class="string">'channel'</span>, <span class="string">'data'</span>: <span class="string">'2'</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># When we unsubscribe, we receive a message telling us which channels we have unsubscribed from </span></span><br><span class="line"><span class="comment"># and also the number of channels we are still subscribed to.</span></span><br><span class="line">&#123;<span class="string">'pattern'</span>: <span class="literal">None</span>, <span class="string">'type'</span>: <span class="string">'unsubscribe'</span>, <span class="string">'channel'</span>: <span class="string">'channel'</span>, <span class="string">'data'</span>: <span class="number">0L</span>&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> But in the case of clients that have subscribed, <strong>if the client is disconnected and a message is sent before it can reconnect</strong>, the client will never see the message. When you‚Äôre relying on receiving messages over a channel, the semantics of <code>PUBLISH</code>/<code>SUBSCRIBE</code>in Redis may let you down.</li>
<li><input disabled type="checkbox"> However, there are different methods to handle reliable message delivery (you will see in a later section), which <strong>works in the face of network disconnections</strong>, and which won‚Äôt cause Redis memory to grow (even in older versions of Redis) unless you want it to.</li>
</ul>
</blockquote>
<h2 id="Operations-in-Redis-Sorting"><a href="#Operations-in-Redis-Sorting" class="headerlink" title="Operations in Redis - Sorting"></a>Operations in Redis - Sorting</h2><p>Sorting in Redis is similar to sorting in other languages: we want to <strong>take a sequence of items and order them according to some comparison between elements</strong>. <code>SORT</code> allows us to sort <code>LIST</code>s, <code>SET</code>s, and <code>ZSET</code>s according to data in the <code>LIST</code>/<code>SET</code>/<code>ZSET</code> data stored in <code>STRING</code> keys, or even data stored in <code>HASH</code>es. If you‚Äôre coming from a relational database background, <strong>you can think of <code>SORT</code> as like the <code>order by</code> clause in a SQL statement that can reference other rows and tables</strong>.</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Example use and description</th>
</tr>
</thead>
<tbody><tr>
<td><code>SORT</code></td>
<td><code>SORT source-key [BY pattern] [LIMIT offset count] [GET pattern [GET pattern ‚Ä¶]] ...</code> ‚Äî Sorts the input <code>LIST</code>, <code>SET</code>, or <code>ZSET</code> according to the options provided, and returns or stores the result</td>
</tr>
</tbody></table>
<p>Some of the more basic options with <code>SORT</code> include the ability to <strong>order the results in descending order rather than the default ascending order</strong>, consider <strong>items as though they were numbers</strong>, compare as though items were <strong>binary strings</strong>, and etc.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># Start by adding some items to a LIST.</span><br><span class="line">&gt;&gt;&gt; conn.rpush(&#39;sort-input&#39;, 23, 15, 110, 7)</span><br><span class="line">4</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; conn.sort(&#39;sort-input&#39;)  # We can sort the items numerically.</span><br><span class="line">[&#39;7&#39;, &#39;15&#39;, &#39;23&#39;, &#39;110&#39;]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; conn.sort(&#39;sort-input&#39;, alpha&#x3D;True)  # And we can sort the items alphabetically. In this case, sort each number character by character</span><br><span class="line">[&#39;110&#39;, &#39;15&#39;, &#39;23&#39;, &#39;7&#39;]  </span><br><span class="line"></span><br><span class="line"># Adding some additional data for SORTing and fetching.</span><br><span class="line">&gt;&gt;&gt; conn.hset(&#39;d-7&#39;, &#39;field&#39;, 5)</span><br><span class="line">1L</span><br><span class="line">&gt;&gt;&gt; conn.hset(&#39;d-15&#39;, &#39;field&#39;, 1)</span><br><span class="line">1L</span><br><span class="line">&gt;&gt;&gt; conn.hset(&#39;d-23&#39;, &#39;field&#39;, 9)</span><br><span class="line">1L</span><br><span class="line">&gt;&gt;&gt; conn.hset(&#39;d-110&#39;, &#39;field&#39;, 3)</span><br><span class="line">1L</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; conn.sort(&#39;sort-input&#39;, by&#x3D;&#39;d-*-&gt;field&#39;)  # We can sort our data by fields of HASHes.</span><br><span class="line">[&#39;15&#39;, &#39;110&#39;, &#39;7&#39;, &#39;23&#39;]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; conn.sort(&#39;sort-input&#39;, by&#x3D;&#39;d-*-&gt;field&#39;, get&#x3D;&#39;d-*-&gt;field&#39;)</span><br><span class="line">[&#39;1&#39;, &#39;3&#39;, &#39;5&#39;, &#39;9&#39;]</span><br></pre></td></tr></table></figure>

<p>Sorting can be used to sort <code>LIST</code>s, but it can also sort <code>SET</code>s, turning the result into a <code>LIST</code>.</p>
<p>Though <code>SORT</code> is the only command that can <strong>manipulate three types of data at the same time</strong>, <strong><a href="#Basic-Redis-Transactions">basic Redis transactions</a> can let you manipulate multiple data types with a series of commands without interruption</strong>.</p>
<p><a name="Basic-Redis-Transactions"></a></p>
<h2 id="Basic-Redis-Transactions"><a href="#Basic-Redis-Transactions" class="headerlink" title="Basic Redis Transactions"></a>Basic Redis Transactions</h2><p>Though there are a few commands to copy or move items between keys, there <strong>isn‚Äôt a single command to move items between types (though you can copy from a <code>SET</code> to a <code>ZSET</code> with <code>ZUNIONSTORE</code>)</strong>. For operations involving multiple keys (of the same or different types), Redis has five commands that help us operate on multiple keys without interruption: <code>WATCH</code>, <code>MULTI</code>, <code>EXEC</code>, <code>UNWATCH</code>, and <code>DISCARD</code>.</p>
<p>In Redis, a basic transaction involving MULTI and EXEC is meant to provide the opportunity for one client to execute multiple commands A, B, C, ‚Ä¶ without other clients being able to interrupt them. This isn‚Äôt the same as a relational database transaction, which can be executed partially, and then rolled back or committed. In Redis, every command passed as part of a basic MULTI/EXEC transaction is executed one after another until they‚Äôve completed. After they‚Äôve completed, other clients may execute their commands.</p>
<p><strong>To perform a transaction in Redis</strong>, we first call <code>MULTI</code>, followed by any sequence of commands we intend to execute, <strong>followed by <code>EXEC</code></strong>. When seeing <code>MULTI</code>, Redis will queue up commands from that same connection until it sees an <code>EXEC</code>, at which point Redis will execute the queued commands sequentially without interruption.</p>
<p>For example, in a <code>redis-cli</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get hello</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; set hello no</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; exec</span><br><span class="line">1) &quot;worldanother-world&quot;</span><br><span class="line">2) OK</span><br><span class="line">127.0.0.1:6379&gt; get hello</span><br><span class="line">&quot;no&quot;</span><br></pre></td></tr></table></figure>

<p>Semantically, <strong><code>Python library</code> handles this by the use of what‚Äôs called a <code>pipeline</code></strong>. Calling the <code>pipeline()</code> method on a connection object will create a transaction, which <strong>when used correctly will automatically wrap a sequence of commands with <code>MULTI</code> and <code>EXEC</code></strong>. Incidentally, the Python Redis client will also <strong>store the commands to send until we actually want to send them</strong>. This reduces the number of round trips between Redis and the client, which can improve the performance of a sequence of commands.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">trans</span><span class="params">()</span>:</span></span><br><span class="line">        pipeline = conn.pipeline()</span><br><span class="line">        pipeline.incr(<span class="string">"trans"</span>)</span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line">        pipeline.incr(<span class="string">"trans"</span>,<span class="number">-1</span>)</span><br><span class="line">        print(pipeline.execute())</span><br><span class="line">		<span class="comment"># this in the end has the same effect of MULTI ... and then EXEC</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">        conn = redis.Redis(host=<span class="string">'cust-redis'</span>,port=<span class="number">6379</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">                threading.Thread(target=trans).start()</span><br></pre></td></tr></table></figure>
<p>Now, notice that by using a <strong>transaction</strong>, <strong>each thread is able to execute its entire sequence of commands without other threads interrupting it</strong> (as otherwise one of them might print <code>1</code> instead of <code>0</code>), despite the delay between the two calls.</p>
<p>Basically, you can think of this as having the <strong>same effect as <code>synchrnoized</code> keyword in Java</strong>, so that this <strong>transaction is locked once one thread enters</strong>.</p>
<h2 id="Key-Expiration"><a href="#Key-Expiration" class="headerlink" title="Key Expiration"></a>Key Expiration</h2><p>When we say that a key has a time to live, or that it‚Äôll expire at a given time, we mean that <strong>Redis will automatically delete the key when its expiration time has arrived</strong>.</p>
<p>Having keys that will expire after a certain amount of time can be useful to handle the <strong>cleanup of cached data</strong>. If you look through other chapters, you won‚Äôt see the use of key expiration in Redis often. This is mostly due to the types of structures that are used; <strong>few of the commands we use offer the ability to set the expiration time of a key automatically</strong>. And <strong>with containers</strong> (<code>LIST</code>s, <code>SET</code>s, <code>HASH</code>es, and <code>ZSET</code>s), we can <strong>only expire entire keys</strong>, <strong>not individual items</strong> (this is also why we use <code>ZSET</code>s with timestamps in a few places).</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Example use and description</th>
</tr>
</thead>
<tbody><tr>
<td><code>PERSIST</code></td>
<td><code>PERSIST key-name</code> ‚Äî <strong>Removes the expiration</strong> from a key</td>
</tr>
<tr>
<td><code>TTL</code></td>
<td><code>TTL key-name</code> ‚Äî Returns the <strong>amount of time remaining</strong> before a key will expire</td>
</tr>
<tr>
<td><code>EXPIRE</code></td>
<td><code>EXPIRE key-name seconds</code> ‚Äî Sets the key to <strong>expire in the given number of seconds</strong></td>
</tr>
<tr>
<td><code>EXPIREAT</code></td>
<td><code>EXPIREAT key-name timestamp</code> ‚Äî Sets the <strong>expiration time as the given Unix timestamp</strong></td>
</tr>
<tr>
<td><code>PTTL</code></td>
<td><code>PTTL key-name</code> ‚Äî Returns the <strong>number of milliseconds before the key will expire</strong> (available in Redis 2.6 and later)</td>
</tr>
<tr>
<td><code>PEXPIRE</code></td>
<td><code>PEXPIRE key-name milliseconds</code> ‚Äî Sets the key to <strong>expire in the given number of milliseconds</strong> (available in Redis 2.6 and later)</td>
</tr>
<tr>
<td><code>PEXPIREAT</code></td>
<td><code>PEXPIREAT key-name timestamp-milliseconds</code> ‚Äî Sets the <strong>expiration time to be the given Unix timestamp specified in milliseconds</strong> (available in Redis 2.6 and later)</td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># We‚Äôre starting with a very simple STRING value.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.set(<span class="string">'key'</span>, <span class="string">'value'</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.get(<span class="string">'key'</span>)</span><br><span class="line"><span class="string">'value'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.expire(<span class="string">'key'</span>, <span class="number">2</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>time.sleep(<span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.get(<span class="string">'key'</span>)  <span class="comment"># it‚Äôs already been deleted.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.set(<span class="string">'key'</span>, <span class="string">'value2'</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.expire(<span class="string">'key'</span>, <span class="number">100</span>); conn.ttl(<span class="string">'key'</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="number">100</span></span><br></pre></td></tr></table></figure>

<h2 id="Persistence-in-Redis-Snapshot"><a href="#Persistence-in-Redis-Snapshot" class="headerlink" title="Persistence in Redis - Snapshot"></a>Persistence in Redis - Snapshot</h2><p>In Redis, we can create a <strong>point-in-time copy of in-memory data by creating a snapshot</strong>. After creation, these snapshots can be backed up, copied to other servers to create a clone of the server, or left for a future restart.</p>
<p>On the configuration side of things, <strong>snapshots are written to the file referenced as <code>dbfilename</code></strong> in the configuration, and <strong>stored in the path referenced as <code>dir</code></strong>. Until the next snapshot is performed, data written to Redis since the last snapshot started (and completed) would be lost if there were a crash caused by Redis, the system, or the hardware.</p>
<p>As an example, say that we have Redis running with 10 gigabytes of data currently in memory. <strong>A previous snapshot</strong> had been started at <strong>2:35 p.m. and had finished</strong>. Now <strong>a snapshot is started at 3:06 p.m.</strong>, and <strong>35 keys are updated before</strong> the snapshot completes at 3:08 p.m. If some part of the system were to <strong>crash and prevent Redis</strong> from completing its snapshot operation <strong>between 3:06 p.m. and 3:08 p.m.</strong>, <strong>any data written between 2:35 p.m. and now would be lost</strong>. But if the system were to <strong>crash just after</strong> the snapshot had completed, then only the updates to those <strong>35 keys would be lost</strong> (so that the snapshot only includes data at the point of initiation, at 3:06 p.m.).</p>
<p>There are <strong>five methods to initiate a snapshot</strong>, which are listed as follows:</p>
<ul>
<li>Any Redis client can <strong>initiate a snapshot by calling the <code>BGSAVE</code> command</strong>. On platforms that support <code>BGSAVE</code> (basically all platforms except for Windows), Redis will fork, 1 and the <strong>child process will write the snapshot to disk while the parent process continues to respond to commands</strong>.<ul>
<li><strong>When a process forks</strong>, the underlying operating system makes a copy of the process. On Unix and Unix-like systems, the copying process is optimized such that, initially, all memory is shared between the child and parent processes. When either the parent or child process writes to memory, that memory will stop being shared.</li>
</ul>
</li>
<li>A Redis client can also <strong>initiate a snapshot by calling the <code>SAVE</code> command</strong>, which causes Redis to <strong>stop responding to any/all commands until the snapshot completes</strong>. This command isn‚Äôt commonly used, except in situations where we need our data on disk, and either we‚Äôre okay waiting for it to complete, or we don‚Äôt have enough memory for a BGSAVE.</li>
<li>If Redis is configured with <strong><code>save</code> lines, such as <code>save 60 10000</code></strong>, Redis will automatically trigger a <strong><code>BGSAVE</code> operation if 10,000 writes have occurred after 60 seconds since the last successful save has started</strong> (using the configuration option described). When <strong>multiple <code>save</code></strong> lines are present, any time <strong>one of the rules match, a <code>BGSAVE</code> is triggered</strong>.</li>
<li>When Redis receives a request to <strong>shut down by the <code>SHUTDOWN</code> command</strong>, or it receives a <strong>standard <code>TERM</code> signal</strong>, Redis will perform a <strong><code>SAVE</code>, blocking clients from performing any further commands</strong>, and then shut down.</li>
<li>If a Redis server <strong>connects to another Redis server and issues the <code>SYNC</code> command to begin replication</strong>, the <strong>master Redis server will start a <code>BGSAVE</code> operation</strong> if one isn‚Äôt already executing or recently completed.</li>
</ul>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> There are two ways to do the above configuration for <code>redis</code>. One is to use the <code>config set &lt;value&gt;</code> command. The other is to change the <code>redis.conf</code> file, which should be under <code>/usr/local/etc/redis/redis.conf</code>.</li>
<li><input disabled type="checkbox"> For <code>docker</code> users, if that file does not exist, you might need to manually create one and mount that directory.</li>
</ul>
</blockquote>
<p>However, as mentioned before, if a system crashes while you are doing a <code>snapshot</code>, data will be lost. Then the question becomes how to <strong>recover it</strong>. Suppose you are processing log files, and the system crashes before you are diong a dump. Then, in order to recover from it, you need to find a way to first know what has been lost, in other words, you need to somehow <strong>track your progress:</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process_logs</span><span class="params">(conn, path, callback)</span>:</span>  <span class="comment"># the callback function will be used to process the log line</span></span><br><span class="line"></span><br><span class="line">   current_file, offset = conn.mget(  <span class="comment"># mget is multiple get</span></span><br><span class="line">      <span class="string">'progress:file'</span>, <span class="string">'progress:position'</span>)  <span class="comment"># Get the current progress.</span></span><br><span class="line"></span><br><span class="line">   pipe = conn.pipeline()</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">update_progress</span><span class="params">()</span>:</span>  <span class="comment"># this is used later to update the line number</span></span><br><span class="line"></span><br><span class="line">      pipe.mset(&#123;</span><br><span class="line">         <span class="string">'progress:file'</span>: fname,</span><br><span class="line">         <span class="string">'progress:position'</span>: offset</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      pipe.execute()</span><br><span class="line"></span><br><span class="line">   <span class="keyword">for</span> fname <span class="keyword">in</span> sorted(os.listdir(path)):  <span class="comment"># Iterate over the log files in sorted order.</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> fname &lt; current_file:  <span class="comment"># Skip over files that are before the current file.</span></span><br><span class="line">         <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">      inp = open(os.path.join(path, fname), <span class="string">'rb'</span>)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> fname == current_file:</span><br><span class="line">         inp.seek(int(offset, <span class="number">10</span>))  <span class="comment"># If we‚Äôre continuing a file, skip over the parts that we‚Äôve</span></span><br><span class="line">								    <span class="comment"># already processed.</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">else</span>:</span><br><span class="line">         offset = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">      current_file = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> lno, line <span class="keyword">in</span> enumerate(inp):</span><br><span class="line"></span><br><span class="line">         callback(pipe, line)  <span class="comment"># Process/handle the log line.</span></span><br><span class="line"></span><br><span class="line">         offset = int(offset) + len(line)  <span class="comment"># Update our information about the offset into the file.</span></span><br><span class="line"></span><br><span class="line">         <span class="keyword">if</span> <span class="keyword">not</span> (lno+<span class="number">1</span>) % <span class="number">1000</span>:</span><br><span class="line">            update_progress()  <span class="comment"># updates the progress information for every 1000 actual updates</span></span><br><span class="line">      </span><br><span class="line">	  update_progress()  <span class="comment">#update again when we are done with the file</span></span><br><span class="line"></span><br><span class="line">      inp.close()</span><br></pre></td></tr></table></figure>

<p><strong>Deciding whether to use <code>BGSAVE</code> or <code>SAVE</code></strong></p>
<p>When the amount of data that we store in Redis tends to be under a few gigabytes, snapshotting with <code>BGSAVE</code> can be the right answer. <strong>Redis will fork, save to disk, and finish the snapshot faster than you can read this sentence</strong>. But as our Redis memory use grows over time, <strong>so does the time to perform a fork operation for the <code>BGSAVE</code></strong>. In situations where Redis is using tens of gigabytes of memory, there isn‚Äôt a lot of free memory, or if we‚Äôre running on a virtual machine, letting a BGSAVE occur may cause the system to pause for extended periods of time.</p>
<p>To <strong>prevent forking from causing such issues</strong>, we may want to disable automatic saving entirely. When automatic saving is disabled, we then need to <strong>manually call <code>BGSAVE</code></strong> (which has all of the same potential issues as  before, only now we know when they will happen), <strong>or we can call <code>SAVE</code></strong>. <strong>With <code>SAVE</code>, Redis does block until the save is completed,</strong> but because there‚Äôs <strong>no fork</strong>, there‚Äôs <strong>no fork delay</strong>. And because Redis doesn‚Äôt have to fight with itself for resources, the <strong>snapshot will finish faster</strong>.</p>
<p>For example, when trying to <strong>use <code>BGSAVE</code></strong> with clients writing to Redis with data of about <strong>50 gigabytes</strong>, <strong>forking would take 15 seconds or more</strong>, followed by <strong>15‚Äì20 minutes for the snapshot to complete</strong>. But <strong>with <code>SAVE</code>, the snapshot would finish in 3‚Äì5 minutes</strong>.</p>
<h2 id="Persistence-in-Redis-Append-only-file"><a href="#Persistence-in-Redis-Append-only-file" class="headerlink" title="Persistence in Redis - Append-only file"></a>Persistence in Redis - Append-only file</h2><p>In basic terms, <strong>append-only log files keep a record of data changes</strong> that occur by <strong>writing each change to the end of the file</strong>. In doing this, anyone could recover the entire dataset by replaying the append-only log from the beginning to the end. Redis has functionality that does this as well, and it‚Äôs enabled by setting the configuration option <code>appendonly yes</code>.</p>
<p>You also have several options to configuring syncing and writing the append-only file to disk. <strong>When that sync is completed</strong>, we can be fairly certain that <strong>our data is on disk and we can read it later if the system  otherwise fails</strong>.</p>
<table>
<thead>
<tr>
<th><code>appendfsync</code> Option</th>
<th>How often syncing will occur</th>
</tr>
</thead>
<tbody><tr>
<td><code>always</code></td>
<td><strong>Every write command to Redis results in a write to disk</strong>. This slows Redis down substantially if used.</td>
</tr>
<tr>
<td><code>everysec</code></td>
<td><strong>Once per second</strong>, explicitly syncs write commands to disk.</td>
</tr>
<tr>
<td><code>no</code></td>
<td>Lets the operating system control syncing to disk.</td>
</tr>
</tbody></table>
<hr>
<p><strong>Warning:</strong></p>
<p>You‚Äôll want to be careful if you‚Äôre using SSDs with <code>appendfsync always</code>. Writing every change to disk as they happen, instead of letting the operating system group writes together as is the case with the other  <code>appendfsync</code> options, has the <strong>potential to cause an extreme form of what is known as write amplification</strong>. By writing small amounts of data to the end of a file, you can <strong>reduce the lifetime of SSDs from years to just a few months in some cases</strong>.</p>
<hr>
<p>As a reasonable compromise between keeping data safe and keeping our write performance high, we can also set <code>appendfsync everysec</code>. This configuration will <strong>sync the append-only log once every second</strong>. For most common uses, we‚Äôll likely not find significant performance penalties for syncing to disk every second compared to not using any sort of persistence. By syncing to disk every second, if the system were to crash, we could lose at most one second of data that had been written or updated in Redis. Also, in the case where the disk is unable to keep up with the write volume that‚Äôs happening, Redis would gracefully slow down to accommodate the maximum write rate of the drive.</p>
<p>Append-only files are flexible, offering a variety of options to ensure that almost every level of paranoia can be addressed. <strong>But there‚Äôs a dark side to AOF persistence, and that is file size.</strong></p>
<h3 id="Configuring-Compacting-your-Append-only-Files"><a href="#Configuring-Compacting-your-Append-only-Files" class="headerlink" title="Configuring/Compacting your Append-only Files"></a>Configuring/Compacting your Append-only Files</h3><p>If using <code>AOF</code> would make data loss to one second of work (for example, <code>appendfsync everysecond</code>), then why do we want to use <code>Snapshots</code> in general? Isn‚Äôt the choice clear that we would want to use <code>AOF</code> almost always? In reality, <strong>the choice is actually not so simple</strong>: because <strong>every write to Redis causes a log of the command to be written to disk, the append-only log file will continuously grow</strong>. Over time, a growing AOF could cause your disk to run out of space, <strong>but more commonly, upon restart, Redis will be executing every command in the AOF in order. When handling large AOFs, Redis can take a very long time to start up.</strong></p>
<p>One solution is to use <code>BGREWRITEAOF</code>, which will <strong>rewrite the AOF to be as short as possible by removing redundant commands</strong>. <code>BGREWRITEAOF</code> works <strong>similarly to the snapshotting <code>BGSAVE</code></strong>: performing a fork and subsequently rewriting the append-only log in the child. As such, <strong>all of the same limitations with snapshotting performance regarding fork time, memory use, and so on still stand when using append-only files</strong>. But even worse, because <code>AOF</code>s can grow to be many times the size of a dump (if left uncontrolled), when the <code>AOF</code> is rewritten, the OS needs to delete the <code>AOF</code>, which can cause the system to hang for multiple seconds while it‚Äôs deleting an <code>AOF</code> of tens of gigabytes.</p>
<p>There are also <strong>two configuration options that enable and customize the automatic <code>BGREWRITEAOF</code> execution</strong>: </p>
<ul>
<li><code>auto-aof-rewrite-percentage</code> </li>
<li><code>auto-aof-rewrite-min-size</code></li>
</ul>
<p>For example, if we use <code>auto-aof-rewritepercentage 100</code> and <code>auto-aof-rewrite-min-size 64mb</code>, when <code>AOF</code> is enabled, Redis will <strong>initiate a BGREWRITEAOF when the <code>AOF</code> is at least 100% larger than it was when Redis last finished rewriting the AOF</strong>, <strong><em>and</em></strong> <strong>when the <code>AOF</code> is at least 64 megabytes in size</strong>. As a point of configuration, if our <code>AOF</code> is rewriting too often, we can increase the <code>100</code> that represents <code>100%</code> to something larger, though it will cause Redis to take longer to start up if it has been a while since a rewrite happened.</p>
<h2 id="Replication"><a href="#Replication" class="headerlink" title="Replication"></a>Replication</h2><p>Replication is a method by which other <strong>servers receive a continuously updated copy of the data as the main server is being written</strong>, so that the replicas can service read queries. In the relational database world, it‚Äôs not uncommon for <strong>a single <code>master</code> database to send writes out to multiple <code>slave</code>s, with the <code>slave</code>s performing all of the read queries</strong>. Redis has adopted this method of replication as a way of helping to scale, and this section will discuss configuring replication in Redis, and how Redis operates during replication.</p>
<p>With a <code>master</code>/<code>slave</code> setup, instead of connecting to the <code>master</code> for reading data, <strong>clients will connect to one of the <code>slave</code>s to read their data</strong> (typically choosing them in a random fashion to try to balance the load).</p>
<h3 id="Configuring-Master-and-Slave-Server"><a href="#Configuring-Master-and-Slave-Server" class="headerlink" title="Configuring Master and Slave Server"></a>Configuring Master and Slave Server</h3><ul>
<li><p>To configure replication on the <code>master</code> side of things, we <strong>only need to ensure that the path and filename listed under the <code>dir</code> and <code>dbfilename</code> configuration options</strong> shown below are to a path and file that are <strong>writable by the Redis process</strong>.</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># inside the redis.conf file</span><br><span class="line"></span><br><span class="line">dbfilename dump.rdb  # also the default</span><br><span class="line">dir .&#x2F;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Though a variety of options control behavior of the <code>slave</code> itself, <strong>only one option is really necessary to enable slaving: <code>slaveof</code></strong>. If we were to <strong>set <code>slaveof host port</code> in our configuration file</strong>, the Redis that‚Äôs started with that configuration will use the provided host and port as the <code>master</code> Redis server it should connect to. If we have <strong>an already running system</strong>, we can tell a Redis server to stop slaving, or even to slave to a new or different master. <strong>To connect to a new <code>master</code>, we can use the <code>SLAVEOF host port</code> command</strong>, or if we want to <strong>stop updating data from the master, we can use <code>SLAVEOF no one</code>.</strong></p>
</li>
</ul>
<h3 id="Master-Slave-startup-process"><a href="#Master-Slave-startup-process" class="headerlink" title="Master/Slave startup process"></a><code>Master</code>/<code>Slave</code> startup process</h3><p>These are the operations that occur on both the <code>master</code> and <code>slave</code> when a <code>slave</code> connects to a <code>master</code>.</p>
<table>
<thead>
<tr>
<th>Step</th>
<th>Master operations</th>
<th>Slave operations</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>(waiting for a command)</td>
<td>(Re-)connects to the <code>master</code>; issues the <code>SYNC</code> command</td>
</tr>
<tr>
<td>2</td>
<td>Starts <code>BGSAVE</code> operation; <strong>keeps a backlog of all write commands sent after</strong> <code>BGSAVE</code></td>
<td>Serves old data (if any), or returns errors to commands (depending on configuration)</td>
</tr>
<tr>
<td>3</td>
<td>Finishes <code>BGSAVE</code>; starts sending the snapshot to the slave; continues holding a backlog of write commands</td>
<td><strong>Discards all old data</strong> (if any); starts loading the dump as it‚Äôs received</td>
</tr>
<tr>
<td>4</td>
<td>Finishes sending the snapshot to the slave; <strong>starts sending the write command backlog</strong> to the slave</td>
<td>Finishes parsing the dump; starts responding to commands normally again</td>
</tr>
<tr>
<td>5</td>
<td>Finishes sending the backlog; starts live streaming of write commands as they happen</td>
<td>Finishes executing backlog of write commands from the master; continues executing commands as they happen</td>
</tr>
</tbody></table>
<p>So, Redis manages to keep up with most loads during replication, <strong>except in cases where network bandwidth between the <code>master</code> and <code>slave</code> instances isn‚Äôt fast enough</strong>, or when the <strong><code>master</code> doesn‚Äôt have enough memory to fork and keep a backlog of write commands</strong>. Though it isn‚Äôt necessary, it‚Äôs generally considered to be a <strong>good practice to have Redis masters only use about 50‚Äì65% of the memory in our system</strong>, leaving approximately 30‚Äì45% for spare memory during <code>BGSAVE</code> and command backlogs.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Just to make sure that we‚Äôre all on the same page (some users forget this the first time they try  using <code>slave</code>s): <strong>when a <code>slave</code> initially connects to a <code>master</code>, any data that had been in memory will be lost, to be replaced by the data coming from the <code>master</code>.</strong></li>
</ul>
</blockquote>
<p>But what happens when you have more than one <code>slave</code>? When another <code>slave</code> connects to an existing master, sometimes it can reuse an existing dump file (if there is). In general, <strong>only one of the two scenario will happen</strong>:</p>
<table>
<thead>
<tr>
<th>When additional slaves connect</th>
<th>Master operation</th>
</tr>
</thead>
<tbody><tr>
<td>Before step 3 in table above</td>
<td>All slaves will receive the same dump and same backlogged write commands.</td>
</tr>
<tr>
<td>On or after step 3 in table above</td>
<td>While the master is finishing up the five steps for earlier slaves, a new sequence of steps 1-5 will start for the new slave(s).</td>
</tr>
</tbody></table>
<h3 id="Master-Slave-Chain"><a href="#Master-Slave-Chain" class="headerlink" title="Master/Slave Chain"></a><code>Master</code>/<code>Slave</code> Chain</h3><p>Some developers have found that when they need to <strong>replicate to more than a handful of <code>slave</code>s</strong>, some networks are unable to keep up ‚Äî especially when replication is being performed over the internet or between data centers. Because there‚Äôs nothing particularly special about being a <code>master</code> or a <code>slave</code> in Redis, <strong><code>slave</code>s can have their own <code>slave</code>s, resulting in <code>master</code>/<code>slave</code> chaining</strong>.</p>
<p>In general, <strong>when read load significantly outweighs write load, and when the number of reads pushes well beyond what a single Redis server can handle</strong>, it‚Äôs common to keep <strong>adding <code>slave</code>s to help deal with the load</strong>. As load continues to increase, we can run into situations where the single <code>master</code> can‚Äôt write to all of its <code>slave</code>s fast enough, or is overloaded with <code>slave</code>s reconnecting and resyncing. To alleviate such issues, we may want to set up a layer of intermediate Redis <code>master</code>/<code>slave</code> nodes:</p>
<p><img src="/.com//06/02/Redis-Manual/master-slave-chain.png" alt="Picture from https://redislabs.com/ebook/part-2-core-concepts/chapter-4-keeping-data-safe-and-ensuring-performance/4-2-replication/4-2-3-masterslave-chains/" title="Picture from https://redislabs.com/ebook/part-2-core-concepts/chapter-4-keeping-data-safe-and-ensuring-performance/4-2-replication/4-2-3-masterslave-chains/"></p>
<h3 id="Verifying-Disk-Writes"><a href="#Verifying-Disk-Writes" class="headerlink" title="Verifying Disk Writes"></a>Verifying Disk Writes</h3><p>Verifying that the <strong>data we wrote to the <code>master</code> made it to the <code>slave</code> is easy</strong>: we merely need to write a unique dummy value after our important data, and then check for it on the slave. <strong>But verifying that the data made it to disk is more difficult</strong>. If we wait at least one second, we know that our data made it to disk. But if we‚Äôre careful, we may be able to <strong>wait less time by checking the output of <code>INFO</code> for the value of <code>aof_pending_bio_fsync</code></strong>, which will be <strong><code>0</code> if all data that the server knows about has been written to disk</strong>.</p>
<p>Now, if we know this, we could write a program to automate the check for us:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">def wait_for_sync(mconn, sconn):</span><br><span class="line">   identifier &#x3D; str(uuid.uuid4())</span><br><span class="line"></span><br><span class="line">   time &#x3D; time.time()</span><br><span class="line">   mconn.zadd(&#39;sync:wait&#39;, identifier, time)  # Add a token to the master to verify slave data later</span><br><span class="line"></span><br><span class="line">   while not sconn.INFO()[&#39;master_link_status&#39;] !&#x3D; &#39;up&#39;:  # Wait for the slave to sync (if necessary).</span><br><span class="line"></span><br><span class="line">      time.sleep(.001)</span><br><span class="line"></span><br><span class="line">   while sconn.zscore(&#39;sync:wait&#39;, identifier) !&#x3D; time:  # Wait for the slave to receive the data change.</span><br><span class="line"></span><br><span class="line">      time.sleep(.001)</span><br><span class="line"></span><br><span class="line">   deadline &#x3D; time.time() + 1.01</span><br><span class="line"></span><br><span class="line">   while time.time() &lt; deadline:  # Loops up to one second. </span><br><span class="line">			                      # After a second, the AOF will be completed anyway</span><br><span class="line"></span><br><span class="line">      if sconn.INFO()[&#39;aof_pending_bio_fsync&#39;] &#x3D;&#x3D; 0:  # Check to see if the data is known to be on disk.</span><br><span class="line">         break</span><br><span class="line"></span><br><span class="line">      time.sleep(.001)</span><br><span class="line"></span><br><span class="line">   mconn.zrem(&#39;sync:wait&#39;, identifier)</span><br><span class="line">   mconn.zremrangebyscore(&#39;sync:wait&#39;, 0, time.time()-900)  # Clean up our status by </span><br><span class="line">															# cleaning out older entries that may have been left there</span><br></pre></td></tr></table></figure>
<p>Here we see the use of the <code>INFO</code> command. In general, the <code>INFO</code> command can offer a wide range of information about the current status of a Redis server‚Äîmemory used, the number of connected clients, the number of keys in each database, the number of commands executed since the last snapshot, and more. <strong>Generally speaking, <code>INFO</code>is a good source of information about the general state of our Redis servers, and many resources online can explain more.</strong></p>
<h2 id="Fixing-Snapshots-and-AOFs"><a href="#Fixing-Snapshots-and-AOFs" class="headerlink" title="Fixing Snapshots and AOFs"></a>Fixing <code>Snapshot</code>s and <code>AOF</code>s</h2><p>We have covered how to replicate to handle <code>redis</code> data storage. However, we have not yet covered how to <strong>fix the <code>Dump</code>s or the <code>AOF</code>s themselves if there is a system failure</strong>.</p>
<p>When confronted with system failures, we have tools to help us recover when either <code>snapshotting</code> or <code>append-only file</code> logging had been enabled. Redis includes <strong>two command-line applications for testing the status of a <code>snapshot</code> and an <code>append-only file</code>.</strong> These commands are <code>redis-check-aof</code> and <code>redis-check-dump</code>. If we run either command without arguments (<strong>not in the <code>redis-cli</code>, but in command-line</strong>), we‚Äôll see the basic help that‚Äôs provided:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ redis-check-aof</span><br><span class="line">Usage: redis-check-aof [--fix] &lt;file.aof&gt;</span><br><span class="line">$ redis-check-dump</span><br><span class="line">Usage: redis-check-dump &lt;dump.rdb&gt;</span><br><span class="line">$</span><br></pre></td></tr></table></figure>

<ul>
<li><p>If we <strong>provide <code>‚Äìfix</code> as an argument to <code>redis-check-aof</code>, the command will fix the file</strong>. Its method to fix an <code>append-only file</code> is simple: <strong>it scans through the provided <code>AOF</code>, looking for an incomplete or incorrect command</strong>. Upon finding the <strong>first bad command, it trims the file to just before that command would‚Äôve been executed</strong>. For most situations, this will discard the last partial write command. However, <strong>it is possible that all the correct commands after that first bad command will be lost due to this process.</strong></p>
</li>
<li><p>Unfortunately, there‚Äôs <strong>no currently supported method of repairing a corrupted <code>snapshot</code></strong>. Though there‚Äôs the potential to discover where the first error had occurred, <strong>because the snapshot itself is compressed, an error partway through the dump has the potential to make the remaining parts of the snapshot unreadable.</strong> It‚Äôs for these reasons that I‚Äôd generally recommend keeping <strong>multiple backups of important snapshots</strong>, and <strong>calculating the <code>SHA1</code> or <code>SHA256</code> hashes to verify content during restoration.</strong></p>
</li>
</ul>
<p>Now, after we‚Äôve verified that our backups are what we had saved before, and we‚Äôve corrected the last write to <code>AOF</code> as necessary, <strong>the last step is for us to replace a Redis server with that corrected file.</strong></p>
<h3 id="Replacing-a-Failed-Master"><a href="#Replacing-a-Failed-Master" class="headerlink" title="Replacing a Failed Master"></a>Replacing a Failed Master</h3><p>Suppose machine A is running a copy of Redis that‚Äôs acting as the <code>master</code>, and machine B is running a copy of Redis that‚Äôs acting as the <code>slave</code>. Unfortunately, machine A has just <strong>lost network connectivity</strong> for some reason that we haven‚Äôt yet been able to diagnose. But we have <strong>machine C with Redis installed that we‚Äôd like to use as the <code>new master</code>.</strong></p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> If we <strong>cannot access machine A, then usually we cannot access and correct the <code>AOF</code></strong>. However, if we could, then we could simply use the <strong>correct <code>AOF</code> file we just fixed</strong> in the last section to become the <code>AOF</code> file for Machine C. Then, we set machine B to be the slave of machine C, and we finish.</li>
</ul>
</blockquote>
<ol>
<li><p>In this case, we can also tell <strong>machine B to produce a fresh snapshot with <code>SAVE</code>.</strong> We‚Äôll then <strong>copy that snapshot over to machine C.</strong> After the snapshot has been copied into the proper path, we‚Äôll start Redis on machine C. Finally, we‚Äôll tell machine B to become a <code>slave</code> of machine C.</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">user@vpn-master ~:$ ssh root@machine-b.vpn</span><br><span class="line">Last login: Wed Mar 28 15:21:06 2012 from ...</span><br><span class="line">Connect to machine B on our VPN network.</span><br><span class="line"></span><br><span class="line">root@machine-b ~:$ redis-cli  <span class="comment"># Start up the commandline redis client to do a few simple operations.</span></span><br><span class="line"></span><br><span class="line">redis 127.0.0.1:6379&gt; SAVE</span><br><span class="line">OK</span><br><span class="line">redis 127.0.0.1:6379&gt; QUIT  <span class="comment"># Start a SAVE, and when it‚Äôs done, QUIT so that we can continue.</span></span><br><span class="line"></span><br><span class="line">root@machine-b ~:$ scp +</span><br><span class="line">&gt; /var/<span class="built_in">local</span>/redis/dump.rdb machine-c.vpn:/var/<span class="built_in">local</span>/redis/  <span class="comment"># Copy the snapshot over to the new master, machine C.</span></span><br><span class="line">dump.rdb                  100%      525MB   8.1MB/s   01:05</span><br><span class="line"></span><br><span class="line">root@machine-b ~:$ ssh machine-c.vpn</span><br><span class="line">Last login: Tue Mar 27 12:42:31 2012 from ...</span><br><span class="line"></span><br><span class="line">root@machine-c ~:$ sudo /etc/init.d/redis-server start</span><br><span class="line">Starting Redis server...</span><br><span class="line">Connect to the new master and start Redis.</span><br><span class="line"></span><br><span class="line">root@machine-c ~:$ <span class="built_in">exit</span></span><br><span class="line">root@machine-b ~:$ redis-cli</span><br><span class="line">redis 127.0.0.1:6379&gt; SLAVEOF machine-c.vpn 6379</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">redis 127.0.0.1:6379&gt; QUIT</span><br><span class="line">root@machine-b ~:$ <span class="built_in">exit</span></span><br><span class="line">user@vpn-master ~:$</span><br></pre></td></tr></table></figure>
</li>
<li><p>As an alternative to creating a new <code>master</code>, we may want to <strong>turn the <code>slave</code> into a <code>master</code> and create a new <code>slave</code></strong>. Either way, Redis will be able to pick up where it left off, and our only job from then on is to <strong>update our client configuration to read and write to the proper servers</strong>, and optionally update the on-disk server configuration if we need to restart Redis.</p>
</li>
</ol>
<hr>
<p><strong>REDIS SENTINEL</strong></p>
<p>A relatively recent addition to the collection of tools available with Redis is <code>Redis Sentinel</code>. By the final publishing of this manuscript, Redis Sentinel should be complete. <strong>Generally, Redis Sentinel pays attention to Redis masters and the slaves of the masters and automatically handles failover if the master goes down.</strong> For more details, please visit <a href="https://redislabs.com/ebook/part-3-next-steps/chapter-10-scaling-redis/" target="_blank" rel="noopener">this link</a>.</p>
<hr>
<h2 id="Redis-Transactions"><a href="#Redis-Transactions" class="headerlink" title="Redis Transactions"></a>Redis Transactions</h2><p>(This section builds on from the section <a href="#Basic-Redis-Transactions">Basic Redis Transactions</a>)</p>
<p>Because of Redis‚Äôs delaying execution of commands until <code>EXEC</code> is called when using <code>MULTI</code>/<code>EXEC</code>, <strong>many clients (including the Python client that we‚Äôre using) will hold off on even sending commands until all of them are known.</strong> When all of the commands are known, the client will send <code>MULTI</code>, followed by the series of commands to be executed, and <code>EXEC</code>, all at the same time. The client will then wait until all of the replies from all of the commands are received. This method of sending multiple commands at once and waiting for all of the replies is generally referred to as pipelining, and <strong>has the ability to improve Redis‚Äôs performance when executing multiple commands by reducing the number of network round trips that a client needs to wait for.</strong></p>
<p>However, there could be a <strong>potential problem of error</strong>: since <code>MULTI</code> holds the command back before executing, <strong>if some data has been changed (e.g. deleted) in the redis server, then there could be an error or data corruption when you execute your <code>EXEC</code>.</strong></p>
<p>Consider the example of a Fake Game Company has seen major growth in their webbased RPG that‚Äôs played on YouTwitFace, a fictional social network. Because it pays attention to the needs and desires of its community, it has determined that the <strong>players need the ability to buy and sell items in a marketplace.</strong> It‚Äôs our job to design and <strong>build a marketplace</strong> that can scale to the needs of the community.</p>
<h3 id="Posting-Items-in-a-Marketplace"><a href="#Posting-Items-in-a-Marketplace" class="headerlink" title="Posting Items in a Marketplace"></a>Posting Items in a Marketplace</h3><p>Our requirements for the market are simple: <strong>a user can list an item for a given price</strong>, and when another user purchases the item, the seller receives the money. We‚Äôll also say that the part of the market we‚Äôll be worrying about only needs to be ordered by selling price. In a later chapter, we‚Äôll cover some topics for handling other orders.</p>
<p>Our basic marketplace that includes an <strong>ItemA being sold by user 4 for 35 e-dollars</strong>. To include enough information to sell a given item in the market, we‚Äôll <strong>concatenate the item ID for the item with the user ID of the seller and use that as a member of a market ZSET</strong>, with the <strong>score being the item‚Äôs selling price.</strong> By including all of this information together, we greatly simplify our data structures and what we need to look up, and get the benefit of being able to easily paginate through a presorted market.</p>
<p><img src="/.com//06/02/Redis-Manual/market-listing.png" alt="Picture from https://redislabs.com/ebook/part-2-core-concepts/chapter-4-keeping-data-safe-and-ensuring-performance/4-4-redis-transactions/4-4-1-defining-users-and-their-inventory/" title="Picture from https://redislabs.com/ebook/part-2-core-concepts/chapter-4-keeping-data-safe-and-ensuring-performance/4-4-redis-transactions/4-4-1-defining-users-and-their-inventory/"></p>
<p>Now, we need to deal with the code part.</p>
<p>In the process of listing, we‚Äôll use a Redis operation called <code>WATCH</code>, which we combine with <code>MULTI</code> and <code>EXEC</code>, and sometimes <code>UNWATCH</code> or <code>DISCARD</code>. When <strong>we‚Äôve watched keys with <code>WATCH</code>, if at any time some other client replaces, updates, or deletes any keys that we‚Äôve <code>WATCH</code>ed before we have performed the <code>EXEC</code> operation, our operations against Redis will fail with an error message when we try to <code>EXEC</code> (at which point we can retry or abort the operation)</strong>. By using <code>WATCH</code>, <code>MULTI</code>/<code>EXEC</code>, and <code>UNWATCH</code>/<code>DISCARD</code>, we can <strong>ensure that the data that we‚Äôre working with doesn‚Äôt change while we‚Äôre doing something important, which protects us from data corruption.</strong></p>
<ul>
<li><p>Basically, <code>WATCH</code> works by making the <code>EXEC</code> command conditional; in other words, Redis will only perform a transaction if the <code>WATCH</code>ed keys were not modified (<strong>otherwise it returns <code>nil</code> no matter what commands you queued</strong>). If a <code>WATCH</code>ed key was indeed modified, the transaction won‚Äôt be entered at all.</p>
<p>  The <code>WATCH</code> command can be called numerous times (before the <code>MULTI</code> command), and one <code>WATCH</code> call can involve any number of keys. <code>Watch</code> calls simply monitor for changes starting from the point where <code>WATCH</code> was called until <code>EXEC</code> is called. <strong>Once <code>EXEC</code> is invoked, all the keys will be <code>UNWATCH</code>ed, whether or not the transaction in question was aborted.</strong> Closing a client connection also triggers all keys to be <code>UNWATCH</code>ed.</p>
</li>
</ul>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> While <code>UNWATCH</code> is obvious as it sounds, <strong><code>DISCARD</code> needs more explaination.</strong> In the same way that <code>UNWATCH</code> will let us reset our connection if sent after <code>WATCH</code> but <strong>before <code>MULTI</code></strong>, <strong><code>DISCARD</code> will also reset the connection if sent after <code>MULTI</code> but before <code>EXEC</code>.</strong> That is to say, if we‚Äôd <code>WATCH</code>ed a key or keys, fetched some data, and then started a transaction with <code>MULTI</code> followed by a group of commands, we could <strong>cancel the <code>WATCH</code> and clear out any queued commands with <code>DISCARD</code>.</strong> We don‚Äôt use <code>DISCARD</code> here, primarily because we know whether we want to perform a <code>MULTI</code>/<code>EXEC</code> or <code>UNWATCH</code>, so a <code>DISCARD</code> is unnecessary for our purposes.</li>
</ul>
</blockquote>
<p>Therefore, all we need to do for listing/posting those items would be to <strong>add the item to the market <code>ZSET</code>, while <code>WATCH</code>ing the seller‚Äôs inventory to make sure that the item is still available to be sold.</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">def list_item(conn, itemid, sellerid, price):</span><br><span class="line">   inventory &#x3D; &quot;inventory:%s&quot;%sellerid</span><br><span class="line">   item &#x3D; &quot;%s.%s&quot;%(itemid, sellerid)</span><br><span class="line">   end &#x3D; time.time() + 5</span><br><span class="line">   pipe &#x3D; conn.pipeline()</span><br><span class="line"></span><br><span class="line">   while time.time() &lt; end:</span><br><span class="line">      try:</span><br><span class="line">         conn.watch(inventory)  # Watch for changes to the user‚Äôs inventory.</span><br><span class="line"></span><br><span class="line">         if not conn.sismember(inventory, itemid):  # Verify that the user still has the item to be listed.</span><br><span class="line"></span><br><span class="line">            conn.unwatch()  # If the item isn‚Äôt in the user‚Äôs inventory, stop watching the inventory key and return.</span><br><span class="line"></span><br><span class="line">            return None</span><br><span class="line"></span><br><span class="line">         pipe.multi()</span><br><span class="line">         pipe.zadd(&quot;market:&quot;, item, price)</span><br><span class="line">         pipe.srem(inventory, itemid)  # Actually list the item.</span><br><span class="line"></span><br><span class="line">         pipe.execute()  # If execute returns without a WatchError being raised, </span><br><span class="line">						 # then the transaction is complete and the inventory key is no longer watched.</span><br><span class="line"></span><br><span class="line">         return True</span><br><span class="line">      except redis.exceptions.WatchError:</span><br><span class="line">         pass  # The user‚Äôs inventory was changed; retry the loop.</span><br><span class="line"></span><br><span class="line">   return False</span><br></pre></td></tr></table></figure>

<p>Generally, <strong>listing an item should occur without any significant issue, since only the user should be selling their own items</strong> (which is enforced farther up the application stack). But as mentioned before, if a user‚Äôs inventory were to change between the <code>WATCH</code> and <code>EXEC</code>, our attempt to list the item would fail, and we‚Äôd retry.</p>
<h3 id="Purchasing-an-Item"><a href="#Purchasing-an-Item" class="headerlink" title="Purchasing an Item"></a>Purchasing an Item</h3><p>To process the purchase of an item, we need to:</p>
<ol>
<li>first <code>WATCH</code> the market and the user who‚Äôs buying the item.</li>
<li>then fetch the buyer‚Äôs total funds and the price of the item </li>
<li>verify that the buyer has enough money. If they don‚Äôt have enough money, we cancel the transaction. </li>
<li>if they do have enough money, we perform the transfer of money between the accounts, move the item into the buyer‚Äôs inventory, and remove the item from the market. </li>
<li>on <code>WATCH</code> error, we retry for up to 10 seconds in total.</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">def purchase_item(conn, buyerid, itemid, sellerid, lprice):</span><br><span class="line">   buyer &#x3D; &quot;users:%s&quot;%buyerid</span><br><span class="line">   seller &#x3D; &quot;users:%s&quot;%sellerid</span><br><span class="line">   item &#x3D; &quot;%s.%s&quot;%(itemid, sellerid)</span><br><span class="line">   inventory &#x3D; &quot;inventory:%s&quot;%buyerid</span><br><span class="line">   end &#x3D; time.time() + 10</span><br><span class="line">   pipe &#x3D; conn.pipeline()</span><br><span class="line"></span><br><span class="line">   while time.time() &lt; end:</span><br><span class="line">      try:</span><br><span class="line">         conn.watch(&quot;market:&quot;, buyer)  # Watch for changes to the market and to the buyer‚Äôs account information.</span><br><span class="line"></span><br><span class="line">         price &#x3D; conn.zscore(&quot;market:&quot;, item)</span><br><span class="line">         funds &#x3D; int(conn.hget(buyer, &quot;funds&quot;))</span><br><span class="line">         if price !&#x3D; lprice or price &gt; funds:  # Check for a sold&#x2F;repriced item or insufficient funds.</span><br><span class="line">            conn.unwatch()  </span><br><span class="line"></span><br><span class="line">            return None</span><br><span class="line"></span><br><span class="line">		 # Transfer funds from the buyer to the seller, and transfer the item to the buyer.</span><br><span class="line">         pipe.multi()</span><br><span class="line">         pipe.hincrby(seller, &quot;funds&quot;, int(price))</span><br><span class="line">         pipe.hincrby(buyer, &quot;funds&quot;, int(-price))</span><br><span class="line">         pipe.sadd(inventory, itemid)</span><br><span class="line">         pipe.zrem(&quot;market:&quot;, item)</span><br><span class="line">         pipe.execute()  </span><br><span class="line"></span><br><span class="line">         return True</span><br><span class="line">      except redis.exceptions.WatchError:</span><br><span class="line">         pass  # Retry if the buyer‚Äôs account or the market changed.</span><br><span class="line"></span><br><span class="line">   return False</span><br></pre></td></tr></table></figure>

<p><strong><em>Q: Why can‚Äôt the data be simply locked in Redis?</em></strong></p>
<p>When accessing data for writing (<strong><code>SELECT FOR UPDATE</code> in SQL</strong>), relational databases will place a <strong>lock on rows that are accessed until a transaction is completed with <code>COMMIT</code> or <code>ROLLBACK</code>.</strong> If any other client attempts to access data for writing on any of the same rows, that client will be blocked until the first transaction is completed. This form of locking works well in practice (essentially all relational databases implement it), though it <strong>can result in long wait times for clients waiting to acquire locks on a number of rows if the lock holder is slow.</strong></p>
<p>Because there‚Äôs potential for long wait times, and <strong>because the design of Redis minimizes wait time for clients</strong> (except in the case of blocking <code>LIST</code> pops), Redis doesn‚Äôt lock data during <code>WATCH</code>. Instead, <strong>Redis will notify clients if someone else modified the data first, which is called optimistic locking</strong> (the actual locking that relational databases perform could be viewed as pessimistic). Optimistic locking also works well in practice because clients are never waiting on the first holder of the lock; instead they retry if some other client was faster.</p>
<h2 id="Non-transactional-Pipeline"><a href="#Non-transactional-Pipeline" class="headerlink" title="Non-transactional Pipeline"></a>Non-transactional Pipeline</h2><p>In the <strong>python redis libraray</strong>, you can actually put arguments in the <code>pipeline()</code> function:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pipe &#x3D; conn.pipeline(True)  # this is the same as conn.pipeline()</span><br></pre></td></tr></table></figure>

<p>And as we have seen before, this will wrap the commands with <code>MULTI</code>/<code>EXEC</code>, so that all commands will execute in order in a transactional way. However, we could also pass in the argument <code>False</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pipe &#x3D; conn.pipeline(False)</span><br></pre></td></tr></table></figure>

<p>This will <strong>not wrap the commands with <code>MULTI</code>/<code>EXEC</code>, but it will have an effect of executing multiple commands at once in the redis server</strong>, and thereby reduce the time taken for roundtrips. You can also think of these as comamnds with a multiple arguments, like <code>MGET</code>, <code>MSET</code>, <code>HMGET</code>, <code>HMSET</code>, <code>RPUSH/LPUSH</code>, <code>SADD</code>, <code>ZADD</code>, and others (but the performance improvement is perhaps not as drastic as these commands).</p>
<p>However, this does means that it is appropriate only when we are sure the <strong>result of one command doesn‚Äôt affect the input to another</strong>, <strong>and we don‚Äôt need them all to execute transactionally</strong>. However, we are sure that it will reduce the amount of round trips between the client and the server (to one in the example below), <strong>so <code>pipeline(False)</code> method can further improve overall Redis performance.</strong></p>
<p>For example:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update_token</span><span class="params">(conn, token, user, item=None)</span>:</span></span><br><span class="line">   timestamp = time.time()</span><br><span class="line"></span><br><span class="line">   conn.hset(<span class="string">'login:'</span>, token, user)</span><br><span class="line"></span><br><span class="line">   conn.zadd(<span class="string">'recent:'</span>, token, timestamp)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> item:</span><br><span class="line">      conn.zadd(<span class="string">'viewed:'</span> + token, item, timestamp)</span><br><span class="line"></span><br><span class="line">      conn.zremrangebyrank(<span class="string">'viewed:'</span> + token, <span class="number">0</span>, <span class="number">-26</span>)</span><br><span class="line"></span><br><span class="line">      conn.zincrby(<span class="string">'viewed:'</span>, item, <span class="number">-1</span>)</span><br></pre></td></tr></table></figure>

<p>could be replaced by:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update_token_pipeline</span><span class="params">(conn, token, user, item=None)</span>:</span></span><br><span class="line">   timestamp = time.time()</span><br><span class="line">   pipe = conn.pipeline(<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">   pipe.hset(<span class="string">'login:'</span>, token, user)  <span class="comment"># these two commands don't have to be executed in transaction</span></span><br><span class="line">   pipe.zadd(<span class="string">'recent:'</span>, token, timestamp)</span><br><span class="line">   <span class="keyword">if</span> item:</span><br><span class="line">      pipe.zadd(<span class="string">'viewed:'</span> + token, item, timestamp)</span><br><span class="line">      pipe.zremrangebyrank(<span class="string">'viewed:'</span> + token, <span class="number">0</span>, <span class="number">-26</span>)  <span class="comment"># those technically do</span></span><br><span class="line">      pipe.zincrby(<span class="string">'viewed:'</span>, item, <span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">   pipe.execute()  <span class="comment"># execute the above commands but there is no lock</span></span><br></pre></td></tr></table></figure>

<h2 id="Redis-Performance-and-Benchmarking"><a href="#Redis-Performance-and-Benchmarking" class="headerlink" title="Redis Performance and Benchmarking"></a>Redis Performance and Benchmarking</h2><p>Improving performance in Redis requires having an <strong>understanding of what to expect in terms of performance for the types of commands that we‚Äôre sending to Redis.</strong> To get a better idea of what to expect from Redis, we‚Äôll quickly run a **benchmark that‚Äôs included within Redis: <code>redis-benchmark</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">root@a93d918c25f7:&#x2F;data# redis-benchmark -c 1 -q</span><br><span class="line"></span><br><span class="line">PING_INLINE: 21353.83 requests per second</span><br><span class="line">PING_BULK: 19845.21 requests per second</span><br><span class="line">SET: 16220.60 requests per second</span><br><span class="line">GET: 19334.88 requests per second</span><br><span class="line">INCR: 16592.00 requests per second</span><br><span class="line">LPUSH: 18621.97 requests per second</span><br><span class="line">RPUSH: 19033.12 requests per second</span><br><span class="line">LPOP: 18556.32 requests per second</span><br><span class="line">RPOP: 18231.54 requests per second</span><br><span class="line">SADD: 19264.11 requests per second</span><br><span class="line">HSET: 15893.20 requests per second</span><br><span class="line">SPOP: 17445.92 requests per second</span><br><span class="line">LPUSH (needed to benchmark LRANGE): 16342.54 requests per second</span><br><span class="line">LRANGE_100 (first 100 elements): 13616.56 requests per second</span><br><span class="line">LRANGE_300 (first 300 elements): 9668.37 requests per second</span><br><span class="line">LRANGE_500 (first 450 elements): 8774.24 requests per second</span><br><span class="line">LRANGE_600 (first 600 elements): 7390.44 requests per second</span><br><span class="line">MSET (10 keys): 15544.85 requests per second</span><br></pre></td></tr></table></figure>

<p>The output of <code>redis-benchmark</code> shows a <strong>group of commands that are typically used in Redis, as well as the number of commands of that type that can be run in a single second.</strong> A standard run of this benchmark <strong>without any options will try to push Redis to its limit using <code>50</code> clients</strong>, but it‚Äôs a lot easier to compare performance of <strong>a single benchmark client against one copy of our own client (by specifying the <code>1</code> option, as in the command show in the example above)</strong>, rather than many.</p>
<p>However, <strong>be careful if you are using the python redis library</strong>. When looking at the output of redis-benchmark, we must be careful not to try to directly compare its output with how quickly our application (e.g. python) performs. This is because <strong><code>redis-benchmark</code> doesn‚Äôt actually process the result of the commands that it performs</strong>, which means that the results of <strong>some responses that require substantial parsing overhead aren‚Äôt  taken into account. Generally, compared to redis-benchmark running with a single client, we can expect the Python Redis client to perform at roughly 50‚Äì60% of what redis-benchmark will tell us</strong> for a single client and for nonpipelined commands, depending on the complexity of the command to call.</p>
<h2 id="Logging-in-Redis"><a href="#Logging-in-Redis" class="headerlink" title="Logging in Redis"></a>Logging in Redis</h2><p>In the world of Linux and Unix, there are two common logging methods. The <strong>first is logging to a file</strong>, where over time we write individual log lines to a file, and every once in a while, we write to a new file. Many thousands of pieces of software have been written do this (including Redis itself). But this method can run into issues because we have <strong>many different services writing to a variety of log files</strong>, each with a different way of rolling them over, and no common way of easily taking all of the log files and doing<br>something useful with them.</p>
<p>Running on TCP and UDP <strong>port 514 of almost every Unix and Linux server</strong> available is a <strong>service called <code>syslog</code></strong>, the <strong>second common logging method</strong>. Syslog accepts log messages from any program that sends it a message and <strong>routes those messages to various on-disk log files</strong>, <strong>handling rotation and deletion of old logs</strong>. With configuration, it can even forward messages to other servers for further processing. As a service, it‚Äôs far more convenient than logging to files directly, because all of the special log file rotation and deletion  is already handled for us.</p>
<h3 id="Recent-Logs"><a href="#Recent-Logs" class="headerlink" title="Recent Logs"></a>Recent Logs</h3><p>To keep a recent list of logs, we‚Äôll <strong><code>LPUSH</code> log messages to a <code>LIST</code> and then trim that <code>LIST</code> to a fixed size</strong>. Later, if we want to read the log messages, we can perform a simple <code>LRANGE</code> to fetch the messages. We‚Äôll take a few extra steps to support different named log message queues and to support the typical log severity levels, but you can remove either of those in your own code if you need to. The code for writing recent logs to Redis is shown below:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">SEVERITY = &#123;</span><br><span class="line">   logging.DEBUG: <span class="string">'debug'</span>,</span><br><span class="line">   logging.INFO: <span class="string">'info'</span>,</span><br><span class="line">   logging.WARNING: <span class="string">'warning'</span>,</span><br><span class="line">   logging.ERROR: <span class="string">'error'</span>,</span><br><span class="line">   logging.CRITICAL: <span class="string">'critical'</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log_recent</span><span class="params">(conn, name, message, severity=logging.INFO, pipe=None)</span>:</span></span><br><span class="line">   severity = str(SEVERITY.get(severity)).lower()</span><br><span class="line"></span><br><span class="line">   destination = <span class="string">'recent:%s:%s'</span>%(name, severity)  <span class="comment"># Create the key that messages will be written to.</span></span><br><span class="line"></span><br><span class="line">   message = time.asctime() + <span class="string">' '</span> + message  <span class="comment"># Add the current time so that we know when the message was sent.</span></span><br><span class="line"></span><br><span class="line">   pipe = pipe <span class="keyword">or</span> conn.pipeline()</span><br><span class="line">   pipe.lpush(destination, message)  <span class="comment"># Add the latest message to the beginning of the log list.</span></span><br><span class="line"></span><br><span class="line">   pipe.ltrim(destination, <span class="number">0</span>, <span class="number">99</span>)  <span class="comment"># Trim the log list to only include the most recent 100 messages.</span></span><br><span class="line"></span><br><span class="line">   pipe.execute()</span><br></pre></td></tr></table></figure>

<h3 id="Logging-Common-operations"><a href="#Logging-Common-operations" class="headerlink" title="Logging Common operations"></a>Logging Common operations</h3><p>The problem with the above code snippet is that it‚Äôs <strong>not very good at telling you whether any important messages were lost in the noise</strong>. By recording information about how often a particular message appears, you could then look through the messages ordered by <strong>how often they happened to help you determine what‚Äôs important</strong>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log_common</span><span class="params">(conn, name, message, severity=logging.INFO, timeout=<span class="number">5</span>)</span>:</span></span><br><span class="line">   severity = str(SEVERITY.get(severity)).lower()  <span class="comment"># Handle the logging level.</span></span><br><span class="line"></span><br><span class="line">   destination = <span class="string">'common:%s:%s'</span>%(name, severity)  <span class="comment"># Set up the destination key for keeping recent logs.</span></span><br><span class="line"></span><br><span class="line">   start_key = destination + <span class="string">':start'</span>  <span class="comment"># Keep a record of the start of the hour for this set of messages.</span></span><br><span class="line"></span><br><span class="line">   pipe = conn.pipeline()</span><br><span class="line">   end = time.time() + timeout</span><br><span class="line">   <span class="keyword">while</span> time.time() &lt; end:</span><br><span class="line">      <span class="keyword">try</span>:</span><br><span class="line">         pipe.watch(start_key)  <span class="comment"># We‚Äôll watch the start of the hour key for changes </span></span><br><span class="line">                                <span class="comment"># that only happen at the beginning of the hour.</span></span><br><span class="line"></span><br><span class="line">         now = datetime.utcnow().timetuple()</span><br><span class="line"></span><br><span class="line">         hour_start = datetime(*now[:<span class="number">4</span>]).isoformat()  <span class="comment"># Find the current start hour.</span></span><br><span class="line"></span><br><span class="line">         existing = pipe.get(start_key)</span><br><span class="line">         pipe.multi()  <span class="comment"># Set up the transaction.</span></span><br><span class="line"></span><br><span class="line">         <span class="keyword">if</span> existing <span class="keyword">and</span> existing &lt; hour_start:  <span class="comment"># If the current list of common logs is for a previous hour‚Ä¶</span></span><br><span class="line"></span><br><span class="line">            pipe.rename(destination, destination + <span class="string">':last'</span>)</span><br><span class="line">            pipe.rename(start_key, destination + <span class="string">':pstart'</span>)  <span class="comment"># ‚Ä¶move the old common log information to the archive.</span></span><br><span class="line"></span><br><span class="line">            pipe.set(start_key, hour_start)  <span class="comment"># Update the start of the current hour for the common logs.</span></span><br><span class="line"></span><br><span class="line">         pipe.zincrby(destination, message)  <span class="comment"># Actually increment our common counter.</span></span><br><span class="line"></span><br><span class="line">         log_recent(pipe, name, message, severity, pipe)  <span class="comment"># Call the log_recent() function to record these, </span></span><br><span class="line">                                                          <span class="comment"># and rely on its call to execute().</span></span><br><span class="line"></span><br><span class="line">         <span class="keyword">return</span></span><br><span class="line">   <span class="keyword">except</span> redis.exceptions.WatchError:</span><br><span class="line">         <span class="keyword">continue</span></span><br></pre></td></tr></table></figure>

<h2 id="Locks-in-Redis"><a href="#Locks-in-Redis" class="headerlink" title="Locks in Redis"></a>Locks in Redis</h2><p>In the context of Redis, we‚Äôve been using <code>WATCH</code> as a replacement for a lock, and we call it optimistic locking, because rather than actually preventing others from modifying the data, we‚Äôre notified if someone else changes the data before we do it ourselves. </p>
<p>With <strong>distributed locking, we have the same sort of acquire, operate, release operations</strong>, but instead of having a lock that‚Äôs only known by threads within the same process, or processes on the same machine, we <strong>use a lock that different Redis clients on different machines can acquire and release</strong>. When and whether to use locks or <code>WATCH</code> will depend on a given application; some applications don‚Äôt need locks to operate correctly, some only require locks for parts, and some require locks at every step.</p>
<h3 id="Problems-with-Watch"><a href="#Problems-with-Watch" class="headerlink" title="Problems with Watch"></a>Problems with Watch</h3><p>Consider the market example that we solved before with <code>WATCH</code> and <code>UNWATCH</code>: we <code>WATCH</code> the seller‚Äôs inventory to make sure the item is still available, add the item to the market <code>ZSET</code>, and remove it from the user‚Äôs inventory; to purchase of an item, we <code>WATCH</code> the market and the buyer‚Äôs <code>HASH</code>.</p>
<p>This would work correctly, however, <strong>when the scale of operation increases</strong>, the amount of retries that happen becomes huge, which could affect the latency:</p>
<table>
<thead>
<tr>
<th>-</th>
<th>Listed items</th>
<th>Bought items</th>
<th>Purchase retries</th>
<th>Average wait per purchase</th>
</tr>
</thead>
<tbody><tr>
<td>1 lister, 1 buyer</td>
<td>145,000</td>
<td>27,000</td>
<td>80,000</td>
<td>14ms</td>
</tr>
<tr>
<td>5 listers, 1 buyer</td>
<td>331,000</td>
<td>&lt;200</td>
<td>50,000</td>
<td>150ms</td>
</tr>
<tr>
<td>5 listers, 5 buyers</td>
<td>206,000</td>
<td>&lt;600</td>
<td>161,000</td>
<td>498ms</td>
</tr>
</tbody></table>
<p>To get past this limitation and actually start performing sales at scale, we must <strong>make sure that we only list or sell one item in the marketplace at any one time. We do this by using a lock.</strong></p>
<h3 id="Building-a-Simple-Lock"><a href="#Building-a-Simple-Lock" class="headerlink" title="Building a Simple Lock"></a>Building a Simple Lock</h3><p>The first part of <strong>making sure that no other code can run is to acquire the lock</strong>. The natural building block to use for acquiring a lock is the <code>SETNX</code> command, <strong>which will only set a value if the key doesn‚Äôt already exist.</strong> We‚Äôll set the value to be a unique identifier to ensure that no other process can get the lock, and the unique identifier we‚Äôll use is a 128-bit randomly generated UUID.</p>
<p>If we fail to acquire the lock initially, we‚Äôll retry until we acquire the lock, or until a specified timeout has passed, whichever comes first, as shown here.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">def acquire_lock(conn, lockname, acquire_timeout&#x3D;10):</span><br><span class="line">   identifier &#x3D; str(uuid.uuid4())# A 128-bit random identifier.</span><br><span class="line"></span><br><span class="line">   end &#x3D; time.time() + acquire_timeout</span><br><span class="line">   while time.time() &lt; end:</span><br><span class="line">      if conn.setnx(&#39;lock:&#39; + lockname, identifier):  # Get the lock.</span><br><span class="line"></span><br><span class="line">         return identifier</span><br><span class="line"></span><br><span class="line">      time.sleep(.001)  # sleep and retries</span><br><span class="line"></span><br><span class="line">   return False  # failed to get the lock within the amount of time</span><br></pre></td></tr></table></figure>

<p>Now that we have the lock, we can perform our buying or selling without <code>WATCH</code> errors getting in our way. We‚Äôll acquire the lock and, just like before, check the price of the item, make sure that the buyer has enough money, and if so, transfer the money and item. When completed, we release the lock.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">def purchase_item_with_lock(conn, buyerid, itemid, sellerid):</span><br><span class="line">   buyer &#x3D; &quot;users:%s&quot;%buyerid</span><br><span class="line">   seller &#x3D; &quot;users:%s&quot;%sellerid</span><br><span class="line">   item &#x3D; &quot;%s.%s&quot;%(itemid, sellerid)</span><br><span class="line">   inventory &#x3D; &quot;inventory:%s&quot;%buyerid</span><br><span class="line">   end &#x3D; time.time() + 30</span><br><span class="line"></span><br><span class="line">   lock_obtained &#x3D; acquire_lock(conn, market)  # Get the lock.</span><br><span class="line"></span><br><span class="line">   if !lock_obtained:</span><br><span class="line">       return False</span><br><span class="line">   else:</span><br><span class="line">	   pipe &#x3D; conn.pipeline(True)</span><br><span class="line">	   try:</span><br><span class="line">	      while time.time() &lt; end:</span><br><span class="line">	         try:</span><br><span class="line">	            pipe.watch(buyer)</span><br><span class="line">	</span><br><span class="line">	            pipe.zscore(&quot;market:&quot;, item)</span><br><span class="line">	            pipe.hget(buyer, &#39;funds&#39;)</span><br><span class="line">	            price, funds &#x3D; pipe.execute()</span><br><span class="line">	            if price is None or price &gt; funds:  # Check for a sold item or insufficient funds.</span><br><span class="line">	               pipe.unwatch()</span><br><span class="line">	               return None</span><br><span class="line">	</span><br><span class="line">	            pipe.hincrby(seller, int(price))</span><br><span class="line">	            pipe.hincrby(buyerid, int(-price))</span><br><span class="line">	            pipe.sadd(inventory, itemid)</span><br><span class="line">	            pipe.zrem(&quot;market:&quot;, item)</span><br><span class="line">	            pipe.execute()  # Transfer funds from the buyer to the seller, and transfer the item to the buyer.</span><br><span class="line">	</span><br><span class="line">	            return True</span><br><span class="line">	         except redis.exceptions.WatchError:</span><br><span class="line">	            pass</span><br><span class="line">		     finally:</span><br><span class="line">		        release_lock(conn, market, lock_obtained)</span><br></pre></td></tr></table></figure>

<p><strong>Between the time when we acquired the lock and when we‚Äôre trying to release it</strong>, someone may have done bad things to the lock. <strong>To release the lock, we need to <code>WATCH</code> the lock key,</strong> and then check to <strong>make sure that the value is still the same as what we set it to before we delete it.</strong> This also <strong>prevents us from releasing a lock multiple times.</strong> The <code>release_lock()</code> function is shown next.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">release_lock</span><span class="params">(conn, lockname, identifier)</span>:</span></span><br><span class="line">   pipe = conn.pipeline(<span class="literal">True</span>)</span><br><span class="line">   lockname = <span class="string">'lock:'</span> + lockname</span><br><span class="line"></span><br><span class="line">   <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">      <span class="keyword">try</span>:</span><br><span class="line">         pipe.watch(lockname)</span><br><span class="line">         <span class="keyword">if</span> pipe.get(lockname) == identifier:  <span class="comment"># Check and verify that we still have the lock.</span></span><br><span class="line"></span><br><span class="line">            pipe.multi()</span><br><span class="line">            pipe.delete(lockname)</span><br><span class="line">            pipe.execute()</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span>  <span class="comment"># Release the lock.</span></span><br><span class="line"></span><br><span class="line">         pipe.unwatch()</span><br><span class="line">         <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">except</span> redis.exceptions.WatchError:  <span class="comment"># Someone else did something with the lock; retry.</span></span><br><span class="line">										   <span class="comment"># this is actually kind of rare</span></span><br><span class="line">         <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> For simplicity, we performed lock on the entire <code>market</code> data, which also means that listing an item could be blocked. However, if we <strong>replace the market-level lock with one specific to the item to be bought or sold, we can reduce lock contention and increase performance.</strong></li>
</ul>
</blockquote>
<h3 id="Locks-with-timeouts"><a href="#Locks-with-timeouts" class="headerlink" title="Locks with timeouts"></a>Locks with timeouts</h3><p>The above locks still had one important problem: it doesn‚Äôt handle cases where a <strong>lock holder crashes without releasing the lock</strong>, or when a lock holder fails and holds the lock forever. To handle the crash/failure cases, we <strong>add a timeout to the lock.</strong></p>
<p>In order to give our lock a timeout, we‚Äôll <strong>use <code>EXPIRE</code> to have Redis time it out automatically.</strong> </p>
<p>The <strong>natural place to put the <code>EXPIRE</code> is immediately after the lock is acquired,</strong> and we‚Äôll do that. <strong>But if our client happens to crash (and the worst place for it to crash for us is between <code>SETNX</code> and <code>EXPIRE</code>), we still want the lock to eventually time out.</strong> To handle that situation, <strong>any time a client fails to get the lock, the client will check the expiration on the lock, and if it‚Äôs not set, set it.</strong>  This will make sure that the <strong>lock will always have a timeout</strong>, and will eventually expire, letting other clients get a timed-out lock.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">acquire_lock_with_timeout</span><span class="params">(conn, lockname, acquire_timeout=<span class="number">10</span>, lock_timeout=<span class="number">10</span>)</span>:</span></span><br><span class="line">   identifier = str(uuid.uuid4())</span><br><span class="line"></span><br><span class="line">   lock_timeout = int(math.ceil(lock_timeout))  <span class="comment"># Only pass integers to our EXPIRE calls.</span></span><br><span class="line"></span><br><span class="line">   end = time.time() + acquire_timeout</span><br><span class="line">   <span class="keyword">while</span> time.time() &lt; end:</span><br><span class="line">      <span class="keyword">if</span> conn.setnx(lockname, identifier):</span><br><span class="line">         conn.expire(lockname, lock_timeout)  <span class="comment"># Get the lock and set the expiration.</span></span><br><span class="line"></span><br><span class="line">         <span class="keyword">return</span> identifier</span><br><span class="line"></span><br><span class="line">      <span class="keyword">elif</span> <span class="keyword">not</span> conn.ttl(lockname):  <span class="comment"># Check and update the expiration time as necessary.</span></span><br><span class="line">         conn.expire(lockname, lock_timeout)</span><br><span class="line"></span><br><span class="line">      time.sleep(<span class="number">.001</span>)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p>This new <code>acquire_lock_with_timeout()</code> handles timeouts. It ensures that locks expire as necessary, and that they won‚Äôt be stolen from clients that rightfully have them. Even better, we were smart with our release lock function earlier, which still works.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> As of Redis 2.6.12, <strong>*the <code>SET</code> command added options to support a combination of <code>SETNX</code> and <code>SETEX</code> functionality</strong>, which makes our lock acquire function trivial. We still need the complicated release lock to be correct. In python, this looks like: <code>set(name, value, ex=None, px=None, nx=False, xx=False, keepttl=False)</code></li>
</ul>
</blockquote>
<h3 id="Building-a-Semaphore"><a href="#Building-a-Semaphore" class="headerlink" title="Building a Semaphore"></a>Building a Semaphore</h3><p>Sometimes, we need to use a semaphore to hold the ocks, instead of having a timeout lock shown above for a single use.</p>
<p>When building a counting semaphore, we run into many of the same concerns we had with other types of locking. We must decide who got the lock, how to handle processes that crashed with the lock, and how to handle <strong>timeouts</strong>. If we don‚Äôt care about timeouts, or handling the case where semaphore holders can crash without releasing semaphores.</p>
<p>In almost every case where we want to <strong>deal with timeouts in Redis</strong>, we‚Äôll generally look to <strong>one of two different methods</strong>. <strong>Either we‚Äôll use <code>EXPIRE</code> like we did with our standard locks, or we‚Äôll use <code>ZSETs</code></strong>. In this case, we want to <strong>use <code>ZSET</code>s</strong>, because that allows us to keep information about multiple semaphore holders in a single structure.</p>
<p>Now, to build a semaphore, we will have: <strong>for each process that attempts to acquire the semaphore, we‚Äôll generate a unique identifier.</strong> This identifier will be the member of a <code>ZSET</code>. For the <strong>score, we‚Äôll use the timestamp</strong> for when the process attempted to acquire the semaphore. When a process wants to <strong>attempt to acquire a semaphore</strong>, it <strong>first generates an identifier, and then the process adds the identifier to the <code>ZSET</code> using the current timestamp as the score</strong>. After adding the identifier, the process then checks for its identifier‚Äôs rank. <strong>If the rank returned is lower than the total allowed count</strong> (Redis uses 0-indexing on rank), then the caller has <strong>acquired the semaphore</strong>. Otherwise, the caller doesn‚Äôt have the semaphore and must delete its identifier from the <code>ZSET</code>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">acquire_semaphore</span><span class="params">(conn, semname, limit, timeout=<span class="number">10</span>)</span>:</span></span><br><span class="line">   identifier = str(uuid.uuid4())  <span class="comment"># A 128-bit random identifier.</span></span><br><span class="line"></span><br><span class="line">   now = time.time()</span><br><span class="line"></span><br><span class="line">   pipeline = conn.pipeline(<span class="literal">True</span>)</span><br><span class="line">   pipeline.zremrangebyscore(semname, <span class="string">'-inf'</span>, now - timeout)  <span class="comment"># Time out old semaphore holders.</span></span><br><span class="line"></span><br><span class="line">   pipeline.zadd(semname, identifier, now)  <span class="comment"># Try to acquire the semaphore.</span></span><br><span class="line"></span><br><span class="line">   pipeline.zrank(semname, identifier)</span><br><span class="line">   <span class="keyword">if</span> pipeline.execute()[<span class="number">-1</span>] &lt; limit:  <span class="comment"># Check to see if we have it.</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> identifier  <span class="comment"># got the semaphore</span></span><br><span class="line"></span><br><span class="line">   conn.zrem(semname, identifier)  <span class="comment"># We failed to get the semaphore; discard our identifier.</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="literal">None</span></span><br></pre></td></tr></table></figure>

<p>Releasing the semaphore is easy: we remove the identifier from the ZSET, as can be<br>seen in the next listing.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">release_semaphore</span><span class="params">(conn, semname, identifier)</span>:</span></span><br><span class="line">   <span class="keyword">return</span> conn.zrem(semname, identifier)</span><br></pre></td></tr></table></figure>

<p>However, there is <strong>a problem in this design as well</strong>. Since it is <strong>relying on every process having access to the same system time</strong> in order to get the semaphore can cause problems if we have multiple hosts. This isn‚Äôt a huge problem for our specific use case, but if we had two systems A and B, <strong>where A ran even 10 milliseconds faster than B</strong>, then if A got the last semaphore, and B tried to get a semaphore within 10 milliseconds, B would actually ‚Äústeal‚Äù A‚Äôs semaphore without A knowing it.</p>
<p>Any time we have a lock or a semaphore where <strong>such a slight difference in the system clock can drastically affect who can get the lock, the lock or semaphore is considered <code>unfair</code></strong>. Unfair locks and semaphores can cause clients that should‚Äôve gotten the lock or semaphore to never get it, and this is something that we‚Äôll fix in the next section.</p>
<h3 id="Fair-Semaphore"><a href="#Fair-Semaphore" class="headerlink" title="Fair Semaphore"></a>Fair Semaphore</h3><p>In order to minimize problems with inconsistent system times, <strong>we‚Äôll add a <code>counter</code> (a <code>String</code>) and a second <code>ZSET</code>.</strong> The <strong><code>counter</code> creates a steadily increasing timer-like mechanism</strong> that ensures that whoever incremented the counter first should be the one to get the semaphore.</p>
<p>We then enforce our requirement that <strong>clients that want the semaphore who get the <code>counter</code> first</strong> also get the <strong>semaphore inside an ‚Äúowner‚Äù <code>ZSET</code> with the counter-produced value as the score</strong>, checking our identifier‚Äôs rank in the new <code>ZSET</code> to determine which client got the semaphore.</p>
<p><img src="/.com//06/02/Redis-Manual/fair-semaphore.png" alt="Picture from https://redislabs.com/ebook/part-2-core-concepts/chapter-6-application-components-in-redis/6-3-counting-semaphores/6-3-2-fair-semaphores/" title="Picture from https://redislabs.com/ebook/part-2-core-concepts/chapter-6-application-components-in-redis/6-3-counting-semaphores/6-3-2-fair-semaphores/"></p>
<p>We continue to <strong>handle timeouts the same way as our basic semaphore</strong>, by <strong>removing entries from the system time <code>ZSET</code></strong>. We <strong>propagate those timeouts to the new owner <code>ZSET</code></strong> by the use of <code>ZINTERSTORE</code> and the <code>WEIGHTS</code>argument.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">acquire_fair_semaphore</span><span class="params">(conn, semname, limit, timeout=<span class="number">10</span>)</span>:</span></span><br><span class="line">   identifier = str(uuid.uuid4())  <span class="comment"># A 128-bit random identifier.</span></span><br><span class="line"></span><br><span class="line">   czset = semname + <span class="string">':owner'</span></span><br><span class="line">   ctr = semname + <span class="string">':counter'</span></span><br><span class="line"></span><br><span class="line">   now = time.time()</span><br><span class="line">   pipeline = conn.pipeline(<span class="literal">True</span>)</span><br><span class="line">   pipeline.zremrangebyscore(semname, <span class="string">'-inf'</span>, now - timeout)  <span class="comment"># Time out old entries.</span></span><br><span class="line">   pipeline.zinterstore(czset, &#123;czset: <span class="number">1</span>, semname: <span class="number">0</span>&#125;)  <span class="comment"># since they have the same UUID member name</span></span><br><span class="line">											  		    <span class="comment"># weights for czset is 1, semanme is 0</span></span><br><span class="line"></span><br><span class="line">   pipeline.incr(ctr)</span><br><span class="line">   counter = pipeline.execute()[<span class="number">-1</span>]  <span class="comment"># Get the counter.</span></span><br><span class="line"></span><br><span class="line">   pipeline.zadd(semname, identifier, now)</span><br><span class="line">   pipeline.zadd(czset, identifier, counter)</span><br><span class="line"></span><br><span class="line">   pipeline.zrank(czset, identifier)  <span class="comment"># Try to acquire the semaphore.</span></span><br><span class="line">   <span class="keyword">if</span> pipeline.execute()[<span class="number">-1</span>] &lt; limit:  <span class="comment"># Check the rank to determine if we got the semaphore.</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> identifier  <span class="comment"># We got the semaphore.</span></span><br><span class="line"></span><br><span class="line">   pipeline.zrem(semname, identifier)</span><br><span class="line">   pipeline.zrem(czset, identifier)  <span class="comment"># We didn‚Äôt get the semaphore; clean out the bad data.</span></span><br><span class="line"></span><br><span class="line">   pipeline.execute()</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">None</span></span><br></pre></td></tr></table></figure>

<p>Releasing the semaphore is almost as easy as before, only now we <strong>remove our identifier from both the owner and timeout <code>ZSET</code>s</strong>, as can be seen in this next listing.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">release_fair_semaphore</span><span class="params">(conn, semname, identifier)</span>:</span></span><br><span class="line">   pipeline = conn.pipeline(<span class="literal">True</span>)</span><br><span class="line">   pipeline.zrem(semname, identifier)</span><br><span class="line">   pipeline.zrem(semname + <span class="string">':owner'</span>, identifier)</span><br><span class="line">   <span class="keyword">return</span> pipeline.execute()[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/06/02/Redis-Manual/" data-id="ckaxrmfph00009cor310hfxk3" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-MySQL-Manual" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/05/26/MySQL-Manual/" class="article-date">
  <time datetime="2020-05-26T02:34:48.000Z" itemprop="datePublished">2020-05-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/05/26/MySQL-Manual/">MySQL Manual</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>IMPORTANT</strong>:<br>Much of the content here is a personal summary/abbrieviation of contents on the <a href="https://dev.mysql.com/doc/refman/8.0/en/tutorial.html" target="_blank" rel="noopener">Offical MySQL Guide</a>. For more complete information, please refer to the offical site.</p>
<hr>
<h2 id="MySQL-Intro"><a href="#MySQL-Intro" class="headerlink" title="MySQL Intro"></a>MySQL Intro</h2><p>The <strong>MySQL client program</strong> can be used to create and use a simple database. MySQL (sometimes referred to as the ‚Äúterminal monitor‚Äù or just ‚Äúmonitor‚Äù) is an interactive program that enables you to <strong>connect to a MySQL server</strong>, run queries, and view the results.</p>
<p>The MySQL server package will install the <strong>MySQL database server</strong> which you can <strong>interact with using a MySQL client</strong>. You can use the MySQL client to send commands to any MySQL server; on a remote computer or your own.</p>
<p>The <strong>MySQL server is used to persist the data and provide a query interface for it (SQL)</strong>. The MySQL clients purpose is to allow you to use that query interface.</p>
<p>On how to setup your MySQL Server, please refer to <a href="https://jasonyux.github.io/2020/05/25/Docker-Manual/#MySQL-in-Docker" target="_blank" rel="noopener">here</a></p>
<h2 id="Connecting-to-a-MySQL-Server"><a href="#Connecting-to-a-MySQL-Server" class="headerlink" title="Connecting to a MySQL Server"></a>Connecting to a MySQL Server</h2><ul>
<li><p>If you have installed the MySQL server on Docker using the guide <a href="https://jasonyux.github.io/2020/05/25/Docker-Manual/#MySQL-in-Docker" target="_blank" rel="noopener">here</a>, then you should be already connected to your local SQL server. If not, try to run (assuming you have the container running):</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it &lt;yourSQLServerName&gt; mysql -u root -p</span><br></pre></td></tr></table></figure>
<p>  This will prompt to enter the password.</p>
<p>  If you entered successfully, you will see:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>If you want to connect to a remote SQL server, then you need to specify a <code>host</code> name. Contact your administrator to find out what connection parameters you should use to connect (that is, what <code>host</code>, <code>user</code> name, and <code>password</code> to use). Then, you would run:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mysql -h &lt;hostName&gt; -u &lt;userName&gt; -p</span><br><span class="line">Enter password: &lt;yourPasswordHere&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>To disconnect from that SQL server, simply run:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QUIT</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="Basic-Queries-in-MySQL-Client"><a href="#Basic-Queries-in-MySQL-Client" class="headerlink" title="Basic Queries in MySQL Client"></a>Basic Queries in MySQL Client</h2><p>Make sure that you are <strong>connected to the server</strong>, as discussed in the previous section. Doing so <strong>does not in itself select any database to work with</strong>, but that is okay. There are still several queries you can do to have a basic sense of how MySQL works:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT VERSION(), CURRENT_DATE;</span><br><span class="line">+-----------+--------------+</span><br><span class="line">| VERSION() | CURRENT_DATE |</span><br><span class="line">+-----------+--------------+</span><br><span class="line">| 8.0.20    | 2020-05-26   |</span><br><span class="line">+-----------+--------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> You <strong>need to have the semi-colon ‚Äú<code>;</code>‚Äú for ending your query</strong>, before pressing <code>enter</code>. If not, you will automatically goes to the next line to continue input. However, there are <strong>some exceptions where a semicolon may be omitted</strong>. <code>QUIT</code>, mentioned earlier, is one of them. We‚Äôll get to others later.)</li>
<li><input disabled type="checkbox"> The query may be entered in any lettered case. The following queries are equivalent: <code>mysql&gt; SELECT VERSION(), CURRENT_DATE;</code> <code>mysql&gt; select version(), current_date;</code> <code>mysql&gt; SeLeCt vErSiOn(), current_DATE;</code> </li>
</ul>
</blockquote>
<p>From the simple command, you can see several things about a query:</p>
<ul>
<li><p>When you issue a query, MySQL <strong>sends it to the server</strong> for execution and displays the results, then prints another <code>mysql&gt;</code> prompt to indicate that it is ready for another query.</p>
</li>
<li><p>MySQL <strong>displays query output in tabular form (rows and columns)</strong>. The <strong>first row contains labels/titles</strong> for the columns. The <strong>rows following are the query results</strong>. Normally, column labels are the names of the columns you fetch from database tables. If you‚Äôre retrieving the value of <strong>an expression rather than an actual label/title</strong>, mysql labels the column <strong>using the expression itself</strong>.</p>
</li>
<li><p>MySQL shows, in the end, <strong>how many rows were returned and how long the query took to execute</strong>, which gives you a rough idea of <strong>server performance</strong>. These values are imprecise because they represent wall clock time (not CPU or machine time), and because they are affected by factors such as server load and network latency.</p>
</li>
</ul>
<p>Other examples of a query include:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select cos(pi()&#x2F;2), (4+1)*2;</span><br><span class="line">+-----------------------+---------+</span><br><span class="line">| cos(pi()&#x2F;2)           | (4+1)*2 |</span><br><span class="line">+-----------------------+---------+</span><br><span class="line">| 6.123233995736766e-17 |      10 |</span><br><span class="line">+-----------------------+---------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>and you can make <strong>two or more queries simultaneouly by using the delimiter ‚Äú<code>;</code>‚Äú</strong>, for example to seperate the above query into two:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select cos(pi()&#x2F;2);select (4+1)*2;</span><br><span class="line">+-----------------------+</span><br><span class="line">| cos(pi()&#x2F;2)           |</span><br><span class="line">+-----------------------+</span><br><span class="line">| 6.123233995736766e-17 |</span><br><span class="line">+-----------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">+---------+</span><br><span class="line">| (4+1)*2 |</span><br><span class="line">+---------+</span><br><span class="line">|      10 |</span><br><span class="line">+---------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>finally, you can also use a multiline query as well, given that you had the correct punctuations in place :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select</span><br><span class="line">    -&gt; cos(pi()&#x2F;2)</span><br><span class="line">    -&gt; , (4+1)*2</span><br><span class="line">    -&gt; ;</span><br><span class="line">+-----------------------+---------+</span><br><span class="line">| cos(pi()&#x2F;2)           | (4+1)*2 |</span><br><span class="line">+-----------------------+---------+</span><br><span class="line">| 6.123233995736766e-17 |      10 |</span><br><span class="line">+-----------------------+---------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>
<p>or</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select cos(pi()&#x2F;2); select</span><br><span class="line">+-----------------------+</span><br><span class="line">| cos(pi()&#x2F;2)           |</span><br><span class="line">+-----------------------+</span><br><span class="line">| 6.123233995736766e-17 |</span><br><span class="line">+-----------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">    -&gt; (4+1)*2;</span><br><span class="line">+---------+</span><br><span class="line">| (4+1)*2 |</span><br><span class="line">+---------+</span><br><span class="line">|      10 |</span><br><span class="line">+---------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note </p>
<ul>
<li><input disabled type="checkbox"> <strong>If your line ended with a ‚Äú<code>;</code>‚Äú</strong>, you cannot enter further input but to start another new command. In the above examples, notice how the prompt changes from <code>mysql&gt;</code> to <code>-&gt;</code>, which indicates you are at a line of a <strong>multiple-line query</strong>.</li>
</ul>
</blockquote>
<ul>
<li>To cancel the multiline query, you could use <code>\c</code>:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select user()</span><br><span class="line">    -&gt; \c</span><br><span class="line">\c</span><br><span class="line">^C</span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>

<p>Here is a table summarizing the prompts you will see in MySQL:</p>
<table>
<thead>
<tr>
<th>Prompt</th>
<th>Meaning</th>
</tr>
</thead>
<tbody><tr>
<td><code>mysql&gt;</code></td>
<td>Ready for new query</td>
</tr>
<tr>
<td><code>-&gt;</code></td>
<td>Waiting for next line of multiple-line query</td>
</tr>
<tr>
<td><code>&#39;&gt;</code></td>
<td>Waiting for next line, waiting for completion of a string that began with a single quote (<code>&#39;</code>)</td>
</tr>
<tr>
<td><code>&quot;&gt;</code></td>
<td>Waiting for next line, waiting for completion of a string that began with a double quote (<code>&quot;</code>)</td>
</tr>
<tr>
<td>``&gt;    `</td>
<td>Waiting for next line, waiting for completion of an identifier that began with a backtick (<code>`</code>)</td>
</tr>
<tr>
<td><code>/*&gt;</code></td>
<td>Waiting for next line, waiting for completion of a comment that began with <code>/*</code></td>
</tr>
</tbody></table>
<p>For example, if you have missed a <code>&#39;</code> at the end of the line:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM my_table WHERE name &#x3D; &#39;Smith AND age &lt; 30;</span><br><span class="line">    &#39;&gt;</span><br></pre></td></tr></table></figure>
<p>This means that <code>mysql</code> is <strong>expecting another <code>&#39;</code> at the end</strong>, which you have missed in this case.</p>
<p>The solution, sadly, is to <strong>cancel the input</strong> and do it corretcly the <strong>next time</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM my_table WHERE name &#x3D; &#39;Smith AND age &lt; 30;</span><br><span class="line">    &#39;&gt; \c</span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Viewing-and-Creating-a-Database"><a href="#Viewing-and-Creating-a-Database" class="headerlink" title="Viewing and Creating a Database"></a>Viewing and Creating a Database</h2><ul>
<li><p>To first <strong>see what databases you have access to</strong>, you can use the command:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">+--------------------+</span><br></pre></td></tr></table></figure>
<p>  These databases are the ones that <strong>you have access to</strong>. If you don‚Äôt have access to a database, you will not see it here.</p>
<p>  Then, to switch to use a database (for example, <code>sys</code>), you can run the command:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use sys</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> The <code>use</code> command is another command (exception) that does not require a semi-colon to end. However, it does no harm to put one in the end anyway.</li>
<li><input disabled type="checkbox"> Having access to a database means a lot. It means that you could insert or delete anything in that database. So usually to have an access to a database you would need to ask your administrator.</li>
</ul>
</blockquote>
</li>
<li><p>Now, to <strong>create a database</strong>, say you call it <code>test</code>, you could run:</p>
  <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create database test;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Under Unix, <strong>database names are case-sensitive</strong> (<strong>unlike SQL keywords</strong>), so you must always refer to your database as test, not as Test, TEST, or some other variant. </li>
</ul>
</blockquote>
<p>  However, at this point you have only created a database, and you are still in the database <code>sys</code> (follows from the previous example). To switch to the database <code>test</code> you created, you need to explicitly call again:</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use test;</span><br><span class="line">Database changed</span><br></pre></td></tr></table></figure>

<p>  Now, the next time you want to connect to the database <code>test</code>, you could directly run:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mysql -u root -p test</span><br><span class="line">Enter password: ********</span><br></pre></td></tr></table></figure>

<p>  and in general, to connect to a database <code>databaseName</code> from start up, you could do:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mysql -h &lt;hostName&gt; -u &lt;userName&gt; -p &lt;databaseName&gt;</span><br><span class="line">Enter password: ********</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> <code>&lt;databaseName&gt;</code> in the command just shown is <strong>not your password</strong>. If you want to supply your password on the <strong>command line after the <code>-p</code> option</strong>, you must <strong>do so with no intervening space (for example, as -p<password>, not as -p <password>)</password></password></strong>. However, putting your password on the command line is <strong>not recommended</strong>, because doing so exposes it to snooping by other users logged in on your machine.</li>
</ul>
</blockquote>
</li>
<li><p>To see <strong>which database you are currently in</strong>, you could use the query:</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select database();</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">| database() |</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">| test       |</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="Viewing-and-Creating-a-Table"><a href="#Viewing-and-Creating-a-Table" class="headerlink" title="Viewing and Creating a Table"></a>Viewing and Creating a Table</h2><ul>
<li><p>To see what tables you have in a database you are currently in, you can use:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show tables;</span><br><span class="line">Empty set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>  In this case, we are in the <code>test</code> database that we just created so there is nothing.</p>
</li>
<li><p>Now, consider the example on the <a href="#https://dev.mysql.com/doc/refman/8.0/en/creating-tables.html">MySQL site</a>, where you would like to record information for <strong>each of your pets</strong> (if you don‚Äôt have many, imagine you do). Then this can be called the <code>pet</code> <strong>table</strong>, and it should contain, as a bare minimum, <strong>each animal‚Äôs name</strong> (as an entry). Then, you could <strong>add other information</strong> about each of your pet in the table. For example, if more than one person in your family keeps pets, you might want to list each animal‚Äôs owner. You might also want to record some basic descriptive information such as species and sex.</p>
<p>  How about age? That might be of interest, but it is not a good thing to store in a database. <strong>Age changes as time passes</strong>, which means you‚Äôd have to update your records often. Instead, it is <strong>better</strong> to <strong>store a fixed value such as date of birth</strong>. Then, whenever you need age, you can calculate it as the difference between the current date and the birth date. MySQL provides functions for doing date arithmetic (as you saw before), so this is not difficult.</p>
<p>  You can probably think of other types of information that would be useful in the pet table, but the ones identified so far are sufficient and will be used in this example: <code>name</code>, <code>owner</code>, <code>species</code>, <code>sex</code>, <code>birth</code>, and <code>death</code>:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table pet (name varchar(20), owner varchar(20), species varchar(20), sex char(1), birth date, death date);</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br></pre></td></tr></table></figure>

<p>  Notice that we use <code>char()</code> and <code>varchar()</code>:</p>
<ul>
<li><p>The length of a <code>CHAR</code>/<code>char</code> column is <strong>fixed to the length that you declare when you create the table</strong>. For example, <strong><code>char(1)</code></strong> means it can <strong>hold up to 1 character</strong>. The length can be any value from 0 to 255. When <strong>CHAR values are stored</strong>, they are <strong>right-padded with spaces</strong> to the specified length. When CHAR values are <strong>retrieved</strong>, 8<em>trailing spaces are removed*</em> unless the <code>PAD_CHAR_TO_FULL_LENGTH</code> SQL mode is enabled.</p>
</li>
<li><p>Values in <code>VARCHAR</code> columns are <strong>variable-length strings</strong>.??? The length can be specified as a value from 0 to 65,535. The effective maximum length of a VARCHAR is subject to the maximum row size (65,535 bytes, which is shared among all columns) and the character set used. In contrast to <code>CHAR</code>, <code>VARCHAR</code> values are stored as a <strong>1-byte or 2-byte length prefix</strong> plus data. The <strong>length prefix indicates the number of bytes in the value</strong>. A column uses <strong>one length byte if values require no more than 255 bytes</strong>, <strong>two length bytes if values may require more than 255 bytes</strong>.</p>
<p>To make sure you have your table <code>pet</code> created as the way you wanted, you can run:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; describe pet;</span><br><span class="line">+---------+-------------+------+-----+---------+-------+</span><br><span class="line">| Field   | Type        | Null | Key | Default | Extra |</span><br><span class="line">+---------+-------------+------+-----+---------+-------+</span><br><span class="line">| name    | varchar(20) | YES  |     | NULL    |       |</span><br><span class="line">| owner   | varchar(20) | YES  |     | NULL    |       |</span><br><span class="line">| species | varchar(20) | YES  |     | NULL    |       |</span><br><span class="line">| sex     | char(1)     | YES  |     | NULL    |       |</span><br><span class="line">| birth   | date        | YES  |     | NULL    |       |</span><br><span class="line">| death   | date        | YES  |     | NULL    |       |</span><br><span class="line">+---------+-------------+------+-----+---------+-------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>If you have made a mistake somewhere, and you want to change the <code>type</code> or the <code>field</code> name, you could use:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; ALTER TABLE pet CHANGE &lt;fromFieldName&gt; &lt;toFieldName&gt; &lt;Type&gt;</span><br></pre></td></tr></table></figure>

<p>or if you only want to change the <code>type</code>, you can use:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; ALTER TABLE pet MODIFY &lt;fieldName&gt; &lt;newType&gt;</span><br></pre></td></tr></table></figure>
<p>(you <strong>cannot only modify the <code>field</code> name</strong>) More examples on modifying the table please refer to <a href="#https://dev.mysql.com/doc/refman/8.0/en/alter-table-examples.html">here</a>.</p>
</li>
</ul>
</li>
</ul>
<h2 id="Loading-and-Inserting-Data-into-a-Table"><a href="#Loading-and-Inserting-Data-into-a-Table" class="headerlink" title="Loading and Inserting Data into a Table"></a>Loading and Inserting Data into a Table</h2><p>After creating a table, you need to populate it. The <code>LOAD DATA</code> and <code>INSERT</code> statements are useful for this.</p>
<p>Suppose you have the following data as shown below (notice that MySQL expects <strong>dates in <code>YYYY-MM-DD</code> format</strong>):</p>
<p><img src="/.com//05/26/MySQL-Manual/pet-data.png" alt="https://dev.mysql.com/doc/refman/8.0/en/loading-tables.html" title="Table from https://dev.mysql.com/doc/refman/8.0/en/loading-tables.html"></p>
<p>Because you are beginning with an empty table, an easy way to populate it is to create a <strong>text file containing a row for each of your animals</strong>, then <code>load</code> the contents of the file into the table.</p>
<p>For exapmle, create a text file <code>pet.txt</code> containing <strong>one record per line</strong>, with values <strong>separated by tabs</strong>, (for <code>csv</code> files, refer to <a href="https://dev.mysql.com/doc/refman/8.0/en/load-data.html" target="_blank" rel="noopener">this</a>) and given <strong>in the order in which the columns were listed</strong> in the table. For <strong>missing values</strong> (such as unknown sexes or death dates for animals that are still living), you can <strong>use <code>\N</code></strong>, which represent null values:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Whistler        Gwen    bird    \N      1997-12-09      \N</span><br></pre></td></tr></table></figure>

<p>Then, you can import by:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; LOAD DATA LOCAL INFILE &#39;&#x2F;path&#x2F;pet.txt&#39; INTO TABLE pet;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> If you run into problems with importing a file, then probably you need to <strong>configure your SQL server</strong> for permission with file import. By default, this is <strong>disabled due to safety concerns</strong>. To configure this, please follow the guide <a href="#https://dev.mysql.com/doc/mysql-secure-deployment-guide/5.7/en/secure-deployment-post-install.html">here</a></li>
</ul>
</blockquote>
<p>When you want to <strong>add new records one at a time</strong>, the <code>INSERT</code> statement is useful. In its simplest form, you <strong>supply values for each column</strong>, <strong>in the order in which the columns were listed</strong> in the CREATE TABLE statement. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; INSERT INTO pet VALUES (&#39;Fluffy&#39;,&#39;Harold&#39;,&#39;cat&#39;,&#39;f&#39;,&#39;1993-02-04&#39;,NULL);</span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br></pre></td></tr></table></figure>
<p>Notice that <strong>String and date values are specified as quoted strings</strong> here. Also, with <code>INSERT</code>, you can <strong>insert <code>NULL</code> directly to represent a missing value</strong>. You <strong>do not use <code>\N</code></strong> like you do with <code>LOAD DATA</code>.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> The values in the table <strong>does not have to be distinct</strong>. This means that you can <code>INSERT</code> two same rows into the table without any trouble. However, to delete the non-distinct rows, you might need to do some <a href="https://www.sqlservertutorial.net/sql-server-basics/delete-duplicates-sql-server/" target="_blank" rel="noopener">work</a>.</li>
</ul>
</blockquote>
<h2 id="Retrieving-Selecting-All-Information-from-a-Table"><a href="#Retrieving-Selecting-All-Information-from-a-Table" class="headerlink" title="Retrieving/Selecting All Information from a Table"></a>Retrieving/Selecting All Information from a Table</h2><p>The <code>SELECT</code> statement is used to pull information from a table. The <strong>general form of the statement</strong> is:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT &lt;what_to_select&gt;</span><br><span class="line">FROM &lt;which_table&gt;</span><br><span class="line">WHERE &lt;conditions_to_satisfy&gt;;</span><br></pre></td></tr></table></figure>
<p>where</p>
<ul>
<li><code>&lt;what_to_select&gt;</code> indicates <strong>what you want to see</strong>. This can be a <strong>list of columns</strong>, or * to indicate ‚Äúall columns.‚Äù </li>
<li><code>&lt;which_table&gt;</code> indicates the <strong>table from which you want to retrieve data</strong>. The WHERE clause is optional. </li>
<li><code>&lt;conditions_to_satisfy&gt;</code> specifies one or more <strong>conditions that rows must satisfy</strong> to qualify for retrieval, <strong>if it is present</strong>.</li>
</ul>
<p>This means you can select all data by simply running:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM pet;</span><br><span class="line">+----------+--------+---------+------+------------+------------+</span><br><span class="line">| name     | owner  | species | sex  | birth      | death      |</span><br><span class="line">+----------+--------+---------+------+------------+------------+</span><br><span class="line">| Fluffy   | Harold | cat     | f    | 1993-02-04 | NULL       |</span><br><span class="line">| Claws    | Gwen   | cat     | m    | 1994-03-17 | NULL       |</span><br><span class="line">| Buffy    | Harold | dog     | f    | 1989-05-13 | NULL       |</span><br><span class="line">| Fang     | Benny  | dog     | m    | 1990-08-27 | NULL       |</span><br><span class="line">| Bowser   | Diane  | dog     | m    | 1979-08-31 | 1995-07-29 |</span><br><span class="line">| Chirpy   | Gwen   | bird    | f    | 1998-09-11 | NULL       |</span><br><span class="line">| Whistler | Gwen   | bird    | NULL | 1997-12-09 | NULL       |</span><br><span class="line">| Slim     | Benny  | snake   | m    | 1996-04-29 | NULL       |</span><br><span class="line">| Puffball | Diane  | hamster | f    | 1999-03-30 | NULL       |</span><br><span class="line">+----------+--------+---------+------+------------+------------+</span><br></pre></td></tr></table></figure>
<p>However, if at this point, you have found that some values are wrong in a specific row, perhaps you miss-typed in your <code>txt</code> file, then you could either <strong>delete the entire table and re-insert the correct <code>txt</code></strong>, or <strong>updating that specific value</strong>:</p>
<ol>
<li><p>You can first fix your <code>txt</code> file and then run this:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; DELETE FROM pet;</span><br><span class="line">mysql&gt; LOAD DATA LOCAL INFILE &#39;pet.txt&#39; INTO TABLE pet;</span><br></pre></td></tr></table></figure></li>
<li><p>You could also only fix the wrong one (<code>Bowser</code>‚Äòs <code>birth</code>, for example) by:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; UPDATE pet SET birth &#x3D; &#39;1989-08-31&#39; WHERE name &#x3D; &#39;Bowser&#39;;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="Selecting-a-Particular-Row"><a href="#Selecting-a-Particular-Row" class="headerlink" title="Selecting a Particular Row"></a>Selecting a Particular Row</h2><p>You can select only particular rows from your table, by <strong>specifying the <code>WHERE</code> option</strong>. For example, if you want to verify the change that you made to Bowser‚Äôs birth date, select Bowser‚Äôs record like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM pet WHERE name &#x3D; &#39;Bowser&#39;;</span><br><span class="line">+--------+-------+---------+------+------------+------------+</span><br><span class="line">| name   | owner | species | sex  | birth      | death      |</span><br><span class="line">+--------+-------+---------+------+------------+------------+</span><br><span class="line">| Bowser | Diane | dog     | m    | 1989-08-31 | 1995-07-29 |</span><br><span class="line">+--------+-------+---------+------+------------+------------+</span><br></pre></td></tr></table></figure>
<p>or </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT birth FROM pet WHERE name &#x3D; &#39;Bowser&#39;;</span><br><span class="line">+------------+</span><br><span class="line">| birth      |</span><br><span class="line">+------------+</span><br><span class="line">| 1989-08-31 |</span><br><span class="line">+------------+</span><br></pre></td></tr></table></figure>

<p>In general, you can specify <strong>any expression for the <code>WHERE</code> option as long as it can be evaluted to either <code>true</code> or <code>false</code></strong>. This means, for example, you can <strong>specify inequality</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM pet WHERE birth &gt;&#x3D; &#39;1998-1-1&#39;;</span><br><span class="line">+----------+-------+---------+------+------------+-------+</span><br><span class="line">| name     | owner | species | sex  | birth      | death |</span><br><span class="line">+----------+-------+---------+------+------------+-------+</span><br><span class="line">| Chirpy   | Gwen  | bird    | f    | 1998-09-11 | NULL  |</span><br><span class="line">| Puffball | Diane | hamster | f    | 1999-03-30 | NULL  |</span><br><span class="line">+----------+-------+---------+------+------------+-------+</span><br></pre></td></tr></table></figure>
<p>and you can use <strong>logical operators</strong> such as <strong>AND</strong> and <strong>OR</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM pet WHERE species &#x3D; &#39;dog&#39; AND sex &#x3D; &#39;f&#39;;</span><br><span class="line">+-------+--------+---------+------+------------+-------+</span><br><span class="line">| name  | owner  | species | sex  | birth      | death |</span><br><span class="line">+-------+--------+---------+------+------------+-------+</span><br><span class="line">| Buffy | Harold | dog     | f    | 1989-05-13 | NULL  |</span><br><span class="line">+-------+--------+---------+------+------------+-------+</span><br></pre></td></tr></table></figure>
<p>You can even combine the operators like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM pet WHERE (species &#x3D; &#39;cat&#39; AND sex &#x3D; &#39;m&#39;)</span><br><span class="line">       OR (species &#x3D; &#39;dog&#39; AND sex &#x3D; &#39;f&#39;);</span><br><span class="line">+-------+--------+---------+------+------------+-------+</span><br><span class="line">| name  | owner  | species | sex  | birth      | death |</span><br><span class="line">+-------+--------+---------+------+------------+-------+</span><br><span class="line">| Claws | Gwen   | cat     | m    | 1994-03-17 | NULL  |</span><br><span class="line">| Buffy | Harold | dog     | f    | 1989-05-13 | NULL  |</span><br><span class="line">+-------+--------+---------+------+------------+-------+</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> <code>AND</code> and <code>OR</code> may be intermixed, although <strong><code>AND</code> has higher precedence than <code>OR</code></strong>. If you use both operators, it is a good idea to <strong>use parentheses to indicate explicitly how conditions should be grouped.</strong></li>
<li><input disabled type="checkbox"> If you want querey for pets that are <code>not dead</code>, then you should use <code>death IS NOT NULL</code> rather than <code>death&lt;&gt;NULL</code> (yes, <code>&lt;&gt;</code> means not equal to) <strong>because NULL is a special value that cannot be compared</strong> using the usual comparison operators. This is discussed later. </li>
</ul>
</blockquote>
<h2 id="Selecting-Particular-Columns"><a href="#Selecting-Particular-Columns" class="headerlink" title="Selecting Particular Columns"></a>Selecting Particular Columns</h2><p>You can select a particular column by:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT owner FROM pet;</span><br><span class="line">+--------+</span><br><span class="line">| owner  |</span><br><span class="line">+--------+</span><br><span class="line">| Harold |</span><br><span class="line">| Gwen   |</span><br><span class="line">| Harold |</span><br><span class="line">| Benny  |</span><br><span class="line">| Diane  |</span><br><span class="line">| Gwen   |</span><br><span class="line">| Gwen   |</span><br><span class="line">| Benny  |</span><br><span class="line">| Diane  |</span><br><span class="line">+--------+</span><br></pre></td></tr></table></figure>
<p>If you want to see more than one column, use thet ‚Äú<code>,</code>‚Äú as the delimiter:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT name, birth FROM pet;</span><br><span class="line">+----------+------------+</span><br><span class="line">| name     | birth      |</span><br><span class="line">+----------+------------+</span><br><span class="line">| Fluffy   | 1993-02-04 |</span><br><span class="line">| Claws    | 1994-03-17 |</span><br><span class="line">| Buffy    | 1989-05-13 |</span><br><span class="line">| Fang     | 1990-08-27 |</span><br><span class="line">| Bowser   | 1989-08-31 |</span><br><span class="line">| Chirpy   | 1998-09-11 |</span><br><span class="line">| Whistler | 1997-12-09 |</span><br><span class="line">| Slim     | 1996-04-29 |</span><br><span class="line">| Puffball | 1999-03-30 |</span><br><span class="line">+----------+------------+</span><br></pre></td></tr></table></figure>
<p>You can combine <strong><code>WHERE</code> clause (row selection)</strong> with <strong>column selection</strong>. For example, to get <code>birth</code> dates for dogs and cats only, use this query:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT name, species, birth FROM pet</span><br><span class="line">       WHERE species &#x3D; &#39;dog&#39; OR species &#x3D; &#39;cat&#39;;</span><br><span class="line">+--------+---------+------------+</span><br><span class="line">| name   | species | birth      |</span><br><span class="line">+--------+---------+------------+</span><br><span class="line">| Fluffy | cat     | 1993-02-04 |</span><br><span class="line">| Claws  | cat     | 1994-03-17 |</span><br><span class="line">| Buffy  | dog     | 1989-05-13 |</span><br><span class="line">| Fang   | dog     | 1990-08-27 |</span><br><span class="line">| Bowser | dog     | 1989-08-31 |</span><br><span class="line">+--------+---------+------------+</span><br></pre></td></tr></table></figure>

<h2 id="Sorting-the-Table-by-Rows"><a href="#Sorting-the-Table-by-Rows" class="headerlink" title="Sorting the Table by Rows"></a>Sorting the Table by Rows</h2><ul>
<li><p>To sort a table (which is only <strong>meaningful w.r.t a particular row</strong>), use an <code>ORDER BY</code> clause, which by default sorts a <strong>comparable entry in a ascending order</strong>.</p>
<p>  For example, we could sort the animals by their <code>birth</code> date:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT name, birth FROM pet ORDER BY birth;</span><br><span class="line">+----------+------------+</span><br><span class="line">| name     | birth      |</span><br><span class="line">+----------+------------+</span><br><span class="line">| Buffy    | 1989-05-13 |</span><br><span class="line">| Bowser   | 1989-08-31 |</span><br><span class="line">| Fang     | 1990-08-27 |</span><br><span class="line">| Fluffy   | 1993-02-04 |</span><br><span class="line">| Claws    | 1994-03-17 |</span><br><span class="line">| Slim     | 1996-04-29 |</span><br><span class="line">| Whistler | 1997-12-09 |</span><br><span class="line">| Chirpy   | 1998-09-11 |</span><br><span class="line">| Puffball | 1999-03-30 |</span><br><span class="line">+----------+------------+</span><br></pre></td></tr></table></figure>

<p>  You can also sort by <code>name</code>, which would mean invoking <strong>comparison on character type</strong> entries. In this case, sorting ‚Äî like all other comparison operations ‚Äî <strong>is normally performed in a case-insensitive</strong> fashion. However, you can <strong>force a case-sensitive sort</strong> for a column by using <code>BINARY</code> like so: <code>ORDER BY BINARY &lt;col_name&gt;</code>.</p>
</li>
<li><p>To sort in a <strong>descending order</strong>, you need to add the option <strong><code>DESC</code> to the <code>&lt;col_name&gt;</code></strong> you are sorting:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT name, birth FROM pet ORDER BY birth DESC;</span><br><span class="line">+----------+------------+</span><br><span class="line">| name     | birth      |</span><br><span class="line">+----------+------------+</span><br><span class="line">| Puffball | 1999-03-30 |</span><br><span class="line">| Chirpy   | 1998-09-11 |</span><br><span class="line">| Whistler | 1997-12-09 |</span><br><span class="line">| Slim     | 1996-04-29 |</span><br><span class="line">| Claws    | 1994-03-17 |</span><br><span class="line">| Fluffy   | 1993-02-04 |</span><br><span class="line">| Fang     | 1990-08-27 |</span><br><span class="line">| Bowser   | 1989-08-31 |</span><br><span class="line">| Buffy    | 1989-05-13 |</span><br><span class="line">+----------+------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>You can also perform <strong>multiple sortings</strong>. This works by <strong>first sorting by the first criteria</strong> you specified. Then, <strong>within rows of the same first criteria, sort by the second criteria</strong>. This can propagate depending on your data.</p>
<p>  For example, to sort <strong>first by <code>type</code> of animal in ascending order</strong>, <strong>then by <code>birth</code> date within the same animal type in descending order</strong> (youngest animals first):</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT name, species, birth FROM pet</span><br><span class="line">       ORDER BY species, birth DESC;</span><br><span class="line">+----------+---------+------------+</span><br><span class="line">| name     | species | birth      |</span><br><span class="line">+----------+---------+------------+</span><br><span class="line">| Chirpy   | bird    | 1998-09-11 |</span><br><span class="line">| Whistler | bird    | 1997-12-09 |</span><br><span class="line">| Claws    | cat     | 1994-03-17 |</span><br><span class="line">| Fluffy   | cat     | 1993-02-04 |</span><br><span class="line">| Fang     | dog     | 1990-08-27 |</span><br><span class="line">| Bowser   | dog     | 1989-08-31 |</span><br><span class="line">| Buffy    | dog     | 1989-05-13 |</span><br><span class="line">| Puffball | hamster | 1999-03-30 |</span><br><span class="line">| Slim     | snake   | 1996-04-29 |</span><br><span class="line">+----------+---------+------------+</span><br></pre></td></tr></table></figure>

<p>  However, <strong>if all data are distinct</strong>, for example, then <strong>sorting by two criterias would be meaningless</strong>, as the result would be the <strong>same if you only sorted it by the first criteria</strong> you specified (you can try this yourself).</p>
</li>
<li><p>Lastly, you could combine <strong>row selections</strong> as well. However, here you need to specify <code>WHERE</code> before you specify <code>ORDER BY</code>, which makes sense because this can save computation time.</p>
<p>  For example, in the above sorting, I would only want to see <code>cat</code> and <code>dog</code>s, I could do:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT name, species, birth FROM pet</span><br><span class="line">       WHERE species&#x3D;&#39;cat&#39; OR species&#x3D;&#39;DOG&#39; ORDER BY species, birth DESC;</span><br><span class="line">+----------+---------+------------+</span><br><span class="line">| name     | species | birth      |</span><br><span class="line">+----------+---------+------------+</span><br><span class="line">| Claws    | cat     | 1994-03-17 |</span><br><span class="line">| Fluffy   | cat     | 1993-02-04 |</span><br><span class="line">| Fang     | dog     | 1990-08-27 |</span><br><span class="line">| Bowser   | dog     | 1989-08-31 |</span><br><span class="line">| Buffy    | dog     | 1989-05-13 |</span><br><span class="line">+----------+---------+------------+</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="Data-Calculations"><a href="#Data-Calculations" class="headerlink" title="Data Calculations"></a>Data Calculations</h2><p><strong>MySQL provides several functions</strong> that you can use to perform calculations. In this case, if we want to do calculations on dates, for example, to calculate ages or extract parts of dates, we could use <code>TIMESTAMPDIFF(unit,datetime_expr1,datetime_expr2)</code> function:</p>
<ul>
<li><code>Argument</code><ul>
<li><code>unit</code>, which will be the format of the result, has the following legal values: <code>MICROSECOND</code>(microseconds), <code>SECOND</code>, <code>MINUTE</code>, <code>HOUR</code>, <code>DAY</code>, <code>WEEK</code>, <code>MONTH</code>, <code>QUARTER</code>, or <code>YEAR</code>.</li>
<li><code>datetime_expr1</code> and <code>datetime_expr2</code> are date or datetime expressions.</li>
</ul>
</li>
<li><code>Returns</code><ul>
<li><code>datetime_expr2 ‚àí datetime_expr1</code> in the unit specified by <code>unit</code>. However, one expression may be a date and the other a datetime; in that case, a date value is treated as a datetime having the time part <code>&#39;00:00:00&#39;</code> where necessary. The unit for the result (an integer) is given by the unit argument. </li>
</ul>
</li>
</ul>
<p>Also, an alias (<code>AS age</code>) is used to make the final output column label more meaningful:</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT name, birth, CURDATE(),</span><br><span class="line">       TIMESTAMPDIFF(YEAR,birth,CURDATE()) AS age</span><br><span class="line">       FROM pet;</span><br><span class="line">+----------+------------+------------+------+</span><br><span class="line">| name     | birth      | CURDATE()  | age  |</span><br><span class="line">+----------+------------+------------+------+</span><br><span class="line">| Fluffy   | 1993-02-04 | 2003-08-19 |   10 |</span><br><span class="line">| Claws    | 1994-03-17 | 2003-08-19 |    9 |</span><br><span class="line">| Buffy    | 1989-05-13 | 2003-08-19 |   14 |</span><br><span class="line">| Fang     | 1990-08-27 | 2003-08-19 |   12 |</span><br><span class="line">| Bowser   | 1989-08-31 | 2003-08-19 |   13 |</span><br><span class="line">| Chirpy   | 1998-09-11 | 2003-08-19 |    4 |</span><br><span class="line">| Whistler | 1997-12-09 | 2003-08-19 |    5 |</span><br><span class="line">| Slim     | 1996-04-29 | 2003-08-19 |    7 |</span><br><span class="line">| Puffball | 1999-03-30 | 2003-08-19 |    4 |</span><br><span class="line">+----------+------------+------------+------+</span><br></pre></td></tr></table></figure></code></pre><p>You can then order it by <code>age</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT name, birth, CURDATE(),</span><br><span class="line">       TIMESTAMPDIFF(YEAR,birth,CURDATE()) AS age</span><br><span class="line">       FROM pet ORDER BY age;</span><br><span class="line">+----------+------------+------------+------+</span><br><span class="line">| name     | birth      | CURDATE()  | age  |</span><br><span class="line">+----------+------------+------------+------+</span><br><span class="line">| Chirpy   | 1998-09-11 | 2003-08-19 |    4 |</span><br><span class="line">| Puffball | 1999-03-30 | 2003-08-19 |    4 |</span><br><span class="line">| Whistler | 1997-12-09 | 2003-08-19 |    5 |</span><br><span class="line">| Slim     | 1996-04-29 | 2003-08-19 |    7 |</span><br><span class="line">| Claws    | 1994-03-17 | 2003-08-19 |    9 |</span><br><span class="line">| Fluffy   | 1993-02-04 | 2003-08-19 |   10 |</span><br><span class="line">| Fang     | 1990-08-27 | 2003-08-19 |   12 |</span><br><span class="line">| Bowser   | 1989-08-31 | 2003-08-19 |   13 |</span><br><span class="line">| Buffy    | 1989-05-13 | 2003-08-19 |   14 |</span><br><span class="line">+----------+------------+------------+------+</span><br></pre></td></tr></table></figure>

<p>But what if you want to know which animals have <strong>birthdays next mont</strong>h? For this type of calculation, year and day are irrelevant; you simply want to <strong>extract the month part of the <code>birth</code></strong> column. MySQL provides several functions for extracting parts of dates, such as <code>YEAR()</code>, <code>MONTH()</code>, and <code>DAYOFMONTH()</code>. <code>MONTH()</code> is the appropriate function here. To see how it works, run a simple query that displays the value of both birth and <code>MONTH(date)</code>:</p>
<ul>
<li><code>Argument</code><ul>
<li><code>date</code>, for example <code>&#39;2008-02-03&#39;</code></li>
</ul>
</li>
<li><code>Returns</code> <ul>
<li>the month for <code>date</code>, <strong>in the range 1 to 12 for January to December</strong>, or <strong>0 for dates such as ‚Äò0000-00-00‚Äô or ‚Äò2008-00-00‚Äô that have a zero month part</strong>.</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT name, birth, MONTH(birth) FROM pet;</span><br><span class="line">+----------+------------+--------------+</span><br><span class="line">| name     | birth      | MONTH(birth) |</span><br><span class="line">+----------+------------+--------------+</span><br><span class="line">| Fluffy   | 1993-02-04 |            2 |</span><br><span class="line">| Claws    | 1994-03-17 |            3 |</span><br><span class="line">| Buffy    | 1989-05-13 |            5 |</span><br><span class="line">| Fang     | 1990-08-27 |            8 |</span><br><span class="line">| Bowser   | 1989-08-31 |            8 |</span><br><span class="line">| Chirpy   | 1998-09-11 |            9 |</span><br><span class="line">| Whistler | 1997-12-09 |           12 |</span><br><span class="line">| Slim     | 1996-04-29 |            4 |</span><br><span class="line">| Puffball | 1999-03-30 |            3 |</span><br><span class="line">+----------+------------+--------------+</span><br></pre></td></tr></table></figure>

<p>and if you want to see pets that have birthday the <strong>current month</strong> (<strong>suppose it is May now</strong>), then you can do:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT name, birth FROM pet WHERE MONTH(birth) &#x3D; 5;</span><br><span class="line">+-------+------------+</span><br><span class="line">| name  | birth      |</span><br><span class="line">+-------+------------+</span><br><span class="line">| Buffy | 1989-05-13 |</span><br><span class="line">+-------+------------+</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> You might think that you could write <code>SELECT name, birth, MONTH(birth) as month FROM pet WHERE month= 5;</code> would be another option, as it works for sorting. Unfortunately, <strong>this would not work</strong> because standard SQL <strong>disallows references to column aliases</strong> in a <strong><code>WHERE</code> clause</strong>.</li>
</ul>
</blockquote>
<p>To see pets that have birthday the <strong>next month</strong>, you can use either the <code>DATE_ADD()</code> function or the <code>MOD()</code> function. For saving space, details for their arguments and return values are not explained here.</p>
<ol>
<li><p>To use the <code>DATE_ADD()</code> function to add a month to the current date:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT name, birth FROM pet</span><br><span class="line">       WHERE MONTH(birth) &#x3D; MONTH(DATE_ADD(CURDATE(),INTERVAL 1 MONTH));</span><br></pre></td></tr></table></figure>
</li>
<li><p>To use the <code>MOD()</code> function to calculate the value of the next month:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT name, birth FROM pet</span><br><span class="line">       WHERE MONTH(birth) &#x3D; MOD(MONTH(CURDATE())+1, 12);</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>If a calculation <strong>fails</strong>, it will produce <code>warning</code>s:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT &#39;2018-10-32&#39; + INTERVAL 1 DAY;</span><br><span class="line">+-------------------------------+</span><br><span class="line">| &#39;2018-10-32&#39; + INTERVAL 1 DAY |</span><br><span class="line">+-------------------------------+</span><br><span class="line">| NULL                          |</span><br><span class="line">+-------------------------------+</span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SHOW WARNINGS;</span><br><span class="line">+---------+------+----------------------------------------+</span><br><span class="line">| Level   | Code | Message                                |</span><br><span class="line">+---------+------+----------------------------------------+</span><br><span class="line">| Warning | 1292 | Incorrect datetime value: &#39;2018-10-32&#39; |</span><br><span class="line">+---------+------+----------------------------------------+</span><br></pre></td></tr></table></figure>

<h2 id="Working-with-NULL-Values"><a href="#Working-with-NULL-Values" class="headerlink" title="Working with NULL Values"></a>Working with <code>NULL</code> Values</h2><p>The NULL value can be surprising until you get used to it. Conceptually, NULL means ‚Äúa missing unknown value‚Äù and it is treated somewhat differently from other values.</p>
<p>To test for NULL, use the <code>IS NULL</code> and <code>IS NOT NULL</code> operators, as shown here:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT 1 IS NULL, 1 IS NOT NULL;</span><br><span class="line">+-----------+---------------+</span><br><span class="line">| 1 IS NULL | 1 IS NOT NULL |</span><br><span class="line">+-----------+---------------+</span><br><span class="line">|         0 |             1 |</span><br><span class="line">+-----------+---------------+</span><br></pre></td></tr></table></figure>
<p>where you can think of <code>0</code> meaning <code>false</code> and <code>1</code> meaning <code>true</code>.</p>
<p>If you use arithmetic comparison operators such as <code>=</code>, <code>&lt;</code>, or <code>&lt;&gt;</code> to test for <code>NULL</code>, you will get the following result:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT 1 &#x3D; NULL, 1 &lt;&gt; NULL, 1 &lt; NULL, 1 &gt; NULL;</span><br><span class="line">+----------+-----------+----------+----------+</span><br><span class="line">| 1 &#x3D; NULL | 1 &lt;&gt; NULL | 1 &lt; NULL | 1 &gt; NULL |</span><br><span class="line">+----------+-----------+----------+----------+</span><br><span class="line">|     NULL |      NULL |     NULL |     NULL |</span><br><span class="line">+----------+-----------+----------+----------+</span><br></pre></td></tr></table></figure>
<p>This is because the result of <strong>any arithmetic comparison with <code>NULL</code> is also <code>NULL</code></strong>, so you cannot obtain any meaningful results from such comparisons.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> In <strong>MySQL</strong>, <code>0</code> or <code>NULL</code> means <code>false</code> and anything else means <code>true</code>. The <strong>default <code>true</code> value</strong> from a boolean operation is <code>1</code>.</li>
<li><input disabled type="checkbox"> Also, when doing an <code>ORDER BY</code>, <strong><code>NULL</code> values are presented first if you do <code>ORDER BY ... ASC</code></strong> and last if you do <code>ORDER BY ... DESC</code>.</li>
</ul>
</blockquote>
<h2 id="Pattern-Matching"><a href="#Pattern-Matching" class="headerlink" title="Pattern Matching"></a>Pattern Matching</h2><p>MySQL provides standard SQL pattern matching as well as a form of pattern matching based on <strong>extended regular expressions</strong> similar to those used by Unix utilities such as <strong>vi</strong>, <strong>grep</strong>, and <strong>sed</strong>.</p>
<ul>
<li><code>_</code> can be used to match/replace any single character </li>
<li><code>%</code> to match/replace an arbitrary number of characters (including zero characters). </li>
</ul>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> In MySQL, SQL patterns are <strong>case-insensitive by default</strong>. </li>
</ul>
</blockquote>
<p>Some examples are shown here. <strong>Do not use <code>=</code> or <code>&lt;&gt;</code> when you use SQL patterns</strong>. Use the <strong><code>LIKE</code> or <code>NOT LIKE</code> comparison operators</strong> instead.</p>
<ul>
<li><p>To find names beginning with <code>b</code> or <code>B</code> (because it is case-insensitive):</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM pet WHERE name LIKE &#39;b%&#39;;</span><br><span class="line">+--------+--------+---------+------+------------+------------+</span><br><span class="line">| name   | owner  | species | sex  | birth      | death      |</span><br><span class="line">+--------+--------+---------+------+------------+------------+</span><br><span class="line">| Buffy  | Harold | dog     | f    | 1989-05-13 | NULL       |</span><br><span class="line">| Bowser | Diane  | dog     | m    | 1989-08-31 | 1995-07-29 |</span><br><span class="line">+--------+--------+---------+------+------------+------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>To find names ending with <code>fy</code>:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM pet WHERE name LIKE &#39;%fy&#39;;</span><br><span class="line">+--------+--------+---------+------+------------+-------+</span><br><span class="line">| name   | owner  | species | sex  | birth      | death |</span><br><span class="line">+--------+--------+---------+------+------------+-------+</span><br><span class="line">| Fluffy | Harold | cat     | f    | 1993-02-04 | NULL  |</span><br><span class="line">| Buffy  | Harold | dog     | f    | 1989-05-13 | NULL  |</span><br><span class="line">+--------+--------+---------+------+------------+-------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>To find names containing a <code>w</code>:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM pet WHERE name LIKE &#39;%w%&#39;;</span><br><span class="line">+----------+-------+---------+------+------------+------------+</span><br><span class="line">| name     | owner | species | sex  | birth      | death      |</span><br><span class="line">+----------+-------+---------+------+------------+------------+</span><br><span class="line">| Claws    | Gwen  | cat     | m    | 1994-03-17 | NULL       |</span><br><span class="line">| Bowser   | Diane | dog     | m    | 1989-08-31 | 1995-07-29 |</span><br><span class="line">| Whistler | Gwen  | bird    | NULL | 1997-12-09 | NULL       |</span><br><span class="line">+----------+-------+---------+------+------------+------------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>To find names containing exactly five characters, use five instances of the <code>_</code> pattern character:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM pet WHERE name LIKE &#39;_____&#39;;</span><br><span class="line">+-------+--------+---------+------+------------+-------+</span><br><span class="line">| name  | owner  | species | sex  | birth      | death |</span><br><span class="line">+-------+--------+---------+------+------------+-------+</span><br><span class="line">| Claws | Gwen   | cat     | m    | 1994-03-17 | NULL  |</span><br><span class="line">| Buffy | Harold | dog     | f    | 1989-05-13 | NULL  |</span><br><span class="line">+-------+--------+---------+------+------------+-------+</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>The other type of pattern matching provided by MySQL uses <strong>extended regular expressions</strong>. Those will be much more extensive and enables you to do much more. When you test for a match for this type of pattern, <strong>use the <code>REGEXP_LIKE(expr, pat[, match_type])</code></strong> function (or the <code>REGEXP</code> or <code>RLIKE</code> operators, which are synonyms for <code>REGEXP_LIKE()</code>).</p>
<ul>
<li><code>Arguement</code><ul>
<li><code>expr</code> a string of input</li>
<li><code>pat</code> a <strong>regular expression</strong> for matching the input. Examples of common <strong>regular expressions</strong> include:<ul>
<li><code>.</code> matches any single character.</li>
<li>A character class <code>[...]</code> matches <strong>any character for once within the brackets</strong>. For example, [abc] matches a, b, or c. To name a <strong>range of characters</strong>, use a dash. [a-z] matches any letter, whereas [0-9] matches any digit. Use <code>+</code> to match a character more than once. For example, <code>[a-z]+</code> would match any word.</li>
<li><code>*</code> matches <strong>zero or more instances of the thing preceding it</strong>. For example, <code>x*</code> matches any number of x characters, <strong>[0-9]* matches any number of digits</strong>, and <code>.*</code> matches <strong>any number of anything</strong>.</li>
<li>Use <code>^</code> at the beginning or <code>$</code> at the end of the pattern to <strong>anchor a pattern so that it must match the beginning or end of the value being tested, respectively.</strong></li>
<li>A regular expression pattern match succeeds <strong>if the pattern matches anywhere in the value being tested</strong>. (This differs from a <strong><code>LIKE</code> pattern match, which succeeds only if the pattern matches the entire value.</strong>)</li>
<li>for a complete reference, visit <a href="https://dev.mysql.com/doc/refman/8.0/en/regexp.html#regexp-syntax" target="_blank" rel="noopener">Regexp Syntax by MySQL</a></li>
</ul>
</li>
<li>optional <code>match_type</code> is a string that may contain any or all the following characters specifying how to perform matching:<ul>
<li><code>c</code>: <strong>Case sensitive matching</strong>.</li>
<li><code>i</code>: Case-insensitive matching.</li>
<li><code>m</code>: Multiple-line mode. Recognize line terminators within the string. The default behavior is to match line terminators only at the start and end of the string expression.</li>
<li><code>n</code>: The . character matches line terminators. The default is for . matching to stop at the end of a line.</li>
<li><code>u</code>: Unix-only line endings. Only the newline character is recognized as a line ending by the ., ^, and $ match operators.</li>
</ul>
</li>
</ul>
</li>
<li><code>Returns</code><ul>
<li>Returns <strong><code>1</code> if the string expr matches the regular expression</strong> specified by the pattern pat, <code>0</code> otherwise. If expr or pat is <code>NULL</code>, the return value is <code>NULL</code>.</li>
</ul>
</li>
</ul>
<p>For example, to find names beginning with b, use <code>^</code> to match the beginning of the name:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM pet WHERE REGEXP_LIKE(name, &#39;^b&#39;);</span><br><span class="line">+--------+--------+---------+------+------------+------------+</span><br><span class="line">| name   | owner  | species | sex  | birth      | death      |</span><br><span class="line">+--------+--------+---------+------+------------+------------+</span><br><span class="line">| Buffy  | Harold | dog     | f    | 1989-05-13 | NULL       |</span><br><span class="line">| Bowser | Diane  | dog     | m    | 1979-08-31 | 1995-07-29 |</span><br><span class="line">+--------+--------+---------+------+------------+------------+</span><br></pre></td></tr></table></figure>
<p>To find names ending with <code>fy</code>, use <code>$</code> to match the end of the name:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM pet WHERE REGEXP_LIKE(name, &#39;fy$&#39;);</span><br><span class="line">+--------+--------+---------+------+------------+-------+</span><br><span class="line">| name   | owner  | species | sex  | birth      | death |</span><br><span class="line">+--------+--------+---------+------+------------+-------+</span><br><span class="line">| Fluffy | Harold | cat     | f    | 1993-02-04 | NULL  |</span><br><span class="line">| Buffy  | Harold | dog     | f    | 1989-05-13 | NULL  |</span><br><span class="line">+--------+--------+---------+------+------------+-------+</span><br></pre></td></tr></table></figure>

<p>To force a regular expression comparison to be <strong>case sensitive</strong>, use a case-sensitive collation, or use the BINARY keyword to make one of the strings a binary string, or specify the <code>c</code> match-control character (as mentioend above). Each of these queries matches only lowercase b at the beginning of a name:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM pet WHERE REGEXP_LIKE(name, &#39;^b&#39; COLLATE utf8mb4_0900_as_cs);</span><br><span class="line">SELECT * FROM pet WHERE REGEXP_LIKE(name, BINARY &#39;^b&#39;);</span><br><span class="line">SELECT * FROM pet WHERE REGEXP_LIKE(name, &#39;^b&#39;, &#39;c&#39;);</span><br></pre></td></tr></table></figure>

<p>To find names containing a <code>w</code>, use this query:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM pet WHERE REGEXP_LIKE(name, &#39;w&#39;);</span><br><span class="line">+----------+-------+---------+------+------------+------------+</span><br><span class="line">| name     | owner | species | sex  | birth      | death      |</span><br><span class="line">+----------+-------+---------+------+------------+------------+</span><br><span class="line">| Claws    | Gwen  | cat     | m    | 1994-03-17 | NULL       |</span><br><span class="line">| Bowser   | Diane | dog     | m    | 1989-08-31 | 1995-07-29 |</span><br><span class="line">| Whistler | Gwen  | bird    | NULL | 1997-12-09 | NULL       |</span><br><span class="line">+----------+-------+---------+------+------------+------------+</span><br></pre></td></tr></table></figure>
<p>Because a regular expression pattern <strong>matches if it occurs anywhere in the value</strong>, it is <strong>not necessary in the previous query to put a wildcard on either side of the pattern</strong> to get it to match the entire value as would be true with an SQL pattern.</p>
<p>To find names containing <strong>exactly five characters</strong>, use <code>^</code> and <code>$</code> to match the beginning and end of the name, and five instances of <code>.</code> in between (simply <code>.....</code> would not work due to the fact that <strong>REGEXP() matches if it occurs anywhere in the value</strong>):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM pet WHERE REGEXP_LIKE(name, &#39;^.....$&#39;);</span><br><span class="line">+-------+--------+---------+------+------------+-------+</span><br><span class="line">| name  | owner  | species | sex  | birth      | death |</span><br><span class="line">+-------+--------+---------+------+------------+-------+</span><br><span class="line">| Claws | Gwen   | cat     | m    | 1994-03-17 | NULL  |</span><br><span class="line">| Buffy | Harold | dog     | f    | 1989-05-13 | NULL  |</span><br><span class="line">+-------+--------+---------+------+------------+-------+</span><br></pre></td></tr></table></figure>

<h2 id="Counting-Rows-and-Grouping-Frequencies"><a href="#Counting-Rows-and-Grouping-Frequencies" class="headerlink" title="Counting Rows and Grouping Frequencies"></a>Counting Rows and Grouping Frequencies</h2><p>Databases are often used to answer the question, ‚Äú<strong>How often does a certain type of data occur</strong> in a table?‚Äù For example, you might want to know how many pets you have, or how many pets each owner has, or you might want to perform various kinds of census operations on your animals.</p>
<ul>
<li><p>Counting the <strong>total number of animals you have</strong> is the same question as ‚ÄúHow many rows are in the pet table?‚Äù because there is one record per pet. <code>COUNT(*)</code> counts the number of rows, so the query to count your animals looks like this:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT COUNT(*) FROM pet;</span><br><span class="line">+----------+</span><br><span class="line">| COUNT(*) |</span><br><span class="line">+----------+</span><br><span class="line">|        9 |</span><br><span class="line">+----------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>The more useful case come when you use <code>COUNT()</code> in conjunction with <code>GROUP BY</code> for characterizing your data under various groupings. </p>
<ul>
<li><p>For example, if you want to find out how many pets each owner has:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT owner, COUNT(*) FROM pet GROUP BY owner;</span><br><span class="line">+--------+----------+</span><br><span class="line">| owner  | COUNT(*) |</span><br><span class="line">+--------+----------+</span><br><span class="line">| Benny  |        2 |</span><br><span class="line">| Diane  |        2 |</span><br><span class="line">| Gwen   |        3 |</span><br><span class="line">| Harold |        2 |</span><br><span class="line">+--------+----------+</span><br></pre></td></tr></table></figure>

<p>This works because <code>COUNT()</code> is a <strong>window function</strong>, whose result rows are determined from the <code>FROM</code> clause, <strong>after <code>WHERE</code>, <code>GROUP BY</code>, and <code>HAVING</code> processing</strong>, and windowing execution occurs before <code>ORDER BY</code>, <code>LIMIT</code>, and <code>SELECT DISTINCT</code>.</p>
<p>This means that it <strong>first <code>GROUP BY owner</code></strong>, and then shows <code>owner</code> and <code>COUNT(*)</code>. For a complete guide of how to use a <code>COUNT()</code>, please follow <a href="https://dev.mysql.com/doc/refman/8.0/en/group-by-functions.html#function_count" target="_blank" rel="noopener">this link</a>. For now, you just need to know that <code>COUNT()</code>:</p>
<ul>
<li><code>Return</code><ul>
<li>Returns a count of the number of non-NULL <strong>values of <code>expr</code> in the rows retrieved by a <code>SELECT</code></strong> statement</li>
</ul>
</li>
</ul>
</li>
<li><p>Similarly, you can also <code>GROUP BY species</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT species, COUNT(*) FROM pet GROUP BY species;</span><br><span class="line">+---------+----------+</span><br><span class="line">| species | COUNT(*) |</span><br><span class="line">+---------+----------+</span><br><span class="line">| bird    |        2 |</span><br><span class="line">| cat     |        2 |</span><br><span class="line">| dog     |        3 |</span><br><span class="line">| hamster |        1 |</span><br><span class="line">| snake   |        1 |</span><br><span class="line">+---------+----------+</span><br></pre></td></tr></table></figure></li>
<li><p>And number of animals per sex:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT sex, COUNT(*) FROM pet GROUP BY sex;</span><br><span class="line">+------+----------+</span><br><span class="line">| sex  | COUNT(*) |</span><br><span class="line">+------+----------+</span><br><span class="line">| NULL |        1 |</span><br><span class="line">| f    |        4 |</span><br><span class="line">| m    |        4 |</span><br><span class="line">+------+----------+</span><br></pre></td></tr></table></figure>
<p>where <code>NULL</code> means the sex is unknown.</p>
</li>
<li><p>You could also <strong>group by one than one categories</strong>. For example, you can group by <code>species</code> first and then <code>sex</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT species, sex, COUNT(*) FROM pet GROUP BY species, sex;</span><br><span class="line">+---------+------+----------+</span><br><span class="line">| species | sex  | COUNT(*) |</span><br><span class="line">+---------+------+----------+</span><br><span class="line">| bird    | NULL |        1 |</span><br><span class="line">| bird    | f    |        1 |</span><br><span class="line">| cat     | f    |        1 |</span><br><span class="line">| cat     | m    |        1 |</span><br><span class="line">| dog     | f    |        1 |</span><br><span class="line">| dog     | m    |        2 |</span><br><span class="line">| hamster | f    |        1 |</span><br><span class="line">| snake   | m    |        1 |</span><br><span class="line">+---------+------+----------+</span><br></pre></td></tr></table></figure></li>
<li><p>and finally, you can also use the <code>WHERE</code> clause to select only a proportion of data you want (<code>WHERE</code> executes before <code>GROUP BY</code>). For example, if you only want to see <code>cat</code> and <code>dog</code> data:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT species, sex, COUNT(*) FROM pet</span><br><span class="line">       WHERE species &#x3D; &#39;dog&#39; OR species &#x3D; &#39;cat&#39;</span><br><span class="line">       GROUP BY species, sex;</span><br><span class="line">+---------+------+----------+</span><br><span class="line">| species | sex  | COUNT(*) |</span><br><span class="line">+---------+------+----------+</span><br><span class="line">| cat     | f    |        1 |</span><br><span class="line">| cat     | m    |        1 |</span><br><span class="line">| dog     | f    |        1 |</span><br><span class="line">| dog     | m    |        2 |</span><br><span class="line">+---------+------+----------+</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h2 id="Using-Multiple-Tables"><a href="#Using-Multiple-Tables" class="headerlink" title="Using Multiple Tables"></a>Using Multiple Tables</h2><p>Suppose you have another table. Then a problem arise when you need to deal with data on both tables, namely, how do you <strong>combine and operate on data from multiple tables</strong>?</p>
<p>Now suppose you created another table to <strong>record other information about them</strong>, such as events in their lives like visits to the vet or when litters are born, and you put the following information in a <code>event</code> table:</p>
<p><img src="/.com//05/26/MySQL-Manual/pet-events.png" alt="Table from https://dev.mysql.com/doc/refman/8.0/en/multiple-tables.html" title="Table from https://dev.mysql.com/doc/refman/8.0/en/multiple-tables.html"></p>
<p>Suppose that you want to find out the <strong>ages at which each pet had its litters</strong>. We saw earlier how to calculate ages from two dates. The <code>litter</code> date of the mother is in the <code>event</code> table, but to calculate her age on that date you need her <code>birth</code> date, <strong>which is stored in the <code>pet</code> table</strong>. This means the query requires both tables:</p>
<ul>
<li><p>First, you need to know that <strong>tables are distinct in a database</strong>. This means that <strong>any column in a specific table in a database</strong> can be referred as: <code>&lt;tableName&gt;.&lt;colName&gt;</code>.</p>
</li>
<li><p>Now, to combine data from multiple tables, you can use <code>INNER JOIN</code> (for more details on <code>JOIN</code> clause, see <a href="https://dev.mysql.com/doc/refman/8.0/en/join.html" target="_blank" rel="noopener">here</a>), which can be used to <strong>combine the tables by permitsting rows from either table to appear</strong> in the result <strong>if and only if both tables meet the conditions specified in the <code>ON</code> clause</strong>. For example:</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT pet.name,</span><br><span class="line">       TIMESTAMPDIFF(YEAR,birth,date) AS age,</span><br><span class="line">       remark</span><br><span class="line">       FROM pet INNER JOIN event</span><br><span class="line">         ON pet.name &#x3D; event.name</span><br><span class="line">       WHERE event.type &#x3D; &#39;litter&#39;;</span><br><span class="line">+--------+------+-----------------------------+</span><br><span class="line">| name   | age  | remark                      |</span><br><span class="line">+--------+------+-----------------------------+</span><br><span class="line">| Fluffy |    2 | 4 kittens, 3 female, 1 male |</span><br><span class="line">| Buffy  |    4 | 5 puppies, 2 female, 3 male |</span><br><span class="line">| Buffy  |    5 | 3 puppies, 3 female         |</span><br><span class="line">+--------+------+-----------------------------+</span><br></pre></td></tr></table></figure>
<p>where you see in this example:</p>
<ul>
<li>When combining (joining) information from multiple tables, you need to specify how records in one table can be matched to records in the other (e.g. using the <code>ON</code> clause). This is easy because they both have a <code>name</code> column. The query uses an <code>ON pet.name=event.name</code> to match up records in the two tables <strong>if they have the same name value</strong>.</li>
</ul>
<p>However, you <strong>do not need to have two different tables</strong> to use the <code>INNER JOIN ... ON</code> functionality. You can <strong>use alias `AS</strong><code>. For example, to find possible **breeding pairs among your pets**, you can join the</code>pet` table with itself to produce candidate pairs of live <strong>males and females of like species</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT p1.name, p1.sex, p2.name, p2.sex, p1.species</span><br><span class="line">       FROM pet AS p1 INNER JOIN pet AS p2</span><br><span class="line">         ON p1.species &#x3D; p2.species</span><br><span class="line">         AND p1.sex &#x3D; &#39;f&#39; AND p1.death IS NULL</span><br><span class="line">         AND p2.sex &#x3D; &#39;m&#39; AND p2.death IS NULL;</span><br><span class="line">+--------+------+-------+------+---------+</span><br><span class="line">| name   | sex  | name  | sex  | species |</span><br><span class="line">+--------+------+-------+------+---------+</span><br><span class="line">| Fluffy | f    | Claws | m    | cat     |</span><br><span class="line">| Buffy  | f    | Fang  | m    | dog     |</span><br><span class="line">+--------+------+-------+------+---------+</span><br></pre></td></tr></table></figure>

<h2 id="Using-MySQL-in-Batch-Mode"><a href="#Using-MySQL-in-Batch-Mode" class="headerlink" title="Using MySQL in Batch Mode"></a>Using MySQL in Batch Mode</h2><p>Sometimes, if you have a <code>batch file</code> that you would like MySQL to execute, you can run <code>mysql</code> in <strong>batch mode</strong>. To do this, put the statements you want to run in a batch file (<strong>with <code>.sql</code> ending</strong>), then <strong>tell <code>mysql</code> to read its input from the file</strong>.</p>
<ul>
<li><p><strong>Outside of <code>mysql</code></strong>:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mysql &lt; &lt;your-batch-file&gt;</span><br></pre></td></tr></table></figure>

<p>  If you are running <code>mysql</code> under Windows and have some special characters in the file that cause problems, you can do this:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\&gt; mysql -e &quot;source &lt;your-batch-file&gt;&quot;</span><br></pre></td></tr></table></figure>

<p>  If you need to specify connection parameters on the command line, the command might look like this:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mysql -h host -u user -p &lt; &lt;your-batch-file&gt;</span><br><span class="line">Enter password: ********</span><br></pre></td></tr></table></figure>
</li>
<li><p>You can also use scripts from <strong>inside the <code>mysql</code> prompt</strong> by using the <code>source</code> command or <code>\.</code> command:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; source filename;</span><br><span class="line">mysql&gt; \. filename</span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> If you want the script to continue <strong>even if some of the statements in it produce errors</strong>, you should use the <code>--force</code> command-line option.  </li>
</ul>
</blockquote>
<p>In general, you would use scriptings in a batch mode if you need to:</p>
<ul>
<li>run a query <strong>repeatedly</strong> (say, every day or every week), making it a script enables you to avoid retyping it each time you execute it.</li>
<li>generate new queries from existing ones that are similar by copying and editing script files.</li>
<li><strong>distribute</strong> your script to other people so that they can also run the statements</li>
</ul>
<p>You have several <strong>options</strong> when using the batch mode as well. For example:</p>
<ul>
<li><p>if you have a query that <strong>produces a lot of output</strong>, you can run the output through a <strong>pager rather than watching it scroll off the top of your screen</strong>:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mysql &lt; batch-file | more</span><br></pre></td></tr></table></figure></li>
<li><p>You can catch the output in a file for further processing:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mysql &lt; batch-file &gt; mysql.out</span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> The output of <code>mysql</code> in batch mode is more concise than the output in a normal interative <code>mysql</code> prompt. For example, output of <code>SELECT DISTINCT species FROM pet</code> looks like this when <code>mysql</code> is run <code>interactively</code>:</li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------+</span><br><span class="line">| species |</span><br><span class="line">+---------+</span><br><span class="line">| bird    |</span><br><span class="line">| cat     |</span><br><span class="line">| dog     |</span><br><span class="line">| hamster |</span><br><span class="line">| snake   |</span><br><span class="line">+---------+</span><br></pre></td></tr></table></figure>
<p>In batch mode, the output looks like this instead:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">species</span><br><span class="line">bird</span><br><span class="line">cat</span><br><span class="line">dog</span><br><span class="line">hamster</span><br><span class="line">snake</span><br></pre></td></tr></table></figure>

<h2 id="Examples-of-Common-Query"><a href="#Examples-of-Common-Query" class="headerlink" title="Examples of Common Query"></a>Examples of Common Query</h2><p>Here, I only list some that I think are relatively less-straightforward than thought. For more examples, please refer to <a href="https://dev.mysql.com/doc/refman/8.0/en/examples.html" target="_blank" rel="noopener">the MySQL documentation</a>.</p>
<p>All examples are based on this table:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE TABLE shop (</span><br><span class="line">    article INT UNSIGNED  DEFAULT &#39;0000&#39; NOT NULL,</span><br><span class="line">    dealer  CHAR(20)      DEFAULT &#39;&#39;     NOT NULL,</span><br><span class="line">    price   DECIMAL(16,2) DEFAULT &#39;0.00&#39; NOT NULL,</span><br><span class="line">    PRIMARY KEY(article, dealer));</span><br><span class="line">mysql&gt; INSERT INTO shop VALUES</span><br><span class="line">    (1,&#39;A&#39;,3.45),(1,&#39;B&#39;,3.99),(2,&#39;A&#39;,10.99),(3,&#39;B&#39;,1.45),</span><br><span class="line">    (3,&#39;C&#39;,1.69),(3,&#39;D&#39;,1.25),(4,&#39;D&#39;,19.95);</span><br></pre></td></tr></table></figure>

<p>After issuing the statements, the table should have the following contents:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM shop ORDER BY article;</span><br><span class="line"></span><br><span class="line">+---------+--------+-------+</span><br><span class="line">| article | dealer | price |</span><br><span class="line">+---------+--------+-------+</span><br><span class="line">|       1 | A      |  3.45 |</span><br><span class="line">|       1 | B      |  3.99 |</span><br><span class="line">|       2 | A      | 10.99 |</span><br><span class="line">|       3 | B      |  1.45 |</span><br><span class="line">|       3 | C      |  1.69 |</span><br><span class="line">|       3 | D      |  1.25 |</span><br><span class="line">|       4 | D      | 19.95 |</span><br><span class="line">+---------+--------+-------+</span><br></pre></td></tr></table></figure>

<p>Notice: for each example, there are more than one solution. Here I only picked the ones that <strong>I think are easier to understand and remember</strong>:</p>
<ul>
<li><p>For each article, find the dealer or dealers with the most expensive price.</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SELECT s1.article, dealer, s1.price</span><br><span class="line">FROM shop s1</span><br><span class="line">JOIN (</span><br><span class="line">  SELECT article, MAX(price) AS price</span><br><span class="line">  FROM shop</span><br><span class="line">  GROUP BY article) AS s2</span><br><span class="line">  ON s1.article &#x3D; s2.article AND s1.price &#x3D; s2.price</span><br><span class="line">ORDER BY article;</span><br></pre></td></tr></table></figure>
<p>  This basically works by <strong>first finding the simple <code>MAX(price)</code></strong> for each article in one table, and then <code>JOIN</code> it with the <strong>other table</strong> (the same table but aliased differently) to display other data such as <code>dealer</code>.</p>
</li>
<li><p>Storing Data in a <strong>User-Defined Variable</strong></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT @min_price:&#x3D;MIN(price),@max_price:&#x3D;MAX(price) FROM shop;</span><br><span class="line">mysql&gt; SELECT * FROM shop WHERE price&#x3D;@min_price OR price&#x3D;@max_price;</span><br><span class="line">+---------+--------+-------+</span><br><span class="line">| article | dealer | price |</span><br><span class="line">+---------+--------+-------+</span><br><span class="line">|    0003 | D      |  1.25 |</span><br><span class="line">|    0004 | D      | 19.95 |</span><br><span class="line">+---------+--------+-------+</span><br></pre></td></tr></table></figure>

<p>  <strong>Properly</strong>, the variables would be written in the below format:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SET @&lt;var_name&gt; &#x3D; &lt;expr [, @var_name &#x3D; expr] ...&gt;</span><br></pre></td></tr></table></figure>

<p>  For example, you would properly write:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SET @min_price&#x3D;(SELECT MIN(price) FROM shop), @max_price&#x3D;(SELECT MAX(price) FROM shop);</span><br></pre></td></tr></table></figure>
<p>  But as seen in the above example, there is also a shortcut of writting it as:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT @min_price:&#x3D;MIN(price),@max_price:&#x3D;MAX(price) FROM shop;</span><br></pre></td></tr></table></figure>
<p>  (for more details on user-defined variables, refer to <a href="https://dev.mysql.com/doc/refman/8.0/en/user-variables.html" target="_blank" rel="noopener">here</a>.)</p>
</li>
<li><p>Searching Two Keys in a table</p>
<p>  This mostly happens when you use the keyword <code>OR</code>. And you might use the following to search for two keys:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT field1_index, field2_index FROM test_table</span><br><span class="line">WHERE field1_index &#x3D; &#39;1&#39; OR  field2_index &#x3D; &#39;1&#39;</span><br></pre></td></tr></table></figure>

<p>  However, it is clearer and efficient by using a <code>UNION</code> that <strong>combines the output of two separate <code>SELECT</code> statements</strong>. See Section <a href="https://dev.mysql.com/doc/refman/8.0/en/union.html" target="_blank" rel="noopener">MySQL <code>UNION</code> Clause</a> for more details.</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT field1_index, field2_index</span><br><span class="line">    FROM test_table WHERE field1_index &#x3D; &#39;1&#39;</span><br><span class="line">UNION</span><br><span class="line">SELECT field1_index, field2_index</span><br><span class="line">FROM test_table WHERE field2_index &#x3D; &#39;1&#39;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Counting Frequencies of a Distinct Number in a Table</p>
<p>  This can be done beautifully using the <code>BIT-WISE</code> operators (in this example, using the keyword <code>DISTINCT</code> would not work.)</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SELECT year,month,BIT_COUNT(BIT_OR(1&lt;&lt;day)) AS days FROM t1</span><br><span class="line">       GROUP BY year,month;</span><br><span class="line">+------+-------+------+</span><br><span class="line">| year | month | days |</span><br><span class="line">+------+-------+------+</span><br><span class="line">| 2000 |     1 |    3 |</span><br><span class="line">| 2000 |     2 |    2 |</span><br><span class="line">+------+-------+------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>  This would:</p>
<ul>
<li><p>First left shift the binary <code>1</code> for <code>number of day</code> times (<code>1&lt;&lt;day</code>). For example, <code>1&lt;&lt;3</code> means you get <code>1000</code>. This means that <strong>each day would have <code>1</code> at a distinct position</strong>. </p>
</li>
<li><p>Then, it does a <code>BIT_OR()</code>, which returns a binary number where each position would be <code>1</code> <strong>if one of the number had a <code>1</code> at that position</strong>,<code>0</code> otherwise. For instance, <code>1000</code> and <code>1</code> would give <code>1001</code>.</p>
</li>
<li><p>Lastly, it counts how many <code>1</code> there are in the number with the <code>BIT_COUNT()</code> function. At this point, this would only return the number of <strong>distinct days</strong>.</p>
<p>As a result, the query calculates how many different days appear in the table for each year/month combination, with automatic removal of duplicate entries.</p>
</li>
</ul>
</li>
<li><p>Auto-Increment</p>
<p>  The <code>AUTO_INCREMENT</code> attribute can be used to generate a unique identity for new rows:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE TABLE animals (</span><br><span class="line">     id MEDIUMINT NOT NULL AUTO_INCREMENT,</span><br><span class="line">     name CHAR(30) NOT NULL,</span><br><span class="line">     PRIMARY KEY (id));</span><br><span class="line"></span><br><span class="line">mysql&gt; INSERT INTO animals (name) VALUES</span><br><span class="line">    (&#39;dog&#39;),(&#39;cat&#39;),(&#39;penguin&#39;),</span><br><span class="line">    (&#39;lax&#39;),(&#39;whale&#39;),(&#39;ostrich&#39;);</span><br></pre></td></tr></table></figure>
<p>  Then if you run:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM animals;</span><br><span class="line">+----+---------+</span><br><span class="line">| id | name    |</span><br><span class="line">+----+---------+</span><br><span class="line">|  1 | dog     |</span><br><span class="line">|  2 | cat     |</span><br><span class="line">|  3 | penguin |</span><br><span class="line">|  4 | lax     |</span><br><span class="line">|  5 | whale   |</span><br><span class="line">|  6 | ostrich |</span><br><span class="line">+----+---------+</span><br></pre></td></tr></table></figure>
<p>where </p>
<ul>
<li><p>you see <strong>other ways of <code>INSERT INTO</code></strong>:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO table_name (column1, column2, column3, ...)</span><br><span class="line">VALUES (value1, value2, value3, ...);</span><br></pre></td></tr></table></figure>

<p>so that you speicify which columns to insert into with the <code>(column1, column2, column3, ...)</code>, meaning that you no longer have to insert into the table sequencially as the original label suggests.</p>
</li>
<li><p>a <code>PRIMARY KEY ()</code> is used. A primary key is used as a <strong>unique identifier to quickly parse data within the database</strong> and find the relation between different tables. A relational database cannot have more than one primary key, but it can be based on more than one field (for example, <code>PRIMARY KEY(id, name)</code>).</p>
<p>A <strong>primary key‚Äôs main features</strong> are:</p>
<ul>
<li>It must contain a <strong>unique value for each row of data</strong>.</li>
<li>It <strong>cannot contain null values</strong>.</li>
<li><strong>Every row must have a primary key value</strong>.</li>
</ul>
<p>A primary key is either an existing table column or a column that is specifically generated by the database according to a defined sequence</p>
</li>
<li><p>No value was specified for the <strong><code>AUTO_INCREMENT</code> column</strong></p>
<ul>
<li>so MySQL assigned sequence numbers automatically starting from <code>1</code>. You can only <strong>change it after creation</strong> with <code>ALTER TABLE animals AUTO_INCREMENT=10;</code>, for example.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>When you have <code>AUTO_INCREMENT</code> enabled, you still can <strong>explicitly assign other values to the column</strong> to generate sequence numbers. However, this will <strong>affect future data as well so they also start from that number</strong>. For example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO animals (id,name) VALUES(100,&#39;rabbit&#39;);</span><br><span class="line">INSERT INTO animals (id,name) VALUES(NULL,&#39;mouse&#39;);</span><br><span class="line">SELECT * FROM animals;</span><br><span class="line">+-----+-----------+</span><br><span class="line">| id  | name      |</span><br><span class="line">+-----+-----------+</span><br><span class="line">|   1 | dog       |</span><br><span class="line">|   2 | cat       |</span><br><span class="line">|   3 | penguin   |</span><br><span class="line">|   4 | lax       |</span><br><span class="line">|   5 | whale     |</span><br><span class="line">|   6 | ostrich   |</span><br><span class="line">| 100 | rabbit    |</span><br><span class="line">| 101 | mouse     |</span><br><span class="line">+-----+-----------+</span><br></pre></td></tr></table></figure>

<p>Also if you <strong>try to explicitly assign <code>0</code> or <code>NULL</code> to the column to generate sequence numbers</strong>, unless the <code>NO_AUTO_VALUE_ON_ZERO</code> SQL mode is enabled. For example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO animals (id,name) VALUES(0,&#39;groundhog&#39;);</span><br></pre></td></tr></table></figure>
<p>or </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO animals (id,name) VALUES(NULL,&#39;squirrel&#39;);</span><br></pre></td></tr></table></figure>

<p>You will obtain:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM animals;</span><br><span class="line">+-----+-----------+</span><br><span class="line">| id  | name      |</span><br><span class="line">+-----+-----------+</span><br><span class="line">|   1 | dog       |</span><br><span class="line">|   2 | cat       |</span><br><span class="line">|   3 | penguin   |</span><br><span class="line">|   4 | lax       |</span><br><span class="line">|   5 | whale     |</span><br><span class="line">|   6 | ostrich   |</span><br><span class="line">| 100 | rabbit    |</span><br><span class="line">| 101 | mouse     |</span><br><span class="line">| 102 | groundhog |</span><br><span class="line">| 103 | squirrel  |</span><br><span class="line">+-----+-----------+</span><br></pre></td></tr></table></figure>

<h2 id="Auto-Increment-in-MyISAM-Tables"><a href="#Auto-Increment-in-MyISAM-Tables" class="headerlink" title="Auto-Increment in MyISAM Tables"></a>Auto-Increment in MyISAM Tables</h2><p>For <code>MyISAM</code> tables, <strong>you can specify <code>AUTO_INCREMENT</code> on a secondary column</strong> in a <strong>multiple-column index</strong>. In this case, the generated value for the <code>AUTO_INCREMENT</code> column is calculated as <code>MAX(auto_increment_column) + 1</code> WHERE <code>prefix=given-prefix</code>. This is useful when you want to put data into ordered groups.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE TABLE animals (</span><br><span class="line">    grp ENUM(&#39;fish&#39;,&#39;mammal&#39;,&#39;bird&#39;) NOT NULL,</span><br><span class="line">    id MEDIUMINT NOT NULL AUTO_INCREMENT,</span><br><span class="line">    name CHAR(30) NOT NULL,</span><br><span class="line">    PRIMARY KEY (grp,id)</span><br><span class="line">) ENGINE&#x3D;MyISAM;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; INSERT INTO animals (grp,name) VALUES</span><br><span class="line">    (&#39;mammal&#39;,&#39;dog&#39;),(&#39;mammal&#39;,&#39;cat&#39;),</span><br><span class="line">    (&#39;bird&#39;,&#39;penguin&#39;),(&#39;fish&#39;,&#39;lax&#39;),(&#39;mammal&#39;,&#39;whale&#39;),</span><br><span class="line">    (&#39;bird&#39;,&#39;ostrich&#39;);</span><br></pre></td></tr></table></figure>

<p>Now, if you look at the table:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM animals ORDER BY grp,id;</span><br><span class="line"></span><br><span class="line">+--------+----+---------+</span><br><span class="line">| grp    | id | name    |</span><br><span class="line">+--------+----+---------+</span><br><span class="line">| fish   |  1 | lax     |</span><br><span class="line">| mammal |  1 | dog     |</span><br><span class="line">| mammal |  2 | cat     |</span><br><span class="line">| mammal |  3 | whale   |</span><br><span class="line">| bird   |  1 | penguin |</span><br><span class="line">| bird   |  2 | ostrich |</span><br><span class="line">+--------+----+---------+</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/05/26/MySQL-Manual/" data-id="ckanbfo2o0000bgor6z3p52d2" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Docker-Manual" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/05/25/Docker-Manual/" class="article-date">
  <time datetime="2020-05-25T07:18:39.000Z" itemprop="datePublished">2020-05-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/05/25/Docker-Manual/">Docker Manual</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<p><strong>IMPORTANT</strong>:<br>Much of the content here is a personal summary/abbrieviation of contents on the <a href="https://docs.docker.com/get-started/" target="_blank" rel="noopener">Offical Docker Guide</a>. For more complete information, please refer to the offical site.</p>
<hr>
<h2 id="Docker-Intro"><a href="#Docker-Intro" class="headerlink" title="Docker Intro"></a>Docker Intro</h2><p>Docker provides the ability to package and run an application in a loosely isolated environment called a <strong><code>container</code></strong>, which <strong>separate your applications from your infrastructure</strong>. The <strong>isolation and security</strong> allow you to run many containers simultaneously on a given host.</p>
<p>The use of <code>container</code>s to deploy applications is called containerization. Containers are not new, but their use for easily deploying applications is.</p>
<p>Docker provides tooling and a platform to manage the lifecycle of your <code>container</code>s:</p>
<ul>
<li>Develop your application and its supporting components using <code>container</code>s.</li>
<li>The <code>container</code> becomes the unit for distributing and testing your application.</li>
<li>When you‚Äôre ready, deploy your application into your production environment, as a <code>container</code> or an orchestrated service. This works the same whether your production environment is a local data center, a cloud provider, or a hybrid of the two.</li>
</ul>
<h2 id="Docker-Basics"><a href="#Docker-Basics" class="headerlink" title="Docker Basics"></a>Docker Basics</h2><p><strong>Docker is mainly composed of the following elements</strong> (the first three is referred as Docker Engine by the official site): </p>
<ul>
<li><strong>A server</strong> (<code>docker daemon</code>) which is a type of long-running program called a daemon process (the <code>dockerd</code>command).</li>
<li><strong>A command line interface (CLI)</strong> client that is used by most users (the <code>docker</code>command).</li>
<li><strong>A REST API</strong> which specifies interfaces that <strong>CLI</strong> programs can use to <strong>talk to the daemon</strong> and <strong>instruct it what to do</strong>.</li>
<li><strong>A Docker registry</strong>, which stores Docker images. Docker Hub is a public registry that anyone can use, and Docker is configured to look for images on Docker Hub by default.</li>
</ul>
<p>So we see that Docker uses a client-server architecture. The <strong><code>docker client</code> talks to the <code>docker daemon</code></strong>, which does the heavy lifting of building, running, and distributing your Docker containers. The Docker <code>client</code> and <code>daemon</code> can run on the same system, or you can connect a Docker client to a remote Docker daemon.</p>
<h2 id="Docker-Architecture"><a href="#Docker-Architecture" class="headerlink" title="Docker Architecture"></a>Docker Architecture</h2><ul>
<li><p>The <strong>Docker <code>daemon</code></strong></p>
<ul>
<li>The Docker <code>daemon</code> (<code>dockerd</code>) listens for Docker API requests and manages Docker objects such as <code>images</code>, <code>container</code>s, networks, and volumes. A daemon can also communicate with other daemons to manage Docker services.</li>
</ul>
</li>
<li><p><strong>The Docker <code>client</code></strong></p>
<ul>
<li>The Docker <code>client</code> (<code>docker</code>) is the primary way that many Docker users interact with Docker. When you use commands such as <code>docker run</code>, the client sends these commands to <code>dockerd</code>, which carries them out. The docker command uses the Docker API. The Docker client can communicate with more than one daemon.</li>
</ul>
</li>
<li><p><strong>Docker registries</strong></p>
<ul>
<li>A Docker registry stores Docker <code>image</code>s. Docker Hub is a public registry that anyone can use, and Docker is configured to look for images on Docker Hub by default. You can even run your own private registry. If you use Docker Datacenter (DDC), it includes Docker Trusted Registry (DTR).</li>
</ul>
</li>
<li><p><strong>Docker objects</strong></p>
<ul>
<li>When you use Docker, you are creating and using <code>images</code>, <code>container</code>s, networks, volumes, plugins, and other objects. The section below is a brief overview of some of those objects.</li>
</ul>
</li>
</ul>
<h2 id="Docker-Objects"><a href="#Docker-Objects" class="headerlink" title="Docker Objects"></a>Docker Objects</h2><ul>
<li><p><code>IMAGE</code></p>
<ul>
<li>An <code>image</code> is a <strong>read-only template</strong> with <strong>instructions for creating a Docker <code>container</code></strong>. Often, an <code>image</code> is based on another <code>image</code>, with some additional customization. For example, you may build an image which is based on the ubuntu image, but installs the Apache web server and your application, as well as the configuration details needed to make your application run.</li>
</ul>
</li>
<li><p><code>CONTAINER</code></p>
<ul>
<li><p>A container is a <strong>runnable instance of an <code>image</code></strong>. You can create, start, stop, move, or delete a <code>container</code> using the Docker API or CLI. You can connect a <code>container</code> to one or more networks, attach storage to it, or even create a new image based on its current state.</p>
<p>Fundementally, a <strong><code>container</code> is nothing but a running process, with some added encapsulation features applied to it in order to keep it isolated from the host and from other containers</strong>. One of the most important aspects of container isolation is that each container interacts with its <strong>own private filesystem</strong>.</p>
<p>By default, a container is relatively well isolated from other <code>container</code>s and its host machine. You can control how isolated a container‚Äôs network, storage, or other underlying subsystems are from other containers or from the host machine.</p>
<p>A <code>container</code> is <strong>defined by its image as well as any configuration options you provide to it when you create or start it</strong>. When a container is <strong>removed</strong>, any changes to its state that are <strong>not stored in persistent storage</strong> disappear.</p>
</li>
</ul>
</li>
<li><p><code>SERVICE</code></p>
<ul>
<li><p>Services allow you to <strong>scale <code>container</code>s across multiple Docker <code>daemons</code></strong>, which all work together as a swarm with multiple managers and workers. Each member of a swarm is a Docker <code>daemon</code>, and all the daemons communicate using the Docker API. A <code>service</code> allows you to <strong>define states</strong>, such as the <strong>number of replicas of the service</strong> that must be available at any given time. </p>
<p>By default, the service is <strong>load-balanced across all worker nodes</strong>. To the consumer, the Docker service appears to be a single application. Docker Engine supports swarm mode in Docker 1.12 and higher.</p>
</li>
</ul>
</li>
</ul>
<h2 id="Installing-Docker"><a href="#Installing-Docker" class="headerlink" title="Installing Docker"></a>Installing Docker</h2><p>Please follow the <a href="#https://docs.docker.com/get-started/">Official Guide</a>.</p>
<h2 id="Basic-Workflow"><a href="#Basic-Workflow" class="headerlink" title="Basic Workflow"></a>Basic Workflow</h2><p>In general, the development workflow for containerized applications looks like this:</p>
<ol>
<li><strong>Create</strong> a Docker <code>image</code> containing the components of your application</li>
<li><strong>Test</strong> those components</li>
<li><strong>Assemble</strong> your containers using the <code>image</code> file and supporting infrastructure into a complete application</li>
<li>Test, share, and deploy your complete containerized application.</li>
</ol>
<h2 id="Quickstart-for-Building-an-Image-and-a-Container"><a href="#Quickstart-for-Building-an-Image-and-a-Container" class="headerlink" title="Quickstart for Building an Image and a Container"></a>Quickstart for Building an Image and a Container</h2><p>First, we could use an existing project to demonstrate some concepts mentioned above.</p>
<ol>
<li><p>Run:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;dockersamples&#x2F;node-bulletin-board</span><br><span class="line">cd node-bulletin-board&#x2F;bulletin-board-app</span><br></pre></td></tr></table></figure>

<p> Then you will see that there is a file called <strong><code>Dockerfile</code></strong>. <strong><code>Dockerfile</code></strong>s describe <strong>how to build an <code>image</code> and assemble a <code>container</code></strong> with a private filesystem, and can also contain some metadata describing <strong>how to run a <code>container</code></strong> based on this image. </p>
<p> The bulletin board app <strong><code>Dockerfile</code></strong> looks like this:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># Use the official image as a parent image.</span><br><span class="line">FROM node:current-slim</span><br><span class="line"></span><br><span class="line"># Set the working directory.</span><br><span class="line">WORKDIR &#x2F;usr&#x2F;src&#x2F;app</span><br><span class="line"></span><br><span class="line"># Copy the file from your host to your current location.</span><br><span class="line">COPY package.json .</span><br><span class="line"></span><br><span class="line"># Run the command inside your image filesystem.</span><br><span class="line">RUN npm install</span><br><span class="line"></span><br><span class="line"># Inform Docker that the container is listening on the specified port at runtime.</span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line"># Run the specified command within the container.</span><br><span class="line">CMD [ &quot;npm&quot;, &quot;start&quot; ]</span><br><span class="line"></span><br><span class="line"># Copy the rest of your app&#39;s source code from your host to your image filesystem.</span><br><span class="line">COPY . .</span><br></pre></td></tr></table></figure>
<p> You can think of these <strong><code>Dockerfile</code></strong> commands as a step-by-step recipe on how to build up your <code>image</code>. </p>
</li>
<li><p>Make sure you‚Äôre in the directory <code>node-bulletin-board/bulletin-board-app</code> in a terminal or PowerShell using the cd command. Let‚Äôs build your bulletin board <code>image</code>:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build --tag bulletinboard:1.0 .</span><br></pre></td></tr></table></figure>

<p> You‚Äôll see <strong>Docker step through each instruction in your <code>Dockerfile</code></strong>, building up your <code>image</code> as it goes: </p>
<ul>
<li><p>Start <strong>FROM</strong> the pre-existing <code>node:current-slim</code> image. This is an official image, built by the node.js vendors and validated by Docker to be a high-quality image containing the Node.js Long Term Support (LTS) interpreter and basic dependencies.</p>
</li>
<li><p>Use <strong>WORKDIR</strong> to specify that all subsequent actions should be taken from the directory /usr/src/app in your image filesystem (never the host‚Äôs filesystem).</p>
</li>
<li><p><strong>COPY</strong> the file <code>package.json</code> from your host to the present location (<code>.</code>) in your image (so in this case, to /usr/src/app/package.json)</p>
</li>
<li><p><strong>RUN</strong> the command <code>npm install</code> inside your image filesystem (which will read <code>package.json</code> to determine your app‚Äôs node dependencies, and install them)</p>
</li>
<li><p><strong>COPY</strong> in the rest of your app‚Äôs source code from your host to your image filesystem.</p>
<p>If successful, the build process should end with a message <code>Successfully tagged bulletinboard:1.0</code>.</p>
<p>The steps above built up the filesystem of our image, but there are other lines in your <code>Dockerfile</code>.</p>
</li>
<li><p>The <strong>CMD</strong> directive is the first example of specifying some metadata in your <code>image</code> that <strong>describes how to run a container based on this image</strong>. In this case, it‚Äôs saying that the containerized process that this <code>image</code> is meant to support is <code>npm start</code>.</p>
</li>
<li><p>The <strong>EXPOSE</strong> <code>8080</code> informs Docker that the container is listening on port <code>8080</code> at runtime.</p>
</li>
</ul>
</li>
<li><p>Now you have an <code>image</code> and you can start a <code>container</code> based on the <code>image</code>:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --publish 8000:8080 --detach --name  bb bulletinboard:1.0</span><br></pre></td></tr></table></figure>

<p> This has a couple of common flags:</p>
<ul>
<li><code>--publish</code> asks Docker to <strong>forward traffic incoming on the host‚Äôs port 8000</strong>, <strong>to the container‚Äôs port 8080</strong>. Containers have their own private set of ports, so if you want to reach one from the network, you have to forward traffic to it in this way. Otherwise, firewall rules will prevent all network traffic from reaching your container, as a default security posture.</li>
<li><code>--detach</code> asks Docker to <strong>run this container in the background</strong>.</li>
<li><code>--name</code> specifies a <strong>name with which you can refer to your container in subsequent commands</strong>, in this case <code>bb</code>.</li>
</ul>
</li>
<li><p>Now, you can visit the application in a browser at <code>localhost:8000</code>. <strong>At this step</strong>, it would be the time to <strong>run unit tests</strong>, for example. You would normally do everything you could to ensure your container works the way you expected.</p>
<p> Once you‚Äôre satisfied that your bulletin board container works correctly, you can delete it:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rm --force bb</span><br></pre></td></tr></table></figure>

<p> The <code>--force</code> option stops a running container, so it can be removed. If you stop the container running with <code>docker stop bb</code> first, then you do not need to use <code>--force</code> to remove it.</p>
</li>
</ol>
<p>At this point, you‚Äôve successfully <strong>built an <code>image</code></strong>, <strong>performed a simple containerization of an application using that <code>image</code></strong>, and confirmed that your app runs successfully in its container.</p>
<h2 id="Quickstart-for-Sharing-Images-on-Docker-Hub"><a href="#Quickstart-for-Sharing-Images-on-Docker-Hub" class="headerlink" title="Quickstart for Sharing Images on Docker Hub"></a>Quickstart for Sharing Images on Docker Hub</h2><p>At this point, <strong>you‚Äôve built a containerized application</strong>. The final step is to <strong>share your images on a <code>registry</code> like Docker Hub</strong>, so they can be easily downloaded and run on any destination machine. (first you need to have a Docker Hub account, if needed help, follow <a href="#https://docs.docker.com/get-started/part3/#set-up-your-docker-hub-account">this guide</a>)</p>
<ol>
<li><p>Once you have an account, you need to create a repository. At this point, you can only <strong>specify a repository name</strong>, for example, <code>bulletin</code>, and click create.</p>
</li>
<li><p>Now you are ready to share your <code>image</code> on Docker Hub, but there‚Äôs <strong>one thing you must do first</strong>: images must be <strong>namespaced correctly to share on Docker Hub</strong>. Specifically, you must name images like <code>&lt;Docker ID&gt;/&lt;Repository Name&gt;:&lt;tag&gt;</code>.</p>
<p> For example, if your username is <code>abc</code> and the name of your created repository is <code>bulletin</code>, then you <strong>need to tag your image to be: <code>abc/bulletin:&lt;whateverVersionHere&gt;</code></strong>. This is because, when you push in the next step, Docker will look up specifically at location <code>abc/bulletin</code> in Docker Hub. If you spelled something wrongly, it will not go to the correct location.</p>
</li>
<li><p>Finally, push your <code>image</code> to Docker Hub. For example, like this:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push abc&#x2F;bulletin:1.0</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>Now that your image is available on Docker Hub, you‚Äôll be able to run it anywhere. By moving images around in this way, you <strong>no longer need to install any dependencies except Docker on the machines</strong> you want to run your software on. The dependencies of containerized applications are completely encapsulated and isolated within your images, which you can share using Docker Hub as described above.</p>
<p>However, there is one thing to keep in mind: at the moment, you‚Äôve only <strong>pushed your <code>image</code></strong> to Docker Hub; <strong>what about your <code>Dockerfile</code></strong>? A crucial best practice is to <strong>keep these in version control (e.g.  using <code>git</code>), perhaps alongside your source code for your application</strong>. You can add a link or note in your Docker Hub repository description indicating where these files can be found, preserving the record not only of how your image was built, but how it‚Äôs meant to be run as a full application.</p>
<h2 id="Starting-and-Stopping-Containers"><a href="#Starting-and-Stopping-Containers" class="headerlink" title="Starting and Stopping Containers"></a>Starting and Stopping Containers</h2><ul>
<li><p>To create a new <code>container</code> from an <code>image</code> and start it, use <code>docker run</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run [options] &lt;image&gt; [command] [argument]</span><br></pre></td></tr></table></figure>

<p>  Usually, you would want to specify a name for your container, which means you add the <code>--name</code> option. For example:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run ‚Äì‚Äìname&#x3D;Ubuntu-Test ubuntu:14.04</span><br></pre></td></tr></table></figure>
<p>  where <code>ubuntu:14.04</code> would be the <code>ubuntu</code> image with version/tag <code>14.04</code>. However, if you do not define a name for your newly created container, the <code>deamon</code> will <strong>generate a random string name</strong>, which you can later check with the <code>docker ps</code> command (see the section <a href="#Viewing-and-Removing-Containers">Viewing and Removing Containers</a>)</p>
<p>  However, this would only start a <code>container</code>. If you would like to interact with it, you need to add the <code>‚Äìi</code> and <code>‚Äìt</code> options to enter the interative mode. For example, to enter the Ubuntu bash in the ubuntu container created in the above example, you could run:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run ‚Äìit ‚Äì‚Äìname&#x3D;Ubuntu_Test ubuntu:14.04</span><br></pre></td></tr></table></figure>
<p>  Instead of using <code>-i</code> or <code>-t</code> options, use the <code>attach</code> command to connect to a running container as well:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker attach container_id</span><br></pre></td></tr></table></figure>
<p>  (To <strong>exit the container</strong>, you can type <code>EXIT</code>)</p>
</li>
<li><p>To stop a <code>container</code>, you could use the <code>docker stop</code> command:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop [option] &lt;container_id&gt;</span><br></pre></td></tr></table></figure>

<p>  By default, you get a 10 second grace period if you run <code>docker stop</code>. This means that the <code>stop</code> command instructs the <code>container</code> to <strong>stop services after that 10 seconds period</strong>. You can also use the <code>--time</code> option to define a different grace period expressed in seconds, for example:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop --time&#x3D;20 &lt;container_id&gt;</span><br></pre></td></tr></table></figure>

<p>  If you want to immediately kill a docker <code>container</code> without waiting for the grace period to end, use:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker kill [option] &lt;container_id&gt;</span><br></pre></td></tr></table></figure>

<p>  Additionally, a useful command is to <strong>stop (or kill) all running containers</strong>:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop $(docker ps ‚Äìa ‚Äìq)</span><br></pre></td></tr></table></figure>
<p>  If you want to <code>kill</code> those <code>container</code>s, just replace the <code>stop</code> with <code>kill</code>.</p>
</li>
</ul>
<h2 id="Viewing-and-Removing-Unwanted-Images"><a href="#Viewing-and-Removing-Unwanted-Images" class="headerlink" title="Viewing and Removing Unwanted Images"></a>Viewing and Removing Unwanted Images</h2><ul>
<li><p>To view the <code>image</code>s, you could use the command:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>
<p>  to provide you with a list of images that you have created. For example, they might look like this:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">REPOSITORY                      TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">bulletinboard                   1.0                 2cd431e8ee37        3 hours ago         182MB</span><br><span class="line">mysql                           8.0                 30f937e841c8        4 days ago          541MB</span><br><span class="line">node                            current-slim        8ec3841e41bb        4 days ago          165MB</span><br><span class="line">ubuntu                          latest              1d622ef86b13        4 weeks ago         73.9MB</span><br></pre></td></tr></table></figure></li>
<li><p>To remove an <code>image</code>, you need to specify <strong>both the name and the version</strong> (<code>tag</code>) in the format <code>&lt;name&gt;:&lt;version&gt;</code>. For example, to remove the <code>bulletinboard</code> image, you could do:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image rm -f bulletinboard:1.0</span><br></pre></td></tr></table></figure>

<p>  However, if it is at the <code>latest</code> version/tag, then you can just specify the name:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image rm -f ubuntu</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> The <code>-f</code> or <code>--force</code> option is <strong>only necessay when you have the <code>container</code> running</strong>. If it is not running, it can be removed just by specifying <code>docker image rm</code></li>
</ul>
</blockquote>
</li>
</ul>
<p><a name="Viewing-and-Removing-Containers"></a></p>
<h2 id="Viewing-and-Removing-Containers"><a href="#Viewing-and-Removing-Containers" class="headerlink" title="Viewing and Removing Containers"></a>Viewing and Removing Containers</h2><ul>
<li><p>To list all <strong>running containers</strong>, you can use the command:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure>
<p>  which, for example, could gives you:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CONTAINER ID        IMAGE                       COMMAND                  CREATED             STATUS                             PORTS                 NAMES</span><br><span class="line">a22b3d54d5f4        mysql&#x2F;mysql-server:latest   &quot;&#x2F;entrypoint.sh mysq‚Ä¶&quot;   18 seconds ago      Up 17 seconds (health: starting)   3306&#x2F;tcp, 33060&#x2F;tcp   test-sql-server</span><br></pre></td></tr></table></figure>

<p>  However, if you would like to see also stopped <code>container</code>s, you could use the <code>-a</code> or <code>--all</code> flag:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a</span><br></pre></td></tr></table></figure>

<p>  Some of the other <strong>useful options</strong> include:</p>
<table>
<thead>
<tr>
<th>Option</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>--filter</code> , <code>-f</code></td>
<td>-</td>
<td>Filter output based on conditions provided</td>
</tr>
<tr>
<td><code>--format</code></td>
<td>-</td>
<td>Pretty-print containers using a Go template</td>
</tr>
<tr>
<td><code>--last</code>, <code>-n</code></td>
<td>-1</td>
<td>Show n last created containers (includes all states)</td>
</tr>
<tr>
<td><code>--latest</code> , <code>-l</code></td>
<td>-</td>
<td>Show the latest created container (includes all states)</td>
</tr>
<tr>
<td><code>--no-trunc</code></td>
<td>-</td>
<td>Don‚Äôt truncate output</td>
</tr>
<tr>
<td><code>--quiet</code> , <code>-q</code></td>
<td>-</td>
<td>Only display numeric IDs</td>
</tr>
</tbody></table>
<p>  The <code>--filter</code> could be quite useful to select <code>container</code>s you want to see, for example, if you only want to see <code>container</code>s with name having the substring <code>test</code>, you could run:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps --filter &quot;name&#x3D;test&quot;</span><br></pre></td></tr></table></figure>

<p>  For a full list of examples using <code>--format</code>, please refer to the <a href="#https://docs.docker.com/engine/reference/commandline/ps/#filtering">Docker Doc here</a></p>
</li>
<li><p>On the other hand, to remove unwanted <code>container</code>s, you could use the command:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker container rm &lt;container-id&gt;</span><br></pre></td></tr></table></figure>

<p>  where the <code>&lt;container-id&gt;</code> could be seen if you run the <code>docker ps</code> command shown above. If the container is running, you could also force remove it with the <code>--force</code> or <code>-f</code> option.</p>
<p>  For other commands/options related to <code>docker container -rm</code> please refer to the <a href="#https://docs.docker.com/engine/reference/commandline/container_rm/">Docker Doc here</a></p>
</li>
</ul>
<h2 id="Copying-Files-to-and-from-a-Container"><a href="#Copying-Files-to-and-from-a-Container" class="headerlink" title="Copying Files to and from a Container"></a>Copying Files to and from a Container</h2><ul>
<li><p>To copy local files to a container, you can use teh command:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker cp &lt;localPath&gt;&#x2F;&lt;fromFile&gt; &lt;container-id&gt;:&lt;pathInContainer&gt;&#x2F;&lt;toFile&gt;</span><br></pre></td></tr></table></figure>

<p>  For example:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker cp foo.txt test-container:~&#x2F;foo.txt</span><br></pre></td></tr></table></figure>
<p>  Then you can see the file <code>foo.txt</code> in your container at the path <code>root/foo.txt</code></p>
</li>
<li><p>Similarily, to copy a file from a container to your local machine, you can use:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker cp &lt;container-id&gt;:&lt;pathInContainer&gt;&#x2F;&lt;fromFile&gt; &lt;localPath&gt;&#x2F;&lt;toFile&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="Configuring-your-Docker-Daemon"><a href="#Configuring-your-Docker-Daemon" class="headerlink" title="Configuring your Docker Daemon"></a>Configuring your Docker Daemon</h2><p>To configure the Docker daemon using a JSON file, create a file at <code>/etc/docker/daemon.json</code> on Linux systems, or <code>C:\ProgramData\docker\config\daemon.json</code> on Windows. On MacOS go to the whale in the <code>taskbar &gt; Preferences &gt; Daemon &gt; Advanced</code>.</p>
<p>For example, if you want your Docker daemon to run in <code>debug mode</code>, uses <code>TLS</code>, and listens for traffic routed to <code>192.168.59.3</code> on port <code>2376</code>, you would have the following configuration in your <code>daemon.json</code> ( You can learn what configuration options are available in the <a href="https://docs.docker.com/engine/reference/commandline/dockerd/#daemon-configuration-file" target="_blank" rel="noopener">dockerd reference docs</a>):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;debug&quot;: true,</span><br><span class="line">  &quot;tls&quot;: true,</span><br><span class="line">  &quot;tlscert&quot;: &quot;&#x2F;var&#x2F;docker&#x2F;server.pem&quot;,</span><br><span class="line">  &quot;tlskey&quot;: &quot;&#x2F;var&#x2F;docker&#x2F;serverkey.pem&quot;,</span><br><span class="line">  &quot;hosts&quot;: [&quot;tcp:&#x2F;&#x2F;192.168.59.3:2376&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>However, you could also manually start a daemon with the same configuration in your command line:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dockerd --debug \</span><br><span class="line">  --tls&#x3D;true \</span><br><span class="line">  --tlscert&#x3D;&#x2F;var&#x2F;docker&#x2F;server.pem \</span><br><span class="line">  --tlskey&#x3D;&#x2F;var&#x2F;docker&#x2F;serverkey.pem \</span><br><span class="line">  --host tcp:&#x2F;&#x2F;192.168.59.3:2376</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> If you use a <code>daemon.json</code> file <strong>and also pass options to the <code>dockerd</code> command</strong> manually or using start-up scripts, and these options conflict, Docker fails to start with an error such as:</li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">unable to configure the Docker daemon with file &#x2F;etc&#x2F;docker&#x2F;daemon.json:</span><br><span class="line">the following directives are specified both as a flag and in the configuration</span><br><span class="line">file: hosts: (from flag: [unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;docker.sock], from file: [tcp:&#x2F;&#x2F;127.0.0.1:2376])</span><br></pre></td></tr></table></figure>
<p>If you see an error similar to this one and you are starting the daemon manually with flags, you may need to <strong>adjust your flags or the daemon.json to remove the conflict</strong>.</p>
<p>This means if you want to enter the debug mode, you can set the <code>debug</code> key to <code>true</code> in the <code>daemon.json</code> file. This method works for every Docker platform and is recommended.</p>
<ul>
<li><p>If the file is empty, add the following:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;debug&quot;: true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>If the file already contains JSON, just add the key <code>&quot;debug&quot;: true</code>, being careful to add a comma to the end of the line if it is not the last line before the closing bracket. Also <strong>verify that if the <code>log-level</code> key is set, it is set to either <code>info</code> or <code>debug</code></strong>. <code>info</code> is the default, and possible values are <code>debug</code>, <code>info</code>, <code>warn</code>, <code>error</code>, <code>fatal</code>.</p>
</li>
<li><p>Send a HUP signal to the daemon to cause it to reload its configuration. </p>
<ul>
<li><p>On Linux hosts, use the following command.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo kill -SIGHUP $(pidof dockerd)</span><br></pre></td></tr></table></figure>
</li>
<li><p>On Windows hosts, restart Docker.</p>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Instead of following this procedure, you can also <code>stop</code> the Docker <code>daemon</code> and <code>restart</code> it manually with the <code>debug flag -D</code>. However, this may result in Docker <strong>restarting with a different environment than the one the hosts‚Äô startup scripts create</strong>, and this may make debugging more difficult.</li>
</ul>
</blockquote>
<h2 id="Starting-your-Docker-Daemon-Manually"><a href="#Starting-your-Docker-Daemon-Manually" class="headerlink" title="Starting your Docker Daemon Manually"></a>Starting your Docker Daemon Manually</h2><p>Once Docker is installed, <strong>you need to start the Docker daemon</strong>. Most Linux distributions use <code>systemctl</code> to start services. If you do not have <code>systemctl</code>, use the <code>service</code> command.</p>
<ul>
<li><p><code>systemctl</code>:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl start docker</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>service</code>:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo service docker start</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="Starting-your-Containers-Automatically"><a href="#Starting-your-Containers-Automatically" class="headerlink" title="Starting your Containers Automatically"></a>Starting your Containers Automatically</h2><p>Docker provides restart policies to <strong>control whether your containers start automatically when they exit, or when Docker restarts</strong>. Restart policies ensure that linked containers are started in the correct order. Docker recommends that you use restart policies, and avoid using process managers to start containers.</p>
<p>To configure the <strong>restart policy</strong> for a container, use the <code>--restart</code> flag when using the <code>docker run</code> command. The value of the <code>--restart</code> flag can be any of the following:</p>
<table>
<thead>
<tr>
<th>Flag</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>no</code></td>
<td>Do not automatically restart the container. (the default)</td>
</tr>
<tr>
<td><code>on-failure</code></td>
<td>Restart the container <strong>if it exits due to an error</strong>, which manifests as a non-zero exit code.</td>
</tr>
<tr>
<td><code>always</code></td>
<td><strong>Always restart the container if it stops</strong>. <strong>If it is manually stopped</strong>, it is <strong>restarted only when Docker daemon restarts or the container itself is manually restarted</strong>. (See the second bullet listed in restart policy details)</td>
</tr>
<tr>
<td><code>unless-stopped</code></td>
<td>Similar to always, except that <strong>when the container is stopped (manually or otherwise)</strong>, it is <strong>not restarted even after Docker daemon restarts</strong>.</td>
</tr>
</tbody></table>
<p>The following example starts a Redis container and configures it to always restart unless it is explicitly stopped or Docker is restarted.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d --restart unless-stopped redis</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> A restart policy <strong>only takes effect after a container starts successfully (when you run the command specifying the restart policy)</strong>. In this case, starting successfully means that the container is up for at least 10 seconds and Docker has started monitoring it. This <strong>prevents a container</strong> which does not start at all from going <strong>into a restart loop</strong>.</li>
<li><input disabled type="checkbox"> <strong>If you manually stop a container</strong>, <strong>its restart policy is ignored until the Docker daemon restarts or the container is manually restarted</strong>. This is another attempt to <strong>prevent a restart loop</strong>.</li>
<li><input disabled type="checkbox"> Restart policies <strong>only apply to containers</strong>. Restart policies for swarm services are configured differently. See the flags related to service restart.</li>
</ul>
</blockquote>
<h2 id="Keep-Containers-Alive-during-Daemon-Downtime"><a href="#Keep-Containers-Alive-during-Daemon-Downtime" class="headerlink" title="Keep Containers Alive during Daemon Downtime"></a>Keep Containers Alive during Daemon Downtime</h2><p><strong>By default</strong>, when the <strong>Docker daemon terminates</strong>, it <strong>shuts down running containers</strong>. Starting with Docker Engine 1.12, you can <strong>configure the daemon so that containers remain running if the daemon becomes unavailable</strong>. This functionality is called <code>live restore</code>. </p>
<p>There are <strong>two ways to enable the <code>live restore</code> setting</strong> to <strong>keep containers alive when the daemon becomes unavailable</strong>. <strong>Only do one of the following</strong>.</p>
<ul>
<li><p>Add the configuration to the daemon configuration file. On Linux, this defaults to <code>/etc/docker/daemon.json</code>. On Docker Desktop for Mac or Docker Desktop for Windows, select the Docker icon from the task bar, then click Preferences -&gt; Daemon -&gt; Advanced.</p>
<ul>
<li><p>Use the following JSON to enable live-restore.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"live-restore"</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Then, restart the Docker daemon. <strong>On Linux</strong>, you can avoid a restart (and avoid any downtime for your containers) by <strong>reloading the Docker daemon</strong>. If you use <code>systemd</code>, then use the command <code>systemctl reload docker</code>. Otherwise, send a SIGHUP signal to the dockerd process.</p>
</li>
</ul>
</li>
<li><p>The other way is to use the <code>--live-restore</code> flag <strong>when you start the dockerd process manually with the <code>--live-restore</code> flag</strong>. This approach is <strong>not recommended because it does not set up the environment that systemd or another process manager would use when starting the Docker process</strong>. This can cause unexpected behavior.</p>
</li>
</ul>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> The live restore option <strong>only works to restore containers if the daemon options</strong>, such as bridge IP addresses and graph driver, <strong>did not change</strong>. If any of these <strong>daemon-level configuration options have changed, the live restore may not work and you may need to manually start the containers</strong>.</li>
<li><input disabled type="checkbox"> If the daemon is down <strong>for a long time</strong>, <strong>running containers may fill up the FIFO log the daemon normally reads</strong>. A full log blocks containers from logging more data. The default buffer size is 64K. <strong>If the buffers fill, you must restart the Docker daemon to flush them</strong>.</li>
</ul>
<p><strong>On Linux</strong>, you can modify the kernel‚Äôs buffer size by changing <code>/proc/sys/fs/pipe-max-size</code>. You cannot modify the buffer size on Docker Desktop for Mac or Docker Desktop for Windows.</p>
<ul>
<li><input disabled type="checkbox"> The live restore option <strong>only pertains to standalone containers, and not to swarm services</strong>. Swarm services are managed by <strong>swarm managers</strong>. If swarm managers are not available, swarm services continue to run on worker nodes but cannot be managed until enough swarm managers are available to maintain a quorum.</li>
</ul>
</blockquote>
<h2 id="Running-Multiple-Services-in-a-Container"><a href="#Running-Multiple-Services-in-a-Container" class="headerlink" title="Running Multiple Services in a Container"></a>Running Multiple Services in a Container</h2><p>This involves writing scripts and editing the Dockerfile. For details please refer to <a href="https://docs.docker.com/config/containers/multi-service_container/" target="_blank" rel="noopener">this link</a>.</p>
<h2 id="Viewing-Runtime-metrics-for-a-Container"><a href="#Viewing-Runtime-metrics-for-a-Container" class="headerlink" title="Viewing Runtime metrics for a Container"></a>Viewing Runtime metrics for a Container</h2><p>There are a couple of ways where you can view the current runtime metrics for your container.</p>
<ol>
<li><p>You can use the <code>docker stats</code> command to <strong>live stream a container‚Äôs runtime metrics</strong>. The command supports CPU, memory usage, memory limit, and network IO metrics.</p>
<p> The following is a sample output from the docker stats command:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker stats redis1 redis2</span><br><span class="line"></span><br><span class="line">CONTAINER           CPU %               MEM USAGE &#x2F; LIMIT     MEM %               NET I&#x2F;O             BLOCK I&#x2F;O</span><br><span class="line">redis1              0.07%               796 KB &#x2F; 64 MB        1.21%               788 B &#x2F; 648 B       3.568 MB &#x2F; 512 KB</span><br><span class="line">redis2              0.07%               2.746 MB &#x2F; 64 MB      4.29%               1.266 KB &#x2F;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Using Linux Control Groups</p>
<p> <strong><em>Q: What is a Linux Control Group?</em></strong></p>
<p> Truth be told, certain <strong>software applications in the wild may need to be controlled or limited‚Äîat least for the sake of stability and, to some degree, security</strong>. Far too often, <strong>a bug or just bad code</strong> can disrupt an entire machine and <strong>potentially cripple an entire ecosystem</strong>. Fortunately, a way exists to keep those same applications in check. <strong>Control groups (cgroups) is a kernel feature that limits, accounts for and isolates the CPU, memory, disk I/O and network‚Äôs usage of one or more processes</strong>.</p>
<p> The primary design goal for cgroups was to provide a unified interface to manage processes or whole operating-system-level virtualization, including Linux Containers, or LXC (a topic I plan to revisit in more detail in a follow-up article). The cgroups framework provides the following:</p>
<ul>
<li><p>Resource limiting: a group can be configured not to exceed a specified memory limit or use more than the desired amount of processors or be limited to specific peripheral devices.</p>
</li>
<li><p>Prioritization: one or more groups may be configured to utilize fewer or more CPUs or disk I/O throughput.</p>
</li>
<li><p>Accounting: a group‚Äôs resource usage is monitored and measured.</p>
</li>
<li><p>Control: groups of processes can be frozen or stopped and restarted.</p>
<p>For more details, please visit this <a href="https://www.linuxjournal.com/content/everything-you-need-know-about-linux-containers-part-i-linux-control-groups-and-process" target="_blank" rel="noopener">site</a>.</p>
<p>Now, <strong>for each container, one cgroup is created in each hierarchy</strong>. On older systems with older versions of the LXC userland tools, the name of the cgroup is the name of the container. With more recent versions of the LXC tools, the cgroup is <code>lxc/&lt;container_name&gt;</code>.</p>
</li>
</ul>
<p> <strong>For Docker containers using cgroups, the container name is the full ID or long ID of the container</strong>. If a container shows up as <code>ae836c95b4c3</code> in <code>docker ps</code>, its long ID might be something like <code>ae836c95b4c3c9e9179e0e91015512da89fdec91612f63cebae57df9a5444c79</code>. You can look it up with <code>docker inspect</code> or <code>docker ps --no-trunc</code>.</p>
<p> Putting everything together to look at the memory metrics for a Docker container, take a look at <code>/sys/fs/cgroup/memory/docker/&lt;longid&gt;/</code>, where for each subsystem (memory, CPU, and block I/O), <strong>one or more pseudo-files exist and contain statistics:</strong></p>
<pre><code>- **MEMORY METRICS: `MEMORY.STAT`**
- **CPU metrics: `cpuacct.stat`**
- **Network metrics** those are not directly exposed by the control group, but information can be gathered from other sources. For details, please follow the link below.</code></pre><p> For a detailed explaination of what you see in all those files, please refer to the <a href="https://docs.docker.com/config/containers/runmetrics/#metrics-from-cgroups-memory-cpu-block-io" target="_blank" rel="noopener">Offical Docker Documentation</a></p>
</li>
</ol>
<h2 id="View-Logs-for-a-Particular-Container-or-Service"><a href="#View-Logs-for-a-Particular-Container-or-Service" class="headerlink" title="View Logs for a Particular Container or Service"></a>View Logs for a Particular Container or Service</h2><p>The <code>docker logs</code> command <strong>shows information logged by a running container</strong>. The <code>docker service logs</code> command <strong>shows information logged by all containers participating in a service</strong>. The information that is logged and the format of the log depends almost entirely on the container‚Äôs endpoint command.</p>
<p>By default, <code>docker logs</code> or <code>docker service logs</code> <strong>shows the command‚Äôs output just as it would appear if you ran the command interactively in a terminal</strong>. UNIX and Linux commands typically open three I/O streams when they run, called <code>STDIN</code>, <code>STDOUT</code>, and <code>STDERR</code>. </p>
<ul>
<li><code>STDIN</code> is the <strong>command‚Äôs input stream</strong> (i.e. user input), which may include input from the keyboard or input from another command. </li>
<li><code>STDOUT</code> is usually a <strong>command‚Äôs normal output</strong></li>
<li><code>STDERR</code> is typically used to <strong>output error messages</strong>. </li>
</ul>
<p><strong>By default, <code>docker logs</code> shows the command‚Äôs <code>STDOUT</code> and <code>STDERR</code>.</strong> </p>
<p>However, in some cases, <strong><code>docker logs</code> may not show useful information unless you take additional steps</strong>.</p>
<ul>
<li><strong>If you use a logging driver</strong> which <strong>sends logs to a file</strong>, an external host, a database, or another logging back-end, docker logs may not show useful information.<ul>
<li>In this case, <strong>your logs are processed in other ways and you may choose not to use docker logs (continue to the section <a href="#Configuring-Logging-Drivers">Configure logging drivers</a>).</strong></li>
</ul>
</li>
<li><strong>If your image runs a non-interactive process</strong> such as a web server or <strong>a database</strong>, that application may <strong>send its output to log files instead of STDOUT and STDERR</strong>.<ul>
<li>In this case, the <strong>official <code>nginx</code> image shows one workaround</strong>, and the <strong>official <code>Apache httpd</code> image shows another</strong>.<ul>
<li>The official nginx image creates a symbolic link from <code>/var/log/nginx/access.log</code> to <code>/dev/stdout</code>, and creates another symbolic link from <code>/var/log/nginx/error.log</code> to <code>/dev/stderr</code>, <strong>overwriting the log files and causing logs to be sent to the relevant special device instead</strong>. See this <a href="https://github.com/nginxinc/docker-nginx/blob/8921999083def7ba43a06fabd5f80e4406651353/mainline/jessie/Dockerfile#L21-L23" target="_blank" rel="noopener">Dockerfile</a>.</li>
<li>The official httpd driver <strong>changes the httpd application‚Äôs configuration to write its normal output directly to /proc/self/fd/1</strong> (which is <code>STDOUT</code>) and <strong>its errors to /proc/self/fd/2</strong> (which is <code>STDERR</code>). See this <a href="https://github.com/docker-library/httpd/blob/b13054c7de5c74bbaa6d595dbe38969e6d4f860c/2.2/Dockerfile#L72-L75" target="_blank" rel="noopener">Dockerfile</a>.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><a name="Configuring-Logging-Drivers"></a></p>
<h2 id="Configuring-Logging-Drivers"><a href="#Configuring-Logging-Drivers" class="headerlink" title="Configuring Logging Drivers"></a>Configuring Logging Drivers</h2><p>Docker includes multiple logging mechanisms to help you get information from running containers and services. These mechanisms are called <strong>logging drivers</strong> (I interpret them as driving your logs to a specific place with a specific format).</p>
<p><strong>By default, Docker uses the <code>json</code> file to log all the outputs</strong>. The file of a container‚Äôs logs can be found in (if you use the default log format which is <code>json</code>):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;var&#x2F;lib&#x2F;docker&#x2F;containers&#x2F;&lt;container id&gt;&#x2F;&lt;container id&gt;-json.log</span><br></pre></td></tr></table></figure>
<p>This will contain the same log output as you will see if you run <code>docker logs &lt;container-id&gt;</code>. If you do not specify a logging driver, the default is json-file. Thus, the default output for commands such as <code>docker inspect &lt;CONTAINER&gt;</code> is also <code>JSON</code>.</p>
<p>To <strong>configure the Docker daemon from the default to a specific logging driver</strong>, set the <strong>value of <code>log-driver</code> to the name of the logging driver</strong> in the <strong><code>daemon.json</code> file</strong>, which is located in <code>/etc/docker/</code> on Linux hosts or <code>C:\ProgramData\docker\config\</code> on Windows server hosts.The following example explicitly sets the default logging driver to <code>syslog</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;log-driver&quot;: &quot;syslog&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>If the logging driver has configurable option</strong>s, you can set them in the <code>daemon.json</code> file as a <code>JSON</code> object <strong>with the key <code>log-opts</code></strong>. The following example sets two configurable options on the json-file logging driver:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;log-driver&quot;: &quot;json-file&quot;,</span><br><span class="line">  &quot;log-opts&quot;: &#123;</span><br><span class="line">    &quot;max-size&quot;: &quot;10m&quot;,</span><br><span class="line">    &quot;max-file&quot;: &quot;3&quot;,</span><br><span class="line">    &quot;labels&quot;: &quot;production_status&quot;,</span><br><span class="line">    &quot;env&quot;: &quot;os,customer&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>and you can also specify directly for a particular container (this will overwrite the JSON file):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d --name&#x3D;&lt;container-name&gt; \</span><br><span class="line">--log-driver json-file \</span><br><span class="line">--log-opt max-size&#x3D;10m --log-opt max-file&#x3D;3 --log-opt labels&#x3D;production_status --log-opt env&#x3D;os,customer \</span><br><span class="line">&lt;yourImage&gt;:&lt;tag&gt;</span><br></pre></td></tr></table></figure>
<p>where:</p>
<ul>
<li><code>max-size</code><ul>
<li>The <strong>maximum size of the log before it is rolled</strong>. A positive integer plus a modifier representing the unit of measure (k=kb, m=mb, or g=gb). Defaults to -1 (unlimited).    </li>
<li>Example: <code>--log-opt max-size=10m</code></li>
</ul>
</li>
<li><code>max-file</code> <ul>
<li>The <strong>maximum number of log files that can be present</strong>. <strong>If rolling the logs creates excess files, the oldest file is removed</strong>. Only effective when max-size is also set. A positive integer. <strong>Defaults to 1</strong>.</li>
<li>Example: <code>--log-opt max-file=3</code></li>
</ul>
</li>
<li><code>labels</code><ul>
<li>Applies when starting the Docker daemon. A comma-separated list of <strong>logging-related labels</strong> this daemon accepts. <strong>Used for advanced log tag options</strong>.    </li>
<li>Example: <code>--log-opt labels=production_status,geo</code></li>
</ul>
</li>
<li><code>env</code><ul>
<li>Applies when starting the Docker daemon. A comma-separated list of <strong>logging-related environment variables</strong> this daemon accepts. <strong>Used for advanced log tag options</strong>.    </li>
<li>Example: <code>--log-opt env=os,customer</code></li>
</ul>
</li>
</ul>
<p>For more details on the JSON File logging driver, please visit <a href="https://docs.docker.com/config/containers/logging/json-file/" target="_blank" rel="noopener">this link</a></p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> <code>log-opts</code> <strong>configuration options</strong> in the <code>daemon.json</code> configuration file <strong>must be provided as strings</strong>. Boolean and numeric values (such as the value for max-file in the example above) must therefore be enclosed in quotes (<code>&quot;</code>).</li>
</ul>
</blockquote>
<p>Now, To <strong>find the current default logging driver for the Docker daemon</strong>, run <code>docker info</code> and search for Logging Driver. You can use the following command on Linux, macOS, or PowerShell on Windows:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker info --format &#39;&#123;&#123;.LoggingDriver&#125;&#125;&#39;</span><br><span class="line"></span><br><span class="line">json-file</span><br></pre></td></tr></table></figure>

<p>To find the <strong>current logging driver for a running container</strong>, if the daemon is using the json-file logging driver, run the following docker inspect command, substituting the container name or ID for <code>&lt;CONTAINER&gt;</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker inspect -f &#39;&#123;&#123;.HostConfig.LogConfig.Type&#125;&#125;&#39; &lt;CONTAINER&gt;</span><br><span class="line"></span><br><span class="line">json-file</span><br></pre></td></tr></table></figure>

<h2 id="Use-environment-variables-or-labels-with-logging-drivers"><a href="#Use-environment-variables-or-labels-with-logging-drivers" class="headerlink" title="Use environment variables or labels with logging drivers"></a>Use environment variables or labels with logging drivers</h2><p>Some logging drivers add the value of a container‚Äôs <code>--env|-e</code> or ‚Äìlabel flags to the container‚Äôs logs. This example starts a container using the Docker daemon‚Äôs default logging driver (let‚Äôs assume json-file) but sets the environment variable os=ubuntu.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -dit --label production_status&#x3D;testing -e os&#x3D;ubuntu alpine sh</span><br></pre></td></tr></table></figure>

<p>If the logging driver supports it, this adds additional fields to the logging output. The following output is generated by the json-file logging driver:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;attrs&quot;:&#123;&quot;production_status&quot;:&quot;testing&quot;,&quot;os&quot;:&quot;ubuntu&quot;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Supported-Logging-Drivers"><a href="#Supported-Logging-Drivers" class="headerlink" title="Supported Logging Drivers"></a>Supported Logging Drivers</h2><p>The following logging drivers are supported. If you are using logging driver plugins, you may see more options.</p>
<table>
<thead>
<tr>
<th>Driver</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>none</code></td>
<td>No logs are available for the container and docker logs does not return any output.</td>
</tr>
<tr>
<td><code>local</code></td>
<td>Logs are stored in a custom format designed for minimal overhead.</td>
</tr>
<tr>
<td><code>json-file</code></td>
<td>The logs are formatted as JSON. The default logging driver for Docker.</td>
</tr>
<tr>
<td><code>syslog</code></td>
<td>Writes logging messages to the syslog facility. The syslog daemon must be running on the host machine.</td>
</tr>
<tr>
<td><code>journald</code></td>
<td>Writes log messages to journald. The journald daemon must be running on the host machine.</td>
</tr>
<tr>
<td><code>gelf</code></td>
<td>Writes log messages to a Graylog Extended Log Format (GELF) endpoint such as Graylog or Logstash.</td>
</tr>
<tr>
<td><code>fluentd</code></td>
<td>Writes log messages to fluentd (forward input). The fluentd daemon must be running on the host machine.</td>
</tr>
<tr>
<td><code>awslogs</code></td>
<td>Writes log messages to Amazon CloudWatch Logs.</td>
</tr>
<tr>
<td><code>splunk</code></td>
<td>Writes log messages to splunk using the HTTP Event Collector.</td>
</tr>
<tr>
<td><code>etwlogs</code></td>
<td>Writes log messages as Event Tracing for Windows (ETW) events. Only available on Windows platforms.</td>
</tr>
<tr>
<td><code>gcplogs</code></td>
<td>Writes log messages to Google Cloud Platform (GCP) Logging.</td>
</tr>
<tr>
<td><code>logentries</code></td>
<td>Writes log messages to Rapid7 Logentries.</td>
</tr>
</tbody></table>
<p>However, there are <strong>limitations for using logging drivers in general</strong> as well:</p>
<ul>
<li>Users of <strong>Docker Enterprise can make use of ‚Äúdual logging‚Äù</strong>, which enables you to use the docker logs command for any logging driver. Refer to reading logs when using remote logging drivers for information about using docker logs to read container logs locally for many third party logging solutions, including:<ul>
<li><code>syslog</code></li>
<li><code>gelf</code></li>
<li><code>fluentd</code></li>
<li><code>awslogs</code></li>
<li><code>splunk</code></li>
<li><code>etwlogs</code></li>
<li><code>gcplogs</code></li>
<li><code>Logentries</code></li>
</ul>
</li>
<li>When using <strong>Docker Community Engine</strong>, the docker logs command is only available on the following drivers:<br>local<ul>
<li><code>json-file</code></li>
<li><code>journald</code></li>
</ul>
</li>
<li>Reading log information <strong>requires decompressing rotated log files</strong>, which <strong>causes a temporary increase in disk usage</strong> (until the log entries from the rotated files are read) and an increased CPU usage while decompressing.</li>
<li>The capacity of the host storage where the Docker data directory resides determines the maximum size of the log file information.</li>
</ul>
<h2 id="Using-a-Logging-Driver-Plugin"><a href="#Using-a-Logging-Driver-Plugin" class="headerlink" title="Using a Logging Driver Plugin"></a>Using a Logging Driver Plugin</h2><p>Docker logging plugins allow you to extend and customize Docker‚Äôs logging capabilities beyond those of the built-in logging drivers. <strong>A logging service provider can implement their own plugins and make them available on Docker Hub, or a private registry</strong>.</p>
<ol>
<li><p>First, you need to install the logging driver plugin</p>
<ul>
<li>To install a logging driver plugin, use <code>docker plugin install &lt;org/image&gt;</code>, using the information provided by the plugin developer.</li>
</ul>
</li>
<li><p>You can <strong>list all installed plugins</strong> using <code>docker plugin ls</code>, and you can <strong>inspect a specific plugin</strong> using <code>docker inspect</code>.</p>
</li>
<li><p>If you wan to configure the plugin <strong>as the default logging driver</strong>:</p>
<ul>
<li>After the plugin is installed, you can configure the Docker daemon to use it as the default by setting the plugin‚Äôs name as the value of the <code>log-driver</code> key in the <code>daemon.json</code>, as detailed in the previous section. If the logging driver supports additional options, you can set those as the values of the <code>log-opts</code> array in the same file.</li>
</ul>
</li>
<li><p>If you want to configure <strong>a container to use the plugin</strong> as the logging driver:</p>
<ul>
<li>After the plugin is installed, you can configure a container to use the plugin as its logging driver by <strong>specifying the <code>--log-driver</code> flag to <code>docker run</code></strong>, as detailed in the previous section. If the logging driver supports additional options, you can specify them using one or more <code>--log-opt</code> flags with the option name as the key and the option value as the value.</li>
</ul>
</li>
</ol>
<h2 id="Customizing-the-Logging-Driver-Tag"><a href="#Customizing-the-Logging-Driver-Tag" class="headerlink" title="Customizing the Logging Driver Tag"></a>Customizing the Logging Driver Tag</h2><p>The tag log option specifies how to format a tag that identifies the container‚Äôs log messages. By default, the system uses the first 12 characters of the container ID. To override this behavior, specify a tag option:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --log-driver&#x3D;fluentd --log-opt fluentd-address&#x3D;myhost.local:24224 --log-opt tag&#x3D;&quot;testTag&quot;</span><br></pre></td></tr></table></figure>

<p>Often, you would like to use a special template markup:  --log-opt tag=".ImageName/.Name/.ID"  value yields syslog log lines like:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Aug  7 18:33:19 HOSTNAME hello-world&#x2F;foobar&#x2F;5790672ab6a0[9103]: Hello from Docker.</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>Markup</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>{{.ID}}</td>
<td>The first 12 characters of the container ID.</td>
</tr>
<tr>
<td>{{.FullID}}</td>
<td>The full container ID.</td>
</tr>
<tr>
<td>{{.Name}}</td>
<td>The container name.</td>
</tr>
<tr>
<td>{{.ImageID}}</td>
<td>The first 12 characters of the container‚Äôs image ID.</td>
</tr>
<tr>
<td>{{.ImageFullID}}</td>
<td>The container‚Äôs full image ID.</td>
</tr>
<tr>
<td>{{.ImageName}}</td>
<td>The name of the image used by the container.</td>
</tr>
<tr>
<td>{{.DaemonName}}</td>
<td>The name of the docker program (docker).</td>
</tr>
</tbody></table>
<h2 id="Dokcer-Network-Overview"><a href="#Dokcer-Network-Overview" class="headerlink" title="Dokcer Network Overview"></a>Dokcer Network Overview</h2><p>One of the reasons Docker containers and services are so powerful is that you can <strong>connect them together</strong>, or <strong>connect them to non-Docker workloads</strong>. Docker containers and services do not even need to be aware that they are deployed on Docker, or whether their peers are also Docker workloads or not. Whether your Docker hosts run Linux, Windows, or a mix of the two, you can use Docker to manage them in a platform-agnostic way.</p>
<p>However. this topic <strong>does not go into OS-specific details</strong> about how Docker networks work, so you will not find information about how Docker manipulates <code>iptables</code> rules on Linux or how it manipulates routing rules on Windows servers, and you will not find detailed information about how Docker forms and encapsulates packets or handles encryption. </p>
<h2 id="Network-Drivers"><a href="#Network-Drivers" class="headerlink" title="Network Drivers"></a>Network Drivers</h2><p>Docker‚Äôs networking subsystem is pluggable, <strong>using drivers</strong>. Several drivers <strong>exist by default</strong>, and provide core networking functionality:</p>
<ul>
<li><p><code>bridge</code>: </p>
<ul>
<li>The <strong>default</strong> network driver. If you don‚Äôt specify a driver, this is the type of network you are creating. Bridge networks are usually used when your <strong>applications run in standalone containers that need to communicate</strong>. </li>
<li>This is usually the best choice when you need <strong>multiple containers to communicate on the same Docker host</strong>.</li>
<li>For more details, see the <a href="#Using-bridge-networks">bridge networks section</a>.</li>
</ul>
</li>
<li><p><code>host</code>: </p>
<ul>
<li>For standalone containers, this will <strong>remove network isolation between the container and the Docker host, and use the host‚Äôs networking directly</strong>. <code>host</code> is only available for swarm services on <code>Docker 17.06</code> and higher.</li>
<li>This is the best choice when the <strong>network stack should not be isolated from the Docker host</strong>, but you want <strong>other aspects of the container to be isolated</strong>.</li>
<li>For more details, see the <a href="#Using-host-networks">host networks section</a></li>
</ul>
</li>
<li><p><code>overlay</code>: </p>
<ul>
<li>Overlay networks <strong>connect multiple Docker daemons together and enable swarm services to communicate with each other</strong>. You can also use <strong>overlay networks</strong> to facilitate communication between a swarm service and a standalone container, or between two standalone containers on different Docker daemons. This strategy removes the need to do OS-level routing between these containers.</li>
<li>This is the best choice when you need <strong>containers running on different Docker hosts to communicate</strong>, or when <strong>multiple applications work together using swarm services</strong>.</li>
<li>This is the best choice when you are <strong>migrating from a VM setup</strong> or <strong>need your containers to look like physical hosts</strong> on your network, each with a unique MAC address.</li>
<li>For more details, see the <a href="#Using-overlay-networks">overlay networks section</a></li>
</ul>
</li>
<li><p><code>macvlan</code>: </p>
<ul>
<li>Macvlan networks allow you to <strong>assign a MAC address to a container, making it appear as a physical device on your network</strong>. The Docker daemon routes traffic to containers by their MAC addresses. Using the macvlan driver is sometimes the best choice when dealing with legacy applications that expect to be directly connected to the physical network, rather than routed through the Docker host‚Äôs network stack. </li>
<li>For more details, see the <a href="#Using-mcvlan-networks">mcvlan networks section</a></li>
</ul>
</li>
<li><p><code>none</code>: </p>
<ul>
<li>For this container, <strong>disable all networking</strong>. Usually used in conjunction with a custom network driver. <code>none</code> is not available for swarm services. </li>
<li>For more details, see the <a href="#Using-none-networks">none networks section</a></li>
</ul>
</li>
<li><p><code>Network plugins</code>: </p>
<ul>
<li>You can <strong>install and use third-party network plugins</strong> with Docker. These plugins are available from Docker Hub or from third-party vendors. See the vendor‚Äôs documentation for installing and using a given network plugin.</li>
</ul>
</li>
</ul>
<p><a name="Using-bridge-networks"></a></p>
<h2 id="Using-bridge-networks"><a href="#Using-bridge-networks" class="headerlink" title="Using bridge networks"></a>Using <code>bridge</code> networks</h2><p>In terms of Docker, a <code>bridge</code> network uses a software bridge which allows <strong>containers connected to the same bridge network to communicate, while providing isolation from containers which are not connected to that bridge network</strong>. </p>
<p>The Docker bridge driver <strong>automatically installs rules in the host machine</strong> so that containers on different bridge networks cannot communicate directly with each other. However, <code>bridge</code> networks <strong>apply to containers running on the same Docker daemon host</strong>. For communication among containers running on different Docker daemon hosts, you can either manage routing at the OS level, or you can use an overlay network.</p>
<p>Now, for bridge networks, we can have either the <code>default bridge</code> network or the <code>user-defined bridge</code> network.</p>
<p>When you <strong>start Docker</strong>, <strong>a <code>default bridge</code> network (also called bridge) is created automatically</strong>, and newly-started containers connect to it unless otherwise specified. You <strong>can also create <code>user-defined custom bridge</code> networks</strong>. User-defined bridge networks are superior to the default bridge network.</p>
<ul>
<li><p><code>User-defined bridges</code> provide <strong>automatic DNS resolution between containers</strong>.</p>
<p>  Containers on the <code>default</code> bridge network can only access each other by IP addresses, unless you use the <code>--link</code> option, which is considered legacy. On a <strong><code>user-defined bridge</code> network, containers can resolve each other by name or alias</strong>.</p>
<p>  Imagine an application with a web front-end and a database back-end. If you call your containers <code>web</code> and <code>db</code>, the <code>web</code> container can connect to the <code>db</code> container at <code>db</code>, no matter which Docker host the application stack is running on.</p>
<p>  If you run the same application stack on the <code>default</code> bridge network, you need to <strong>manually create links between the containers</strong> (using the legacy <code>--link</code> flag). These links need to be <strong>created in both directions</strong>, so you can see this gets complex with more than two containers which need to communicate. Alternatively, you can manipulate the <code>/etc/hosts</code> files within the containers, but this creates problems that are difficult to debug.</p>
</li>
<li><p><code>User-defined bridges</code> provide <strong>better isolation</strong>.</p>
<p>  All containers without a <code>--network</code> specified, are attached to the default bridge network. This can be a risk, as unrelated stacks/services/containers are then able to communicate.</p>
<p>  Using a <code>user-defined network</code> provides a scoped network <strong>in which only containers attached to that network are able to communicate</strong>.</p>
<p>  If you use a <code>user-defined bridge</code>, <strong>during a container‚Äôs lifetime, you can connect or disconnect it from user-defined networks</strong> on the fly. To remove a container from the <code>default</code> bridge network, you need to stop the container and recreate it with different network options.</p>
</li>
<li><p>Each <code>user-defined network</code> creates a <strong>configurable bridge</strong>.</p>
<p>  If your containers use the <strong><code>default</code> bridge network</strong>, you can configure it, but <strong>all the containers use the same settings</strong>, such as <code>MTU</code> and <code>iptables</code> rules. In addition, configuring the default bridge network happens outside of Docker itself, and requires a restart of Docker.</p>
<p>  <code>User-defined bridge</code> networks are created and configured using <code>docker network create</code>. If different groups of applications have <strong>different network requirements</strong>, you can <strong>configure each <code>user-defined bridge</code> separately</strong>, as you create it.</p>
</li>
<li><p>Linked containers on the <strong><code>default bridge</code> network share environment variables</strong>.</p>
<p>  Originally, the only way to share environment variables between two containers was to link them using the <code>--link</code> flag. This type of variable sharing is <strong>not possible with <code>user-defined networks</code></strong>. However, there are <strong>superior ways to share environment variables</strong>. A few ideas:</p>
<ul>
<li><p>Multiple containers can <strong>mount a file or directory containing the shared information</strong>, using a Docker <code>volume</code>.</p>
</li>
<li><p>Multiple containers can be started together using <code>docker-compose</code> and the compose file can define the shared variables.</p>
</li>
<li><p>You can use <code>swarm</code> services instead of standalone containers, and take advantage of shared secrets and configs.</p>
</li>
</ul>
</li>
</ul>
<p>In general, containers connected to the <strong>same <code>user-defined bridge</code> network effectively expose all ports to each other</strong>. For a port to be <strong>accessible to containers or non-Docker hosts</strong> on <strong>different networks</strong>, that port must be <strong>published using the <code>-p</code> or <code>--publish</code> flag</strong>.</p>
<h2 id="Creating-and-Removing-a-user-defined-bridge"><a href="#Creating-and-Removing-a-user-defined-bridge" class="headerlink" title="Creating and Removing a user-defined bridge"></a>Creating and Removing a <code>user-defined bridge</code></h2><ul>
<li><p>You can use the <code>docker network create &lt;networkName&gt;</code> command to <strong>create a <code>user-defined bridge</code> network.</strong></p>
<p>  For example:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create --driver bridge my-net</span><br></pre></td></tr></table></figure>

<p>  or, since <code>bridge</code> is also the default:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create my-net</span><br></pre></td></tr></table></figure>

<p>  You can also specify the subnet, the IP address range, the gateway, and other options. See the <a href="https://docs.docker.com/engine/reference/commandline/network_create/#specify-advanced-options" target="_blank" rel="noopener">Docker network create reference</a> or the output of <code>docker network create --help</code> for details.</p>
</li>
<li><p>If you don‚Äôt need a <code>user-defined brigde</code>, you can <strong>use the <code>docker network rm &lt;networkName&gt;</code> command to remove a <code>user-defined bridge</code> network</strong>. If <strong>containers are currently connected to the network, disconnect them first</strong>.</p>
<p>  For example, if you have all containers disconnected from the <code>my-net</code> bridge, and you want to remove it:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network rm my-net</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="Connecting-and-Disconnecting-from-a-user-defined-bridge"><a href="#Connecting-and-Disconnecting-from-a-user-defined-bridge" class="headerlink" title="Connecting and Disconnecting from a user-defined bridge"></a>Connecting and Disconnecting from a <code>user-defined bridge</code></h2><ul>
<li><p>You can specify the connection to a <code>user-defined network</code> via 2 ways:</p>
<ul>
<li>with the <code>--network</code> flag when you <strong>create a container</strong></li>
<li>with the <code>docker network connect &lt;networkName&gt; &lt;containerName&gt;</code> when you have a <strong>running container</strong></li>
</ul>
<ol>
<li><p>When you <strong>create a new container</strong>, you can specify one or more <code>--network</code> flags. This example connects a <code>Nginx</code> container to the <code>my-net</code> network. It also publishes port <code>80</code> in the container to port <code>8080</code> on the Docker host, so <strong>external clients can access that port</strong>. <strong>Any other container connected to the <code>my-net</code> network</strong> has access to <strong>all ports on the <code>my-nginx</code> container</strong>, and vice versa.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker create --name my-nginx \</span><br><span class="line">  --network my-net \</span><br><span class="line">  --publish 8080:80 \</span><br><span class="line">  nginx:latest</span><br></pre></td></tr></table></figure>
</li>
<li><p>To connect a running container to an existing user-defined bridge, use the docker network connect command. The following command connects an already-running my-nginx container to an already-existing my-net network:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network connect my-net my-nginx</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> If you need <code>IPv6</code> support for Docker containers, you need to <strong>enable the option on the Docker daemon and reload its configuration</strong>, <strong>before creating any <code>IPv6</code> networks</strong> or assigning containers IPv6 addresses.<br>When you create your network, you can specify the <code>--ipv6</code> flag to enable IPv6. You can‚Äôt selectively disable IPv6 support on the default bridge network.</li>
</ul>
</blockquote>
</li>
</ol>
</li>
<li><p>To <strong>disconnect a running container from a <code>user-defined bridge</code></strong>, use the <code>docker network disconnect</code> command. The following command disconnects the <code>my-nginx</code> container from the <code>my-net</code> network.</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network disconnect my-net my-nginx</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="Enabling-Forwarding-from-Containers-to-Outside-World"><a href="#Enabling-Forwarding-from-Containers-to-Outside-World" class="headerlink" title="Enabling Forwarding from Containers to Outside World"></a>Enabling Forwarding from Containers to Outside World</h2><p>By default, traffic from containers connected to the <code>default</code> bridge network is <strong>not forwarded to the outside world</strong>. To <strong>enable forwarding</strong>, you need to change two settings. These are not Docker commands and they affect the Docker host‚Äôs kernel.</p>
<ol>
<li>Configure the Linux kernel to allow IP forwarding.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sysctl net.ipv4.conf.all.forwarding&#x3D;1</span><br></pre></td></tr></table></figure></li>
<li>Then change the policy for the iptables FORWARD policy from <code>DROP</code> to <code>ACCEPT</code>.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo iptables -P FORWARD ACCEPT</span><br></pre></td></tr></table></figure>
These settings <strong>do not persist across a reboot</strong>, so you may need to add them to a start-up script.</li>
</ol>
<h2 id="Viewing-and-Configuring-your-user-defined-bridge"><a href="#Viewing-and-Configuring-your-user-defined-bridge" class="headerlink" title="Viewing and Configuring your user-defined bridge"></a>Viewing and Configuring your <code>user-defined bridge</code></h2><ol>
<li><p>First, after you have created your <code>user-defined bridge</code>, you can use <code>docker network ls</code> to view the networks that docker has:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ docker network ls</span><br><span class="line"></span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">9210b6312956        test-net            bridge              local</span><br><span class="line">17e324f45964        bridge              bridge              local</span><br><span class="line">6ed54d316334        host                host                local</span><br><span class="line">7092879f2cc8        none                null                local</span><br></pre></td></tr></table></figure></li>
<li><p>Then you can use <code>docker inspect &lt;network-id&gt;</code> to see details about your <code>bridge</code>:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">$ docker inspect test-net</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;test-net&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;9210b6312956eb510fc1ad59f3ebc1ac14270fc27d44f3b98d0c71bcb5409d83&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2020-06-01T09:37:22.875610678+08:00&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;172.18.0.0&#x2F;16&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;172.18.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p> here you see that:</p>
<ul>
<li>there are <strong>no containers</strong> attached to it: <code>&quot;Containers&quot;: {}</code></li>
<li>your <strong>Gateway</strong> is: <code>&quot;Gateway&quot;: &quot;172.18.0.1&quot;</code></li>
</ul>
</li>
<li><p>Now, to test your <code>user-defined bridge</code>, you can create 4 containers: the first two will be connected to the bridge you created, the third will only be connected to be default bridge, and the fourth connected to both:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -dit --name alpine1 --network test-net alpine ash</span><br><span class="line"></span><br><span class="line">$ docker run -dit --name alpine2 --network test-net alpine ash</span><br><span class="line"></span><br><span class="line">$ docker run -dit --name alpine3 alpine ash</span><br><span class="line"></span><br><span class="line">$ docker run -dit --name alpine4 --network test-net alpine ash</span><br><span class="line"></span><br><span class="line">$ docker network connect bridge alpine4</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Since you can only specify <strong>one network when you use the <code>--network</code> flag for <code>docker run</code></strong>, if you need to <strong>connect to more than one network</strong>, you need to <strong>use <code>docker network connect</code> command with a running container</strong>.  </li>
</ul>
</blockquote>
</li>
<li><p>Now, if all the 4 containers are running properly, you can then <strong>inspect the <code>bridge</code> and the <code>test-net</code></strong> to see that the containers are included properly in the <code>&quot;containers&quot;</code> section. You should <strong>also be able to see the IP address</strong> that each one has been assigned.</p>
</li>
<li><p>Now, you can test their communication ability by connecting each one of them to the terminal (so that you  can do the <code>stdin</code> and see the <code>stdout</code> in your terminal) with the <code>docker container attach &lt;container-id&gt;</code> command. </p>
<p> On <code>user-defined network</code>s like <code>test-net</code>, containers can <strong>not only communicate by IP address</strong>, but can also <strong>resolve a container name to an IP address</strong>. This capability is called <strong>automatic service discovery</strong>. However, you will see that containers not connected to the same <code>bridge</code> cannot communicate with each other (both <code>alpine1</code> and <code>alpine2</code> cannot communicate with <code>alpine3</code>).</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">$ docker container attach alpine1</span><br><span class="line"></span><br><span class="line"># ping -c 2 alpine2</span><br><span class="line"></span><br><span class="line">PING alpine2 (172.18.0.3): 56 data bytes</span><br><span class="line">64 bytes from 172.18.0.3: seq&#x3D;0 ttl&#x3D;64 time&#x3D;0.085 ms</span><br><span class="line">64 bytes from 172.18.0.3: seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.090 ms</span><br><span class="line"></span><br><span class="line">--- alpine2 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 packets received, 0% packet loss</span><br><span class="line">round-trip min&#x2F;avg&#x2F;max &#x3D; 0.085&#x2F;0.087&#x2F;0.090 ms</span><br><span class="line"></span><br><span class="line"># ping -c 2 alpine4</span><br><span class="line"></span><br><span class="line">PING alpine4 (172.18.0.4): 56 data bytes</span><br><span class="line">64 bytes from 172.18.0.4: seq&#x3D;0 ttl&#x3D;64 time&#x3D;0.076 ms</span><br><span class="line">64 bytes from 172.18.0.4: seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.091 ms</span><br><span class="line"></span><br><span class="line">--- alpine4 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 packets received, 0% packet loss</span><br><span class="line">round-trip min&#x2F;avg&#x2F;max &#x3D; 0.076&#x2F;0.083&#x2F;0.091 ms</span><br><span class="line"></span><br><span class="line"># ping -c 2 alpine1</span><br><span class="line"></span><br><span class="line">PING alpine1 (172.18.0.2): 56 data bytes</span><br><span class="line">64 bytes from 172.18.0.2: seq&#x3D;0 ttl&#x3D;64 time&#x3D;0.026 ms</span><br><span class="line">64 bytes from 172.18.0.2: seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.054 ms</span><br><span class="line"></span><br><span class="line">--- alpine1 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 packets received, 0% packet loss</span><br><span class="line">round-trip min&#x2F;avg&#x2F;max &#x3D; 0.026&#x2F;0.040&#x2F;0.054 ms</span><br><span class="line">From alpine1, you should not be able to connect to alpine3 at all, since it is not on the alpine-net network.</span><br><span class="line"></span><br><span class="line"># ping -c 2 alpine3</span><br><span class="line"></span><br><span class="line">ping: bad address &#39;alpine3&#39;</span><br><span class="line"></span><br><span class="line">Ctrl+p Ctrl+q</span><br></pre></td></tr></table></figure>
<p> To exit the attached terminal, use <code>Ctrl+p</code> then <code>Ctrl+q</code>.</p>
</li>
<li><p>Finally, remember that <code>alpine4</code> is <strong>connected to both the <code>default</code> bridge network and <code>test-net</code></strong>. It should be able to reach all of the other containers. However, you will <strong>need to address <code>alpine3</code> by its IP address, which is the behavior of a default <code>bridge</code></strong>. Attach to it and run the tests.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">$ docker container attach alpine4</span><br><span class="line"></span><br><span class="line"># ping -c 2 alpine1</span><br><span class="line"></span><br><span class="line">PING alpine1 (172.18.0.2): 56 data bytes</span><br><span class="line">64 bytes from 172.18.0.2: seq&#x3D;0 ttl&#x3D;64 time&#x3D;0.074 ms</span><br><span class="line">64 bytes from 172.18.0.2: seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.082 ms</span><br><span class="line"></span><br><span class="line">--- alpine1 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 packets received, 0% packet loss</span><br><span class="line">round-trip min&#x2F;avg&#x2F;max &#x3D; 0.074&#x2F;0.078&#x2F;0.082 ms</span><br><span class="line"></span><br><span class="line"># ping -c 2 alpine2</span><br><span class="line"></span><br><span class="line">PING alpine2 (172.18.0.3): 56 data bytes</span><br><span class="line">64 bytes from 172.18.0.3: seq&#x3D;0 ttl&#x3D;64 time&#x3D;0.075 ms</span><br><span class="line">64 bytes from 172.18.0.3: seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.080 ms</span><br><span class="line"></span><br><span class="line">--- alpine2 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 packets received, 0% packet loss</span><br><span class="line">round-trip min&#x2F;avg&#x2F;max &#x3D; 0.075&#x2F;0.077&#x2F;0.080 ms</span><br><span class="line"></span><br><span class="line"># ping -c 2 alpine3</span><br><span class="line">ping: bad address &#39;alpine3&#39;</span><br><span class="line"></span><br><span class="line"># ping -c 2 172.17.0.2</span><br><span class="line"></span><br><span class="line">PING 172.17.0.2 (172.17.0.2): 56 data bytes</span><br><span class="line">64 bytes from 172.17.0.2: seq&#x3D;0 ttl&#x3D;64 time&#x3D;0.089 ms</span><br><span class="line">64 bytes from 172.17.0.2: seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.075 ms</span><br><span class="line"></span><br><span class="line">--- 172.17.0.2 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 packets received, 0% packet loss</span><br><span class="line">round-trip min&#x2F;avg&#x2F;max &#x3D; 0.075&#x2F;0.082&#x2F;0.089 ms</span><br><span class="line"></span><br><span class="line"># ping -c 2 alpine4</span><br><span class="line"></span><br><span class="line">PING alpine4 (172.18.0.4): 56 data bytes</span><br><span class="line">64 bytes from 172.18.0.4: seq&#x3D;0 ttl&#x3D;64 time&#x3D;0.033 ms</span><br><span class="line">64 bytes from 172.18.0.4: seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.064 ms</span><br><span class="line"></span><br><span class="line">--- alpine4 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 packets received, 0% packet loss</span><br><span class="line">round-trip min&#x2F;avg&#x2F;max &#x3D; 0.033&#x2F;0.048&#x2F;0.064 ms</span><br></pre></td></tr></table></figure>
</li>
<li><p>Now, you have finished your testsings, and you can <strong>stop and remove/disconnect all containers and the <code>test-net</code> network</strong>.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker container stop alpine1 alpine2 alpine3 alpine4</span><br><span class="line"></span><br><span class="line">$ docker container rm alpine1 alpine2 alpine3 alpine4</span><br><span class="line"></span><br><span class="line">$ docker network rm test-net</span><br></pre></td></tr></table></figure>

<p> or if you still need those containers:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ docker container stop alpine1 alpine2 alpine3 alpine4</span><br><span class="line"></span><br><span class="line">$ docker network disconnect test-net alpine1</span><br><span class="line"></span><br><span class="line">$ docker network disconnect test-net alpine2</span><br><span class="line"></span><br><span class="line">$ docker network disconnect test-net alpine4</span><br><span class="line"></span><br><span class="line">$ docker network rm test-net</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p><a name="Using-host-networks"></a></p>
<h2 id="Using-host-networks"><a href="#Using-host-networks" class="headerlink" title="Using host networks"></a>Using <code>host</code> networks</h2><p><a name="Using-overlay-networks"></a></p>
<h2 id="Using-overlay-networks"><a href="#Using-overlay-networks" class="headerlink" title="Using overlay networks"></a>Using <code>overlay</code> networks</h2><p>The <code>overlay</code> network driver creates a <strong>distributed network</strong> among <strong>multiple Docker daemon hosts</strong>. This network sits on top of (overlays) the host-specific networks, allowing containers connected to it (including swarm service containers) to communicate securely when encryption is enabled.</p>
<p>When you initialize a <code>swarm</code> or join a Docker host to an existing <code>swarm</code>, two new networks are created on that Docker host:</p>
<ul>
<li>an <code>overlay</code> network called <code>ingress</code>, which <strong>handles control and data traffic related to swarm services</strong>. When you create a <code>swarm</code> service and <strong>do not connect it to a <code>user-defined overlay</code></strong> network, it connects to the <code>ingress</code> network by default.<ul>
<li>You can <strong>create <code>user-defined overlay</code> networks using <code>docker network create</code></strong>, in the same way that you can create <code>user-defined bridge</code> networks. Remember that services or containers can be connected to more than one network at a time, and that services or containers can only communicate across networks they are each connected to.</li>
</ul>
</li>
<li>a <code>bridge</code> network called <code>docker_gwbridge</code>, which <strong>connects the individual Docker daemon to the other daemons participating in the swarm</strong>.</li>
</ul>
<h2 id="Creating-an-Overlay-Network-With-Swarm"><a href="#Creating-an-Overlay-Network-With-Swarm" class="headerlink" title="Creating an Overlay Network With Swarm"></a>Creating an Overlay Network With Swarm</h2><ol>
<li><p>First, there are two prerequisites you need to fulfill:</p>
<ul>
<li><p><strong>Firewall rules for Docker daemons</strong> using overlay networks<br>  You need the following ports open to traffic to and from each Docker host participating on an overlay network:</p>
<ul>
<li>TCP port 2377 for cluster management communications</li>
<li>TCP and UDP port 7946 for communication among nodes</li>
<li>UDP port 4789 for overlay network traffic</li>
</ul>
</li>
<li><p><strong>Before you can create an <code>overlay</code> network</strong>, you need to either** initialize your Docker daemon as a swarm manager using <code>docker swarm init</code> or join it to an existing swarm using <code>docker swarm join</code><strong>. Either of these creates the default <code>ingress</code> overlay network which is used by swarm services by default. You need to do this even if you never plan to use swarm services. **Afterward, you can create additional <code>user-defined overlay</code> networks</strong>.</p>
</li>
</ul>
</li>
<li><p>To create an <code>overlay</code> network <strong>for use with <code>swarm</code> services</strong>, use a command like the following:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create -d overlay my-overlay</span><br></pre></td></tr></table></figure>
<p> To create an overlay network which can be <strong>used by swarm services</strong> or <strong>standalone containers</strong> to communicate with other standalone containers running on other Docker daemons, add the ‚Äìattachable flag:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create -d overlay --attachable my-attachable-overlay</span><br></pre></td></tr></table></figure>
</li>
<li><p>Encryption:</p>
<p> All swarm <strong>service management traffic</strong> is <strong>encrypted by default</strong>, using the AES algorithm in GCM mode. <strong>Manager nodes in the swarm rotate the key</strong> used to encrypt gossip data <strong>every 12 hours</strong>.</p>
<p> To <strong>encrypt application data</strong> as well, <strong>add <code>--opt</code> encrypted when creating the <code>overlay</code> network</strong>. This enables IPSEC encryption at the level of the vxlan. This encryption imposes a <strong>non-negligible performance penalty</strong>, so you should test this option before using it in production.</p>
<p> So, for example, to encrypt your application data as well:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create --opt encrypted --driver overlay --attachable my-attachable-multi-host-network</span><br></pre></td></tr></table></figure>
</li>
<li><p>Now, you can customized your default <code>ingress</code> network or your <code>docker_gwbridge</code>, and your <code>user-defined overlay</code>.</p>
</li>
<li><p>Now, you have 4 options on how to use this <code>overlay</code> system:</p>
<ul>
<li><p>Use the <strong>default <code>overlay</code> network</strong>, which demonstrates how to use the default overlay network that Docker sets up for you automatically when you initialize or join a swarm. This network is not the best choice for production systems.</p>
</li>
<li><p>Use <strong><code>user-defined overlay</code> networks</strong> which shows how to create and use your own custom overlay networks, to <strong>connect services</strong>. This is recommended for services running in production.</p>
</li>
<li><p>Use an <strong><code>overlay</code> network for standalone containers shows how to communicate between standalone containers on different Docker daemons</strong> using an overlay network.</p>
</li>
<li><p>Communicate between <strong>a container and a swarm service</strong>, which sets up communication between a standalone container and a swarm service, using an <code>attachable</code> overlay network. This is supported in Docker 17.06 and higher.</p>
</li>
</ul>
</li>
</ol>
<h2 id="Use-the-default-overlay-network"><a href="#Use-the-default-overlay-network" class="headerlink" title="Use the default overlay network"></a>Use the <code>default overlay</code> network</h2><p>In this example, you start an <code>alpin</code>e service and examine the characteristics of the network from the point of view of the individual service containers.</p>
<ol>
<li><p>Prerequisites:</p>
<p> This requires <strong>three physical or virtual Docker hosts which can all communicate with one another</strong>, all running new installations of Docker 17.03 or higher. This tutorial <strong>assumes that the three hosts are running on the same network</strong> with no firewall involved.</p>
<p> These hosts will be referred to as <code>manager</code>, <code>worker-1</code>, and <code>worker-2</code>. The manager host will function as both a <code>manager</code> and a <code>worker</code>, which means it can <strong>both run service tasks</strong> and <strong>manage the swarm</strong>. <code>worker-1</code> and <code>worker-2</code> will function as workers only,</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> To open those ports specified above, you can use the following command (on both worker and manager): <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --add-port&#x3D;22&#x2F;tcp --permanent</span><br><span class="line">firewall-cmd --add-port&#x3D;2376&#x2F;tcp --permanent</span><br><span class="line">firewall-cmd --add-port&#x3D;2377&#x2F;tcp --permanent</span><br><span class="line">firewall-cmd --add-port&#x3D;7946&#x2F;tcp --permanent</span><br><span class="line">firewall-cmd --add-port&#x3D;7946&#x2F;udp --permanent</span><br><span class="line">firewall-cmd --add-port&#x3D;4789&#x2F;udp --permanent </span><br></pre></td></tr></table></figure>
Afterwards, reload the firewall:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>
Then restart Docker.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>
For other means of doing the same thing, please visit <a href="https://www.digitalocean.com/community/tutorials/how-to-configure-the-linux-firewall-for-docker-swarm-on-ubuntu-16-04#method-2-%E2%80%94-opening-docker-swarm-ports-using-firewalld" target="_blank" rel="noopener">this link</a></li>
</ul>
</blockquote>
</li>
<li><p><strong>On <code>manager</code>, initialize the swarm</strong>. If the host only has one network interface, the <code>--advertise-addr</code> flag is optional.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker swarm init --advertise-addr&#x3D;&lt;IP-ADDRESS-OF-MANAGER&gt;</span><br></pre></td></tr></table></figure>

<p> Make a note of the text that is printed, as this contains the token that you will use to join <code>worker-1</code> and <code>worker-2</code> to the swarm. It is a good idea to store the token in a password manager.</p>
</li>
<li><p><strong>On <code>worker-1</code>, join the swarm</strong>. If the host only has one network interface, the <code>--advertise-addr</code> flag is optional.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker swarm join --token &lt;TOKEN&gt; \</span><br><span class="line">  --advertise-addr &lt;IP-ADDRESS-OF-WORKER-1&gt; \</span><br><span class="line">  &lt;IP-ADDRESS-OF-MANAGER&gt;:2377</span><br></pre></td></tr></table></figure>
</li>
<li><p>On <code>worker-2</code>, join the swarm. If the host only has one network interface, the <code>--advertise-addr</code> flag is optional.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker swarm join --token &lt;TOKEN&gt; \</span><br><span class="line">  --advertise-addr &lt;IP-ADDRESS-OF-WORKER-2&gt; \</span><br><span class="line">  &lt;IP-ADDRESS-OF-MANAGER&gt;:2377</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>On <code>manager</code>, list all the nodes</strong>. This command <strong>can only be done from a manager</strong>.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ docker node ls</span><br><span class="line"></span><br><span class="line">ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS</span><br><span class="line">d68ace5iraw6whp7llvgjpu48 *   ip-172-31-34-146    Ready               Active              Leader</span><br><span class="line">nvp5rwavvb8lhdggo8fcf7plg     ip-172-31-35-151    Ready               Active</span><br><span class="line">ouvx2l7qfcxisoyms8mtkgahw     ip-172-31-36-89     Ready               Active</span><br></pre></td></tr></table></figure>
</li>
<li><p>You can also use the <code>--filter</code> flag to filter by role:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ docker node ls --filter role&#x3D;manager</span><br><span class="line"></span><br><span class="line">ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS</span><br><span class="line">d68ace5iraw6whp7llvgjpu48 *   ip-172-31-34-146    Ready               Active              Leader</span><br><span class="line"></span><br><span class="line">$ docker node ls --filter role&#x3D;worker</span><br><span class="line"></span><br><span class="line">ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS</span><br><span class="line">nvp5rwavvb8lhdggo8fcf7plg     ip-172-31-35-151    Ready               Active</span><br><span class="line">ouvx2l7qfcxisoyms8mtkgahw     ip-172-31-36-89     Ready               Active</span><br></pre></td></tr></table></figure>
</li>
<li><p>List the Docker networks on <code>manager</code>, <code>worker-1</code>, and <code>worker-2</code> and notice that <strong>each of them now has an overlay network called <code>ingress</code></strong> and a <code>bridge</code> network called <code>docker_gwbridge</code>. Only the listing for manager is shown here:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ docker network ls</span><br><span class="line"></span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">495c570066be        bridge              bridge              local</span><br><span class="line">961c6cae9945        docker_gwbridge     bridge              local</span><br><span class="line">ff35ceda3643        host                host                local</span><br><span class="line">trtnl4tqnc3n        ingress             overlay             swarm</span><br><span class="line">c8357deec9cb        none                null                local</span><br></pre></td></tr></table></figure>
</li>
<li><p>The <code>docker_gwbridge</code> connects the <code>ingress</code> network to the Docker host‚Äôs network interface so that traffic can flow to and from swarm managers and workers. If you create <code>swarm</code> services and <strong>do not specify a network, they are connected to the <code>ingress</code> network</strong>. It is recommended that you use separate overlay networks for each application or group of applications which will work together. In the next procedure, you will create two overlay networks and connect a service to each of them.</p>
</li>
<li><p>CREATE THE <strong>SERVICES</strong></p>
<p> <strong>On <code>manager</code></strong>, create a new <code>overlay</code> network called <code>nginx-net</code>:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create -d overlay nginx-net</span><br></pre></td></tr></table></figure>

<p> You <strong>don‚Äôt need to create the <code>overlay</code> network on the other nodes</strong>, beacause it will be automatically created when one of those <strong>nodes starts running a service task which requires it</strong>.</p>
<p> On <code>manager</code>, create a 5-replica Nginx <strong>service connected to <code>nginx-net</code></strong>. The service will publish port 80 to the outside world. All of the service task containers can communicate with each other without opening any ports.</p>
<p> Note: Services can only be created on a manager.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ docker service create \</span><br><span class="line">  --name my-nginx \</span><br><span class="line">  --publish target&#x3D;80,published&#x3D;80 \</span><br><span class="line">  --replicas&#x3D;5 \</span><br><span class="line">  --network nginx-net \</span><br><span class="line">  nginx</span><br></pre></td></tr></table></figure>

<p> The default publish mode of <code>ingress</code>, which is used when you <strong>do not specify a mode</strong> for the <code>--publish</code> flag, means that if you browse to port 80 on <code>manager</code>, <code>worker-1</code>, or <code>worker-2</code>, you will be connected to port 80 on one of the 5 service tasks, even if no tasks are currently running on the node you browse to. If you want to publish the port using host mode, you can add mode=host to the ‚Äìpublish output. However, you should also use <code>--mode global</code> instead of <code>--replicas=5</code> in this case, since only one service task can bind a given port on a given node.</p>
</li>
<li><p>Run <code>docker service ls</code> to <strong>monitor the progress of service bring-up</strong>, which may take a few seconds.</p>
</li>
<li><p>Inspect the <code>nginx-net</code> network on <code>manager</code>, <code>worker-1</code>, and <code>worker-2</code>. Remember that you did not need to create it manually on <code>worker-1</code> and <code>worker-2</code> because Docker created it for you. The output will be long, but notice the <code>Containers</code> and <code>Peers</code> sections. Containers lists all service tasks (or standalone containers) connected to the overlay network from that host.</p>
<p>From manager, inspect the service using <code>docker service inspect my-nginx</code> and notice the information about the ports and endpoints used by the service.</p>
</li>
<li><p>Create a new network <code>nginx-net-2</code>, then update the service to use this network instead of <code>nginx-net</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create -d overlay nginx-net-2</span><br><span class="line">$ docker service update \</span><br><span class="line">  --network-add nginx-net-2 \</span><br><span class="line">  --network-rm nginx-net \</span><br><span class="line">  my-nginx</span><br></pre></td></tr></table></figure></li>
<li><p>Run <code>docker service ls</code> to verify that the service has been updated and all tasks have been redeployed. Run <code>docker network inspect nginx-net</code> to verify that no containers are connected to it. Run the same command for <code>nginx-net-2</code> and notice that all the service task containers are connected to it.</p>
<p>Note: Even though overlay networks are automatically created on swarm worker nodes as needed, they are not automatically removed.</p>
</li>
<li><p>Clean up the service and the networks. From <code>manager</code>, run the following commands. The manager will direct the workers to remove the networks automatically.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker service rm my-nginx</span><br><span class="line">$ docker network rm nginx-net nginx-net-2</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="Using-a-user-defined-overlay"><a href="#Using-a-user-defined-overlay" class="headerlink" title="Using a user-defined overlay"></a>Using a <code>user-defined overlay</code></h2><ol>
<li><p>First you need to create the <code>user-defined overlay</code> network.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create -d overlay my-overlay</span><br></pre></td></tr></table></figure>
</li>
<li><p>Start a service using the <code>overlay</code> network and publishing port <code>80</code> to port <code>8080</code> on the Docker host.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ docker service create \</span><br><span class="line">  --name my-nginx \</span><br><span class="line">  --network my-overlay \</span><br><span class="line">  --replicas 1 \</span><br><span class="line">  --publish published&#x3D;8080,target&#x3D;80 \</span><br><span class="line">  nginx:latest</span><br></pre></td></tr></table></figure>
</li>
<li><p>Run <code>docker network inspect my-overlay</code> and verify that the <code>my-nginx</code> <strong>service task</strong> is connected to it, by looking at the <strong>Containers section</strong>.</p>
</li>
<li><p>Inspect the <code>my-overlay</code> network on <code>manager</code>, <code>worker-1</code>, and <code>worker-2</code>. Remember that you did not need to create it manually on <code>worker-1</code> and <code>worker-2</code> because Docker created it for you. The output will be long, but notice the <code>Containers</code> and <code>Peers</code> sections. Containers lists all service tasks (or standalone containers) connected to the overlay network from that host.</p>
</li>
<li><p>Remove the service and the network on the <code>manager</code> after you see it works fine.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker service rm my-nginx</span><br><span class="line"></span><br><span class="line">$ docker network rm my-overlay</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="Using-an-overlay-network-for-standalone-containers-recommended"><a href="#Using-an-overlay-network-for-standalone-containers-recommended" class="headerlink" title="Using an overlay network for standalone containers (recommended)"></a>Using an <code>overlay</code> network for standalone containers (recommended)</h2><p>This example refers to the <strong>two nodes</strong> in our swarm as <code>host1</code> and <code>host2</code>. This example also uses Linux hosts, but the same commands work on Windows.</p>
<p>This example demonstrates DNS container discovery ‚Äì specifically, how to <strong>communicate between standalone containers on different Docker daemons</strong> using an <code>overlay</code> network. In short, steps are:</p>
<ul>
<li>On <code>host1</code>, initialize the node as a swarm (<code>manager</code>).</li>
<li>On <code>host2</code>, join the node to the swarm (<code>worker</code>).</li>
<li>On <code>host1</code>, create an <strong>attachable overlay network</strong> (<code>test-net</code>).</li>
<li>On <code>host1</code>, run an <strong>interactive alpine container</strong> (<code>alpine1</code>) <strong>on <code>test-net</code></strong>.</li>
<li>On <code>host2</code>, run an <strong>interactive, and detached, alpine container</strong> (<code>alpine2</code>) on <code>test-net</code>.</li>
<li>On <code>host1</code>, <strong>from</strong> within a session of <strong><code>alpine1</code></strong>, <strong>ping <code>alpine2</code></strong>.</li>
</ul>
<ol>
<li><p>Set up the swarm.</p>
<p> a. On <code>host1</code>, <strong>initialize a swarm</strong> (and if prompted, use <code>--advertise-addr</code> to specify the IP address for the interface that communicates with other hosts in the swarm, for instance, the private IP address on AWS).<br> b. On <code>host2</code>, join the swarm as instructed above, usually in the form:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker swarm join --token &lt;your_token&gt; &lt;your_ip_address&gt;:2377</span><br><span class="line">This node joined a swarm as a worker.</span><br></pre></td></tr></table></figure>
</li>
<li><p>On <code>host1</code>, create an <strong>attachable overlay network</strong> called <code>test-net</code>:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create --driver&#x3D;overlay --attachable test-net</span><br><span class="line">uqsof8phj3ak0rq9k86zta6ht</span><br></pre></td></tr></table></figure>

<p> Notice the returned NETWORK ID ‚Äì you will see it again when you connect to it from <code>host2</code>.</p>
</li>
<li><p>On <code>host1</code>, start an <strong>interactive (<code>-it</code>) container</strong> (<code>alpine1</code>) that <strong>connects to <code>test-net</code></strong>:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --name alpine1 --network test-net alpine</span><br><span class="line">&#x2F; #</span><br></pre></td></tr></table></figure>
</li>
<li><p>On <code>host2</code>, list the available networks ‚Äì notice that <code>test-net</code> <strong>does not yet exist</strong> (because it is not currently required by any containers, though it is available. see next step):</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">ec299350b504        bridge              bridge              local</span><br><span class="line">66e77d0d0e9a        docker_gwbridge     bridge              local</span><br><span class="line">9f6ae26ccb82        host                host                local</span><br><span class="line">omvdxqrda80z        ingress             overlay             swarm</span><br><span class="line">b65c952a4b2b        none                null                local</span><br></pre></td></tr></table></figure>
</li>
<li><p>On <code>host2</code>, start a detached (<code>-d</code>) and interactive (<code>-it</code>) container (alpine2) that connects to test-net:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -dit --name alpine2 --network test-net alpine</span><br><span class="line">fb635f5ece59563e7b8b99556f816d24e6949a5f6a5b1fbd92ca244db17a4342</span><br></pre></td></tr></table></figure>

<p> where:</p>
<ul>
<li>Automatic DNS container discovery only works with unique container names.</li>
<li>Being <code>detached</code> means the container is <strong>no longer listening to the command line where <code>docker run</code> was run</strong>.  By design, containers started in detached mode <strong>exit when the root process used to run the container exits</strong>, unless you also specify the <code>--rm</code> option. If you use <code>-d</code> with <code>--rm</code>, the container is removed when it exits or when the daemon exits, whichever happens first.</li>
</ul>
</li>
<li><p>On <code>host2</code>, verify that <code>test-net</code> was created (and has the same NETWORK ID as test-net on host1):</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">...</span><br><span class="line">uqsof8phj3ak        test-net            overlay             swarm</span><br></pre></td></tr></table></figure>
</li>
<li><p>On <code>host1</code>, ping <code>alpine2</code> within the interactive terminal of alpine1:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F; # ping -c 2 alpine2</span><br><span class="line">PING alpine2 (10.0.0.5): 56 data bytes</span><br><span class="line">64 bytes from 10.0.0.5: seq&#x3D;0 ttl&#x3D;64 time&#x3D;0.600 ms</span><br><span class="line">64 bytes from 10.0.0.5: seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.555 ms</span><br><span class="line"></span><br><span class="line">--- alpine2 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 packets received, 0% packet loss</span><br><span class="line">round-trip min&#x2F;avg&#x2F;max &#x3D; 0.555&#x2F;0.577&#x2F;0.600 ms</span><br></pre></td></tr></table></figure>
</li>
<li><p>The two containers communicate with the <code>overlay</code> network connecting the two hosts. If you run another <code>alpine</code> container on <code>host2</code> that is <strong>not detached</strong>, you can ping <code>alpine1</code> from <code>host2</code> (and here we add the remove option for automatic container cleanup):</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --rm --name alpine3 --network test-net alpine</span><br><span class="line">&#x2F; # ping -c 2 alpine1</span><br><span class="line">&#x2F; # exit</span><br></pre></td></tr></table></figure>
</li>
<li><p>On host1, close the alpine1 session (which also stops the container):</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F; # exit</span><br></pre></td></tr></table></figure>
</li>
<li><p>Clean up your containers and networks:</p>
<p>You must <strong>stop and remove the containers on each host independently</strong> because Docker daemons operate independently and these are standalone containers. You only have to remove the network on <code>host1</code> because when you stop <code>alpine2</code> on <code>host2</code>, <code>test-net</code> disappears (as it is no longer required).</p>
<p>a. On <code>host2</code>, stop <code>alpine2</code>, check that <code>test-net</code> was removed, then remove <code>alpine2</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker container stop alpine2</span><br><span class="line">$ docker network ls</span><br><span class="line">$ docker container rm alpine2</span><br></pre></td></tr></table></figure>

<p>b. On <code>host1</code>, remove <code>alpine1</code> and <code>test-net</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker container rm alpine1</span><br><span class="line">$ docker network rm test-net</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="Customizing-your-ingress-network"><a href="#Customizing-your-ingress-network" class="headerlink" title="Customizing your ingress network"></a>Customizing your <code>ingress</code> network</h2><p>Most users never need to configure the <code>ingress</code> network, but Docker 17.05 and higher allow you to do so. This can be useful <strong>if the automatically-chosen subnet conflicts with one that already exists on your network</strong>, or you need to customize other low-level network settings such as the MTU.</p>
<p>Customizing the ingress network <strong>involves removing and recreating it</strong>. This is usually done <strong>before you create any services in the swarm</strong>. If you have existing services which publish ports, <strong>those services need to be removed</strong> before you can remove the ingress network.</p>
<p>During the time that no <code>ingress</code> network exists, existing services which do not publish ports continue to function but are not load-balanced. This affects services which publish ports, such as a WordPress service which publishes port 80.</p>
<p>Inspect the <code>ingress</code> network using <code>docker network inspect ingress</code>, and remove any services whose containers are connected to it. These are services that publish ports, such as a WordPress service which publishes port 80. If all such services are not stopped, the next step fails.</p>
<ol>
<li><p>Remove the existing ingress network:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ docker network rm ingress</span><br><span class="line"></span><br><span class="line">WARNING! Before removing the routing-mesh network, make sure all the nodes</span><br><span class="line">in your swarm run the same docker engine version. Otherwise, removal may not</span><br><span class="line">be effective and functionality of newly created ingress networks will be</span><br><span class="line">impaired.</span><br><span class="line">Are you sure you want to continue? [y&#x2F;N]</span><br></pre></td></tr></table></figure>
</li>
<li><p>Create a new overlay network using the <code>--ingress</code> flag, along with the custom options you want to set. This example sets the <code>MTU</code> to <code>1200</code>, sets the <code>subnet</code> to <code>10.11.0.0/16</code>, and sets the <code>gateway</code> to <code>10.11.0.2</code>.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create \</span><br><span class="line">  --driver overlay \</span><br><span class="line">  --ingress \</span><br><span class="line">  --subnet&#x3D;10.11.0.0&#x2F;16 \</span><br><span class="line">  --gateway&#x3D;10.11.0.2 \</span><br><span class="line">  --opt com.docker.network.driver.mtu&#x3D;1200 \</span><br><span class="line">  my-ingress</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note: </p>
<ul>
<li><input disabled type="checkbox"> You can name your <code>ingress</code> network with a name of something other than <code>ingress</code>, but you can only have one <code>ingress</code> network. An attempt to create a second one fails.</li>
</ul>
</blockquote>
</li>
<li><p>Restart the services that you stopped in the first step.</p>
</li>
</ol>
<h2 id="Customizing-your-docker-gwbridge-network"><a href="#Customizing-your-docker-gwbridge-network" class="headerlink" title="Customizing your docker_gwbridge network"></a>Customizing your <code>docker_gwbridge</code> network</h2><p><code>docker_gwbridge</code> <strong>connects the overlay networks (including the <code>ingress</code> network)</strong> to an individual Docker daemon‚Äôs physical network (<strong><code>swarm</code> host</strong>). Docker creates it automatically when you initialize a <code>swarm</code> or join a Docker host to a <code>swarm</code>, but it is <strong>not a Docker device</strong>. It exists in the kernel of the Docker host. If you need to customize its settings, you must do so <strong>before joining the Docker host to the swarm</strong>, or after temporarily removing the host from the swarm.</p>
<ol>
<li><p>Stop Docker, and delete the existing docker_gwbridge interface.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ip link set docker_gwbridge down</span><br><span class="line"></span><br><span class="line">$ sudo ip link del dev docker_gwbridge</span><br></pre></td></tr></table></figure>
</li>
<li><p>Start Docker. <strong>Do not join or initialize</strong> the swarm.</p>
</li>
<li><p><strong>Create or re-create the <code>docker_gwbridge</code> bridge manually with your custom settings</strong>, using the <code>docker network create</code> command. This example uses the <code>subnet</code> <code>10.11.0.0/16</code>. For a full list of customizable options, see <a href="https://docs.docker.com/engine/reference/commandline/network_create/#bridge-driver-options" target="_blank" rel="noopener">Bridge driver options</a>.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create \</span><br><span class="line">--subnet 10.11.0.0&#x2F;16 \</span><br><span class="line">--opt com.docker.network.bridge.name&#x3D;docker_gwbridge \</span><br><span class="line">--opt com.docker.network.bridge.enable_icc&#x3D;false \</span><br><span class="line">--opt com.docker.network.bridge.enable_ip_masquerade&#x3D;true \</span><br><span class="line">docker_gwbridge</span><br></pre></td></tr></table></figure>
</li>
<li><p>Initialize or join the <code>swarm</code>. Since the bridge <strong>already exists</strong>, Docker <strong>does not create it with automatic settings</strong>.</p>
</li>
</ol>
<h2 id="Customizing-your-user-defined-overlay-network"><a href="#Customizing-your-user-defined-overlay-network" class="headerlink" title="Customizing your user-defined overlay network"></a>Customizing your <code>user-defined overlay</code> network</h2><p><a name="Using-mcvlan-networks"></a></p>
<h2 id="Using-mcvlan-networks"><a href="#Using-mcvlan-networks" class="headerlink" title="Using mcvlan networks"></a>Using <code>mcvlan</code> networks</h2><p><a name="Using-none-networks"></a></p>
<h2 id="Using-none-networks"><a href="#Using-none-networks" class="headerlink" title="Using none networks"></a>Using <code>none</code> networks</h2><p><a name="MySQL-in-Docker"></a></p>
<h2 id="Using-MySQL-Server-in-Docker"><a href="#Using-MySQL-Server-in-Docker" class="headerlink" title="Using MySQL Server in Docker"></a>Using MySQL Server in Docker</h2><ol>
<li>You need to first setup your SQL server in docker via this <a href="https://dev.mysql.com/doc/mysql-installation-excerpt/8.0/en/docker-mysql-getting-started.html" target="_blank" rel="noopener">Official Guide</a></li>
<li>Then refer to <a href="https://jasonyux.github.io/2020/05/26/MySQL-Manual" target="_blank" rel="noopener">MySQL Manual</a> for further reference on using MySQL</li>
</ol>
<h2 id="Creating-and-Mounting-a-Volume-to-MySQL-data"><a href="#Creating-and-Mounting-a-Volume-to-MySQL-data" class="headerlink" title="Creating and Mounting a Volume to MySQL data"></a>Creating and Mounting a Volume to MySQL data</h2><ol>
<li><p>First, to create a volume, you need to run:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker volume create &lt;my-vol&gt;</span><br></pre></td></tr></table></figure>

<p> This will create a volume at your local directory <code>/var/lib/docker/volumes/&lt;my-vol&gt;/_data</code></p>
</li>
<li><p>You can list the volumes you have with:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker volume ls</span><br></pre></td></tr></table></figure>

<p> At this point, if you see some other volumes that are temporary created and you don‚Äôt want them, you can use:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker volume rm &lt;my-vol&gt;</span><br></pre></td></tr></table></figure>

<p> or use the <code>prune</code> keyword which will delete volumes that are not used by any containers:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker volume prune</span><br></pre></td></tr></table></figure>
</li>
<li><p>Now, you can mount a volume to your container with either the <code>-v</code> or <code>--mount</code> option. To store mount volumes to directory where <code>mysql</code> stores its data, you need to mount to <code>/var/opt/mssql</code>. Examples below produce the same result (this example uses the image called <code>mysql:latest</code> and creates a container <code>devtest</code>). </p>
<ul>
<li><p><code>--mount</code></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d \</span><br><span class="line">  --name devtest \</span><br><span class="line">  --mount source&#x3D;myvol2,target&#x3D;&#x2F;var&#x2F;opt&#x2F;mssql \</span><br><span class="line">  mysql:latest</span><br></pre></td></tr></table></figure></li>
<li><p><code>-v</code></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d \</span><br><span class="line">  --name devtest \</span><br><span class="line">  -v myvol2:&#x2F;var&#x2F;opt&#x2F;mssql \</span><br><span class="line">  mysql:latest</span><br></pre></td></tr></table></figure>
</li>
<li><p>To mount multiple volumes, you can do:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d \</span><br><span class="line">  --name devtest \</span><br><span class="line">  -v myvol2:&#x2F;var&#x2F;opt&#x2F;mssql \</span><br><span class="line">  -v myvol3:&#x2F;var \</span><br><span class="line">  mysql:latest</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> If the name of the volume you specified does not exist, <code>docker</code> will create one with that name for you.</li>
<li><input disabled type="checkbox"> It is also allowed to mount multiple containers to the same volume.</li>
</ul>
</blockquote>
</li>
</ul>
</li>
<li><p>You can then use <code>docker inspect devtest</code> to verify that the volume was created and mounted correctly. Look for the Mounts section:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&quot;Mounts&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;myvol2&quot;,</span><br><span class="line">        &quot;Source&quot;: &quot;&#x2F;var&#x2F;lib&#x2F;docker&#x2F;volumes&#x2F;myvol2&#x2F;_data&quot;,</span><br><span class="line">        &quot;Destination&quot;: &quot;&#x2F;app&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">        &quot;RW&quot;: true,</span><br><span class="line">        &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">    &#125;</span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<p> This shows that the mount is a volume, it shows the correct source and destination, and that the mount is read-write.</p>
</li>
<li><p>If you want to remove a volume, you need to <strong>stop and remove the container, and then remove the volume</strong>. Note volume removal is a separate step.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker container stop devtest</span><br><span class="line"></span><br><span class="line">$ docker container rm devtest</span><br><span class="line"></span><br><span class="line">$ docker volume rm myvol2</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="Use-a-Volume-for-Read-Only-Purpose"><a href="#Use-a-Volume-for-Read-Only-Purpose" class="headerlink" title="Use a Volume for Read-Only Purpose"></a>Use a Volume for Read-Only Purpose</h2><p>For some development applications, the container needs to write into the bind mount so that changes are propagated back to the Docker host. At other times, the container <strong>only needs read access to the data</strong>. Remember that multiple containers can mount the same volume, and it can be mounted read-write for some of them and read-only for others, at the same time.</p>
<p>Suppose you want to access the data in the volume <code>nginx-vol</code> for the following examples.</p>
<p>The following modifies the one above but <strong>mounts the directory as a read-only volume</strong>, by adding <code>readonly</code> or <code>ro</code> to the (empty by default) list of options, after the mount point within the container. If multiple options are present, separate them by commas.</p>
<p>The <code>--mount</code> and <code>-v</code> examples have the same result.</p>
<ul>
<li><p><code>--mount</code></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d \</span><br><span class="line">  --name&#x3D;nginxtest \</span><br><span class="line">  --mount source&#x3D;nginx-vol,destination&#x3D;&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html,readonly \</span><br><span class="line">  nginx:latest</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>-v</code></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d \</span><br><span class="line">  --name&#x3D;nginxtest \</span><br><span class="line">  -v nginx-vol:&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html:ro \</span><br><span class="line">  nginx:latest</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>Now you can use <code>docker inspect nginxtest</code> to <strong>verify that the readonly mount was created correctly</strong>. Look for the Mounts section, where you see <code>&quot;RW&quot;: false</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&quot;Mounts&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;nginx-vol&quot;,</span><br><span class="line">        &quot;Source&quot;: &quot;&#x2F;var&#x2F;lib&#x2F;docker&#x2F;volumes&#x2F;nginx-vol&#x2F;_data&quot;,</span><br><span class="line">        &quot;Destination&quot;: &quot;&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">        &quot;RW&quot;: false,</span><br><span class="line">        &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">    &#125;</span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<h2 id="Overview-of-Docker-Compose"><a href="#Overview-of-Docker-Compose" class="headerlink" title="Overview of Docker Compose"></a>Overview of Docker Compose</h2><p>Compose is a tool for <strong>defining and running multi-container Docker applications</strong>. With Compose, you use a <code>YAML</code> file to configure your application‚Äôs services. Then, with a single command, you create and start all the services from your configuration.</p>
<p>Using Compose is basically a <strong>three-step process</strong>:</p>
<ol>
<li><strong>Define</strong> your app‚Äôs environment with a <strong>Dockerfile</strong> so it can be reproduced anywhere.</li>
<li><strong>Define the services</strong> that make up your app in <code>docker-compose.yml</code> so they can be run together in an isolated environment.</li>
<li><strong>Run <code>docker-compose up</code></strong> and Compose starts and runs your entire app.</li>
</ol>
<p>A <code>docker-compose.yml</code> looks like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">version: &#39;2.0&#39;</span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    build: .</span><br><span class="line">    ports:</span><br><span class="line">    - &quot;5000:5000&quot;</span><br><span class="line">    volumes:</span><br><span class="line">    - .:&#x2F;code</span><br><span class="line">    - logvolume01:&#x2F;var&#x2F;log</span><br><span class="line">    links:</span><br><span class="line">    - redis</span><br><span class="line">  redis:</span><br><span class="line">    image: redis</span><br><span class="line">volumes:</span><br><span class="line">  logvolume01: &#123;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Installing-Docker-Compose"><a href="#Installing-Docker-Compose" class="headerlink" title="Installing Docker Compose"></a>Installing Docker Compose</h2><p>Docker Compose depends on the Docker engine to work properly. After you have installed the Docker engine, please refer to <a href="https://docs.docker.com/compose/install/" target="_blank" rel="noopener">this link</a> to install Docker Compose.</p>
<h2 id="QuickStart-with-Docker-Compose"><a href="#QuickStart-with-Docker-Compose" class="headerlink" title="QuickStart with Docker Compose"></a>QuickStart with Docker Compose</h2><p>For getting a sense of how <code>docker compose</code> works, please visit the <a href="https://docs.docker.com/compose/gettingstarted/" target="_blank" rel="noopener">this Docker Documentation</a>.</p>
<p>Some important steps are shown here:</p>
<ul>
<li><p>Step 5: Edit the Compose file to <strong>add a bind mount</strong></p>
<p>  Edit docker-compose.yml in your project directory to add a bind mount for the web service:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">version: &#39;3&#39;</span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    build: .</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;5000:5000&quot;</span><br><span class="line">    volumes:</span><br><span class="line">      - .:&#x2F;code</span><br><span class="line">    environment:</span><br><span class="line">      FLASK_ENV: development</span><br><span class="line">  redis:</span><br><span class="line">    image: &quot;redis:alpine&quot;</span><br></pre></td></tr></table></figure>

<p>  The new volumes key <strong>mounts the project directory (current directory)</strong> on the host <strong>to <code>/code</code> inside the container</strong>. Now, you need to re-build the image for it to take effect. Afterwards, by mounting a volume it is allowing you to modify the code on the fly, without having to rebuild the image. The environment key sets the <code>FLASK_ENV</code> environment variable, which tells flask run to run in development mode and reload the code on change. <strong>This mode should only be used in development</strong>.</p>
</li>
<li><p>Step 6: <strong>Re-build and run</strong> the app with Compose</p>
<p>  From your project directory, type docker-compose up to build the app with the updated Compose file, and run it.</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ docker-compose up</span><br><span class="line">Creating network &quot;composetest_default&quot; with the default driver</span><br><span class="line">Creating composetest_web_1 ...</span><br><span class="line">Creating composetest_redis_1 ...</span><br><span class="line">Creating composetest_web_1</span><br><span class="line">Creating composetest_redis_1 ... done</span><br><span class="line">Attaching to composetest_web_1, composetest_redis_1</span><br><span class="line">web_1    |  * Running on http:&#x2F;&#x2F;0.0.0.0:5000&#x2F; (Press CTRL+C to quit)</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/05/25/Docker-Manual/" data-id="ckamcbohu000060orfr6dh1u8" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Apache-Manual-md" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/05/22/Apache-Manual-md/" class="article-date">
  <time datetime="2020-05-22T05:40:13.000Z" itemprop="datePublished">2020-05-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/05/22/Apache-Manual-md/">Apache Maven Manual</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<p><strong>IMPORTANT</strong>:<br>Much of the content here is a personal summary/abbrieviation of contents on the <a href="https://maven.apache.org/users/index.html" target="_blank" rel="noopener">Offical Apache Maven Guide</a>. For more complete information, please refer to the offical site.</p>
<hr>
<h2 id="Apache-Maven-Introduction"><a href="#Apache-Maven-Introduction" class="headerlink" title="Apache Maven Introduction"></a>Apache Maven Introduction</h2><ul>
<li><strong>*Q: What is Apache Maven used for? *</strong></li>
</ul>
<p>In a nutshell Maven is an attempt to <strong>apply patterns to a project‚Äôs build infrastructure in order to promote comprehension and productivity</strong> by providing a clear path in the use of best practices. Maven is essentially a <strong>project management and comprehension tool</strong> and as such provides a way to help with managing:</p>
<ul>
<li>Builds</li>
<li>Documentation</li>
<li>Reporting</li>
<li>Dependencies</li>
<li>SCMs</li>
<li>Releases</li>
<li>Distribution</li>
</ul>
<p>Maven can provide benefits for your build process by <strong>employing standard conventions and practices</strong> to accelerate your development cycle while at the same time helping you achieve a higher rate of success.</p>
<h2 id="Installing-Maven"><a href="#Installing-Maven" class="headerlink" title="Installing Maven"></a>Installing Maven</h2><p>Please follow <a href="https://maven.apache.org/guides/getting-started/maven-in-five-minutes.html" target="_blank" rel="noopener">Apache Maven Guide</a></p>
<h2 id="Creating-a-Project-QuickStart"><a href="#Creating-a-Project-QuickStart" class="headerlink" title="Creating a Project (QuickStart)"></a>Creating a Project (QuickStart)</h2><p>First you might want to create a workspace folder where all your Maven project resides. Then, you could <strong>navigate to that folder‚Äôs directory</strong> and run:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn archetype:generate -DgroupId&#x3D;com.mycompany.app -DartifactId&#x3D;my-app -DarchetypeArtifactId&#x3D;maven-archetype-quickstart -DarchetypeVersion&#x3D;1.4 -DinteractiveMode&#x3D;false</span><br></pre></td></tr></table></figure>
<p>where the <code>-DartifactId=my-app</code> would be the new <strong>folder with name <code>my-app</code></strong> under that directory you created.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> If you have just installed Maven, it may take a while on the first run.</li>
</ul>
</blockquote>
<p>After it completes the setup, you can switch to that folder <code>my-app</code> and look at what‚Äôs created by Maven:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd my-app</span><br></pre></td></tr></table></figure>

<p>Under this directory you will notice the following <a href="https://maven.apache.org/guides/introduction/introduction-to-the-standard-directory-layout.html" target="_blank" rel="noopener">standard project structure</a>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">my-app</span><br><span class="line">|-- pom.xml</span><br><span class="line">&#96;-- src</span><br><span class="line">    |-- main</span><br><span class="line">    |   &#96;-- java</span><br><span class="line">    |       &#96;-- com</span><br><span class="line">    |           &#96;-- mycompany</span><br><span class="line">    |               &#96;-- app</span><br><span class="line">    |                   &#96;-- App.java</span><br><span class="line">    &#96;-- test</span><br><span class="line">        &#96;-- java</span><br><span class="line">            &#96;-- com</span><br><span class="line">                &#96;-- mycompany</span><br><span class="line">                    &#96;-- app</span><br><span class="line">                        &#96;-- AppTest.java</span><br></pre></td></tr></table></figure>

<p>where:</p>
<ul>
<li><code>src/main/java</code> directory contains the <strong>project source code</strong></li>
<li><code>src/test/java</code> directory contains the <strong>test source code</strong></li>
<li><code>pom.xml</code> file is the project‚Äôs <strong>Project Object Model</strong>, or POM.</li>
</ul>
<p><a name="Configure-Java-9"></a></p>
<h2 id="Configuring-for-Java-9-or-Later"><a href="#Configuring-for-Java-9-or-Later" class="headerlink" title="Configuring for Java 9 or Later"></a>Configuring for Java 9 or Later</h2><p><strong>By default</strong> your version of Maven might use an old version of the <code>maven-compiler-plugin</code> that is not compatible with Java 9 or later versions. To <strong>target Java 9 or later</strong>, you should at least use version <code>3.6.0</code> of the <code>maven-compiler-plugin</code> and set the <code>maven.compiler.release</code> property to the Java release you are targetting (e.g. 9, 10, 11, 12, etc.).</p>
<p>In the following example, we have configured our Maven project to use version <code>3.8.1</code> of maven-compiler-plugin and target Java 11. You should be able to <strong>edit it in the <code>pom.xml</code> file</strong>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties&gt;</span><br><span class="line">    &lt;maven.compiler.release&gt;11&lt;&#x2F;maven.compiler.release&gt;</span><br><span class="line">&lt;&#x2F;properties&gt;</span><br><span class="line"></span><br><span class="line">&lt;build&gt;</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;maven-compiler-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;3.8.1&lt;&#x2F;version&gt;</span><br><span class="line">            &lt;configuration&gt;</span><br><span class="line">                &lt;source&gt;13&lt;&#x2F;source&gt;</span><br><span class="line">                &lt;target&gt;13&lt;&#x2F;target&gt;</span><br><span class="line">            &lt;&#x2F;configuration&gt;</span><br><span class="line">        &lt;&#x2F;plugin&gt;</span><br><span class="line">	&lt;&#x2F;plugins&gt;</span><br><span class="line">&lt;&#x2F;build&gt;</span><br></pre></td></tr></table></figure>

<p><a name="Build-the-Project"></a></p>
<h2 id="Build-the-Project"><a href="#Build-the-Project" class="headerlink" title="Build the Project"></a>Build the Project</h2><p>Maven is based around the central concept of a <strong>build lifecycle</strong>, which consists of a number of <strong>phases</strong>. (Each of these build lifecycles is defined by a different list of build phases, wherein a build phase represents a stage in the lifecycle.)</p>
<p>For example, the <strong>default lifecycle comprises of the following phases</strong> (for a complete list of the lifecycle phases, refer to the Lifecycle Reference):</p>
<ul>
<li><code>validate</code> - validate the project is correct and all necessary information is available</li>
<li><code>compile</code> - compile the source code of the project</li>
<li><code>test</code> - test the compiled source code using a suitable unit testing framework. These tests should not require the code be packaged or deployed</li>
<li><code>package</code> - take the compiled code and package it in its distributable format, such as a <code>JAR</code>.</li>
<li><code>integration-test</code>: process and deploy the package if necessary into an environment where integration tests can be run</li>
<li><code>verify</code> - run any checks on results of integration tests to ensure quality criteria are met</li>
<li><code>install</code> - install the package into the local repository, for use as a dependency in other projects locally</li>
<li><code>deploy</code> - done in the build environment, copies the final package to the remote repository for sharing with other developers and projects.</li>
</ul>
<p>At this point, since you haven‚Äôt added anthing in the folder, you could directly do</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn package</span><br></pre></td></tr></table></figure>
<p>which, for Maven, when a phase is given, it will <strong>execute every phase in the sequence up to and including the one defined</strong>. For example, if we execute the <code>compile</code> phase, the phases that actually get executed are:</p>
<ul>
<li><code>validate</code><ul>
<li>generate-sources</li>
<li>process-sources</li>
<li>generate-resources</li>
<li>process-resources</li>
</ul>
</li>
<li><code>compile</code></li>
</ul>
<p>In the case where we executed <code>mvn package</code>, the command line will print out various actions, and <strong>end with the following</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> ...</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] BUILD SUCCESS</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Total time:  2.953 s</span><br><span class="line">[INFO] Finished at: 2019-11-24T13:05:10+01:00</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Unlike the first command executed (<code>archetype:generate</code>) you may notice the second is simply a single word - <code>package</code>. The difference is that the <strong>first one is a goal</strong> (i.e. the prefix <code>archetype</code> is the <strong>plugin</strong> that provides the goal <code>archetype:generate</code>. Maven is - at its heart - a plugin execution framework; all work is done by plugins), where as the <strong>second one is a phase</strong>.</li>
<li><input disabled type="checkbox"> After you run the <code>mvn package</code>, you will see that it created a <strong>new folder <code>target</code></strong>, in which there will be a <strong>packaged <code>JAR</code> file that is the snap-shot of the project</strong> (in this case, MAVEN starts with a <code>Hello World</code> java file)</li>
</ul>
</blockquote>
<p>Now, since you see that in the standard lifecycle, <code>package</code> already included <code>compile</code> phase, it means we could test the newly compiled and packaged <code>JAR</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp target&#x2F;my-app-1.0-SNAPSHOT.jar com.mycompany.app.App</span><br></pre></td></tr></table></figure>

<p>where</p>
<ul>
<li><code>-cp</code>, or <strong>CLASSPATH</strong> (where the JVM will look for the <strong>.class</strong> file. In this case, the file is packaged in the <strong>my-app-1.0-SNAPSHOT.jar</strong>), is used as an option to the Java command that specifies the <strong>location of classes and packages which are defined by the user</strong>, for example, a list of directories, <strong>JAR archives and ZIP archives</strong> to search for class files.</li>
<li><code>com.mycompany.app.App</code> is the java file that is created by MAVEN and packaged into <code>target/my-app-1.0-SNAPSHOT.jar</code></li>
</ul>
<h2 id="Running-Maven-Tools"><a href="#Running-Maven-Tools" class="headerlink" title="Running Maven Tools"></a>Running Maven Tools</h2><p>Although hardly a comprehensive list, these are the <strong>most common default lifecycle phases</strong> executed, also shown in the section <a href="#Build-the-Project">Build the Project</a></p>
<ul>
<li><code>validate</code></li>
<li><code>compile</code></li>
<li><code>test</code></li>
<li><code>package</code></li>
<li><code>integration-test</code></li>
<li><code>verify</code></li>
<li><code>install</code></li>
<li><code>deploy</code></li>
</ul>
<p>There are <strong>two other Maven lifecycles of note beyond the default list</strong> above. They are:</p>
<ul>
<li><code>clean</code>: cleans up artifacts created by prior builds</li>
<li><code>site</code>: generates site documentation for this project</li>
</ul>
<p><strong>Phases are actually mapped to underlying goals</strong> (A build <strong>phase is made up of a set of goals</strong>. Maven <strong>goals represent a specific task that contributes to the building and managing of a project</strong>). The specific goals executed per phase is dependent upon the packaging type of the project. For example, package executes <code>jar:jar</code> if the project type is a JAR, and <code>war:war</code> if the project type is - you guessed it - a WAR.</p>
<p>An interesting thing to note is that <strong>phases and goals may be executed in sequence</strong>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean dependency:copy-dependencies package</span><br></pre></td></tr></table></figure>

<p>This command will clean the project, copy dependencies, and package the project (<strong>executing all phases up to <code>package</code>, of course</strong>).</p>
<h2 id="Generating-a-Site"><a href="#Generating-a-Site" class="headerlink" title="Generating a Site"></a>Generating a Site</h2><p>This site will contain information about your project, organized by MAVEN:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn site</span><br></pre></td></tr></table></figure>
<p>This phase <strong>generates a site based upon information on the project‚Äôs <code>pom</code></strong>. You can look at the documentation generated under <code>target/site</code>.</p>
<h2 id="Creating-a-Project"><a href="#Creating-a-Project" class="headerlink" title="Creating a Project"></a>Creating a Project</h2><p>Different from the <code>quickstart</code> you could use, you could also create a standard project by:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mvn -B archetype:generate \</span><br><span class="line">  -DarchetypeGroupId&#x3D;org.apache.maven.archetypes \</span><br><span class="line">  -DgroupId&#x3D;com.mycompany.app \</span><br><span class="line">  -DartifactId&#x3D;&lt;yourProjectName&gt;</span><br></pre></td></tr></table></figure>
<p>Then, in the directory you created, you could look at the <code>POM</code> file:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">  xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">  xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0</span><br><span class="line">                      http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">  &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;my-app&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;packaging&gt;jar&lt;&#x2F;packaging&gt;</span><br><span class="line">  &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">  &lt;name&gt;Maven Quick Start Archetype&lt;&#x2F;name&gt;</span><br><span class="line">  &lt;url&gt;http:&#x2F;&#x2F;maven.apache.org&lt;&#x2F;url&gt;</span><br><span class="line">  &lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;junit&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;junit&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;version&gt;4.11&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">  &lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>
<p>The <code>POM</code> is the basic unit of work in Maven. This is important to remember because Maven is inherently <strong>project-centric</strong> in that everything revolves around the notion of a project. In short, the <strong><code>POM</code> contains every important piece of information about your project and is essentially one-stop-shopping for finding anything related to your project</strong>. </p>
<p>This is a very simple POM but still displays the key elements every POM contains, so let‚Äôs walk through each of them to familiarize you with the <strong>POM essentials</strong>:</p>
<ul>
<li><strong>project</strong> This is the top-level element in all Maven <code>pom.xml</code> files.</li>
<li><strong>modelVersion</strong> This element indicates what <strong>version of the object model this POM is using</strong>. The version of the model itself changes very infrequently but it is mandatory in order to ensure stability of use if and when the Maven developers deem it necessary to change the model.</li>
<li><strong>groupId</strong> This element indicates the unique <strong>identifier of the organization or group that created the project</strong>. The groupId is one of the key identifiers of a project and is typically based on the <strong>fully qualified domain name of your organization</strong>. For example <code>org.apache.maven.plugins</code> is the designated groupId for all Maven plugins.</li>
<li><strong>artifactId</strong> This element indicates the unique base name of the primary artifact being generated by this project. <strong>The primary artifact for a project is typically a JAR file</strong>. Secondary artifacts like source bundles also use the artifactId as part of their final name. A typical artifact produced by Maven would have the form <code>&lt;artifactId&gt;-&lt;version&gt;.&lt;extension&gt;</code> (<strong>for example, <code>my-app-1.0.jar</code></strong>).</li>
<li><strong>packaging</strong> This element indicates the <strong>package type to be used by this artifact</strong> (e.g. <code>JAR</code>, <code>WAR</code>, <code>EAR</code>, etc.). This not only means if the artifact produced is JAR, WAR, or EAR but can also <strong>indicate a specific lifecycle to use as part of the build process</strong>. (The lifecycle is a topic we will deal with further on in the guide. For now, just keep in mind that the indicated packaging of a project can play a part in customizing the build lifecycle.) The <strong>default value for the packaging element is <code>JAR</code></strong> so you do not have to specify this for most projects.</li>
<li><strong>version</strong> This element indicates the <strong>version of the artifact (your end product) generated by the project</strong>. Maven goes a long way to help you with version management and you will often see the SNAPSHOT designator in a version, which indicates that a project is in a state of development. We will discuss the use of snapshots and how they work further on in this guide.</li>
<li><strong>name</strong> This element indicates the <strong>display name used for the project (by default it will be the same name as artifactId)</strong>. This is often used in Maven‚Äôs generated documentation.</li>
<li><strong>url</strong> This element indicates where the <strong>project‚Äôs site can be found</strong>. This is often used in Maven‚Äôs generated documentation.</li>
<li><strong>description</strong> This element provides a <strong>basic description of your project</strong>. This is often used in Maven‚Äôs generated documentation.</li>
</ul>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> The value of the <code>version</code> tag in the pom.xml file shown below has the suffix: <code>-SNAPSHOT</code>. The SNAPSHOT value refers to the <strong>‚Äòlatest‚Äô code along a <code>development</code> branch</strong>, and provides <strong>no guarantee the code is stable or unchanging</strong>. Conversely, the code in a <code>&#39;release&#39;</code> version (any version value without the suffix SNAPSHOT) is unchanging. In other words, a SNAPSHOT version is the ‚Äòdevelopment‚Äô version before the final ‚Äòrelease‚Äô version. The SNAPSHOT is ‚Äúolder‚Äù than its release.</li>
</ul>
</blockquote>
<p>For more complete understanding of a <strong>POM</strong> visit <a href="https://maven.apache.org/guides/introduction/introduction-to-the-pom.html" target="_blank" rel="noopener">Apache Maven POM Guide</a></p>
<p>After the archetype generation of your first project you will also notice the <strong>same source tree structure you had above in the quickstart project created</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">my-app</span><br><span class="line">|-- pom.xml</span><br><span class="line">&#96;-- src</span><br><span class="line">    |-- main</span><br><span class="line">    |   &#96;-- java</span><br><span class="line">    |       &#96;-- com</span><br><span class="line">    |           &#96;-- mycompany</span><br><span class="line">    |               &#96;-- app</span><br><span class="line">    |                   &#96;-- App.java</span><br><span class="line">    &#96;-- test</span><br><span class="line">        &#96;-- java</span><br><span class="line">            &#96;-- com</span><br><span class="line">                &#96;-- mycompany</span><br><span class="line">                    &#96;-- app</span><br><span class="line">                        &#96;-- AppTest.java</span><br></pre></td></tr></table></figure>

<h2 id="Compiling-Project-Source-Code"><a href="#Compiling-Project-Source-Code" class="headerlink" title="Compiling Project Source Code"></a>Compiling Project Source Code</h2><p>Change to the directory where <code>pom.xml</code> is created by <code>archetype:generate</code> (this will be the default directory we are using for MAVEN commands) and execute the following command to compile your application sources:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn compile</span><br></pre></td></tr></table></figure>

<p>Upon executing this command you should see output like the following:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[INFO] ----------------------------------------------------------------------------</span><br><span class="line">[INFO] Building Maven Quick Start Archetype</span><br><span class="line">[INFO]    task-segment: [compile]</span><br><span class="line">[INFO] ----------------------------------------------------------------------------</span><br><span class="line">[INFO] artifact org.apache.maven.plugins:maven-resources-plugin: \</span><br><span class="line">  checking for updates from central</span><br><span class="line">...</span><br><span class="line">[INFO] artifact org.apache.maven.plugins:maven-compiler-plugin: \</span><br><span class="line">  checking for updates from central</span><br><span class="line">...</span><br><span class="line">[INFO] [resources:resources]</span><br><span class="line">...</span><br><span class="line">[INFO] [compiler:compile]</span><br><span class="line">Compiling 1 source file to &lt;dir&gt;&#x2F;my-app&#x2F;target&#x2F;classes</span><br><span class="line">[INFO] ----------------------------------------------------------------------------</span><br><span class="line">[INFO] BUILD SUCCESSFUL</span><br><span class="line">[INFO] ----------------------------------------------------------------------------</span><br><span class="line">[INFO] Total time: 3 minutes 54 seconds</span><br><span class="line">[INFO] Finished at: Fri Sep 23 15:48:34 GMT-05:00 2005</span><br><span class="line">[INFO] Final Memory: 2M&#x2F;6M</span><br><span class="line">[INFO] ----------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>The <strong>first time you execute</strong> this (or any other) command, Maven will need to download all the plugins and related dependencies it needs to fulfill the command. This can take quite a while. If you execute the command again, Maven will now have what it needs, so it won‚Äôt need to download anything new and will be able to execute the command much more quickly.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> If you ran into error running this command, it might be cause because the code is not for the default compiler used by MAVEN. You can specify it similarly in the section [Configuing for Java 9 or Later](#<br>re-Java-9), by adding those before the root element ends:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt; </span><br><span class="line">... </span><br><span class="line">&lt;&#x2F;dependencies&gt; </span><br><span class="line">&lt;build&gt; </span><br><span class="line">&lt;plugins&gt; </span><br><span class="line">	&lt;plugin&gt;</span><br><span class="line">		&lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt; </span><br><span class="line">		&lt;artifactId&gt;maven-compiler-plugin&lt;&#x2F;artifactId&gt; </span><br><span class="line">		&lt;version&gt;3.8.1&lt;&#x2F;version&gt; </span><br><span class="line">		&lt;configuration&gt; </span><br><span class="line">			&lt;source&gt;13&lt;&#x2F;source&gt; </span><br><span class="line">			&lt;target&gt;13&lt;&#x2F;target&gt; </span><br><span class="line">		&lt;&#x2F;configuration&gt; </span><br><span class="line">	&lt;&#x2F;plugin&gt; </span><br><span class="line">&lt;&#x2F;plugins&gt; </span><br><span class="line">&lt;&#x2F;build&gt; </span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<p>As you can see from the output, the <strong>compiled classes were placed in <code>${basedir}/target/classes</code></strong>, which is another standard convention employed by Maven. </p>
<h2 id="Testing-Project-Source-Code"><a href="#Testing-Project-Source-Code" class="headerlink" title="Testing Project Source Code"></a>Testing Project Source Code</h2><p>Now you‚Äôre successfully compiling your application‚Äôs sources and now you‚Äôve got some unit tests that you want to <strong>compile and execute</strong> (because every programmer always writes and executes their unit tests <em>nudge nudge wink wink</em>).</p>
<p>Execute the following command:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn test</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Maven downloads more dependencies this time. These are the dependencies and plugins <strong>necessary for executing the tests</strong> (it already has the dependencies it needs for compiling and won‚Äôt download them again).</li>
<li><input disabled type="checkbox"> <strong>Before compiling and executing the tests</strong> Maven <strong>compiles the main code</strong> (in case there are some changes. In this case all these classes are up to date because we haven‚Äôt changed anything since we compiled last).</li>
</ul>
</blockquote>
<p>If you simply want to compile your test sources (but not execute the tests), you can execute the following:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn test-compile</span><br></pre></td></tr></table></figure>

<h2 id="Packaging-into-a-Jar-File"><a href="#Packaging-into-a-Jar-File" class="headerlink" title="Packaging into a Jar File"></a>Packaging into a Jar File</h2><p>Making a JAR file is straight forward enough and can be accomplished by executing the following command:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn package</span><br></pre></td></tr></table></figure>

<p>If you take a look at the <code>POM</code> for your project you will notice the packaging element is set to <code>jar</code>. This is <strong>how Maven knows to produce a <code>JAR</code> file from the above command</strong>.</p>
<p>The generated file will be in <code>${basedir}/target directory</code> and you will see the generated <code>JAR</code> file there as well.</p>
<p><a name="Installing-into-Local"></a></p>
<h2 id="Installing-into-Local-Repository"><a href="#Installing-into-Local-Repository" class="headerlink" title="Installing into Local Repository"></a>Installing into Local Repository</h2><p>If you want to install the artifact you‚Äôve generated (the JAR file) in your local repository (<code>${user.home}/.m2/repository</code>; for Windows,<code>C:\Users\&lt;Username&gt;\.m2\repository</code> is the default location). For more information on repositories you can refer to <a href="#https://maven.apache.org/guides/introduction/introduction-to-repositories.html">Apache Maven Introduction to Repositories</a> but let‚Äôs move on to installing our artifact! To do so execute the following command:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn install</span><br></pre></td></tr></table></figure>

<p>Upon executing this command you should see the following output:</p>
<p>Upon executing this command you should see the following output:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[INFO] ----------------------------------------------------------------------------</span><br><span class="line">[INFO] Building Maven Quick Start Archetype</span><br><span class="line">[INFO]    task-segment: [install]</span><br><span class="line">[INFO] ----------------------------------------------------------------------------</span><br><span class="line">[INFO] [resources:resources]</span><br><span class="line">[INFO] [compiler:compile]</span><br><span class="line">Compiling 1 source file to &lt;dir&gt;&#x2F;my-app&#x2F;target&#x2F;classes</span><br><span class="line">[INFO] [resources:testResources]</span><br><span class="line">[INFO] [compiler:testCompile]</span><br><span class="line">Compiling 1 source file to &lt;dir&gt;&#x2F;my-app&#x2F;target&#x2F;test-classes</span><br><span class="line">[INFO] [surefire:test]</span><br><span class="line">[INFO] Setting reports dir: &lt;dir&gt;&#x2F;my-app&#x2F;target&#x2F;surefire-reports</span><br><span class="line"> </span><br><span class="line">-------------------------------------------------------</span><br><span class="line"> T E S T S</span><br><span class="line">-------------------------------------------------------</span><br><span class="line">[surefire] Running com.mycompany.app.AppTest</span><br><span class="line">[surefire] Tests run: 1, Failures: 0, Errors: 0, Time elapsed: 0.001 sec</span><br><span class="line"> </span><br><span class="line">Results :</span><br><span class="line">[surefire] Tests run: 1, Failures: 0, Errors: 0</span><br><span class="line"> </span><br><span class="line">[INFO] [jar:jar]</span><br><span class="line">[INFO] Building jar: &lt;dir&gt;&#x2F;my-app&#x2F;target&#x2F;my-app-1.0-SNAPSHOT.jar</span><br><span class="line">[INFO] [install:install]</span><br><span class="line">[INFO] Installing &lt;dir&gt;&#x2F;my-app&#x2F;target&#x2F;my-app-1.0-SNAPSHOT.jar to \</span><br><span class="line">   &lt;local-repository&gt;&#x2F;com&#x2F;mycompany&#x2F;app&#x2F;my-app&#x2F;1.0-SNAPSHOT&#x2F;my-app-1.0-SNAPSHOT.jar</span><br><span class="line">[INFO] ----------------------------------------------------------------------------</span><br><span class="line">[INFO] BUILD SUCCESSFUL</span><br><span class="line">[INFO] ----------------------------------------------------------------------------</span><br><span class="line">[INFO] Total time: 5 seconds</span><br><span class="line">[INFO] Finished at: Tue Oct 04 13:20:32 GMT-05:00 2005</span><br><span class="line">[INFO] Final Memory: 3M&#x2F;8M</span><br><span class="line">[INFO] ----------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>Note that the <code>surefire</code> plugin (which executes the test) <strong>looks for tests contained in files with a particular naming convention</strong>. By default the tests included are:</p>
<ul>
<li><code>**/*Test.java</code></li>
<li><code>**/Test*.java</code></li>
<li><code>**/*TestCase.java</code></li>
</ul>
<p>And in the end you can find your files in <code>C:\Users\&lt;Username&gt;\.m2\repository\com\mycompany\app\</code> (for Windows)</p>
<h2 id="Other-Useful-Phases-in-Maven"><a href="#Other-Useful-Phases-in-Maven" class="headerlink" title="Other Useful Phases in Maven"></a>Other Useful Phases in Maven</h2><p>One of the highly prized features of Maven is: without any work on your part this POM has enough information to <strong>generate a web site for your project</strong>! You will most likely want to customize your Maven site but if you‚Äôre pressed for time all you need to do to provide basic information about your project is execute the following command:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn site</span><br></pre></td></tr></table></figure>

<p>There are plenty of other standalone goals that can be executed as well (again only with this <code>POM</code> file), for example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean</span><br></pre></td></tr></table></figure>

<p>This will <strong>remove the target directory with all the build data before starting so that it is fresh</strong>.</p>
<h2 id="Using-Plugins-in-Maven"><a href="#Using-Plugins-in-Maven" class="headerlink" title="Using Plugins in Maven"></a>Using Plugins in Maven</h2><p>Whenever you want to <strong>customise the build</strong> for a Maven project, this is <strong>done by adding or reconfiguring plugins</strong>.</p>
<p>For this example, we will <strong>configure the Java compiler</strong> to allow JDK 5.0 sources (we have in fact done this already when we configure for Java 9.0 or later). This is as simple as <strong>adding this to your <code>POM</code></strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">&lt;build&gt;</span><br><span class="line">  &lt;plugins&gt;</span><br><span class="line">    &lt;plugin&gt;</span><br><span class="line">      &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;maven-compiler-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;version&gt;3.3&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;configuration&gt;</span><br><span class="line">        &lt;source&gt;1.5&lt;&#x2F;source&gt;</span><br><span class="line">        &lt;target&gt;1.5&lt;&#x2F;target&gt;</span><br><span class="line">      &lt;&#x2F;configuration&gt;</span><br><span class="line">    &lt;&#x2F;plugin&gt;</span><br><span class="line">  &lt;&#x2F;plugins&gt;</span><br><span class="line">&lt;&#x2F;build&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>You‚Äôll notice that all plugins in Maven look much like a dependency - and in some ways they are. This <strong>plugin will be automatically downloaded and used - including a specific version if you request it</strong> (the default is to use the latest available).</p>
<p>To find out <strong>what configuration is available</strong> for a plugin, you can see the <a href="https://maven.apache.org/plugins/" target="_blank" rel="noopener">Apache Maven Plugins List</a> and navigate to the plugin and goal you are using. For general information about how to configure the available parameters of a plugin, have a look at the <a href="https://maven.apache.org/guides/mini/guide-configuring-plugins.html" target="_blank" rel="noopener">Apache Maven Guide to Configuring Plugins</a>.</p>
<h2 id="Adding-Files-Resources-to-My-Jar"><a href="#Adding-Files-Resources-to-My-Jar" class="headerlink" title="Adding Files/Resources to My Jar"></a>Adding Files/Resources to My Jar</h2><p>Another common use case that can be satisfied which requires <strong>no changes to the POM</strong> that we have above is packaging resources in the JAR file. For this common task, Maven again relies on the <strong>Standard Directory Layout</strong>.</p>
<p>You see below in our example we have <strong>added the directory <code>${basedir}/src/main/resources</code></strong> into which we place <strong>any resources/files we wish to package in our JAR</strong>. The simple rule employed by Maven is this: <strong>any directories or files placed within the <code>${basedir}/src/main/resources</code> directory are packaged in your JAR with the exact same structure starting at the base of the JAR</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">my-app</span><br><span class="line">|-- pom.xml</span><br><span class="line">&#96;-- src</span><br><span class="line">    |-- main</span><br><span class="line">    |   |-- java</span><br><span class="line">    |   |   &#96;-- com</span><br><span class="line">    |   |       &#96;-- mycompany</span><br><span class="line">    |   |           &#96;-- app</span><br><span class="line">    |   |               &#96;-- App.java</span><br><span class="line">    |   &#96;-- resources</span><br><span class="line">    |       &#96;-- META-INF</span><br><span class="line">    |           &#96;-- application.properties</span><br><span class="line">    &#96;-- test</span><br><span class="line">        &#96;-- java</span><br><span class="line">            &#96;-- com</span><br><span class="line">                &#96;-- mycompany</span><br><span class="line">                    &#96;-- app</span><br><span class="line">                        &#96;-- AppTest.java</span><br></pre></td></tr></table></figure>
<p>Generates:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">|-- META-INF</span><br><span class="line">|   |-- MANIFEST.MF</span><br><span class="line">|   |-- application.properties</span><br><span class="line">|   &#96;-- maven</span><br><span class="line">|       &#96;-- com.mycompany.app</span><br><span class="line">|           &#96;-- my-app</span><br><span class="line">|               |-- pom.properties</span><br><span class="line">|               &#96;-- pom.xml</span><br><span class="line">&#96;-- com</span><br><span class="line">    &#96;-- mycompany</span><br><span class="line">        &#96;-- app</span><br><span class="line">            &#96;-- App.class</span><br></pre></td></tr></table></figure>
<p>But if you had a customized:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">my-app</span><br><span class="line">|-- pom.xml</span><br><span class="line">&#96;-- src</span><br><span class="line">    |-- main</span><br><span class="line">    |   |-- java</span><br><span class="line">    |   |   &#96;-- com</span><br><span class="line">    |   |       &#96;-- mycompany</span><br><span class="line">    |   |           &#96;-- app</span><br><span class="line">    |   |               &#96;-- App.java</span><br><span class="line">    |   &#96;-- resources</span><br><span class="line">    |       &#96;-- testFolder</span><br><span class="line">    |           &#96;-- test.java</span><br><span class="line">    &#96;-- test</span><br><span class="line">        &#96;-- java</span><br><span class="line">            &#96;-- com</span><br><span class="line">                &#96;-- mycompany</span><br><span class="line">                    &#96;-- app</span><br><span class="line">                        &#96;-- AppTest.java</span><br></pre></td></tr></table></figure>
<p>Generates:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">|-- META-INF</span><br><span class="line">|   |-- MANIFEST.MF</span><br><span class="line">|   &#96;-- maven</span><br><span class="line">|       &#96;-- com.mycompany.app</span><br><span class="line">|           &#96;-- my-app</span><br><span class="line">|               |-- pom.properties</span><br><span class="line">|               &#96;-- pom.xml</span><br><span class="line">|-- testFolder</span><br><span class="line">|   &#96;-- test.class</span><br><span class="line">|</span><br><span class="line">&#96;-- com</span><br><span class="line">    &#96;-- mycompany</span><br><span class="line">        &#96;-- app</span><br><span class="line">            &#96;-- App.class</span><br></pre></td></tr></table></figure>

<p>You see other files there like <code>META-INF/MANIFEST.MF</code> as well as a <code>pom.xml</code> and <code>pom.properties</code> file generated as well. These <strong>come standard with generation of a <code>JAR</code> in Maven</strong>. You can create your own manifest if you choose, but Maven will generate one by default if you don‚Äôt. The <code>pom.xml</code> and <code>pom.properties</code> files are packaged up in the JAR <strong>so that each artifact produced by Maven is self-describing and also allows you to utilize the metadata in your own application if the need arises</strong>. One simple use might be to retrieve the version of your application.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> To add resources to the <code>classpath</code> <strong>for your unit tests</strong>, you follow the <strong>same pattern as you do for adding resources to the JAR except the directory you place resources in is <code>${basedir}/src/test/resources</code></strong>.</li>
</ul>
</blockquote>
<h2 id="Resource-Filtering-in-Maven"><a href="#Resource-Filtering-in-Maven" class="headerlink" title="Resource Filtering in Maven"></a>Resource Filtering in Maven</h2><p>This is useful if sometimes a resource file will need to contain a value that can only be <strong>supplied at build time</strong>. Then, you can use Maven to perform <strong>variable replacement</strong> on project resources. When <strong>resource filtering is activated</strong>, Maven will scan <code>resources</code> for <strong>property references surrounded by <code>${&lt;property name&gt;}</code></strong>. When it finds these references it will <strong>replace them with the appropriate value</strong>.</p>
<p>To enable resource filtering, you need to <strong>set <code>filtering</code> to <code>true</code> in your <code>pom.xml</code></strong>, and <strong>add the directory <code>src/main/resources</code> which is the default location MAVEN will look into when it compiles</strong> (since we overwrote the value to <code>true</code>, this has to be re-written again):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">  xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">  xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0</span><br><span class="line">                      http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;my-app&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">  &lt;packaging&gt;jar&lt;&#x2F;packaging&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;name&gt;Maven Quick Start Archetype&lt;&#x2F;name&gt;</span><br><span class="line">  &lt;url&gt;http:&#x2F;&#x2F;maven.apache.org&lt;&#x2F;url&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;junit&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;junit&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;version&gt;4.11&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">  &lt;&#x2F;dependencies&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;build&gt;</span><br><span class="line">    &lt;resources&gt;</span><br><span class="line">      &lt;resource&gt;</span><br><span class="line">        &lt;directory&gt;src&#x2F;main&#x2F;resources&lt;&#x2F;directory&gt;</span><br><span class="line">        &lt;filtering&gt;true&lt;&#x2F;filtering&gt;</span><br><span class="line">      &lt;&#x2F;resource&gt;</span><br><span class="line">    &lt;&#x2F;resources&gt;</span><br><span class="line">  &lt;&#x2F;build&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<p>Now, to <strong>reference a property defined in your pom.xml</strong>, the property name uses the names of the XML elements that define the value, with ‚Äúpom‚Äù being allowed as an alias for the project (root) element. So <code>${project.name}</code> refers to the name of the project, <code>${project.version}</code> refers to the version of the project, <code>${project.build.finalName}</code> refers to the final name of the file created when the built project is packaged, etc. </p>
<p>Similarly, values in the user‚Äôs <code>settings.xml</code> can be referenced using property names beginning with ‚Äúsettings‚Äù (for example, <code>{settings.localRepository}</code> refers to the path of the user‚Äôs local repository).</p>
<p>For example, let‚Äôs add a couple of properties to the <code>application.properties</code> file (which we put in the <code>src/main/resources</code> directory) whose <strong>values will be supplied when the resource is filtered</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># application.properties</span><br><span class="line">application.name&#x3D;$&#123;project.name&#125;</span><br><span class="line">application.version&#x3D;$&#123;project.version&#125;</span><br></pre></td></tr></table></figure>

<p>With that in place, you can execute the following command (process-resources is the build lifecycle phase where the resources are copied and filtered):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn process-resources</span><br></pre></td></tr></table></figure>

<p>and the <code>application.properties</code> file under <code>target/classes</code> (and will eventually go into the jar) looks like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># application.properties</span><br><span class="line">application.name&#x3D;Maven Quick Start Archetype</span><br><span class="line">application.version&#x3D;1.0-SNAPSHOT</span><br></pre></td></tr></table></figure>

<p>With that in place, you can execute the following command (process-resources is the build lifecycle <strong>phase where the resources are copied and filtered</strong>):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn process-resources</span><br></pre></td></tr></table></figure>

<p>and the <code>application.properties</code> file under <code>target/classes/META-INF</code> (and will eventually go into the jar) looks like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># application.properties</span><br><span class="line">application.name&#x3D;my-app</span><br><span class="line">application.version&#x3D;1.0-SNAPSHOT</span><br></pre></td></tr></table></figure>

<h2 id="Filtering-External-Files"><a href="#Filtering-External-Files" class="headerlink" title="Filtering External Files"></a>Filtering External Files</h2><p>To reference a property defined in an external file, all you need to do is <strong>add a reference to this external file in your <code>pom.xml</code></strong>.</p>
<p>First, let‚Äôs create our external properties file and call it <code>src/main/filters/filter.properties</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># filter.properties</span><br><span class="line">my.filter.value&#x3D;hello!</span><br></pre></td></tr></table></figure>

<p>Next, we‚Äôll <strong>add a reference to this new file in the <code>pom.xml</code></strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">  xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">  xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0</span><br><span class="line">                      http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;my-app&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">  &lt;packaging&gt;jar&lt;&#x2F;packaging&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;name&gt;Maven Quick Start Archetype&lt;&#x2F;name&gt;</span><br><span class="line">  &lt;url&gt;http:&#x2F;&#x2F;maven.apache.org&lt;&#x2F;url&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;junit&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;junit&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;version&gt;4.11&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">  &lt;&#x2F;dependencies&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;build&gt;</span><br><span class="line">    &lt;filters&gt;</span><br><span class="line">      &lt;filter&gt;src&#x2F;main&#x2F;filters&#x2F;filter.properties&lt;&#x2F;filter&gt;</span><br><span class="line">    &lt;&#x2F;filters&gt;</span><br><span class="line">    &lt;resources&gt;</span><br><span class="line">      &lt;resource&gt;</span><br><span class="line">        &lt;directory&gt;src&#x2F;main&#x2F;resources&lt;&#x2F;directory&gt;</span><br><span class="line">        &lt;filtering&gt;true&lt;&#x2F;filtering&gt;</span><br><span class="line">      &lt;&#x2F;resource&gt;</span><br><span class="line">    &lt;&#x2F;resources&gt;</span><br><span class="line">  &lt;&#x2F;build&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<p>Then, if we add a reference to this property in the <code>application.properties</code> file:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># application.properties</span><br><span class="line">application.name&#x3D;$&#123;project.name&#125;</span><br><span class="line">application.version&#x3D;$&#123;project.version&#125;</span><br><span class="line">message&#x3D;$&#123;my.filter.value&#125;</span><br></pre></td></tr></table></figure>

<p>the next execution of the <code>mvn process-resources</code> command will put our new property value into <code>application.properties</code>.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> The file <code>filter.property</code> created in the <code>src/main/filters</code> will <strong>not get outputted by MAVEN to the <code>target</code> folder</strong>. This is because, it is <strong>not in the default location tree that MAVEN knows</strong>, so MAVEN will <strong>not compile</strong> it and include in your project.</li>
</ul>
</blockquote>
<p><a name="Using-External-Dependency"></a></p>
<h2 id="Using-External-Dependency"><a href="#Using-External-Dependency" class="headerlink" title="Using External Dependency"></a>Using External Dependency</h2><p>You have, in fact, been using an external dependency all this time, but here we‚Äôll talk about how this works in a bit more detail. For a more thorough introduction, please refer to our Introduction to <a href="https://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html" target="_blank" rel="noopener">Apache Maven Dependency Mechanism</a>.</p>
<p>The dependencies section of the <code>pom.xml</code> lists <strong>all of the external dependencies that our project needs in order to build (whether it needs that dependency at compile time, test time, run time, or whatever)</strong>. Right now, our project is depending on <code>JUnit</code> only (I took out all of the resource filtering stuff for clarity):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">  xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">  xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0</span><br><span class="line">                      http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;my-app&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">  &lt;packaging&gt;jar&lt;&#x2F;packaging&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;name&gt;Maven Quick Start Archetype&lt;&#x2F;name&gt;</span><br><span class="line">  &lt;url&gt;http:&#x2F;&#x2F;maven.apache.org&lt;&#x2F;url&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;junit&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;junit&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;version&gt;4.11&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">  &lt;&#x2F;dependencies&gt;</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<p>For each external dependency, you‚Äôll need to <strong>define at least 4 things: <code>groupId</code>, <code>artifactId</code>, <code>version</code>, and <code>scope</code></strong>. </p>
<ul>
<li>The <code>groupId</code>, <code>artifactId</code>, and <code>versio</code>n are the same as those given in the <strong><code>pom.xml</code> of the project that built that dependency</strong>. </li>
<li>The <code>scope</code> element indicates <strong>how your project uses that dependency</strong>, and can be values like <code>compile</code>, <code>test</code>, and <code>runtime</code>.</li>
</ul>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Where does Maven reference the dependency from? Maven <strong>looks in your local repository</strong> (<code>${user.home}/.m2/repository</code> is the <strong>default location) to find all dependencies</strong>.</li>
</ul>
</blockquote>
<p>This means that we could use code/projects made by others!</p>
<p>For example:</p>
<p>In a <a href="#Installing-into-Local">previous section</a>, we installed the artifact from our project (<code>my-app-1.0-SNAPSHOT.jar</code>) into the local repository. Once it‚Äôs installed there, another project can reference that jar as a dependency simply by <strong>adding the dependency information to its <code>pom.xml</code></strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">  xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">  xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0</span><br><span class="line">                      http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">  &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;my-other-app&lt;&#x2F;artifactId&gt;</span><br><span class="line">  ...</span><br><span class="line">  &lt;dependencies&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;my-app&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;scope&gt;compile&lt;&#x2F;scope&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">  &lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> If a <strong>remote repo is needed</strong>, you could use the mirror in MAVEN to setup the dependency correctly. By default, the remote repository Maven uses can be found (and browsed) at <a href="https://repo.maven.apache.org/maven2/" target="_blank" rel="noopener">https://repo.maven.apache.org/maven2/</a>. You can also set up your own remote repository (maybe a central repository for your company) to use instead of or in addition to the default remote repository. For more information on repositories you can refer to the <a href="https://maven.apache.org/guides/introduction/introduction-to-repositories.html" target="_blank" rel="noopener">Apache Maven Introduction to Repositories</a>. </li>
</ul>
</blockquote>
<p>Now, when we compile the project (<code>mvn compile</code>), we‚Äôll see Maven download the <code>my-app</code> dependency for us.</p>
<h2 id="Deploying-Jar-into-a-Remote-Repository"><a href="#Deploying-Jar-into-a-Remote-Repository" class="headerlink" title="Deploying Jar into a Remote Repository"></a>Deploying Jar into a Remote Repository</h2><p>For deploying jars to an external repository, you have to <strong>configure the repository <code>url</code> in the <code>pom.xml</code></strong> and the <strong>authentication information for connectiong to the repository in the <code>settings.xml</code></strong>.</p>
<p>There are <strong>two locations where a <code>settings.xml</code> file may live</strong>:</p>
<ul>
<li>The Maven install: <code>${maven.home}/conf/settings.xml</code></li>
<li>A user‚Äôs install: <code>${user.home}/.m2/settings.xml</code></li>
</ul>
<p>The <strong>former</strong> <code>settings.xml</code> are also called <strong>global settings</strong>, the <strong>latter</strong> <code>settings.xml</code> are referred to as <strong>user settings</strong>. <strong>If both files exists, their contents gets merged, with the user-specific settings.xml being dominant</strong>.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> <code>settings.xml</code> is a configuration file that <strong>should not be bundled to any specific project</strong> whereas the <strong><code>pom.xml</code> can be distributed</strong>.</li>
</ul>
</blockquote>
<p>Now, going back to the exmple, we can use scp and username/password authentication:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"># pom.xml</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">  xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">  xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0</span><br><span class="line">                      http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;my-app&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">  &lt;packaging&gt;jar&lt;&#x2F;packaging&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;name&gt;Maven Quick Start Archetype&lt;&#x2F;name&gt;</span><br><span class="line">  &lt;url&gt;http:&#x2F;&#x2F;maven.apache.org&lt;&#x2F;url&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;dependencies&gt;</span><br><span class="line">    ...</span><br><span class="line">  &lt;&#x2F;dependencies&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!--</span><br><span class="line">   |</span><br><span class="line">   |</span><br><span class="line">   |</span><br><span class="line">   --&gt;</span><br><span class="line">  &lt;distributionManagement&gt;</span><br><span class="line">    &lt;repository&gt;</span><br><span class="line">      &lt;id&gt;mycompany-repository&lt;&#x2F;id&gt;</span><br><span class="line">      &lt;name&gt;MyCompany Repository&lt;&#x2F;name&gt;</span><br><span class="line">      &lt;url&gt;scp:&#x2F;&#x2F;repository.mycompany.com&#x2F;repository&#x2F;maven2&lt;&#x2F;url&gt;</span><br><span class="line">    &lt;&#x2F;repository&gt;</span><br><span class="line">  &lt;&#x2F;distributionManagement&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<p>and then in <code>settings.xml</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># settings.xml</span><br><span class="line">&lt;settings xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;SETTINGS&#x2F;1.0.0&quot;</span><br><span class="line">  xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">  xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;SETTINGS&#x2F;1.0.0</span><br><span class="line">                      http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;settings-1.0.0.xsd&quot;&gt;</span><br><span class="line">  ...</span><br><span class="line">  &lt;servers&gt;</span><br><span class="line">    &lt;server&gt;</span><br><span class="line">      &lt;id&gt;mycompany-repository&lt;&#x2F;id&gt;</span><br><span class="line">      &lt;username&gt;jvanzyl&lt;&#x2F;username&gt;</span><br><span class="line">      &lt;!-- Default value is ~&#x2F;.ssh&#x2F;id_dsa --&gt;</span><br><span class="line">      &lt;privateKey&gt;&#x2F;path&#x2F;to&#x2F;identity&lt;&#x2F;privateKey&gt; (default is ~&#x2F;.ssh&#x2F;id_dsa)</span><br><span class="line">      &lt;passphrase&gt;my_key_passphrase&lt;&#x2F;passphrase&gt;</span><br><span class="line">    &lt;&#x2F;server&gt;</span><br><span class="line">  &lt;&#x2F;servers&gt;</span><br><span class="line">  ...</span><br><span class="line">&lt;&#x2F;settings&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> If you are connecting to an openssh ssh server which has the parameter <code>&quot;PasswordAuthentication&quot;</code> set to <code>&quot;no&quot;</code> in the <code>sshd_confing</code>, you will have to type your password each time for username/password authentication (although you can log in using another ssh client by typing in the username and password). You might want to switch to public key authentication in this case.</li>
</ul>
</blockquote>
<h2 id="Creating-Documentation-with-a-Site"><a href="#Creating-Documentation-with-a-Site" class="headerlink" title="Creating Documentation with a Site"></a>Creating Documentation with a Site</h2><p>To get you jump started with Maven‚Äôs documentation system you can use the <code>archetype</code> mechanism to generate a site for your existing project using the following command:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mvn archetype:generate \</span><br><span class="line">  -DarchetypeGroupId&#x3D;org.apache.maven.archetypes \</span><br><span class="line">  -DarchetypeArtifactId&#x3D;maven-archetype-site \</span><br><span class="line">  -DgroupId&#x3D;com.mycompany.app \</span><br><span class="line">  -DartifactId&#x3D;my-app-site</span><br></pre></td></tr></table></figure>
<p>here we used the additional line: <code>-Darchetype ArtifactIds=maven-archetype-site</code>, which is an archetype to generate a sample Maven site.</p>
<p>Now head on over to the <a href="https://maven.apache.org/guides/mini/guide-site.html" target="_blank" rel="noopener">Apache Maven Guide to creating a site</a> to learn how to create the documentation for your project.</p>
<h2 id="Creating-Projects-of-Other-Types"><a href="#Creating-Projects-of-Other-Types" class="headerlink" title="Creating Projects of Other Types"></a>Creating Projects of Other Types</h2><p>For example, back in the base directory we can create a simple <code>web application</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mvn archetype:generate \</span><br><span class="line">    -DarchetypeGroupId&#x3D;org.apache.maven.archetypes \</span><br><span class="line">    -DarchetypeArtifactId&#x3D;maven-archetype-webapp \</span><br><span class="line">    -DgroupId&#x3D;com.mycompany.app \</span><br><span class="line">    -DartifactId&#x3D;my-webapp</span><br></pre></td></tr></table></figure>
<p>Here we used <code>-DarchetypeArtifactId=maven-archetype-webapp</code> to use an archetype to generate a sample Maven Webapp project. (For the available archetypes, see <a href="https://maven.apache.org/guides/introduction/introduction-to-archetypes.html" target="_blank" rel="noopener">https://maven.apache.org/guides/introduction/introduction-to-archetypes.html</a>)</p>
<p><a name="Creating-Multiple-Projects-at-Once"></a></p>
<h2 id="Creating-Multiple-Projects-at-Once"><a href="#Creating-Multiple-Projects-at-Once" class="headerlink" title="Creating Multiple Projects at Once"></a>Creating Multiple Projects at Once</h2><p>The basic idea is as follows:</p>
<ul>
<li>First, you could use Maven to create two (or more) projects. </li>
<li>Then, you need to create a <code>pom.xml</code> file that is <strong>above the two folder</strong></li>
<li>After that, you need to configure that <code>pom.xml</code> file to control the two (or more) project folders<ul>
<li>if you need to add dependencies between the two (or more)  sub-projects, you can also add them in the manner like the section <a href="#Using-External-Dependency">Using External Dependency</a></li>
</ul>
</li>
<li>Finally, configure the <code>parent</code> for the two (or more) sub-projects </li>
</ul>
<p>For example, if you created two projects with name <code>my-app</code> and <code>my-webapp</code>, you should have place your <code>pom.xml</code> above the two folders like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+- pom.xml</span><br><span class="line">+- my-app</span><br><span class="line">| +- pom.xml</span><br><span class="line">| +- src</span><br><span class="line">|   +- main</span><br><span class="line">|     +- java</span><br><span class="line">+- my-webapp</span><br><span class="line">| +- pom.xml</span><br><span class="line">| +- src</span><br><span class="line">|   +- main</span><br><span class="line">|     +- webapp</span><br></pre></td></tr></table></figure>
<p>And in the outer <code>pom.xml</code>, you should have the following information:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">  xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">  xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0</span><br><span class="line">                      http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;app&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">  &lt;packaging&gt;pom&lt;&#x2F;packaging&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;modules&gt;</span><br><span class="line">    &lt;module&gt;my-app&lt;&#x2F;module&gt;</span><br><span class="line">    &lt;module&gt;my-webapp&lt;&#x2F;module&gt;</span><br><span class="line">  &lt;&#x2F;modules&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<p>where </p>
<ul>
<li><code>&lt;artifactId&gt;app&lt;/artifactId&gt;</code> will be the entire project name which includes your two subprojects.</li>
<li>the two (or more) sub-projects you included will be inside the <code>&lt;modules&gt;&lt;/modules&gt;</code> section</li>
</ul>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> The parent <code>POM</code> created (called <code>app</code>), has a <strong><code>packaging</code> of <code>pom</code> and a list of <code>modules</code></strong> defined. This tells Maven to <strong>run all operations over the set of projects</strong> instead of just the current one</li>
</ul>
</blockquote>
<p>Finally, we need the following <code>parent</code> information to the <code>pom.xml</code> of the sub-projects like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">  xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">  xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0</span><br><span class="line">                      http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">  &lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;app&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">  &lt;&#x2F;parent&gt;</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>
<p>where </p>
<ul>
<li><code>&lt;artifactId&gt;app&lt;/artifactId&gt;</code> would be same as the <code>artifactId</code> in the outer <code>pom.xml</code> file you manually created.</li>
</ul>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> The <code>parent</code> definition ensures that the <code>POM</code> can always be located <strong>even if the project is distributed separately from its parent</strong> by <strong>looking it up in the repository</strong>.</li>
</ul>
</blockquote>
<p>Now, if you try to run from the top level, the outer directory where the outer <code>pom.xml</code> reside, the following command:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn verify</span><br></pre></td></tr></table></figure>
<p>Then you will have successfully find both of your projects compiled and packed in their respective <code>target</code> folder.</p>
<h2 id="Build-Lifecycle-Basics"><a href="#Build-Lifecycle-Basics" class="headerlink" title="Build Lifecycle Basics"></a>Build Lifecycle Basics</h2><p>Maven is based around the central concept of a build <strong>lifecycle</strong>. What this means is that the process for building and distributing a particular artifact (project) is clearly defined.</p>
<p>There are three built-in build <strong>lifecycles</strong>: <code>default</code>, <code>clean</code> and <code>site</code>. The <code>default</code> lifecycle handles your project deployment, the <code>clean</code> lifecycle handles project cleaning, while the <code>site</code> lifecycle handles the creation of your project‚Äôs site documentation.</p>
<p>Then, you need to understand that a build <strong><code>Lifecycle</code> is made up of <code>Phases</code></strong>, and a <strong><code>Phase</code> is made up of <code>Goals</code></strong>.</p>
<h2 id="Phases-in-a-Build-Lifecycle"><a href="#Phases-in-a-Build-Lifecycle" class="headerlink" title="Phases in a Build Lifecycle"></a>Phases in a Build Lifecycle</h2><p>Each of these build lifecycles is defined by a different list of build phases, wherein a build phase represents a stage in the lifecycle.</p>
<p>For example, the <code>default</code> lifecycle comprises of the following <code>phases</code> (these are not all the phases, only some are picked to illustrate the general concept behind <code>phases</code> and <code>lifecycles</code>):</p>
<ul>
<li><code>validate</code> - validate the project is correct and all necessary information is available</li>
<li><code>compile</code> - compile the source code of the project</li>
<li><code>test</code> - test the compiled source code using a suitable unit testing framework. These tests should not require the code be packaged or deployed</li>
<li><code>package</code> - take the compiled code and package it in its distributable format, such as a JAR.</li>
<li><code>verify</code> - run any checks on results of integration tests to ensure quality criteria are met</li>
<li><code>install</code> - install the package into the local repository, for use as a dependency in other projects locally</li>
<li><code>deploy</code> - done in the build environment, copies the final package to the remote repository for sharing with other developers and projects.</li>
</ul>
<p>Given the <code>default lifecycle</code> phases above, this means that when the <code>default</code> lifecycle is used, Maven will first validate the project, then will try to compile the sources, run those against the tests, package the binaries (e.g. jar), run integration tests against that package, verify the integration tests, install the verified package to the local repository, then deploy the installed package to a remote repository.</p>
<h2 id="Executing-Those-Phases"><a href="#Executing-Those-Phases" class="headerlink" title="Executing Those Phases"></a>Executing Those Phases</h2><p>You should first decide/select the <code>phase</code> that matches your outcome, and then run the command. If you want your <code>jar</code> to be made from your project, run <code>mvn package</code>. If you want to run the unit tests, run <code>mvn test</code>.</p>
<p><strong>If you are uncertain what you want, the preferred phase to call</strong> is:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn verify</span><br></pre></td></tr></table></figure>

<p>This command executes <strong>each <code>default</code> lifecycle <code>phase</code></strong> in order (<code>validate</code>, <code>compile</code>, <code>package</code>, etc.), up to and including, finally, executing <code>verify</code>.</p>
<h2 id="‚ÄúSpecial‚Äù-Phases"><a href="#‚ÄúSpecial‚Äù-Phases" class="headerlink" title="‚ÄúSpecial‚Äù Phases"></a>‚ÄúSpecial‚Äù Phases</h2><p>The phases named with <strong>hyphenated-words (pre-<em>, post-</em>, or process-*)</strong> are <strong>not usually directly called from the command line</strong>. These phases sequence the build, <strong>producing intermediate results that are not useful outside the build</strong>. In the case of invoking <code>integration-test</code>, the environment may be left in a hanging state.</p>
<p>For example:</p>
<p>Failsafe and code coverage plugins bind goals to <code>integration-test</code> and <code>verify</code> phases. But if <code>integration-test</code> were to be called from the command line, no reports are generated. If <code>verify</code> is run, the net result is test and coverage reports are available after the <code>verify</code> phase.</p>
<p>In fact, the worse for executing <code>integration-test</code> is that the integration test container environment is left in a hanging state; the Tomcat webserver or Docker instance is left running, and <strong>Maven may not even terminate by itself</strong>.</p>
<h2 id="Goals-in-a-Phase"><a href="#Goals-in-a-Phase" class="headerlink" title="Goals in a Phase"></a>Goals in a Phase</h2><p>A build phase is responsible for a specific step in the build lifecycle, the manner in which it carries out those responsibilities may vary: it depends on the specific <code>goals</code> (plugins) that are attached to the <code>phase</code>.</p>
<p>A plugin/<code>goal</code> represents <strong>a specific task (finer than a build phase)</strong> which contributes to the building and managing of a project. It may be bound to zero or more build phases. A goal not bound to any build phase could be executed outside of the build lifecycle by direct invocation. </p>
<p>The <strong>order of execution</strong> depends on the <strong>order in which the <code>goal(s)</code> and the build <code>phase(s)</code> are invoked</strong>. For example, consider the command below. The <code>clean</code> and <code>package</code> arguments are build phases, while the <code>dependency:copy-dependencies</code> is a <code>goal</code> (the goal <code>copy-dependencies</code> of a plugin <code>depedency</code>/<code>&quot;maven-dependency-plugin&quot;</code>).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean dependency:copy-dependencies package</span><br></pre></td></tr></table></figure>

<p>If this were to be executed, the <code>clean</code> phase will be executed first (meaning it will run all preceding phases of the <code>clean</code> lifecycle, plus the <code>clean</code> phase itself), and then the <code>dependency:copy-dependencies</code> goal, before finally executing the <code>package</code> phase (and all its preceding build phases of the <code>default</code> lifecycle).</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> A phase can also have <strong>no goals bounded</strong>. If so, no action will be executed during that phase. </li>
</ul>
</blockquote>
<h2 id="Customizing-your-Build-Lifecycle"><a href="#Customizing-your-Build-Lifecycle" class="headerlink" title="Customizing your Build Lifecycle"></a>Customizing your Build Lifecycle</h2><p>The first, and most common way, is to set the <code>packaging</code> for your project via the <strong>element <code>&lt;packaging&gt;</code> in your <code>POM.xml</code> file</strong>. Some of the <strong>valid packaging values</strong> are <code>jar</code>, <code>war</code>, <code>ear</code> and <code>pom</code>. If no packaging value has been specified, it will default to <code>jar</code></p>
<p>For example, in the section where you made multiple projects and had a parent <code>pom.xml</code> file, it looked like:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">  xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">  xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0</span><br><span class="line">                      http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">  &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;app&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">  &lt;packaging&gt;pom&lt;&#x2F;packaging&gt;</span><br><span class="line"></span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>

<p>where </p>
<ul>
<li><code>pom</code> for a packaging value means a project that is <strong>purely metadata</strong>, and it <strong>only binds goals to the <code>install</code> and <code>deploy</code> phases</strong>, which means <strong>during all the other phases there will be no action/execution</strong>.</li>
</ul>
<p>By default, if you have a <code>jar</code> as the packaging value, you will have the following <strong><code>goals</code> bounded to</strong> the following <code>phases</code></p>
<table>
<thead>
<tr>
<th>Phase</th>
<th>plugin:goal</th>
</tr>
</thead>
<tbody><tr>
<td>process-resources</td>
<td>resources:resources</td>
</tr>
<tr>
<td>compile</td>
<td>compiler:compile</td>
</tr>
<tr>
<td>process-test-resources</td>
<td>resources:testResources</td>
</tr>
<tr>
<td>test-compile</td>
<td>compiler:testCompile</td>
</tr>
<tr>
<td>test</td>
<td>surefire:test</td>
</tr>
<tr>
<td>package</td>
<td>jar:jar</td>
</tr>
<tr>
<td>install</td>
<td>install:install</td>
</tr>
<tr>
<td>deploy</td>
<td>deploy:deploy</td>
</tr>
</tbody></table>
<h2 id="Customizing-your-Build-Lifecycle-by-Plugins"><a href="#Customizing-your-Build-Lifecycle-by-Plugins" class="headerlink" title="Customizing your Build Lifecycle by Plugins"></a>Customizing your Build Lifecycle by Plugins</h2><p>The second way to <strong>add <code>goals</code> to <code>phases</code></strong> is to <strong>configure plugins in your project</strong>. Plugins are artifacts that <strong>provide <code>goals</code></strong> to Maven. This means that <strong>a plugin may have one or more <code>goals</code></strong> wherein each goal represents a capability of that plugin.</p>
<p>For example, the <code>Compiler</code> plugin has two goals: <code>compile</code> and <code>testCompile</code>. The former compiles the source code of your main code, while the latter compiles the source code of your test code.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> Perhaps it is clear already, but to make sure: <strong>adding the plugin on its own is not enough information</strong> - you must also <strong>specify the <code>goals</code> you want to run from that plugin</strong>.</li>
<li><input disabled type="checkbox"> As you will see in the later sections, plugins can contain information that indicates <strong>which lifecycle phase</strong> to bind a goal to. If <strong>more than one goal is bound to a particular <code>phase</code></strong>, the <strong>order used</strong> is that those from the <strong><code>packaging</code> are executed first</strong>, followed by those configured in the <code>POM</code>. However, you can use the <code>&lt;executions&gt;</code> element to gain more control over the order of particular goals.</li>
</ul>
</blockquote>
<p>For example, the Modello plugin <strong>binds by default its goal <code>modello:java</code> to the<code>generate-sources</code> phase</strong> (Note: The <code>modello:java</code> goal generates Java source codes). So to use the Modello plugin and have it generate sources from a model and incorporate that into the build, you would add the following to your <code>POM</code> in the <code>&lt;plugins&gt;</code> section of <code>&lt;build&gt;</code>, and it will be <strong>executed in the <code>generate-sources</code> phase if you do not explicitly call it by itself</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"> &lt;plugin&gt;</span><br><span class="line">   &lt;groupId&gt;org.codehaus.modello&lt;&#x2F;groupId&gt;</span><br><span class="line">   &lt;artifactId&gt;modello-maven-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">   &lt;version&gt;1.8.1&lt;&#x2F;version&gt;</span><br><span class="line">   &lt;executions&gt;</span><br><span class="line">     &lt;execution&gt;</span><br><span class="line">       &lt;configuration&gt;</span><br><span class="line">         &lt;models&gt;</span><br><span class="line">           &lt;model&gt;src&#x2F;main&#x2F;mdo&#x2F;maven.mdo&lt;&#x2F;model&gt;</span><br><span class="line">         &lt;&#x2F;models&gt;</span><br><span class="line">         &lt;version&gt;4.0.0&lt;&#x2F;version&gt;</span><br><span class="line">       &lt;&#x2F;configuration&gt;</span><br><span class="line">       &lt;goals&gt;</span><br><span class="line">         &lt;goal&gt;java&lt;&#x2F;goal&gt;</span><br><span class="line">       &lt;&#x2F;goals&gt;</span><br><span class="line">     &lt;&#x2F;execution&gt;</span><br><span class="line">   &lt;&#x2F;executions&gt;</span><br><span class="line"> &lt;&#x2F;plugin&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>You might be wondering why that <code>&lt;executions&gt;</code> element is there. That is so that you can run the same goal multiple times with different configuration if needed.</p>
<p>Now, in the case of <code>modello:java</code>, it only makes sense in the <code>generate-sources</code> phase. <strong>But some goals can be used in more than one phase</strong>, and <strong>there may not be a sensible default</strong>. For those, you can <strong>specify the <code>phase</code> yourself</strong>.</p>
<p>For example, let‚Äôs say you have a goal <code>display:time</code> (that echos the current time to the commandline), and you want it to run in the <code>process-test-resources</code> phase to indicate when the tests were started. This would be configured like so:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"> &lt;plugin&gt;</span><br><span class="line">   &lt;groupId&gt;com.mycompany.example&lt;&#x2F;groupId&gt;</span><br><span class="line">   &lt;artifactId&gt;display-maven-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">   &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">   &lt;executions&gt;</span><br><span class="line">     &lt;execution&gt;</span><br><span class="line">       &lt;phase&gt;process-test-resources&lt;&#x2F;phase&gt;</span><br><span class="line">       &lt;goals&gt;</span><br><span class="line">         &lt;goal&gt;time&lt;&#x2F;goal&gt;</span><br><span class="line">       &lt;&#x2F;goals&gt;</span><br><span class="line">     &lt;&#x2F;execution&gt;</span><br><span class="line">   &lt;&#x2F;executions&gt;</span><br><span class="line"> &lt;&#x2F;plugin&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="Built-in-Lifecycle-and-Phase-Bindings"><a href="#Built-in-Lifecycle-and-Phase-Bindings" class="headerlink" title="Built-in Lifecycle and Phase Bindings"></a>Built-in Lifecycle and Phase Bindings</h2><p>You can see the default bindings for the lifecycle <code>clean</code>, <code>default</code>, and <code>site</code> <a href="https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html#lifecycle-reference" target="_blank" rel="noopener">here</a></p>
<h2 id="Built-in-Phase-and-Goal-Bindings"><a href="#Built-in-Phase-and-Goal-Bindings" class="headerlink" title="Built-in Phase and Goal Bindings"></a>Built-in Phase and Goal Bindings</h2><p>Some <code>phase</code>s have <code>goal</code>s bound to them by default. You can see the default bindings for each <code>phase</code> in the three lifecycles <code>clean</code>, <code>default</code>, <code>site</code> <a href="https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html#built-in-lifecycle-bindings" target="_blank" rel="noopener">here</a></p>
<h2 id="POM-Basics"><a href="#POM-Basics" class="headerlink" title="POM Basics"></a>POM Basics</h2><p>A Project Object Model or <code>POM</code> is the fundamental unit of work in Maven. It is an <strong><code>XML</code> file that contains information about the project and configuration details</strong> used by Maven to build the project. When executing a task or goal, <strong>Maven looks for the <code>POM</code> in the current directory</strong>. It reads the <code>POM</code>, gets the needed configuration information, then executes the goal.</p>
<p>For example, some of the configuration that can be specified in the <code>POM</code> are the project <code>dependencies</code>, the <code>plugins</code> or <code>goals</code> that can be executed, the build profiles, project version, description, developers, mailing lists and so on.</p>
<h2 id="Super-POM"><a href="#Super-POM" class="headerlink" title="Super POM"></a>Super POM</h2><p>The <code>Super POM</code> is Maven‚Äôs <strong>default <code>POM</code></strong>. All <strong><code>POMs</code> extend the <code>Super POM</code> unless explicitly set</strong>, meaning the configuration specified in the <code>Super POM</code> is inherited by the POMs you created for your projects. The snippet below is the Super POM for Maven 3.5.4.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line">&lt;project&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;repositories&gt;</span><br><span class="line">    &lt;repository&gt;</span><br><span class="line">      &lt;id&gt;central&lt;&#x2F;id&gt;</span><br><span class="line">      &lt;name&gt;Central Repository&lt;&#x2F;name&gt;</span><br><span class="line">      &lt;url&gt;https:&#x2F;&#x2F;repo.maven.apache.org&#x2F;maven2&lt;&#x2F;url&gt;</span><br><span class="line">      &lt;layout&gt;default&lt;&#x2F;layout&gt;</span><br><span class="line">      &lt;snapshots&gt;</span><br><span class="line">        &lt;enabled&gt;false&lt;&#x2F;enabled&gt;</span><br><span class="line">      &lt;&#x2F;snapshots&gt;</span><br><span class="line">    &lt;&#x2F;repository&gt;</span><br><span class="line">  &lt;&#x2F;repositories&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;pluginRepositories&gt;</span><br><span class="line">    &lt;pluginRepository&gt;</span><br><span class="line">      &lt;id&gt;central&lt;&#x2F;id&gt;</span><br><span class="line">      &lt;name&gt;Central Repository&lt;&#x2F;name&gt;</span><br><span class="line">      &lt;url&gt;https:&#x2F;&#x2F;repo.maven.apache.org&#x2F;maven2&lt;&#x2F;url&gt;</span><br><span class="line">      &lt;layout&gt;default&lt;&#x2F;layout&gt;</span><br><span class="line">      &lt;snapshots&gt;</span><br><span class="line">        &lt;enabled&gt;false&lt;&#x2F;enabled&gt;</span><br><span class="line">      &lt;&#x2F;snapshots&gt;</span><br><span class="line">      &lt;releases&gt;</span><br><span class="line">        &lt;updatePolicy&gt;never&lt;&#x2F;updatePolicy&gt;</span><br><span class="line">      &lt;&#x2F;releases&gt;</span><br><span class="line">    &lt;&#x2F;pluginRepository&gt;</span><br><span class="line">  &lt;&#x2F;pluginRepositories&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;build&gt;</span><br><span class="line">    &lt;directory&gt;$&#123;project.basedir&#125;&#x2F;target&lt;&#x2F;directory&gt;</span><br><span class="line">    &lt;outputDirectory&gt;$&#123;project.build.directory&#125;&#x2F;classes&lt;&#x2F;outputDirectory&gt;</span><br><span class="line">    &lt;finalName&gt;$&#123;project.artifactId&#125;-$&#123;project.version&#125;&lt;&#x2F;finalName&gt;</span><br><span class="line">    &lt;testOutputDirectory&gt;$&#123;project.build.directory&#125;&#x2F;test-classes&lt;&#x2F;testOutputDirectory&gt;</span><br><span class="line">    &lt;sourceDirectory&gt;$&#123;project.basedir&#125;&#x2F;src&#x2F;main&#x2F;java&lt;&#x2F;sourceDirectory&gt;</span><br><span class="line">    &lt;scriptSourceDirectory&gt;$&#123;project.basedir&#125;&#x2F;src&#x2F;main&#x2F;scripts&lt;&#x2F;scriptSourceDirectory&gt;</span><br><span class="line">    &lt;testSourceDirectory&gt;$&#123;project.basedir&#125;&#x2F;src&#x2F;test&#x2F;java&lt;&#x2F;testSourceDirectory&gt;</span><br><span class="line">    &lt;resources&gt;</span><br><span class="line">      &lt;resource&gt;</span><br><span class="line">        &lt;directory&gt;$&#123;project.basedir&#125;&#x2F;src&#x2F;main&#x2F;resources&lt;&#x2F;directory&gt;</span><br><span class="line">      &lt;&#x2F;resource&gt;</span><br><span class="line">    &lt;&#x2F;resources&gt;</span><br><span class="line">    &lt;testResources&gt;</span><br><span class="line">      &lt;testResource&gt;</span><br><span class="line">        &lt;directory&gt;$&#123;project.basedir&#125;&#x2F;src&#x2F;test&#x2F;resources&lt;&#x2F;directory&gt;</span><br><span class="line">      &lt;&#x2F;testResource&gt;</span><br><span class="line">    &lt;&#x2F;testResources&gt;</span><br><span class="line">    &lt;pluginManagement&gt;</span><br><span class="line">      &lt;!-- NOTE: These plugins will be removed from future versions of the super POM --&gt;</span><br><span class="line">      &lt;!-- They are kept for the moment as they are very unlikely to conflict with lifecycle mappings (MNG-4453) --&gt;</span><br><span class="line">      &lt;plugins&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">          &lt;artifactId&gt;maven-antrun-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">          &lt;version&gt;1.3&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;plugin&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">          &lt;artifactId&gt;maven-assembly-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">          &lt;version&gt;2.2-beta-5&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;plugin&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">          &lt;artifactId&gt;maven-dependency-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">          &lt;version&gt;2.8&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;plugin&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">          &lt;artifactId&gt;maven-release-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">          &lt;version&gt;2.5.3&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;plugin&gt;</span><br><span class="line">      &lt;&#x2F;plugins&gt;</span><br><span class="line">    &lt;&#x2F;pluginManagement&gt;</span><br><span class="line">  &lt;&#x2F;build&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;reporting&gt;</span><br><span class="line">    &lt;outputDirectory&gt;$&#123;project.build.directory&#125;&#x2F;site&lt;&#x2F;outputDirectory&gt;</span><br><span class="line">  &lt;&#x2F;reporting&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;profiles&gt;</span><br><span class="line">    &lt;!-- NOTE: The release profile will be removed from future versions of the super POM --&gt;</span><br><span class="line">    &lt;profile&gt;</span><br><span class="line">      &lt;id&gt;release-profile&lt;&#x2F;id&gt;</span><br><span class="line"> </span><br><span class="line">      &lt;activation&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">          &lt;name&gt;performRelease&lt;&#x2F;name&gt;</span><br><span class="line">          &lt;value&gt;true&lt;&#x2F;value&gt;</span><br><span class="line">        &lt;&#x2F;property&gt;</span><br><span class="line">      &lt;&#x2F;activation&gt;</span><br><span class="line"> </span><br><span class="line">      &lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">          &lt;plugin&gt;</span><br><span class="line">            &lt;inherited&gt;true&lt;&#x2F;inherited&gt;</span><br><span class="line">            &lt;artifactId&gt;maven-source-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;executions&gt;</span><br><span class="line">              &lt;execution&gt;</span><br><span class="line">                &lt;id&gt;attach-sources&lt;&#x2F;id&gt;</span><br><span class="line">                &lt;goals&gt;</span><br><span class="line">                  &lt;goal&gt;jar-no-fork&lt;&#x2F;goal&gt;</span><br><span class="line">                &lt;&#x2F;goals&gt;</span><br><span class="line">              &lt;&#x2F;execution&gt;</span><br><span class="line">            &lt;&#x2F;executions&gt;</span><br><span class="line">          &lt;&#x2F;plugin&gt;</span><br><span class="line">          &lt;plugin&gt;</span><br><span class="line">            &lt;inherited&gt;true&lt;&#x2F;inherited&gt;</span><br><span class="line">            &lt;artifactId&gt;maven-javadoc-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;executions&gt;</span><br><span class="line">              &lt;execution&gt;</span><br><span class="line">                &lt;id&gt;attach-javadocs&lt;&#x2F;id&gt;</span><br><span class="line">                &lt;goals&gt;</span><br><span class="line">                  &lt;goal&gt;jar&lt;&#x2F;goal&gt;</span><br><span class="line">                &lt;&#x2F;goals&gt;</span><br><span class="line">              &lt;&#x2F;execution&gt;</span><br><span class="line">            &lt;&#x2F;executions&gt;</span><br><span class="line">          &lt;&#x2F;plugin&gt;</span><br><span class="line">          &lt;plugin&gt;</span><br><span class="line">            &lt;inherited&gt;true&lt;&#x2F;inherited&gt;</span><br><span class="line">            &lt;artifactId&gt;maven-deploy-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;configuration&gt;</span><br><span class="line">              &lt;updateReleaseInfo&gt;true&lt;&#x2F;updateReleaseInfo&gt;</span><br><span class="line">            &lt;&#x2F;configuration&gt;</span><br><span class="line">          &lt;&#x2F;plugin&gt;</span><br><span class="line">        &lt;&#x2F;plugins&gt;</span><br><span class="line">      &lt;&#x2F;build&gt;</span><br><span class="line">    &lt;&#x2F;profile&gt;</span><br><span class="line">  &lt;&#x2F;profiles&gt;</span><br><span class="line"> </span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<p>Here, we can see some default settings that the <code>SUPER POM</code> has:</p>
<ul>
<li>the build <strong>target directory</strong> set to <code>&lt;directory&gt;${project.basedir}/target&lt;/directory&gt;</code></li>
<li>the build <strong>source directory</strong> set to <code>&lt;sourceDirectory&gt;${project.basedir}/src/main/java&lt;/sourceDirectory&gt;</code></li>
<li>the <strong>central repository</strong> set to <code>&lt;url&gt;https://repo.maven.apache.org/maven2&lt;/url&gt;</code></li>
</ul>
<h2 id="Minimal-POM"><a href="#Minimal-POM" class="headerlink" title="Minimal POM"></a>Minimal POM</h2><p>The <strong>minimum requirement</strong> for a <code>POM</code> are the following:</p>
<ul>
<li>project root</li>
<li>modelVersion - should be set to 4.0.0</li>
<li>groupId - the id of the project‚Äôs group.</li>
<li>artifactId - the id of the artifact (project)</li>
<li>version - the version of the artifact under the specified group</li>
</ul>
<p>For example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;project&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">  &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;my-app&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;1&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>
<p>This is because a needs project‚Äôs <strong>fully qualified artifact name</strong>, which will be <strong>in the form of <code>&lt;groupId&gt;:&lt;artifactId&gt;:&lt;version&gt;</code></strong>. As for the example above, its fully qualified artifact name is <code>&quot;com.mycompany.app:my-app:1&quot;</code>.</p>
<p>Also, as mentioned in the previous section, if the configuration details are <strong>not specified</strong>, <strong>Maven will use their defaults</strong>. One of these default values is the packaging type. Every Maven project has a packaging type. If it is not specified in the <code>POM</code>, then the default value ‚Äú<code>jar</code>‚Äú would be used.</p>
<h2 id="Project-POM-Inheritance"><a href="#Project-POM-Inheritance" class="headerlink" title="Project/POM Inheritance"></a>Project/POM Inheritance</h2><p>Elements in the <code>POM</code> that are merged when you inherit another parent <code>POM</code> are the following:</p>
<ul>
<li>dependencies</li>
<li>developers and contributors</li>
<li>plugin lists (including reports)</li>
<li>plugin executions with matching ids</li>
<li>plugin configuration</li>
<li>resources</li>
</ul>
<p>The <code>Super POM</code> is one example of a parent <code>POM</code> that is inherited by default, however you can also <strong>introduce your own parent <code>POM</code>s by specifying the <code>parent</code> element in the <code>POM</code></strong>, as demonstrated in the following examples.</p>
<ol>
<li><p>If we have everything <strong>ordered nicely</strong> in the following structure, where the parent <code>POM</code> sits right above the children:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">|-- childProject</span><br><span class="line">|   &#96;-- pom.xml</span><br><span class="line">&#96;-- pom.xml</span><br></pre></td></tr></table></figure>
<p>For example, if the <strong>child artifact is <code>com.mycompany.app:childProject:1</code></strong>, </p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;project&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">  &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;childProject&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;1&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<p> And the <strong>parent artifact is <code>com.mycompany.app:parentProject:1</code></strong>, then, we could easily <strong>configure the child <code>POM</code></strong> by adding the <code>&lt;parent&gt;</code> element:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;project&gt;</span><br><span class="line">  &lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;parentProject&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1&lt;&#x2F;version&gt;</span><br><span class="line">  &lt;&#x2F;parent&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">  &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;childProject&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;1&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>If we did not have everything in place, and had the following structure:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line"> |-- childProject</span><br><span class="line"> |   &#96;-- pom.xml</span><br><span class="line"> &#96;-- parentProject</span><br><span class="line">     &#96;-- pom.xml</span><br></pre></td></tr></table></figure>
<p>Then we just need to <strong>add an additional <code>relativePath</code> element</strong> to specify where to find tha parent <code>POM</code>, since we did not have the <code>parent</code> element at the default structure.</p>
<p> So we would <strong>configure the child <code>POM</code></strong> by:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;project&gt;</span><br><span class="line">  &lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;parentProject&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;relativePath&gt;..&#x2F;parent&#x2F;pom.xml&lt;&#x2F;relativePath&gt;</span><br><span class="line">  &lt;&#x2F;parent&gt;</span><br><span class="line"></span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">  &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;childProject&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;1&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>However, in both cases, since the <strong>child <code>POM</code> knows to inherit</strong> from its parent <code>POM</code>, we could further <strong>simplify the child <code>POM</code> to</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;project&gt;</span><br><span class="line">  &lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;parentProject&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1&lt;&#x2F;version&gt;</span><br><span class="line">	(&lt;relativePath&gt;..&#x2F;parent&#x2F;pom.xml&lt;&#x2F;relativePath&gt;)</span><br><span class="line">  &lt;&#x2F;parent&gt;</span><br><span class="line"></span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">  &lt;artifactId&gt;childProject&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>
<p>So that the <strong>child project will have the same <code>groupID</code> and <code>version</code> as the parent, as the information would be inherited</strong>.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> This is different from the example in the section <a href="#Creating-Multiple-Projects-at-Once">Creating Multiple Projects at Once</a> section, because we <strong>did not have the <code>&lt;packaging&gt;pom&lt;/packaging&gt;</code></strong>. The difference is that, in this case (without specifying <code>packaging</code>) the <strong><code>parentProject</code> is/will be used by its child projects</strong> (like Java Inheritance), but in the other case, the <strong>parent uses the children projects</strong> (like Java Composition) <a href="#Project/POM-Aggregation">see below</a></li>
<li><input disabled type="checkbox"> If you want to <strong>compile a specific children project</strong>, you might need to <strong>change the parent <code>POM</code> to <code>&lt;packaging&gt;pom&lt;/packaging&gt;</code></strong>. If you need to access the source codes in the parent directory, you should add the dependencies.</li>
</ul>
</blockquote>
<p><a name="Project/POM-Aggregatio"></a></p>
<h2 id="Project-POM-Aggregation"><a href="#Project-POM-Aggregation" class="headerlink" title="Project/POM Aggregation"></a>Project/POM Aggregation</h2><p>Project Aggregation is similar to Project Inheritance, but there is an essential difference:</p>
<ul>
<li>Project Inheritance would have <code>childrenProjects</code> (<code>modules</code>) using/inheriting the <code>parentProject</code>(<code>parent</code>)</li>
<li>Project Aggregation would have <code>parentProjects</code> (<code>parent</code>) using/composed of the <code>childProjects</code> (<code>modules</code>)</li>
</ul>
<p>So, instead of specifying the parent <code>POM</code> from the <code>module</code>, it <strong>specifies the <code>modules</code> in the parent <code>POM</code></strong>. By doing so, the parent project now knows its <code>modules</code>, and <strong>if a Maven command is invoked against the parent project</strong>, <strong>that Maven command will then be executed to the parent‚Äôs <code>modules</code> (its <code>childProjects</code>)as well</strong>. To do Project Aggregation, you must do the following:</p>
<ul>
<li><strong>Configure the <code>parent</code> POMs</strong> <code>packaging</code> to the value ‚Äú<code>pom</code>‚Äú.</li>
<li><strong>Specify in the parent POM</strong> the directories of its modules (children POMs).</li>
</ul>
<ol>
<li><p>If the directory structure follows that of the default structure:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line"> |-- my-module</span><br><span class="line"> |   &#96;-- pom.xml</span><br><span class="line"> &#96;-- pom.xml</span><br></pre></td></tr></table></figure>
<p>Then we need to add the <code>&lt;packaging&gt;</code> element and the <code>&lt;modules&gt;</code> element in the <strong>parent <code>POM</code></strong>:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;project&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">  &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;parent&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;1&lt;&#x2F;version&gt;</span><br><span class="line">  &lt;packaging&gt;pom&lt;&#x2F;packaging&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;modules&gt;</span><br><span class="line">    &lt;module&gt;my-module&lt;&#x2F;module&gt;</span><br><span class="line">  &lt;&#x2F;modules&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>
<p>Now, whenever a Maven command processes <code>com.mycompany.app:parent:1</code>, that same Maven command would be ran against <code>com.mycompany.app:my-module:1</code> as well. Furthermore, some commands (goals specifically) handle project aggregation differently.</p>
</li>
<li><p>If we have the directory structure to the following:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line"> |-- my-module</span><br><span class="line"> |   &#96;-- pom.xml</span><br><span class="line"> &#96;-- parent</span><br><span class="line">     &#96;-- pom.xml</span><br></pre></td></tr></table></figure>

<p> Then we need to specify the <strong>relative path to the module</strong> in the parent <code>POM</code>.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;project&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">  &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;parent&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;1&lt;&#x2F;version&gt;</span><br><span class="line">  &lt;packaging&gt;pom&lt;&#x2F;packaging&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;modules&gt;</span><br><span class="line">    &lt;module&gt;..&#x2F;my-module&lt;&#x2F;module&gt;</span><br><span class="line">  &lt;&#x2F;modules&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="Combining-Project-Inheritance-and-Project-Aggregation"><a href="#Combining-Project-Inheritance-and-Project-Aggregation" class="headerlink" title="Combining Project Inheritance and Project Aggregation"></a>Combining Project Inheritance and Project Aggregation</h2><p>To achieve this, you just edit both child and parent <code>POM</code> in the same way introduced above:</p>
<ul>
<li>Specify in every child POM who their parent POM is. (Project Inheritance)</li>
<li>Change the parent POMs packaging to the value ‚Äúpom‚Äù . (Project Aggregation)</li>
<li>Specify in the parent POM the directories of its modules. (Project Aggregation)</li>
</ul>
<p>For a simple example:<br><code>com.mycompany.app:paernt:1</code>‚Äòs POM</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;project&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">  &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;parent&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;1&lt;&#x2F;version&gt;</span><br><span class="line">  &lt;packaging&gt;pom&lt;&#x2F;packaging&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;modules&gt;</span><br><span class="line">    &lt;module&gt;..&#x2F;my-module&lt;&#x2F;module&gt;</span><br><span class="line">  &lt;&#x2F;modules&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<p><code>com.mycompany.app:my-module:1</code>‚Äòs POM</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;project&gt;</span><br><span class="line">  &lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;parent&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;relativePath&gt;..&#x2F;parent&#x2F;pom.xml&lt;&#x2F;relativePath&gt;</span><br><span class="line">  &lt;&#x2F;parent&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">  &lt;artifactId&gt;my-module&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Variables-in-POM"><a href="#Variables-in-POM" class="headerlink" title="Variables in POM"></a>Variables in <code>POM</code></h2><p>One of the practices that Maven encourages is don‚Äôt repeat yourself. However, there are circumstances where you will need to use the same value in several different locations. To assist in ensuring the value is only specified once, Maven allows you to <strong>use both your own and pre-defined variables in the <code>POM</code></strong>.</p>
<p>For example, to access the <code>project.version</code> variable (this is pre-defined), you would reference it like so:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;version&gt;$&#123;project.version&#125;&lt;&#x2F;version&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> If you get an error, you might need to make the variable by yourself in the parent <code>pom</code>. To do this, <a href="#own-variable">see below</a></li>
</ul>
</blockquote>
<ul>
<li><p>Some of the <strong>pre-defined variables</strong> are:</p>
<ul>
<li><strong>Project Model Variables</strong>:<br>Any field of the model that is a single value element can be referenced as a variable. For example, <code>${project.groupId}</code>, <code>${project.version}</code>, <code>${project.build.sourceDirectory}</code> and so on. Refer to the POM reference to see a full list of properties.</li>
<li><strong>Special Variables</strong><ul>
<li><code>project.basedir</code>    The directory that the current project resides in.</li>
<li><code>project.baseUri</code>    The directory that the current project resides in, represented as an URI. Since Maven 2.1.0</li>
<li><code>maven.build.timestamp</code>    The timestamp that denotes the start of the build (UTC). Since Maven 2.1.0-M1</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><a name="own-variable"></a></p>
<ul>
<li>You can also use your <strong>own variable</strong> if you define it in the <code>&lt;properties&gt;</code> section:  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;project&gt;</span><br><span class="line">  ...</span><br><span class="line">  &lt;properties&gt;</span><br><span class="line">    &lt;mavenVersion&gt;3.0&lt;&#x2F;mavenVersion&gt;</span><br><span class="line">  &lt;&#x2F;properties&gt;</span><br><span class="line">  &lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;org.apache.maven&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;maven-artifact&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;version&gt;$&#123;mavenVersion&#125;&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;org.apache.maven&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;maven-core&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;version&gt;$&#123;mavenVersion&#125;&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">  &lt;&#x2F;dependencies&gt;</span><br><span class="line">  ...</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="Profiles"><a href="#Profiles" class="headerlink" title="Profiles"></a>Profiles</h2><p>In short, Maven profiles can be used to create <strong>customized build configurations</strong>.</p>
<p>Profiles are specified using the element <code>&lt;profile&gt;</code> in the <code>POM</code>itself (in the extra section <code>&lt;profiles&gt;</code>), and can be <strong>triggered in many different ways</strong>. They modify the POM at build time, and are meant to be used in complementary sets to give equivalent-but-different parameters for a set of target environments (providing, for example, the path of the appserver root in the development, testing, and production environments). As such, profiles can easily lead to differing build results from different members of your team. </p>
<p>Profiles (<code>&lt;profiles&gt;</code>) can be <strong>specified in any of the four file locations</strong>:</p>
<ul>
<li><p>Per Project</p>
<ul>
<li>Defined in the POM itself (<code>pom.xml</code>).</li>
</ul>
</li>
<li><p>Per User</p>
<ul>
<li>Defined in the Maven-settings (<code>%USER_HOME%/.m2/settings.xml</code>).</li>
</ul>
</li>
<li><p>Global</p>
<ul>
<li>Defined in the global Maven-settings (<code>${maven.home}/conf/settings.xml</code>).</li>
</ul>
</li>
<li><p>Profile descriptor (<strong>unsupported in Maven 3.0 and above</strong>)</p>
<ul>
<li>a descriptor located in project basedir (profiles.xml) </li>
</ul>
</li>
</ul>
<h2 id="Viewing-Active-Profiles"><a href="#Viewing-Active-Profiles" class="headerlink" title="Viewing Active Profiles"></a>Viewing Active Profiles</h2><p>To see which profiles are already active, you can use the <code>help</code> plugin from MAVEN:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn help:active-profiles</span><br></pre></td></tr></table></figure>

<p>and by default, nothing is actived so you will see nothing:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Active Profiles for Project &#39;com.mycompany.app:my-app:pom:1.0-SNAPSHOT&#39;:</span><br><span class="line"></span><br><span class="line">The following profiles are active:</span><br></pre></td></tr></table></figure>
<p>If we want to <strong>automatically show the active profiles</strong> when we are doing, for example, the <code>compile</code> phase, we can use the similar approach shown in the section [Customizing your Build Lifecycle by Plugins](#Customizing-your-Build Lifecycle-by-Plugins) by <strong>adding the <code>help</code> plugin and the <code>goal</code></strong> in our phase <code>compile</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;maven-help-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;3.2.0&lt;&#x2F;version&gt;</span><br><span class="line">            &lt;executions&gt;</span><br><span class="line">                &lt;execution&gt;</span><br><span class="line">                    &lt;id&gt;show-profiles&lt;&#x2F;id&gt;</span><br><span class="line">                    &lt;phase&gt;compile&lt;&#x2F;phase&gt;</span><br><span class="line">                    &lt;goals&gt;</span><br><span class="line">                        &lt;goal&gt;active-profiles&lt;&#x2F;goal&gt;</span><br><span class="line">                    &lt;&#x2F;goals&gt;</span><br><span class="line">                &lt;&#x2F;execution&gt;</span><br><span class="line">            &lt;&#x2F;executions&gt;</span><br><span class="line">        &lt;&#x2F;plugin&gt;</span><br><span class="line">    &lt;&#x2F;plugins&gt;</span><br><span class="line">&lt;&#x2F;build&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Making-a-Profile"><a href="#Making-a-Profile" class="headerlink" title="Making a Profile"></a>Making a Profile</h2><p>Within each <code>&lt;profile&gt;</code> element, we can <strong>configure many elements such as <code>dependencies</code>, <code>plugins</code>, <code>resources</code>, <code>finalName</code></strong>.</p>
<p>For example (configured a <code>plugin</code>):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;profiles&gt;</span><br><span class="line">	&lt;profile&gt;</span><br><span class="line">	  &lt;id&gt;test&lt;&#x2F;id&gt;</span><br><span class="line"></span><br><span class="line">	  &lt;build&gt;</span><br><span class="line">	     &lt;plugins&gt;</span><br><span class="line">	        &lt;plugin&gt;</span><br><span class="line">	           &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">	           &lt;artifactId&gt;maven-antrun-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">	           &lt;version&gt;1.1&lt;&#x2F;version&gt;</span><br><span class="line">	           &lt;executions&gt;</span><br><span class="line">	              &lt;execution&gt;</span><br><span class="line">	                 &lt;phase&gt;test&lt;&#x2F;phase&gt;</span><br><span class="line">	                 &lt;goals&gt;</span><br><span class="line">	                    &lt;goal&gt;run&lt;&#x2F;goal&gt;</span><br><span class="line">	                 &lt;&#x2F;goals&gt;</span><br><span class="line">	                 &lt;configuration&gt;</span><br><span class="line">	                 &lt;tasks&gt;</span><br><span class="line">	                    &lt;echo&gt;Using app.test.properties&lt;&#x2F;echo&gt;</span><br><span class="line">	                    &lt;copy file&#x3D;&quot;src&#x2F;main&#x2F;resources&#x2F;app.test.properties&quot; </span><br><span class="line">	                    	tofile&#x3D;&quot;$&#123;project.build.outputDirectory&#125;&#x2F;env.properties&quot;&#x2F;&gt;</span><br><span class="line">	                 &lt;&#x2F;tasks&gt;</span><br><span class="line">	                 &lt;&#x2F;configuration&gt;</span><br><span class="line">	              &lt;&#x2F;execution&gt;</span><br><span class="line">	           &lt;&#x2F;executions&gt;</span><br><span class="line">	        &lt;&#x2F;plugin&gt;</span><br><span class="line">	     &lt;&#x2F;plugins&gt;</span><br><span class="line">	  &lt;&#x2F;build&gt;</span><br><span class="line"></span><br><span class="line">	&lt;&#x2F;profile&gt;</span><br><span class="line">&lt;&#x2F;profiles&gt;</span><br></pre></td></tr></table></figure>
<p>Another simpler example could be:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;profiles&gt;</span><br><span class="line">  &lt;profile&gt;</span><br><span class="line">    &lt;id&gt;no-tests&lt;&#x2F;id&gt;</span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;maven.test.skip&gt;true&lt;&#x2F;maven.test.skip&gt;</span><br><span class="line">    &lt;&#x2F;properties&gt;</span><br><span class="line">  &lt;&#x2F;profile&gt;</span><br><span class="line">&lt;&#x2F;profiles&gt;</span><br></pre></td></tr></table></figure>
<p>(This will skip the <code>test</code> phase in the artifact if you activate it.)</p>
<p>In general, it is <strong>recommended</strong> to specify a profile in the <strong><code>POM</code> of the project</strong>. This is because it will be <strong>portable</strong> since the <code>POM</code> file will be included in the final product. In contrast, profiles specified in <strong>external files</strong> (i.e <strong>in <code>settings.xml</code></strong> or <code>profiles.xml</code>) are <strong>not portable</strong> in the strictest sense. Also, you can <strong>specify much more modifications in the profile in the <code>POM</code> than in the <code>settings.xml</code></strong>. For more details, see the section <a href="#Profiles-in-POM-and-in-Settings">Profiles in <code>POM</code>s and in <code>Settings</code></a>.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> In the above examples, there is an <code>&lt;id&gt;</code> element for that <code>profile</code>. <strong>This will be used later to activate the profile</strong>, so it is important to give it a sensible name,</li>
<li><input disabled type="checkbox"> We can also <strong>configure as many profiles</strong> as we want by <strong>giving them unique <code>id</code>s</strong>.</li>
</ul>
</blockquote>
<h2 id="Activate-a-Profile"><a href="#Activate-a-Profile" class="headerlink" title="Activate a Profile"></a>Activate a Profile</h2><p>You can activate a profile in a number of ways:</p>
<ul>
<li>For a <strong>single run</strong><ul>
<li>explicitly add the <code>-P &lt;profile-id&gt;</code> at the end of a command</li>
</ul>
</li>
<li><strong>Automatically for a project</strong> (per project)<ul>
<li>through the <code>POM</code> file</li>
</ul>
</li>
<li><strong>Automatically for all projects of a user</strong> (per user)<ul>
<li>Through Maven settings</li>
</ul>
</li>
<li><strong>Triggered</strong><ul>
<li>Based on environment variables</li>
<li>OS settings</li>
<li>Present or missing files</li>
</ul>
</li>
</ul>
<h2 id="Activate-Profile-for-a-Single-Run"><a href="#Activate-Profile-for-a-Single-Run" class="headerlink" title="Activate Profile for a Single Run"></a>Activate Profile for a Single Run</h2><p>This can be done by adding the option <code>-P &lt;profile-id&gt;</code> so that the profile will be <strong>activated for that specific run</strong>.</p>
<p>For example, to use the <code>no-test</code> profile (assuming that profile is added to the <code>pom</code> file of this project), we could use:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn package -P no-test</span><br></pre></td></tr></table></figure>
<p>This will execute all phases up to and until <code>package</code>, except <strong>skipping the <code>test</code> phase</strong>, as <strong>specified by our <code>no-test</code> profile</strong>.</p>
<p>You could also activate multiple profiles by using comma as a delimiter:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn package -P no-test,profile2,profile3</span><br></pre></td></tr></table></figure>

<h2 id="Activate-Profile-Automatically-for-a-Project"><a href="#Activate-Profile-Automatically-for-a-Project" class="headerlink" title="Activate Profile Automatically for a Project"></a>Activate Profile Automatically for a Project</h2><p>This can be done by adding another section <code>&lt;activation&gt;</code> in the same section where you specified the <code>&lt;profile&gt;</code>. </p>
<p>For example, if we want to automatically activate the profile <code>no-test</code> for a project (again, assuming that profile is added to the <code>pom</code> file of this project), then we would have in the <code>pom</code> file:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;profiles&gt;</span><br><span class="line">  &lt;profile&gt;</span><br><span class="line">    &lt;id&gt;no-test&lt;&#x2F;id&gt;</span><br><span class="line">    &lt;activation&gt;</span><br><span class="line">	  &lt;activateByDefault&gt;true&lt;&#x2F;activateByDefault&gt;</span><br><span class="line">    &lt;&#x2F;activation&gt;</span><br><span class="line"></span><br><span class="line">	&lt;properties&gt;</span><br><span class="line">	  &lt;maven.test.skip&gt;true&lt;&#x2F;maven.test.skip&gt;</span><br><span class="line">	&lt;&#x2F;properties&gt;</span><br><span class="line">  &lt;&#x2F;profile&gt;</span><br><span class="line">&lt;profiles&gt;</span><br></pre></td></tr></table></figure>
<p>This will activate the profile <code>no-test</code> everytime when the project is run.</p>
<h2 id="Deactivating-a-Profile"><a href="#Deactivating-a-Profile" class="headerlink" title="Deactivating a Profile"></a>Deactivating a Profile</h2><p>Deactivating a profile is done by adding the option <code>-P !&lt;profile-id&gt;</code> or <code>-P -&lt;profile-id&gt;</code></p>
<p>However, one important thing to note is that, if you have several profiles that are <strong>activated by default</strong>, running the <code>-P !&lt;profile-id&gt;</code> or <code>-P -&lt;profile-id&gt;</code> would <strong>override the configuration such that all those profiles that are activated by default would be ignored/deactivated</strong>.</p>
<h2 id="Activate-Profile-Automatically-for-all-Projects-per-user"><a href="#Activate-Profile-Automatically-for-all-Projects-per-user" class="headerlink" title="Activate Profile Automatically for all Projects (per user)"></a>Activate Profile Automatically for all Projects (per user)</h2><p>Profiles can be activated in the <strong>Maven settings file</strong> (per user, <code>%USER_HOME%/.m2/settings.xml</code>; globally/all users, <code>${maven.home}/conf/settings.xml</code>), via the <code>&lt;activeProfiles&gt;</code> section. This section takes a list of <code>&lt;activeProfile&gt;</code> elements, each containing a <code>&lt;profile-id&gt;</code> inside.</p>
<p>For example, to activate the <code>no-test</code> profile for all projects of a user, add the following to the <code>%USER_HOME%/.m2/settings.xml</code>: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;settings&gt;</span><br><span class="line">  ...</span><br><span class="line">  &lt;activeProfiles&gt;</span><br><span class="line">    &lt;activeProfile&gt;no-test&lt;&#x2F;activeProfile&gt;</span><br><span class="line">  &lt;&#x2F;activeProfiles&gt;</span><br><span class="line">  ...</span><br><span class="line">&lt;&#x2F;settings&gt;</span><br></pre></td></tr></table></figure>
<p>So that profiles listed in the <code>&lt;activeProfiles&gt;</code> tag would be <strong>activated by default every time that user runs a project</strong>.</p>
<h2 id="Activate-Profiles-by-Triggers"><a href="#Activate-Profiles-by-Triggers" class="headerlink" title="Activate Profiles by Triggers"></a>Activate Profiles by Triggers</h2><p>Profiles can be automatically triggered based on the detected state of the build environment. <strong>These triggers are specified via an <code>&lt;activation&gt;</code> section in the profile itself</strong>.</p>
<ul>
<li><p>Triggered by a specific JDK version:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;profiles&gt;</span><br><span class="line">  &lt;profile&gt;</span><br><span class="line">    &lt;activation&gt;</span><br><span class="line">      &lt;jdk&gt;1.4&lt;&#x2F;jdk&gt;</span><br><span class="line">    &lt;&#x2F;activation&gt;</span><br><span class="line">    ...</span><br><span class="line">  &lt;&#x2F;profile&gt;</span><br><span class="line">&lt;&#x2F;profiles&gt;</span><br></pre></td></tr></table></figure>

<p>  The above will trigger the profile when the JDK‚Äôs version <strong>starts with ‚Äú1.4‚Äù</strong> (eg. ‚Äú1.4.0_08‚Äù, ‚Äú1.4.2_07‚Äù, ‚Äú1.4‚Äù)</p>
</li>
<li><p>Triggered by a specific OS setting:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;profiles&gt;</span><br><span class="line">  &lt;profile&gt;</span><br><span class="line">    &lt;activation&gt;</span><br><span class="line">      &lt;os&gt;</span><br><span class="line">        &lt;name&gt;Windows XP&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;family&gt;Windows&lt;&#x2F;family&gt;</span><br><span class="line">        &lt;arch&gt;x86&lt;&#x2F;arch&gt;</span><br><span class="line">        &lt;version&gt;5.1.2600&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;&#x2F;os&gt;</span><br><span class="line">    &lt;&#x2F;activation&gt;</span><br><span class="line">    ...</span><br><span class="line">  &lt;&#x2F;profile&gt;</span><br><span class="line">&lt;&#x2F;profiles&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Triggered by a specific property</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;profiles&gt;</span><br><span class="line">  &lt;profile&gt;</span><br><span class="line">    &lt;activation&gt;</span><br><span class="line">      &lt;property&gt;</span><br><span class="line">        &lt;name&gt;debug&lt;&#x2F;name&gt;</span><br><span class="line">      &lt;&#x2F;property&gt;</span><br><span class="line">    &lt;&#x2F;activation&gt;</span><br><span class="line">    ...</span><br><span class="line">  &lt;&#x2F;profile&gt;</span><br><span class="line">&lt;&#x2F;profiles&gt;</span><br></pre></td></tr></table></figure>

<p>  The profile above will be activated when the system property ‚Äúdebug‚Äù is specified with <strong>any value</strong>.</p>
<p>  Or, you can specify it to be activated when the system property ‚Äúdebug‚Äù is <strong>not defined</strong>, or is defined with <strong>a value which is not ‚Äútrue‚Äù</strong>.</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;profiles&gt;</span><br><span class="line">  &lt;profile&gt;</span><br><span class="line">    &lt;activation&gt;</span><br><span class="line">      &lt;property&gt;</span><br><span class="line">        &lt;name&gt;debug&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;value&gt;!true&lt;&#x2F;value&gt;</span><br><span class="line">      &lt;&#x2F;property&gt;</span><br><span class="line">    &lt;&#x2F;activation&gt;</span><br><span class="line">    ...</span><br><span class="line">  &lt;&#x2F;profile&gt;</span><br><span class="line">&lt;&#x2F;profiles&gt;</span><br></pre></td></tr></table></figure>

<p>  The above can be activated by typing one of those on the command line:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mvn groupId:artifactId:goal</span><br><span class="line">mvn groupId:artifactId:goal -Ddebug&#x3D;false</span><br></pre></td></tr></table></figure></li>
<li><p>Triggered by a missing/present file</p>
<p>  This example will trigger the profile when the generated file <code>target/generated-sources/axistools/wsdl2java/org/apache/maven</code> is <strong>missing</strong>.</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;profiles&gt;</span><br><span class="line">  &lt;profile&gt;</span><br><span class="line">    &lt;activation&gt;</span><br><span class="line">      &lt;file&gt;</span><br><span class="line">        &lt;missing&gt;target&#x2F;generated-sources&#x2F;axistools&#x2F;wsdl2java&#x2F;org&#x2F;apache&#x2F;maven&lt;&#x2F;missing&gt;</span><br><span class="line">      &lt;&#x2F;file&gt;</span><br><span class="line">    &lt;&#x2F;activation&gt;</span><br><span class="line">    ...</span><br><span class="line">  &lt;&#x2F;profile&gt;</span><br><span class="line">&lt;&#x2F;profiles&gt;</span><br></pre></td></tr></table></figure>

<p>  Or you could <strong>switch the <code>&lt;missing&gt;</code> to <code>&lt;exists&gt;</code></strong> if you want to trigger the profile <strong>when that file is present</strong>.</p>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> As of Maven 2.0.9, the tags <code>&lt;exists&gt;</code> and <code>&lt;missing&gt;</code> could be <strong>interpolated</strong>. <strong>Supported variables</strong> are system properties like <code>${user.home}</code> and environment variables like <code>${env.HOME}</code>. Please note that <strong>properties and values defined in the POM</strong> itself are <strong>not available</strong> for interpolation here</li>
</ul>
</blockquote>
</li>
</ul>
<p><a name="Profiles-in-POM-and-in-Settings"></a></p>
<h2 id="Profiles-in-POMs-and-in-Settings"><a href="#Profiles-in-POMs-and-in-Settings" class="headerlink" title="Profiles in POMs and in Settings"></a>Profiles in <code>POM</code>s and in <code>Settings</code></h2><ul>
<li><p>Profiles in external files (<code>settings.xml</code>)</p>
<p>  Profiles specified in external files (i.e in <code>settings.xml</code> or <code>profiles.xml</code>) are not portable in the strictest sense. Things like repository lists could simply be a proprietary repository of approved artifacts, and won‚Äôt change the outcome of the build. Therefore, you will <strong>only be able to modify</strong> </p>
<ul>
<li><code>&lt;repositories&gt;</code></li>
<li><code>&lt;pluginRepositories&gt;</code></li>
<li><code>&lt;properties&gt;</code></li>
</ul>
</li>
<li><p>Profiles in <code>POM</code>s</p>
<p>If your profiles can be reasonably specified inside the <code>POM</code>, you will have a better portability <strong>since these profiles are specified inline</strong>. Therefore, you have many more options as well. The <strong>trade-off</strong>, of course, is that you can <strong>only modify that project and it‚Äôs sub-modules</strong>.</p>
<p>  Profiles specified in the <code>POM</code> can modify the following <code>POM</code> elements:</p>
<ul>
<li><code>&lt;repositories&gt;</code></li>
<li><code>&lt;pluginRepositories&gt;</code></li>
<li><code>&lt;dependencies&gt;</code></li>
<li><code>&lt;plugins&gt;</code></li>
<li><code>&lt;properties&gt;</code> (not actually available in the main POM, but used behind the scenes)</li>
<li><code>&lt;modules&gt;</code></li>
<li><code>&lt;reporting&gt;</code></li>
<li><code>&lt;dependencyManagement&gt;</code></li>
<li><code>&lt;distributionManagement&gt;</code></li>
<li>a subset of the <code>&lt;build&gt;</code> element, which consists of:<ul>
<li><code>&lt;defaultGoal&gt;</code></li>
<li><code>&lt;resources&gt;</code></li>
<li><code>&lt;testResources&gt;</code></li>
<li><code>&lt;finalName&gt;</code></li>
<li><code>&lt;plugin&gt;</code>???</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> If you have conflicting profiles in both the <code>pom</code> file and the <code>settings.xml</code> file, take note that <strong>profiles in the <code>settings.xml</code> takes higher priority</strong> than profiles in the <code>POM</code>.</li>
</ul>
</blockquote>
<h2 id="Standard-Directory-Output"><a href="#Standard-Directory-Output" class="headerlink" title="Standard Directory Output"></a>Standard Directory Output</h2><p>Having a common directory layout would allow for users familiar with one Maven project to immediately feel at home in another Maven project. The following table documents the <strong>directory layout expected by Maven</strong> and the directory layout created by Maven. Please try to conform to this structure as much as possible; however, if you can‚Äôt these settings <strong>can be overridden via the project descriptor</strong>.</p>
<table>
<thead>
<tr>
<th>Directory</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>src/main/java</code></td>
<td>Application/Library sources</td>
</tr>
<tr>
<td><code>src/main/resources</code></td>
<td>Application/Library resources</td>
</tr>
<tr>
<td><code>src/main/filters</code></td>
<td>Resource filter files</td>
</tr>
<tr>
<td><code>src/main/webapp</code></td>
<td>Web application sources</td>
</tr>
<tr>
<td><code>src/test/java</code></td>
<td>Test sources</td>
</tr>
<tr>
<td><code>src/test/resources</code></td>
<td>Test resources</td>
</tr>
<tr>
<td><code>src/test/filters</code></td>
<td>Test resource filter files</td>
</tr>
<tr>
<td><code>src/it</code></td>
<td>Integration Tests (primarily for plugins)</td>
</tr>
<tr>
<td><code>src/assembly</code></td>
<td>Assembly descriptors</td>
</tr>
<tr>
<td><code>src/site</code></td>
<td>Site</td>
</tr>
<tr>
<td><code>LICENSE.txt</code></td>
<td>Project‚Äôs license</td>
</tr>
<tr>
<td><code>NOTICE.txt</code></td>
<td>Notices and attributions required by libraries that the project depends on</td>
</tr>
<tr>
<td><code>README.txt</code></td>
<td>Project‚Äôs readme</td>
</tr>
</tbody></table>
<p>This means that <strong>at the top level</strong>, we will have <strong>files descriptive of the project</strong>: a <code>pom.xml</code> file, and textual documents meant for the user to be able to read immediately on receiving the source: <code>README.txt</code>, <code>LICENSE.txt</code>, etc.</p>
<p>So there are just <strong>two subdirectories of this structure</strong>: <code>src</code> and <code>target</code>. The <strong>only other directories that would be expected</strong> here are metadata like <code>CVS</code>, <strong><code>.git</code></strong> or <code>.svn</code>, and any subprojects in a multiproject build (each of which would be laid out as above).</p>
<ul>
<li>The <code>src</code> directory contains <strong>all of the source material for building the project</strong>, its site and so on. It contains a subdirectory for each type: main for the main build artifact, test for the unit test code and resources, site and so on.</li>
<li>The <code>target</code> directory is used to house <strong>all output of the build</strong>.</li>
</ul>
<p>Also, it is important to see that, within artifact producing source directories (ie. main and test), <strong>there is one directory for the language java</strong> (under which the normal package hierarchy exists), and one for resources (the structure which is copied to the target classpath given the default resource definition). But <strong>if there are other contributing sources to the artifact build, they would be under other subdirectories</strong>: for example <code>src/main/antlr</code> would contain Antlr grammar definition files.</p>
<h2 id="Transitive-Dependency"><a href="#Transitive-Dependency" class="headerlink" title="Transitive Dependency"></a>Transitive Dependency</h2><p>Maven avoids the need to <strong>specify the libraries that your own dependencies require</strong> by including <strong>transitive dependencies</strong> automatically.</p>
<p>This feature is facilitated by <strong>reading the project files of your dependencies from the remote repositories specified</strong>. In general, <strong>all dependencies of those projects are used in your project</strong>, as are any that the project inherits from its parents, or from its dependencies, and so on.  A problem arises only if a cyclic dependency is discovered.</p>
<p>However, with transitive dependency, the graph of included libraries will grow quite large. Therefore, there are <strong>additional features that can be used to limit which dependencies are included</strong>:</p>
<ul>
<li>Dependency Mediation</li>
<li>Dependency Management</li>
<li>Dependency Scope</li>
<li>Dependency Exclusion</li>
<li>Optional Dependency</li>
</ul>
<h2 id="Dependency-Mediation"><a href="#Dependency-Mediation" class="headerlink" title="Dependency Mediation"></a>Dependency Mediation</h2><p>This determines <strong>what version of an artifact/dependency will be chosen</strong> when multiple versions are encountered as dependencies. By default, Maven picks the ‚Äúnearest definition‚Äù. That is, it uses the version of the closest dependency to your project in the tree of dependencies. </p>
<p>However, you can always guarantee a version by declaring it <strong>explicitly in your project‚Äôs <code>POM</code></strong> (see section <a href="#Using-External-Dependency">Using External Dependency</a>). You basically need to add the following to your <code>POM</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;com.mycompany.app&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;myDependency&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;version&gt;aSpecificVersion&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;scope&gt;compile&lt;&#x2F;scope&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>
<p>Or, you could use the <a href="#Dependency-Management">Dependency Management</a> in the section below.</p>
<p><a name="Dependency-Management"></a></p>
<h2 id="Dependency-Management"><a href="#Dependency-Management" class="headerlink" title="Dependency Management"></a>Dependency Management</h2><p>The dependency management section is a mechanism for <strong>centralizing dependency information</strong>. When you have a set of projects that inherit from a common parent, it‚Äôs possible to put all information about the dependency in the common POM and have simpler references to the artifacts in the child POMs.</p>
<ol>
<li>For example, you could use it to control the <strong>versions of the artifacts in a set of dependencies</strong>:</li>
</ol>
<p>If you have a parent Project A and child Project B:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"># Project A</span><br><span class="line">&lt;project&gt;</span><br><span class="line"> &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"> &lt;groupId&gt;maven&lt;&#x2F;groupId&gt;</span><br><span class="line"> &lt;artifactId&gt;A&lt;&#x2F;artifactId&gt;</span><br><span class="line"> &lt;packaging&gt;pom&lt;&#x2F;packaging&gt;</span><br><span class="line"> &lt;name&gt;A&lt;&#x2F;name&gt;</span><br><span class="line"> &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line"></span><br><span class="line"> &lt;dependencyManagement&gt;</span><br><span class="line">   &lt;dependencies&gt;</span><br><span class="line">     &lt;dependency&gt;</span><br><span class="line">       &lt;groupId&gt;test&lt;&#x2F;groupId&gt;</span><br><span class="line">       &lt;artifactId&gt;a&lt;&#x2F;artifactId&gt;</span><br><span class="line">       &lt;version&gt;1.2&lt;&#x2F;version&gt;</span><br><span class="line">     &lt;&#x2F;dependency&gt;</span><br><span class="line">     &lt;dependency&gt;</span><br><span class="line">       &lt;groupId&gt;test&lt;&#x2F;groupId&gt;</span><br><span class="line">       &lt;artifactId&gt;b&lt;&#x2F;artifactId&gt;</span><br><span class="line">       &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">       &lt;scope&gt;compile&lt;&#x2F;scope&gt;</span><br><span class="line">     &lt;&#x2F;dependency&gt;</span><br><span class="line">     &lt;dependency&gt;</span><br><span class="line">       &lt;groupId&gt;test&lt;&#x2F;groupId&gt;</span><br><span class="line">       &lt;artifactId&gt;c&lt;&#x2F;artifactId&gt;</span><br><span class="line">       &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">       &lt;scope&gt;compile&lt;&#x2F;scope&gt;</span><br><span class="line">     &lt;&#x2F;dependency&gt;</span><br><span class="line">     &lt;dependency&gt;</span><br><span class="line">       &lt;groupId&gt;test&lt;&#x2F;groupId&gt;</span><br><span class="line">       &lt;artifactId&gt;d&lt;&#x2F;artifactId&gt;</span><br><span class="line">       &lt;version&gt;1.2&lt;&#x2F;version&gt;</span><br><span class="line">     &lt;&#x2F;dependency&gt;</span><br><span class="line">   &lt;&#x2F;dependencies&gt;</span><br><span class="line"> &lt;&#x2F;dependencyManagement&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>
<p>at this point, if you have the following Project B configuration:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># Project B</span><br><span class="line">&lt;project&gt;</span><br><span class="line">  &lt;parent&gt;</span><br><span class="line">    &lt;artifactId&gt;A&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;groupId&gt;maven&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">  &lt;&#x2F;parent&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">  &lt;groupId&gt;maven&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;B&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;packaging&gt;pom&lt;&#x2F;packaging&gt;</span><br><span class="line">  &lt;name&gt;B&lt;&#x2F;name&gt;</span><br><span class="line">  &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;test&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;a&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;test&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;c&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">  &lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>
<p>Then version of artifact <code>a</code> and <code>c</code> would be <code>1.2</code> and <code>1.0</code>, respectively. </p>
<p>However, if you have the following configuration:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># Project B</span><br><span class="line">&lt;project&gt;</span><br><span class="line">  &lt;parent&gt;</span><br><span class="line">    &lt;artifactId&gt;A&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;groupId&gt;maven&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">  &lt;&#x2F;parent&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">  &lt;groupId&gt;maven&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;B&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;packaging&gt;pom&lt;&#x2F;packaging&gt;</span><br><span class="line">  &lt;name&gt;B&lt;&#x2F;name&gt;</span><br><span class="line">  &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;test&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;a&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;test&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;c&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">  &lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>
<p>Then you would have version of <code>1.0</code> for both <code>a</code> and <code>c</code>. Also, the <code>scope</code> of <code>a</code> would become <code>runtime</code></p>
<ol start="2">
<li>Now, consider reverse case where we have two children <code>POM</code>s, Project A and Project B, with the following configurations:</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># Project A:</span><br><span class="line"></span><br><span class="line">&lt;project&gt;</span><br><span class="line">  ...</span><br><span class="line">  &lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;group-a&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;artifact-a&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;exclusions&gt;</span><br><span class="line">        &lt;exclusion&gt;</span><br><span class="line">          &lt;groupId&gt;group-c&lt;&#x2F;groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;excluded-artifact&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;exclusion&gt;</span><br><span class="line">      &lt;&#x2F;exclusions&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;group-a&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;artifact-b&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;type&gt;bar&lt;&#x2F;type&gt;</span><br><span class="line">      &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">  &lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>
<p>and </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;project&gt;</span><br><span class="line">  ...</span><br><span class="line">  &lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;group-c&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;artifact-b&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;type&gt;war&lt;&#x2F;type&gt;</span><br><span class="line">      &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;group-a&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;artifact-b&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;type&gt;bar&lt;&#x2F;type&gt;</span><br><span class="line">      &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">  &lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>
<p>We see that these two example <code>POM</code>s <strong>share a common dependency (<code>group-a</code> artifact <code>artifact-b</code>)</strong> and each has one non-trivial dependency. This <strong>information can be put in the parent <code>POM</code></strong> like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"># created a parent POM</span><br><span class="line">&lt;project&gt;</span><br><span class="line">  ...</span><br><span class="line">  &lt;dependencyManagement&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;group-a&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;artifact-a&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line"> </span><br><span class="line">        &lt;exclusions&gt;</span><br><span class="line">          &lt;exclusion&gt;</span><br><span class="line">            &lt;groupId&gt;group-c&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;excluded-artifact&lt;&#x2F;artifactId&gt;</span><br><span class="line">          &lt;&#x2F;exclusion&gt;</span><br><span class="line">        &lt;&#x2F;exclusions&gt;</span><br><span class="line"> </span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line"> </span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;group-c&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;artifact-b&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;type&gt;war&lt;&#x2F;type&gt;</span><br><span class="line">        &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line"> </span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;group-a&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;artifact-b&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;type&gt;bar&lt;&#x2F;type&gt;</span><br><span class="line">        &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line">  &lt;&#x2F;dependencyManagement&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>
<p>Now, if the two children inherits the parent, we could simplify the children <code>POM</code>s:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># Project A</span><br><span class="line">&lt;project&gt;</span><br><span class="line">  ...</span><br><span class="line">  &lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;group-a&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;artifact-a&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;group-a&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;artifact-b&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;!-- This is not a jar dependency, so we must specify type. --&gt;</span><br><span class="line">      &lt;type&gt;bar&lt;&#x2F;type&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">  &lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>
<p>and </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># Project B</span><br><span class="line">&lt;project&gt;</span><br><span class="line">  ...</span><br><span class="line">  &lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;group-c&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;artifact-b&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;!-- This is not a jar dependency, so we must specify type. --&gt;</span><br><span class="line">      &lt;type&gt;war&lt;&#x2F;type&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;group-a&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;artifact-b&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;!-- This is not a jar dependency, so we must specify type. --&gt;</span><br><span class="line">      &lt;type&gt;bar&lt;&#x2F;type&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">  &lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ul>
<li><input disabled type="checkbox"> In two of these dependency references, we had to specify the <code>&lt;type&gt;</code> element. This is because the <strong>minimal set of information for matching a dependency reference against a <code>&lt;dependencyManagement&gt;</code> section is actually <code>{groupId, artifactId, type, classifier}</code></strong>. In many cases, these dependencies will refer to <strong><code>jar</code> artifacts with no classifier</strong>. <strong>This allows us to shorthand the identity set to <code>{groupId, artifactId}</code></strong>. However, in other cases, we would need to include the <code>&lt;type&gt;</code> element.</li>
</ul>
</blockquote>
<h2 id="Difference-between-using-lt-dependency-gt-and-lt-dependencyManagement-gt"><a href="#Difference-between-using-lt-dependency-gt-and-lt-dependencyManagement-gt" class="headerlink" title="Difference between using &lt;dependency&gt; and &lt;dependencyManagement&gt;"></a>Difference between using <code>&lt;dependency&gt;</code> and <code>&lt;dependencyManagement&gt;</code></h2><ul>
<li>if you use <code>&lt;dependencies&gt;</code> in the parent <code>pom</code> and specify all the dependencies your chlidren will need, this will<ul>
<li>create a shorter child poms, as technically you don‚Äôt need to specify them again, unless you want to override something, like the <code>version</code>.</li>
<li>it means that <strong>those dependencies will ALWAYS be defined for ALL the child modules</strong>. </li>
</ul>
</li>
<li>if you use <code>&lt;dependencyManagement&gt;</code> in the parent <code>POM</code>, this will<ul>
<li>allow you to chose <strong>which child modules will have a dependency specified in th parent</strong>. If nothing/no dependency is specified in the children <code>POM</code>, then no dependency will be ensued.</li>
</ul>
</li>
</ul>
<h2 id="Dependency-Scope"><a href="#Dependency-Scope" class="headerlink" title="Dependency Scope"></a>Dependency Scope</h2><p>Dependency scope is used to limit the transitivity of a dependency, and also to affect the classpath used for various build tasks.</p>
<p>There are <strong>6 scopes available</strong>:</p>
<ul>
<li><code>compile</code> <ul>
<li>This is the default scope, used if none is specified. <strong>Compile dependencies are available in all classpaths of a project</strong>. Furthermore, those dependencies are <strong>propagated to dependent projects</strong>.</li>
</ul>
</li>
<li><code>provided</code><ul>
<li>This is much like compile, but indicates you <strong>expect the JDK or a container to provide the dependency at runtime</strong>. For example, when building a web application for the Java Enterprise Edition, you would <strong>set the dependency on the Servlet API and related Java EE APIs to scope <code>provided</code></strong> because the <strong>web container provides those classes</strong>. This scope is only available on the compilation and test classpath, and is <strong>not transitive</strong>.</li>
</ul>
</li>
<li><code>runtime</code><ul>
<li>This scope indicates that the dependency is <strong>not required for compilation</strong>, but is <strong>for execution</strong>. It is in the runtime and test classpaths, but not the compile classpath.</li>
</ul>
</li>
<li><code>test</code><ul>
<li>This scope indicates that the dependency is not required for normal use of the application, and is <strong>only available for the test compilation and execution phases</strong>. This scope is <strong>not transitive</strong>.</li>
</ul>
</li>
<li><code>system</code><ul>
<li>This scope is <strong>similar to <code>provided</code> except that you have to provide the JAR which contains it explicitly</strong>. The artifact is <strong>always available and is not looked up in a repository</strong>.</li>
</ul>
</li>
<li><code>import</code><ul>
<li>This scope is only supported on a dependency of type <code>pom</code> in the <code>&lt;dependencyManagement&gt;</code> section (see <a href="#Dependency-Management">Depedency Management</a>). It indicates the <strong>dependency to be replaced with the effective list of dependencies in the specified POM‚Äôs <code>&lt;dependencyManagement&gt;</code> section</strong>. Since they are replaced, dependencies with a scope of import do not actually participate in limiting the transitivity of a dependency.</li>
</ul>
</li>
</ul>
<p>However, each of the scopes (except for <code>import</code>) <strong>affects transitive dependencies in different ways</strong>, as is demonstrated in the table below. </p>
<p>If a <strong>parent dependency</strong> is set to the scope in the <strong>left column</strong>, <strong>transitive dependencies of the child dependency</strong> with the <strong>scope across the top row</strong> <strong>will result in a dependency in the main project with the scope listed at the intersection</strong>. If no scope is listed, it means the dependency will be omitted.</p>
<table>
<thead>
<tr>
<th>-</th>
<th>compile</th>
<th>provided</th>
<th>runtime</th>
<th>test</th>
</tr>
</thead>
<tbody><tr>
<td><strong>compile</strong></td>
<td>compile(*)</td>
<td>-</td>
<td>runtime</td>
<td>-</td>
</tr>
<tr>
<td><strong>provided</strong></td>
<td>provided</td>
<td>-</td>
<td>provided</td>
<td>-</td>
</tr>
<tr>
<td><strong>runtime</strong></td>
<td>runtime</td>
<td>-</td>
<td>runtime</td>
<td>-</td>
</tr>
<tr>
<td><strong>test</strong></td>
<td>test</td>
<td>-</td>
<td>test</td>
<td>-</td>
</tr>
</tbody></table>
<h2 id="Importing-Dependencies"><a href="#Importing-Dependencies" class="headerlink" title="Importing Dependencies"></a>Importing Dependencies</h2><p>The examples in the previous section describe how to specify managed dependencies through inheritance. However, in larger projects it may be impossible to accomplish this <strong>since a project can only inherit from a single parent</strong>. To accommodate this, projects can <strong>import managed dependencies from other projects</strong>. This is accomplished by declaring a <code>pom</code> artifact as a dependency with a scope of <code>import</code>.</p>
<p>Consider the case of a <code>POM</code> file:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># Project X</span><br><span class="line">&lt;project&gt;</span><br><span class="line"> &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"> &lt;groupId&gt;maven&lt;&#x2F;groupId&gt;</span><br><span class="line"> &lt;artifactId&gt;X&lt;&#x2F;artifactId&gt;</span><br><span class="line"> &lt;packaging&gt;pom&lt;&#x2F;packaging&gt;</span><br><span class="line"> &lt;name&gt;X&lt;&#x2F;name&gt;</span><br><span class="line"> &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line"> </span><br><span class="line"> &lt;dependencyManagement&gt;</span><br><span class="line">   &lt;dependencies&gt;</span><br><span class="line">     &lt;dependency&gt;</span><br><span class="line">       &lt;groupId&gt;test&lt;&#x2F;groupId&gt;</span><br><span class="line">       &lt;artifactId&gt;a&lt;&#x2F;artifactId&gt;</span><br><span class="line">       &lt;version&gt;1.1&lt;&#x2F;version&gt;</span><br><span class="line">     &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">     &lt;dependency&gt;</span><br><span class="line">       &lt;groupId&gt;test&lt;&#x2F;groupId&gt;</span><br><span class="line">       &lt;artifactId&gt;b&lt;&#x2F;artifactId&gt;</span><br><span class="line">       &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">       &lt;scope&gt;compile&lt;&#x2F;scope&gt;</span><br><span class="line">     &lt;&#x2F;dependency&gt;</span><br><span class="line">   &lt;&#x2F;dependencies&gt;</span><br><span class="line"> &lt;&#x2F;dependencyManagement&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Then if you would like another project that is not its child to have the <strong><code>&lt;dependencyManagement&gt;</code> configured the same way</strong>, then you would do this:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;project&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">    &lt;groupId&gt;com.sample&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;project1&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;packaging&gt;jar&lt;&#x2F;packaging&gt;</span><br><span class="line"></span><br><span class="line">	&lt;dependencyManagement&gt;</span><br><span class="line">	        &lt;dependencies&gt;</span><br><span class="line">	            &lt;!-- Imports the bill-of-materials POM. --&gt;</span><br><span class="line">	            &lt;dependency&gt;</span><br><span class="line">	                &lt;groupId&gt;maven&lt;&#x2F;groupId&gt;</span><br><span class="line">	                &lt;artifactId&gt;X&lt;&#x2F;artifactId&gt;</span><br><span class="line">	                &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">	                &lt;type&gt;pom&lt;&#x2F;type&gt;</span><br><span class="line">	                &lt;scope&gt;import&lt;&#x2F;scope&gt;</span><br><span class="line">	            &lt;&#x2F;dependency&gt;</span><br><span class="line">	        &lt;&#x2F;dependencies&gt;</span><br><span class="line">	&lt;&#x2F;dependencyManagement&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>If you would like that project to <strong>use the <code>&lt;dependencies&gt;</code> directly</strong> that is specified in the configurations of Project X, then you would do this:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;project&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">    &lt;groupId&gt;com.sample&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;project1&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;packaging&gt;jar&lt;&#x2F;packaging&gt;</span><br><span class="line"></span><br><span class="line">	&lt;dependencyManagement&gt;</span><br><span class="line">	        &lt;dependencies&gt;</span><br><span class="line">	            &lt;!-- Imports the bill-of-materials POM. --&gt;</span><br><span class="line">	            &lt;dependency&gt;</span><br><span class="line">	                &lt;groupId&gt;maven&lt;&#x2F;groupId&gt;</span><br><span class="line">	                &lt;artifactId&gt;X&lt;&#x2F;artifactId&gt;</span><br><span class="line">	                &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">	                &lt;type&gt;pom&lt;&#x2F;type&gt;</span><br><span class="line">	                &lt;scope&gt;import&lt;&#x2F;scope&gt;</span><br><span class="line">	            &lt;&#x2F;dependency&gt;</span><br><span class="line">	        &lt;&#x2F;dependencies&gt;</span><br><span class="line">	&lt;&#x2F;dependencyManagement&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;!-- Add a dependency from the BOM POM.</span><br><span class="line">        Note: no version or scope is required, it&#39;s inherited from the BOM POM! --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;test&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;a&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/05/22/Apache-Manual-md/" data-id="ckai5yba00000ssorfsxh613e" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/06/15/Go-Manual/">Go Manual</a>
          </li>
        
          <li>
            <a href="/2020/06/09/Spring-Framework-Guide/">Spring Framework Guide</a>
          </li>
        
          <li>
            <a href="/2020/06/09/SpringBoot-Manual/">Spring Boot Manual</a>
          </li>
        
          <li>
            <a href="/2020/06/02/Redis-Manual/">Redis Manual</a>
          </li>
        
          <li>
            <a href="/2020/05/26/MySQL-Manual/">MySQL Manual</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Xiao Yu<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>