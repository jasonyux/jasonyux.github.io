<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>COMS3157 Advanced Programming | Lecture Notes</title>
<meta name="generator" content="Jekyll v4.3.1" />
<meta property="og:title" content="COMS3157 Advanced Programming" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="An inexhaustive collection of markdown/latex(PDF) notes that I took since college." />
<meta property="og:description" content="An inexhaustive collection of markdown/latex(PDF) notes that I took since college." />
<link rel="canonical" href="/lectures/2020@columbia/COMS3157_Advanced_Programming.html/" />
<meta property="og:url" content="/lectures/2020@columbia/COMS3157_Advanced_Programming.html/" />
<meta property="og:site_name" content="Lecture Notes" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-12-11T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="COMS3157 Advanced Programming" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2020-12-11T00:00:00+00:00","datePublished":"2020-12-11T00:00:00+00:00","description":"An inexhaustive collection of markdown/latex(PDF) notes that I took since college.","headline":"COMS3157 Advanced Programming","mainEntityOfPage":{"@type":"WebPage","@id":"/lectures/2020@columbia/COMS3157_Advanced_Programming.html/"},"url":"/lectures/2020@columbia/COMS3157_Advanced_Programming.html/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/lectures/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/lectures/feed.xml" title="Lecture Notes" /></head>
<body><header class="site-header">

	<div class="wrapper"><a class="site-title" rel="author" href="/lectures/">Lecture Notes</a>

		<nav class="site-nav">
			<input type="checkbox" id="nav-trigger" class="nav-trigger" />
			<label for="nav-trigger">
			<span class="menu-icon">
				<svg viewBox="0 0 18 15" width="18px" height="15px">
				<path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
				</svg>
			</span>
			</label>

			<div class="trigger">
				<a class="page-link" href="/">Home</a>
				<a class="page-link" href="/projects">Projects</a>
				<a class="page-link" href="/research">Research</a>
				<span class="page-link" href="#">[Education]</span>
				<a class="page-link" href="/learning">Blog</a>
			</div>
		</nav>
	</div>
  </header><main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <head>
  <script>
    MathJax = {
      // 
      loader: {
        load: ['[tex]/ams', '[tex]/textmacros', '[tex]/boldsymbol']
      },
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        packages: {'[+]': ['ams', 'textmacros', 'boldsymbol']}
      }
    };
  </script>
  <script id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
  </script>
  </head>
  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">COMS3157 Advanced Programming</h1>
    <p class="post-meta"><time class="dt-published" datetime="2020-12-11T00:00:00+00:00" itemprop="datePublished">
        Dec 11, 2020
      </time></p>
  </header>

  <div class="section-nav" id="toc-all">
    <button type="button" id="toc-close" class="toc_collapsible hidden" title="collapse">
      <span><strong>Table of Contents</strong></span>
    </button>
    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" mirror-in-rtl="true" fill="#000000" style="width: 18px;" id="toc-reopen" class="toc_collapsible">
      <g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <circle fill="#494c4e" cx="2" cy="2" r="2"></circle> <circle fill="#494c4e" cx="2" cy="8" r="2"></circle> <circle fill="#494c4e" cx="2" cy="20" r="2"></circle> <circle fill="#494c4e" cx="2" cy="14" r="2"></circle> <path fill="#494c4e" d="M23.002 3H7.998C7.448 3 7 2.55 7 2.002v-.004c0-.55.45-.998.998-.998H23c.55 0 1 .45 1 .998V2c0 .55-.45 1-.998 1zM23.002 9H7.998C7.448 9 7 8.55 7 8.002v-.004c0-.55.45-.998.998-.998H23c.55 0 1 .45 1 .998V8c0 .55-.45 1-.998 1zM23.002 15H7.998c-.55 0-.998-.45-.998-.998V14c0-.55.45-1 .998-1H23c.55 0 1 .45 1 .998V14c0 .55-.45 1-.998 1zM23.002 21H7.998c-.55 0-.998-.45-.998-.998V20c0-.55.45-1 .998-1H23c.55 0 1 .45 1 .998V20c0 .55-.45 1-.998 1z"></path> </g>
    </svg>
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h1"><a href="#logistics">Logistics</a></li>
<li class="toc-entry toc-h1"><a href="#week-1">Week 1</a>
<ul>
<li class="toc-entry toc-h2"><a href="#unix-cli-basics">UNIX CLI Basics</a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#week-2">Week 2</a>
<ul>
<li class="toc-entry toc-h2"><a href="#compiling-and-linking">Compiling and Linking</a>
<ul>
<li class="toc-entry toc-h3"><a href="#linking">Linking</a>
<ul>
<li class="toc-entry toc-h4"><a href="#declaring-a-prototype">Declaring a Prototype</a></li>
<li class="toc-entry toc-h4"><a href="#include">#include</a></li>
<li class="toc-entry toc-h4"><a href="#header-file">Header File</a></li>
<li class="toc-entry toc-h4"><a href="#standard-library">Standard Library</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#compiling">Compiling</a>
<ul>
<li class="toc-entry toc-h4"><a href="#linking-problem">Linking Problem</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#makefile">Makefile</a>
<ul>
<li class="toc-entry toc-h3"><a href="#simple-example">Simple Example</a></li>
<li class="toc-entry toc-h3"><a href="#making-multiple-targets">Making Multiple Targets</a></li>
<li class="toc-entry toc-h3"><a href="#managing-dependencies">Managing Dependencies</a></li>
<li class="toc-entry toc-h3"><a href="#variables">Variables</a></li>
<li class="toc-entry toc-h3"><a href="#phony">.PHONY</a></li>
<li class="toc-entry toc-h3"><a href="#full-example">Full Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#week-3">Week 3</a>
<ul>
<li class="toc-entry toc-h2"><a href="#-in-c"># in C</a>
<ul>
<li class="toc-entry toc-h3"><a href="#define">#define</a></li>
<li class="toc-entry toc-h3"><a href="#ifdefifndefelseendif">#ifdef/#ifndef/#else/#endif</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#data-types-in-c">Data Types in C</a>
<ul>
<li class="toc-entry toc-h3"><a href="#single-quote-vs-double-quote">Single Quote vs Double Quote</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#expression">Expression</a></li>
<li class="toc-entry toc-h2"><a href="#statement">Statement</a>
<ul>
<li class="toc-entry toc-h3"><a href="#exam-note">Exam Note</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#operators-in-c">Operators in C</a>
<ul>
<li class="toc-entry toc-h3"><a href="#">==</a></li>
<li class="toc-entry toc-h3"><a href="#bitwise-operators-in-c">Bitwise Operators in C</a>
<ul>
<li class="toc-entry toc-h4"><a href="#-and-">&amp; and |</a></li>
<li class="toc-entry toc-h4"><a href="#-and--1">&lt;&lt; and &gt;&gt;</a></li>
<li class="toc-entry toc-h4"><a href="#-1">~</a></li>
<li class="toc-entry toc-h4"><a href="#sample-combinations">Sample Combinations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#operator-associativity">Operator Associativity</a></li>
<li class="toc-entry toc-h2"><a href="#variable-scope">Variable Scope</a>
<ul>
<li class="toc-entry toc-h3"><a href="#local-variable">Local Variable</a></li>
<li class="toc-entry toc-h3"><a href="#static-variable">Static Variable</a>
<ul>
<li class="toc-entry toc-h4"><a href="#global-static-variable">Global Static Variable</a></li>
<li class="toc-entry toc-h4"><a href="#file-static-variable">File Static Variable</a></li>
<li class="toc-entry toc-h4"><a href="#function-static-variable">Function Static Variable</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#week-4">Week 4</a>
<ul>
<li class="toc-entry toc-h2"><a href="#process-address-space">Process Address Space</a>
<ul>
<li class="toc-entry toc-h3"><a href="#virtual-memory-vs-physical-memory">Virtual Memory vs Physical Memory</a></li>
<li class="toc-entry toc-h3"><a href="#stack-vs-heap">Stack vs Heap</a></li>
<li class="toc-entry toc-h3"><a href="#hierarchy-example">Hierarchy Example</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#pointers">Pointers</a>
<ul>
<li class="toc-entry toc-h3"><a href="#related-operators">Related Operators</a></li>
<li class="toc-entry toc-h3"><a href="#pointer-data-type">Pointer Data Type</a></li>
<li class="toc-entry toc-h3"><a href="#pointers-and-function-arguments">Pointers and Function Arguments</a></li>
<li class="toc-entry toc-h3"><a href="#doublenested-pointers">Double/Nested Pointers</a></li>
<li class="toc-entry toc-h3"><a href="#generic-pointer">Generic Pointer</a></li>
<li class="toc-entry toc-h3"><a href="#null-pointer">Null Pointer</a></li>
<li class="toc-entry toc-h3"><a href="#pointers-to-tf">Pointers to T/F</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#sizeof">sizeof</a></li>
<li class="toc-entry toc-h2"><a href="#pointer-arithmetic">Pointer Arithmetic</a>
<ul>
<li class="toc-entry toc-h3"><a href="#adding-and-subtracting-pointers">Adding and Subtracting Pointers</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#arrays">Arrays</a>
<ul>
<li class="toc-entry toc-h3"><a href="#pointing-to-an-array">“Pointing” to an Array</a></li>
<li class="toc-entry toc-h3"><a href="#automatic-type-conversion-of-array">Automatic Type Conversion of Array</a></li>
<li class="toc-entry toc-h3"><a href="#passing-array-into-functions">Passing Array into Functions</a></li>
<li class="toc-entry toc-h3"><a href="#grand-unified-theory-of-arrays">Grand Unified Theory of Arrays</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#heap">Heap</a></li>
<li class="toc-entry toc-h2"><a href="#string">String</a>
<ul>
<li class="toc-entry toc-h3"><a href="#empty-string">Empty String</a></li>
<li class="toc-entry toc-h3"><a href="#example-string-copy">Example: String Copy</a>
<ul>
<li class="toc-entry toc-h4"><a href="#safer-string-copy">Safer String Copy</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#example-string-concat">Example: String Concat</a>
<ul>
<li class="toc-entry toc-h4"><a href="#safer-string-concat">Safer String Concat</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#command-line-arguments">Command Line Arguments</a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#week-5">Week 5</a>
<ul>
<li class="toc-entry toc-h2"><a href="#const">const</a></li>
<li class="toc-entry toc-h2"><a href="#pointers-to-functions">Pointers to Functions</a>
<ul>
<li class="toc-entry toc-h3"><a href="#parsing-a-pointer-function">Parsing a Pointer Function</a></li>
<li class="toc-entry toc-h3"><a href="#using-a-function-pointer">Using a Function Pointer</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#inline-functions">inline Functions</a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#week-6">Week 6</a>
<ul>
<li class="toc-entry toc-h2"><a href="#struct">struct</a>
<ul>
<li class="toc-entry toc-h3"><a href="#inside-struct">Inside struct</a></li>
<li class="toc-entry toc-h3"><a href="#struct-variables">struct variables</a></li>
<li class="toc-entry toc-h3"><a href="#example-linkedlist">Example: LinkedList</a>
<ul>
<li class="toc-entry toc-h4"><a href="#createnode">createNode()</a></li>
<li class="toc-entry toc-h4"><a href="#assert">assert()</a></li>
<li class="toc-entry toc-h4"><a href="#create2nodes">create2Nodes()</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#struct-as-value">struct as Value</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#exam-notes">Exam Notes</a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#week-7">Week 7</a>
<ul>
<li class="toc-entry toc-h2"><a href="#standard-io">Standard IO</a>
<ul>
<li class="toc-entry toc-h3"><a href="#redirection">Redirection</a>
<ul>
<li class="toc-entry toc-h4"><a href="#redirecting-valgrind">Redirecting Valgrind</a></li>
<li class="toc-entry toc-h4"><a href="#perror">perror</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#pipeline">Pipeline</a>
<ul>
<li class="toc-entry toc-h4"><a href="#tail">Tail</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#file-io">File IO</a>
<ul>
<li class="toc-entry toc-h3"><a href="#ncat">ncat</a></li>
<li class="toc-entry toc-h3"><a href="#fopen">fopen</a></li>
<li class="toc-entry toc-h3"><a href="#opaque-handle">Opaque Handle</a></li>
<li class="toc-entry toc-h3"><a href="#fgets">fgets()</a></li>
<li class="toc-entry toc-h3"><a href="#fputs">fputs()</a></li>
<li class="toc-entry toc-h3"><a href="#fclose">fclose()</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#week-8">Week 8</a>
<ul>
<li class="toc-entry toc-h2"><a href="#formatted-io">Formatted IO</a>
<ul>
<li class="toc-entry toc-h3"><a href="#sscanf">sscanf()</a></li>
<li class="toc-entry toc-h3"><a href="#sprintf">sprintf()</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#buffering-on-io">Buffering on IO</a>
<ul>
<li class="toc-entry toc-h3"><a href="#flushing-buffer">Flushing Buffer</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#standard-io-for-binary-files">Standard IO for Binary Files</a>
<ul>
<li class="toc-entry toc-h3"><a href="#opening-binary-files">Opening Binary Files</a></li>
<li class="toc-entry toc-h3"><a href="#writing-to-binary-files">Writing to Binary Files</a></li>
<li class="toc-entry toc-h3"><a href="#reading-from-binary-files">Reading from Binary Files</a></li>
<li class="toc-entry toc-h3"><a href="#positioning-in-the-file">Positioning in the File</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#week-9">Week 9</a>
<ul>
<li class="toc-entry toc-h2"><a href="#numeric-ids-in-unix">Numeric IDs in UNIX</a></li>
<li class="toc-entry toc-h2"><a href="#fork">fork()</a></li>
<li class="toc-entry toc-h2"><a href="#shell">shell</a>
<ul>
<li class="toc-entry toc-h3"><a href="#execl">execl</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#week-10">Week 10</a>
<ul>
<li class="toc-entry toc-h2"><a href="#netcat">netcat</a>
<ul>
<li class="toc-entry toc-h3"><a href="#connecting-devices-to-a-program">Connecting devices to a Program</a></li>
<li class="toc-entry toc-h3"><a href="#named-pipe">Named Pipe</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#internet">Internet</a>
<ul>
<li class="toc-entry toc-h3"><a href="#osi-model">OSI Model</a>
<ul>
<li class="toc-entry toc-h4"><a href="#application-layer">Application Layer</a></li>
<li class="toc-entry toc-h4"><a href="#transport-layer">Transport Layer</a></li>
<li class="toc-entry toc-h4"><a href="#network-layer">Network Layer</a></li>
<li class="toc-entry toc-h4"><a href="#data-link-layer">(Data) Link Layer</a>
<ul>
<li class="toc-entry toc-h5"><a href="#ethernet-frame">Ethernet Frame</a></li>
<li class="toc-entry toc-h5"><a href="#mac-address">MAC Address</a></li>
</ul>
</li>
<li class="toc-entry toc-h4"><a href="#physical-layer">Physical Layer</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#shell-scripts">Shell Scripts</a>
<ul>
<li class="toc-entry toc-h3"><a href="#terminologies">Terminologies</a></li>
<li class="toc-entry toc-h3"><a href="#writing-a-shell-script">Writing a Shell Script</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#file-permissions">File Permissions</a>
<ul>
<li class="toc-entry toc-h3"><a href="#s-permission">s Permission</a></li>
<li class="toc-entry toc-h3"><a href="#binary-encoding-of-file-permissions">Binary Encoding of File Permissions</a></li>
<li class="toc-entry toc-h3"><a href="#changing-permission">Changing Permission</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#file-descriptors">File Descriptors</a></li>
<li class="toc-entry toc-h2"><a href="#endianness">Endianness</a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#week-11">Week 11</a>
<ul>
<li class="toc-entry toc-h2"><a href="#socket-api">Socket API</a>
<ul>
<li class="toc-entry toc-h3"><a href="#socket">Socket</a></li>
<li class="toc-entry toc-h3"><a href="#socket-api-summary">Socket API Summary</a>
<ul>
<li class="toc-entry toc-h4"><a href="#socket-1">socket()</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#listening-socket-vs-connected-socket">Listening Socket vs Connected Socket</a></li>
<li class="toc-entry toc-h3"><a href="#socket-api-examples">Socket API Examples</a>
<ul>
<li class="toc-entry toc-h4"><a href="#tcp-echo-client">tcp-echo-client</a></li>
<li class="toc-entry toc-h4"><a href="#tcp-echo-server">tcp-echo-server</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#week-12">Week 12</a>
<ul>
<li class="toc-entry toc-h2"><a href="#http">HTTP</a>
<ul>
<li class="toc-entry toc-h3"><a href="#imitating-http-using-netcat">Imitating HTTP using netcat</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#week-13">Week 13</a>
<ul>
<li class="toc-entry toc-h2"><a href="#socket-api-continued">Socket API (Continued)</a>
<ul>
<li class="toc-entry toc-h3"><a href="#tcp-sender">tcp-sender</a></li>
<li class="toc-entry toc-h3"><a href="#tcp-recver">tcp-recver</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#dynamic-html">Dynamic HTML</a>
<ul>
<li class="toc-entry toc-h3"><a href="#3-tier-architecture">3-Tier Architecture</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#week-14">Week 14</a>
<ul>
<li class="toc-entry toc-h2"><a href="#from-c-to-c">From C to C++</a>
<ul>
<li class="toc-entry toc-h3"><a href="#changes-in-c">Changes in C++</a></li>
<li class="toc-entry toc-h3"><a href="#methods-and-constructors">Methods and Constructors</a></li>
<li class="toc-entry toc-h3"><a href="#difference-between-c-and-java">Difference between C++ and Java</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#miscellaneous">Miscellaneous</a>
<ul>
<li class="toc-entry toc-h2"><a href="#using-sftp">Using sftp</a></li>
<li class="toc-entry toc-h2"><a href="#gcd-with-euclidean-algorithm">GCD with Euclidean Algorithm</a>
<ul>
<li class="toc-entry toc-h3"><a href="#algorithm">Algorithm</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#useful-git-commands">Useful Git Commands</a></li>
<li class="toc-entry toc-h2"><a href="#valgrind">valgrind</a></li>
<li class="toc-entry toc-h2"><a href="#sed">sed</a></li>
<li class="toc-entry toc-h2"><a href="#making-own-library">Making Own Library</a></li>
<li class="toc-entry toc-h2"><a href="#cut">cut</a></li>
<li class="toc-entry toc-h2"><a href="#sort">sort</a></li>
<li class="toc-entry toc-h2"><a href="#uniq">uniq</a></li>
<li class="toc-entry toc-h2"><a href="#wget">wget</a></li>
<li class="toc-entry toc-h2"><a href="#cmp">cmp</a></li>
<li class="toc-entry toc-h2"><a href="#rsync">rsync</a></li>
</ul>
</li>
</ul>
  </div>

  <div class="post-content e-content" itemprop="articleBody">
    <style type="text/css">@page { margin-left: 2in; margin-right: -0.25in; }</style>

<h1 id="logistics">Logistics</h1>

<ul>
  <li>
    <p>Office hours:</p>

    <ul>
      <li><a href="http://bit.ly/jae-cal">Jae’s office hours</a></li>
      <li><a href="http://bit.ly/3157-cal">TA office hours</a>
        <ul>
          <li>https://calendar.google.com/calendar/u/0/embed?src=75136mi2i4kn31s4ullcc2dtio@group.calendar.google.com&amp;ctz=America/New_York&amp;pli=1</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p>Four <strong>online</strong> but <strong>synchronous</strong> exams</p>

    <ul>
      <li><strong>Thu 10/15, 4:10pm</strong>: Exam 1</li>
      <li><strong>Thu 10/29, 4:10pm</strong>: Exam 2</li>
      <li><strong>Thu 11/19, 4:10pm</strong>: Exam 3</li>
      <li><strong>Tue 12/8, 4:10pm</strong>: Exam 4</li>
      <li>No final exam</li>
    </ul>

    <p><strong>There are no make-up or alternate exams.</strong> If you cannot make any of those exams, please take the course next semester.</p>
  </li>
</ul>

<p>For more details on logistics, see http://www.cs.columbia.edu/~jae/3157/files/00-overview.pdf?asof=20200908</p>

<p>In general, see http://www.cs.columbia.edu/~jae/3157/</p>

<ul>
  <li>ListServ emails
    <ul>
      <li>[cs3157]
        <ul>
          <li>all emails will have this tag</li>
        </ul>
      </li>
      <li>[ANN]
        <ul>
          <li>important announcements</li>
        </ul>
      </li>
      <li>[LABn]
        <ul>
          <li>information relevant to a particular lab</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h1 id="week-1">Week 1</h1>

<h2 id="unix-cli-basics">UNIX CLI Basics</h2>

<ul>
  <li>First, we need to know that labs are <strong>finally submitted to a server</strong> hosted by google, which is called CLAC by AP
    <ul>
      <li>this means that you probably need to SSH/SSH client</li>
      <li><code class="language-plaintext highlighter-rouge">ssh -X  youraccount</code>
        <ul>
          <li>the <code class="language-plaintext highlighter-rouge">-X</code> means x-forwarding, which means displaying GUI on your machine but runs in the server</li>
          <li>see more with the file Linux Programming Environment</li>
        </ul>
      </li>
      <li>before the account of the above is delivered to you, you can try <strong>using the <code class="language-plaintext highlighter-rouge">cunix</code> account which Columbia delivers to every student</strong>
        <ul>
          <li><code class="language-plaintext highlighter-rouge">ssh xy2437@cunix.columbia.edu</code>
            <ul>
              <li>password would be the same as UNI’s password</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Commands Inputs</th>
      <th style="text-align: center">Sample Outputs</th>
      <th style="text-align: center">Meaning</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">pwd</code></td>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">/</code> means root directory; the following <code class="language-plaintext highlighter-rouge">/</code> are only separators; <code class="language-plaintext highlighter-rouge">~</code> mean <strong>home directory</strong>, which is <strong><em>different</em></strong> from root directory</td>
      <td style="text-align: center">shows current absolute path</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">ls -p</code></td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">list the file/folders, appending <code class="language-plaintext highlighter-rouge">/</code> if it is a folder</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">ls -F</code></td>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">firstProject/   patchedProject/   test.txt  'vim commands.txt'</code></td>
      <td style="text-align: center">slightly different than above</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">ls -F -l</code> or <code class="language-plaintext highlighter-rouge">ls -Fl</code></td>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">drwxr-xr-x 3 jasonyux jasonyux 4096 Sep 10 21:20  firstProject/</code></td>
      <td style="text-align: center">shows long format, including permissions</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">ls -a</code></td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">list <strong>all files</strong>, even hidden</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">cd</code>; same as <code class="language-plaintext highlighter-rouge">cd ~</code></td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">go to your home directory</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">alias ll='ls -alF'</code></td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">this is used to setup ‘shortcuts’. However, those aliases will be forgotten once you close the terminals. Therefore, you need to automatically do it using the file <code class="language-plaintext highlighter-rouge">.bashrc</code></td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">cp &lt;originFile&gt; &lt;targetFile&gt;</code></td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">copies the original file to another file called <code class="language-plaintext highlighter-rouge">targetFile</code></td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">vimtutor</code></td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">looks at the vim tutorial file</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">diff &lt;file1&gt; &lt;file2&gt;</code></td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">computes the difference between two TEXT files</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">cmp &lt;file1&gt; &lt;file2&gt;</code></td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">computes the difference between two files, including a BINARY file</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">Ctrl+r</code></td>
      <td style="text-align: center">then type <code class="language-plaintext highlighter-rouge">something</code></td>
      <td style="text-align: center">search in your command history that contains the string <code class="language-plaintext highlighter-rouge">something</code></td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">locate &lt;someFileName&gt;</code></td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">search in your computer for that file</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">cat -tn</code></td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">cat</code>, but replaces <code class="language-plaintext highlighter-rouge">\t</code> tab characters explicitly with <code class="language-plaintext highlighter-rouge">^I</code>, and show line numbers</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p>Note:</p>

  <ul>
    <li><code class="language-plaintext highlighter-rouge">.xxx</code>, or called dot files, have the convention to be not visible with <code class="language-plaintext highlighter-rouge">ls</code>, unless you specify <code class="language-plaintext highlighter-rouge">-a</code>
      <ul>
        <li>this is a convention initiated from the UNIX system</li>
      </ul>
    </li>
    <li>UNIX refers to the operating system that <strong>comes from UNIX</strong>, for example LINUX and MacOS.</li>
  </ul>
</blockquote>

<h1 id="week-2">Week 2</h1>

<p>First, our simple program</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"hello, world</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>	<span class="c1">// exit code = convention that things went well</span>
<span class="p">}</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>we do <strong>NOT</strong> need a class</li>
</ul>

<h2 id="compiling-and-linking">Compiling and Linking</h2>

<p>If you compile a program with</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gcc &lt;somefile&gt;.c
</code></pre></div></div>

<p>the default output is <code class="language-plaintext highlighter-rouge">a.out</code></p>

<ul>
  <li>unless you specify <code class="language-plaintext highlighter-rouge">-o &lt;outputFileName&gt;.out</code></li>
</ul>

<p>Then, to run the <code class="language-plaintext highlighter-rouge">.out</code> program, you need to:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./&lt;filename&gt;.out
</code></pre></div></div>

<p>because:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">UNIX</code> by defaults looks at your system path variable for executables. The executable under the current directory is not added to path, hence need to specify <strong>full path of that executable</strong>
    <ul>
      <li>The <strong>PATH variable</strong> is an <strong>environment variable</strong> that contains an ordered list of <strong><em>paths that Unix will search for executables when running a command</em></strong>. Using these <strong>paths</strong> means that we do not have to specify an absolute <strong>path</strong> when running a command.</li>
    </ul>
  </li>
</ul>

<p><mark>Yet this is not a good practice, as `gcc` without any option does both compiling and linking</mark></p>

<p>The good practice is to:</p>

<ol>
  <li>
    <p><strong>Compile ONLY</strong></p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gcc <span class="nt">-c</span> &lt;yourFile&gt;.c
</code></pre></div>    </div>

    <p>where:</p>

    <ul>
      <li>you get a file with <code class="language-plaintext highlighter-rouge">.o</code>, which is an <strong>object file</strong>. This is not an executable</li>
    </ul>
  </li>
  <li>
    <p><strong>Linking</strong></p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gcc &lt;yourFile&gt;.o
</code></pre></div>    </div>

    <p>where:</p>

    <ul>
      <li>you are <strong>feeding in an object file</strong></li>
      <li>This still produces <code class="language-plaintext highlighter-rouge">a.out</code>
        <ul>
          <li>if you specify <code class="language-plaintext highlighter-rouge">-o &lt;someName&gt;</code>, you can change the name from <code class="language-plaintext highlighter-rouge">a.out</code> to <code class="language-plaintext highlighter-rouge">&lt;someName&gt;.out</code></li>
        </ul>
      </li>
    </ul>
  </li>
</ol>

<blockquote>
  <p><strong>Extension</strong></p>

  <ul>
    <li>An <strong>object file</strong> is the <strong><em>real output from the compilation phase. It’s mostly machine code</em></strong>, but has info that allows a linker to see what symbols are in it as well as symbols it requires in order to work. (For reference, “symbols” are basically names of global objects, functions, etc.)</li>
    <li>A <strong>linker</strong> takes all these object files and <strong>CAN combine them to form <em>one</em> executable</strong> (assuming that it can, ie: that there aren’t any duplicate or undefined symbols).</li>
  </ul>
</blockquote>

<h3 id="linking">Linking</h3>

<p>Now suppose you have two files:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">(){</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"hello, world</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Function in another file %d"</span><span class="p">,</span><span class="n">myAdd</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span><span class="mi">167</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div></div>

<p>and</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">myAdd</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">){</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>you can first:</p>

<ol>
  <li>Compile both of them with <code class="language-plaintext highlighter-rouge">gcc -c</code></li>
  <li><strong>Link both into one executable</strong>
    <ul>
      <li>what actually happens is:
        <ol>
          <li>the compiler checks, <strong>just by name</strong>, if the function <code class="language-plaintext highlighter-rouge">myAdd</code> is <strong>defined</strong>
            <ul>
              <li>the only place where <strong><em>link error can occur</em></strong></li>
            </ul>
          </li>
          <li><strong>concatenate/include</strong> that definition into the executable. Job done.</li>
        </ol>
      </li>
    </ul>
  </li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gcc &lt;file1&gt;.o &lt;file2&gt;.o <span class="nt">-o</span> &lt;someName&gt;
</code></pre></div></div>

<p>And in the end the executable runs.</p>

<h4 id="declaring-a-prototype">Declaring a Prototype</h4>

<p>You can specify, during <strong>compilation process</strong></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">-g</code>
    <ul>
      <li>generate and embed debug information</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">-Wall</code>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">-W</code> means show warning, and <code class="language-plaintext highlighter-rouge">-Wall</code> means show all warnings</li>
    </ul>
  </li>
</ul>

<p>Notice that the above compilation of an explicit function <code class="language-plaintext highlighter-rouge">myAdd()</code> gets complained:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hello.c:10:39: warning: implicit declaration of <span class="k">function</span> ‘myAdd’ <span class="o">[</span><span class="nt">-Wimplicit-function-declaration</span><span class="o">]</span>
   10 |  <span class="nb">printf</span><span class="o">(</span><span class="s2">"Function in another file %d"</span>,myAdd<span class="o">(</span>3000,167<span class="o">))</span><span class="p">;</span>
      |
</code></pre></div></div>

<p>This is fixed by <strong>declaring</strong> a <strong>prototype/signature of a function</strong></p>

<ul>
  <li>declaring $\neq$ defining, where as the latter actually <em>defines the functionality of a function</em>, the former just <em>declares the existence of a function</em></li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">myAdd</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">);</span>	<span class="c1">// the prototype</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">(){</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"hello, world</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Function in another file %d"</span><span class="p">,</span><span class="n">myAdd</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span><span class="mi">167</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div></div>

<p>But what about the function <code class="language-plaintext highlighter-rouge">printf()</code>, which has not been declared anywhere yet functions?</p>

<h4 id="include"><code class="language-plaintext highlighter-rouge">#include</code></h4>

<p>The line in the above example:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></code></pre></div></div>

<p>means:</p>

<ol>
  <li>tells the <strong>compiler</strong> to first <strong>find the file</strong> named <code class="language-plaintext highlighter-rouge">stdio.h</code>
    <ul>
      <li>the symbol <code class="language-plaintext highlighter-rouge">&lt;&gt;</code> refers to the system directory, which means search the file <code class="language-plaintext highlighter-rouge">stdio.h</code> in the system’s directory</li>
      <li>if you want to search in the current directory, use <code class="language-plaintext highlighter-rouge">""</code>.</li>
    </ul>
  </li>
  <li><strong>textual replace/include the content</strong> of that file at the position <code class="language-plaintext highlighter-rouge">#include</code> during the <strong><em>compilation stage</em></strong></li>
</ol>

<blockquote>
  <p>Note:</p>

  <ul class="task-list">
    <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />This has <strong><em>nothing to do with <code class="language-plaintext highlighter-rouge">import</code></em></strong> in languages such as Java.</li>
  </ul>
</blockquote>

<h4 id="header-file">Header File</h4>

<p>A header file is a file with extension <code class="language-plaintext highlighter-rouge">.h</code> which contains <strong>C function declarations and macro definitions</strong> to be shared between several source files.</p>

<ul>
  <li>it should <strong><em>not contain actual function definitions</em></strong>.</li>
</ul>

<p>For example, you can break the above <strong>two pieces of code</strong>:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">myAdd</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">);</span>	<span class="c1">// the prototype</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">(){</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"hello, world</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Function in another file %d"</span><span class="p">,</span><span class="n">myAdd</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span><span class="mi">167</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div></div>

<p>and</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">myAdd</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">){</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>into <strong>three pieces of codes</strong></p>

<ol>
  <li>
    <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span>   
<span class="cp">#include</span> <span class="cpf">"myadd.h"</span><span class="cp">
</span>   
<span class="kt">void</span> <span class="nf">main</span><span class="p">(){</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"hello, world</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Function in another file %d"</span><span class="p">,</span><span class="n">myAdd</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span><span class="mi">167</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">myAdd</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">);</span>	<span class="c1">// myadd.h</span>
</code></pre></div>    </div>
  </li>
  <li>
    <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">myAdd</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">){</span>	<span class="c1">// myadd.c</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ol>

<p>But still, then <code class="language-plaintext highlighter-rouge">printf</code> is only declared but not defined.</p>

<h4 id="standard-library">Standard Library</h4>

<p>Like Java, where some functions are within the standard library to be automatically <em>imported</em> in a class when needed, the <strong>compiler of C</strong> do the same job:</p>

<ul>
  <li>first, it looks at the functions declared but not defined</li>
  <li>then, it looks for those functions in its standard library <code class="language-plaintext highlighter-rouge">libc.a</code>
    <ul>
      <li>if that function is there, then <strong>link it automatically</strong> when linking with <code class="language-plaintext highlighter-rouge">gcc &lt;someFile&gt;.o -o &lt;outputFile&gt;</code></li>
      <li>if not, error</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>Note:</p>

  <ul class="task-list">
    <li class="task-list-item">
      <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Sometimes linking error might happen when the standard library for math functions (<code class="language-plaintext highlighter-rouge">libm.a</code>). In that case, you need to manually link it with</p>

      <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gcc &lt;someFile&gt;.o &lt;otherFile&gt;.o <span class="nt">-o</span> &lt;someName&gt; <span class="nt">-lm</span>
</code></pre></div>      </div>

      <p>where:</p>

      <ul>
        <li>
          <p>the <code class="language-plaintext highlighter-rouge">-l</code> stands for standard library</p>
        </li>
        <li>
          <p>the <code class="language-plaintext highlighter-rouge">m</code> stands for the <code class="language-plaintext highlighter-rouge">m</code> inside <code class="language-plaintext highlighter-rouge">libm.a</code></p>
        </li>
      </ul>
    </li>
  </ul>
</blockquote>

<h3 id="compiling">Compiling</h3>

<p>The stage of compilation has <strong><em>nothing</em> to do with checking if a specific content is <em>defined</em></strong>. It just cares if the <strong>syntax is correct</strong>, or if a <strong>specific function is <em>declared</em></strong>.</p>

<ol>
  <li>Checks if the <strong>methods are declared</strong> correctly
    <ul>
      <li>this includes first <strong>match the function by name</strong>
        <ul>
          <li>then, check number of parameter and return type</li>
          <li>this means you <strong><em>cannot</em> have functions of the <em>same name but with different number of parameters</em></strong></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong>If correct</strong>, replace those header files and compile.</li>
</ol>

<blockquote>
  <p><strong>Extension</strong></p>

  <ul>
    <li><strong>function</strong> overloading is a feature of a <strong>programming language</strong> that allows one to have many <strong>functions with same name</strong> but with <strong>different</strong> signatures. This feature is present in most of the Object Oriented Languages such as C++ and Java. But <strong>C (not Object Oriented Language) <em>doesn’t</em> support this feature</strong>.</li>
  </ul>
</blockquote>

<p>This means at the compilation stage, if you compile</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span>
<span class="cp">#include</span> <span class="cpf">"myadd.h"</span><span class="cp">
</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">(){</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"hello, world</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Function in another file %d"</span><span class="p">,</span><span class="n">myAdd</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span><span class="mi">167</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div></div>

<p>There will be no error, as at compilation stage, the two <code class="language-plaintext highlighter-rouge">#include</code> made sure that all functions are declared, <strong>even if you haven’t wrote the actual function <code class="language-plaintext highlighter-rouge">myadd(int x, int y)</code> anywhere.</strong></p>

<ul>
  <li>it is always up to the <strong><em>linking</em> stage to actually get things <em>defined</em></strong></li>
</ul>

<h4 id="linking-problem">Linking Problem</h4>

<p>The <code class="language-plaintext highlighter-rouge">gcc</code> compiler <strong>links</strong> the function <strong>only by name</strong>.</p>

<p>This means that it will <strong>match <em>declaration</em> and <em>definitions</em> in the following <em>successfully</em></strong>:</p>

<ol>
  <li>
    <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span>   
<span class="cp">#include</span> <span class="cpf">"myadd.h"</span><span class="cp">
</span>   
<span class="kt">void</span> <span class="nf">main</span><span class="p">(){</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"hello, world</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Function in another file %d"</span><span class="p">,</span><span class="n">myAdd</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span><span class="mi">167</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">myAdd</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span> <span class="kt">int</span> <span class="n">salt</span><span class="p">){</span>	<span class="c1">// myadd.c	// matches by name, even if argument does not</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">salt</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">myAdd</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">);</span>	<span class="c1">// myadd.h</span>
</code></pre></div>    </div>
  </li>
</ol>

<p>Therefore, if you <strong>compile each functions</strong>, they all work because technically there is <strong><em>no error for compilation.</em></strong></p>

<p><strong>Linking also works</strong> because linking only link by <strong><em>name</em></strong>.</p>

<p>If you actually run the executable, you will get erroneous results even if it runs.</p>

<p><mark>This is generally because you only made a **1-way contract**, the implementation of the `myadd.h` should also fill in the contract</mark></p>

<p><strong>Solution:</strong></p>

<ul>
  <li>
    <p>Change into:</p>

    <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">"myadd.h"</span><span class="cp">
</span>  
<span class="kt">int</span> <span class="nf">myAdd</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span> <span class="kt">int</span> <span class="n">salt</span><span class="p">){</span>	<span class="c1">// myadd.c</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">salt</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>    </div>

    <p>and a <strong>compilation error occurs</strong> because a compiler:</p>

    <ol>
      <li>see a match for the function name <code class="language-plaintext highlighter-rouge">myadd</code></li>
      <li>looks at its number of parameters, <strong>mismatch</strong></li>
      <li><strong>error</strong></li>
    </ol>
  </li>
</ul>

<h2 id="makefile">Makefile</h2>

<p>Basically a configurable shortcut to <strong>automate the compilation/linking process with <code class="language-plaintext highlighter-rouge">gcc</code>.</strong></p>

<p>This uses a <code class="language-plaintext highlighter-rouge">make</code> command.</p>

<ul>
  <li>
    <p>it looks for and parse the <strong>content in the file <code class="language-plaintext highlighter-rouge">Makefile</code></strong>, which contains instructions on how to compile and link</p>
  </li>
  <li>
    <p>similar to <code class="language-plaintext highlighter-rouge">docker-compose</code></p>
  </li>
</ul>

<p><strong>In general</strong>, the <code class="language-plaintext highlighter-rouge">Makefile</code> takes the following format:</p>

<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">&lt;targetFile&gt;</span><span class="o">:</span> <span class="nf">&lt;sourceFiles&gt; &lt;dependency&gt;</span>
		&lt;commands to execute&gt;

<span class="nl">&lt;targetFile2&gt;</span><span class="o">:</span> <span class="nf">&lt;sourceFiles2&gt; &lt;dependency&gt;</span>
		&lt;commands to execute&gt;
		
<span class="nl">.PHONY</span><span class="o">:</span> <span class="nf">&lt;target3&gt; &lt;target4&gt;</span>
<span class="nl">&lt;targte3&gt;</span><span class="o">:</span>
		&lt;commands to execute&gt;

<span class="nl">&lt;targte4&gt;</span><span class="o">:</span>
		&lt;commands to execute&gt;
</code></pre></div></div>

<h3 id="simple-example">Simple Example</h3>

<p>For example, instead of needing to compile:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gcc <span class="nt">-c</span> <span class="nt">-Wall</span> <span class="nt">-g</span> hello.c
</code></pre></div></div>

<p>You can do:</p>

<ol>
  <li>
    <p>Create and edit a file with name <code class="language-plaintext highlighter-rouge">Makefile</code></p>

    <div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">hello.o</span><span class="o">:</span> <span class="nf">hello.c</span>
		gcc <span class="nt">-c</span> <span class="nt">-Wall</span> <span class="nt">-g</span> hello.c
</code></pre></div>    </div>

    <p>where:</p>

    <ul>
      <li>you actually use <strong>tabs</strong> instead of spaces, which makes a difference there</li>
    </ul>
  </li>
  <li>
    <p>run <code class="language-plaintext highlighter-rouge">make</code></p>
  </li>
</ol>

<h3 id="making-multiple-targets">Making Multiple Targets</h3>

<p>If you have two targets or more, <code class="language-plaintext highlighter-rouge">make</code> by default does not execute all the scripts for you. Its only mission is to execute the <strong>first target successfully</strong>.</p>

<p>To execute other targets, <strong>you need to specify <code class="language-plaintext highlighter-rouge">make &lt;targetName&gt;</code></strong></p>

<p>For example:</p>

<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">hello.o</span><span class="o">:</span> <span class="nf">hello.c</span>
		gcc <span class="nt">-c</span> <span class="nt">-Wall</span> <span class="nt">-g</span> hello.c

<span class="nl">myadd.o</span><span class="o">:</span> <span class="nf">myadd.c</span>
		gcc <span class="nt">-c</span> <span class="nt">-Wall</span> <span class="nt">-g</span> myadd.c
</code></pre></div></div>

<p>and the execute with</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make myadd.o
</code></pre></div></div>

<p>However, what if <strong><em>some of its source files are missing</em></strong> for a job?</p>

<p>Suppose you only have:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>-
 |- myadd.c
 |- hello.c
 |- myadd.h
</code></pre></div></div>

<p>and your <code class="language-plaintext highlighter-rouge">Makefile</code> looks like:</p>

<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">main</span><span class="o">:</span> <span class="nf">main.o myadd.o</span>
		gcc main.o myadd.o <span class="nt">-o</span> main

<span class="nl">hello.o</span><span class="o">:</span> <span class="nf">hello.c</span>
		gcc <span class="nt">-c</span> <span class="nt">-Wall</span> <span class="nt">-g</span> hello.c

<span class="nl">myadd.o</span><span class="o">:</span> <span class="nf">myadd.c</span>
		gcc <span class="nt">-c</span> <span class="nt">-Wall</span> <span class="nt">-g</span> myadd.c
</code></pre></div></div>

<p>Now, if you execute <code class="language-plaintext highlighter-rouge">make</code>, you will get:</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">make</code> looks at the first goal <code class="language-plaintext highlighter-rouge">main</code>, and realize that its <strong>ingredients are goals themselves</strong>
    <ul>
      <li>in this case, those <strong>files are missing</strong>. So first it checks if <strong>ingredients <em>can be made by <code class="language-plaintext highlighter-rouge">make</code> itself</em></strong>
        <ul>
          <li>if yes, proceed</li>
          <li>if not, error, abort</li>
        </ul>
      </li>
      <li>if its <strong>ingredients are modified</strong>, but make has the goal
        <ul>
          <li>it will remake the file if the timestamp has been updated</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong><code class="language-plaintext highlighter-rouge">make</code> those missing ingredients</strong>
    <ul>
      <li>“recursively”</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">make</code> the first goal <code class="language-plaintext highlighter-rouge">main</code></li>
</ol>

<h3 id="managing-dependencies">Managing Dependencies</h3>

<p>The last problem with the above piece of code remains in the part:</p>

<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">hello.o</span><span class="o">:</span> <span class="nf">hello.c</span>
		gcc <span class="nt">-c</span> <span class="nt">-Wall</span> <span class="nt">-g</span> hello.c
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>this would <strong>not</strong> <strong>recompile</strong> if <code class="language-plaintext highlighter-rouge">myadd.h</code> gets changed</li>
</ul>

<p>To solve this, we need to <strong>explicitly make this an ingredient/dependency</strong>, even though we are not using it:</p>

<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">hello.o</span><span class="o">:</span> <span class="nf">hello.c myadd.h</span>
		gcc <span class="nt">-c</span> <span class="nt">-Wall</span> <span class="nt">-g</span> hello.c
</code></pre></div></div>

<p>and this completes the above example.</p>

<h3 id="variables">Variables</h3>

<p>You can also use variables in <code class="language-plaintext highlighter-rouge">Makefile</code></p>

<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">CC</span> <span class="o">=</span> gcc
<span class="nv">CFLAGS</span> <span class="o">=</span> <span class="nt">-Wall</span> <span class="nt">-g</span>

<span class="nl">hello.o</span><span class="o">:</span> <span class="nf">hello.c myadd.h</span>
		<span class="p">${</span>CC<span class="p">}</span> <span class="nt">-c</span><span class="p">${</span>CFLAGS<span class="p">}</span> hello.c
</code></pre></div></div>

<p>In fact, <code class="language-plaintext highlighter-rouge">make</code> by default works smartly to know what you want to do by looking at the <strong>ingredient file types</strong>.</p>

<p>It deduces that:</p>

<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">CC</span> <span class="o">=</span> gcc
<span class="nv">CFLAGS</span> <span class="o">=</span> <span class="nt">-Wall</span> <span class="nt">-g</span>

<span class="nl">hello.o</span><span class="o">:</span> <span class="nf">hello.c myadd.h</span>
</code></pre></div></div>

<p>and <code class="language-plaintext highlighter-rouge">make</code> will execute the following</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">${</span><span class="nv">CC</span><span class="k">}</span> <span class="nt">-c</span><span class="k">${</span><span class="nv">CFLAGS</span><span class="k">}</span> <span class="nt">-o</span> hello.o hello.c
</code></pre></div></div>

<p>where:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">CC</code> and <code class="language-plaintext highlighter-rouge">CFLAGS</code> are <strong>special variables</strong> that <code class="language-plaintext highlighter-rouge">make</code> will <strong>insert automatically</strong> if it detects that you are <strong>dealing with a C program.</strong></li>
</ul>

<h3 id="phony"><code class="language-plaintext highlighter-rouge">.PHONY</code></h3>

<p>By default, <code class="language-plaintext highlighter-rouge">Makefile</code> targets are “file targets” - they are used to build files from other files. Make assumes its target is a file, and this makes writing Makefiles relatively easy.</p>

<p>However, sometimes you want your Makefile to <strong>run commands that do not represent physical files</strong> in the file system.</p>

<ul>
  <li>If you do have a target file produced, <code class="language-plaintext highlighter-rouge">make</code> will only run it when the file <strong>doesn’t appear to be up-to-date</strong> with regards to its dependencies.</li>
</ul>

<p>These special targets are called <em>phony</em> and you can explicitly tell Make they’re <strong>not associated with files</strong>, e.g.:</p>

<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">.PHONY</span><span class="o">:</span> <span class="nf">clean</span>
<span class="nl">clean</span><span class="o">:</span>
  <span class="err">rm</span> <span class="err">-rf</span> <span class="err">*.o</span>
</code></pre></div></div>

<p>Now <code class="language-plaintext highlighter-rouge">make clean</code> will run as expected even if you do have a file named <code class="language-plaintext highlighter-rouge">clean</code>.</p>

<p><strong>In terms of Make, a phony target is simply a target that is always out-of-date</strong>, so whenever you ask <code class="language-plaintext highlighter-rouge">make &lt;phony_target&gt;</code>, it will run, independent from the state of the file system.</p>

<h3 id="full-example">Full Example</h3>

<p>Following contains the full example of a <code class="language-plaintext highlighter-rouge">Makefile</code>:</p>

<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># This Makefile should be used as a template for future Makefiles.
# It’s heavily commented, so hopefully you can understand what each
# line does.
# We’ll use gcc for C compilation and g++ for C++ compilation
</span><span class="nv">CC</span> <span class="o">=</span> gcc
<span class="nv">CXX</span> <span class="o">=</span> g++
<span class="c"># Let’s leave a place holder for additional include directories
</span><span class="nv">INCLUDES</span> <span class="o">=</span>
<span class="c"># Compilation options:
# -g for debugging info and -Wall enables all warnings
</span><span class="nv">CFLAGS</span> <span class="o">=</span> <span class="nt">-g</span> <span class="nt">-Wall</span> <span class="p">$(</span>INCLUDES<span class="p">)</span>
<span class="nv">CXXFLAGS</span> <span class="o">=</span> <span class="nt">-g</span> <span class="nt">-Wall</span> <span class="p">$(</span>INCLUDES<span class="p">)</span>
<span class="c"># Linking options:
# -g for debugging info
</span><span class="nv">LDFLAGS</span> <span class="o">=</span> <span class="nt">-g</span>
<span class="c"># List the libraries you need to link with in LDLIBS
# For example, use "-lm" for the math library
</span><span class="nv">LDLIBS</span> <span class="o">=</span>
<span class="c"># The 1st target gets built when you type "make".
# It’s usually your executable. ("main" in this case.)
#
# Note that we did not specify the linking rule.
# Instead, we rely on one of make’s implicit rules:
#
# $(CC)$(LDFLAGS) &lt;all-dependent-.o-files&gt; $(LDLIBS)
#
# Also note that make assumes that main depends on main.o,
# so we can omit it if we want to.
</span><span class="nl">main</span><span class="o">:</span> <span class="nf">main.o myadd.o</span>
<span class="c"># main.o depends not only on main.c, but also on myadd.h because
# main.c includes myadd.h. main.o will get recompiled if either
# main.c or myadd.h get modified.
#
# make already knows main.o depends on main.c, so we can omit main.c
# in the dependency list if we want to.
#
# make uses the following implicit rule to compile a .c file into a .o
# file:
#
# $(CC) -c$(CFLAGS) &lt;the-.c-file&gt;
#
</span><span class="nl">main.o</span><span class="o">:</span> <span class="nf">main.c myadd.h</span>
<span class="c"># And myadd.o depends on myadd.c and myadd.h.
</span><span class="nl">myadd.o</span><span class="o">:</span> <span class="nf">myadd.c myadd.h</span>
<span class="c"># Always provide the "clean" target that removes intermediate files.
# What you remove depend on your choice of coding tools
# (different editors generate different backup files for example).
#
# And the "clean" target is not a file name, so we tell make that
# it’s a "phony" target.
</span><span class="nl">.PHONY</span><span class="o">:</span> <span class="nf">clean</span>
<span class="nl">clean</span><span class="o">:</span>
<span class="err">rm</span> <span class="err">-f</span> <span class="err">*.o</span> <span class="err">a.out</span> <span class="err">core</span> <span class="err">main</span>
<span class="c"># "all" target is useful if your Makefile builds multiple programs.
# Here we’ll have it first do "clean", and rebuild the main target.
</span><span class="nl">.PHONY</span><span class="o">:</span> <span class="nf">all</span>
<span class="nl">all</span><span class="o">:</span> <span class="nf">clean main</span>
</code></pre></div></div>

<h1 id="week-3">Week 3</h1>

<h2 id="-in-c"><code class="language-plaintext highlighter-rouge">#</code> in C</h2>

<p>In the previous section <a href="#`#include`"><code class="language-plaintext highlighter-rouge">#include</code></a>, we have seen how this gets <strong>processed first by the compiler</strong> and texts are replaced into that line.</p>

<p>In general, the symbol <code class="language-plaintext highlighter-rouge">#</code> means <strong>preprocessing</strong></p>

<ul>
  <li>so that before the actual compiling happens, the compiler <strong>first looks at those <code class="language-plaintext highlighter-rouge">#</code></strong></li>
  <li>process the <strong>lines below</strong> (if needed) <strong>until a new <code class="language-plaintext highlighter-rouge">#</code> is met</strong></li>
</ul>

<h3 id="define"><code class="language-plaintext highlighter-rouge">#define</code></h3>

<p>Another example other than <code class="language-plaintext highlighter-rouge">#include</code> would be <code class="language-plaintext highlighter-rouge">#define</code>, which can basically be understood as <strong>textual replacement</strong> done by the compiler</p>

<ul>
  <li>quite a close analogy</li>
</ul>

<p>For example:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span>
<span class="cp">#define PI 3.14	// first encountered
</span><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"defined %f</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">PI</span><span class="p">);</span>	<span class="c1">// replaces PI with 3.14</span>
    <span class="cp">#define PI 3.15	// then encountered
</span>        <span class="k">if</span><span class="p">(</span><span class="o">-</span><span class="mi">37</span><span class="p">){</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">"redefined %f</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">PI</span><span class="p">);</span>	<span class="c1">// replaced PI with 3.15</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">"other variable %f</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">PI2</span><span class="p">);</span>	<span class="c1">// unknown PI2 even if defined next, because this happens at the fly</span>
                <span class="cp">#define PI2 3.16
</span>        <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// gets compiler error</span>
</code></pre></div></div>

<p>A more interesting example of using define is for ‘functions’:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#define SQR(x) x*x
</span><span class="p">...</span>
<span class="n">SQR</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c1">// gets replaced to 3*3, which WORKS</span>
<span class="n">SQR</span><span class="p">(</span><span class="mi">3</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span>  <span class="c1">// gets replaced to 3+4*3+4, which is WRONG</span>
</code></pre></div></div>

<p><strong><em>Hence, in general, MACROS with <code class="language-plaintext highlighter-rouge">#define</code> are discouraged</em></strong></p>

<h3 id="ifdefifndefelseendif"><code class="language-plaintext highlighter-rouge">#ifdef</code>/<code class="language-plaintext highlighter-rouge">#ifndef</code>/<code class="language-plaintext highlighter-rouge">#else</code>/<code class="language-plaintext highlighter-rouge">#endif</code></h3>

<p>A sample usage would be making a <strong><em>proper</em> header file</strong>:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#ifndef __MYADD_H__		// if NOT previously defined __MYADD_H__, execute the code within the if/endif
#define __MYADD_H__		// an empty definition
</span><span class="kt">int</span> <span class="nf">myadd</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="kt">int</span><span class="p">);</span>
<span class="cp">#endif		// end the code within the if/endif
</span></code></pre></div></div>

<p>where:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">.</code> are not allowed, hence we used <code class="language-plaintext highlighter-rouge">_</code> as replacements</li>
  <li><code class="language-plaintext highlighter-rouge">__MYADD_H__</code> is just a <strong>conventional</strong> name using the filename. In theory it can be anything <strong>unique</strong>.</li>
  <li>the purpose of this is to <strong>prevent multiple textual replacements of the header file</strong></li>
</ul>

<p>Mechanism explanation:</p>

<ol>
  <li>first in the preprocessor step in the compilation process, the first time its contents are reached the first two lines will check <strong>if <code class="language-plaintext highlighter-rouge">__MYADD_H__</code> has been defined for the preprocessor</strong>.</li>
  <li>If not, it will <strong>define <code class="language-plaintext highlighter-rouge">__MYADD_H__</code> and continue processing the code between it and the <code class="language-plaintext highlighter-rouge">#endif</code> directive</strong>.</li>
  <li>If the check against <code class="language-plaintext highlighter-rouge">#ifndef __MYADD_H__</code> is false, it will immediately scan down to the <code class="language-plaintext highlighter-rouge">#endif</code> and continue after it. This <strong>prevents redefinition errors</strong>.</li>
</ol>

<p><strong><em>This should always be how you define the header files.</em></strong></p>

<h2 id="data-types-in-c">Data Types in C</h2>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">char</code></p>

    <p>This is basically a <strong>8-bit integer</strong>/<strong>1-byte</strong></p>

    <ul>
      <li>therefore this is defined within the range $-128 \sim 127$</li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">short</code></p>

    <p>Basically a <strong>16-bit integer</strong>/<strong>2-bytes</strong></p>

    <ul>
      <li>therefore in the range $-32768 \sim 32767$</li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">int</code>/<code class="language-plaintext highlighter-rouge">signed int/int32_t</code></p>

    <p>Basically a <strong>32-bit integer</strong></p>

    <ul>
      <li>since <strong>signed</strong>, it is in the range of $-2G \sim 2G-1$
        <ul>
          <li>where:</li>
          <li>$2^{10}=1024=1K$</li>
          <li>$2^{20}=2^{10}\times 2^{10}=1M$</li>
          <li>$2^{30}=1G$</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">long</code></p>

    <p>Typically a <strong>64-bit integer</strong>/<strong>8-bytes</strong>. But for <strong>older OS</strong>, long might be just 4-bytes.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">long long</code></p>

    <p>Forces it to be <strong>64-bit integer</strong>/<strong>8 bytes</strong>.</p>
  </li>
</ul>

<p>In all the above, we have signed version by default. All of them also have an <strong>unsigned version</strong>, if you specify:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">unsigned char</code></li>
  <li><code class="language-plaintext highlighter-rouge">unsigned int</code>/<code class="language-plaintext highlighter-rouge">uint32_t</code></li>
  <li>etc.</li>
</ul>

<p>You can the unsigned version.</p>

<h3 id="single-quote-vs-double-quote">Single Quote vs Double Quote</h3>

<p>In other programming language such as Java, there is no big difference between the two as representing Character/String. In C, the rules are below:</p>

<ul>
  <li>Single Quote <code class="language-plaintext highlighter-rouge">'a'</code> refers to the <strong>integer value of the character according to the ASCII</strong> table
    <ul>
      <li>for example, <code class="language-plaintext highlighter-rouge">int y = 'a'+1</code> which is <code class="language-plaintext highlighter-rouge">97+1=98</code></li>
    </ul>
  </li>
  <li>Single Quote <code class="language-plaintext highlighter-rouge">'\013'</code> refers to the <strong>octal system</strong>, which here is <code class="language-plaintext highlighter-rouge">11</code>
    <ul>
      <li>you can have <strong>up to three bits</strong> after the slash</li>
      <li>hence <code class="language-plaintext highlighter-rouge">'\0'==0</code>, but <code class="language-plaintext highlighter-rouge">'\0'!='0'</code>, where the ASCII table shows <code class="language-plaintext highlighter-rouge">'0'=48</code></li>
    </ul>
  </li>
</ul>

<p><img src="\lectures\images\typora-user-images\image-20200921195419211.png" alt="image-20200921195419211" style="zoom:67%;" /></p>

<ul>
  <li>Double Quote <code class="language-plaintext highlighter-rouge">"abc"</code> are <strong>only compatible with Strings.</strong></li>
</ul>

<h2 id="expression">Expression</h2>

<p>Expressions are basically <strong>values</strong> that get computed from an expression.</p>

<ul>
  <li>for example: <code class="language-plaintext highlighter-rouge">5</code>, <code class="language-plaintext highlighter-rouge">x+1</code>, <code class="language-plaintext highlighter-rouge">prime(5)</code> which returns a <code class="language-plaintext highlighter-rouge">boolean</code>
    <ul>
      <li><strong>assignments <code class="language-plaintext highlighter-rouge">=</code></strong>, like in Java are also <strong>expressions</strong></li>
      <li>for example: <code class="language-plaintext highlighter-rouge">(x=1)+2</code> actually makes the expression evaluate to <code class="language-plaintext highlighter-rouge">3</code></li>
    </ul>
  </li>
</ul>

<p>Every expression also has a <strong>type</strong>.</p>

<ul>
  <li>for example: <code class="language-plaintext highlighter-rouge">int</code></li>
</ul>

<h2 id="statement">Statement</h2>

<p>Every expression can also be seen as <strong>statements</strong>, but statements <strong>typically include <code class="language-plaintext highlighter-rouge">;</code>, or any compound expression with <code class="language-plaintext highlighter-rouge">{}</code>.</strong></p>

<ul>
  <li>for example, <strong><code class="language-plaintext highlighter-rouge">x=x+1;</code> is a statement</strong>, yet it also <strong>contains the <em>expression</em> <code class="language-plaintext highlighter-rouge">x=x+1</code></strong></li>
</ul>

<h3 id="exam-note">Exam Note</h3>

<p><strong>Question:</strong> Does the following code has the same output?</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">;</span>
<span class="n">x</span><span class="o">=</span><span class="mi">10</span><span class="p">;</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">++</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
</code></pre></div></div>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">;</span>
<span class="n">x</span><span class="o">=</span><span class="mi">10</span><span class="p">;</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">++</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
</code></pre></div></div>

<p><strong>Solution:</strong></p>

<p>They are the <strong><em>same</em></strong>. The brackets <code class="language-plaintext highlighter-rouge">()</code> only defines the <strong>order of operation</strong>, <strong>without influencing the operations</strong> themselves.</p>

<ul>
  <li>you can think of this being a way to tell the machine which piece of code to execute first</li>
</ul>

<h2 id="operators-in-c">Operators in C</h2>

<p>Operators in C include basically the same ones as in Java, but some have <strong>different return types.</strong></p>

<h3><code class="language-plaintext highlighter-rouge">==</code></h3>

<p>The comparison operator in C returns <code class="language-plaintext highlighter-rouge">int</code>, namely:</p>

<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">1</code> if it is true</strong></li>
  <li><strong><code class="language-plaintext highlighter-rouge">0</code> if it is false</strong></li>
</ul>

<p>However, every <code class="language-plaintext highlighter-rouge">int</code> value that is <strong>not <code class="language-plaintext highlighter-rouge">0</code> is the same as true</strong>.</p>

<p>For example:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
        <span class="k">if</span><span class="p">(</span><span class="o">-</span><span class="mi">37</span><span class="p">){</span>	<span class="c1">// is true</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
        <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="bitwise-operators-in-c">Bitwise Operators in C</h3>

<p>Basically operators that work if <strong>arguments are treated as binary numbers</strong>.</p>

<h4 id="-and-"><code class="language-plaintext highlighter-rouge">&amp;</code> and <code class="language-plaintext highlighter-rouge">|</code></h4>

<p>Notice that instead of <code class="language-plaintext highlighter-rouge">&amp;&amp;</code> and <code class="language-plaintext highlighter-rouge">||</code> which is <strong>logical and</strong> and <strong>logical or</strong>.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">z</span><span class="p">;</span>
<span class="n">z</span><span class="o">=</span><span class="n">x</span><span class="o">|</span><span class="n">y</span><span class="p">;</span>	<span class="c1">// z=3</span>
<span class="n">z</span><span class="o">=</span><span class="n">x</span><span class="o">&amp;</span><span class="n">y</span><span class="p">;</span>	<span class="c1">// z=0</span>
</code></pre></div></div>

<p>where:</p>

<ol>
  <li>first the values of <code class="language-plaintext highlighter-rouge">x</code> and <code class="language-plaintext highlighter-rouge">y</code> are converted to the 32-bit <strong>binary int</strong></li>
  <li>then the bitwise operators are applied</li>
</ol>

<h4 id="-and--1"><code class="language-plaintext highlighter-rouge">&lt;&lt;</code> and <code class="language-plaintext highlighter-rouge">&gt;&gt;</code></h4>

<p><code class="language-plaintext highlighter-rouge">&lt;&lt;</code> <strong>left shift</strong> basically shifts digits to the left, and <code class="language-plaintext highlighter-rouge">&gt;&gt;</code> <strong>right shift</strong> basically shifts digits to the right</p>

<ul>
  <li>this is true for unsigned integers</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// if we have unsigned integers</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">z</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="o">&lt;&lt;</span><span class="mi">2</span><span class="p">;</span>  <span class="c1">// z=4</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">&gt;&gt;</span><span class="mi">2</span><span class="p">;</span>  <span class="c1">// y=0</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li><strong>left shift</strong> is basically multiplying by <code class="language-plaintext highlighter-rouge">2^n</code>, where <code class="language-plaintext highlighter-rouge">n</code> is the number of digits shifted</li>
  <li><strong>right shift</strong> is basically dividing by <code class="language-plaintext highlighter-rouge">2^n</code>, where <code class="language-plaintext highlighter-rouge">n</code> is the number of digits shifted
    <ul>
      <li>simple to understand if you think about decimal system</li>
    </ul>
  </li>
</ul>

<p>if we have signed integers/2’s complement, then:</p>

<ul>
  <li><strong>left shift</strong> is the same</li>
  <li><strong>right shift</strong> fills in the leftmost blanks with the <strong><em>original leftmost digit</em></strong>
    <ul>
      <li>in order to preserve the sign (think about decimal system)</li>
    </ul>
  </li>
</ul>

<p>For example:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">y</span><span class="o">=-</span><span class="mi">2</span><span class="p">;</span> <span class="c1">// same as saying signed int y=-2;</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// 11111111111111111110 (assumes 31 times 1) -&gt; 111111111111111111 (assumes 32 times 1) = -1</span>
</code></pre></div></div>

<h4 id="-1"><code class="language-plaintext highlighter-rouge">~</code></h4>

<p>This is basically the <strong>not</strong> operator for binary numbers.</p>

<ul>
  <li>it basically flips <code class="language-plaintext highlighter-rouge">1</code> to <code class="language-plaintext highlighter-rouge">0</code> , and <code class="language-plaintext highlighter-rouge">0</code> to <code class="language-plaintext highlighter-rouge">1</code></li>
</ul>

<h4 id="sample-combinations">Sample Combinations</h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">x = x&amp;(1&lt;&lt;4)</code>
    <ul>
      <li>picks out the 4th bit of the binary number <code class="language-plaintext highlighter-rouge">x</code></li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">x = x|(1&lt;&lt;4)</code>
    <ul>
      <li>turn on the 4th bit of the binary number <code class="language-plaintext highlighter-rouge">x</code></li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">x = x&amp;~(1&lt;&lt;4)</code>
    <ul>
      <li>turn off the 4th bit of the binary number <code class="language-plaintext highlighter-rouge">x</code></li>
    </ul>
  </li>
</ul>

<h2 id="operator-associativity">Operator Associativity</h2>

<p>Associativity in this context refers to the <strong>order of operation</strong> when you are met with operators of the <strong>same precedence</strong>.</p>

<p><strong>For most operators</strong>, evaluations are done <strong>left to right</strong></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">2</span><span class="o">+</span><span class="mi">3</span><span class="o">-</span><span class="mi">5</span><span class="p">;</span>
</code></pre></div></div>

<p>However, for <strong>assignment</strong> <code class="language-plaintext highlighter-rouge">=</code>, it actually goes <strong>right to left</strong></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="c1">// first gets x=5, then gets y=5 (as x=5 evaluates to 5).</span>
</code></pre></div></div>

<h2 id="variable-scope">Variable Scope</h2>

<h3 id="local-variable">Local Variable</h3>

<p>Basically any normal variables used in methods. This is slightly different from Java, which is stricter in one key aspect:</p>

<ul>
  <li>In C, if a variable is already defined in a <strong>code block</strong>:
    <ul>
      <li>you <strong>can</strong> define/declare another variable of the same name, overriding that variable</li>
    </ul>
  </li>
  <li>In Java, if a variable is already defined in a <strong>code block</strong>:
    <ul>
      <li>you <strong>cannot</strong> define/declare a variable of the same name</li>
    </ul>
  </li>
</ul>

<p>They are also called <strong>stack variables</strong>, since they are <strong>usually stored in process stack</strong> (we’ll see what this means later)</p>

<p>For example:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">char</span> <span class="n">a</span> <span class="o">=</span> <span class="sc">'a'</span><span class="p">;</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"character %c</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">a</span><span class="p">);</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">a</span> <span class="o">=</span> <span class="sc">'b'</span><span class="p">;</span>	<span class="c1">// allowed, and hides the variable char a = 'a' in the outside</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"character %c</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">a</span><span class="p">);</span>	<span class="c1">// prints b</span>
<span class="p">}</span>
</code></pre></div></div>

<p>but in Java:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">char</span> <span class="n">a</span> <span class="o">=</span> <span class="sc">'a'</span><span class="o">;</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">a</span><span class="o">);</span>
<span class="o">{</span>
    <span class="kt">char</span> <span class="n">a</span> <span class="o">=</span> <span class="sc">'b'</span><span class="o">;</span>	<span class="c1">// compile error</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">a</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="static-variable">Static Variable</h3>

<p>There are three kinds of static variables:</p>

<ul>
  <li><strong>Global Static</strong>
    <ul>
      <li>created/initialized before program runs</li>
      <li>lives for the lifetime of the entire program</li>
      <li>visible to all other files at link time</li>
      <li>this is the <strong><em>only variable that might be name conflicted with other global variables when you have multiple files</em></strong></li>
    </ul>
  </li>
  <li><strong>File Static</strong>
    <ul>
      <li>created/initialized before program runs</li>
      <li><strong>lives for the lifetime of the entire program</strong></li>
      <li>visible only to this <strong>file</strong>, before being linked</li>
    </ul>
  </li>
  <li><strong>Function Static</strong>
    <ul>
      <li>created/initialized before program runs</li>
      <li><strong>lives for the lifetime of the entire program</strong></li>
      <li>visible only to this <strong>function</strong></li>
    </ul>
  </li>
</ul>

<p><strong><em>For static variables, they must be initialized with a literal/value</em></strong>. In other words, you cannot have <code class="language-plaintext highlighter-rouge">static int x= y*2</code>, which will <strong>throw compile error</strong>.</p>

<ul>
  <li>this is because, in fact, all those variables are initialized/created <strong>at the beginning of the program, before anything runs</strong></li>
</ul>

<p>This is best illustrated with an example</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">global_static</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// visible to other files, static in all files</span>
<span class="k">extern</span> <span class="n">global_static2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// this is technically the same as above, but could creates confusion</span>
						   <span class="c1">// so this style is discouraged</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">file_static</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// only visible within this file, static in this file</span>

<span class="kt">int</span> <span class="nf">foo</span><span class="p">(</span><span class="kt">int</span> <span class="n">auto_1</span><span class="p">){</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">function_or_block_static</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// only visible in this block, static to this block</span>
    <span class="p">...</span>
    <span class="kt">int</span> <span class="n">localvariable</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// the normal local variable</span>
    <span class="p">...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>notice that you need to define those static variables with a constant</li>
</ul>

<h4 id="global-static-variable">Global Static Variable</h4>

<p>Of course, the actual value of a global variable is known cross-file only <strong>at link time</strong>.</p>

<p>Therefore, you need to <strong>manually tell the compiler that a variable is meant to be global in another file</strong>, with the keyword <code class="language-plaintext highlighter-rouge">extern</code>.</p>

<ul>
  <li>just like linking method from different files, compilers need to know them beforehand</li>
</ul>

<p>For example:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// inside main.c</span>

<span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>	<span class="c1">// global variable</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="kt">int</span> <span class="n">z</span><span class="p">;</span>	<span class="c1">// local variable</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>and then:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// inside foo.c</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>	<span class="c1">// tells the compiler this is external</span>

<span class="kt">int</span> <span class="nf">foo</span><span class="p">(){</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="o">+</span><span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>for global variables, you need to <strong>be careful of name collision of other global variables from other files</strong></li>
</ul>

<h4 id="file-static-variable">File Static Variable</h4>

<p>The only difference between any of the three static variables are their <strong>scope</strong> (i.e. all of them are created before the program runs).</p>

<p>For a file static variable, it is <strong>only visible in the same file</strong>.</p>

<p>For example:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// inside bar.c</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>	<span class="c1">// file static variable, ONLY visible within THIS FILE</span>

<span class="kt">int</span> <span class="nf">f1</span><span class="p">(){</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="function-static-variable">Function Static Variable</h4>

<p>Again, the same principle, but only <strong>visible in the same function</strong>.</p>

<ul>
  <li>together with the other static variables, they get initialized before the program runs</li>
</ul>

<p>For example:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">f</span><span class="p">(){</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>	<span class="c1">// function static variable</span>
    						<span class="c1">// lives outside this function, but visible only inside this function</span>
    <span class="n">count</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="kt">int</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="n">f</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">s</span><span class="p">);</span>	<span class="c1">// prints 55 = 1+2+3...+10</span>
<span class="p">}</span>
</code></pre></div></div>

<h1 id="week-4">Week 4</h1>

<h2 id="process-address-space">Process Address Space</h2>

<p>Every <strong>single process</strong> (i.e., a <strong><em>running</em></strong> program/executable) gets <strong>512GB of memory space</strong>, some of which is then <strong>mapped to your RAM</strong>:</p>

<ul>
  <li>Obviously, computers don’t have that much RAM. It’s <strong>virtual memory</strong>!</li>
</ul>

<p><img src="\lectures\images\typora-user-images\image-20201001140256887.png" alt="image-20201001140256887" style="zoom: 80%;" /></p>

<p>where:</p>

<ul>
  <li><strong>sizes of static variables and program code are known/fixed</strong></li>
  <li>
    <p><strong>sizes of stack and heap CAN grow/shrink</strong>, as it depends on how your program runs</p>
  </li>
  <li>the <strong>program code</strong> refers to the executable you have in the end</li>
</ul>

<blockquote>
  <p>Note:</p>

  <ul class="task-list">
    <li class="task-list-item">
      <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Although the stack <strong>goes from top to bottom</strong>, actually <strong>what variable gets stored first is controlled by your operating system</strong>.</p>

      <ul>
        <li>
          <p>for example:</p>

          <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">d</span> <span class="o">=</span> <span class="mi">3</span><span class="p">.</span><span class="mi">14</span><span class="p">;</span>
</code></pre></div>          </div>

          <p>and it might be that <code class="language-plaintext highlighter-rouge">d</code> is stored at a higher memory than <code class="language-plaintext highlighter-rouge">i</code>:</p>

          <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&amp;i is 0x7fff6289abec
&amp;d is 0x7fff6289abf0	// the above +4
</code></pre></div>          </div>
        </li>
      </ul>
    </li>
  </ul>
</blockquote>

<blockquote>
  <p><strong>Extension:</strong></p>

  <ul>
    <li>Every memory cell contains <strong>1 byte</strong>. This means that a 32-bit integer would use up 4 bytes = 4 memory cells.</li>
    <li>The bit number for CPU (e.g. 64-bit CPU), means <strong>how many bits it can read simultaneously from your RAM</strong>. If you have a 64-bit CPU, you can read 8 bytes at a time.</li>
  </ul>
</blockquote>

<h3 id="virtual-memory-vs-physical-memory">Virtual Memory vs Physical Memory</h3>

<p>This is the technique used modern days to <strong>prevent memory allocation collision</strong> of multiple different programs.</p>

<ul>
  <li>consider one program <strong>needing memory location <code class="language-plaintext highlighter-rouge">2000</code> and the other also <code class="language-plaintext highlighter-rouge">2000</code></strong></li>
</ul>

<p>To solve all the above issues, this is what happens:</p>

<p><img src="\lectures\images\typora-user-images\image-20201001140733505.png" alt="image-20201001140733505" style="zoom:50%;" /></p>

<p>where:</p>

<ul>
  <li>each actual usage in the virtual memory gets <strong>transported/mapped to a space in your physical memory</strong></li>
  <li>no memory allocation collision occurs because the mapping makes sure you are <strong>allocated the correct physical spot</strong></li>
</ul>

<blockquote>
  <p><strong>Extension:</strong></p>

  <ul>
    <li>
      <p>Virtual memory uses both computer hardware and software to work. When an application is in use, <strong>data from that program is stored in a physical address using RAM</strong>. More specifically, <strong>virtual memory will map that address to RAM using a memory management unit (<a href="https://whatis.techtarget.com/definition/memory-management-unit-MMU">MMU</a>)</strong>. The OS will make and manage memory mappings by using page tables and other data structures. The MMU, which acts as an address translation hardware, will automatically translate the addresses.</p>

      <p>If at any point later the RAM space is needed for something more urgent, <strong>the data can be swapped out of RAM and into virtual memory</strong>. The computer’s memory manager is in charge of keeping track of the shifts between physical and virtual memory. If that data is needed again, a <a href="https://whatis.techtarget.com/definition/context-switch">context switch</a> can be used to resume execution again.</p>

      <p>While copying virtual memory into physical memory, the OS divides memory into pagefiles or <a href="https://searchwindowsserver.techtarget.com/definition/swap-file-swap-space-or-pagefile">swap files</a> with a fixed number of addresses. Each page is stored on a disk, and when the page is needed, the OS copies it from the disk to main memory and translates the virtual addresses into real addresses.</p>

      <p>However, the process of swapping virtual memory to physical is rather slow. This means that <strong>using virtual memory generally causes a noticeable reduction in performance</strong>. Because of swapping, computers with more RAM are seen to have better performance.</p>
    </li>
  </ul>
</blockquote>

<h3 id="stack-vs-heap">Stack vs Heap</h3>

<p><img src="\lectures\images\typora-user-images\image-20201001205324568.png" alt="image-20201001205324568" style="zoom:67%;" /></p>

<p>For example:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// The size of memory to be allocated is known to compiler and whenever a function is called</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
<span class="p">{</span> 
   <span class="c1">// All these variables get memory </span>
   <span class="c1">// allocated on stack </span>
   <span class="kt">int</span> <span class="n">a</span><span class="p">;</span> 
   <span class="kt">int</span> <span class="n">b</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span> 
   <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span> 
   <span class="kt">int</span> <span class="n">c</span><span class="p">[</span><span class="n">n</span><span class="p">];</span> 
<span class="p">}</span> 
</code></pre></div></div>

<p>but:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
<span class="p">{</span> 
   <span class="c1">// This memory for 10 integers </span>
   <span class="c1">// is allocated on heap. </span>
   <span class="kt">int</span> <span class="o">*</span><span class="n">ptr</span>  <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span><span class="p">);</span> 
<span class="p">}</span> 
</code></pre></div></div>

<h3 id="hierarchy-example">Hierarchy Example</h3>

<p>Having the notion of the hierarchy would be useful. For example:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="p">...</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">buffer</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">larger</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">buffer</span> <span class="o">&lt;</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span><span class="p">;</span> <span class="c1">// gives 1</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The reason being the <strong>address of stack are generally higher up than address of heap:</strong></p>

<p><img src="\lectures\images\typora-user-images\image-20201015021617926.png" alt="image-20201015021617926" style="zoom: 67%;" /></p>

<p>where:</p>

<ul>
  <li>the above also shows another double pointer, but all we need to notice is that the <strong>address of stack variables</strong> are always higher than <strong>address of heap variables</strong>, which is <strong>always higher than address of code variables</strong>.</li>
</ul>

<h2 id="pointers">Pointers</h2>

<p>Pointers is a group of storage cells (in total <strong><em>8 byte=8 cells</em></strong>) that <strong>holds a memory address as data</strong>.</p>

<ul>
  <li>one byte in memory address could hold data such as a <code class="language-plaintext highlighter-rouge">char</code>, for example</li>
  <li><strong>8 byte is also the largest primitive type</strong> you can have <code class="language-plaintext highlighter-rouge">long long</code> (though it <strong>has nothing to do with this, use it for mnemonic</strong>)</li>
</ul>

<p><img src="https://media.geeksforgeeks.org/wp-content/uploads/pointers-in-c.png" alt="Pointers in C and C++ | Set 1 (Introduction, Arithmetic and Array) -  GeeksforGeeks" style="zoom:67%;" /></p>

<p>where:</p>

<ul>
  <li><strong>hexadecimal is used</strong></li>
  <li><strong>difference of 1 in memory address corresponds to 1 byte.</strong></li>
</ul>

<h3 id="related-operators">Related Operators</h3>

<p>Common related operations include:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">&amp;</code> gives the <strong>address of an object</strong> from a <strong><em>variable</em></strong>
    <ul>
      <li>you <strong>cannot</strong> use a <code class="language-plaintext highlighter-rouge">&amp;</code> with a literal or an expression</li>
      <li>effectively <strong>add a <code class="language-plaintext highlighter-rouge">*</code> to a <em>type</em></strong>
        <ul>
          <li>e.g. <code class="language-plaintext highlighter-rouge">int x=5;</code>  then<code class="language-plaintext highlighter-rouge">&amp;x</code> is type <code class="language-plaintext highlighter-rouge">int *</code></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">*</code> dereferences the address (<strong>goes to the actual address</strong>)
    <ul>
      <li>also used to <strong>instantiate a pointer</strong></li>
      <li>effectively <strong>peel a <code class="language-plaintext highlighter-rouge">*</code> off from a <em>type</em></strong>
        <ul>
          <li>e.g. <code class="language-plaintext highlighter-rouge">int *y  = &amp;x</code>, then <code class="language-plaintext highlighter-rouge">*y</code> is type <code class="language-plaintext highlighter-rouge">int</code></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>Therefore, common operations include:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="kt">int</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span> <span class="c1">// p is a pointer variable</span>
<span class="kt">int</span> <span class="o">*</span><span class="n">q</span><span class="p">;</span>

<span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">;</span> <span class="c1">// that holds an address of an int variable</span>
		<span class="c1">// p++ would increase the memory location itself</span>

<span class="n">y</span> <span class="o">=</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span> <span class="c1">// y is now the data p points to, which is 1</span>

<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// the data p points to, which is x, is now 0</span>
<span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">y</span><span class="p">;</span> <span class="c1">// p now points to y</span>
<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// the data p points to, which is y, is now 2. x is still 0</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span> <span class="c1">// q points to p, which is the memory address of y </span>

<span class="o">++*</span><span class="n">p</span><span class="p">;</span> <span class="c1">// ++(*p), y is now 3</span>
<span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)</span><span class="o">++</span><span class="p">;</span> <span class="c1">// y is now 4. Note that * and ++ go right-to-left.</span>
</code></pre></div></div>

<p>where in the above example:</p>

<ul>
  <li>variable <code class="language-plaintext highlighter-rouge">p</code>  is just the <strong>memory address</strong></li>
  <li><code class="language-plaintext highlighter-rouge">*p</code> can be read as <strong><em>the data <code class="language-plaintext highlighter-rouge">p</code> points to</em></strong></li>
</ul>

<h3 id="pointer-data-type">Pointer Data Type</h3>

<p>Every pointer is constrained to <strong>point to a particular kind of object</strong>.</p>

<ul>
  <li>you can imagine the compiler needs to know if that pointer is calling the correct methods</li>
</ul>

<p>This is necessary because the <strong>type tells the pointer</strong>:</p>

<ul>
  <li><strong>how much bytes to read from that address</strong></li>
  <li><strong>what operations are allowed</strong></li>
  <li><strong>how much bytes to advance with pointer arithmetic</strong>
    <ul>
      <li>see the section <a href="#Generic Pointer">Generic Pointer</a></li>
    </ul>
  </li>
</ul>

<p>For example:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="kt">double</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">3</span><span class="p">.</span><span class="mi">14</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">i</span><span class="p">;</span>

    <span class="kt">double</span> <span class="o">*</span><span class="n">dp</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">i</span><span class="p">;</span>
    <span class="kt">int</span> <span class="o">*</span><span class="n">ip</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">)</span><span class="n">dp</span><span class="p">;</span>	<span class="c1">// casting a double pointer to an int pointer</span>

    <span class="c1">// prints 3</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"j=%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">j</span><span class="p">);</span>
    <span class="c1">// prints 1374389535</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"*ip = %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="o">*</span><span class="n">ip</span><span class="p">);</span>
    <span class="c1">// prints 1.37439e+09, basically the above as a double</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"*ip = %g</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="o">*</span><span class="n">ip</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>the wrong number comes out because <code class="language-plaintext highlighter-rouge">double *</code> is expected to read 8 bytes, but <code class="language-plaintext highlighter-rouge">int *</code> reads only 4 bytes.</li>
</ul>

<blockquote>
  <p><strong>Note:</strong></p>

  <ul class="task-list">
    <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Even though pointers are just storing memory addresses, and they are <strong>just integers/numbers</strong>, doing things like <code class="language-plaintext highlighter-rouge">char *c = 10</code> is <strong>forbidden by the compiler</strong>. The <strong>only exception is the value of <code class="language-plaintext highlighter-rouge">0</code></strong>. (see section <a href="#Null Pointer">Null Pointer</a>)</li>
  </ul>
</blockquote>

<h3 id="pointers-and-function-arguments">Pointers and Function Arguments</h3>

<p>Since <strong>C passes arguments to functions by value</strong>, if you need to alter states of a variable in a function, you need to <strong>take pointers as parameters</strong>.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">swap</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">);</span>	<span class="c1">// wrong</span>
<span class="kt">void</span> <span class="nf">swap</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">y</span><span class="p">);</span>	<span class="c1">// correct</span>
</code></pre></div></div>

<p>and you <strong>use the correct one</strong> like:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">a</span><span class="o">=</span><span class="mi">5</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">b</span><span class="o">=</span><span class="mi">6</span><span class="p">;</span>
<span class="n">swap</span><span class="p">(</span><span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">);</span>	<span class="c1">// pass memory locations to them</span>
</code></pre></div></div>

<h3 id="doublenested-pointers">Double/Nested Pointers</h3>

<p>Basically, if you have understood everything correctly, this should make sense:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="kt">int</span> <span class="n">var</span> <span class="o">=</span> <span class="mi">789</span><span class="p">;</span>
    <span class="kt">int</span> <span class="o">*</span><span class="n">ptr1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="o">**</span><span class="n">ptr2</span><span class="p">;</span>

    <span class="n">ptr1</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">var</span><span class="p">;</span>	<span class="c1">// address of var</span>
    <span class="n">ptr2</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ptr1</span><span class="p">;</span>	<span class="c1">// address of ptr1</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"Value of var = %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">var</span> <span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Value of var using single pointer = %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="o">*</span><span class="n">ptr1</span> <span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Value of var using double pointer, single derefernce = %p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="o">*</span><span class="n">ptr2</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Value of var using double pointer, double derefernce = %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="o">**</span><span class="n">ptr2</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>And below would be the schematic:</p>

<p><img src="\lectures\images\typora-user-images\image-20201001145717698.png" alt="image-20201001145717698" style="zoom: 67%;" /></p>

<h3 id="generic-pointer">Generic Pointer</h3>

<p>Consider <strong>using <code class="language-plaintext highlighter-rouge">void *</code> as a pointer</strong>. <strong><em>Every pointer type can be assigned to this pointer</em></strong>.</p>

<ul>
  <li>However, you <strong>cannot dereference it</strong>. Because the compiler does not know <code class="language-plaintext highlighter-rouge">void</code> means how many bytes to read.</li>
  <li>So, <strong>before dereferencing it</strong>, you <strong>need to cast it</strong>.</li>
</ul>

<p>For example, this is allowed:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> 
<span class="kt">char</span> <span class="n">b</span> <span class="o">=</span> <span class="sc">'x'</span><span class="p">;</span> 
  
<span class="kt">void</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">;</span>  <span class="c1">// void pointer holds address of int 'a' </span>
<span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">;</span> <span class="c1">// void pointer holds address of char 'b' </span>
</code></pre></div></div>

<p>With <code class="language-plaintext highlighter-rouge">GCC</code> compiler, this is also allowed:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span><span class="cpf">&lt;stdio.h&gt;</span><span class="c1"> </span><span class="cp">
</span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
<span class="p">{</span> 
		<span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">};</span>
        <span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
        <span class="kt">int</span> <span class="o">*</span><span class="n">ptr2</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>

        <span class="n">ptr</span> <span class="o">=</span> <span class="n">ptr</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>        <span class="c1">// instead of ++, because void pointer does not know the type</span>
        <span class="n">ptr2</span><span class="o">++</span><span class="p">;</span>

    	<span class="c1">// both prints 2</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"sizeofint=%ld ,%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">),</span> <span class="o">*</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">)</span><span class="n">ptr</span><span class="p">);</span> <span class="c1">// type casting is needed for dereferencing</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"sizeofint=%ld ,%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">),</span> <span class="o">*</span><span class="n">ptr2</span><span class="p">);</span>

        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span> 
</code></pre></div></div>

<p>where:</p>

<ul>
  <li><strong>typecasting</strong> is always needed if you want to dereference a <code class="language-plaintext highlighter-rouge">void</code> pointer</li>
  <li><strong>pointer arithmetic</strong> has to be done manually since <code class="language-plaintext highlighter-rouge">void *</code> does not know its type, hence doesn’t know <strong>how much cells/bytes to advance</strong>.</li>
  <li><strong><em><code class="language-plaintext highlighter-rouge">void</code> pointer arithmetic may not work with other compilers</em></strong></li>
</ul>

<h3 id="null-pointer">Null Pointer</h3>

<p>A null pointer basically a pointer pointing to <code class="language-plaintext highlighter-rouge">0</code> or <code class="language-plaintext highlighter-rouge">NULL</code>.</p>

<ul>
  <li>where <code class="language-plaintext highlighter-rouge">0</code> is a special int value that can be <strong>automatically converted to a pointer type</strong> (null)</li>
</ul>

<p>For example:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">char</span> <span class="o">*</span><span class="n">q</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">int</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</code></pre></div></div>

<p>And graphically, it looks like:</p>

<p><img src="\lectures\images\typora-user-images\image-20201002015953792.png" alt="image-20201002015953792" style="zoom:67%;" /></p>

<p>where:</p>

<ul>
  <li>even though it looks like just having one byte, every pointer is of <strong>8 bytes</strong></li>
</ul>

<p>If you try to dereference a null pointer, you will get <strong>runtime errors:</strong></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">*</span><span class="n">p</span><span class="p">;</span>	<span class="c1">// segmentation error</span>
</code></pre></div></div>

<h3 id="pointers-to-tf">Pointers to T/F</h3>

<p>In C, every pointer themselves can be evaluated to “true” of “false”.</p>

<ul>
  <li>every non-null pointer is “true”</li>
  <li>every null pointer is “false”</li>
</ul>

<p>For example:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">char</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">char</span> <span class="o">*</span><span class="n">d</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">;</span>
<span class="kt">char</span> <span class="o">*</span><span class="n">e</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>	<span class="c1">// null pointer</span>

<span class="k">if</span><span class="p">(</span><span class="n">d</span><span class="p">){</span>	<span class="c1">// evaluates to true, non-null pointer</span>
    <span class="p">...</span>
<span class="p">}</span>
<span class="k">if</span><span class="p">(</span><span class="o">*</span><span class="n">d</span><span class="p">){</span>	<span class="c1">// the VALUE 0 is false</span>
    <span class="p">...</span>
<span class="p">}</span>
<span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="p">){</span>	<span class="c1">// evaluates to false, null pointer</span>
    <span class="p">...</span>
<span class="p">}</span>
<span class="k">if</span><span class="p">(</span><span class="o">*</span><span class="n">e</span><span class="p">){</span>	<span class="c1">// program crashes, segmentation error</span>
    <span class="p">...</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="sizeof"><code class="language-plaintext highlighter-rouge">sizeof</code></h2>

<p>The built-in function of C that returns the <strong>number of bytes</strong> that variable is using.</p>

<p>For example:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">char</span> <span class="n">d</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">97</span><span class="p">,</span><span class="mi">98</span><span class="p">,</span><span class="mi">99</span><span class="p">,</span><span class="mi">0</span><span class="p">};</span>
<span class="k">sizeof</span><span class="p">(</span><span class="n">d</span><span class="p">);</span>	<span class="c1">// gives 16 = 4*4</span>
<span class="k">sizeof</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>	<span class="c1">// gives 4</span>

<span class="kt">char</span> <span class="o">*</span><span class="n">e</span><span class="p">;</span>
<span class="k">sizeof</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>	<span class="c1">// gives 8</span>
</code></pre></div></div>

<h2 id="pointer-arithmetic">Pointer Arithmetic</h2>

<p>One common expression in C is to deal with pointers/memory address directly.</p>

<p>Consider the example:</p>

<p><img src="\lectures\images\typora-user-images\image-20201002021658104.png" alt="image-20201002021658104" style="zoom:67%;" /></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">val</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">11</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">44</span><span class="p">,</span><span class="mi">55</span><span class="p">,</span><span class="mi">66</span><span class="p">,</span><span class="mi">77</span><span class="p">};</span>
<span class="kt">int</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>	<span class="c1">// points to 11</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>	<span class="c1">// this is equivalent to:</span>
			<span class="c1">// p = p + sizeof(*p), in terms of bytes</span>

<span class="o">*</span><span class="n">p</span><span class="p">;</span> <span class="c1">// this is now 22</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>this also explained why casting of a pointer does not work well, and why arithmetic of <strong><code class="language-plaintext highlighter-rouge">void</code> pointers</strong> would be more cumbersome <strong><em>if you use GCC compiler</em></strong> (<strong><code class="language-plaintext highlighter-rouge">+1</code> would be advance by 1 byte</strong>).</li>
</ul>

<blockquote>
  <p><strong>Theorem:</strong></p>

  <ul>
    <li>
      <p>In an array <code class="language-plaintext highlighter-rouge">a</code>, if a pointer <code class="language-plaintext highlighter-rouge">p</code> points to the first element of it, then:</p>

      <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</code></pre></div>      </div>
    </li>
  </ul>
</blockquote>

<h3 id="adding-and-subtracting-pointers">Adding and Subtracting Pointers</h3>

<p>First, in general, adding/subtracting a pointer with/from another pointer would just be <strong>doing arithmetic directly on the address</strong> (also <strong>scaled by the type of the pointer</strong>)</p>

<p>Consider two pointers:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">val</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">11</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">44</span><span class="p">,</span><span class="mi">55</span><span class="p">,</span><span class="mi">66</span><span class="p">,</span><span class="mi">77</span><span class="p">};</span>
<span class="kt">int</span> <span class="o">*</span><span class="n">p1</span> <span class="o">=</span> <span class="n">val</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// points to 22</span>
<span class="kt">int</span> <span class="o">*</span><span class="n">p2</span> <span class="o">=</span> <span class="n">val</span><span class="o">+</span><span class="mi">4</span><span class="p">;</span> <span class="c1">// points to 55</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>doing address arithmetic usually only <strong>makes sense if we are pointing to the same continuous memory location</strong>. However, if you are certain exactly where each memory address is, you can also do arithmetic on different pointers as long as they are the same type
    <ul>
      <li>notice that the <strong>hard restriction</strong> by compiler is actually the <strong>pointers have to be of the same type</strong></li>
    </ul>
  </li>
</ul>

<p>Now, obviously doing:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">diff</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">p1</span><span class="p">;</span> <span class="c1">// gives 3, meaning 3 cells of int away</span>
</code></pre></div></div>

<p>Therefore, in general, address arithmetic for pointers work as:</p>

\[p_2 - p_1 = \frac{\text{address of $p_2-$ address of $p_1$ }}{\text{size pointer type}}=\text{#elements away}\]

<p>For example:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">char</span> <span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">""</span><span class="p">,</span> <span class="s">"A"</span><span class="p">,</span> <span class="s">"BC"</span><span class="p">,</span> <span class="s">"DEF"</span> <span class="p">};</span>
<span class="kt">int</span> <span class="n">diff</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)(</span><span class="n">a</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// gives 1</span>
</code></pre></div></div>

<h2 id="arrays">Arrays</h2>

<p>To instantiate an array in C, you do:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">type</span> <span class="n">name</span><span class="p">[];</span>
<span class="c1">// for example</span>
<span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">b</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span> <span class="p">};</span> <span class="c1">// b[3] - b[9] are initialized to zero</span>
<span class="kt">int</span> <span class="n">c</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span> <span class="p">};</span> <span class="c1">// same as int c[3] = { 1,2,3 }</span>

<span class="c1">// notice that in C, char is 1 byte. In Java, char is 2 bytes</span>
<span class="kt">char</span> <span class="n">d</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">97</span><span class="p">,</span><span class="mi">98</span><span class="p">,</span><span class="mi">99</span><span class="p">,</span><span class="mi">0</span><span class="p">};</span>	
<span class="kt">char</span> <span class="n">e</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="sc">'a'</span><span class="p">,</span><span class="sc">'b'</span><span class="p">,</span><span class="sc">'c'</span><span class="p">,</span><span class="sc">'\0'</span><span class="p">};</span>	<span class="c1">// same as above</span>
</code></pre></div></div>

<p>Now, in your memory space, <strong>arrays are guaranteed to be allocated to contiguous blocks/cells</strong>.</p>

<p>For example:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">val</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">11</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">44</span><span class="p">,</span><span class="mi">55</span><span class="p">,</span><span class="mi">66</span><span class="p">,</span><span class="mi">77</span><span class="p">};</span>
</code></pre></div></div>

<p><img src="\lectures\images\typora-user-images\image-20201002021658104.png" alt="image-20201002021658104" style="zoom:67%;" /></p>

<p>where:</p>

<ul>
  <li>each memory location differ each other by <strong>4 bytes</strong>, which is precisely the size of <code class="language-plaintext highlighter-rouge">int</code></li>
</ul>

<h3 id="pointing-to-an-array">“Pointing” to an Array</h3>

<p>You cannot point to a type array directly, but you can <strong>point to the first element of an array</strong>.</p>

<p>For example:</p>

<p><img src="\lectures\images\typora-user-images\image-20201002021658104.png" alt="image-20201002021658104" style="zoom:67%;" /></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">val</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">11</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">44</span><span class="p">,</span><span class="mi">55</span><span class="p">,</span><span class="mi">66</span><span class="p">,</span><span class="mi">77</span><span class="p">};</span>
<span class="kt">int</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>	<span class="c1">// points to the first element in the array</span>
					<span class="c1">// so basically p holds the value 88820</span>
</code></pre></div></div>

<p>Therefore, looping over the array would be:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">7</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="n">i</span><span class="p">));</span>
<span class="p">}</span>

<span class="c1">// or, you could have</span>
<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">7</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="o">*</span><span class="n">p</span><span class="p">);</span>
    <span class="n">p</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// the more terse way</span>
<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">7</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>	<span class="c1">// ++ binds more tighly then *</span>
<span class="p">}</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>in the first case, your pointer still <strong>points to the beginning of the array</strong></li>
  <li>in the second and the last case, your pointer will <strong>point <em>pass</em> the end, which is allowed in C</strong></li>
</ul>

<h3 id="automatic-type-conversion-of-array">Automatic Type Conversion of Array</h3>

<p>In most of the cases, when you use/pass an array, the <strong>array will be automatically converted to a pointer pointing to the first element.</strong></p>

<p>For example:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">};</span>
<span class="kt">int</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>	<span class="c1">// same as *p = &amp;a[0];</span>

<span class="c1">// and you can also do</span>
<span class="n">a</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>	<span class="c1">// same as  &amp;a[0]+1 = p+1 = a[1]</span>
<span class="o">*</span><span class="n">a</span><span class="p">;</span>		<span class="c1">// same as *p</span>
</code></pre></div></div>

<p>But in some rare cases, arrays are just arrays:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">sizeof</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>	<span class="c1">// returns 40 instead of 8</span>
<span class="k">sizeof</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>	<span class="c1">// returns 8</span>
</code></pre></div></div>

<blockquote>
  <p><strong>Theorem:</strong></p>

  <ul>
    <li>
      <p>In <strong>most cases</strong>, when you have an array <code class="language-plaintext highlighter-rouge">a</code>:</p>

      <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// passing around a around means</span>
<span class="c1">// a =&gt; &amp;a[0] = p</span>
</code></pre></div>      </div>

      <ul>
        <li>the only few exceptions would be the <code class="language-plaintext highlighter-rouge">sizeof()</code>.</li>
      </ul>
    </li>
  </ul>
</blockquote>

<h3 id="passing-array-into-functions">Passing Array into Functions</h3>

<p>In short, you <strong>CANNOT pass arrays <code class="language-plaintext highlighter-rouge">int a[]</code> into functions</strong>. What happens <strong>automatically is the conversion to from <code class="language-plaintext highlighter-rouge">a =&gt; &amp;a[0]</code></strong></p>

<p>Therefore, whenever you have a method/function:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">f1</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="mi">10</span><span class="p">]){</span>
    <span class="p">...</span>
    <span class="n">printf</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">a</span><span class="p">));</span>	<span class="c1">// prints 8	= size of pointer</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">f2</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">a</span><span class="p">){</span>
    <span class="p">...</span>
    <span class="n">printf</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">a</span><span class="p">));</span>	<span class="c1">// prints 8	= size of pointer</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="o">*</span><span class="nf">f3</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">a</span><span class="p">){</span>
    <span class="p">...</span>
    <span class="k">return</span> <span class="n">a</span><span class="p">;</span>	<span class="c1">// return an int pointer</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">};</span>
    <span class="n">printf</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">a</span><span class="p">));</span>	<span class="c1">// prints 40 = size of actual array</span>
    <span class="n">f1</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
    <span class="n">f2</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>You cannot return arrays as well. You <strong>can only return pointers</strong>.</li>
  <li>As you have noticed, the <strong>size information would be lost</strong> to any other method than the one you declared the array.</li>
</ul>

<h3 id="grand-unified-theory-of-arrays">Grand Unified Theory of Arrays</h3>

<p>And in general:</p>

<blockquote>
  <p><strong>Grand Unified Theory:</strong></p>

  <ul>
    <li>
      <p>Since arrays <code class="language-plaintext highlighter-rouge">a</code> are <strong>most often automatically converted to pointers</strong>, we have</p>

      <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>	<span class="c1">// same as</span>
<span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>	<span class="c1">// same as</span>
<span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</code></pre></div>      </div>
    </li>
    <li>
      <p>Therefore, this means <strong>for any array <code class="language-plaintext highlighter-rouge">x</code></strong>:</p>

      <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">y</span><span class="p">]</span>
</code></pre></div>      </div>
    </li>
    <li>
      <p>For machines, all it uses is the <strong>LHS expression all the time <code class="language-plaintext highlighter-rouge">*(x+y)</code></strong></p>
    </li>
  </ul>
</blockquote>

<p>Therefore, corollaries take place easily:</p>

<blockquote>
  <p><strong>Corollaries:</strong></p>

  <ul>
    <li>
      <p>This means that:</p>

      <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">*</span><span class="n">a</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div>      </div>
    </li>
  </ul>
</blockquote>

<p>And this also means that:</p>

<blockquote>
  <p><strong>Corollaries:</strong></p>

  <ul>
    <li>
      <p>This also means that:</p>

      <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">[</span><span class="n">a</span><span class="p">];</span>
<span class="c1">// because 0[a] = *(0+a) = *(a+0) = a[0]</span>
</code></pre></div>      </div>

      <p><strong>is allowed</strong> (obviously discouraged).</p>
    </li>
  </ul>
</blockquote>

<h2 id="heap">Heap</h2>

<p>Basically, stack memory are also called <strong>function stack, because when functions finish executing, those memories get removed</strong>.</p>

<p>However, what if we want to have a <strong>persistent memory block across functions</strong>?</p>

<p>This is done by <strong>storing data inside your heap</strong>:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// notice the return type</span>
<span class="kt">int</span> <span class="o">*</span><span class="nf">foo</span><span class="p">(){</span>
    <span class="kt">int</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>	<span class="c1">// memory allocate 40 bytes in heap</span>
    							<span class="c1">// notice you can use AN EXPRESSION inside malloc</span>
    <span class="k">return</span> <span class="n">p</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="kt">int</span> <span class="o">*</span><span class="n">a</span> <span class="o">=</span> <span class="n">foo</span><span class="p">();</span>	<span class="c1">// fetches that array in the heap</span>
<span class="p">}</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">malloc()</code> <strong>returns an address/pointer</strong> to the <strong>first cell memory/byte</strong>.</li>
</ul>

<blockquote>
  <p><mark>**Note**</mark>:</p>

  <ul class="task-list">
    <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />The key difference between using a <code class="language-plaintext highlighter-rouge">static</code> version of it and using <code class="language-plaintext highlighter-rouge">malloc</code> in heap is that <strong><code class="language-plaintext highlighter-rouge">malloc</code> can dynamically determine its sizes at RUNTIME (therefore allowing expressions)</strong>, but <strong><code class="language-plaintext highlighter-rouge">static</code> requires it to know at COMPILE TIME (therefore requiring literals/values)</strong>.</li>
  </ul>
</blockquote>

<p>And this is what happens:</p>

<p><img src="\lectures\images\typora-user-images\image-20201002031900143.png" alt="image-20201002031900143" style="zoom: 50%;" /></p>

<p>where:</p>

<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">p</code> went away</strong> as function stack finished, but <strong>the array survived since we made it to the heap</strong>.</li>
</ul>

<p>Now, because storage in your heap is persistent, whenever you <strong>finished using it</strong>, you need to <strong>free your memory</strong>:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="kt">int</span> <span class="o">*</span><span class="n">a</span> <span class="o">=</span> <span class="n">foo</span><span class="p">();</span>
    <span class="p">...</span>
    <span class="n">free</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>	<span class="c1">// free the memory</span>
<span class="p">}</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">free()</code> <strong>takes an address/pointer</strong>.</li>
</ul>

<blockquote>
  <p><strong>Note:</strong></p>

  <ul class="task-list">
    <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />If you <strong>finished</strong> executing your program, <strong>all spaces will get cleaned automatically</strong>.</li>
    <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />If you <strong>did not finish</strong> the program, but <strong>lost the handle to heap memory</strong>, then you have a <strong>memory leak</strong> because you cannot <code class="language-plaintext highlighter-rouge">free()</code> it anymore.</li>
  </ul>
</blockquote>

<blockquote>
  <p><strong>Theorem:</strong></p>

  <ul>
    <li>You <strong>cannot return a pointer to a local variable</strong> in a function/method. If you actually need that, you need to use <code class="language-plaintext highlighter-rouge">malloc()</code>.</li>
  </ul>
</blockquote>

<h2 id="string">String</h2>

<p>There is <strong>no type <code class="language-plaintext highlighter-rouge">string</code> in C</strong>. The only type that holds such data is exactly a <code class="language-plaintext highlighter-rouge">char</code> array.</p>

<ul>
  <li>This is in fact the same in Java, as Java implements a <code class="language-plaintext highlighter-rouge">String</code> using a <code class="language-plaintext highlighter-rouge">char</code> array, but C does not implement it.</li>
</ul>

<p>However, the only difference for the compile to tell between a string and a char array is that:</p>

<ul>
  <li><strong>a string is a <code class="language-plaintext highlighter-rouge">char</code> array ending with character <code class="language-plaintext highlighter-rouge">\0</code></strong>, which is called a <strong><em>null character</em></strong>
    <ul>
      <li>how the end of a string is defined</li>
    </ul>
  </li>
  <li>if you use a <strong>literal, use <code class="language-plaintext highlighter-rouge">""</code></strong></li>
</ul>

<p>For example:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">char</span> <span class="n">c</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span><span class="sc">'a'</span><span class="o">,</span><span class="sc">'b'</span><span class="o">,</span><span class="sc">'c'</span><span class="o">,</span><span class="sc">'\0'</span><span class="o">};</span>
<span class="c1">// is the same as, and vice versa</span>
<span class="kt">char</span> <span class="n">d</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span> <span class="o">=</span> <span class="s">"abc"</span><span class="o">;</span>

<span class="c1">//but</span>
<span class="kt">char</span> <span class="o">*</span><span class="n">pmessage</span> <span class="o">=</span> <span class="s">"now is the time"</span><span class="o">;</span>
<span class="c1">// is different from</span>
<span class="kt">char</span> <span class="n">amessage</span><span class="o">[]</span> <span class="o">=</span> <span class="s">"now is the time"</span><span class="o">;</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>the last case is special with string, because <code class="language-plaintext highlighter-rouge">"abc"</code>  literal will be <strong>immediately converted to <code class="language-plaintext highlighter-rouge">char *p</code> which points to the first char <code class="language-plaintext highlighter-rouge">"a"</code>.</strong>
    <ul>
      <li>the <strong><em>only case where you have a string and not use a pointer is the first and second line in the above example.</em></strong></li>
    </ul>
  </li>
</ul>

<p>This is what actually happens:</p>

<p><img src="\lectures\images\typora-user-images\image-20201001005504947.png" alt="image-20201001005504947" style="zoom:67%;" /></p>

<p>where:</p>

<ul>
  <li>obviously <code class="language-plaintext highlighter-rouge">pmessage</code> will <strong>NOT be mutable</strong></li>
  <li>but <code class="language-plaintext highlighter-rouge">amessage</code> will <strong>be mutable</strong></li>
</ul>

<p>Therefore, to <strong>advance in your pointer’s string</strong>, you do:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// prints "hello"</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="s">"hello"</span><span class="p">);</span>	<span class="c1">// prints the first char in the pointer, then moves on, until hitting the \0</span>
<span class="c1">// prints "ello"</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="s">"hello"</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>	<span class="c1">// prints the second char in the pointer, then moves on, until hitting the \0</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>in fact, <code class="language-plaintext highlighter-rouge">printf()</code>, and with <strong>most functions in C</strong>, they automatically <strong>converts the <code class="language-plaintext highlighter-rouge">array</code> data type to a <code class="language-plaintext highlighter-rouge">pointer</code> of that data type</strong>
    <ul>
      <li>e.g. <code class="language-plaintext highlighter-rouge">int c[]</code> becomes type <code class="language-plaintext highlighter-rouge">int *</code> to the first element</li>
    </ul>
  </li>
</ul>

<h3 id="empty-string">Empty String</h3>

<p>By the design of C for string, an empty string would be:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// both are empty strings</span>
<span class="kt">char</span> <span class="n">empty</span><span class="p">[]</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span>
<span class="kt">char</span> <span class="n">empty</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="sc">'\0'</span><span class="p">};</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>notice that it technically has a content, but it is just <strong>directly the end of the string</strong>.</li>
</ul>

<h3 id="example-string-copy">Example: String Copy</h3>

<p>Consider the following program:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="kt">char</span> <span class="n">t</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="o">=</span><span class="s">"abc"</span><span class="p">;</span>
    <span class="n">strcpy</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">s</span><span class="p">);</span>	<span class="c1">// t gets automatically converted to char *, because it is an array</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">strcpy</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">t</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">){</span>
    <span class="k">while</span><span class="p">((</span><span class="o">*</span><span class="n">t</span><span class="o">=*</span><span class="n">s</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">){</span>
        <span class="n">t</span><span class="o">++</span><span class="p">;</span>	<span class="c1">// address advances</span>
        <span class="n">s</span><span class="o">++</span><span class="p">;</span>	<span class="c1">// address advances</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// however, a cleaner way to write it is:</span>
<span class="kt">void</span> <span class="nf">strcpy</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">t</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">){</span>
    <span class="c1">// *t++ is the same as *(t++)</span>
    <span class="k">while</span><span class="p">((</span><span class="o">*</span><span class="n">t</span><span class="o">++=*</span><span class="n">s</span><span class="o">++</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">);</span>	<span class="c1">// the only substle difference is that the ending pointer actually points pass the "array"</span>
<span class="p">}</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>notice that the pointers passed in <code class="language-plaintext highlighter-rouge">t</code> and <code class="language-plaintext highlighter-rouge">s</code> are a <strong>new copy of the original pointers</strong>. Everything passed in a function is a copy/value.
    <ul>
      <li>this means the <strong>external <code class="language-plaintext highlighter-rouge">t</code> and <code class="language-plaintext highlighter-rouge">s</code> in the <code class="language-plaintext highlighter-rouge">main()</code> function</strong> is <strong>not altered</strong></li>
    </ul>
  </li>
</ul>

<p>and this is what happens under the hood:</p>

<p><img src="\lectures\images\typora-user-images\image-20201001011855722.png" alt="image-20201001011855722" style="zoom: 67%;" /></p>

<p>where:</p>

<ul>
  <li>notice how <strong>scope</strong> is also illustrated in the above diagram</li>
</ul>

<h4 id="safer-string-copy">Safer String Copy</h4>

<p>However, how does your program know if you have allocated the correct space for it?</p>

<p>Consider the case:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="kt">char</span> <span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="o">=</span><span class="s">"abc"</span><span class="p">;</span>
    <span class="n">strcpy</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">s</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>If we used our previous method, then C will simply <strong><em>overwrite</em></strong> useful data beyond the storage of <code class="language-plaintext highlighter-rouge">t</code>. This might crash your program.</p>

<p>Therefore, a safer version of it would be:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">strncpy</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">t</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">n</span><span class="p">);</span>	<span class="c1">// where size_t is an unsigned integer telling it the upper limit to write to</span>
</code></pre></div></div>

<h3 id="example-string-concat">Example: String Concat</h3>

<p>Another example of clean code would be concatenating a string to the end.</p>

<p>Consider:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="kt">char</span> <span class="n">t</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>	<span class="c1">// having the correct size makes sure space are allocated correctly beforehand</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="o">=</span><span class="s">"abc"</span><span class="p">;</span>
    <span class="n">strcpy</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">s</span><span class="p">);</span>
    
    <span class="n">strcat</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s">"ab"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">strcat</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">t</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">){</span>
    <span class="k">while</span><span class="p">(</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="n">t</span><span class="o">++</span><span class="p">;</span>
    <span class="n">strcpy</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">s</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="safer-string-concat">Safer String Concat</h4>

<p>Similar to the String copy, you have the same problem. Therefore, there is a safer alternative:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">strncat</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">t</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">n</span><span class="p">);</span>	<span class="c1">// where size_t is an unsigned integer telling it the upper limit to write to</span>
</code></pre></div></div>

<h2 id="command-line-arguments">Command Line Arguments</h2>

<p>Basically you need to variables to get those command line arguments: <code class="language-plaintext highlighter-rouge">argc</code> and <code class="language-plaintext highlighter-rouge">argv</code>.</p>

<p>This is how you write a program that <strong>takes command line arguments.</strong></p>

<ul>
  <li>a variable <code class="language-plaintext highlighter-rouge">int argc</code> that tells you <strong>how many arguments are executed</strong></li>
  <li>a variable <code class="language-plaintext highlighter-rouge">char **argv</code> that gives you a pointer to the first element in an array, each element of which contains an string (<code class="language-plaintext highlighter-rouge">char []</code>).</li>
</ul>

<p>Now, consider this call:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo </span>hello, world
</code></pre></div></div>

<p><img src="\lectures\images\typora-user-images\image-20201001020130321.png" alt="image-20201001020130321" style="zoom: 80%;" /></p>

<p>where:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">argc</code> is of size 3</li>
  <li><code class="language-plaintext highlighter-rouge">*argv</code> is of size 4</li>
</ul>

<blockquote>
  <p><strong>Extension:</strong></p>

  <ul>
    <li>whenever you execute things like <code class="language-plaintext highlighter-rouge">echo hello</code> in your terminal, all the array <code class="language-plaintext highlighter-rouge">argv</code> and <code class="language-plaintext highlighter-rouge">argc</code> will be <strong>handled by your OS and given to you</strong>.</li>
  </ul>
</blockquote>

<p>And your program would look like:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">){</span>
    <span class="n">argv</span><span class="o">++</span><span class="p">;</span>	<span class="c1">// moves the pointer/memory location forward</span>
    <span class="k">while</span><span class="p">(</span><span class="o">*</span><span class="n">argv</span><span class="p">){</span>	<span class="c1">// the last element is 0, hence will be false</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="o">*</span><span class="n">argv</span><span class="o">++</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h1 id="week-5">Week 5</h1>

<p>Reading: K&amp;R2, chapters 5 and 6</p>

<h2 id="const"><code class="language-plaintext highlighter-rouge">const</code></h2>

<p>Basically, any variable that is made <code class="language-plaintext highlighter-rouge">const</code> <strong>cannot be changed</strong>. This is a good alternative to <code class="language-plaintext highlighter-rouge">#define</code>.</p>

<p>For example:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">const</span> <span class="kt">int</span> <span class="n">CONST_VALUE</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="n">CONST_VALUE</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span>  <span class="c1">// throws compiler error</span>
</code></pre></div></div>

<p>The more interesting usage is using <code class="language-plaintext highlighter-rouge">const</code> with a <strong>pointer</strong>:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">const char *t</code>
    <ul>
      <li>this means the <strong>value that <code class="language-plaintext highlighter-rouge">t</code> points to</strong> cannot change, e.g. you cannot do <code class="language-plaintext highlighter-rouge">*t = 'a';</code></li>
      <li><strong>this essentially made the data <code class="language-plaintext highlighter-rouge">t</code> points to become read-only</strong></li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">char const *t</code>
    <ul>
      <li>this means that the <strong>pointer</strong> <code class="language-plaintext highlighter-rouge">t</code> cannot change, e.g. you cannot do <code class="language-plaintext highlighter-rouge">t++</code>.</li>
    </ul>
  </li>
</ul>

<hr />

<p><strong><em>For example:</em></strong></p>

<ul>
  <li>
    <p><strong>Question:</strong></p>

    <p>How do you implement a safer <code class="language-plaintext highlighter-rouge">strcopy()</code> function using <code class="language-plaintext highlighter-rouge">const</code>?</p>
  </li>
  <li>
    <p><strong>Solution:</strong></p>

    <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">strcopy</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">t</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">){</span>	<span class="c1">// therefore, pointer s is made read-only</span>
    <span class="k">while</span><span class="p">((</span><span class="o">*</span><span class="n">t</span><span class="o">++</span> <span class="o">=</span> <span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
  
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">a</span> <span class="o">=</span> <span class="s">"ABC"</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">b</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
    <span class="n">strcopy</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>	<span class="c1">// works, as char * can always be treated as const char *</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ul>

<hr />

<p>However, there is a trick to <strong>remove <code class="language-plaintext highlighter-rouge">const</code> by casting</strong>:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">strcopy</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">t</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">){</span>	<span class="c1">// here s is read-only</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">s2</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">s</span><span class="p">;</span>	<span class="c1">// casting to make s2 not read-only</span>
    <span class="k">while</span><span class="p">((</span><span class="o">*</span><span class="n">t</span><span class="o">++</span> <span class="o">=</span> <span class="o">*</span><span class="n">s2</span><span class="o">++</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">);</span>	<span class="c1">// now you can modify the value of s using s2, though not shown here</span>
<span class="p">}</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>obviously this is not a good practice, but <strong>sometimes/rarely it is used/necessary.</strong></li>
</ul>

<blockquote>
  <p><strong>Note:</strong></p>

  <ul class="task-list">
    <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />This means that you can <strong>pass <code class="language-plaintext highlighter-rouge">char *</code> directly into <code class="language-plaintext highlighter-rouge">const char *</code></strong>, i.e. you <strong>can be more restrictive</strong>.</li>
    <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />But you cannot <strong>(will get a warning</strong>) <strong>pass <code class="language-plaintext highlighter-rouge">const char *</code> into <code class="language-plaintext highlighter-rouge">char *</code></strong>, i.e. you <strong>cannot be less restrictive</strong>.</li>
    <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />Making a variable <code class="language-plaintext highlighter-rouge">const</code> <strong><em>does not change the memory location of the variables</em></strong> (does not move them to read-only). It is <strong>just a restriction that compiler checks.</strong></li>
  </ul>
</blockquote>

<h2 id="pointers-to-functions">Pointers to Functions</h2>

<p>An example of it would be to consider the <code class="language-plaintext highlighter-rouge">quicksort</code> implementation of <code class="language-plaintext highlighter-rouge">C</code>:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">qsort</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">base</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">nmemb</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">,</span>
                  <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">compar</span><span class="p">)(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="p">));</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">void *base</code> is the <strong>pointer to the first member</strong> of the array</p>
  </li>
  <li><code class="language-plaintext highlighter-rouge">size_t nmemb</code> basically describes the <strong>number of members in the array</strong>
    <ul>
      <li>the type <code class="language-plaintext highlighter-rouge">size_t</code> is basically an <code class="language-plaintext highlighter-rouge">int</code> or <code class="language-plaintext highlighter-rouge">unsigned_long</code></li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">size_t size</code> describes the <strong>byte size of each element</strong>
    <ul>
      <li>this is needed since that array is <code class="language-plaintext highlighter-rouge">void *</code>, being <strong>generic</strong></li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">int (*compar)(const void *, const void *)</code> is a pointer to a function called <code class="language-plaintext highlighter-rouge">compar</code> which compares the elements you are putting in
    <ul>
      <li>this means that <strong>functions also have type</strong>: <code class="language-plaintext highlighter-rouge">int (*)(const void *, const void *)</code></li>
    </ul>
  </li>
</ul>

<p>and to use it, you need to have the following:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">compareInt</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">b</span><span class="p">){</span>
    <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">)</span><span class="n">a</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">)</span><span class="n">b</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">-</span><span class="n">y</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mi">27</span><span class="p">,</span><span class="mi">2</span> <span class="p">};</span>
    <span class="n">qsort</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">compareInt</span><span class="p">);</span>	<span class="c1">// notice the &amp;compareInt</span>
<span class="p">}</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>you are passing in a <strong>pointer to a function</strong></li>
  <li>the <strong>address of your function is stored in your code section</strong> (below heap)</li>
</ul>

<h3 id="parsing-a-pointer-function">Parsing a Pointer Function</h3>

<p>Basically, to see what is happening, you need to use the <strong>counter-clockwise spiral out rule</strong>. The simple version:</p>

<p>Consider:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                     +-------+
                     | +-+   |
                     | ^ |   |
                char <span class="k">*</span>str[10]<span class="p">;</span>
                 ^   ^   |   |
                 |   +---+   |
                 +-----------+
</code></pre></div></div>

<ul>
  <li>
    <p>you <strong><em>start with the name</em></strong>, which is <strong><code class="language-plaintext highlighter-rouge">str</code></strong>, then:</p>

    <blockquote>
      <p><code class="language-plaintext highlighter-rouge">str</code> is …</p>
    </blockquote>
  </li>
  <li>
    <p>We move in a spiral clockwise direction starting with <code class="language-plaintext highlighter-rouge">str</code> and the first character we see is a <code class="language-plaintext highlighter-rouge">[</code> so, that means we have an array, so…</p>

    <blockquote>
      <p><code class="language-plaintext highlighter-rouge">str</code> is an <strong>array of size 10</strong> of…</p>
    </blockquote>
  </li>
  <li>
    <p>Continue in a spiral clockwise direction, and the next thing we encounter is the <code class="language-plaintext highlighter-rouge">*</code> so, that means we have pointers, so…</p>

    <blockquote>
      <p><code class="language-plaintext highlighter-rouge">str</code> is an array of size 10 of <strong>pointers</strong> to…</p>
    </blockquote>
  </li>
  <li>
    <p>Continue in a spiral direction and we see the end of the line (the <code class="language-plaintext highlighter-rouge">;</code>), so keep going and we get to the type <code class="language-plaintext highlighter-rouge">char</code>, so…</p>

    <blockquote>
      <p><code class="language-plaintext highlighter-rouge">str</code> is an array of size 10 of <strong>pointers to <code class="language-plaintext highlighter-rouge">char</code></strong></p>
    </blockquote>
  </li>
  <li>
    <p>We have now “visited’’ every token; therefore we are done!</p>
  </li>
</ul>

<p>Now, the example of a <strong>pointer function</strong>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                     +--------------------+
                     | +---+              |
                     | |+-+|              |
                     | |^ <span class="o">||</span>              |
                char <span class="k">*</span><span class="o">(</span><span class="k">*</span>fp<span class="o">)(</span> int, float <span class="k">*</span><span class="o">)</span><span class="p">;</span>
                 ^   ^ ^  <span class="o">||</span>              |
                 |   | +--+|              |
                 |   +-----+              |
                 +------------------------+
</code></pre></div></div>

<ul>
  <li>
    <p>you start with the name, which is <strong><code class="language-plaintext highlighter-rouge">fp</code></strong>, then:</p>

    <blockquote>
      <p><code class="language-plaintext highlighter-rouge">fp</code> is a…</p>
    </blockquote>
  </li>
  <li>
    <p>Moving in a spiral clockwise direction, the first thing we see is <strong>a <code class="language-plaintext highlighter-rouge">)</code></strong>; therefore,  since <code class="language-plaintext highlighter-rouge">fp</code> is inside parenthesis, so we need to <strong>continue the spiral inside the parenthesis</strong> and the next character seen is the <code class="language-plaintext highlighter-rouge">*</code>, so…</p>

    <blockquote>
      <p><code class="language-plaintext highlighter-rouge">fp</code> is a <strong>pointer</strong> to…</p>
    </blockquote>
  </li>
  <li>
    <p>We are now out of the parenthesis and continuing in a spiral clockwise direction, we see the <code class="language-plaintext highlighter-rouge">(</code>; therefore, we have a function, so…</p>

    <blockquote>
      <p><code class="language-plaintext highlighter-rouge">fp</code> is a <strong>pointer to a function</strong> passing an int and a pointer to float returning…</p>
    </blockquote>
  </li>
  <li>
    <p>Continuing in a spiral fashion, we then see the `*’ character, so…</p>

    <blockquote>
      <p><code class="language-plaintext highlighter-rouge">fp </code>is a pointer to a function passing an int and a pointer to float <strong>returning a pointer</strong> to…</p>
    </blockquote>
  </li>
  <li>
    <p>Continuing in a spiral fashion we see the <code class="language-plaintext highlighter-rouge">;</code>, but we haven’t visited all tokens, so we continue and finally get to the type <code class="language-plaintext highlighter-rouge">char</code>, so…</p>

    <blockquote>
      <p><code class="language-plaintext highlighter-rouge">fp </code>is a pointer to a function passing an int and a pointer to float returning <strong>a pointer to a <code class="language-plaintext highlighter-rouge">char</code></strong></p>
    </blockquote>
  </li>
</ul>

<p>Now, try yourself and figure out what this is:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="o">*</span><span class="nf">f1</span> <span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">v1</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">v2</span><span class="p">);</span>
</code></pre></div></div>

<ul>
  <li>this is a <strong>normal function</strong>, that <strong>returns <code class="language-plaintext highlighter-rouge">int *</code></strong></li>
</ul>

<p>then:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">f2</span><span class="p">)</span> <span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">v1</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">v2</span><span class="p">);</span>  <span class="c1">// a variable/function pointer called (f2), that returns (int)</span>
</code></pre></div></div>

<ul>
  <li>this is a <strong>pointer function</strong>, which we have shown before</li>
</ul>

<hr />

<p><strong><em>For example:</em></strong></p>

<ul>
  <li>
    <p><strong>Question:</strong></p>

    <p>What is this?</p>

    <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">f3</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span> <span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">v1</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">v2</span><span class="p">);</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>Solution:</strong></p>

    <p>Basically, <code class="language-plaintext highlighter-rouge">f3</code> is an array of size 5 that contains pointers to functions with arguments <code class="language-plaintext highlighter-rouge">int (*f3[5]) (const void *v1, const void *v2);</code> and returns an <code class="language-plaintext highlighter-rouge">int</code>.</p>

    <ul>
      <li>basically 5 functions placed into an array</li>
    </ul>
  </li>
</ul>

<h3 id="using-a-function-pointer">Using a Function Pointer</h3>

<p>Now, if you have the method:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">qsort</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">base</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">nmemb</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">,</span>
                  <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">compar</span><span class="p">)(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="p">)){</span>
    <span class="c1">// using that function compar</span>
    <span class="kt">int</span> <span class="n">compare</span> <span class="o">=</span> <span class="o">*</span><span class="n">compar</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span> <span class="c1">// comparing 2 and 5</span>
<span class="p">}</span>
</code></pre></div></div>

<p>However, since all you can do with a function pointer involves first dereferencing it, <strong><code class="language-plaintext highlighter-rouge">C</code> provides the shortcut</strong>:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">qsort</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">base</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">nmemb</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">,</span>
                  <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">compar</span><span class="p">)(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="p">)){</span>
    <span class="kt">int</span> <span class="n">compare</span> <span class="o">=</span> <span class="n">compar</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span> <span class="c1">// same effect as above</span>
<span class="p">}</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>this shortcut <strong>only works for function pointers</strong></li>
</ul>

<p><mark>End of Midterm 1 Material</mark></p>

<h2 id="inline-functions"><code class="language-plaintext highlighter-rouge">inline</code> Functions</h2>

<p><strong>Inline Function</strong> are those function whose definitions are small and be <strong>substituted at the place where its function call is happened</strong>. Function substitution is totally compiler choice.</p>

<ul>
  <li>for the GCC compiler, it <strong>does <em>not</em> inline replace any <code class="language-plaintext highlighter-rouge">inline</code> functions</strong> when not optimizing. To force the substitution, you need to <strong>use <code class="language-plaintext highlighter-rouge">static inline</code> so the compiler is forced to look at it</strong>.</li>
  <li>the <strong>advantage</strong> of this is that it will be <strong>faster</strong>, as the object code is directly placed inside the main function, hence there is no overhead when calling a function.</li>
  <li>the <strong>disadvantage</strong> is the file <strong>size</strong>.</li>
</ul>

<p>For example:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Inline function in C</span>
<span class="c1">// inline int foo() does not work</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">foo</span><span class="p">()</span> 
<span class="p">{</span> 
    <span class="k">return</span> <span class="mi">2</span><span class="p">;</span> 
<span class="p">}</span> 
  
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
<span class="p">{</span>   
    <span class="kt">int</span> <span class="n">ret</span><span class="p">;</span> 
  
    <span class="c1">// inline function call, ret becomes 2</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">foo</span><span class="p">();</span> 
  
    <span class="n">printf</span><span class="p">(</span><span class="s">"Output is: %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span> <span class="c1">// prints 2</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span> 
<span class="p">}</span> 
</code></pre></div></div>

<h1 id="week-6">Week 6</h1>

<p>Reading: K&amp;R2, chapters 5 and 6</p>

<h2 id="struct"><code class="language-plaintext highlighter-rouge">struct</code></h2>

<p>Basically like classes in Java, but you <strong>cannot actually build a method</strong> in <code class="language-plaintext highlighter-rouge">struct</code>.</p>

<ul>
  <li>basically, it will <strong>merely be a collection of data/primitives/objects</strong>.</li>
</ul>

<p>For example:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// defines a new type</span>
<span class="k">struct</span> <span class="n">Pt</span><span class="p">{</span>
    <span class="kt">double</span> <span class="n">x</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">y</span><span class="p">;</span>
<span class="p">};</span> <span class="c1">// notice this semi-colon</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="k">struct</span> <span class="n">Pt</span> <span class="n">p1</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">.</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">.</span><span class="mi">2</span><span class="p">};</span>
    
    <span class="kt">double</span> <span class="n">x1</span> <span class="o">=</span> <span class="n">p1</span><span class="p">.</span><span class="n">x</span><span class="p">;</span> <span class="c1">// will be 1.1</span>
    
    <span class="c1">// a pointer would also be fine on struct Pt</span>
    <span class="k">struct</span> <span class="n">Pt</span> <span class="o">*</span><span class="n">q1</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">p1</span><span class="p">;</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">q1</span><span class="p">).</span><span class="n">x</span><span class="p">;</span> <span class="c1">// makes x1 to be 1.1</span>
<span class="p">}</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>the new <strong>type</strong> is <code class="language-plaintext highlighter-rouge">struct Pt</code></li>
  <li>you can also initialize that <code class="language-plaintext highlighter-rouge">struct</code> by <strong>laying out its input in order</strong>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">structs</code> in C do not automatically initialize themselves to values such as <code class="language-plaintext highlighter-rouge">null</code>.</li>
    </ul>
  </li>
  <li>notice that the field <code class="language-plaintext highlighter-rouge">.</code> binds more tightly than dereferencing <code class="language-plaintext highlighter-rouge">*</code></li>
</ul>

<p>However, it is quite cumbersome to access its member via <code class="language-plaintext highlighter-rouge">(*q1).x</code>, so a shortcut is:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x1</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">q1</span><span class="p">).</span><span class="n">x</span><span class="p">;</span>
<span class="n">x1</span> <span class="o">=</span> <span class="n">q1</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">;</span> <span class="c1">// the same as above</span>
</code></pre></div></div>

<blockquote>
  <p><strong>Notes:</strong></p>

  <ul class="task-list">
    <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />To access <strong>fields</strong> of a <code class="language-plaintext highlighter-rouge">struct</code>, <strong>use <code class="language-plaintext highlighter-rouge">.</code></strong></li>
    <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />To access <strong>fields</strong> of a pointer to a <code class="language-plaintext highlighter-rouge">struct</code>, <strong>use <code class="language-plaintext highlighter-rouge">-&gt;</code></strong>.</li>
  </ul>
</blockquote>

<h3 id="inside-struct">Inside <code class="language-plaintext highlighter-rouge">struct</code></h3>

<p>As we have said before, <code class="language-plaintext highlighter-rouge">struct</code> is just the conglomeration of its constituent fields.</p>

<ol>
  <li>The <strong>size of a <code class="language-plaintext highlighter-rouge">struct</code> is basically the size of its constituents</strong>:</li>
</ol>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Pt</span> <span class="n">p1</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">.</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">.</span><span class="mi">2</span><span class="p">};</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"%lu</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">p1</span><span class="p">));</span> <span class="c1">// returns 8+8=16 bytes</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>basically shows <strong><em>that a <code class="language-plaintext highlighter-rouge">struct</code> is basically a conglomeration of its fields on the stack.</em></strong></li>
</ul>

<blockquote>
  <p><strong>Extension:</strong></p>

  <ul>
    <li>Sometimes, the size of a <code class="language-plaintext highlighter-rouge">struct</code> maybe larger than the size of its fields, and a <strong>padding</strong>(s) will be added. However, this is <strong>machine/CPU dependent</strong>. Some machines do not add paddings, but some does.</li>
  </ul>
</blockquote>

<ol>
  <li>The pointer to the <code class="language-plaintext highlighter-rouge">struct</code> will be the same as the pointer to its first field.</li>
</ol>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Pt</span> <span class="n">p1</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">.</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">.</span><span class="mi">2</span><span class="p">};</span>
<span class="k">struct</span> <span class="n">Pt</span> <span class="o">*</span><span class="n">q1</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">p1</span><span class="p">;</span>

<span class="c1">// below prints the same address</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"%p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">q1</span><span class="p">);</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"%p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">q1</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">);</span> <span class="c1">// same as &amp;(q1-&gt;x)</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>the <strong><em>same address</em> is printed</strong>, even though they have a <strong>different pointer type</strong>
    <ul>
      <li>therefore, pointer arithmetic and pointer dereferencing will also operate differently</li>
    </ul>
  </li>
</ul>

<p>For example:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Pt</span> <span class="n">p1</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">.</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">.</span><span class="mi">2</span><span class="p">};</span>
<span class="k">struct</span> <span class="n">Pt</span> <span class="o">*</span><span class="n">q1</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">p1</span><span class="p">;</span>

<span class="c1">// below prints different address</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"%p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">q1</span><span class="p">);</span> <span class="c1">// prints 0x7ffd1749a300</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"%p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">q1</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// prints 0x7ffd1749a310 = advanced 16 bytes, because it is HEX</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"%p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">q1</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// prints 0x7ffd1749a308 = advanced 8 bytes</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">+1</code> to a <code class="language-plaintext highlighter-rouge">struct</code> pointer will then move past the entire <code class="language-plaintext highlighter-rouge">struct</code> = <code class="language-plaintext highlighter-rouge">8+8=16</code> bytes</li>
  <li><code class="language-plaintext highlighter-rouge">+1</code> to a <code class="language-plaintext highlighter-rouge">double</code> pointer will obviously only increment <code class="language-plaintext highlighter-rouge">8</code> bytes</li>
</ul>

<h3 id="struct-variables"><code class="language-plaintext highlighter-rouge">struct</code> variables</h3>

<p>One syntax that is allowed but not used often is the following:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Point</span><span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>
</code></pre></div></div>

<p>This is simply analogous to having:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">;</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>obvious the only different is that we have a different type.</li>
</ul>

<p>you could basically treat the above as the same thing and do:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Point</span><span class="p">{</span>
    <span class="kt">double</span> <span class="n">x</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">y</span><span class="p">;</span>
<span class="p">}</span> <span class="n">x</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">.</span><span class="mi">0</span><span class="p">},</span> <span class="n">maxPt</span><span class="o">=</span><span class="p">{</span><span class="mi">5</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">.</span><span class="mi">0</span><span class="p">};</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>the <code class="language-plaintext highlighter-rouge">x</code> field inside the <code class="language-plaintext highlighter-rouge">struct</code> has nothing to do with the <code class="language-plaintext highlighter-rouge">x</code> variable outside.</li>
  <li>it is also <strong>syntactically allowed because <code class="language-plaintext highlighter-rouge">x.x</code> is clear that the outer<code class="language-plaintext highlighter-rouge">x</code> is referring to <code class="language-plaintext highlighter-rouge">struct Point</code></strong>.</li>
</ul>

<h3 id="example-linkedlist">Example: LinkedList</h3>

<p>Basically, the <code class="language-plaintext highlighter-rouge">struct Node</code> itself is trivial:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Node</span><span class="p">{</span>
    <span class="k">struct</span> <span class="n">Node</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">val</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="createnode"><code class="language-plaintext highlighter-rouge">createNode()</code></h4>

<p>First, we need to create a node:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Node</span> <span class="o">*</span><span class="nf">createNode</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">){</span>
    <span class="k">struct</span> <span class="n">Node</span> <span class="o">*</span><span class="n">node</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">Node</span><span class="p">));</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">node</span><span class="p">){</span>
        <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">node</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
    <span class="n">node</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">node</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div>

<p>where:</p>

<ul>
  <li>notice that <code class="language-plaintext highlighter-rouge">malloc()</code> returned a <code class="language-plaintext highlighter-rouge">void *</code>, and we made it a <code class="language-plaintext highlighter-rouge">struct Node *</code>. <strong><em>This means that for C, every <code class="language-plaintext highlighter-rouge">struct</code>/Object is just a piece of memory</em></strong>. And it is for the <strong>programmer to decide how to use that memory</strong> by <strong>casting it into a specific type</strong>.</li>
</ul>

<p>And if you consider in your <code class="language-plaintext highlighter-rouge">main()</code>:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="k">struct</span> <span class="n">Node</span> <span class="o">*</span><span class="n">node</span> <span class="o">=</span> <span class="n">createNode</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">node</span><span class="p">);</span> <span class="c1">// see next section</span>
    <span class="c1">// free(node);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Schematically, this is what happens:</p>

<p><img src="\lectures\images\typora-user-images\image-20201014192824946.png" alt="image-20201014192824946" style="zoom:50%;" /></p>

<p>where:</p>

<ul>
  <li>in the end, we need to of course <strong>remember to <code class="language-plaintext highlighter-rouge">free()</code> the memory in heap</strong></li>
</ul>

<h4 id="assert"><code class="language-plaintext highlighter-rouge">assert()</code></h4>

<p>This is basically a handy function to use for testing:</p>

<ul>
  <li>whenever the <strong>expression inside the bracket is <code class="language-plaintext highlighter-rouge">false</code></strong>, it <strong>quits the program</strong>
    <ul>
      <li>e.g. <code class="language-plaintext highlighter-rouge">assert(1==2);</code> will basically quit your program at that line every time</li>
    </ul>
  </li>
</ul>

<p>A sample usage with the above LinkedList would be:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="k">struct</span> <span class="n">Node</span> <span class="o">*</span><span class="n">node</span> <span class="o">=</span> <span class="n">createNode</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">node</span><span class="p">);</span> <span class="c1">// aborts the program if node is false/null/0</span>
    <span class="n">free</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>this needs the <strong>library</strong> <code class="language-plaintext highlighter-rouge">assert.h</code></li>
</ul>

<h4 id="create2nodes"><code class="language-plaintext highlighter-rouge">create2Nodes()</code></h4>

<p>This is not a standard function in a LinkedList, but it is a good exercise:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Node</span> <span class="o">*</span><span class="nf">creat2Nodes</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">){</span>
    <span class="k">struct</span> <span class="n">Node</span> <span class="o">*</span><span class="n">n2</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">Node</span><span class="p">));</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">n2</span><span class="p">){</span>
        <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">n2</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
    <span class="n">n2</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    
    <span class="k">struct</span> <span class="n">Node</span> <span class="o">*</span><span class="n">n1</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">Node</span><span class="p">));</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">n1</span><span class="p">){</span>
        <span class="n">free</span><span class="p">(</span><span class="n">n2</span><span class="p">);</span> <span class="c1">// at this point, n2 is malloced already</span>
        <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">n1</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
    <span class="n">n1</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">n2</span><span class="p">;</span>
    
    <span class="k">return</span> <span class="n">n1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>one line to take care would be <code class="language-plaintext highlighter-rouge">n1-&gt;next=n2;</code>, which takes the <strong>address of <code class="language-plaintext highlighter-rouge">n2</code></strong>, which <strong>points to the beginning of its own <code class="language-plaintext highlighter-rouge">struct Node</code></strong>, and <strong>copied to <code class="language-plaintext highlighter-rouge">n1-&gt;next</code></strong>.
    <ul>
      <li>therefore, now <strong><code class="language-plaintext highlighter-rouge">n1-&gt;next</code> points to the beginning of node <code class="language-plaintext highlighter-rouge">n2</code></strong>.</li>
    </ul>
  </li>
</ul>

<p>Then, to visit the nodes, you can have:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="k">struct</span> <span class="n">Node</span> <span class="o">*</span><span class="n">head</span> <span class="o">=</span> <span class="n">create2Nodes</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">head</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%d --&gt; %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">head</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">,</span> <span class="n">head</span><span class="o">-&gt;</span><span class="n">next</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">);</span> <span class="c1">// prints 10 -&gt; 20</span>
<span class="p">}</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>remember, <code class="language-plaintext highlighter-rouge">head-&gt;next</code> is <strong>type <code class="language-plaintext highlighter-rouge">struct Node *</code></strong> which points to the <strong>beginning of the second node</strong></li>
</ul>

<p>Lastly, to <code class="language-plaintext highlighter-rouge">free()</code> the memories correctly:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="k">struct</span> <span class="n">Node</span> <span class="o">*</span><span class="n">head</span> <span class="o">=</span> <span class="n">create2Nodes</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">head</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%d --&gt; %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">head</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">,</span> <span class="n">head</span><span class="o">-&gt;</span><span class="n">next</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">);</span>
    <span class="n">free</span><span class="p">(</span><span class="n">head</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">);</span> <span class="c1">// free the second one first</span>
    <span class="n">free</span><span class="p">(</span><span class="n">head</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>if you freed the <code class="language-plaintext highlighter-rouge">head</code> first, then you <strong>never get the reference to the second node anymore</strong>
    <ul>
      <li>this will cause permanent memory leak</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p><strong>Extension:</strong></p>

  <ul>
    <li>
      <p>This means an <strong>efficient algorithm</strong> for freeing the LinkedList would be actually first saving the next value:</p>

      <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">freeLinkedList</span><span class="p">(</span><span class="k">struct</span> <span class="n">Node</span> <span class="o">*</span><span class="n">head</span><span class="p">){</span>
    <span class="k">struct</span> <span class="n">Node</span> <span class="o">*</span><span class="n">saved</span><span class="o">=</span><span class="n">head</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">saved</span><span class="p">){</span>
        <span class="n">free</span><span class="p">(</span><span class="n">head</span><span class="p">);</span>
        <span class="n">head</span><span class="o">=</span><span class="n">saved</span><span class="p">;</span>
        <span class="n">saved</span><span class="o">=</span><span class="n">saved</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">free</span><span class="p">(</span><span class="n">head</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>      </div>
    </li>
  </ul>
</blockquote>

<h3 id="struct-as-value"><code class="language-plaintext highlighter-rouge">struct</code> as Value</h3>

<p>An interesting different between <code class="language-plaintext highlighter-rouge">struct</code> in C and <code class="language-plaintext highlighter-rouge">class</code> in Java is that <code class="language-plaintext highlighter-rouge">struct</code> only contains fields/data.</p>

<ol>
  <li>This means, when we are <strong>passing in/returning a <code class="language-plaintext highlighter-rouge">struct</code> into functions</strong>, it passes/returns in by <strong>value:</strong></li>
</ol>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;assert.h&gt;</span><span class="cp">
</span>
<span class="k">struct</span> <span class="n">Pt</span><span class="p">{</span>
    <span class="kt">double</span> <span class="n">x</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">y</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">Pt</span> <span class="nf">makePoint</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">){</span>
    <span class="k">struct</span> <span class="n">Pt</span> <span class="n">temp</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">};</span>
    <span class="c1">// this returns by VALUE!, even though temp disappeared</span>
    <span class="k">return</span> <span class="n">temp</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span> 
    <span class="k">struct</span> <span class="n">Pt</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">makePoint</span><span class="p">(</span><span class="mi">3</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%f and %f</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">p2</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p2</span><span class="p">.</span><span class="n">y</span><span class="p">);</span> <span class="c1">// actually printed 3.0 and 4.0</span>
<span class="p">}</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">temp</code> was a local variable, which disappeared after the function call. However, <code class="language-plaintext highlighter-rouge">return</code>ing a <code class="language-plaintext highlighter-rouge">struct</code> in C means returning by the <strong>values in that <code class="language-plaintext highlighter-rouge">struct</code></strong>.
    <ul>
      <li>as a result, you can imagine <strong><code class="language-plaintext highlighter-rouge">{3.0, 4.0}</code> was returned, and that becomes the content of <code class="language-plaintext highlighter-rouge">p2</code></strong>.</li>
    </ul>
  </li>
</ul>

<ol>
  <li>Therefore, other related operations such as assigning also are done by <strong>value:</strong></li>
</ol>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// same code omitted from above</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span> 
    <span class="k">struct</span> <span class="n">Pt</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">makePoint</span><span class="p">(</span><span class="mi">3</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
    <span class="k">struct</span> <span class="n">Pt</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">p1</span><span class="p">;</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%p and %p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">p1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">p2</span><span class="p">);</span> <span class="c1">// 0x7ffcf9bf7f50 and 0x7ffcf9bf7f40</span>
<span class="p">}</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>again, this shows that even <code class="language-plaintext highlighter-rouge">=</code> <strong>copies the <code class="language-plaintext highlighter-rouge">struct</code> by value</strong>. You get <strong>two distinctly different <code class="language-plaintext highlighter-rouge">struct</code> in Stack Memory but having the same value.</strong></li>
</ul>

<h2 id="exam-notes">Exam Notes</h2>

<ul>
  <li>
    <p><strong>Question</strong>:</p>

    <p>Draw the diagram for the code below, and tell me the output.</p>

    <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Node</span> <span class="p">{</span>
    <span class="kt">void</span> <span class="o">*</span> <span class="n">data</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">Node</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">struct</span> <span class="n">List</span><span class="p">{</span>
    <span class="k">struct</span> <span class="n">Node</span> <span class="o">*</span><span class="n">head</span><span class="p">;</span>
<span class="p">}</span>
  
<span class="k">struct</span> <span class="n">Node</span><span class="o">*</span> <span class="n">node1</span> <span class="o">=</span> <span class="p">...</span> <span class="c1">// assume this is correct</span>
<span class="k">struct</span> <span class="n">List</span> <span class="n">list</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="n">list</span><span class="o">-&gt;</span><span class="n">head</span> <span class="o">=</span> <span class="n">node1</span><span class="p">;</span>
</code></pre></div>    </div>

    <p>and what would be the output of the below:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>list.head
<span class="k">*</span>list
list[0].head
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>Solution</strong>:</p>

    <p><img src="\lectures\images\typora-user-images\image-20201029185412573.png" alt="image-20201029185412573" style="zoom: 50%;" /></p>

    <p>where:</p>

    <ul>
      <li>in the end, there are only four piece of data in the entire program</li>
      <li>note that <strong>both <code class="language-plaintext highlighter-rouge">list</code> and <code class="language-plaintext highlighter-rouge">&amp;list</code> would be <code class="language-plaintext highlighter-rouge">0X0A</code></strong>, which is the memory address of the first element in the array
        <ul>
          <li><code class="language-plaintext highlighter-rouge">list</code> means pointer to a <code class="language-plaintext highlighter-rouge">struct List</code></li>
          <li><code class="language-plaintext highlighter-rouge">&amp;list</code> means pointer to the entire <code class="language-plaintext highlighter-rouge">struct List []</code></li>
          <li>array is nothing than a contiguous block of memory</li>
        </ul>
      </li>
    </ul>

    <p>and output are:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>list.head <span class="c"># gives ERROR</span>
<span class="k">*</span>list <span class="c"># gives type struct List (actually, value stored by variable `head`)</span>
list[0].head <span class="c"># gives type struct Node * (actually, value stored by variable `head`)</span>
</code></pre></div>    </div>
  </li>
</ul>

<h1 id="week-7">Week 7</h1>

<h2 id="standard-io">Standard IO</h2>

<p>The <strong>C standard</strong> library automatically provides every running program <strong>with 3 <code class="language-plaintext highlighter-rouge">I/O</code> channels</strong></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">stdin</code> (standard input) <code class="language-plaintext highlighter-rouge">fd=0</code>:
    <ul>
      <li><strong>incoming</strong> character stream, normally from keyboard</li>
      <li>e.g. when you called <code class="language-plaintext highlighter-rouge">scanf()</code>, it takes the content from <code class="language-plaintext highlighter-rouge">stdin</code></li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">stdout</code> (standard output) <code class="language-plaintext highlighter-rouge">fd=1</code>:
    <ul>
      <li><strong>outgoing</strong> character stream, normally to terminal screen</li>
      <li><strong>buffered until newline</strong> comes or <strong>buffer is filled</strong>
        <ul>
          <li>e.g. unless your call with <code class="language-plaintext highlighter-rouge">printf()</code> <strong>has <code class="language-plaintext highlighter-rouge">\n</code></strong>, it is first buffered (so if your program crashed, and you didn’t have <code class="language-plaintext highlighter-rouge">\n</code>, nothing might be printed)</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">stderr</code> (standard error) <code class="language-plaintext highlighter-rouge">fd=2</code>:
    <ul>
      <li><strong>outgoing</strong> character stream, normally to terminal screen</li>
      <li><strong>unbuffered</strong>
        <ul>
          <li>e.g. will <strong>immediately</strong> show up in your terminal screen if you called <code class="language-plaintext highlighter-rouge">fprintf()</code></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="redirection">Redirection</h3>

<p>Basically, you can imagine your <strong>keyboard input being replaced by contents of a file</strong>.</p>

<ul>
  <li>You can have <code class="language-plaintext highlighter-rouge">stdin</code> come <strong>from</strong> (<code class="language-plaintext highlighter-rouge">&lt;</code>) <strong>a file</strong> instead of the keyboard:
    <ul>
      <li>
        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#isort is an executable taking an stdin number using `scanf()`</span>
<span class="c">#file_containing_a_number contains a number</span>
./isort &lt; file_containing_a_number
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<blockquote>
  <p><strong>Note:</strong></p>

  <ul>
    <li>
      <p>If you have <strong>more than one number</strong> in the file, and your program does:</p>

      <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span><span class="o">&amp;</span><span class="n">x</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>      </div>

      <p>Then <code class="language-plaintext highlighter-rouge">scanf()</code> will only read and take the <strong>part of the content that is continuous until met a white space</strong></p>
    </li>
  </ul>
</blockquote>

<ul>
  <li>
    <p>And have <code class="language-plaintext highlighter-rouge">stdout</code> go <strong>to</strong> (<code class="language-plaintext highlighter-rouge">&gt;</code>) <strong>a file</strong> instead of the screen:</p>

    <ul>
      <li>
        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./isort <span class="o">&gt;</span> my_sorting_result
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>Finally, use <code class="language-plaintext highlighter-rouge">2&gt;</code> to <strong>redirect <code class="language-plaintext highlighter-rouge">stderr</code> to a file</strong>:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./isort 2&gt; myerrors
</code></pre></div>    </div>
  </li>
</ul>

<p>For example, now you could <strong>combine the redirections</strong>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./a.out &lt; myinput <span class="o">&gt;</span> myoutout
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>first <code class="language-plaintext highlighter-rouge">./a.out &lt; myinput</code></li>
  <li>then outputs and overwrite the content in <code class="language-plaintext highlighter-rouge">myoutout</code></li>
</ul>

<p>However, if you want to append instead of overwrite:</p>

<ul>
  <li>
    <p><strong>Use <code class="language-plaintext highlighter-rouge">&gt;&gt;</code> to append</strong> to an existing file:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./a.out &lt; myinput <span class="o">&gt;&gt;</span> myoutout
</code></pre></div>    </div>
  </li>
</ul>

<h4 id="redirecting-valgrind">Redirecting <code class="language-plaintext highlighter-rouge">Valgrind</code></h4>

<p>Now, a typical <code class="language-plaintext highlighter-rouge">valgrind</code> looks like:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>valgrind <span class="nt">--leak-check</span><span class="o">=</span><span class="nb">yes</span> ./isort
&lt;mark&gt;410&lt;/mark&gt; Memcheck, a memory error detector
&lt;mark&gt;410&lt;/mark&gt; Copyright <span class="o">(</span>C<span class="o">)</span> 2002-2017, and GNU GPL<span class="s1">'d, by Julian Seward et al.
&lt;mark&gt;410&lt;/mark&gt; Using Valgrind-3.15.0 and LibVEX; rerun with -h for copyright info
&lt;mark&gt;410&lt;/mark&gt; Command: ./isort
&lt;mark&gt;410&lt;/mark&gt;
3
original: 2 78 56
ascending: 2 56 78
descending: 78 56 2
&lt;mark&gt;410&lt;/mark&gt;
&lt;mark&gt;410&lt;/mark&gt; HEAP SUMMARY:
&lt;mark&gt;410&lt;/mark&gt;     in use at exit: 0 bytes in 0 blocks
&lt;mark&gt;410&lt;/mark&gt;   total heap usage: 5 allocs, 5 frees, 2,084 bytes allocated
&lt;mark&gt;410&lt;/mark&gt;
&lt;mark&gt;410&lt;/mark&gt; All heap blocks were freed -- no leaks are possible
&lt;mark&gt;410&lt;/mark&gt;
&lt;mark&gt;410&lt;/mark&gt; For lists of detected and suppressed errors, rerun with: -s
&lt;mark&gt;410&lt;/mark&gt; ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
</span></code></pre></div></div>

<p>where:</p>

<ul>
  <li>every line <strong>starting with <code class="language-plaintext highlighter-rouge">&lt;mark&gt;410&lt;/mark&gt;</code> is actually <code class="language-plaintext highlighter-rouge">stderr</code></strong></li>
  <li><code class="language-plaintext highlighter-rouge">3</code> is the <code class="language-plaintext highlighter-rouge">stdin</code></li>
  <li>all the rest are <code class="language-plaintext highlighter-rouge">stdout</code></li>
</ul>

<p>Therefore, if you redirect <code class="language-plaintext highlighter-rouge">stdout</code> only, then you will only see the content:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">valgrind</span> <span class="o">--</span><span class="n">leak</span><span class="o">-</span><span class="n">check</span><span class="o">=</span><span class="n">yes</span> <span class="p">.</span><span class="o">/</span><span class="n">isort</span> <span class="o">&gt;</span> <span class="n">myout</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#inside myout</span>
original: 2 78 56
ascending: 2 56 78
descending: 78 56 2
</code></pre></div></div>

<p><strong>Hence, to redirect <code class="language-plaintext highlighter-rouge">stdout</code> and <code class="language-plaintext highlighter-rouge">stderr</code>, you can:</strong></p>

<ul>
  <li>
    <p>place them to two different files:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>valgrind <span class="nt">--leak-check</span><span class="o">=</span><span class="nb">yes</span> ./isort <span class="o">&gt;</span> myout 2&gt; myerrors
</code></pre></div>    </div>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#inside myout</span>
original: 2 78 56
ascending: 2 56 78
descending: 78 56 2
</code></pre></div>    </div>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#inside myerrors</span>
&lt;mark&gt;410&lt;/mark&gt; Memcheck, a memory error detector
&lt;mark&gt;410&lt;/mark&gt; Copyright <span class="o">(</span>C<span class="o">)</span> 2002-2017, and GNU GPL<span class="s1">'d, by Julian Seward et al.
&lt;mark&gt;410&lt;/mark&gt; Using Valgrind-3.15.0 and LibVEX; rerun with -h for copyright info
&lt;mark&gt;410&lt;/mark&gt; Command: ./isort
&lt;mark&gt;410&lt;/mark&gt;
&lt;mark&gt;410&lt;/mark&gt;
&lt;mark&gt;410&lt;/mark&gt; HEAP SUMMARY:
&lt;mark&gt;410&lt;/mark&gt;     in use at exit: 0 bytes in 0 blocks
&lt;mark&gt;410&lt;/mark&gt;   total heap usage: 5 allocs, 5 frees, 2,084 bytes allocated
&lt;mark&gt;410&lt;/mark&gt;
&lt;mark&gt;410&lt;/mark&gt; All heap blocks were freed -- no leaks are possible
&lt;mark&gt;410&lt;/mark&gt;
&lt;mark&gt;410&lt;/mark&gt; For lists of detected and suppressed errors, rerun with: -s
&lt;mark&gt;410&lt;/mark&gt; ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
</span></code></pre></div>    </div>
  </li>
  <li>
    <p>place them into the same file:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>valgrind <span class="nt">--leak-check</span><span class="o">=</span><span class="nb">yes</span> ./isort <span class="o">&gt;</span> myfinalout 2&gt;&amp;1
</code></pre></div>    </div>

    <p>where:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">2&gt;&amp;1</code> means <strong>redirect <code class="language-plaintext highlighter-rouge">2=stderr</code> in the <em>same manner</em> to the <em>same place</em> of <code class="language-plaintext highlighter-rouge">1=stdout</code></strong>.</li>
    </ul>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#inside myfinalout</span>
&lt;mark&gt;410&lt;/mark&gt; Memcheck, a memory error detector
&lt;mark&gt;410&lt;/mark&gt; Copyright <span class="o">(</span>C<span class="o">)</span> 2002-2017, and GNU GPL<span class="s1">'d, by Julian Seward et al.
&lt;mark&gt;410&lt;/mark&gt; Using Valgrind-3.15.0 and LibVEX; rerun with -h for copyright info
&lt;mark&gt;410&lt;/mark&gt; Command: ./isort
&lt;mark&gt;410&lt;/mark&gt;
original: 2 78 56
ascending: 2 56 78
descending: 78 56 2
&lt;mark&gt;410&lt;/mark&gt;
&lt;mark&gt;410&lt;/mark&gt; HEAP SUMMARY:
&lt;mark&gt;410&lt;/mark&gt;     in use at exit: 0 bytes in 0 blocks
&lt;mark&gt;410&lt;/mark&gt;   total heap usage: 5 allocs, 5 frees, 2,084 bytes allocated
&lt;mark&gt;410&lt;/mark&gt;
&lt;mark&gt;410&lt;/mark&gt; All heap blocks were freed -- no leaks are possible
&lt;mark&gt;410&lt;/mark&gt;
&lt;mark&gt;410&lt;/mark&gt; For lists of detected and suppressed errors, rerun with: -s
&lt;mark&gt;410&lt;/mark&gt; ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
</span></code></pre></div>    </div>
  </li>
  <li>
    <p><strong>Therefore, if we want to append instead of overwrite</strong>:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>valgrind <span class="nt">--leak-check</span><span class="o">=</span><span class="nb">yes</span> ./isort <span class="o">&gt;&gt;</span> README.txt 2&gt;&amp;1
</code></pre></div>    </div>

    <p>where:</p>

    <ul>
      <li>now <code class="language-plaintext highlighter-rouge">stdout</code> is <strong>appended</strong> to <code class="language-plaintext highlighter-rouge">README.txt</code></li>
      <li><code class="language-plaintext highlighter-rouge">stderr=2</code> is <strong>done in the same manner (also appended)</strong>, to the same place of <code class="language-plaintext highlighter-rouge">stdout=1</code> (the same file <code class="language-plaintext highlighter-rouge">README.txt</code>)</li>
    </ul>
  </li>
</ul>

<h4 id="perror"><code class="language-plaintext highlighter-rouge">perror</code></h4>

<p>This is a handy library method by <code class="language-plaintext highlighter-rouge">C</code>, such that it, by default (with no arguments:)</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">perror</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">);</span>
</code></pre></div></div>

<ul>
  <li>produces a message on <strong>standard error</strong> describing the <strong>last error encountered</strong> during a call to a system or library function.</li>
</ul>

<p>The powerful thing is that if you supply it with an <strong>argument</strong>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>perror<span class="o">(</span><span class="s2">"additional info"</span><span class="o">)</span><span class="p">;</span>
</code></pre></div></div>

<p>it will output in <code class="language-plaintext highlighter-rouge">stderr</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>additional info: whatever message perror had
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>your additional message automatically gets placed into the error message with <code class="language-plaintext highlighter-rouge">additional info: </code></li>
</ul>

<h3 id="pipeline">Pipeline</h3>

<p>A pipe connects <strong><code class="language-plaintext highlighter-rouge">stdout</code> of one program to <code class="language-plaintext highlighter-rouge">stdin</code></strong> of another program:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>prog1 | prog2 | prog3
</code></pre></div></div>

<ul>
  <li>a common example would be using <code class="language-plaintext highlighter-rouge">cat</code>:
    <ul>
      <li>e.g. <code class="language-plaintext highlighter-rouge">cat myinput | ./isort</code></li>
      <li>above will have the <strong>same effect</strong> as <code class="language-plaintext highlighter-rouge">./isort &lt; myinput</code></li>
    </ul>
  </li>
  <li>and <code class="language-plaintext highlighter-rouge">grep &lt;text&gt;</code>, which only prints out the <strong>line</strong> containing the word <code class="language-plaintext highlighter-rouge">text</code>
    <ul>
      <li>e.g. <code class="language-plaintext highlighter-rouge">cat myinput | ./isort | grep original</code></li>
      <li>above produces <code class="language-plaintext highlighter-rouge">original: 2 78 56</code></li>
    </ul>
  </li>
</ul>

<hr />

<p><strong><em>For example:</em></strong></p>

<ul>
  <li>
    <p><strong>Question:</strong></p>

    <p>Are the below two lines doing the same thing?</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>prog1 &lt; input_file | prog2 | prog3 <span class="o">&gt;</span> output_file
<span class="nb">cat </span>input_file | prog1 | prog2 | prog3 <span class="o">&gt;</span> output_file
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>Solution:</strong></p>

    <p>Yes.</p>
  </li>
</ul>

<hr />

<h4 id="tail"><code class="language-plaintext highlighter-rouge">Tail</code></h4>

<p>This is another handy command to only <strong>see <code class="language-plaintext highlighter-rouge">stdout</code> after a certain line</strong></p>

<ul>
  <li>if you want to see <code class="language-plaintext highlighter-rouge">stdout</code> before a certain line, use <code class="language-plaintext highlighter-rouge">head</code></li>
</ul>

<p><strong>By default</strong>, <code class="language-plaintext highlighter-rouge">tail</code> takes in content of from <code class="language-plaintext highlighter-rouge">stdin</code>, and <strong>outputs the last 10 lines of that <code class="language-plaintext highlighter-rouge">stdin</code> to the <code class="language-plaintext highlighter-rouge">stdout</code>.</strong></p>

<ul>
  <li>
    <p>the useful option is:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">-n</span>, <span class="nt">--lines</span><span class="o">=[</span>+]NUM
	output the last NUM lines, instead of the last 10<span class="p">;</span> or use <span class="nt">-n</span> +NUM to output starting with line NUM
</code></pre></div>    </div>

    <p>where:</p>

    <ul>
      <li><strong>line number here starts from 1</strong>.</li>
    </ul>
  </li>
</ul>

<p>Therefore, to see the lines starting from line 3:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>valgrind <span class="nt">--leak-check</span><span class="o">=</span><span class="nb">yes</span> ./isort 2&gt;&amp;1 | <span class="nb">tail</span> <span class="nt">-n</span> +3
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>since pipeline only works with <code class="language-plaintext highlighter-rouge">stdout</code>, we need to <strong>redirect what we wanted <code class="language-plaintext highlighter-rouge">stderr</code> first to <code class="language-plaintext highlighter-rouge">stdout</code></strong>, and then pipe it</li>
</ul>

<p>The output becomes</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;mark&gt;441&lt;/mark&gt; Copyright <span class="o">(</span>C<span class="o">)</span> 2002-2017, and GNU GPL<span class="s1">'d, by Julian Seward et al.
&lt;mark&gt;441&lt;/mark&gt; Using Valgrind-3.15.0 and LibVEX; rerun with -h for copyright info
&lt;mark&gt;441&lt;/mark&gt; Command: ./isort
&lt;mark&gt;441&lt;/mark&gt;
3
original: 10 19 80
ascending: 10 19 80
descending: 80 19 10
&lt;mark&gt;441&lt;/mark&gt;
&lt;mark&gt;441&lt;/mark&gt; HEAP SUMMARY:
&lt;mark&gt;441&lt;/mark&gt;     in use at exit: 0 bytes in 0 blocks
&lt;mark&gt;441&lt;/mark&gt;   total heap usage: 5 allocs, 5 frees, 5,156 bytes allocated
&lt;mark&gt;441&lt;/mark&gt;
&lt;mark&gt;441&lt;/mark&gt; All heap blocks were freed -- no leaks are possible
&lt;mark&gt;441&lt;/mark&gt;
&lt;mark&gt;441&lt;/mark&gt; For lists of detected and suppressed errors, rerun with: -s
&lt;mark&gt;441&lt;/mark&gt; ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
</span></code></pre></div></div>

<p>where:</p>

<ul>
  <li>
    <p>the first two line skipped where:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>valgrind <span class="nt">--leak-check</span><span class="o">=</span><span class="nb">yes</span> ./isort
&lt;mark&gt;444&lt;/mark&gt; Memcheck, a memory error detector
</code></pre></div>    </div>
  </li>
</ul>

<p><mark>End of Material for Midterm 2</mark></p>

<h2 id="file-io">File IO</h2>

<h3 id="ncat"><code class="language-plaintext highlighter-rouge">ncat</code></h3>

<p>The code looks like:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/*
 * ncat &lt;file_name&gt;
 *
 *   - reads a file line-by-line, printing them out with line numbers
 */</span>

<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// notice this fprintf, takes an extra argument FILE *</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="s">"usage: ncat &lt;file_name&gt;"</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">char</span> <span class="o">*</span><span class="n">filename</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="kt">FILE</span> <span class="o">*</span><span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">"r"</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fp</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>
        <span class="c1">// exit would be equivalent to return 1 in main, but it is more proper</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">lineno</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">fgets</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="n">fp</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// a potential bug here is that if I did't have enough buffer, I would only have a partial line</span>
        <span class="c1">// therefore, it will print partial lines to the output file</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"[%4d]"</span><span class="p">,</span> <span class="n">lineno</span><span class="o">++</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">fputs</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">stdout</span><span class="p">)</span> <span class="o">==</span> <span class="n">EOF</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">perror</span><span class="p">(</span><span class="s">"can't write to stdout"</span><span class="p">);</span>
            <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">ferror</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// don't forget to free the handle to the file in the end</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">fprintf(stderr, "%s\n", "usage: ncat &lt;file_name&gt;");</code>
    <ul>
      <li><strong>prints the content to <code class="language-plaintext highlighter-rouge">stderr</code></strong></li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">FILE *fp = fopen(filename, "r");</code>
    <ul>
      <li>open the file with <strong>read</strong> mode, and work with it</li>
      <li>see the section <a href="#`fopen`"><code class="language-plaintext highlighter-rouge">fopen</code></a></li>
      <li>and the <code class="language-plaintext highlighter-rouge">FILE *</code> is an <strong>opaque handle</strong></li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">exit(1)</code>
    <ul>
      <li>will <strong>terminate the entire program</strong> (not only the method)</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p><strong>Note:</strong></p>

  <ul class="task-list">
    <li class="task-list-item">
      <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />This also means that the following to line are <strong>equivalent</strong>:</p>

      <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fprintf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="s">"usage: ncat &lt;file_name&gt;"</span><span class="p">);</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="s">"usage: ncat &lt;file_name&gt;"</span><span class="p">);</span>
</code></pre></div>      </div>
    </li>
    <li class="task-list-item">
      <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />The above also means the below two are <strong>also the same</strong>:</p>

      <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
<span class="n">fscanf</span><span class="p">(</span><span class="n">stdin</span><span class="p">,</span> <span class="s">"%d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">);</span>
<span class="n">scanf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">);</span>
</code></pre></div>      </div>
    </li>
  </ul>
</blockquote>

<h3 id="fopen"><code class="language-plaintext highlighter-rouge">fopen</code></h3>

<p><strong>Signature</strong> looks like:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">FILE</span> <span class="o">*</span><span class="n">fopen</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">filename</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">mode</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li><strong>Opens</strong> a file, and <strong>returns a <code class="language-plaintext highlighter-rouge">FILE*</code></strong> that you can pass to other file-related functions to tell them on which file they should operate.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">FILE*</code> is an example of an <strong>“opaque handle”</strong>.</li>
    </ul>
  </li>
  <li><strong>mode</strong>:
    <ul>
      <li>“r” open for reading (file must already exist)</li>
      <li>“w” open for writing (will <strong>trash existing file</strong>)</li>
      <li>“a” open for appending (writes will always go to the end of file)</li>
      <li>“r+” open for reading &amp; writing (file must already exist)
        <ul>
          <li>reading will be the primary mode</li>
        </ul>
      </li>
      <li>“w+” open for reading &amp; writing (will <strong>trash existing file</strong>)
        <ul>
          <li>writing will be the primary mode</li>
          <li>as you write, you could read what you have written</li>
        </ul>
      </li>
      <li>“a+” open for reading &amp; appending (writes will go to end of file)</li>
    </ul>
  </li>
  <li><strong>returns</strong>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">NULL</code> if <strong>file could not be opened</strong> for some reason</li>
    </ul>
  </li>
</ul>

<h3 id="opaque-handle">Opaque Handle</h3>

<p>Basically, it involves the use of <code class="language-plaintext highlighter-rouge">typedef</code>: used to <strong>give data type a new name</strong>.</p>

<p>For example:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="c1"> </span><span class="cp">
</span>  
<span class="c1">// After this line BYTE can be used </span>
<span class="c1">// in place of unsigned char </span>
<span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">BYTE</span><span class="p">;</span> 
  
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
<span class="p">{</span> 
    <span class="n">BYTE</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">;</span> <span class="c1">// same as: unsigned char b1, b2;</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="sc">'c'</span><span class="p">;</span> 
    <span class="n">printf</span><span class="p">(</span><span class="s">"%c "</span><span class="p">,</span> <span class="n">b1</span><span class="p">);</span> 
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span> 
<span class="p">}</span> 
</code></pre></div></div>

<p>More useful cases would involve <strong>renaming pointer types</strong>:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">typedef</span> <span class="k">struct</span> <span class="n">tnode</span> <span class="o">*</span><span class="n">Treeptr</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>this means variables such as <code class="language-plaintext highlighter-rouge">Treeptr left</code> is actually of type <code class="language-plaintext highlighter-rouge">struct tnode *</code></li>
</ul>

<p>However, I <strong>personally just prefer</strong> using:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">typedef</span> <span class="k">struct</span> <span class="n">tnode</span> <span class="n">Treeptr</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Treeptr *left</code> is for type <code class="language-plaintext highlighter-rouge">struct tnode *</code> is more intuitive.</li>
</ul>

<blockquote>
  <p><strong>Extension:</strong></p>

  <ul>
    <li>A more <strong>advanced</strong> usage would be <code class="language-plaintext highlighter-rouge">typedef int (*PFI)(char *, char *);</code>, which defines the name <code class="language-plaintext highlighter-rouge">PFI</code> as a pointer to a function.</li>
  </ul>
</blockquote>

<h3 id="fgets"><code class="language-plaintext highlighter-rouge">fgets()</code></h3>

<p><strong>Signature</strong> looks like:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">char</span> <span class="o">*</span><span class="n">fgets</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span> <span class="kt">int</span> <span class="n">size</span><span class="p">,</span> <span class="kt">FILE</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>reads <strong>at most <code class="language-plaintext highlighter-rouge">size</code>-1 characters</strong> into <code class="language-plaintext highlighter-rouge">buffer</code>, <strong><em>or</em></strong> <strong>stop reading if newline or <code class="language-plaintext highlighter-rouge">EOF</code> is read</strong> (those characters are also inserted into the buffer), and <strong>terminating the <code class="language-plaintext highlighter-rouge">buffer</code></strong> with <code class="language-plaintext highlighter-rouge">\0</code>
    <ul>
      <li>since you need to place that <code class="language-plaintext highlighter-rouge">\0</code>, it explains why it only takes <code class="language-plaintext highlighter-rouge">size</code>-1 characters</li>
    </ul>
  </li>
  <li>internally, it also keeps track of the position of the current cursor in the file (e.g. which line it read)</li>
  <li><strong>returns</strong>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">NULL</code> <strong>on <code class="language-plaintext highlighter-rouge">EOF</code></strong></li>
    </ul>
  </li>
  <li>or, <strong>error</strong> (you can call <code class="language-plaintext highlighter-rouge">ferror()</code> afterwards to <strong>find out if there was an error</strong>).</li>
</ul>

<blockquote>
  <p><strong>Note:</strong></p>

  <ul class="task-list">
    <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" /><strong>Never</strong> use the similar <code class="language-plaintext highlighter-rouge">gets()</code> function; it’s <strong>UNSAFE</strong>!</li>
  </ul>
</blockquote>

<p>For example, if <code class="language-plaintext highlighter-rouge">fgets()</code>is reading the line <strong><em>in a file</em></strong> :</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//</span>
</code></pre></div></div>

<ol>
  <li>There are three characters in this line: <code class="language-plaintext highlighter-rouge">/</code>, <code class="language-plaintext highlighter-rouge">/</code>, and <code class="language-plaintext highlighter-rouge">\n</code> (byte number <code class="language-plaintext highlighter-rouge">10</code>).</li>
  <li>Met <code class="language-plaintext highlighter-rouge">\n</code>, <strong>insert</strong> <code class="language-plaintext highlighter-rouge">/</code>, <code class="language-plaintext highlighter-rouge">/</code>, and <code class="language-plaintext highlighter-rouge">\n</code> <strong>and <code class="language-plaintext highlighter-rouge">\0</code></strong> into the <strong>array <code class="language-plaintext highlighter-rouge">buffer</code></strong>
    <ul>
      <li>(assumed there are within <code class="language-plaintext highlighter-rouge">size</code>-1 characters, as specified)</li>
    </ul>
  </li>
</ol>

<h3 id="fputs"><code class="language-plaintext highlighter-rouge">fputs()</code></h3>

<p><strong>Signature</strong></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">fputs</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">,</span> <span class="kt">FILE</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>writes <code class="language-plaintext highlighter-rouge">str</code> to file (<strong><em>and flushing/clearing the array <code class="language-plaintext highlighter-rouge">str</code></em></strong>),  <strong>without</strong> its terminating null byte (<code class="language-plaintext highlighter-rouge">\0</code>).
    <ul>
      <li>the terminating <code class="language-plaintext highlighter-rouge">\0</code> <strong>comes from the <code class="language-plaintext highlighter-rouge">fget()</code>.</strong></li>
    </ul>
  </li>
  <li><strong>returns</strong>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">EOF</code> on <strong>error</strong>.</li>
    </ul>
  </li>
</ul>

<p>This means a standard usage would be:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span><span class="p">(</span><span class="n">fputs</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">stdout</span><span class="p">)</span> <span class="o">==</span> <span class="n">EOF</span><span class="p">){</span>
    <span class="n">perror</span><span class="p">(</span><span class="s">"can't write to stdout"</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p><strong>Note:</strong></p>

  <ul class="task-list">
    <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />Notice that we passed <code class="language-plaintext highlighter-rouge">stdout</code> to the type <code class="language-plaintext highlighter-rouge">FILE *</code>. It actually <strong>works</strong>.</li>
    <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />This also means that everything in Linux is a file, such <strong>that <code class="language-plaintext highlighter-rouge">stdin</code>/<code class="language-plaintext highlighter-rouge">stdout</code>/<code class="language-plaintext highlighter-rouge">stderr</code> are just “special” files, or they can be seen as just global variables of type <code class="language-plaintext highlighter-rouge">FILE *</code></strong></li>
  </ul>
</blockquote>

<h3 id="fclose"><code class="language-plaintext highlighter-rouge">fclose()</code></h3>

<p><strong>Signature:</strong></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">fclose</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">stream</span><span class="p">);</span>
</code></pre></div></div>

<ul>
  <li>flushes the stream pointed to by stream (writing any buffered output data using <code class="language-plaintext highlighter-rouge">fflush(3)</code>) and closes the underlying file descriptor.
    <ul>
      <li>basically, <strong>close and free whatever resource you had with that file</strong></li>
    </ul>
  </li>
</ul>

<h1 id="week-8">Week 8</h1>

<h2 id="formatted-io">Formatted IO</h2>

<p>First, a few things on the ordinary formatted IO:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// notice the ... in argument</span>
<span class="kt">int</span> <span class="nf">scanf</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">format</span><span class="p">,</span> <span class="p">...);</span>
<span class="kt">int</span> <span class="nf">printf</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">format</span><span class="p">,</span> <span class="p">...);</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>in fact, <strong>both methods accept <code class="language-plaintext highlighter-rouge">varargs</code></strong>.</li>
</ul>

<blockquote>
  <p><strong>Extension: Variadic Arguments:</strong></p>

  <ul>
    <li>
      <p>The symbol <code class="language-plaintext highlighter-rouge">...</code> must appear <strong>last in the parameter list</strong> and must <strong>follow at least one named parameter</strong>.</p>
    </li>
    <li>
      <p>e.g. <code class="language-plaintext highlighter-rouge">int printx(const char* fmt, ...); // function declared this way</code></p>
    </li>
    <li>
      <p>Within the body of a function that uses variadic arguments, the <strong>values of these arguments may be accessed using</strong> the <code class="language-plaintext highlighter-rouge">&lt;stdarg.h&gt;</code>:</p>

      <table>
        <thead>
          <tr>
            <th>Defined in header <code class="language-plaintext highlighter-rouge">&lt;stdarg.h&gt;</code></th>
            <th>Usage</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><a href="https://en.cppreference.com/w/c/variadic/va_start"><code class="language-plaintext highlighter-rouge">va_start</code></a></td>
            <td>enables access to variadic function arguments (function macro)</td>
          </tr>
          <tr>
            <td><a href="https://en.cppreference.com/w/c/variadic/va_arg"><code class="language-plaintext highlighter-rouge">va_arg</code></a></td>
            <td>accesses the next variadic function argument (function macro) <br /> <code class="language-plaintext highlighter-rouge">T va_arg( va_list ap, T );</code> The <code class="language-plaintext highlighter-rouge">va_arg</code> macro <strong>expands to an expression of type <code class="language-plaintext highlighter-rouge">T</code></strong> that corresponds to the <strong>next parameter</strong> from the <code class="language-plaintext highlighter-rouge">va_list ap</code>.</td>
          </tr>
          <tr>
            <td><a href="https://en.cppreference.com/w/c/variadic/va_copy"><code class="language-plaintext highlighter-rouge">va_copy</code></a>(C99)</td>
            <td>makes a copy of the variadic function arguments (function macro)</td>
          </tr>
          <tr>
            <td><a href="https://en.cppreference.com/w/c/variadic/va_end"><code class="language-plaintext highlighter-rouge">va_end</code></a></td>
            <td>ends traversal of the variadic function arguments (function macro)</td>
          </tr>
          <tr>
            <td><a href="https://en.cppreference.com/w/c/variadic/va_list"><code class="language-plaintext highlighter-rouge">va_list</code></a></td>
            <td>holds the information needed by <code class="language-plaintext highlighter-rouge">va_start</code>, <code class="language-plaintext highlighter-rouge">va_arg</code>, <code class="language-plaintext highlighter-rouge">va_end</code>, and <code class="language-plaintext highlighter-rouge">va_copy</code> (typedef)</td>
          </tr>
        </tbody>
      </table>
    </li>
  </ul>
</blockquote>

<p>and some <strong>common conversion specifiers</strong> are listed below, which can be used in the functions above:</p>

<pre><code class="language-pseudocode">%d: int
%u: unsigned int

%ld: long
%lu: unsigned long

%s: string (char *)

%f: double
%g: double (trailing zeros not printed)

%p: memory address (void *)
</code></pre>
<h3 id="sscanf"><code class="language-plaintext highlighter-rouge">sscanf()</code></h3>

<p>Consider the case when you need to convert a string into an integer.</p>

<ul>
  <li>for example, convert <code class="language-plaintext highlighter-rouge">char *a = "123";</code> into an int <code class="language-plaintext highlighter-rouge">123</code>.</li>
</ul>

<p>There are two ways to solve it, by formatting/parsing the string:</p>

<ol>
  <li>
    <p>use <code class="language-plaintext highlighter-rouge">atoi()</code>, which means convert a string to <code class="language-plaintext highlighter-rouge">int</code>:</p>

    <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">char</span> <span class="o">*</span><span class="n">a</span> <span class="o">=</span> <span class="s">"123"</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">a</span><span class="p">);</span> <span class="c1">// n=123</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>use the formatted IO <code class="language-plaintext highlighter-rouge">sscanf()</code>:</p>

    <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">char</span> <span class="o">*</span><span class="n">a</span> <span class="o">=</span> <span class="s">"123"</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
<span class="n">sscanf</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s">"%d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">);</span> <span class="c1">// n=123</span>
</code></pre></div>    </div>
  </li>
</ol>

<p>And this <code class="language-plaintext highlighter-rouge">sscanf()</code> works as:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">sscanf</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">input_string</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">format</span><span class="p">,</span> <span class="p">...)</span>
</code></pre></div></div>

<p>which:</p>

<ul>
  <li>basically read from <code class="language-plaintext highlighter-rouge">input_string</code> rather than <code class="language-plaintext highlighter-rouge">stdin</code>, and put it in whatever holder/storage you have</li>
  <li>in the end, you can <strong>convert anything from <code class="language-plaintext highlighter-rouge">char *</code> to anything else</strong></li>
</ul>

<h3 id="sprintf"><code class="language-plaintext highlighter-rouge">sprintf()</code></h3>

<p>Consider the reverse case, if you need to convert from a number to a string, you use <code class="language-plaintext highlighter-rouge">sprintf()</code>.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">sprintf</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">output_buffer</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">format</span><span class="p">,</span> <span class="p">...);</span>
</code></pre></div></div>

<ul>
  <li>write to <code class="language-plaintext highlighter-rouge">output_buffer</code> rather than <code class="language-plaintext highlighter-rouge">stdout</code>
    <ul>
      <li><strong><code class="language-plaintext highlighter-rouge">output_buffer</code> better be pointing to a large enough memory</strong>
        <ul>
          <li>this also means <code class="language-plaintext highlighter-rouge">output_buffer</code> has to be <strong>initialized</strong></li>
        </ul>
      </li>
      <li>in the end, it means you can <strong>convert anything else to a <code class="language-plaintext highlighter-rouge">char *</code></strong></li>
    </ul>
  </li>
</ul>

<p><strong><em>For example</em></strong>, you can do:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">456</span><span class="p">;</span>
<span class="kt">char</span> <span class="n">b</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
<span class="n">sprintf</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="s">"%d"</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
</code></pre></div></div>

<p>and now:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">b</code> will look like <code class="language-plaintext highlighter-rouge">[52,53,54,0]</code>, where <code class="language-plaintext highlighter-rouge">'4'=52</code> in ASCII.</li>
</ul>

<blockquote>
  <p><strong>Notice:</strong></p>

  <ul>
    <li>
      <p>this also means if you did:</p>

      <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">456</span><span class="p">;</span>
<span class="kt">char</span> <span class="o">*</span><span class="n">b</span><span class="p">;</span>
<span class="n">sprintf</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="s">"%d"</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
</code></pre></div>      </div>

      <p>there <strong>will be error</strong> (if you check <code class="language-plaintext highlighter-rouge">valgrind</code>), since <code class="language-plaintext highlighter-rouge">b</code> onw only points to <code class="language-plaintext highlighter-rouge">0</code>, and you obviously cannot write <code class="language-plaintext highlighter-rouge">456</code> to <code class="language-plaintext highlighter-rouge">0</code> pointer.</p>
    </li>
  </ul>
</blockquote>

<h2 id="buffering-on-io">Buffering on IO</h2>

<p>Three types of buffering:</p>

<ol>
  <li>Unbuffered - typically <code class="language-plaintext highlighter-rouge">stderr</code></li>
  <li>Line-buffered  - <code class="language-plaintext highlighter-rouge">stdout</code> when it’s connected to terminal screen
    <ul>
      <li>usually, the buffer size is whenever you have <code class="language-plaintext highlighter-rouge">\n</code> or <code class="language-plaintext highlighter-rouge">EOF</code></li>
    </ul>
  </li>
  <li>Block-buffered - all other <strong>files</strong>
    <ul>
      <li>usually, the buffer size is <code class="language-plaintext highlighter-rouge">4k byte</code></li>
      <li>this means if you <strong>redirected <code class="language-plaintext highlighter-rouge">stdout</code> to a file</strong>, the <code class="language-plaintext highlighter-rouge">4kB</code> will be new buffer size</li>
    </ul>
  </li>
</ol>

<blockquote>
  <p><strong>Note:</strong></p>

  <ul class="task-list">
    <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />The above applies for both ways: <strong>both <code class="language-plaintext highlighter-rouge">stdin</code> and <code class="language-plaintext highlighter-rouge">stdout</code></strong> will be line-buffered. This means that your program will not receive anything from <code class="language-plaintext highlighter-rouge">stdin</code> until <code class="language-plaintext highlighter-rouge">\n</code> or <code class="language-plaintext highlighter-rouge">EOF</code> is hit.
      <ul>
        <li>to simulate terminating your program (e.g. <code class="language-plaintext highlighter-rouge">ncat</code>) using <code class="language-plaintext highlighter-rouge">EOF</code>, you can <strong>use <code class="language-plaintext highlighter-rouge">Ctrl+D</code>, which means from inputting an <code class="language-plaintext highlighter-rouge">EOF</code> to your program.</strong></li>
      </ul>
    </li>
  </ul>
</blockquote>

<p>This means, that if your program crashed during:</p>

<ul>
  <li>line-buffering <strong>before</strong> you put in <code class="language-plaintext highlighter-rouge">\n</code></li>
  <li>block-buffering <strong>before</strong> <code class="language-plaintext highlighter-rouge">4k Byte</code> data read</li>
</ul>

<p><strong>All your work</strong> will be gone.</p>

<h3 id="flushing-buffer">Flushing Buffer</h3>

<p>The remedy to the above is to not crash, or <strong>flush the buffer manually</strong>:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fflush</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>which manually <strong>flushes</strong> the buffer for <code class="language-plaintext highlighter-rouge">fp</code> (which is a <code class="language-plaintext highlighter-rouge">FILE*</code>).</li>
</ul>

<p>Or, you can turn on the buffer to unbuffered mode, by:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">setbuf</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>which <strong>turns off buffering</strong> for <code class="language-plaintext highlighter-rouge">fp</code>.
    <ul>
      <li>remember, <code class="language-plaintext highlighter-rouge">stdout/in/err</code> is also <code class="language-plaintext highlighter-rouge">FILE *</code></li>
    </ul>
  </li>
</ul>

<h2 id="standard-io-for-binary-files">Standard IO for Binary Files</h2>

<p>Consider the LAB4, which basically does the following:</p>

<ul>
  <li>A program that takes in two strings, your name and your message</li>
  <li>Write the data to an actual binary file (with no extension)</li>
</ul>

<p>In details:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">MdbRec</span><span class="p">{</span>
    <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span> <span class="c1">// so you will have at most 15 char + '0'</span>
    <span class="kt">char</span> <span class="n">msg</span><span class="p">[</span><span class="mi">24</span><span class="p">];</span> <span class="c1">// so you will have at most 23 char + '0'</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>encapsulates the format of the data that you need to write into your file</li>
</ul>

<p>This means that, if you put in:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>xiao@my-Laptop: ./mdb-add mydatabase jason Hello
</code></pre></div></div>

<p>where:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">jason</code> will be my <code class="language-plaintext highlighter-rouge">name</code></li>
  <li><code class="language-plaintext highlighter-rouge">Hello</code> will be the <code class="language-plaintext highlighter-rouge">msg</code></li>
</ul>

<p>then the output file will be:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jason^@^@^@^@^@^@^@^@^@^@^@Hello^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">^@</code> means <code class="language-plaintext highlighter-rouge">0</code> (null) in VIM</p>
  </li>
  <li><strong><code class="language-plaintext highlighter-rouge">jason^@</code> is the actual data</strong> written by the program (6 bytes). The following <strong><code class="language-plaintext highlighter-rouge">^@</code> 10 times (10 bytes)</strong> comes from the initialization of the <code class="language-plaintext highlighter-rouge">char []</code>
    <ul>
      <li>in total, 16 bytes as required</li>
    </ul>
  </li>
  <li><strong><code class="language-plaintext highlighter-rouge">Hello^@</code> is the actual data</strong> written by the program (7 bytes). The following <strong><code class="language-plaintext highlighter-rouge">^@</code> 17 times (17 bytes)</strong> comes from the initialization of the <code class="language-plaintext highlighter-rouge">char []</code>
    <ul>
      <li>in total, 24 bytes as required</li>
    </ul>
  </li>
</ul>

<h3 id="opening-binary-files">Opening Binary Files</h3>

<p>Now, knowing the basics, we need to know how to <strong>write to a file</strong>.</p>

<p><strong>First, you need to obtain the <code class="language-plaintext highlighter-rouge">FILE *</code> data structure</strong>, so that you could work on. To do this you have learnt two ways:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">FILE *fp = fopen(filename, "rb");</code></li>
  <li><code class="language-plaintext highlighter-rouge">FILE *fp = fopen(filename, "wb");</code></li>
</ul>

<p>where:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">b</code> stands for binary files.
    <ul>
      <li>In <strong>UNIX</strong>, there is no distinction between text and binary files, so <code class="language-plaintext highlighter-rouge">b</code> has no effect.</li>
      <li>In windows, <code class="language-plaintext highlighter-rouge">b</code> <strong>suppresses newline translations</strong> that happens:
        <ul>
          <li>when reading, turn “\r\n” into “\n”</li>
          <li>when writing, turn “\n” into “\r\n”</li>
          <li>this also means that for any content it reads/writes, it <strong>translates</strong> <code class="language-plaintext highlighter-rouge">\n=10</code> to <code class="language-plaintext highlighter-rouge">\r=13 \n=10</code>, and vice versa.
            <ul>
              <li>therefore, if you are reading binary files, this translation will cause errors</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>However, this will be useful if you run your program in a different OS.</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p><strong>Note:</strong></p>

  <ul>
    <li>Fundamentally, there is no difference between a binary file and a text file (or an image file, or anything). In your hard disk, all those data are just bytes. A binary file have those bytes <strong>representing</strong> purely binaries, text file having bytes <strong>representing</strong> ASCII code for characters (images having bytes representing RGB values)</li>
  </ul>
</blockquote>

<h3 id="writing-to-binary-files">Writing to Binary Files</h3>

<p>Then, you need to <strong>use to the <code class="language-plaintext highlighter-rouge">FILE *</code></strong> to <strong>write</strong>:</p>

<ul>
  <li>
    <p>Using:</p>

    <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kt">size_t</span> <span class="n">fwrite</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">n</span><span class="p">,</span> <span class="kt">FILE</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
</code></pre></div>    </div>

    <ul>
      <li><em>writes</em> <strong><code class="language-plaintext highlighter-rouge">n</code> objects</strong>, each <strong><code class="language-plaintext highlighter-rouge">size</code> bytes long</strong>, from the memory location pointed to by <code class="language-plaintext highlighter-rouge">p</code> out to <code class="language-plaintext highlighter-rouge">file</code>.</li>
      <li>returns the <strong>number of objects successfully written</strong>, which will be less than <code class="language-plaintext highlighter-rouge">n</code> when there is an error.
        <ul>
          <li>e.g. the above example would be to use <code class="language-plaintext highlighter-rouge">fwrite(pToMdbStruct, sizeof(MdbStruct), 1, myDatabase)</code></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="reading-from-binary-files">Reading from Binary Files</h3>

<p>Again, first obtain the <code class="language-plaintext highlighter-rouge">FILE *</code>, and then use:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">size_t</span> <span class="n">fread</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">n</span><span class="p">,</span> <span class="kt">FILE</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li><em>reads</em> <strong><code class="language-plaintext highlighter-rouge">n</code> objects</strong>, each <strong><code class="language-plaintext highlighter-rouge">size</code> bytes</strong> long, from <code class="language-plaintext highlighter-rouge">file</code> into the memory location pointed to by <code class="language-plaintext highlighter-rouge">p</code>.</li>
  <li>returns the <strong>number of objects successfully read</strong>, which may be less than the requested number <code class="language-plaintext highlighter-rouge">n</code>, in which case <code class="language-plaintext highlighter-rouge">feof()</code> and <code class="language-plaintext highlighter-rouge">ferror()</code> can be used to determine status.
    <ul>
      <li>e.g. if it returned <code class="language-plaintext highlighter-rouge">0</code> from a file with some content, you might need to <strong>check with <code class="language-plaintext highlighter-rouge">ferror()</code></strong></li>
    </ul>
  </li>
</ul>

<h3 id="positioning-in-the-file">Positioning in the File</h3>

<p><strong>By default, your <code class="language-plaintext highlighter-rouge">FILE *</code> will automatically keep track of the position</strong> when you did <code class="language-plaintext highlighter-rouge">fread()</code> and/or <code class="language-plaintext highlighter-rouge">fwrite()</code>. This means, it will increment the cursor automatically in the file to the next position after reading/writing.</p>

<p>However, if we want to manually skip something, or forcibly place the cursor starting at a particular position, you can use:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">fseek</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">long</span> <span class="n">offset</span><span class="p">,</span> <span class="kt">int</span> <span class="n">whence</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>Sets the file position for <strong>next read or write</strong>.  The new position, <strong>measured in bytes</strong>, is obtained by adding <code class="language-plaintext highlighter-rouge">offset</code> bytes to the position specified by <code class="language-plaintext highlighter-rouge">whence</code>.
    <ul>
      <li>If <code class="language-plaintext highlighter-rouge">whence</code> is set to <code class="language-plaintext highlighter-rouge">SEEK_SET</code>, <code class="language-plaintext highlighter-rouge">SEEK_CUR</code>, or <code class="language-plaintext highlighter-rouge">SEEK_END</code>, the offset is relative to the start of the file, the current position indicator, or end-of-file, respectively.</li>
    </ul>
  </li>
</ul>

<h1 id="week-9">Week 9</h1>

<h2 id="numeric-ids-in-unix">Numeric IDs in UNIX</h2>

<p>If you do <code class="language-plaintext highlighter-rouge">ll</code>, you see:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>drwxr-xr-x  8 jasonyux jasonyux 4096 Oct 30 04:32  cs3157/
</code></pre></div></div>

<p>and with <code class="language-plaintext highlighter-rouge">ll -n</code>, you see your IDs:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>drwxr-xr-x  8 1000 1000 4096 Oct 30 04:32  cs3157/
</code></pre></div></div>

<blockquote>
  <p>The take home message is this:</p>

  <ul>
    <li>everything in UNIX is just a number/numeric ID. Including your user, group, process IDs, port numbers, etc.</li>
  </ul>
</blockquote>

<p>Other example <strong>includes <code class="language-plaintext highlighter-rouge">ps au</code></strong>, where:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">a</code> allows you to see processes in other terminals</li>
  <li><code class="language-plaintext highlighter-rouge">u</code> allows you to see user information running those processes</li>
  <li>every process (running instance of program) <strong>has its unique numeric ID</strong></li>
</ul>

<h2 id="fork"><code class="language-plaintext highlighter-rouge">fork()</code></h2>

<p>This is a very special function, in which it:</p>

<ul>
  <li><strong>creates a new process by duplicating</strong> the calling process.
    <ul>
      <li>The new process is referred to as the <strong>child process</strong>.
        <ul>
          <li>inside a child process, the <code class="language-plaintext highlighter-rouge">pid_t p = fork()</code> will <strong>always be <code class="language-plaintext highlighter-rouge">0</code></strong>
            <ul>
              <li>this <code class="language-plaintext highlighter-rouge">0</code> is usually <strong><em>indicative of the program being a child process</em></strong></li>
            </ul>
          </li>
        </ul>
      </li>
      <li>The calling process is referred to as the <strong>parent process</strong>.
        <ul>
          <li>inside the parent process,  the <code class="language-plaintext highlighter-rouge">pid_t p = fork()</code> will always be <strong>actual <code class="language-plaintext highlighter-rouge">pid</code> of the child</strong></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p><strong><em>For example:</em></strong></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">pid_t</span> <span class="n">p</span><span class="p">;</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">fork</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">p</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"Listen to me</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"I give up...</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">p</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"No way</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Whatever.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">"fork failed"</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>And the output will be:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Listen to me
No way
Listen to me
No way
...
</code></pre></div></div>

<p>where:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Listen to me</code> comes from the <strong>parent process</strong>, since its child process will not be zero</li>
  <li><code class="language-plaintext highlighter-rouge">No way</code> comes from the <strong>child process</strong>, since its “child process” will be <code class="language-plaintext highlighter-rouge">0</code></li>
</ul>

<p>and what happened was:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>|
|
main
|
|
fork<span class="o">()</span> <span class="nt">-----</span> <span class="o">(</span>child<span class="o">)</span>
|				|
|				|
|				|
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>
    <p>everything will get cloned, such that you have two <strong>identical</strong> pieces in memory:</p>

    <p><img src="\lectures\images\typora-user-images\image-20201106224139653.png" alt="image-20201106224139653" style="zoom:50%;" /></p>

    <p>where:</p>

    <ul>
      <li><em>e.g.</em> accessing memory location <code class="language-plaintext highlighter-rouge">200</code> in Heap in one <strong>does not affect</strong> memory location <code class="language-plaintext highlighter-rouge">200</code> in another, because now they are <strong>two separate virtual memory space</strong></li>
    </ul>
  </li>
  <li>
    <p>however, the child will <strong>start</strong> running **exactly at the same code level when you called <code class="language-plaintext highlighter-rouge">fork()</code> **</p>

    <ul>
      <li>
        <p>e.g. if you had:</p>

        <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">...</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"What about here?</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="n">pid_t</span> <span class="n">p</span><span class="p">;</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">fork</span><span class="p">();</span> <span class="c1">// child process starts here</span>
<span class="p">...</span>
</code></pre></div>        </div>

        <p>You will only have <code class="language-plaintext highlighter-rouge">What about here?</code> <strong>run once by the parent.</strong></p>
      </li>
    </ul>
  </li>
</ul>

<blockquote>
  <p><strong>Interestingly</strong>:</p>

  <ul>
    <li>If you call <code class="language-plaintext highlighter-rouge">fork()</code> twice in your main program, you will get <code class="language-plaintext highlighter-rouge">4</code> processes.</li>
    <li>The most often case that causes <code class="language-plaintext highlighter-rouge">fork</code> to return negative value (error) would be a user reaching the limit of processes it can create.
      <ul>
        <li>this limit is often used for preventing fork bombing.</li>
      </ul>
    </li>
  </ul>
</blockquote>

<h2 id="shell"><code class="language-plaintext highlighter-rouge">shell</code></h2>

<p>This will be a limited version of <code class="language-plaintext highlighter-rouge">shell</code>:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;sys/wait.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">die</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">perror</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> 
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">char</span> 	<span class="n">buf</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
    <span class="n">pid_t</span> 	<span class="n">pid</span><span class="p">;</span>
    <span class="kt">int</span>     <span class="n">status</span><span class="p">;</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"AP&gt; "</span><span class="p">);</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">fgets</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="n">stdin</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">buf</span><span class="p">[</span><span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'\n'</span><span class="p">)</span>
            <span class="n">buf</span><span class="p">[</span><span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// replace newline with '\0'</span>

        <span class="n">pid</span> <span class="o">=</span> <span class="n">fork</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pid</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">die</span><span class="p">(</span><span class="s">"fork error"</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">pid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>  
            <span class="c1">//child process</span>
            <span class="n">execl</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="mi">0</span><span class="p">);</span>
            <span class="n">die</span><span class="p">(</span><span class="s">"execl failed"</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// parent process</span>
            <span class="k">if</span><span class="p">(</span><span class="n">waitpid</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">status</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="n">pid</span><span class="p">)</span>
                    <span class="n">die</span><span class="p">(</span><span class="s">"waitpid failed"</span><span class="p">);</span>

        <span class="p">}</span>

        <span class="n">printf</span><span class="p">(</span><span class="s">"AP&gt; "</span><span class="p">);</span>

    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>inside <strong>parent</strong>:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">if(waitpid(pid, &amp;status, 0) != pid)</code> <strong>waits until the process with <code class="language-plaintext highlighter-rouge">pid</code> finishes</strong></li>
      <li>then it prints <code class="language-plaintext highlighter-rouge">AP&gt; </code>, and loops</li>
    </ul>
  </li>
  <li>inside <strong>child</strong>:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">execl(buf, buf, (char *)0)</code> <strong>runs the program specified in <code class="language-plaintext highlighter-rouge">buf</code></strong>
        <ul>
          <li>you need to <strong>end the arguments with <code class="language-plaintext highlighter-rouge">(char *)0</code></strong>, instead of <code class="language-plaintext highlighter-rouge">0</code>, because <code class="language-plaintext highlighter-rouge">execl</code> is a <strong>variadic function</strong>:
            <ul>
              <li>alike <code class="language-plaintext highlighter-rouge">printf(char *, ...)</code>, it <strong>assumes all following data</strong> are type <code class="language-plaintext highlighter-rouge">char *</code>. So it is the same situation here.</li>
              <li>in fact, <code class="language-plaintext highlighter-rouge">int execl(const char *pathname, const char *arg, ...)</code>, so you can think of your arguments constructing an <strong>“null terminated array”</strong> so that the program knows when to end</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>in fact <code class="language-plaintext highlighter-rouge">int execl(const char *pathname, const char *arg, ..., /* (char  *) NULL */);</code>
        <ul>
          <li>the <strong>first</strong> <code class="language-plaintext highlighter-rouge">buf</code> is basically the <strong>path of that executable</strong>
            <ul>
              <li>since we do not access path variable stored in our system, we need to <strong>specify the full path</strong></li>
            </ul>
          </li>
          <li>so the <strong>second</strong> <code class="language-plaintext highlighter-rouge">buf</code> is <strong>basically the <code class="language-plaintext highlighter-rouge">argv</code> array</strong></li>
          <li>the <strong>last</strong> parameter in <code class="language-plaintext highlighter-rouge">execl</code> should be a null pointer</li>
        </ul>
      </li>
      <li>another <strong>special behavior</strong> of <code class="language-plaintext highlighter-rouge">execl()</code> is discussed below</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p><strong>In fact:</strong></p>

  <ul>
    <li>this is actually the <strong>core of a <code class="language-plaintext highlighter-rouge">bash</code> shell</strong>, except that a <code class="language-plaintext highlighter-rouge">bash</code> shell has all those additional functionalities such as path variable/redirection, and etc.</li>
  </ul>
</blockquote>

<h3 id="execl"><code class="language-plaintext highlighter-rouge">execl</code></h3>

<p>If you are running a process <code class="language-plaintext highlighter-rouge">ls</code> using the <code class="language-plaintext highlighter-rouge">execl</code> function, what happens is:</p>

<ul>
  <li>first, the <code class="language-plaintext highlighter-rouge">execl</code> will kill the process calling it</li>
  <li>then, it will execute the <code class="language-plaintext highlighter-rouge">ls</code> process, <strong>in place of that killed process</strong>
    <ul>
      <li>therefore, the <code class="language-plaintext highlighter-rouge">pid</code> is <strong>preserved</strong></li>
    </ul>
  </li>
  <li>this means you never <strong>come back from <code class="language-plaintext highlighter-rouge">execl()</code></strong> to your program, because your child process is <strong>entirely replaced with the <code class="language-plaintext highlighter-rouge">ls</code> process you called</strong>
    <ul>
      <li>therefore, the <strong><em>only thing you know from the new process</em></strong><code class="language-plaintext highlighter-rouge">ls</code> process is its <code class="language-plaintext highlighter-rouge">pid</code> when you got from <code class="language-plaintext highlighter-rouge">fork()</code></li>
    </ul>
  </li>
</ul>

<p>Therefore, if you ran your own <code class="language-plaintext highlighter-rouge">shell</code> program above and run <code class="language-plaintext highlighter-rouge">ls</code>, the <strong>below is what happened</strong>.</p>

<p><img src="\lectures\images\typora-user-images\image-20201106225220314.png" alt="image-20201106225220314" style="zoom: 67%;" /></p>

<p>where:</p>

<ul>
  <li>the horizontal line would be time</li>
</ul>

<h1 id="week-10">Week 10</h1>

<h2 id="netcat"><code class="language-plaintext highlighter-rouge">netcat</code></h2>

<p>This is basically a program that allows two devices to connect between each other.</p>

<ul>
  <li>for instance, you can run:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">nc -l &lt;portnumber&gt;</code> to listen for connection on port <code class="language-plaintext highlighter-rouge">&lt;portnumber&gt;</code>
        <ul>
          <li>a server socket</li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">nc &lt;address&gt; &lt;portnumber&gt;</code> to connect
        <ul>
          <li>a client socket</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>in the end, you will have <strong>established a TCP connection</strong>. It is a two way connection, such that:
    <ul>
      <li>on the client, it:
        <ul>
          <li><strong>reads</strong> <code class="language-plaintext highlighter-rouge">stdin</code> from client terminal, and <strong>sends</strong> <code class="language-plaintext highlighter-rouge">stdout</code> to the network and to the server terminal (<strong>line buffered</strong>)</li>
          <li><strong>reads</strong> <code class="language-plaintext highlighter-rouge">stdout</code> from server terminal if there is</li>
        </ul>
      </li>
      <li>on the server, it:
        <ul>
          <li><strong>reads</strong> <code class="language-plaintext highlighter-rouge">stdin</code> from server terminal, and <strong>sends</strong> <code class="language-plaintext highlighter-rouge">stdout</code> to the network and to the client terminal (<strong>line buffered</strong>)</li>
          <li><strong>reads</strong> <code class="language-plaintext highlighter-rouge">stdout</code> from client terminal if there is</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p><img src="\lectures\images\typora-user-images\image-20201109193522201.png" alt="image-20201109193522201" style="zoom:50%;" /></p>

<p>where:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">netcat</code> essentially created a running process on both devices, such that the process only <strong>terminates only if one of them terminated</strong></li>
</ul>

<h3 id="connecting-devices-to-a-program">Connecting devices to a Program</h3>

<p>The idea is as follows. We have a program running on a computer, called <code class="language-plaintext highlighter-rouge">mdb-lookup-cs3157</code>, and we want:</p>

<ul>
  <li>a <strong>remote computer to use this program</strong></li>
</ul>

<p>This means you want to do the following:</p>

<ul>
  <li>on a server side
    <ul>
      <li>run <code class="language-plaintext highlighter-rouge">mdb-lookup-cs3157</code></li>
      <li>transport the <strong>input</strong> of <strong>client side</strong> to the <strong>server program</strong></li>
      <li>transport the <strong>output</strong> of the program <strong>back to the client</strong></li>
    </ul>
  </li>
  <li>on the client side
    <ul>
      <li>establish a <code class="language-plaintext highlighter-rouge">netcat</code> session, and use <code class="language-plaintext highlighter-rouge">mdb-lookup-cs3157</code></li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>The difficulty is in the server side, where you have to</p>

  <ul>
    <li>
      <p>pipe output of <code class="language-plaintext highlighter-rouge">netcat</code> to <code class="language-plaintext highlighter-rouge">mdb-lookup-cs3157</code>, <strong>AND</strong></p>
    </li>
    <li>pipe output from <code class="language-plaintext highlighter-rouge">mdb-lookup-cs3157</code> to <code class="language-plaintext highlighter-rouge">netcat</code></li>
    <li>which is essentially <strong>forming a loop</strong></li>
  </ul>
</blockquote>

<blockquote>
  <p><strong>Approach 1</strong></p>

  <ul>
    <li>
      <p>Running, on the server side:</p>

      <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$.</span>/mdb-lookup-cs3157 &lt; mypipe | netcat <span class="nt">-l</span> 8888 <span class="o">&gt;</span> mypipe
</code></pre></div>      </div>
    </li>
    <li>
      <p>There are two problems with it:</p>

      <ol>
        <li>
          <p>Since the first thing that bash executes it <code class="language-plaintext highlighter-rouge">./mdb-lookup-cs3157 &lt; mypipe</code>, since <code class="language-plaintext highlighter-rouge">mypipe</code> will be empty or not even there, the program will quit.</p>
        </li>
        <li>
          <p>Redirection from a normal file is not blocked. i.e. if there is <strong>nothing on the file, the redirection just reads <code class="language-plaintext highlighter-rouge">EOF</code> and is done</strong>.</p>
          <ul>
            <li>however, <strong>pipeline is BIO</strong>. This means that it blocks the next command to read from input until there is something on the file, which is different than file IO.</li>
          </ul>
        </li>
      </ol>
    </li>
  </ul>

</blockquote>

<blockquote>
  <p><strong>Solution:</strong></p>

  <ul>
    <li>
      <p>Instead of the normal file, we need to use a special file called a <strong>named pipe</strong> (see section <a href="#Named Pipe">Named Pipe</a>)</p>
    </li>
    <li>
      <p>Therefore, first we do:</p>

      <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">mkfifo </span>mypipe
</code></pre></div>      </div>

      <p>which will create a file that looks like:</p>

      <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>xyLaptop<span class="nv">$ </span>ll
prw-r--r--  1 jasonyux jasonyux    0 Nov  9 18:13  mypipe|
</code></pre></div>      </div>

      <p>where you see the special pipe <code class="language-plaintext highlighter-rouge">|</code>  symbol to tell you that this is a <strong>named pipe file</strong></p>
    </li>
    <li>
      <p>Now, if you do</p>

      <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./mdb-lookup-cs3157 &lt; mypipe | netcat <span class="nt">-l</span> 8888 <span class="o">&gt;</span> mypipe
</code></pre></div>      </div>

      <p>it will work, because:</p>

      <ul>
        <li><code class="language-plaintext highlighter-rouge">./mdb-lookup-cs3157</code> continues executing by continuingly reading from <strong>named pipe</strong> <code class="language-plaintext highlighter-rouge">mypipe</code> is a <strong>BIO</strong> way, <strong>until reading <code class="language-plaintext highlighter-rouge">EOF</code></strong></li>
        <li><code class="language-plaintext highlighter-rouge">netcat -l 8888 &gt; mypipe</code> also continues executing <strong>until <code class="language-plaintext highlighter-rouge">netcat</code> finishes</strong></li>
      </ul>

      <p>Equivalently:</p>

      <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat </span>mypipe | ./mdb-lookup-cs3157 | netcat <span class="nt">-l</span> 8888 <span class="o">&gt;</span> mypipe
</code></pre></div>      </div>

      <p>Or:</p>

      <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>netcat <span class="nt">-l</span> 8888 &lt; mypipe | ./mdb-lookup-cs3157 <span class="o">&gt;</span> mypipe
</code></pre></div>      </div>
    </li>
  </ul>
</blockquote>

<h3 id="named-pipe">Named Pipe</h3>

<p><code class="language-plaintext highlighter-rouge">mkfifo</code> creates the <strong>special file</strong> called a <strong>named pipe.</strong></p>

<ul>
  <li>basically, this is a <strong><em>file</em> that act as a <em>pipe</em></strong>, such that it <strong>has a BIO mechanism</strong> and never has a <code class="language-plaintext highlighter-rouge">EOF</code> (end) <strong>until your program finishes</strong>
    <ul>
      <li>so you could make this a <strong>two way pipe</strong></li>
      <li>this also means a named pipe actually <strong>flushes its content</strong> to the <code class="language-plaintext highlighter-rouge">stout</code> when a program is using it.</li>
      <li>Therefore, <strong>after</strong> executing program finishes, <strong>the content of the named pipe should be empty.</strong></li>
    </ul>
  </li>
</ul>

<p>This means the following (supposed the named pipe is called <code class="language-plaintext highlighter-rouge">mypipe</code>)</p>

<ul>
  <li><strong>a program reading from <code class="language-plaintext highlighter-rouge">mypipe</code></strong> will be the same as reading from another program</li>
  <li><strong>a program outputting to <code class="language-plaintext highlighter-rouge">mypipe</code></strong> will be the same as outputting to another program</li>
</ul>

<p>Therefore, what happened in the above <code class="language-plaintext highlighter-rouge">$ ./mdb-lookup-cs3157 &lt; mypipe | netcat -l 8888 &gt; mypipe</code> is this:</p>

<p><img src="\lectures\images\typora-user-images\image-20201109194339259.png" alt="image-20201109194339259" style="zoom: 67%;" /></p>

<p>where:</p>

<ul>
  <li>the <strong>order</strong> of <code class="language-plaintext highlighter-rouge">mypipe</code> and <code class="language-plaintext highlighter-rouge">./mdb-lookup-cs3157</code> does not matter. Both works as long as you are <strong>completing the cycle.</strong></li>
</ul>

<p><strong><em>Another example:</em></strong></p>

<p>If you do something like:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./someProgram &lt; mypipe
</code></pre></div></div>

<p>where:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">mypipe</code> is a <strong>newly created named pipe</strong></li>
  <li><code class="language-plaintext highlighter-rouge">./someProgram</code> takes some input from <code class="language-plaintext highlighter-rouge">stdin</code></li>
</ul>

<p>Then your terminal will just <strong>hang there</strong>, until you do something like:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./someOtherProgram <span class="o">&gt;</span> mypipe
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>first, the <code class="language-plaintext highlighter-rouge">stdout</code> of <code class="language-plaintext highlighter-rouge">someOtherProgram</code> is buffered to the file <code class="language-plaintext highlighter-rouge">mypipe</code></li>
  <li>then, <code class="language-plaintext highlighter-rouge">mypipe</code> flushes the content to <code class="language-plaintext highlighter-rouge">someProgram</code> as <code class="language-plaintext highlighter-rouge">stdin</code></li>
  <li>finally, you will see <code class="language-plaintext highlighter-rouge">./someProgram</code> executed something as now it has got some input.</li>
</ul>

<p>Lastly, both of the above will <strong>terminate only one of the program terminated.</strong></p>

<ul>
  <li>think about it, a normal unnamed pipeline also has this behavior.</li>
</ul>

<p><mark>Exam 3 Material Ends Here</mark></p>

<h2 id="internet">Internet</h2>

<p>The founding basics of the internet is deep. In short, we have several layers of abstraction, such that each layer uses its underneath layers, and in the end produce the internet we use today.</p>

<h3 id="osi-model">OSI Model</h3>

<p>The idea is basically the idea that</p>

<p><img src="https://www.guru99.com/images/1/092119_0729_LayersofOSI3.png" alt="Layers of OSI Model Explained" style="zoom:50%;" /></p>

<p>As a programmer, what happens most of the time when you are developing a new product is that you <strong>use the Socket APIs</strong>:</p>

<p><img src="https://gnosis.cx/publish/programming/network-layers.png" alt="Programming IP Sockets on Linux, Part One" /></p>

<p>where:</p>

<ul>
  <li>basically, as a programmer, you usually <strong>stay at and above the socket API level</strong>, i.e. layer 5</li>
  <li>most of the time, <strong>programmers don’t need to go down to layer 4 or beneath</strong></li>
</ul>

<h4 id="application-layer">Application Layer</h4>

<p><strong>Application layer</strong> that <strong>specifies</strong> the shared communications <strong>protocols and interface methods</strong> used by hosts in a communications network. This layer also serves as a window for the <strong>application</strong> services to <strong>access the network and for displaying the received information</strong> to the user.</p>

<ul>
  <li>e.g. Application – Browsers, Skype Messenger etc.</li>
</ul>

<p>Common protocols specified by the application layer involves:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">HTTP</code> protocol, how websites work on browsers, as they all uses methods such as <code class="language-plaintext highlighter-rouge">GET</code>, <code class="language-plaintext highlighter-rouge">POST</code>, etc.</li>
  <li><code class="language-plaintext highlighter-rouge">SMTP</code> protocol, simple mail transport protocol</li>
  <li><code class="language-plaintext highlighter-rouge">SSH</code> protocol, the program <code class="language-plaintext highlighter-rouge">ssh</code> implements this protocol</li>
  <li><code class="language-plaintext highlighter-rouge">NTP</code> protocol, used for synchronizing time</li>
  <li>etc.</li>
</ul>

<p>As a result, <strong>different applications</strong> could potentially use the specified protocol to <strong>interact with each other</strong>.</p>

<h4 id="transport-layer">Transport Layer</h4>

<p>It is <strong>responsible</strong> for the <strong>actual End to End Delivery</strong> of the complete message. The transport layer also provides the acknowledgement of the successful data transmission and re-transmits the data if an error is found.</p>

<ul>
  <li>
    <p>Therefore, it <strong>guarantees</strong> a package delivery, if it is feasible. If not, some message will tell you that it is not feasible.</p>
  </li>
  <li>This even includes data that are truncated into several packages, which gets recomposed in this packet.</li>
  <li>It also uses <strong>port number</strong> associated with the receiver’s application, so that it knows which application specially it should send to.</li>
</ul>

<p>Hence, it has the following functionality:</p>

<ol>
  <li><strong>Segmentation and Reassembly:</strong>
    <ul>
      <li>Starting from the <strong>sender</strong>, if a data to send is too large for a packet,  this layer <strong>first breaks the message into smaller units</strong> . Each of the segment produced has a header associated with it.</li>
      <li>The transport layer at the <strong>destination</strong> station/receiver <strong>reassembles</strong> the message.</li>
    </ul>
  </li>
  <li><strong>Service Point Addressing:</strong> In order to deliver the message to <strong>correct process</strong>, transport layer header includes a type of address called service point address or <strong>port address</strong>. Thus by specifying this address, transport layer makes sure that the <strong>message is delivered to the correct process</strong>.</li>
</ol>

<p>Protocols defined in this layer include:</p>

<ul>
  <li>TCP</li>
  <li>UDP</li>
</ul>

<h4 id="network-layer">Network Layer</h4>

<p>Every computer or interface on the internet has an IP address. Network layer works for the transmission of data from one host to the other located in different networks, using that IP address.</p>

<p>It also takes care of packet routing i.e. selection of the shortest path to transmit the packet, from the number of routes available.</p>

<p>Therefore, it has the following functionalities:</p>

<ul>
  <li><strong>Routing:</strong> The network layer protocols determine which route is suitable from source to destination. This function of network layer is known as routing.</li>
  <li><strong>Logical Addressing:</strong> In order to identify each device on internetwork uniquely, network layer defines an addressing scheme. The sender &amp; receiver’s IP address are placed in the header by network layer. Such an address distinguishes each device uniquely and universally.</li>
</ul>

<blockquote>
  <p><strong>Detailed Mechanism of Routing</strong></p>

  <ul>
    <li>
      <p>Every organization first has gateway router that takes all the packets, look at the destination, and distribute/send the packet to the next hop (router)</p>
    </li>
    <li>the next hop would usually be another router, which figures out one step deeper where your packet should go (by looking up the forwarding tables that it has)</li>
    <li>eventually, the packet gets delivered to your laptop, <strong><em>if it does</em></strong></li>
  </ul>
</blockquote>

<blockquote>
  <p><strong>Router vs Gateway Router</strong></p>

  <ul>
    <li><strong>Router</strong> a device or a hardware which is responsible for receiving, <strong>analyzing and forwarding the data packets to other networks/router</strong>. It also stores the forwarding tables and headers.</li>
    <li><strong>Gateway Router</strong> a device or a hardware which acts like a “gate” among the networks. Thus it can also be defined as a <strong>node which acts as an entrance for the other nodes in the network</strong>. It is also responsible for enabling the traffic flow within the network and communication among the <strong>networks which have a different set of protocols</strong></li>
  </ul>
</blockquote>

<p>The short take home message is that the Network Layer defines <strong><em>how</em></strong> to get one data packet from a device to another.</p>

<ul>
  <li>however, it does <strong>not</strong> guarantee that the actual delivery of the data packet happens (i.e. it might not be received)</li>
</ul>

<p>Some protocols include:</p>

<ul>
  <li>IPv4
    <ul>
      <li>when we talk about IP, we are by default talking about this</li>
    </ul>
  </li>
  <li>IPv6</li>
</ul>

<h4 id="data-link-layer">(Data) Link Layer</h4>

<p>The data link layer (DLL) is responsible for the node to node <strong>delivery of the message (ethernet frame)</strong>. The main function of this layer is to <strong>make sure data transfer is error-free from one node to another, over the physical layer</strong>.</p>

<ul>
  <li>When a packet arrives in a network, it is the responsibility of DLL to transmit it to the Host using its MAC address.</li>
</ul>

<p>Some functionalities of the DLL is:</p>

<ol>
  <li><strong>Framing:</strong> It provides a way for a sender to transmit a set of bits that are meaningful to the receiver.</li>
  <li><strong>Physical addressing:</strong> After creating frames, Data link layer adds <strong>physical addresses (MAC address)</strong> of sender and/or receiver in the header of each frame.</li>
  <li><strong>Error control:</strong> Data link layer provides the mechanism of error control in which it detects and retransmits damaged or lost frames.</li>
  <li>etc.</li>
</ol>

<p>Some <strong>protocols</strong> related to the DLL is:</p>

<ul>
  <li>WIFI</li>
  <li>Ethernet</li>
  <li>etc</li>
</ul>

<h5 id="ethernet-frame">Ethernet Frame</h5>

<p>Basically, a format of encapsulating data, source/destination IP, source/destination MAC, and etc.</p>

<p><img src="\lectures\images\typora-user-images\image-20201109201659596.png" alt="image-20201109201659596" /></p>

<h5 id="mac-address">MAC Address</h5>

<p>MAC Addresses are unique <strong>48-bits</strong> hardware number of a computer, which is embedded into network card (known as <strong>Network Interface Card</strong>) during the time of manufacturing. MAC Address is also known as <strong>Physical Address</strong> of a network device.</p>

<p>With MAC being unique, you can essentially send the message to the designated machine.</p>

<p><img src="\lectures\images\typora-user-images\image-20201109202440554.png" alt="image-20201109202440554" style="zoom:50%;" /></p>

<h4 id="physical-layer">Physical Layer</h4>

<p>It is responsible for the <strong>actual physical connection between the devices</strong>.</p>

<ul>
  <li>even when you make the connection, you need to specify how to get/receive (parse) whatever you got. This is done by the data link layer</li>
</ul>

<p>The physical layer contains <strong>information in the form of bits</strong>. It is responsible for <strong>transmitting</strong> individual bits from one node to the next. When <strong>receiving</strong> data, this layer will get the signal received and <strong>convert it into 0s and 1s</strong> and send them to the <strong>Data Link layer</strong>, which will put the frame (the bunch of bytes) back together.</p>

<ul>
  <li>essentially, this is what Electrical Engineering is about, and what we have covered in the Fundamentals of Computer Science Course.</li>
</ul>

<p>Some functionalities of this layer includes:</p>

<ol>
  <li><strong>Bit synchronization:</strong> The physical layer provides the <strong>synchronization of the bits</strong> by providing a clock. This clock controls <strong>both sender and receiver</strong> thus providing synchronization at bit level.</li>
  <li><strong>Bit rate control:</strong> The Physical layer also defines the <strong>transmission rate</strong>, i.e. the number of bits sent per second.</li>
</ol>

<h2 id="shell-scripts">Shell Scripts</h2>

<p>First of all Bash and Shell distinction:</p>

<ul>
  <li>
    <p>At its base, a <strong>shell</strong> is simply a <strong>macro processor that executes commands</strong>.</p>
  </li>
  <li>A Unix <strong>shell</strong> is both a command interpreter <strong>and</strong> a <strong>programming language</strong>.
    <ul>
      <li>As a command interpreter, the shell provides the user interface to the rich set of GNU utilities.</li>
      <li>The programming language features allow <strong>files containing commands can be created</strong>, and <strong>become commands themselves</strong>.
        <ul>
          <li>These new commands have the <strong>same status as system commands</strong> in directories such as <strong><code class="language-plaintext highlighter-rouge">/bin</code>,</strong> allowing users or groups to establish custom environments to automate their common tasks.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>Bash</strong> is the shell, or <strong>command language interpreter</strong>, <strong><em>for</em></strong> the <strong>GNU operating system</strong>. The name is an acronym for the ‘Bourne-Again SHell’, a pun on Stephen Bourne.</p>
  </li>
  <li><strong>Bash</strong> is largely compatible with <code class="language-plaintext highlighter-rouge">sh</code> and <strong>incorporates useful features from the Korn shell <code class="language-plaintext highlighter-rouge">ksh</code> and the C shell <code class="language-plaintext highlighter-rouge">csh</code>.</strong></li>
</ul>

<h3 id="terminologies">Terminologies</h3>

<p>Some of the common ones are listed below.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">name</code>
    <ul>
      <li>A <code class="language-plaintext highlighter-rouge">word</code> consisting solely of letters, numbers, and underscores, and beginning with a letter or underscore. <code class="language-plaintext highlighter-rouge">Name</code>s are <strong>used as shell variable and function names</strong>. Also referred to as an <strong><code class="language-plaintext highlighter-rouge">identifier</code></strong>.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">builtin</code>
    <ul>
      <li>A command that is <strong>implemented</strong> internally <strong>by the shell itself</strong>, rather than by an executable program somewhere in the file system.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">control operator</code>
    <ul>
      <li>A <code class="language-plaintext highlighter-rouge">token</code> that performs a control function. It is a <code class="language-plaintext highlighter-rouge">newline</code> or one of the following: <code class="language-plaintext highlighter-rouge">‘||’, ‘&amp;&amp;’, ‘&amp;’, ‘;’, ‘;;’, ‘;&amp;’, ‘;;&amp;’, ‘|’, ‘|&amp;’, ‘(’, or ‘)’.</code></li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">field</code>
    <ul>
      <li>A unit of text that is the <strong>result of one of the shell <em>expansions</em></strong>. After expansion, when executing a command, the resulting fields are used as the command name and arguments.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">job</code>
    <ul>
      <li>A set of processes comprising a pipeline, and any processes descended from it, that are all in the same process group.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">process group</code>
    <ul>
      <li>A <strong>collection</strong> of related <strong>processes</strong> each having the same process group ID.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">signal</code>
    <ul>
      <li>A mechanism by which a <strong>process may be notified</strong> by the kernel of an event occurring in the system.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">token</code>
    <ul>
      <li>A <strong>sequence of characters</strong> considered a single unit by the shell. It is either a <strong><code class="language-plaintext highlighter-rouge">word</code></strong> or an <code class="language-plaintext highlighter-rouge">operator</code>.</li>
    </ul>
  </li>
</ul>

<h3 id="writing-a-shell-script">Writing a Shell Script</h3>

<p>A simple example would be:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/sh</span>
<span class="nb">ls</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">#</code> means comment, but if the first line contains <code class="language-plaintext highlighter-rouge">#!</code>, it means run the <strong>program <code class="language-plaintext highlighter-rouge">/bin/sh</code></strong>, and feed the rest of the code in as <strong><code class="language-plaintext highlighter-rouge">stdin</code></strong></li>
</ul>

<h2 id="file-permissions">File Permissions</h2>

<p>Basically, it refers to:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>xy-Laptop<span class="nv">$ </span>ll
total 32
drwxr-xr-x 2 jasonyux jasonyux  4096 Nov 11 19:39 ./
drwxr-xr-x 3 jasonyux jasonyux  4096 Nov  9 18:49 ../
<span class="nt">-rwxr-xr-x</span> 1 jasonyux jasonyux 16880 Nov  9 19:22 a.out<span class="k">*</span>
<span class="nt">-rw-r--r--</span> 1 jasonyux jasonyux   259 Nov  9 19:22 testPipe.c
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>
    <p><strong>owner</strong> is <code class="language-plaintext highlighter-rouge">jasonyux</code>, <strong>group</strong> is <code class="language-plaintext highlighter-rouge">jasonyux</code></p>
  </li>
  <li>
    <p>file permissions can be seen from <code class="language-plaintext highlighter-rouge">-rw-r--r--</code></p>
  </li>
</ul>

<p><img src="https://endtimestruth.com/wp-content/uploads/2014/08/UNIX-file-permissions-rwx-1024x340.jpg" alt="Security Permissions Setting 666 - End Times Truth" style="zoom:50%;" /></p>

<p>where:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">group</code> means all users in this group</li>
  <li>therefore, <code class="language-plaintext highlighter-rouge">-rw-r--r--</code> means:
    <ul>
      <li>it is a <strong>regular file</strong></li>
      <li><strong>owner</strong> has read/write permission</li>
      <li><strong>users in the group</strong> has read permission</li>
      <li><strong>all other users</strong> have read permission</li>
    </ul>
  </li>
</ul>

<p>For directories, the meanings are different:</p>

<ul>
  <li>read permission means you can <code class="language-plaintext highlighter-rouge">ls</code> (or autocomplete)</li>
  <li>
    <p>write permission means you can <strong>change contents</strong> in that directory</p>
  </li>
  <li>execute permission means you can <strong>enter the directory</strong> (i.e. <code class="language-plaintext highlighter-rouge">cd</code> into it)
    <ul>
      <li>this means that if you want to get to a directory such as <code class="language-plaintext highlighter-rouge">cd ~/code/test</code>, <strong>all</strong> directories <code class="language-plaintext highlighter-rouge">~</code>, <code class="language-plaintext highlighter-rouge">code</code>, <code class="language-plaintext highlighter-rouge">test</code> needs to have <code class="language-plaintext highlighter-rouge">x</code> permission</li>
    </ul>
  </li>
</ul>

<h3 id="s-permission"><code class="language-plaintext highlighter-rouge">s</code> Permission</h3>

<p>Now, consider the case that you <strong>ONLY want</strong> an executable to edit your directory (e.g. editing a file there). This means you give the directory permission of <code class="language-plaintext highlighter-rouge">r-x</code>. But if you do not give <code class="language-plaintext highlighter-rouge">w</code> permission, that program <strong>cannot</strong> write anything as well.</p>

<ul>
  <li>therefore, there is a <strong>special permission</strong> <code class="language-plaintext highlighter-rouge">s</code>, meaning <strong><code class="language-plaintext highlighter-rouge">setuid</code></strong> or <code class="language-plaintext highlighter-rouge">setgid</code> bit is on.</li>
</ul>

<p><strong><em>For example:</em></strong></p>

<p>An executable with:</p>

<p><code class="language-plaintext highlighter-rouge">-rwsr-xr-x</code> means:</p>

<ul>
  <li><strong>owner</strong> can do anything, and it sets the <code class="language-plaintext highlighter-rouge">userid</code> of all the others executing it to be the <strong>same as the owner</strong>
    <ul>
      <li>this means users in group/other users, though cannot write to the file, can <strong>execute the file as if the owner executed it</strong></li>
    </ul>
  </li>
</ul>

<h3 id="binary-encoding-of-file-permissions">Binary Encoding of File Permissions</h3>

<p>The idea is that every permission can be expressed as a number:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">_rw_r__r__</code> means <code class="language-plaintext highlighter-rouge">110 100 100</code>, hence it means <code class="language-plaintext highlighter-rouge">6 4 4</code></li>
  <li><code class="language-plaintext highlighter-rouge">_rwxr_xr_x</code> means <code class="language-plaintext highlighter-rouge">111 101 101</code>, hence it means <code class="language-plaintext highlighter-rouge">7 5 5</code></li>
</ul>

<blockquote>
  <p><strong>Extension:</strong></p>

  <ul>
    <li>For the special permission <code class="language-plaintext highlighter-rouge">s</code>, you need to add an extra <code class="language-plaintext highlighter-rouge">1</code> in front</li>
    <li><code class="language-plaintext highlighter-rouge">-rwsr-xr-x</code> means <code class="language-plaintext highlighter-rouge">1 7 5 5</code></li>
  </ul>
</blockquote>

<h3 id="changing-permission">Changing Permission</h3>

<p>Basically, you use <code class="language-plaintext highlighter-rouge">chmod &lt;permission number&gt; &lt;file&gt;</code></p>

<p><strong><em>For example</em></strong></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">chmod 755 &lt;your file&gt;</code></li>
  <li>usually needs <code class="language-plaintext highlighter-rouge">sudo</code></li>
</ul>

<h2 id="file-descriptors">File Descriptors</h2>

<p>UNIX OS has the I/O API: <strong><code class="language-plaintext highlighter-rouge">open</code>, <code class="language-plaintext highlighter-rouge">read</code>, <code class="language-plaintext highlighter-rouge">write</code></strong></p>

<ul>
  <li>
    <p>these are system level functions.</p>
  </li>
  <li>
    <p>the standard <code class="language-plaintext highlighter-rouge">C</code> library uses <code class="language-plaintext highlighter-rouge">fopen</code>, <code class="language-plaintext highlighter-rouge">fread</code>, <code class="language-plaintext highlighter-rouge">fwrite</code>, etc</p>
    <ul>
      <li>they depends on the system level I/O functions. If you use UNIX, then <code class="language-plaintext highlighter-rouge">C</code> uses <code class="language-plaintext highlighter-rouge">open</code>,…</li>
    </ul>
  </li>
</ul>

<p>Additionally, the methods <code class="language-plaintext highlighter-rouge">open</code>/<code class="language-plaintext highlighter-rouge">read</code>/<code class="language-plaintext highlighter-rouge">write</code> has <strong>integer (file descriptor) return type</strong>.</p>

<ul>
  <li>file descriptors are <strong>small integers</strong> representing <strong>open files</strong>
    <ul>
      <li>instead of the <code class="language-plaintext highlighter-rouge">FILE *</code> for <code class="language-plaintext highlighter-rouge">C</code> library</li>
      <li>when a program starts, <strong>kernel automatically opens 3 files</strong> without being asked
        <ul>
          <li><code class="language-plaintext highlighter-rouge">stdin</code>, <code class="language-plaintext highlighter-rouge">stdout</code>, <code class="language-plaintext highlighter-rouge">stderr</code> on descriptors <code class="language-plaintext highlighter-rouge">0</code>, <code class="language-plaintext highlighter-rouge">1</code>, <code class="language-plaintext highlighter-rouge">2</code> (imagine those are specifically connected to your program)
            <ul>
              <li>i.e. keyboard, screen, screen unless redirected</li>
            </ul>
          </li>
          <li>subsequent open files get file descriptor <code class="language-plaintext highlighter-rouge">3</code>,<code class="language-plaintext highlighter-rouge">4</code>,<code class="language-plaintext highlighter-rouge">5</code>,<code class="language-plaintext highlighter-rouge">6</code>,…</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p><strong><em>For example:</em></strong></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="s">"myfile"</span><span class="p">,</span> <span class="n">O_RDONLY</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> 
        <span class="k">if</span> <span class="p">(</span><span class="n">fd</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// open error</span>
        <span class="p">}</span>
        <span class="p">...</span>
</code></pre></div></div>

<blockquote>
  <p><strong>In general</strong></p>

  <ul>
    <li>The take-away message is that <strong>everything in UNIX is a file</strong>, namely, the base operations are <strong>read/write</strong>.
      <ul>
        <li>file descriptors are used for sockets too, i.e. reading from internet and writing to internet</li>
      </ul>
    </li>
  </ul>
</blockquote>

<h2 id="endianness">Endianness</h2>

<p><strong>Big Endianness</strong> vs <strong>Little Endianness</strong></p>

<ul>
  <li>if you write <strong>multi-byte data</strong> into your file, <strong>little endianness</strong> <strong>stores <em>and</em> reads</strong> each byte of the data in the “reverse order”, such that the <strong>least significant byte</strong> goes first
    <ul>
      <li>e.g. this means <code class="language-plaintext highlighter-rouge">0x 00 01 02 03</code> gets stored to <code class="language-plaintext highlighter-rouge">03 02 01 00</code>
        <ul>
          <li>this happens because the above is a <strong>single</strong> 4 byte data, and it when it writes <strong>the data</strong> together, it flips</li>
          <li>since we have binary files, the <strong>actual storage</strong> looks like <code class="language-plaintext highlighter-rouge">00000011 00000010 00000001 00000000</code></li>
        </ul>
      </li>
      <li>therefore, this will not happen to <code class="language-plaintext highlighter-rouge">char []</code>, which are essentially <strong>sequence</strong> of 1 byte data, so it will write each data (one character=one byte), and hence <strong>will not be flipped</strong></li>
      <li>e.g. <strong>Intel-CPUs</strong> store them backwards</li>
    </ul>
  </li>
  <li><strong>Big endianness</strong> is the “natural” order for storing each byte, such that it
    <ul>
      <li>the <strong>internet byte order</strong> is also <strong>big endianness</strong></li>
    </ul>
  </li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;assert.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;arpa/inet.h&gt;</span><span class="cp">
</span>
<span class="cp">#define HOST_FILE "endian-demo.host"
#define NET_FILE  "endian-demo.net"
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">num_host</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">num_net</span><span class="p">;</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"Enter a hexadecimal integer: "</span><span class="p">);</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">"%x"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">num_host</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"The hex number 0x%.8x is %d in decimal</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">num_host</span><span class="p">,</span> <span class="n">num_host</span><span class="p">);</span>

    <span class="n">f</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">HOST_FILE</span><span class="p">,</span> <span class="s">"wb"</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
    <span class="c1">// write the number</span>
    <span class="n">fwrite</span><span class="p">(</span><span class="o">&amp;</span><span class="n">num_host</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">num_host</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">f</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Wrote num_host to %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">HOST_FILE</span><span class="p">);</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>

    <span class="c1">// converts the HOST byte order TO NETWORK byte order</span>
    <span class="c1">// for intel cpu, converts Little Endianness to Big Endianness</span>
    <span class="c1">// actually, just swap the sequence of numbers</span>
    <span class="n">num_net</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">num_host</span><span class="p">);</span>

    <span class="n">f</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">NET_FILE</span><span class="p">,</span> <span class="s">"wb"</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
    <span class="n">fwrite</span><span class="p">(</span><span class="o">&amp;</span><span class="n">num_net</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">num_net</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">f</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Wrote num_net to %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">NET_FILE</span><span class="p">);</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"Run </span><span class="se">\"</span><span class="s">hd &lt;filename&gt;</span><span class="se">\"</span><span class="s"> to see the content of a file</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>a <strong>hexadecimal number</strong> would be 4 bytes, in the form <code class="language-plaintext highlighter-rouge">0x 00 00 00 00</code>.</li>
</ul>

<p>Therefore, to read/write into the network, you need to:</p>

<ul>
  <li><strong>use <code class="language-plaintext highlighter-rouge">htonl</code></strong> transform your computer’s byte order to the network byte order</li>
  <li><strong>use <code class="language-plaintext highlighter-rouge">ntohl</code></strong> transforms network byte order (big endianness) to your host computer’s endianness</li>
</ul>

<blockquote>
  <p><strong>In general</strong></p>

  <ul>
    <li>The problem is with how each single unit of data is represented. If <strong>each <em>unit</em> of data</strong> to be written <strong>exceeded one byte</strong>, then every write <strong>will flip</strong> the order (if little endian). However, if each unit of data is one byte or less, then each write does nothing.
      <ul>
        <li>e.g. writing <code class="language-plaintext highlighter-rouge">char string[2] = "ac"</code> will be stored as <code class="language-plaintext highlighter-rouge">61 63</code>, since you have <strong>two units/writes</strong> of one byte.
          <ul>
            <li>you are essentially <strong>writing</strong> <code class="language-plaintext highlighter-rouge">a</code>, <strong>then</strong> writing <code class="language-plaintext highlighter-rouge">c</code>.</li>
          </ul>
        </li>
        <li>e.g. writing <code class="language-plaintext highlighter-rouge">short test = 2</code> will be stored as <code class="language-plaintext highlighter-rouge">02 00</code>, because a short is a <strong>single write</strong> of <code class="language-plaintext highlighter-rouge">0002</code>.</li>
      </ul>
    </li>
    <li>Use <strong><code class="language-plaintext highlighter-rouge">hd</code></strong> to look at the content of a <strong>binary</strong> file</li>
  </ul>
</blockquote>

<h1 id="week-11">Week 11</h1>

<h2 id="socket-api">Socket API</h2>

<p>The client server (or B/S) model</p>

<p><img src="\lectures\images\typora-user-images\image-20201113203453033.png" alt="image-20201113203453033" style="zoom: 67%;" /></p>

<p>and the idea is:</p>

<ul>
  <li>server (program) waits for request from clients</li>
  <li>client (program) makes a request</li>
  <li>server and client handshakes, and establish a connection/session</li>
  <li>now, we can communicate using <strong>data packets</strong>
    <ul>
      <li>remember, data packets would contain source/destination IP <strong>and</strong> source/destination port number</li>
    </ul>
  </li>
</ul>

<p>Under the hood, the base implementations will be the <strong>Socket API</strong></p>

<ul>
  <li>e.g. underneath Java, it is probably written in <code class="language-plaintext highlighter-rouge">C</code></li>
</ul>

<p><strong><em>For example:</em></strong></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">www.columbia.edu</code> will be translated by the <code class="language-plaintext highlighter-rouge">DNS</code> server to the IP address of <code class="language-plaintext highlighter-rouge">128.59.105.24</code>
    <ul>
      <li>obtained by running <code class="language-plaintext highlighter-rouge">dig &lt;web-address&gt;</code></li>
    </ul>
  </li>
</ul>

<h3 id="socket">Socket</h3>

<p>A <strong>socket</strong> is defined as the end-point for TCP/IP network connection.</p>

<ul>
  <li>It is consist of two components from <strong>both</strong> client and server:</li>
</ul>

<p><img src="\lectures\images\typora-user-images\image-20201113205447514.png" alt="image-20201113205447514" style="zoom: 80%;" /></p>

<ul>
  <li>an IP address</li>
  <li>a port number</li>
</ul>

<p><strong><em>For example:</em></strong></p>

<ul>
  <li>Once you made a connection between the client and the server via <code class="language-plaintext highlighter-rouge">nc</code>, there are four things being connected:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">nc -l 10000</code> on server
        <ol>
          <li>with IP <code class="language-plaintext highlighter-rouge">217.100.011.011 </code>(e.g.)</li>
          <li>with port <code class="language-plaintext highlighter-rouge">10000</code></li>
        </ol>
      </li>
      <li><code class="language-plaintext highlighter-rouge">nc 217.100.011.011 10000</code>
        <ol>
          <li>with IP <code class="language-plaintext highlighter-rouge">123.456.789.000</code> (e.g.)</li>
          <li>with <strong>randomly</strong> generated port <code class="language-plaintext highlighter-rouge">4543</code> (e.g.)</li>
        </ol>
      </li>
    </ul>
  </li>
</ul>

<h3 id="socket-api-summary">Socket API Summary</h3>

<p><img src="\lectures\images\typora-user-images\image-20201113205829004.png" alt="image-20201113205829004" style="zoom:67%;" /></p>

<p>where:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">accept</code> on the server side would be a BIO function</li>
</ul>

<h4 id="socket-1"><code class="language-plaintext highlighter-rouge">socket()</code></h4>

<h3 id="listening-socket-vs-connected-socket">Listening Socket vs Connected Socket</h3>

<p><img src="\lectures\images\typora-user-images\image-20201113210323580.png" alt="image-20201113210323580" style="zoom:50%;" /></p>

<p>where:</p>

<ul>
  <li>the <strong>listening</strong> socket <strong>lives</strong> for the lifetime of the program</li>
  <li>
    <p><strong>all server side</strong> sockets will have a port number being the <strong>same</strong>: <code class="language-plaintext highlighter-rouge">80</code></p>
  </li>
  <li>a problem you see here is that in this design, you can only make one socket connection with the server, since the port <code class="language-plaintext highlighter-rouge">80</code> for <strong>listening</strong> will be <strong>blocked</strong> until the established connection <strong>closes</strong>.
    <ul>
      <li>you can in fact also specify the size of queue for that listening socket</li>
    </ul>
  </li>
  <li>this diagram would be useful for some examples shown in the section <a href="#Socket API Examples">Socket API Examples</a></li>
</ul>

<h3 id="socket-api-examples">Socket API Examples</h3>

<h4 id="tcp-echo-client"><code class="language-plaintext highlighter-rouge">tcp-echo-client</code></h4>

<p>In short, the program:</p>

<ol>
  <li><strong>Create</strong>/initialize the <code class="language-plaintext highlighter-rouge">socket</code></li>
  <li><strong>Connect</strong> to the <code class="language-plaintext highlighter-rouge">tcp-echo-server</code> program using the server <code class="language-plaintext highlighter-rouge">ip</code> and <code class="language-plaintext highlighter-rouge">port</code></li>
  <li>Get a line from client terminal, and <strong>send</strong> that to <code class="language-plaintext highlighter-rouge">tcp-echo-server</code></li>
  <li><strong>Receive</strong> content (first letter capitalized) from the server</li>
  <li><strong>Close</strong> the connection, and quit the program</li>
</ol>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">static</span> <span class="kt">void</span> <span class="nf">die</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">)</span> <span class="p">{</span> <span class="n">perror</span><span class="p">(</span><span class="n">s</span><span class="p">);</span> <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"usage: %s &lt;server-ip&gt; &lt;server-port&gt;</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span>
                <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ip</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="c1">// atoi converts initial portion of the string pointed to by ptr to int.</span>
    <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">port</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span> 

    <span class="c1">// 1. Create a socket for TCP connection</span>

    <span class="kt">int</span> <span class="n">sock</span><span class="p">;</span> <span class="c1">// socket descriptor</span>
    <span class="c1">// creates the socket that contains its own IP and port</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">die</span><span class="p">(</span><span class="s">"socket failed"</span><span class="p">);</span>

    <span class="c1">// 1.1 Construct a server address structure</span>

    <span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">servaddr</span>
    <span class="c1">// put 0 on every single byte of the structure</span>
    <span class="c1">// this is useful in other cases as well, </span>
    <span class="c1">// since it made sure every allocated byte is non-empty/initialized</span>
    <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">servaddr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">servaddr</span><span class="p">));</span> <span class="c1">// must zero out the structure</span>
    <span class="n">servaddr</span><span class="p">.</span><span class="n">sin_family</span>      <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
    <span class="c1">// inet_addr takes in ip in string, and converts to network byte order ip</span>
    <span class="n">servaddr</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span> <span class="o">=</span> <span class="n">inet_addr</span><span class="p">(</span><span class="n">ip</span><span class="p">);</span>
    <span class="c1">// htons converts short variable to big endian/network byte order</span>
    <span class="n">servaddr</span><span class="p">.</span><span class="n">sin_port</span>        <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="n">port</span><span class="p">);</span> <span class="c1">// must be in network byte order</span>

    <span class="c1">// 2. Establish a TCP connection to the server</span>

    <span class="c1">// connect returns only when its done connecting</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">connect</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">servaddr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">servaddr</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">die</span><span class="p">(</span><span class="s">"connect failed"</span><span class="p">);</span>

    <span class="c1">// 3. Read a line from stdin and send it to the server</span>

    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fgets</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="n">stdin</span><span class="p">)</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">die</span><span class="p">(</span><span class="s">"fgets returned NULL"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// recall that fgets add a "\0" in the end.</span>
    <span class="c1">// so "Hi\n" becomes "Hi\n\0"</span>
    <span class="kt">size_t</span> <span class="n">len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span> <span class="c1">// so strlen("Hi\n\0")==3</span>

    <span class="cm">/*
     * send(int socket, const void *buffer, size_t length, int flags)
     *
     *   - normally, send() blocks until it sends all bytes requested
     *   - returns num bytes sent or -1 for error
     *   - send(sock,buf,len,0) is equivalent to write(sock,buf,len)
     *      - recall that write() is the unix version for file descriptor=sock here
     */</span>
    <span class="c1">// here, you don't need to send the "\0"</span>
    <span class="c1">// blocks/returns only when finished sending</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">send</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="n">len</span><span class="p">)</span>
        <span class="n">die</span><span class="p">(</span><span class="s">"send failed"</span><span class="p">);</span>

    <span class="c1">// 4. Receive the responses from the server and print them</span>

    <span class="cm">/*
     * recv(int socket, void *buffer, size_t length, int flags)
     *
     *   - normally, recv() blocks until it has received at least 1 byte
     *   - returns num bytes received, 0 if connection CLOSED, -1 if error
     *   - recv(sock,buf,len,0) is equivalent to read(sock,buf,len)
     * 		- again, read() is the UNIX version for file descriptors
     */</span>
    <span class="kt">int</span> <span class="n">r</span><span class="p">;</span>
    <span class="c1">// here, it says we receive up to 100 bytes. </span>
    <span class="c1">// In fact, server usually breaks content up into multiple shots,</span>
    <span class="c1">// AND number of chunks sent each time is also RANDOM</span>
    <span class="c1">// the only thing that is preserved is the ORDER (so we can put them together)</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">r</span> <span class="o">=</span> <span class="n">recv</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"RECEIVED: ["</span><span class="p">);</span>
        <span class="c1">// printf() would NOT work because it might not be null terminated</span>
        <span class="n">fwrite</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">stdout</span><span class="p">);</span> <span class="c1">// write 1 byte r times</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"]</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">len</span> <span class="o">-=</span> <span class="n">r</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">die</span><span class="p">(</span><span class="s">"recv failed"</span><span class="p">);</span>

    <span class="c1">// 5. Close the connection. Clean-up</span>

    <span class="n">close</span><span class="p">(</span><span class="n">sock</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>where, some important things to note are:</p>

<ul>
  <li>
    <p>the socket of the client will have its <strong>own</strong> <code class="language-plaintext highlighter-rouge">ip</code> and <code class="language-plaintext highlighter-rouge">port</code> indented <strong>automatically</strong>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">socket(AF_INET, SOCK_STREAM, 0)</code> means we are doing:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">AF_INET</code> = <code class="language-plaintext highlighter-rouge">IPv4</code></li>
      <li><code class="language-plaintext highlighter-rouge">SOCK_STREAM</code> = <code class="language-plaintext highlighter-rouge">TCP</code></li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">structaddr_in</code> looks like:</p>

    <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// see this as: class sockaddr_in "extends" sockaddr</span>
<span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="p">{</span> <span class="c1">// in total takes up 8 bytes</span>
    <span class="n">sa_family_t</span>    <span class="n">sin_family</span><span class="p">;</span> <span class="cm">/* address family: AF_INET */</span>
    <span class="n">in_port_t</span>      <span class="n">sin_port</span><span class="p">;</span>   <span class="cm">/* port in NETWORK BYTE order */</span>
    <span class="k">struct</span> <span class="n">in_addr</span> <span class="n">sin_addr</span><span class="p">;</span>   <span class="cm">/* internet address */</span>
<span class="p">};</span>
</code></pre></div>    </div>

    <p>and the <code class="language-plaintext highlighter-rouge">struct in_addr</code> looks like:</p>

    <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">in_addr</span> <span class="p">{</span>
    <span class="kt">uint32_t</span>       <span class="n">s_addr</span><span class="p">;</span>     <span class="cm">/* address in NETWORK BYTE order */</span>
<span class="p">};</span>
</code></pre></div>    </div>

    <p>lastly, we casted the pointer to <code class="language-plaintext highlighter-rouge">sockaddr_in</code> to <code class="language-plaintext highlighter-rouge">sockaddr</code>, because:</p>

    <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">sockaddr</span> <span class="p">{</span>
    <span class="c1">// internally, when connect sees sa_family=AF_INET</span>
    <span class="c1">// it will cast the type back to sockaddr_in (down-casting)</span>
    <span class="n">sa_family_t</span> <span class="n">sa_family</span><span class="p">;</span>
    <span class="kt">char</span>        <span class="n">sa_data</span><span class="p">[</span><span class="mi">14</span><span class="p">];</span> <span class="c1">// this is just a filler</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">send()</code> function is <strong>blocking</strong>, such that it <strong>returns</strong> (number of bytes sent) <strong>only</strong> when finished sending the contents you specified</p>

    <ul>
      <li>it is more useful than <code class="language-plaintext highlighter-rouge">write()</code> due to the last option. (in this case, <code class="language-plaintext highlighter-rouge">0</code> means default, which would be equivalent to <code class="language-plaintext highlighter-rouge">write(sock,buf,len)</code>)</li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">recv()</code> function is also <strong>blocking</strong>, but different from <code class="language-plaintext highlighter-rouge">send()</code>, such that you have <strong>no control</strong> exactly how many bytes are going to come.</p>
    <ul>
      <li>the return values here is important to know:
        <ul>
          <li><strong>number of bytes</strong> received</li>
          <li><strong><code class="language-plaintext highlighter-rouge">0</code> if connection <code class="language-plaintext highlighter-rouge">CLOSED</code></strong></li>
          <li><code class="language-plaintext highlighter-rouge">-1</code> if <code class="language-plaintext highlighter-rouge">error</code></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<blockquote>
  <p><strong>Trick</strong></p>

  <ul>
    <li>
      <p>Instead of reading from the client with random number of bytes with <code class="language-plaintext highlighter-rouge">recv</code>, you <strong><em>can</em></strong> <strong>read line by line</strong>, by:</p>

      <ol>
        <li>
          <p><strong>convert</strong> the <code class="language-plaintext highlighter-rouge">socket</code> into a <code class="language-plaintext highlighter-rouge">File *</code> with <code class="language-plaintext highlighter-rouge">FILE *input = fdopen(socket_descriptor, "r");</code></p>
        </li>
        <li>
          <p>use <code class="language-plaintext highlighter-rouge">fgets()</code>, <strong>assuming</strong> the content is a <strong>text</strong></p>
          <ul>
            <li>if you have binary coming, it will not work</li>
          </ul>
        </li>
      </ol>
    </li>
  </ul>
</blockquote>

<blockquote>
  <p>So we see that almost <strong>always</strong>, we will have the template:</p>

  <ul>
    <li>
      <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ip</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
 <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">port</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span> 

<span class="c1">// Create a socket for TCP connection</span>
</code></pre></div>      </div>
    </li>
  </ul>

  <p>int sock; // socket descriptor
  if ((sock = socket(AF_INET, SOCK_STREAM, 0)) &lt; 0)
      die(“socket failed”);</p>

  <p>// Construct a server address structure</p>

  <p>struct sockaddr_in servaddr;
  memset(&amp;servaddr, 0, sizeof(servaddr));
  servaddr.sin_family      = AF_INET;
  servaddr.sin_addr.s_addr = inet_addr(ip);
  servaddr.sin_port        = htons(port);</p>

  <p>// Establish a TCP connection to the server</p>

  <p>if (connect(sock, (struct sockaddr *) &amp;servaddr, sizeof(servaddr)) &lt; 0)
      die(“connect failed”);</p>

  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> 
</code></pre></div>  </div>
</blockquote>

<h4 id="tcp-echo-server"><code class="language-plaintext highlighter-rouge">tcp-echo-server</code></h4>

<p>In short, this program:</p>

<ol>
  <li><strong>create</strong>/initialize the socket</li>
  <li><strong>bind</strong> the socket to your <code class="language-plaintext highlighter-rouge">ip</code>/<code class="language-plaintext highlighter-rouge">port</code> for listening</li>
  <li>start <strong>listening</strong> and waits for a connection</li>
  <li>when receives a request for connection, <strong>accept</strong> and establish the connection</li>
  <li><strong>receive</strong> contents from client, capitalize the first character</li>
  <li><strong>sends</strong> the content back to the client</li>
  <li><strong>close</strong> the connection</li>
  <li>loop back to to step 4</li>
</ol>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">static</span> <span class="kt">void</span> <span class="nf">die</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">)</span> <span class="p">{</span> <span class="n">perror</span><span class="p">(</span><span class="n">s</span><span class="p">);</span> <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"usage: %s &lt;server-port&gt;</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">port</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

    <span class="c1">// 1. Create a listening socket (also called server socket) </span>

    <span class="kt">int</span> <span class="n">servsock</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">servsock</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">die</span><span class="p">(</span><span class="s">"socket failed"</span><span class="p">);</span>

    <span class="c1">// 1.1 Construct local address structure</span>

    <span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">servaddr</span><span class="p">;</span>
    <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">servaddr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">servaddr</span><span class="p">));</span>
    <span class="n">servaddr</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
    <span class="c1">// need to pass in your OWN ip address</span>
    <span class="c1">// INADDR_ANY=0.0.0.0, meaning any IP address I HAVE/OWN</span>
    <span class="c1">// you could manually put in your own IP address as well</span>
    <span class="n">servaddr</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">INADDR_ANY</span><span class="p">);</span> <span class="c1">// any network interface</span>
    <span class="c1">// your OWN port</span>
    <span class="n">servaddr</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>

    <span class="c1">// 2. Bind to the OWN local address</span>

    <span class="c1">// bind instead of connect</span>
    <span class="c1">// error: port number already in use is an error from this function</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">bind</span><span class="p">(</span><span class="n">servsock</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">servaddr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">servaddr</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">die</span><span class="p">(</span><span class="s">"bind failed"</span><span class="p">);</span>

    <span class="c1">// 3. Start listening for incoming connections</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">listen</span><span class="p">(</span><span class="n">servsock</span><span class="p">,</span> <span class="mi">5</span> <span class="cm">/* queue size for connection requests */</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">die</span><span class="p">(</span><span class="s">"listen failed"</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">r</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span> <span class="c1">// 10 bytes buf</span>

    <span class="kt">int</span> <span class="n">clntsock</span><span class="p">;</span>
    <span class="n">socklen_t</span> <span class="n">clntlen</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">clntaddr</span><span class="p">;</span> <span class="c1">// this is empty</span>

    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>

        <span class="c1">// 4. Accept an incoming connection</span>

        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"waiting for client ... "</span><span class="p">);</span>

        <span class="n">clntlen</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">clntaddr</span><span class="p">);</span> <span class="c1">// initialize the in-out parameter</span>

        <span class="c1">// accept() is also a BLOCKING function</span>
        <span class="c1">// BOTH client and server sockets RETURN ONLY WHEN accepted </span>
        <span class="k">if</span> <span class="p">((</span><span class="n">clntsock</span> <span class="o">=</span> <span class="n">accept</span><span class="p">(</span><span class="n">servsock</span><span class="p">,</span>
                        <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">clntaddr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">clntlen</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">die</span><span class="p">(</span><span class="s">"accept failed"</span><span class="p">);</span>

        <span class="c1">// accept() RETURNED a CONNECTED SOCKET (also called client socket)</span>
        <span class="c1">// and filled in the client's address into clntaddr</span>

        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"client ip: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">inet_ntoa</span><span class="p">(</span><span class="n">clntaddr</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">));</span>

        <span class="c1">// 5. Receive msg from client, capitalize the 1st char, </span>
        <span class="c1">// 6. And send it back</span>

        <span class="c1">// receive up to 10 bytes=sizeof(buf) at a time</span>
        <span class="c1">// note that r != 10 all the time (in fact, often it is random)</span>
        <span class="c1">// we terminate the loop NORMALLY when r=0, namely, CLIENT CLOSED connection</span>
        <span class="k">while</span> <span class="p">((</span><span class="n">r</span> <span class="o">=</span> <span class="n">recv</span><span class="p">(</span><span class="n">clntsock</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">*</span><span class="n">buf</span> <span class="o">=</span> <span class="n">toupper</span><span class="p">(</span><span class="o">*</span><span class="n">buf</span><span class="p">);</span>
            <span class="c1">// so we should send up to r bytes</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">send</span><span class="p">(</span><span class="n">clntsock</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// SERVER should not die!</span>
                <span class="c1">// if something went wrong, we should just close the connection</span>
                <span class="c1">// and restart/accept NEW connections</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"ERR: send failed</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"ERR: recv failed</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// Client closed the connection (r==0) or there was an error</span>
        <span class="c1">// 7. Either way, close the connected client socket and go back to accept()</span>

        <span class="n">close</span><span class="p">(</span><span class="n">clntsock</span><span class="p">);</span> <span class="c1">// so in the end, client closes first, and then server closes</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">accept(servsock, (struct sockaddr *) &amp;clntaddr, &amp;clntlen)</code> does a lot:
    <ul>
      <li><strong>establishes</strong> the connection and <strong>returns</strong> a connected socket</li>
      <li><strong>fills in data</strong> related to the client side into <code class="language-plaintext highlighter-rouge">clntaddr</code></li>
      <li><strong>change</strong> the <code class="language-plaintext highlighter-rouge">clntlen</code> to tell me how many bytes have been filled into <code class="language-plaintext highlighter-rouge">clntaddr</code> (not used here)</li>
    </ul>
  </li>
  <li><strong>listening socket</strong> lives <strong>forever</strong> until the program dies.
    <ul>
      <li>you can think of the returned <code class="language-plaintext highlighter-rouge">socket</code> from <code class="language-plaintext highlighter-rouge">accept()</code> to be another standalone socket</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">recv()</code>, as mentioned for client version of the program as well, has a random behavior, such that:
    <ul>
      <li>you <strong>cannot be sure</strong> how many bytes will come at each time</li>
    </ul>
  </li>
  <li>lastly, for the error conditions here (by <code class="language-plaintext highlighter-rouge">send</code> or <code class="language-plaintext highlighter-rouge">recv</code>), we should try <strong>not</strong> to terminate our program:
    <ul>
      <li>as a server, we should keep ourselves alive, <strong>unless</strong> you are sure it will be <strong>server side error</strong></li>
      <li>for other errors, the intuitive solution would be <strong>close</strong> the connection, and let the <strong>client retry/reconnect</strong></li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>Again, the template almost always for a server would be:</p>

  <ul>
    <li>
      <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 1. Create a listening socket (also called server socket) </span>
<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">port</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  
<span class="kt">int</span> <span class="n">servsock</span><span class="p">;</span>
<span class="k">if</span> <span class="p">((</span><span class="n">servsock</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">die</span><span class="p">(</span><span class="s">"socket failed"</span><span class="p">);</span>
  
<span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">servaddr</span><span class="p">;</span>
<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">servaddr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">servaddr</span><span class="p">));</span>
<span class="n">servaddr</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
<span class="n">servaddr</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">INADDR_ANY</span><span class="p">);</span> <span class="c1">// any network interface</span>
<span class="n">servaddr</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>
  
<span class="c1">// 2. Bind to the OWN local address</span>
  
<span class="k">if</span> <span class="p">(</span><span class="n">bind</span><span class="p">(</span><span class="n">servsock</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">servaddr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">servaddr</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">die</span><span class="p">(</span><span class="s">"bind failed"</span><span class="p">);</span>
  
<span class="c1">// 3. Start listening for incoming connections</span>
  
<span class="k">if</span> <span class="p">(</span><span class="n">listen</span><span class="p">(</span><span class="n">servsock</span><span class="p">,</span> <span class="mi">5</span> <span class="cm">/* queue size for connection requests */</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">die</span><span class="p">(</span><span class="s">"listen failed"</span><span class="p">);</span>
  
<span class="kt">int</span> <span class="n">r</span><span class="p">;</span>
<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
  
<span class="kt">int</span> <span class="n">clntsock</span><span class="p">;</span>
<span class="n">socklen_t</span> <span class="n">clntlen</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">clntaddr</span><span class="p">;</span>
  
<span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"waiting for client ... "</span><span class="p">);</span>
      
	<span class="c1">// 4. Accept an incoming connection</span>
      
    <span class="n">clntlen</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">clntaddr</span><span class="p">);</span> <span class="c1">// initialize the in-out parameter    </span>
    <span class="k">if</span> <span class="p">((</span><span class="n">clntsock</span> <span class="o">=</span> <span class="n">accept</span><span class="p">(</span><span class="n">servsock</span><span class="p">,</span>
                           <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">clntaddr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">clntlen</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">die</span><span class="p">(</span><span class="s">"accept failed"</span><span class="p">)</span>
 	<span class="p">...</span>       
<span class="p">}</span>
</code></pre></div>      </div>
    </li>
  </ul>
</blockquote>

<h1 id="week-12">Week 12</h1>

<h2 id="http">HTTP</h2>

<p>First, we talk about <code class="language-plaintext highlighter-rouge">HTTP 1.0</code> protocol. The general concept behind web is:</p>

<ul>
  <li><strong>Client sends</strong> a <code class="language-plaintext highlighter-rouge">HTTP</code> request for a <strong>resource</strong> on server (by default, to port <code class="language-plaintext highlighter-rouge">80</code>)
    <ul>
      <li>e.g. the <code class="language-plaintext highlighter-rouge">index.html</code> file</li>
    </ul>
  </li>
  <li><strong>Server sends</strong> a <code class="language-plaintext highlighter-rouge">HTTP</code> response</li>
</ul>

<p><strong><em>For example</em></strong></p>

<ul>
  <li>If you type in something like <code class="language-plaintext highlighter-rouge">www.test101.com/doc/test.html</code>, your <strong>browser</strong> <strong>sends</strong> the following:
    <ul>
      <li>the <strong>format</strong> of request and response will <strong>conform to the HTTP protocol</strong></li>
    </ul>
  </li>
</ul>

<p><img src="\lectures\images\typora-user-images\image-20201125220050808.png" alt="image-20201125220050808" style="zoom: 50%;" /></p>

<ul>
  <li>
    <p>Then, by the same protocol, the server will respond the following (a different request):</p>

    <p><img src="\lectures\images\typora-user-images\image-20201125220445849.png" alt="image-20201125220445849" style="zoom: 50%;" /></p>
  </li>
</ul>

<blockquote>
  <p><strong>Note:</strong></p>

  <ul>
    <li>
      <p>HTTP protocol also specified that each <strong>new line is terminated with <code class="language-plaintext highlighter-rouge">\r\n</code></strong>, instead of <code class="language-plaintext highlighter-rouge">\n</code>.</p>

      <ul>
        <li>
          <p>for example:</p>

          <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK\r\n</span>
<span class="na">Date</span><span class="p">:</span> <span class="s">...</span>
</code></pre></div>          </div>

          <p>where:</p>

          <ul>
            <li>the actual one would be in binary of course</li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</blockquote>

<blockquote>
  <p><strong>Further Reading:</strong></p>

  <ul>
    <li>http://www.jmarshall.com/easy/http/</li>
  </ul>
</blockquote>

<h3 id="imitating-http-using-netcat">Imitating HTTP using <code class="language-plaintext highlighter-rouge">netcat</code></h3>

<p>In fact, you could <strong>simulate</strong> the action of <strong>requesting</strong> using <code class="language-plaintext highlighter-rouge">netcat</code>:</p>

<ul>
  <li>
    <p>use <code class="language-plaintext highlighter-rouge">nc clac.cs.columbia.edu 80</code>, and <strong>send</strong> <code class="language-plaintext highlighter-rouge">GET / HTTP/1.1</code></p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">GET / HTTP/1.1</code> is the same as <code class="language-plaintext highlighter-rouge">GET /index.html HTTP/1.1</code></li>
    </ul>
  </li>
  <li>
    <p>The content returned will be:</p>

    <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Date</span><span class="p">:</span> <span class="s">Wed, 25 Nov 2020 14:21:40 GMT</span>
<span class="na">Server</span><span class="p">:</span> <span class="s">Apache/2.4.29 (Ubuntu)</span>
<span class="na">Upgrade</span><span class="p">:</span> <span class="s">h2</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">Upgrade, close</span>
<span class="na">Last-Modified</span><span class="p">:</span> <span class="s">Fri, 25 Jan 2019 02:00:56 GMT</span>
<span class="na">ETag</span><span class="p">:</span> <span class="s">"4c2-5803eb299c120"</span>
<span class="na">Accept-Ranges</span><span class="p">:</span> <span class="s">bytes</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">1218</span>
<span class="na">Vary</span><span class="p">:</span> <span class="s">Accept-Encoding</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">text/html</span>
<span class="s">  </span>
<span class="s">&lt;!DOCTYPE html&gt;</span>
<span class="s">&lt;head&gt;</span>
<span class="s">  &lt;title&gt;Welcome to CLAC&lt;/title&gt;</span>
<span class="s">  &lt;style&gt;</span>
<span class="s">    pre {</span>
<span class="s">      font-family: Consolas, Menlo, monospace;</span>
<span class="s">    }</span>
<span class="s">  &lt;/style&gt;</span>
<span class="s">&lt;/head&gt;</span>
<span class="s">&lt;body&gt;</span>
<span class="s">&lt;pre&gt;</span>
<span class="s">                       _                            _</span>
<span class="s">         __      _____| | ___ ___  _ __ ___   ___  | |_ ___</span>
<span class="s">         \ \ /\ / / _ \ |/ __/ _ \| '_ \ _ \ / _ \ | __/ _ \</span>
<span class="s">          \ V  V /  __/ | (_| (_) | | | | | |  __/ | || (_) |</span>
<span class="s">           \_/\_/ \___|_|\___\___/|_| |_| |_|\___|  \__\___/</span>
<span class="s">  </span>
<span class="s">  </span>
<span class="s">                   @@@@@@     @@@  @@@@@@@  @@@@@@@@</span>
<span class="s">                   @@@@@@@   @@@@  @@@@@@@  @@@@@@@@</span>
<span class="s">                       @@@  @@@!!  !@@           @@!</span>
<span class="s">                       @!@    !@!  !@!          !@!</span>
<span class="s">                   @!@!!@     @!@  !!@@!!      @!!</span>
<span class="s">                   !!@!@!     !@!  @!!@!!!    !!!</span>
<span class="s">                       !!:    !!:      !:!   !!:</span>
<span class="s">                       :!:    :!:      !:!  :!:</span>
<span class="s">                   :: ::::    :::  :::: ::   ::</span>
<span class="s">                    : : :      ::  :: : :   : :</span>
<span class="s">  </span>
<span class="s">          Trying to log in? &lt;a href="http://www.cs.columbia.edu/~jae/3157/linux-environment.html"&gt;Click here for the login guide.&lt;/a&gt;</span>
<span class="s">&lt;/pre&gt;</span>
<span class="s">&lt;/body&gt;</span>
</code></pre></div>    </div>

    <p>where:</p>

    <ul>
      <li>you see the <strong>first part</strong> being the <code class="language-plaintext highlighter-rouge">response header</code></li>
      <li>the <code class="language-plaintext highlighter-rouge">html</code> <strong>content</strong> being the <code class="language-plaintext highlighter-rouge">response body</code>. If we connected <strong>using a browser</strong>, then the <code class="language-plaintext highlighter-rouge">html</code> will also be <strong>rendered</strong></li>
    </ul>
  </li>
</ul>

<p>Similarly, you could <strong>simulate</strong> the action of <strong>responding</strong> using <code class="language-plaintext highlighter-rouge">netcat</code> as well:</p>

<ul>
  <li>
    <p>use <code class="language-plaintext highlighter-rouge">nc -l 10027</code> on your laptop</p>
  </li>
  <li>
    <p>go to your <strong>browser and do</strong> <code class="language-plaintext highlighter-rouge">localhost:10027/</code></p>

    <p>Then you see the follows in <strong>your</strong> <code class="language-plaintext highlighter-rouge">netcat</code>:</p>

    <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">GET</span> <span class="nn">/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">localhost:10027</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">keep-alive</span>
<span class="na">Upgrade-Insecure-Requests</span><span class="p">:</span> <span class="s">1</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span>
<span class="na">Sec-Fetch-Site</span><span class="p">:</span> <span class="s">none</span>
<span class="na">Sec-Fetch-Mode</span><span class="p">:</span> <span class="s">navigate</span>
<span class="na">Sec-Fetch-User</span><span class="p">:</span> <span class="s">?1</span>
<span class="na">Sec-Fetch-Dest</span><span class="p">:</span> <span class="s">document</span>
<span class="na">Accept-Encoding</span><span class="p">:</span> <span class="s">gzip, deflate, br</span>
<span class="na">Accept-Language</span><span class="p">:</span> <span class="s">en-US,en;q=0.9</span>
</code></pre></div>    </div>

    <p><strong>in fact, I can fake the response as well by:</strong></p>

    <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.0</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="s">  </span>
<span class="s">&lt;html&gt;&lt;h1&gt;Hi&lt;/h1&gt;&lt;/html&gt;</span>
</code></pre></div>    </div>

    <p>where:</p>

    <ul>
      <li>**the browser will render the **<code class="language-plaintext highlighter-rouge">&lt;html&gt;&lt;h1&gt;Hi&lt;/h1&gt;&lt;/html&gt;</code> to be the webpage displaying on your laptop</li>
    </ul>
  </li>
</ul>

<h1 id="week-13">Week 13</h1>

<h2 id="socket-api-continued">Socket API (Continued)</h2>

<p>Here, we discuss the <strong>advanced</strong> version of <code class="language-plaintext highlighter-rouge">tcp-echo-client</code> and <code class="language-plaintext highlighter-rouge">tcp-echo-server</code>, where:</p>

<ul>
  <li>instead of sending/receiving command line texts, we can <strong>send and receive files</strong></li>
  <li><code class="language-plaintext highlighter-rouge">tcp-sender</code> sends a <strong>file</strong> to a target <code class="language-plaintext highlighter-rouge">ip</code></li>
  <li><code class="language-plaintext highlighter-rouge">tcp-recver</code> <strong>listens,receives, and saves</strong> a <strong>file</strong> from clients</li>
</ul>

<h3 id="tcp-sender"><code class="language-plaintext highlighter-rouge">tcp-sender</code></h3>

<p>This will be the advanced version of <a href="#`tcp-echo-client`"><code class="language-plaintext highlighter-rouge">tcp-echo-client</code></a>.</p>

<ol>
  <li>Establish a TCP connection with a remote IP
    <ul>
      <li>Step 1 basically uses the boiler template</li>
    </ul>
  </li>
  <li>Send a file content to the server by:
    <ol>
      <li>Send <strong><em>file size</em></strong></li>
      <li>Read and send file content</li>
      <li>Receive and compare the <strong><em>received file size</em></strong>
        <ul>
          <li>if incorrect, <code class="language-plaintext highlighter-rouge">die</code></li>
        </ul>
      </li>
    </ol>
  </li>
  <li>Done, closes the socket</li>
</ol>

<p>With the <strong>additional feature</strong> that:</p>

<ul>
  <li>if we passed <code class="language-plaintext highlighter-rouge">./send &lt;ip&gt; &lt;port&gt; -</code>, we can typed in filename from <code class="language-plaintext highlighter-rouge">stdin</code>
    <ul>
      <li>in fact, <strong>passing in <code class="language-plaintext highlighter-rouge">-</code></strong> as <strong>filename</strong> to indicate <strong>read content from <code class="language-plaintext highlighter-rouge">stdin</code></strong> is a <strong>common paradigm in UNIX</strong></li>
      <li>this is bugged actually due to the unknown file size and loop in server code</li>
    </ul>
  </li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">static</span> <span class="kt">void</span> <span class="nf">die</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">)</span> <span class="p">{</span> <span class="n">perror</span><span class="p">(</span><span class="n">s</span><span class="p">);</span> <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"usage: %s &lt;server-ip&gt; &lt;server-port&gt; &lt;filename&gt;</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span>
                <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ip</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">port</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">filename</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>

    <span class="c1">// additional feature</span>
    <span class="c1">// Open the file to send; if "-" is passed, read from stdin</span>

    <span class="kt">FILE</span> <span class="o">*</span><span class="n">fp</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">"-"</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="n">stdin</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">"rb"</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
            <span class="n">die</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cm">/* Start of template code */</span>
    <span class="c1">// Create a socket for TCP connection</span>

    <span class="kt">int</span> <span class="n">sock</span><span class="p">;</span> <span class="c1">// socket descriptor</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">die</span><span class="p">(</span><span class="s">"socket failed"</span><span class="p">);</span>

    <span class="c1">// Construct a server address structure</span>

    <span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">servaddr</span><span class="p">;</span>
    <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">servaddr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">servaddr</span><span class="p">));</span> <span class="c1">// must zero out the structure</span>
    <span class="n">servaddr</span><span class="p">.</span><span class="n">sin_family</span>      <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
    <span class="n">servaddr</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span> <span class="o">=</span> <span class="n">inet_addr</span><span class="p">(</span><span class="n">ip</span><span class="p">);</span>
    <span class="n">servaddr</span><span class="p">.</span><span class="n">sin_port</span>        <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="n">port</span><span class="p">);</span> <span class="c1">// must be in network byte order</span>

    <span class="c1">// Establish a TCP connection to the server</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">connect</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">servaddr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">servaddr</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">die</span><span class="p">(</span><span class="s">"connect failed"</span><span class="p">);</span>
    
    <span class="cm">/* End of template code */</span>

    <span class="c1">// First, send file size as 4-byte unsigned int in network byte order</span>

    <span class="k">struct</span> <span class="n">stat</span> <span class="n">st</span><span class="p">;</span>
    <span class="n">stat</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">st</span><span class="p">);</span> <span class="c1">// get data about the file into struct stat</span>
    <span class="kt">uint32_t</span> <span class="n">size</span> <span class="o">=</span> <span class="n">st</span><span class="p">.</span><span class="n">st_size</span><span class="p">;</span> <span class="c1">// use uint32_t to make sure</span>
    							<span class="c1">// 1. it is unsigned</span>
    							<span class="c1">// 2. it is 4 byte. Because actually size of int may vary</span>
    <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"file size:  %u</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
    <span class="kt">uint32_t</span> <span class="n">size_net</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">size</span><span class="p">);</span> <span class="c1">// since it is multibyte, we need to convert</span>

    <span class="cm">/*
     * send(int socket, const void *buffer, size_t length, int flags)
     *
     *   - normally, send() blocks until it sends all bytes requested
     *   - returns num bytes sent or -1 for error
     *   - send(sock,buf,len,0) is equivalent to write(sock,buf,len)
     */</span>
    <span class="c1">// send the size of file</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">send</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">size_net</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">size_net</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">size_net</span><span class="p">))</span>
        <span class="n">die</span><span class="p">(</span><span class="s">"send size failed"</span><span class="p">);</span>

    <span class="c1">// Second, send the file content</span>

    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">4096</span><span class="p">];</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="c1">// reading OBJECT of size 1 byte for 4096 TIMES INTO buf</span>
    <span class="c1">// returns n=numebr of bytes read</span>
    <span class="c1">// returns 0 for EOF</span>
    <span class="k">while</span> <span class="p">((</span><span class="n">n</span> <span class="o">=</span> <span class="n">fread</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="n">fp</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// send content in buf, for n bytes</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">send</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="n">n</span><span class="p">)</span>
            <span class="n">die</span><span class="p">(</span><span class="s">"send content failed"</span><span class="p">);</span>
        <span class="k">else</span>
            <span class="n">total</span> <span class="o">+=</span> <span class="n">n</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ferror</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">// fread() returns 0 on EOF or error, so we check if error occurred</span>
		<span class="n">die</span><span class="p">(</span><span class="s">"fread failed"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
    <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"bytes sent: %u</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">total</span><span class="p">);</span> <span class="c1">// done with sending file</span>

    <span class="c1">// Third, receive file size back from the server as acknowledgement</span>

    <span class="kt">uint32_t</span> <span class="n">ack</span><span class="p">,</span> <span class="n">ack_net</span><span class="p">;</span>

    <span class="cm">/*
     * recv(int socket, void *buffer, size_t length, int flags)
     *
     *   - normally, recv() blocks until it has received at least 1 byte
     *   - returns num bytes received, 0 if connection closed, -1 if error
     *   - recv(sock,buf,len,0) is equivalent to read(sock,buf,len)
     *   
     *   - With TCP sockets, we can receive less data than we requested;
     *     MSG_WAITALL flag changes this behavior -- it requests that the 
     *     operation block UNTIL THE FULL request is satisfied.
     */</span>
    <span class="c1">// receive all 4 bytes together, which is sizeof(ack_net)=length</span>
    <span class="kt">int</span> <span class="n">r</span> <span class="o">=</span> <span class="n">recv</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ack_net</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ack_net</span><span class="p">),</span> <span class="n">MSG_WAITALL</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">!=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ack_net</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">die</span><span class="p">(</span><span class="s">"recv failed"</span><span class="p">);</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">die</span><span class="p">(</span><span class="s">"connection closed prematurely"</span><span class="p">);</span>
        <span class="k">else</span>
            <span class="n">die</span><span class="p">(</span><span class="s">"didn't receive uint32"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">ack</span> <span class="o">=</span> <span class="n">ntohl</span><span class="p">(</span><span class="n">ack_net</span><span class="p">);</span> <span class="c1">// convert it back to host byte order</span>
    <span class="c1">// check if the SERVER wrote the correct number of bytes</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ack</span> <span class="o">!=</span> <span class="n">size</span><span class="p">)</span>
        <span class="n">die</span><span class="p">(</span><span class="s">"ack!=size"</span><span class="p">);</span>

    <span class="c1">// recv() will return 0 when the SERVER CLOSES the TCP connection</span>
    <span class="kt">char</span> <span class="n">x</span><span class="p">;</span> <span class="c1">// dummy variable, server should close here</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">recv</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">r</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>

    <span class="c1">// Clean-up</span>

    <span class="n">close</span><span class="p">(</span><span class="n">sock</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div>

<p>where, some additional functions used above are:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">stat()</code>
    <ul>
      <li>use <code class="language-plaintext highlighter-rouge">man 2 stat</code> instead of <code class="language-plaintext highlighter-rouge">man stat</code>, which would give you the command instead of function</li>
      <li><strong>Signature:</strong> <code class="language-plaintext highlighter-rouge">int stat(const char *pathname, struct stat *statbuf);</code>
        <ul>
          <li>give a <code class="language-plaintext highlighter-rouge">path/filename</code>, and <code class="language-plaintext highlighter-rouge">stat</code> will <strong>fill in all the data relevant to that file</strong> into <code class="language-plaintext highlighter-rouge">struct stat</code></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">MSG_WAITALL</code> flag for <code class="language-plaintext highlighter-rouge">recv(int socket, void *buffer, size_t length, int flags)</code>
    <ul>
      <li>block <strong>until all</strong> <code class="language-plaintext highlighter-rouge">length</code> bytes are received</li>
      <li>for example ` recv(sock, &amp;ack_net, sizeof(ack_net), MSG_WAITALL)`
        <ul>
          <li>this will block <strong>until all <code class="language-plaintext highlighter-rouge">sizeof(ack_net)</code> number of bytes</strong> are received. In this case <code class="language-plaintext highlighter-rouge">sizeof(ack_net)=4</code></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="tcp-recver"><code class="language-plaintext highlighter-rouge">tcp-recver</code></h3>

<p>This will be the advanced version of <a href="#`tcp-echo-server`"><code class="language-plaintext highlighter-rouge">tcp-echo-server</code></a>.</p>

<ol>
  <li>Establish a listening server</li>
  <li>Accept a connection
    <ul>
      <li>step 1 and step 2 basically uses the boiler template</li>
    </ul>
  </li>
  <li>Receive and save a file:
    <ol>
      <li><strong>Receive</strong> the size of file</li>
      <li>Receive and write the content of the file</li>
      <li><strong>Send</strong> the size of the written file to the client</li>
    </ol>
  </li>
  <li>Close the client connection</li>
  <li>Repeat to step 2</li>
</ol>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">static</span> <span class="kt">void</span> <span class="nf">die</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">)</span> <span class="p">{</span> <span class="n">perror</span><span class="p">(</span><span class="n">s</span><span class="p">);</span> <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"usage: %s &lt;server-port&gt; &lt;filebase&gt;</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">port</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">filebase</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

    <span class="c1">// Create a listening socket (also called server socket) </span>

    <span class="kt">int</span> <span class="n">servsock</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">servsock</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">die</span><span class="p">(</span><span class="s">"socket failed"</span><span class="p">);</span>

    <span class="cm">/* Start of template code */</span>
    <span class="c1">// Construct local address structure</span>

    <span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">servaddr</span><span class="p">;</span>
    <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">servaddr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">servaddr</span><span class="p">));</span>
    <span class="n">servaddr</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
    <span class="n">servaddr</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">INADDR_ANY</span><span class="p">);</span> <span class="c1">// any network interface</span>
    <span class="n">servaddr</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>

    <span class="c1">// Bind to the local address</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">bind</span><span class="p">(</span><span class="n">servsock</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">servaddr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">servaddr</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">die</span><span class="p">(</span><span class="s">"bind failed"</span><span class="p">);</span>

    <span class="c1">// Start listening for incoming connections</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">listen</span><span class="p">(</span><span class="n">servsock</span><span class="p">,</span> <span class="mi">5</span> <span class="cm">/* queue size for connection requests */</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">die</span><span class="p">(</span><span class="s">"listen failed"</span><span class="p">);</span>

    <span class="c1">// additional setups</span>
    <span class="kt">int</span> <span class="n">clntsock</span><span class="p">;</span>
    <span class="n">socklen_t</span> <span class="n">clntlen</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">clntaddr</span><span class="p">;</span>

    <span class="kt">FILE</span> <span class="o">*</span><span class="n">fp</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">filesuffix</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">filename</span><span class="p">[</span><span class="n">strlen</span><span class="p">(</span><span class="n">filebase</span><span class="p">)</span> <span class="o">+</span> <span class="mi">100</span><span class="p">];</span>

    <span class="kt">int</span> <span class="n">r</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">4096</span><span class="p">];</span>
    <span class="kt">uint32_t</span> <span class="n">size</span><span class="p">,</span> <span class="n">size_net</span><span class="p">,</span> <span class="n">remaining</span><span class="p">,</span> <span class="n">limit</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">stat</span> <span class="n">st</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>

        <span class="c1">// Accept an incoming connection</span>

        <span class="n">clntlen</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">clntaddr</span><span class="p">);</span> <span class="c1">// initialize the in-out parameter</span>

        <span class="k">if</span> <span class="p">((</span><span class="n">clntsock</span> <span class="o">=</span> <span class="n">accept</span><span class="p">(</span><span class="n">servsock</span><span class="p">,</span>
                        <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">clntaddr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">clntlen</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">die</span><span class="p">(</span><span class="s">"accept failed"</span><span class="p">);</span>
        
        <span class="cm">/* END of template code */</span>

        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"client ip: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">inet_ntoa</span><span class="p">(</span><span class="n">clntaddr</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">));</span>
        <span class="n">sprintf</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">"%s.%u"</span><span class="p">,</span> <span class="n">filebase</span><span class="p">,</span> <span class="n">filesuffix</span><span class="o">++</span><span class="p">);</span> <span class="c1">// formatting a string into filename variable</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"file name: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">filename</span><span class="p">);</span>

        <span class="c1">// opening a file for writing, in binary</span>
        <span class="c1">// binary mode so that there will be no data "translation" into other formats</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">"wb"</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
            <span class="n">die</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>

        <span class="c1">// First, receive file size</span>

        <span class="c1">// uint32_t size_net; was defined</span>
        <span class="c1">// MSG_WAITALL means to block UNTIL all sizeof(size_net)=4 bytes are received</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">recv</span><span class="p">(</span><span class="n">clntsock</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">size_net</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">size_net</span><span class="p">),</span> <span class="n">MSG_WAITALL</span><span class="p">);</span>  
        <span class="c1">// make sure all 4 bytes are received. </span>
        <span class="c1">// e.g. client might have quitted before sending the 4 bytes </span>
        <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">!=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">size_net</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">die</span><span class="p">(</span><span class="s">"recv failed"</span><span class="p">);</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">die</span><span class="p">(</span><span class="s">"connection closed prematurely"</span><span class="p">);</span>
            <span class="k">else</span>
                <span class="n">die</span><span class="p">(</span><span class="s">"didn't receive uint32"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">ntohl</span><span class="p">(</span><span class="n">size_net</span><span class="p">);</span> <span class="c1">// convert multi-byte data from internet to host byte order</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"file size received: %u</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>

        <span class="c1">// Second, receive the file content</span>

        <span class="n">remaining</span> <span class="o">=</span> <span class="n">size</span><span class="p">;</span> <span class="c1">// size = number of bytes of the file to receive</span>
        <span class="c1">// loop UNTIL remaining=size bytes are RECEIVED</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">remaining</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// char buf[4096];</span>
            <span class="c1">// controls writing AT MOST 4096 bytes at a time</span>
            <span class="n">limit</span> <span class="o">=</span> <span class="n">remaining</span> <span class="o">&gt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">?</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">:</span> <span class="n">remaining</span><span class="p">;</span>
            <span class="c1">// now, receive random numebr of bytes, upto limit</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">recv</span><span class="p">(</span><span class="n">clntsock</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">die</span><span class="p">(</span><span class="s">"recv failed"</span><span class="p">);</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">die</span><span class="p">(</span><span class="s">"connection closed prematurely"</span><span class="p">);</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="c1">// write r bytes to the file</span>
                <span class="n">remaining</span> <span class="o">-=</span> <span class="n">r</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">fwrite</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span> <span class="o">!=</span> <span class="n">r</span><span class="p">)</span> 
                    <span class="n">die</span><span class="p">(</span><span class="s">"fwrite failed"</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">assert</span><span class="p">(</span><span class="n">remaining</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span> <span class="c1">// done receiving and write file</span>

        <span class="c1">// Third, send the file size back as acknowledgement</span>

        <span class="c1">// get the stat of the file I JUST WROTE TO</span>
        <span class="n">stat</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">st</span><span class="p">);</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">st</span><span class="p">.</span><span class="n">st_size</span><span class="p">;</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"file size on disk:  %u</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
        <span class="n">size_net</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>

        <span class="c1">// send the data of content written to CLIENT</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">send</span><span class="p">(</span><span class="n">clntsock</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">size_net</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">size_net</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span> 
                <span class="o">!=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">size_net</span><span class="p">))</span>
            <span class="n">die</span><span class="p">(</span><span class="s">"send size failed"</span><span class="p">);</span>

        <span class="c1">// Finally, close the client connection and go back to accept()</span>

        <span class="n">close</span><span class="p">(</span><span class="n">clntsock</span><span class="p">);</span> <span class="c1">// SERVER closes the connection</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><mark>Exam 4 Material Ends Here</mark></p>

<h2 id="dynamic-html">Dynamic HTML</h2>

<p>First, we need to understand fully how a static html works.</p>

<p>Consider the following <strong>html file</strong> with <strong>path</strong> <code class="language-plaintext highlighter-rouge">~xy2437/html/index.html</code>:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;h1&gt;</span>
    Star Trek: The Next Generation, the best TV show ever!
<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>
<span class="nt">&lt;table&gt;</span>
    <span class="nt">&lt;tr&gt;</span>
	<span class="nt">&lt;td&gt;&lt;h2&gt;</span>The ship:<span class="nt">&lt;/h2&gt;&lt;/td&gt;</span>
	<span class="nt">&lt;td&gt;&lt;img</span> <span class="na">src=</span><span class="s">"images/ship.jpg"</span><span class="nt">&gt;&lt;/td&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;tr&gt;</span>
	<span class="nt">&lt;td&gt;&lt;h2&gt;</span>And the crew:<span class="nt">&lt;/h2&gt;&lt;/td&gt;</span>
	<span class="nt">&lt;td&gt;&lt;img</span> <span class="na">src=</span><span class="s">"images/crew.jpg"</span><span class="nt">&gt;&lt;/td&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>
<span class="nt">&lt;/table&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>Then, in the case of <code class="language-plaintext highlighter-rouge">clac</code>, if you requested:</p>

<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">www.clac.cs.columbia.edu/~xy2437/index.html
</span></code></pre></div></div>

<p>the <strong>following happens between your browser and the <em>Apache</em> server inside <code class="language-plaintext highlighter-rouge">clac</code>:</strong></p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">Apache clac</code> <strong>receives</strong> a get request for <code class="language-plaintext highlighter-rouge">GET /~xy2437/index.html HTTP/1.1</code></li>
  <li><code class="language-plaintext highlighter-rouge">Apache clac</code> <strong>converts</strong> the directory to <code class="language-plaintext highlighter-rouge">/~xy2437/html/index.html</code>
    <ul>
      <li>this is configured by the Apache server inside <code class="language-plaintext highlighter-rouge">clac</code></li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">Apache clac</code>  looks for the file <code class="language-plaintext highlighter-rouge">/~xy2437/html/index.html</code>, and serves/returns the content
    <ul>
      <li>and when done, it <strong><em>closes the connection</em></strong></li>
    </ul>
  </li>
  <li><strong>Browser</strong> receives the <code class="language-plaintext highlighter-rouge">html</code> file, and <strong>renders</strong> the content
    <ul>
      <li>in the above example, <strong><em>realizes</em></strong> that we needed <code class="language-plaintext highlighter-rouge">src="images/ship.jpg"</code> as well</li>
    </ul>
  </li>
  <li><strong>Browser</strong> creates another connection, <strong><em>sends another request</em></strong> for <code class="language-plaintext highlighter-rouge">~xy2437/images/ship.jpg</code> <strong><em>automatically</em></strong>
    <ul>
      <li><strong>based</strong> on the <strong>current</strong> URI <code class="language-plaintext highlighter-rouge">/~xy2437/&lt;index.html&gt;</code></li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">Apache clac</code> receives the request, convert the path, and serve the file</li>
  <li><strong>Browser</strong> receives the content, and realized another <code class="language-plaintext highlighter-rouge">src="images/crew.jpg"</code></li>
  <li>Repeat step 5 and 6</li>
  <li>Done</li>
</ol>

<blockquote>
  <p>In total:</p>

  <ul>
    <li>there has been <strong>three separate connections</strong> going on (under HTTP 1.0)
      <ul>
        <li>this causes quite some slow down, and is solved by HTTP 1.1:
          <ul>
            <li>server not closing the connection one completed, and connection is kept alive by browser periodically</li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</blockquote>

<p>Now, we get to how modern dynamic HTML works</p>

<h3 id="3-tier-architecture">3-Tier Architecture</h3>

<p>In short, to generate a <strong>dynamic webpage</strong>, you will have:</p>

<ul>
  <li>a <strong>browser</strong> that act as a client, that
    <ul>
      <li>talks to the front-end server</li>
    </ul>
  </li>
  <li>a <strong>front-end server</strong>, that
    <ul>
      <li><strong>returns</strong> the webpage to browser clients</li>
      <li>talks to the back-end server for <strong>data</strong></li>
    </ul>
  </li>
  <li>a <strong>back-end server</strong>, that
    <ul>
      <li><strong>returns</strong> to the front-end server for requested data</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p><strong>This is also called a 3-Tier Structure</strong></p>
</blockquote>

<hr />

<p><strong><em>For example, for lab7</em></strong></p>

<ul>
  <li>You have:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">mdb-lookup-server</code> as a backend server, serving up query results</li>
      <li><code class="language-plaintext highlighter-rouge">http-server</code> as the frontend server
        <ul>
          <li>serving to the client <strong><em>resources stored in the machine</em></strong></li>
          <li>talking to <strong><em>backend</em></strong></li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">firefox</code> is the client browser talking to frontend <code class="language-plaintext highlighter-rouge">http-server</code></li>
    </ul>
  </li>
</ul>

<p><img src="\lectures\images\typora-user-images\image-20201204182403674.png" alt="image-20201204182403674" /></p>

<p>where, in this case:</p>

<ul>
  <li>the connection between your browser and <code class="language-plaintext highlighter-rouge">http-server</code> (front-end) is <strong>transient</strong> (i.e. you close/open new connections for new client/resources)</li>
  <li>the connection between your <code class="language-plaintext highlighter-rouge">http-server</code> (front-end) and <code class="language-plaintext highlighter-rouge">mdb-cs3157</code> (back-end) is <strong>permanent</strong></li>
</ul>

<hr />

<p><strong>Additionally:</strong></p>

<ul>
  <li>your browser also does a lot more than simply getting the data from front-end server:</li>
  <li>its engine runs the <strong>JavaScript</strong>, which could also do requests/animations etc.</li>
</ul>

<p><strong>Typical Combinations of 3-Tier Structure</strong> would be:</p>

<ul>
  <li><strong>LAMP</strong>: Linux + Apache + MySQL + PHP</li>
</ul>

<h1 id="week-14">Week 14</h1>

<h2 id="from-c-to-c">From C to C++</h2>

<p>In short, you can imagine <code class="language-plaintext highlighter-rouge">C++</code> as a superset of <code class="language-plaintext highlighter-rouge">C</code>  (not strictly true, but works in many cases), with added functionalities:</p>

<ul>
  <li>OOP</li>
</ul>

<blockquote>
  <p><strong>Note:</strong></p>

  <ul>
    <li>For <code class="language-plaintext highlighter-rouge">C++</code>, we should use <code class="language-plaintext highlighter-rouge">g++</code> instead of <code class="language-plaintext highlighter-rouge">gcc</code> for <strong>compiling/linking</strong></li>
  </ul>
</blockquote>

<p><strong><em>For example</em></strong></p>

<ul>
  <li>
    <p>The following program runs with the <strong>same output as</strong> <code class="language-plaintext highlighter-rouge">a.c</code> or as <code class="language-plaintext highlighter-rouge">a.cpp</code>:</p>

    <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span>  
<span class="k">struct</span> <span class="n">Pt</span> <span class="p">{</span>
    <span class="kt">double</span> <span class="n">x</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">y</span><span class="p">;</span>
<span class="p">}</span>
  
<span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="k">struct</span> <span class="n">Pt</span> <span class="o">*</span><span class="n">pp</span><span class="p">){</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"(%g, %g)</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">pp</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">,</span> <span class="n">pp</span><span class="o">-&gt;</span><span class="n">y</span><span class="p">);</span>
<span class="p">}</span>
  
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="k">struct</span> <span class="n">Pt</span> <span class="n">p</span><span class="p">;</span>
      
    <span class="c1">// will print garbage value because it has not been initialized</span>
    <span class="n">print</span><span class="p">(</span><span class="o">&amp;</span><span class="n">p</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="changes-in-c">Changes in <code class="language-plaintext highlighter-rouge">C++</code></h3>

<p>And some basic changes for <code class="language-plaintext highlighter-rouge">cpp</code> in the above example would be:</p>

<ul>
  <li>
    <p><strong>replacing</strong> <code class="language-plaintext highlighter-rouge">struct</code> definition with <code class="language-plaintext highlighter-rouge">class</code></p>

    <div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// means the same as struct Pt in C</span>
<span class="k">class</span> <span class="nc">Pt</span> <span class="p">{</span>
    <span class="kt">double</span> <span class="n">x</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">y</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>    </div>

    <p>however, in <code class="language-plaintext highlighter-rouge">c++</code>:</p>

    <ul>
      <li>
        <p><strong>by default</strong>, the <strong>fields</strong> are <strong>private</strong></p>
      </li>
      <li>
        <p>to make them <strong>public</strong>, so that members can be accessed, you need add a <code class="language-plaintext highlighter-rouge">public</code> section</p>

        <div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Pt</span> <span class="p">{</span>
<span class="nl">public:</span>
    <span class="kt">double</span> <span class="n">x</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">y</span><span class="p">;</span>
<span class="nl">private:</span>
    <span class="p">...</span>
<span class="p">}</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>omitting</strong> the keyword <code class="language-plaintext highlighter-rouge">struct Pt</code> to <code class="language-plaintext highlighter-rouge">Pt</code> for custom type</p>

    <div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="n">Pt</span> <span class="o">*</span><span class="n">pp</span><span class="p">){</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"(%g, %g)</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">pp</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">,</span> <span class="n">pp</span><span class="o">-&gt;</span><span class="n">y</span><span class="p">);</span>
<span class="p">}</span>
  
<span class="kt">int</span> <span class="n">main</span><span class="p">(){</span>
    <span class="n">Pt</span> <span class="n">p</span><span class="p">;</span>
    <span class="n">print</span><span class="p">(</span><span class="o">&amp;</span><span class="n">p</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ul>

<blockquote>
  <p><strong>Note</strong></p>

  <ul>
    <li>One difference between <code class="language-plaintext highlighter-rouge">Java</code> and <code class="language-plaintext highlighter-rouge">C++</code> at this point would be that:
      <ul>
        <li><strong>every</strong> <code class="language-plaintext highlighter-rouge">cpp</code> file would <strong>require a <code class="language-plaintext highlighter-rouge">main</code></strong></li>
      </ul>
    </li>
  </ul>
</blockquote>

<h3 id="methods-and-constructors">Methods and Constructors</h3>

<ul>
  <li>
    <p><strong>method</strong> and  <strong>constructors</strong> are supported (<strong><em>signature of OOP</em></strong>)</p>

    <ul>
      <li>
        <p>in <code class="language-plaintext highlighter-rouge">C++</code>, methods are also called <strong>member functions</strong></p>
      </li>
      <li>
        <p>for example:</p>

        <div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Pt</span> <span class="p">{</span>
<span class="nl">public:</span>
    <span class="kt">double</span> <span class="n">x</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">y</span><span class="p">;</span>
    
    <span class="c1">// constructor</span>
    <span class="n">Pt</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
        <span class="n">y</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1">// method/member function</span>
    <span class="kt">void</span> <span class="n">print</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// this keyword = implicit pointer to this object</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"(%g,%g)</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<blockquote>
  <p><strong>Note:</strong></p>

  <ul>
    <li>
      <p>Under the hood, what happens is almost just this:</p>

      <div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// some code omitted here</span>
<span class="kt">void</span> <span class="nf">Pt_ctor</span><span class="p">(</span><span class="k">struct</span> <span class="nc">Pt</span> <span class="o">*</span><span class="k">this</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">y</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="n">Pt_print</span><span class="p">(</span><span class="k">struct</span> <span class="nc">Pt</span> <span class="o">*</span><span class="k">this</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"(%g,%g)</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">,</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">y</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Pt</span> <span class="n">p</span><span class="p">;</span>
    <span class="n">Pt_ctor</span><span class="p">(</span><span class="o">&amp;</span><span class="n">p</span><span class="p">);</span> <span class="c1">// inserted automatically</span>
      
    <span class="n">Pt_print</span><span class="p">(</span><span class="o">&amp;</span><span class="n">p</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>      </div>
    </li>
    <li>
      <p>and the take away message is:</p>

      <ul>
        <li>those <strong>OOP programs</strong> are <strong>nothing different from programs like <code class="language-plaintext highlighter-rouge">C</code></strong></li>
      </ul>
    </li>
  </ul>
</blockquote>

<blockquote>
  <p>In fact, this is pretty similar to <code class="language-plaintext highlighter-rouge">Java</code>:</p>

  <ul>
    <li>
      <p>for instance, the <strong>equivalent Java code would be</strong></p>

      <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Pt</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="c1">// constructor</span>
    <span class="kd">public</span> <span class="nf">Pt</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">;</span>
        <span class="n">y</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">;</span>
    <span class="o">}</span>
  
    <span class="c1">// method/member function</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">x</span> <span class="o">+</span><span class="s">","</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">y</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">};</span>
</code></pre></div>      </div>
    </li>
  </ul>
</blockquote>

<p>Similarly, to <strong>call those functions in <code class="language-plaintext highlighter-rouge">C++</code>,</strong></p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Stack allocation of object in C++</span>
    <span class="c1">// Declaring a reference (i.e. pointer) in Java</span>

    <span class="n">Pt</span> <span class="n">p</span><span class="p">;</span>

    <span class="cm">/* Heap allocations:

    // in Java
    Pt pp = new Pt();

    // in C++
    Pt *pp = new Pt();

    // in C
    Pt *pp = malloc(sizeof(struct Pt));
    Pt_ctor(pp)

    */</span>

    <span class="n">p</span><span class="p">.</span><span class="n">print</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>which is again, same as Java</li>
  <li>and <strong>the <code class="language-plaintext highlighter-rouge">p.</code> basically passes the pointer <code class="language-plaintext highlighter-rouge">*p</code> to the variable <code class="language-plaintext highlighter-rouge">this</code></strong></li>
</ul>

<h3 id="difference-between-c-and-java">Difference between <code class="language-plaintext highlighter-rouge">C++</code> and <code class="language-plaintext highlighter-rouge">Java</code></h3>

<p>One <strong>critical</strong> differen between <code class="language-plaintext highlighter-rouge">Java</code> and <code class="language-plaintext highlighter-rouge">C++</code> is:</p>

<ul>
  <li>
    <p>in <code class="language-plaintext highlighter-rouge">C++</code>: <code class="language-plaintext highlighter-rouge">Pt p;</code> would have <strong>allocated space for <code class="language-plaintext highlighter-rouge">class Pt</code></strong></p>
  </li>
  <li>
    <p>in <code class="language-plaintext highlighter-rouge">Java</code>: <code class="language-plaintext highlighter-rouge">Pt p;</code> <strong>only creates a reference</strong>, <strong>without allocating</strong> any memory (a hence a <code class="language-plaintext highlighter-rouge">NullPointer</code>)</p>

    <ul>
      <li>
        <p>however, there is a similar ability in <code class="language-plaintext highlighter-rouge">C++</code>:</p>

        <div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Heap allocations:</span>
    
    <span class="c1">// in Java</span>
    <span class="n">Pt</span> <span class="n">pp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Pt</span><span class="p">();</span>
    
    <span class="c1">// in C++</span>
    <span class="n">Pt</span> <span class="o">*</span><span class="n">pp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Pt</span><span class="p">();</span>
    
    <span class="c1">// in C</span>
    <span class="n">Pt</span> <span class="o">*</span><span class="n">pp</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="nc">Pt</span><span class="p">));</span>
    <span class="n">Pt_ctor</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>and to <code class="language-plaintext highlighter-rouge">free</code> the memory, you would have <code class="language-plaintext highlighter-rouge">delete()</code> in <code class="language-plaintext highlighter-rouge">C++</code></p>
      </li>
    </ul>
  </li>
</ul>

<blockquote>
  <p><strong>In fact</strong></p>

  <ul>
    <li>
      <p>in <code class="language-plaintext highlighter-rouge">Java</code>, <strong>since every object is a reference,</strong> so they also removed <code class="language-plaintext highlighter-rouge">*</code> and <code class="language-plaintext highlighter-rouge">&amp;</code>.</p>

      <ul>
        <li>
          <p>therefore, the line below only creates a pointer without allocation in <code class="language-plaintext highlighter-rouge">Java</code></p>

          <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Pt</span> <span class="n">p</span><span class="o">;</span>
</code></pre></div>          </div>
        </li>
        <li>
          <p>hence, you have the code like:</p>

          <div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// in Java</span>
<span class="n">Pt</span> <span class="n">pp</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Pt</span><span class="p">();</span>
    
<span class="c1">// in C++</span>
<span class="n">Pt</span> <span class="o">*</span><span class="n">pp</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Pt</span><span class="p">();</span>
</code></pre></div>          </div>
        </li>
      </ul>
    </li>
    <li>
      <p>Also, this means that <strong>all objects for Java would be in <code class="language-plaintext highlighter-rouge">Heap</code></strong>, which is <strong>why <code class="language-plaintext highlighter-rouge">Java</code> would be slower than programs such as <code class="language-plaintext highlighter-rouge">C++</code></strong></p>
    </li>
  </ul>
</blockquote>

<h1 id="miscellaneous">Miscellaneous</h1>

<h2 id="using-sftp">Using <code class="language-plaintext highlighter-rouge">sftp</code></h2>

<p>In general, you need to:</p>

<ol>
  <li><strong><code class="language-plaintext highlighter-rouge">sftp</code> into a remote server</strong> with <code class="language-plaintext highlighter-rouge">sftp &lt;remoteaddress&gt;</code>
    <ul>
      <li>basically the <code class="language-plaintext highlighter-rouge">&lt;remoteaddress&gt;</code> would be the same address where you <code class="language-plaintext highlighter-rouge">ssh</code></li>
    </ul>
  </li>
  <li>configure your <code class="language-plaintext highlighter-rouge">local directory</code> with <code class="language-plaintext highlighter-rouge">lcd</code></li>
  <li>configure your <code class="language-plaintext highlighter-rouge">remote directory</code> with <code class="language-plaintext highlighter-rouge">cd</code></li>
  <li>use <code class="language-plaintext highlighter-rouge">get &lt;fileName&gt;</code> to <strong>transfer a file</strong> from <code class="language-plaintext highlighter-rouge">remote directory</code> to <code class="language-plaintext highlighter-rouge">local directory</code>, and <code class="language-plaintext highlighter-rouge">put &lt;fileName&gt;</code> to do the reverse.
    <ul>
      <li>if you want to transfer <strong>folders</strong>, use <code class="language-plaintext highlighter-rouge">get -r</code> or <code class="language-plaintext highlighter-rouge">put -r</code></li>
    </ul>
  </li>
  <li>use <code class="language-plaintext highlighter-rouge">bye</code> to disconnect</li>
</ol>

<p>For example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sftp&gt; lcd <span class="s1">'/mnt/d/Dropbox/SEAS2020/Fall Semster/Advanced Programming/cs3157'</span>	<span class="c">#configure local directory</span>
sftp&gt; <span class="nb">cd</span> ~	<span class="c">#configure remote directory</span>
sftp&gt; get test.c	<span class="c">#exists on remote `~/test.c`, and transfers FROM remote TO local</span>
Fetching /mnt/disks/students209/xy2437/test.c to test.c
/mnt/disks/students209/xy2437/test.c                                                  100%   77     0.2KB/s   00:00
</code></pre></div></div>

<p>where:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">get</code> is used because we are transferring from <code class="language-plaintext highlighter-rouge">remote</code> to <code class="language-plaintext highlighter-rouge">local</code></li>
</ul>

<h2 id="gcd-with-euclidean-algorithm">GCD with Euclidean Algorithm</h2>

<p>It has to do with the fact that:</p>

<ul>
  <li>Write $A$ in quotient remainder form $(A = B⋅Q + R)$</li>
  <li>Find <code class="language-plaintext highlighter-rouge">GCD(B,R)</code> using the Euclidean Algorithm <strong>since <code class="language-plaintext highlighter-rouge">GCD(A,B) = GCD(B,R)</code></strong></li>
  <li><code class="language-plaintext highlighter-rouge">GCD(A,0) = A</code></li>
  <li><code class="language-plaintext highlighter-rouge">GCD(0,B) = B</code></li>
</ul>

<p><strong>Proof of <code class="language-plaintext highlighter-rouge">GCD(A,B)=GCD(B,R)</code></strong></p>

<ol>
  <li>
    <p>We show that <strong><code class="language-plaintext highlighter-rouge">GCD(A,B)=GCD(B,A-B)</code></strong></p>

    <ul>
      <li>
        <p>first, let $A-B = C$, then we know:</p>

        <ul>
          <li>
            <p>$X⋅GCD(A,B)=A$</p>
          </li>
          <li>
            <p>$Y⋅GCD(A,B)=B$</p>

            <p>Hence:</p>

\[X⋅GCD(A,B) - Y⋅GCD(A,B) = C\\
(X - Y)⋅GCD(A,B) = C\]
          </li>
          <li>
            <p>so <code class="language-plaintext highlighter-rouge">GCD(A,B)</code> evenly divides C</p>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p>Quite long. To continue, view https://www.khanacademy.org/computing/computer-science/cryptography/modarithmetic/a/the-euclidean-algorithm</p>
  </li>
</ol>

<h3 id="algorithm">Algorithm</h3>

<p>This is now simple:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">gcd</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> 
    <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> 
        <span class="k">return</span> <span class="n">b</span><span class="p">;</span> 
    <span class="k">return</span> <span class="n">gcd</span><span class="p">(</span><span class="n">b</span> <span class="o">%</span> <span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">);</span> 
<span class="p">}</span> 
</code></pre></div></div>

<h2 id="useful-git-commands">Useful Git Commands</h2>

<ol>
  <li>
    <p>If you want to <strong>view</strong> the <strong>contents of a file at a previous commit</strong> without checking it out, you can run:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git show &lt;commit tag&gt;:path/to/file
</code></pre></div>    </div>

    <ul>
      <li>remember to remove the angled brackets around the commit tag</li>
    </ul>
  </li>
  <li>
    <p>If you want to see <strong>all of the files that you have committed to your repository</strong> (in case you want to check if you committed any backup or object files), you can run:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git ls-tree <span class="nt">--name-only</span> <span class="nt">-r</span> HEAD
</code></pre></div>    </div>

    <p>This will <strong>list</strong> the files in your <strong>git tree</strong> (i.e. everything committed) at the <strong>HEAD commit</strong> with <strong>only the name</strong> (Git normally prints out other extraneous details). It will <strong>recurse (-r)</strong> into all subdirectories to show the filenames there too.</p>

    <ul>
      <li>use <code class="language-plaintext highlighter-rouge">git rm filename</code> to <strong>delete files that you don’t want to track and stage</strong></li>
    </ul>
  </li>
</ol>

<h2 id="valgrind"><code class="language-plaintext highlighter-rouge">valgrind</code></h2>

<p>Used for checking leakages. Basic uses is:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>valgrind <span class="nt">--leak-check</span><span class="o">=</span><span class="nb">yes</span> ./your_program &lt;some optional arguements here&gt;
</code></pre></div></div>

<p>To append the output to a file (in this example, <code class="language-plaintext highlighter-rouge">README.txt</code>):</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>valgrind <span class="nt">--leak-check</span><span class="o">=</span><span class="nb">yes</span> ./your_program &lt;some optional arguements here&gt; <span class="o">&gt;&gt;</span> ../README.txt 2&gt;&amp;1
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">2&gt;&amp;1</code> means redirect <code class="language-plaintext highlighter-rouge">stderr</code> to <code class="language-plaintext highlighter-rouge">stdout</code></p>
  </li>
  <li>
    <p>without <code class="language-plaintext highlighter-rouge">2&gt;&amp;1</code>, nothing will be appended to your file</p>
  </li>
</ul>

<h2 id="sed"><code class="language-plaintext highlighter-rouge">sed</code></h2>

<p>This program itself is actually a <strong>programming language</strong>. But we could write one-line programs to achieve some cool stuff.</p>

<p>For example:</p>

<p>This can be a tool used for <strong>textual replacement in your <code class="language-plaintext highlighter-rouge">Makefile</code></strong>.</p>

<p>The original file looks like:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jasonyux@XY-Laptop ~<span class="nv">$ </span><span class="nb">cat </span>Makefile
</code></pre></div></div>

<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">CC</span> <span class="o">=</span> gcc
<span class="nv">CFLAGS</span> <span class="o">=</span> <span class="nt">-Wall</span> <span class="nt">-g</span>
<span class="nl">main</span><span class="o">:</span> <span class="nf">main.o prime.o gcd.o</span>

<span class="nl">main.o</span><span class="o">:</span> <span class="nf">main.c prime.h gcd.h</span>

<span class="nl">prime.o</span><span class="o">:</span> <span class="nf">prime.c prime.h</span>

<span class="nl">gcd.o</span><span class="o">:</span> <span class="nf">gcd.c gcd.h</span>

<span class="nl">.PHONY</span><span class="o">:</span> <span class="nf">clean all</span>

<span class="nl">clean</span><span class="o">:</span>
        <span class="err">rm</span> <span class="err">-rf</span> <span class="err">*.o</span> <span class="err">main</span>
</code></pre></div></div>

<p>And then <strong>run</strong> the <code class="language-plaintext highlighter-rouge">sed</code> with <strong>pipeline</strong>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jasonyux@XY-Laptop ~<span class="nv">$ </span><span class="nb">cat </span>Makefile | <span class="nb">sed</span> <span class="s1">'s/main/twecho/g'</span>
</code></pre></div></div>

<p>You get:</p>

<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">CC</span> <span class="o">=</span> gcc
<span class="nv">CFLAGS</span> <span class="o">=</span> <span class="nt">-Wall</span> <span class="nt">-g</span>
<span class="nl">twecho</span><span class="o">:</span> <span class="nf">twecho.o prime.o gcd.o</span>

<span class="nl">twecho.o</span><span class="o">:</span> <span class="nf">twecho.c prime.h gcd.h</span>

<span class="nl">prime.o</span><span class="o">:</span> <span class="nf">prime.c prime.h</span>

<span class="nl">gcd.o</span><span class="o">:</span> <span class="nf">gcd.c gcd.h</span>

<span class="nl">.PHONY</span><span class="o">:</span> <span class="nf">clean all</span>

<span class="nl">clean</span><span class="o">:</span>
        <span class="err">rm</span> <span class="err">-rf</span> <span class="err">*.o</span> <span class="err">twecho</span>
</code></pre></div></div>

<p>where:</p>

<ul>
  <li>all occurrence of  <code class="language-plaintext highlighter-rouge">main</code>  become replaced by <code class="language-plaintext highlighter-rouge">twecho</code>.</li>
  <li>the one-line program is <code class="language-plaintext highlighter-rouge">'s/main/twecho/g'</code>, and
    <ul>
      <li><code class="language-plaintext highlighter-rouge">s</code> stands for <code class="language-plaintext highlighter-rouge">substitute</code></li>
      <li><code class="language-plaintext highlighter-rouge">g</code> stands for <code class="language-plaintext highlighter-rouge">globally</code>, which means all occurrence <strong>on the same line</strong> will be replaced</li>
    </ul>
  </li>
</ul>

<p>Finally, if you want to put them into a file, you can use the <code class="language-plaintext highlighter-rouge">&gt;</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jasonyux@XY-Laptop ~<span class="nv">$ </span><span class="nb">cat </span>Makefile | <span class="nb">sed</span> <span class="s1">'s/main/twecho/g'</span> <span class="o">&gt;</span> somefile.txt
</code></pre></div></div>

<h2 id="making-own-library">Making Own Library</h2>

<p>(for more details, see https://randu.org/tutorials/c/libraries.php)</p>

<ul>
  <li>If you have a bunch of files that contain <strong>just functions</strong>, you can turn these source files <strong>into libraries</strong> that can be used statically or dynamically by programs.</li>
  <li>A library is basically just an archive of <strong>object</strong> files.</li>
</ul>

<p>This means you need to do:</p>

<ol>
  <li>
    <p>Compile the source files of functions <strong>object</strong> files.</p>
  </li>
  <li>
    <p>Run:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ar rcs libmylib.a objfile1.o objfile2.o objfile3.o
</code></pre></div>    </div>

    <p>where <strong><code class="language-plaintext highlighter-rouge">mylib.a</code> will be the final output library file</strong>.</p>
  </li>
  <li>
    <p>Either link another file <strong>directly</strong> with:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gcc <span class="nt">-o</span> foo foo.o <span class="nt">-L</span><span class="nb">.</span> <span class="nt">-lmylib</span>
</code></pre></div>    </div>

    <p>where:</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">mylib</code> is the name for <code class="language-plaintext highlighter-rouge">mylib.a</code> you just had</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">-L.</code> tells <code class="language-plaintext highlighter-rouge">gcc</code> to look in the <strong>current directory in addition to the other library directories</strong> for finding <code class="language-plaintext highlighter-rouge">libmylib.a</code>.</p>
      </li>
    </ul>

    <p>Alternatively, <strong>add this in a <code class="language-plaintext highlighter-rouge">Makefile</code></strong>:</p>

    <div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">CC</span> <span class="o">=</span> gcc
<span class="nv">CFLAGS</span> <span class="o">=</span> <span class="nt">-Wall</span> <span class="nt">-g</span>
<span class="nv">LDLIBS</span> <span class="o">=</span> <span class="nt">-L</span><span class="nb">.</span> <span class="nt">-lmylist</span>
   
<span class="nl">mylist-test</span><span class="o">:</span> <span class="nf">mylist-test.o libmylist.a</span>
   
<span class="nl">libmylist.a</span><span class="o">:</span> <span class="nf">mylist.o</span>
		ar rcs libmylist.a mylist.o
   		
<span class="err">...</span> <span class="err">etc</span>
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="cut"><code class="language-plaintext highlighter-rouge">cut</code></h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cut </span>OPTION... <span class="o">[</span>FILE]...
</code></pre></div></div>

<p>DESCRIPTION:</p>

<ul>
  <li>
    <p><strong>Print selected parts of lines</strong> from each FILE to standard output.</p>
  </li>
  <li>With <strong>no FILE</strong>, or when FILE is <code class="language-plaintext highlighter-rouge">-</code>, <strong>read standard input</strong>.</li>
  <li>Mandatory arguments to long options are mandatory for short options too.</li>
</ul>

<p>Some useful options would be:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">-d</span>, <span class="nt">--delimiter</span><span class="o">=</span>DELIM
	use DELIM instead of TAB <span class="k">for </span>field delimiter
<span class="nt">-f</span>, <span class="nt">--fields</span><span class="o">=</span>LIST
	<span class="k">select </span>only these fields<span class="p">;</span>  also print any line that contains no 
	delimiter character, unless the <span class="nt">-s</span> option is specified
</code></pre></div></div>

<h2 id="sort"><code class="language-plaintext highlighter-rouge">sort</code></h2>

<p><code class="language-plaintext highlighter-rouge">sort</code> - sort lines of text files</p>

<h2 id="uniq"><code class="language-plaintext highlighter-rouge">uniq</code></h2>

<p><code class="language-plaintext highlighter-rouge">uniq</code> - report or omit repeated lines</p>

<h2 id="wget"><code class="language-plaintext highlighter-rouge">wget</code></h2>

<p><code class="language-plaintext highlighter-rouge">wget</code> - The non-interactive network downloader.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget <span class="o">[</span>option]... <span class="o">[</span>URL]...
</code></pre></div></div>

<h2 id="cmp"><code class="language-plaintext highlighter-rouge">cmp</code></h2>

<p>Used for <strong>comparing</strong> two files</p>

<h2 id="rsync"><code class="language-plaintext highlighter-rouge">rsync</code></h2>

<p>This would be a better version of <code class="language-plaintext highlighter-rouge">cp</code>, where this can:</p>

<ul>
  <li>copy across internet/machines</li>
  <li>copy only the <strong>difference</strong></li>
</ul>

  </div><a class="u-url" href="/lectures/2020@columbia/COMS3157_Advanced_Programming.html/" hidden></a>
  <script src="/lectures/assets/js/my_navigation.js"></script>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/lectures/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Lecture Notes</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Lecture Notes</li><li><a class="u-email" href="mailto:jasonyux17@gmail.com">jasonyux17@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/jasonyux"><svg class="svg-icon"><use xlink:href="/lectures/assets/minima-social-icons.svg#github"></use></svg> <span class="username">jasonyux</span></a></li><li><a href="https://www.linkedin.com/in/xiao-yu2437"><svg class="svg-icon"><use xlink:href="/lectures/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">xiao-yu2437</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>An inexhaustive collection of markdown/latex(PDF) notes that I took since college. </p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
